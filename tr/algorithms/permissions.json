{
  "spec": {
    "title": "Permissions",
    "url": "https://www.w3.org/TR/permissions/"
  },
  "algorithms": [
    {
      "name": "get a permission store entry",
      "href": "https://www.w3.org/TR/permissions/#dfn-get-a-permission-store-entry",
      "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-get-a-permission-store-entry\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">get a permission store entry</dfn> given a\n            <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-2\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">descriptor</var> and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-2\">permission key</a>\n            <var>key</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the user agent's <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-2\">permission store</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\">contains</a> an <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-entry-4\">entry</a> whose\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-descriptor\" class=\"internalDFN\" id=\"ref-for-dfn-descriptor-2\">descriptor</a> is <var data-type=\"PermissionDescriptor\">descriptor</var>, and whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-key\" class=\"internalDFN\" id=\"ref-for-dfn-key-2\">key</a> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-is-equal-to\" class=\"internalDFN\" id=\"ref-for-dfn-is-equal-to-1\">is equal to</a> <var>key</var> given <var data-type=\"PermissionDescriptor\">descriptor</var>, return that\n              entry."
        },
        {
          "html": "Return null."
        }
      ]
    },
    {
      "name": "set a permission store entry",
      "href": "https://www.w3.org/TR/permissions/#dfn-set-a-permission-store-entry",
      "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-set-a-permission-store-entry\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">set a permission store entry</dfn> given a\n            <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-3\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">descriptor</var>, a <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-3\">permission key</a> <var>key</var>,\n            and a <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-states\" class=\"internalDFN\" id=\"ref-for-dfn-states-4\">state</a> <var>state</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>newEntry</var> be a new <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-entry-5\">permission store entry</a> whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-descriptor\" class=\"internalDFN\" id=\"ref-for-dfn-descriptor-3\">descriptor</a> is <var data-type=\"PermissionDescriptor\">descriptor</var>, and whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-key\" class=\"internalDFN\" id=\"ref-for-dfn-key-3\">key</a> is <var>key</var>,\n            and whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-1\">state</a> is <var>state</var>."
        },
        {
          "html": "If the user agent's <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-3\">permission store</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\">contains</a> an <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-entry-6\">entry</a> whose\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-descriptor\" class=\"internalDFN\" id=\"ref-for-dfn-descriptor-4\">descriptor</a> is <var data-type=\"PermissionDescriptor\">descriptor</var>, and whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-key\" class=\"internalDFN\" id=\"ref-for-dfn-key-4\">key</a> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-is-equal-to\" class=\"internalDFN\" id=\"ref-for-dfn-is-equal-to-2\">is equal to</a> <var>key</var> given <var data-type=\"PermissionDescriptor\">descriptor</var>, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\">replace</a>\n            that entry with <var>newEntry</var> and abort these steps."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\">Append</a> <var>newEntry</var> to the user agent's <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-4\">permission store</a>."
        }
      ]
    },
    {
      "name": "remove a permission store entry",
      "href": "https://www.w3.org/TR/permissions/#dfn-remove-a-permission-store-entry",
      "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-remove-a-permission-store-entry\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">remove a permission store entry</dfn> given a\n            <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-4\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">descriptor</var> and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-4\">permission key</a>\n            <var>key</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\">Remove</a> the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-entry-7\">entry</a> whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-descriptor\" class=\"internalDFN\" id=\"ref-for-dfn-descriptor-5\">descriptor</a> is\n            <var data-type=\"PermissionDescriptor\">descriptor</var>, and whose <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-key\" class=\"internalDFN\" id=\"ref-for-dfn-key-5\">key</a> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-is-equal-to\" class=\"internalDFN\" id=\"ref-for-dfn-is-equal-to-3\">is equal to</a>\n            <var>key</var> given <var data-type=\"PermissionDescriptor\">descriptor</var>, from the user agent's <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-store\" class=\"internalDFN\" id=\"ref-for-dfn-permission-store-5\">permission store</a>."
        }
      ]
    },
    {
      "name": "permission key/is equal to",
      "href": "https://www.w3.org/TR/permissions/#dfn-is-equal-to",
      "html": "To determine whether a <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-5\">permission key</a> <var>key1</var> <dfn class=\"export\" data-dfn-for=\"permission key\" data-export=\"\" id=\"dfn-is-equal-to\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">is equal to</dfn> a <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-6\">permission key</a> <var>key2</var>, given a\n            <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-5\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">descriptor</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>key1</var> is not of <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key-type\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-type-3\">permission key type</a> or\n            <var>key2</var> is not of <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key-type\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-type-4\">permission key type</a>, return false."
        },
        {
          "html": "Return the result of running the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key-comparison-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-comparison-algorithm-1\">permission key comparison algorithm</a> for the feature named by <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-1\"><code>name</code></a>,\n            passing <var>key1</var> and <var>key2</var>."
        }
      ]
    },
    {
      "name": "powerful feature/extra permission data",
      "href": "https://www.w3.org/TR/permissions/#dfn-extra-permission-data",
      "html": "If a <a data-link-type=\"idl\" data-lt=\"DOMString\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\"><code>DOMString</code></a> <var>name</var> names one of these features, then <var>name</var>'s\n              <dfn data-dfn-for=\"powerful feature\" class=\"export\" data-export=\"\" id=\"dfn-extra-permission-data\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">extra permission data</dfn> for\n              an optional <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings object</a> <var>settings</var> is the result of the\n              following algorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>settings</var> wasn't passed, set it to the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>."
        },
        {
          "html": "If there was a previous invocation of this algorithm with the same <var>name</var> and\n              <var>settings</var>, returning <var>previousResult</var>, and the user agent has not received <a href=\"https://www.w3.org/TR/permissions/#dfn-new-information-about-the-user-s-intent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-new-information-about-the-user-s-intent-1\">new\n              information about the user's intent</a> since that invocation, return\n              <var>previousResult</var>."
        },
        {
          "html": "Return the instance of <var>name</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-extra-permission-data-type\" class=\"internalDFN\" id=\"ref-for-dfn-extra-permission-data-type-2\">extra permission data type</a>\n              that matches the UA's impression of the user's intent, taking into account any\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-extra-permission-data-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-extra-permission-data-constraints-1\">extra permission data constraints</a> for <var>name</var>."
        }
      ]
    },
    {
      "name": "default permission query algorithm",
      "href": "https://www.w3.org/TR/permissions/#dfn-default-permission-query-algorithm",
      "html": "The <dfn data-export=\"\" id=\"dfn-default-permission-query-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">default permission query algorithm</dfn>, given a\n              <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-11\"><code>PermissionDescriptor</code></a> <var>permissionDesc</var> and a <a data-link-type=\"idl\" data-lt=\"PermissionStatus\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus\" class=\"internalDFN\" id=\"ref-for-dom-permissionstatus-4\"><code>PermissionStatus</code></a>\n              <var>status</var>, runs the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Set <code><var>status</var></code>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-state\" class=\"internalDFN\" id=\"ref-for-dom-permissionstatus-state-2\"><code>state</code></a> to <var>permissionDesc</var>'s <a href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-permission-state-6\">\n                permission state</a>."
        }
      ]
    },
    {
      "name": "default permission key generation algorithm",
      "href": "https://www.w3.org/TR/permissions/#dfn-default-permission-key-generation-algorithm",
      "html": "The <dfn class=\"export\" data-export=\"\" id=\"dfn-default-permission-key-generation-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">default permission key generation algorithm</dfn>, given an\n              <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings object</a> <var>settings</var>, runs the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Return <var>settings</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\">top-level origin</a>."
        }
      ]
    },
    {
      "name": "default permission key comparison algorithm",
      "href": "https://www.w3.org/TR/permissions/#dfn-default-permission-key-comparison-algorithm",
      "html": "The <dfn class=\"export\" data-export=\"\" id=\"dfn-default-permission-key-comparison-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">default permission key comparison algorithm</dfn>, given\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-10\">permission keys</a> <var>key1</var> and <var>key2</var>, runs the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Return <var>key1</var> is <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\">same origin</a> with <var>key2</var>."
        }
      ]
    },
    {
      "html": "When the permission <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-lifetime\" class=\"internalDFN\" id=\"ref-for-dfn-lifetime-7\">lifetime</a> expires for an origin:",
      "rationale": "set",
      "steps": [
        {
          "html": "Set the permission back to its default <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-8\">permission state</a> (e.g., by setting it\n            back to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-prompt\" class=\"internalDFN\" id=\"ref-for-dfn-prompt-2\">\"prompt\"</a>)."
        },
        {
          "html": "For each <var>browsing context</var> associated with the origin (if any), <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permissions-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-permissions-task-source-1\">permissions task source</a> with the <var>browsing context</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\">global object</a> to run the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-revocation-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-revocation-algorithm-1\">permission revocation algorithm</a>."
        }
      ]
    },
    {
      "name": "getting the current permission state",
      "href": "https://www.w3.org/TR/permissions/#dfn-getting-the-current-permission-state",
      "html": "To <dfn class=\"export\" data-lt=\"getting the current permission state|get the current permission state\" data-export=\"\" id=\"dfn-getting-the-current-permission-state\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">get the current\n            permission state</dfn>, given a <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-name\" class=\"internalDFN\" id=\"ref-for-dfn-name-2\">name</a> <var>name</var> and an optional\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings object</a> <var>settings</var>, run the following steps. This algorithm\n            returns a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-3\"><code>PermissionState</code></a> enum value.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PermissionDescriptor\">descriptor</var> be a newly-created <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-12\"><code>PermissionDescriptor</code></a>\n            with <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-2\"><code>name</code></a> initialized to <var>name</var>."
        },
        {
          "html": "Return the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-9\">permission state</a> of <var data-type=\"PermissionDescriptor\">descriptor</var> with <var>settings</var>."
        }
      ]
    },
    {
      "name": "permission state",
      "href": "https://www.w3.org/TR/permissions/#dfn-permission-state",
      "html": "A <var data-type=\"PermissionDescriptor\">descriptor</var>'s <dfn class=\"export\" data-export=\"\" data-plurals=\"permission states\" id=\"dfn-permission-state\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">permission state</dfn>, given an optional\n            <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings object</a> <var>settings</var> is the result of the following algorithm.\n            It returns a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-4\"><code>PermissionState</code></a> enum value:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>settings</var> wasn't passed, set it to the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>."
        },
        {
          "html": "If <var>settings</var> is a <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context\">non-secure context</a>, return \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-4\"><code>denied</code></a>\"."
        },
        {
          "html": "Let <var>feature</var> be <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-3\"><code>name</code></a>."
        },
        {
          "html": "A <var data-type=\"PermissionDescriptor\">descriptor</var>'s <dfn class=\"export\" data-export=\"\" data-plurals=\"permission states\" id=\"dfn-permission-state\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">permission state</dfn>, given an optional\n            <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings object</a> <var>settings</var> is the result of the following algorithm.\n            It returns a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-4\"><code>PermissionState</code></a> enum value:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>document</var> be <var>settings</var>' <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s\n                <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a>."
            },
            {
              "html": "If <var>document</var> is not <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> <var>feature</var>, return\n                \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-5\"><code>denied</code></a>\"."
            }
          ]
        },
        {
          "html": "Let <var>key</var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"permission key generation algorithm\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key-generation-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-generation-algorithm-3\">generating a permission key</a> for <var data-type=\"PermissionDescriptor\">descriptor</var> with <var>settings</var>."
        },
        {
          "html": "Let <var>entry</var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"get a permission store entry\" href=\"https://www.w3.org/TR/permissions/#dfn-get-a-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-get-a-permission-store-entry-1\">getting a permission store entry</a> with <var data-type=\"PermissionDescriptor\">descriptor</var> and <var>key</var>."
        },
        {
          "html": "If <var>entry</var> is not null, return a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-5\"><code>PermissionState</code></a> enum value from <var>entry</var>'s\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-2\">state</a>."
        },
        {
          "html": "Return the <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-6\"><code>PermissionState</code></a> enum value that represents the permission state of\n            <var>feature</var>, taking into account any <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-constraints-1\">permission state constraints</a>\n            for <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-4\"><code>name</code></a>."
        }
      ]
    },
    {
      "name": "request permission to use",
      "href": "https://www.w3.org/TR/permissions/#dfn-request-permission-to-use",
      "html": "To <dfn data-lt=\"request permission to use|requesting permission to use\" class=\"export\" data-export=\"\" id=\"dfn-request-permission-to-use\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">request permission to use</dfn> a <var data-type=\"PermissionDescriptor\">descriptor</var>, the user\n            agent must perform the following steps. This algorithm returns either\n            \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-granted-3\"><code>granted</code></a>\" or \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-6\"><code>denied</code></a>\".",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>current state</var> be the <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-permission-state-12\">permission state</a>."
        },
        {
          "html": "If <var>current state</var> is not \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-prompt\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-prompt-2\"><code>prompt</code></a>\", return\n            <var>current state</var> and abort these steps."
        },
        {
          "html": "Ask the user for <a href=\"https://www.w3.org/TR/permissions/#dfn-express-permission\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-express-permission-7\">express permission</a> for the calling algorithm to use the <a href=\"https://www.w3.org/TR/permissions/#dfn-powerful-feature\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-powerful-feature-27\">\n              powerful feature</a> described by <var data-type=\"PermissionDescriptor\">descriptor</var>."
        },
        {
          "html": "If the user gives <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-express-permission\" class=\"internalDFN\" id=\"ref-for-dfn-express-permission-8\">express permission</a> to use the powerful feature, set <var>current\n            state</var> to \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-granted-4\"><code>granted</code></a>\"; otherwise to \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-7\"><code>denied</code></a>\". The\n            user's interaction may provide <a href=\"https://www.w3.org/TR/permissions/#dfn-new-information-about-the-user-s-intent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-new-information-about-the-user-s-intent-2\">new information about the user's intent</a> for the\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\">origin</a>."
        },
        {
          "html": "Let <var>key</var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"permission key generation algorithm\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key-generation-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-generation-algorithm-4\">generating a permission key</a> with the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\">responsible event loop</a> to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-set-a-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-set-a-permission-store-entry-1\">set a permission store entry</a> with <var data-type=\"PermissionDescriptor\">descriptor</var>,\n            <var>key</var>, and <var>current state</var>."
        },
        {
          "html": "Return <var>current state</var>."
        }
      ]
    },
    {
      "name": "prompt the user to choose",
      "href": "https://www.w3.org/TR/permissions/#dfn-prompt-the-user-to-choose",
      "html": "To <dfn data-lt=\"prompt the user to choose|prompting the user to choose\" class=\"export\" data-export=\"\" id=\"dfn-prompt-the-user-to-choose\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">prompt the user to choose</dfn> one or more <var>options</var> associated with a given\n            <var data-type=\"PermissionDescriptor\">descriptor</var> and an optional <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a>\n            <var data-type=\"boolean\">allowMultiple</var> (default false), the user agent must perform the following\n            steps. This algorithm returns either \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-8\"><code>denied</code></a>\" or the user's\n            selection.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-permission-state-13\">permission state</a> is \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-9\"><code>denied</code></a>\", return\n            \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-10\"><code>denied</code></a>\" and abort these steps."
        },
        {
          "html": "If <var data-type=\"PermissionDescriptor\">descriptor</var>'s <a href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-permission-state-14\">permission state</a> is \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-granted-5\"><code>granted</code></a>\", the\n            user agent may return one (or more if <var data-type=\"boolean\">allowMultiple</var> is true) of <var>options</var> chosen by\n            the user and abort these steps. If the user agent returns without prompting, then\n            subsequent <a data-lt=\"prompt the user to choose\" href=\"https://www.w3.org/TR/permissions/#dfn-prompt-the-user-to-choose\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-prompt-the-user-to-choose-1\">prompts for the user to choose</a>\n            from the same set of options with the same <var data-type=\"PermissionDescriptor\">descriptor</var> must return the same option(s),\n            unless the user agent receives <a href=\"https://www.w3.org/TR/permissions/#dfn-new-information-about-the-user-s-intent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-new-information-about-the-user-s-intent-3\">new information about the user's intent</a>."
        },
        {
          "html": "To <dfn data-lt=\"prompt the user to choose|prompting the user to choose\" class=\"export\" data-export=\"\" id=\"dfn-prompt-the-user-to-choose\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">prompt the user to choose</dfn> one or more <var>options</var> associated with a given\n            <var data-type=\"PermissionDescriptor\">descriptor</var> and an optional <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\">boolean</a>\n            <var data-type=\"boolean\">allowMultiple</var> (default false), the user agent must perform the following\n            steps. This algorithm returns either \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-8\"><code>denied</code></a>\" or the user's\n            selection.",
          "rationale": "if",
          "steps": [
            {
              "html": "If the calling algorithm specified extra information to include in the prompt,\n                include it."
            },
            {
              "html": "If <var data-type=\"boolean\">allowMultiple</var> is false, restrict selection to a single item from\n                <var>options</var>; otherwise, any number may be selected by the user."
            }
          ]
        },
        {
          "html": "If the user chose one or more options, return them; otherwise return\n            \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-denied-11\"><code>denied</code></a>\"."
        }
      ]
    },
    {
      "name": "react to the user revoking permission",
      "href": "https://www.w3.org/TR/permissions/#dfn-react-to-the-user-revoking-permission",
      "html": "When the user agent learns that the user no longer intends to grant permission to use a\n            feature described by the <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-16\"><code>PermissionDescriptor</code></a> <var>descriptor</var> in the context described\n            by the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-key\" class=\"internalDFN\" id=\"ref-for-dfn-permission-key-11\">permission key</a> <var>key</var>, <dfn id=\"dfn-react-to-the-user-revoking-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">react to the user revoking permission</dfn> by\n            running these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Run <var>descriptor</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-8\"><code>name</code></a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-revocation-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-revocation-algorithm-2\">permission revocation algorithm</a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-remove-a-permission-store-entry\" class=\"internalDFN\" id=\"ref-for-dfn-remove-a-permission-store-entry-1\">Remove a permission store entry</a> with <var>descriptor</var> and <var>key</var>."
        }
      ]
    },
    {
      "name": "Permissions/query()",
      "href": "https://www.w3.org/TR/permissions/#dom-permissions-query",
      "html": "When the <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-permissions-query\" data-idl=\"operation\" data-title=\"query()\" data-dfn-for=\"Permissions\" data-type=\"Promise\" data-lt=\"query()|query(permissionDesc)\" data-local-lt=\"Permissions.query|Permissions.query()|query\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>query()</code></dfn> method is invoked, the <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> <em class=\"rfc2119\">MUST</em> run the\n              following <dfn class=\"export\" data-export=\"\" id=\"dfn-query-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">query a permission</dfn> algorithm, passing the\n              parameter <var>permissionDesc</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "When the <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-permissions-query\" data-idl=\"operation\" data-title=\"query()\" data-dfn-for=\"Permissions\" data-type=\"Promise\" data-lt=\"query()|query(permissionDesc)\" data-local-lt=\"Permissions.query|Permissions.query()|query\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>query()</code></dfn> method is invoked, the <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> <em class=\"rfc2119\">MUST</em> run the\n              following <dfn class=\"export\" data-export=\"\" id=\"dfn-query-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">query a permission</dfn> algorithm, passing the\n              parameter <var>permissionDesc</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>'s <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a> is not\n                  <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active</a>, return <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an\n                  \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
            }
          ]
        },
        {
          "html": "Let <var>rootDesc</var> be the object <var>permissionDesc</var> refers to, <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL\n              value</a> of type <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-17\"><code>PermissionDescriptor</code></a>."
        },
        {
          "html": "If the conversion <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throws</a> an <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a>, return <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise\n              rejected with</a> that exception."
        },
        {
          "html": "If <var>rootDesc</var>[\"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-9\"><code>name</code></a>\"] is not supported, return <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "Let <var>typedDescriptor</var> be the object <var>permissionDesc</var> refers to, <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to\n              an IDL value</a> of <var>rootDesc</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-10\"><code>name</code></a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-descriptor-type\" class=\"internalDFN\" id=\"ref-for-dfn-permission-descriptor-type-4\">permission descriptor type</a>."
        },
        {
          "html": "If the conversion <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throws</a> an <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a>, return <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise\n              rejected with</a> that exception."
        },
        {
          "html": "Let <var data-type=\"Promise\">promise</var> be <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "When the <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-permissions-query\" data-idl=\"operation\" data-title=\"query()\" data-dfn-for=\"Permissions\" data-type=\"Promise\" data-lt=\"query()|query(permissionDesc)\" data-local-lt=\"Permissions.query|Permissions.query()|query\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>query()</code></dfn> method is invoked, the <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> <em class=\"rfc2119\">MUST</em> run the\n              following <dfn class=\"export\" data-export=\"\" id=\"dfn-query-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">query a permission</dfn> algorithm, passing the\n              parameter <var>permissionDesc</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>status</var> be <a href=\"https://www.w3.org/TR/permissions/#dfn-create-a-permissionstatus\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-create-a-permissionstatus-1\">create a <code>PermissionStatus</code></a> with <var>typedDescriptor</var>."
            },
            {
              "html": "Let <var>query</var> be <var>status</var>'s <a data-link-type=\"attribute\" data-lt=\"[[query]]\" href=\"https://www.w3.org/TR/permissions/#dfn-query\" class=\"internalDFN\" id=\"ref-for-dfn-query-1\"><code>[[query]]</code></a> internal slot."
            },
            {
              "html": "Run <var>query</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-11\"><code>name</code></a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-query-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-query-algorithm-1\">permission query algorithm</a>, passing <var>query</var> and <var>status</var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permissions-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-permissions-task-source-2\">permissions task source</a> with <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s\n                  <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var data-type=\"Promise\">promise</var> with <var>status</var>."
            }
          ]
        }
      ]
    },
    {
      "name": "create a PermissionStatus",
      "href": "https://www.w3.org/TR/permissions/#dfn-create-a-permissionstatus",
      "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-create-a-permissionstatus\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">create a <code>PermissionStatus</code></dfn> for a given\n              <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-18\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">permissionDesc</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"DOMString\">name</var> be <var data-type=\"PermissionDescriptor\">permissionDesc</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-12\"><code>name</code></a>."
        },
        {
          "html": "Assert: The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-powerful-feature\" class=\"internalDFN\" id=\"ref-for-dfn-powerful-feature-28\">feature</a> identified by <var data-type=\"DOMString\">name</var> is supported by the user agent."
        },
        {
          "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-create-a-permissionstatus\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">create a <code>PermissionStatus</code></dfn> for a given\n              <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-18\"><code>PermissionDescriptor</code></a> <var data-type=\"PermissionDescriptor\">permissionDesc</var>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var data-type=\"PermissionStatus\">status</var>'s <a data-link-type=\"attribute\" data-lt=\"[[query]]\" href=\"https://www.w3.org/TR/permissions/#dfn-query\" class=\"internalDFN\" id=\"ref-for-dfn-query-2\"><code>[[query]]</code></a> internal slot to\n                  <var data-type=\"PermissionDescriptor\">permissionDesc</var>."
            },
            {
              "html": "Initialize <var data-type=\"PermissionStatus\">status</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus-name\" class=\"internalDFN\" id=\"ref-for-dom-permissionstatus-name-2\"><code>name</code></a> to <var data-type=\"DOMString\">name</var>."
            }
          ]
        },
        {
          "html": "Return <var data-type=\"PermissionStatus\">status</var>."
        }
      ]
    },
    {
      "name": "PermissionStatus update steps",
      "href": "https://www.w3.org/TR/permissions/#dfn-permissionstatus-update-steps",
      "html": "Whenever the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> is aware that the state of a <a data-link-type=\"idl\" data-lt=\"PermissionStatus\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus\" class=\"internalDFN\" id=\"ref-for-dom-permissionstatus-7\"><code>PermissionStatus</code></a>\n              instance <var>status</var> has changed, it asynchronously runs the <dfn id=\"dfn-permissionstatus-update-steps\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\"><code>PermissionStatus</code>\n              update steps</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Whenever the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> is aware that the state of a <a data-link-type=\"idl\" data-lt=\"PermissionStatus\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstatus\" class=\"internalDFN\" id=\"ref-for-dom-permissionstatus-7\"><code>PermissionStatus</code></a>\n              instance <var>status</var> has changed, it asynchronously runs the <dfn id=\"dfn-permissionstatus-update-steps\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\"><code>PermissionStatus</code>\n              update steps</dfn>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>document</var> be <var>status</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a>."
            },
            {
              "html": "If <var>document</var> is null or <var>document</var> is not <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active</a>,\n                  terminate this algorithm."
            }
          ]
        },
        {
          "html": "Let <var>query</var> be <var>status</var>'s <a data-link-type=\"attribute\" data-lt=\"[[query]]\" href=\"https://www.w3.org/TR/permissions/#dfn-query\" class=\"internalDFN\" id=\"ref-for-dfn-query-3\"><code>[[query]]</code></a> internal slot."
        },
        {
          "html": "Run <var>query</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-13\"><code>name</code></a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-query-algorithm\" class=\"internalDFN\" id=\"ref-for-dfn-permission-query-algorithm-2\">permission query algorithm</a>, passing <var>query</var> and <var>status</var>."
        },
        {
          "html": "<a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permissions-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-permissions-task-source-3\">permissions task source</a> to <a data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a>\n                named <code>change</code> at <var>status</var>."
        }
      ]
    },
    {
      "name": "set a permission",
      "href": "https://www.w3.org/TR/permissions/#dfn-set-a-permission",
      "html": "To <dfn data-for=\"WebDriver\" id=\"dfn-set-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">set a permission</dfn> given a <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-19\"><code>PermissionDescriptor</code></a>\n          <var data-type=\"PermissionDescriptor\">descriptor</var>, a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-9\"><code>PermissionState</code></a> <var data-type=\"PermissionState\">state</var>, an\n          optional <var>origin</var>, and an optional <var>user agent</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>target origin</var> be <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\">current settings object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\">origin</a> if <var>origin</var> is null, or <var>origin</var> otherwise."
        },
        {
          "html": "Let <var>targets</var> be a <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">list</a> containing all <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\">environment settings objects</a> whose\n          <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\">origin</a> is <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\">same origin</a> with <var>target origin</var>, and which\n          belong to the <var>user agent</var> if provided, or all user agents otherwise."
        },
        {
          "html": "Let <var>tasks</var> be an empty <a data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">list</a>."
        },
        {
          "html": "To <dfn data-for=\"WebDriver\" id=\"dfn-set-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">set a permission</dfn> given a <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-19\"><code>PermissionDescriptor</code></a>\n          <var data-type=\"PermissionDescriptor\">descriptor</var>, a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-9\"><code>PermissionState</code></a> <var data-type=\"PermissionState\">state</var>, an\n          optional <var>origin</var>, and an optional <var>user agent</var>:",
          "rationale": "queue",
          "steps": [
            {
              "html": "To <dfn data-for=\"WebDriver\" id=\"dfn-set-a-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">set a permission</dfn> given a <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-19\"><code>PermissionDescriptor</code></a>\n          <var data-type=\"PermissionDescriptor\">descriptor</var>, a <a data-link-type=\"idl\" data-lt=\"PermissionState\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate\" class=\"internalDFN\" id=\"ref-for-dom-permissionstate-9\"><code>PermissionState</code></a> <var data-type=\"PermissionState\">state</var>, an\n          optional <var>origin</var>, and an optional <var>user agent</var>:",
              "rationale": "interpret",
              "steps": [
                {
                  "html": "Interpret <var data-type=\"PermissionState\">state</var> as if it were the result of an invocation of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-16\">permission state</a> for <var data-type=\"PermissionDescriptor\">descriptor</var> with the argument <var>target</var> made at this moment."
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\">Append</a> <var>task</var> to <var>tasks</var>."
            }
          ]
        },
        {
          "html": "Wait for all <a data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-task\">tasks</a> in <var>tasks</var> to have executed and return."
        }
      ]
    },
    {
      "html": "The <a data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-remote-end-steps\">remote end steps</a> are:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var>parametersDict</var> be the <var>parameters</var> argument, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value</a> of\n            type <a data-link-type=\"idl\" data-lt=\"PermissionSetParameters\" href=\"https://www.w3.org/TR/permissions/#dom-permissionsetparameters\" class=\"internalDFN\" id=\"ref-for-dom-permissionsetparameters-1\"><code>PermissionSetParameters</code></a>. If this throws an exception, return an <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-invalid-argument\">invalid argument</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-error\">error</a>."
        },
        {
          "html": "If <var>parametersDict</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionsetparameters-state\" class=\"internalDFN\" id=\"ref-for-dom-permissionsetparameters-state-1\"><code>state</code></a> is an inappropriate\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-18\">permission state</a> for any implementation-defined reason, return an <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-invalid-argument\">invalid argument</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-error\">error</a>."
        },
        {
          "html": "Let <var>rootDesc</var> be <var>parametersDict</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionsetparameters-descriptor\" class=\"internalDFN\" id=\"ref-for-dom-permissionsetparameters-descriptor-1\"><code>descriptor</code></a>."
        },
        {
          "html": "Let <var>typedDescriptor</var> be the object <var>rootDesc</var> refers to, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value</a> of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-descriptor-type\" class=\"internalDFN\" id=\"ref-for-dfn-permission-descriptor-type-6\">permission descriptor type</a> matching the result of\n            <a href=\"https://tc39.es/ecma262/multipage/#sec-get-o-p\">Get</a>(<var>rootDesc</var>, \"<code>name</code>\"). If this throws an\n            exception, return a <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-invalid-argument\">invalid argument</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-error\">error</a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-set-a-permission\" class=\"internalDFN\" id=\"ref-for-dfn-set-a-permission-1\">Set a permission</a> with <var>typedDescriptor</var> and\n            <var>parametersDict</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissionsetparameters-state\" class=\"internalDFN\" id=\"ref-for-dom-permissionsetparameters-state-2\"><code>state</code></a>."
        },
        {
          "html": "Return <a data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver1/#dfn-success\">success</a> with data <code>null</code>."
        }
      ]
    },
    {
      "name": "remote end steps for permissions.setPermission",
      "html": "The <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-remote-end-steps\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>descriptor</var> be the value of the <code>descriptor</code> field of <var>command\n                  parameters</var>."
        },
        {
          "html": "Let <var>permission name</var> be the value of the <code>name</code> field of <var>descriptor</var>\n                  representing <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" class=\"internalDFN\" id=\"ref-for-dom-permissiondescriptor-name-14\"><code>name</code></a>."
        },
        {
          "html": "Let <var>state</var> be the value of the <code>state</code> field of <var>command parameters</var>."
        },
        {
          "html": "Let <var>user context id</var> be the value of the <code>userContext</code> field of <var>command\n                  parameters</var>, if present, and <code>default</code> otherwise."
        },
        {
          "html": "If <var>state</var> is an inappropriate <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" class=\"internalDFN\" id=\"ref-for-dfn-permission-state-21\">permission state</a> for any\n                  implementation-defined reason, return <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-error\">error</a> with <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-error-code\">error code</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-invalid-argument\">invalid argument</a>."
        },
        {
          "html": "Let <var>typedDescriptor</var> be the object <var>descriptor</var> refers to, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value</a> (<var>descriptor</var>, <var>state</var>) of <a data-link-type=\"idl\" data-lt=\"PermissionSetParameters\" href=\"https://www.w3.org/TR/permissions/#dom-permissionsetparameters\" class=\"internalDFN\" id=\"ref-for-dom-permissionsetparameters-2\"><code>PermissionSetParameters</code></a> <var>permission\n                  name</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-descriptor-type\" class=\"internalDFN\" id=\"ref-for-dfn-permission-descriptor-type-7\">permission descriptor type</a>. If this conversion\n                  throws an exception, return <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-error\">error</a> with <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-error-code\">error code</a> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-invalid-argument\">invalid argument</a>."
        },
        {
          "html": "Let <var>origin</var> be the value of the <code>origin</code> field of <var>command parameters</var>."
        },
        {
          "html": "Let <var>user agent</var> be the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\">user agent</a> that represents the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context\">user context</a>\n                  with the id <var>user context id</var>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/permissions/#dfn-set-a-permission\" class=\"internalDFN\" id=\"ref-for-dfn-set-a-permission-2\">Set a permission</a> with <var>typedDescriptor</var>, <var>state</var>, <var>origin</var>, and <var>user\n                  agent</var>."
        },
        {
          "html": "Return <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/webdriver2/#dfn-success\">success</a> with data <code>null</code>."
        }
      ]
    }
  ]
}