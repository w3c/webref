{
  "spec": {
    "title": "Geolocation",
    "url": "https://www.w3.org/TR/geolocation/"
  },
  "algorithms": [
    {
      "name": "Geolocation/getCurrentPosition()",
      "href": "https://www.w3.org/TR/geolocation/#dom-geolocation-getcurrentposition",
      "html": "The <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-geolocation-getcurrentposition\" data-idl=\"operation\" data-title=\"getCurrentPosition\" data-dfn-for=\"Geolocation\" data-type=\"undefined\" data-lt=\"getCurrentPosition()|getCurrentPosition(successCallback)|getCurrentPosition(successCallback, errorCallback)|getCurrentPosition(successCallback, errorCallback, options)\" data-local-lt=\"Geolocation.getCurrentPosition|Geolocation.getCurrentPosition()|getCurrentPosition\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>getCurrentPosition</code></dfn>(<var data-type=\"PositionCallback\">successCallback</var>,\n          <var data-type=\"PositionErrorCallback?\">errorCallback</var>, <var data-type=\"PositionOptions\">options</var>)\n          method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<del cite=\"#c1\">If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-index-term-current-settings-object-1\">current settings object</a>'s\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-1\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-1\">associated <code>Document</code></a> is not\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-index-term-fully-active-for-document-1\">fully active</a>:</del> <ins cite=\"#c1\">If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-2\">this</a>'s\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-2\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-2\">associated <code>Document</code></a> is not\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-index-term-fully-active-for-document-2\">fully active</a>:</ins>",
          "rationale": "call",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-1\">Call back with error</a> <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-position_unavailable\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-position_unavailable-1\"><code>POSITION_UNAVAILABLE</code></a>."
            },
            {
              "html": "Terminate this algorithm."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-request-a-position\" class=\"internalDFN\" id=\"ref-for-dfn-request-a-position-1\">Request a position</a> passing <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-3\">this</a>, <var data-type=\"PositionCallback\">successCallback</var>,\n          <var data-type=\"PositionErrorCallback?\">errorCallback</var>, and <var data-type=\"PositionOptions\">options</var>."
        }
      ]
    },
    {
      "name": "Geolocation/watchPosition()",
      "href": "https://www.w3.org/TR/geolocation/#dom-geolocation-watchposition",
      "html": "The <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-geolocation-watchposition\" data-idl=\"operation\" data-title=\"watchPosition\" data-dfn-for=\"Geolocation\" data-type=\"long\" data-lt=\"watchPosition()|watchPosition(successCallback)|watchPosition(successCallback, errorCallback)|watchPosition(successCallback, errorCallback, options)\" data-local-lt=\"Geolocation.watchPosition|Geolocation.watchPosition()|watchPosition\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>watchPosition</code></dfn>(<var data-type=\"PositionCallback\">successCallback</var>,\n          <var data-type=\"PositionErrorCallback?\">errorCallback</var>, <var data-type=\"PositionOptions\">options</var>)\n          method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<del cite=\"#c2\">If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-index-term-current-settings-object-2\">current settings object</a>'s\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-3\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-3\">associated <code>Document</code></a> is not\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-index-term-fully-active-for-document-3\">fully active</a>:</del> <ins cite=\"#c2\">If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-4\">this</a>'s\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-4\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-4\">associated <code>Document</code></a> is not\n            <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-index-term-fully-active-for-document-4\">fully active</a>:</ins>",
          "rationale": "call",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-2\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-position_unavailable\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-position_unavailable-2\"><code>POSITION_UNAVAILABLE</code></a>."
            },
            {
              "html": "Return 0."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"unsigned long\">watchId</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-index-term-implementation-defined-1\">implementation-defined</a>\n          <a data-link-type=\"interface\" data-lt=\"unsigned long\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-long\" id=\"ref-for-index-term-unsigned-long-type-2\"><code>unsigned long</code></a> that is greater than zero."
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-index-term-append-for-list-1\">Append</a> <var data-type=\"unsigned long\">watchId</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-5\">this</a>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[watchIDs]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-watchids\" class=\"internalDFN\" id=\"ref-for-dfn-watchids-1\"><code>[[watchIDs]]</code></a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-request-a-position\" class=\"internalDFN\" id=\"ref-for-dfn-request-a-position-2\">Request a position</a> passing <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-6\">this</a>, <var data-type=\"PositionCallback\">successCallback</var>,\n          <var data-type=\"PositionErrorCallback?\">errorCallback</var>, <var data-type=\"PositionOptions\">options</var>, and <var data-type=\"unsigned long\">watchId</var>."
        },
        {
          "html": "Return <var data-type=\"unsigned long\">watchId</var>."
        }
      ]
    },
    {
      "name": "Geolocation/clearWatch()",
      "href": "https://www.w3.org/TR/geolocation/#dom-geolocation-clearwatch",
      "html": "When <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-geolocation-clearwatch\" data-idl=\"operation\" data-title=\"clearWatch()\" data-dfn-for=\"Geolocation\" data-type=\"undefined\" data-lt=\"clearWatch()|clearWatch(watchId)\" data-local-lt=\"Geolocation.clearWatch|Geolocation.clearWatch()|clearWatch\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>clearWatch()</code></dfn> is invoked, the user agent <em class=\"rfc2119\">MUST</em>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-index-term-remove-for-list-1\">Remove</a> <var>watchId</var> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-7\">this</a>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[watchIDs]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-watchids\" class=\"internalDFN\" id=\"ref-for-dfn-watchids-2\"><code>[[watchIDs]]</code></a>."
        }
      ]
    },
    {
      "name": "request a position",
      "href": "https://www.w3.org/TR/geolocation/#dfn-request-a-position",
      "html": "To <dfn id=\"dfn-request-a-position\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">request a position</dfn>, pass a <a data-link-type=\"idl\" data-lt=\"Geolocation\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocation\" class=\"internalDFN\" id=\"ref-for-dom-geolocation-3\"><code>Geolocation</code></a>\n          <var data-type=\"Geolocation\">geolocation</var>, a <a data-link-type=\"idl\" data-lt=\"PositionCallback\" href=\"https://www.w3.org/TR/geolocation/#dom-positioncallback\" class=\"internalDFN\" id=\"ref-for-dom-positioncallback-3\"><code>PositionCallback</code></a>\n          <var data-type=\"PositionCallback\">successCallback</var>, a <a data-link-type=\"idl\" data-lt=\"PositionErrorCallback\" href=\"https://www.w3.org/TR/geolocation/#dom-positionerrorcallback\" class=\"internalDFN\" id=\"ref-for-dom-positionerrorcallback-3\"><code>PositionErrorCallback?</code></a>\n          <var data-type=\"PositionErrorCallback?\">errorCallback</var>, a <a data-link-type=\"idl\" data-lt=\"PositionOptions\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-5\"><code>PositionOptions</code></a>\n          <var data-type=\"PositionOptions\">options</var>, and an optional <var data-type=\"unsigned long\">watchId</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"List\">watchIDs</var> be <var data-type=\"Geolocation\">geolocation</var>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[watchIDs]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-watchids\" class=\"internalDFN\" id=\"ref-for-dfn-watchids-3\"><code>[[watchIDs]]</code></a>."
        },
        {
          "html": "Let <var data-type=\"Document\">document</var> be the <var data-type=\"Geolocation\">geolocation</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-5\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-5\">associated <code>Document</code></a>."
        },
        {
          "html": "If <var data-type=\"Document\">document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-index-term-allowed-to-use-1\">allowed to use</a> the\n          \"geolocation\" feature:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var data-type=\"unsigned long\">watchId</var> was passed, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-index-term-remove-for-list-2\">remove</a> <var data-type=\"unsigned long\">watchId</var> from\n              <var data-type=\"List\">watchIDs</var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-3\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-permission_denied\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-permission_denied-1\"><code>PERMISSION_DENIED</code></a>."
            },
            {
              "html": "Terminate this algorithm."
            }
          ]
        },
        {
          "rationale": "if",
          "steps": [
            {
              "html": "If <var data-type=\"unsigned long\">watchId</var> was passed, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-index-term-remove-for-list-3\">remove</a> <var data-type=\"unsigned long\">watchId</var> from\n              <var data-type=\"List\">watchIDs</var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-4\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-permission_denied\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-permission_denied-2\"><code>PERMISSION_DENIED</code></a>."
            },
            {
              "html": "Terminate this algorithm."
            }
          ],
          "html": "<ins cite=\"#c7\">If <var data-type=\"Geolocation\">geolocation</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-index-term-environment-settings-object-1\">environment settings object</a>\n            is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context\" id=\"ref-for-index-term-non-secure-contexts-2\">non-secure context</a>:\n            </ins>"
        },
        {
          "html": "If <var data-type=\"Document\">document</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-index-term-visibility-state-for-document-1\">visibility state</a> is\n          \"hidden\", wait for the following <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#page-visibility-change-steps\" id=\"ref-for-index-term-page-visibility-change-steps-1\">page visibility change steps</a> to\n          run:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"Document\">document</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-index-term-visibility-state-for-document-2\">visibility state</a> is\n              \"visible\"."
            },
            {
              "html": "Continue to the next steps below."
            }
          ]
        },
        {
          "html": "Let <var>descriptor</var> be a new <a data-link-type=\"dictionary\" data-lt=\"PermissionDescriptor\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\" id=\"ref-for-index-term-permissiondescriptor-1\"><code>PermissionDescriptor</code></a> whose\n          <a data-link-type=\"dict-member\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\" id=\"ref-for-index-term-name-for-permissiondescriptor-1\"><code>name</code></a> is <a href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-geolocation-1\"><code>\"geolocation\"</code></a>."
        },
        {
          "html": "<ins cite=\"#c10\"><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-index-term-in-parallel-1\">In parallel</a></ins>:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>permission</var> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-request-permission-to-use\" id=\"ref-for-index-term-request-permission-to-use-1\">request permission to use</a>\n              <var>descriptor</var>."
            },
            {
              "html": "If <var>permission</var> is \"denied\", then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var data-type=\"unsigned long\">watchId</var> was passed, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-index-term-remove-for-list-4\">remove</a> <var data-type=\"unsigned long\">watchId</var> from\n                  <var data-type=\"List\">watchIDs</var>."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-5\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n                  <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-permission_denied\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-permission_denied-3\"><code>PERMISSION_DENIED</code></a>."
                },
                {
                  "html": "Terminate this algorithm."
                }
              ]
            },
            {
              "html": "Wait to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-acquire-a-position\" class=\"internalDFN\" id=\"ref-for-dfn-acquire-a-position-3\">acquire a position</a> passing <var data-type=\"PositionCallback\">successCallback</var>,\n              <var data-type=\"PositionErrorCallback?\">errorCallback</var>, <var data-type=\"PositionOptions\">options</var>, and <var data-type=\"unsigned long\">watchId</var>."
            },
            {
              "html": "If <var data-type=\"unsigned long\">watchId</var> was not passed, terminate this algorithm."
            },
            {
              "html": "While <var data-type=\"List\">watchIDs</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-index-term-contains-for-list-1\">contains</a> <var data-type=\"unsigned long\">watchId</var>:",
              "rationale": "wait",
              "steps": [
                {
                  "html": "<span id=\"wait-for-change\">Wait for a significant change of\n                    geographic position</span>. What constitutes a significant\n                    change of geographic position is left to the\n                    implementation. User agents <em class=\"rfc2119\">MAY</em> impose a rate limit on how\n                    frequently position changes are reported. <ins cite=\"#a4\">User agents <em class=\"rfc2119\">MUST</em> consider invoking <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-set-emulated-position-data\" class=\"internalDFN\" id=\"ref-for-dfn-set-emulated-position-data-1\">set emulated position data</a> as a significant change.</ins>"
                },
                {
                  "html": "If <var data-type=\"Document\">document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-index-term-fully-active-for-document-5\">fully active</a> or\n                  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-index-term-visibility-state-for-document-3\">visibility state</a> is not \"visible\", go back to\n                  the previous step and again <a href=\"https://www.w3.org/TR/geolocation/#wait-for-change\">wait\n                  for a significant change of geographic position</a>."
                },
                {
                  "html": "Wait to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-acquire-a-position\" class=\"internalDFN\" id=\"ref-for-dfn-acquire-a-position-4\">acquire a position</a> passing <var data-type=\"PositionCallback\">successCallback</var>,\n                  <var data-type=\"PositionErrorCallback?\">errorCallback</var>, <var data-type=\"PositionOptions\">options</var>, and <var data-type=\"unsigned long\">watchId</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "acquire a position",
      "href": "https://www.w3.org/TR/geolocation/#dfn-acquire-a-position",
      "html": "To <dfn data-local-lt=\"acquiring a position|acquire a position\" id=\"dfn-acquire-a-position\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">acquire a position</dfn>,\n          passing <a data-link-type=\"idl\" data-lt=\"PositionCallback\" href=\"https://www.w3.org/TR/geolocation/#dom-positioncallback\" class=\"internalDFN\" id=\"ref-for-dom-positioncallback-4\"><code>PositionCallback</code></a> <var data-type=\"PositionCallback\">successCallback</var>, a\n          <a data-link-type=\"idl\" data-lt=\"PositionErrorCallback\" href=\"https://www.w3.org/TR/geolocation/#dom-positionerrorcallback\" class=\"internalDFN\" id=\"ref-for-dom-positionerrorcallback-4\"><code>PositionErrorCallback?</code></a> <var data-type=\"PositionErrorCallback?\">errorCallback</var>,\n          <a data-link-type=\"idl\" data-lt=\"PositionOptions\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-6\"><code>PositionOptions</code></a> <var data-type=\"PositionOptions\">options</var>, and an optional\n          <var data-type=\"unsigned long\">watchId</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var data-type=\"unsigned long\">watchId</var> was passed and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-8\">this</a>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[watchIDs]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-watchids\" class=\"internalDFN\" id=\"ref-for-dfn-watchids-4\"><code>[[watchIDs]]</code></a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-index-term-contains-for-list-2\">contain</a> <var data-type=\"unsigned long\">watchId</var>,\n          terminate this algorithm."
        },
        {
          "html": "Let <var data-type=\"EpochTimeStamp\">acquisitionTime</var> be a new <a data-link-type=\"typedef\" data-lt=\"EpochTimeStamp\" href=\"https://www.w3.org/TR/hr-time-3/#dom-epochtimestamp\" id=\"ref-for-index-term-epochtimestamp-1\"><code>EpochTimeStamp</code></a>\n          that represents now."
        },
        {
          "html": "Let <var>timeoutTime</var> be the sum of <var data-type=\"EpochTimeStamp\">acquisitionTime</var> and\n          <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-timeout\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-timeout-2\"><code>timeout</code></a>."
        },
        {
          "html": "Let <var data-type=\"GeolocationPosition\">cachedPosition</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-9\">this</a>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[cachedPosition]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-cachedposition\" class=\"internalDFN\" id=\"ref-for-dfn-cachedposition-2\"><code>[[cachedPosition]]</code></a>."
        },
        {
          "html": "Create an implementation-specific <var>timeout</var> task that elapses at\n          <var>timeoutTime</var>, during which it tries to acquire the device's position\n          by running the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>permission</var> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-getting-the-current-permission-state\" id=\"ref-for-index-term-get-the-current-permission-state-1\">get the current permission state</a> of\n              <a href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-geolocation-2\"><code>\"geolocation\"</code></a>."
            },
            {
              "html": "If <var>permission</var> is \"denied\":",
              "rationale": "stop",
              "steps": [
                {
                  "html": "Stop <var>timeout</var>."
                },
                {
                  "html": "Do the <a href=\"https://www.w3.org/TR/geolocation/#permission-denied\">user or system denied\n                  permission</a> failure case step."
                }
              ]
            },
            {
              "html": "If <var>permission</var> is \"granted\":",
              "rationale": "check",
              "steps": [
                {
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var>emulatedPositionData</var> be <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-get-emulated-position-data\" class=\"internalDFN\" id=\"ref-for-dfn-get-emulated-position-data-1\">get emulated position data</a> passing <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-10\">this</a>."
                    },
                    {
                      "html": "If <var>emulatedPositionData</var> is not null:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>emulatedPositionData</var> is a\n                          <a data-link-type=\"idl\" data-lt=\"GeolocationPositionError\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-4\"><code>GeolocationPositionError</code></a>:",
                          "rationale": "call",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-6\">Call back with error</a> passing\n                              <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n                              <var>emulatedPositionData</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-code\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-code-1\"><code>code</code></a>."
                            },
                            {
                              "html": "Terminate this algorithm."
                            }
                          ]
                        },
                        {
                          "html": "Let <var>position</var> be <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-a-new-geolocationposition\" class=\"internalDFN\" id=\"ref-for-dfn-a-new-geolocationposition-1\">a new <code>GeolocationPosition</code></a>\n                          passing <var>emulatedPositionData</var>, <var data-type=\"EpochTimeStamp\">acquisitionTime</var> and\n                          <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-enablehighaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-enablehighaccuracy-2\"><code>enableHighAccuracy</code></a>."
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-index-term-queue-a-task-1\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-geolocation-task-source-1\">geolocation task source</a> with a step that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-index-term-invokes-1\">invokes</a>\n                          <var data-type=\"PositionCallback\">successCallback</var> with « <var>position</var> » and \"<code>report</code>\"."
                        },
                        {
                          "html": "Terminate this algorithm."
                        }
                      ]
                    }
                  ],
                  "html": "<ins cite=\"#a4\">Check if an emulated position should be\n                    used by running the following steps:\n                    </ins>"
                },
                {
                  "html": "Let <var>position</var> be null."
                },
                {
                  "html": "If <var data-type=\"GeolocationPosition\">cachedPosition</var> is not null, and\n                  <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-maximumage\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-maximumage-2\"><code>maximumAge</code></a> is greater than 0:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"long\">cacheTime</var> be <var data-type=\"EpochTimeStamp\">acquisitionTime</var> minus the\n                      value of the <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-maximumage\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-maximumage-3\"><code>maximumAge</code></a>\n                      member."
                    },
                    {
                      "rationale": "queue",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-index-term-queue-a-task-2\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-geolocation-task-source-2\">geolocation task source</a> with a step that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-index-term-invokes-2\">invokes</a>\n                          <var data-type=\"PositionCallback\">successCallback</var> with « <var data-type=\"GeolocationPosition\">cachedPosition</var> » and\n                          \"<code>report</code>\"."
                        },
                        {
                          "html": "Terminate this algorithm."
                        }
                      ],
                      "html": "If <var data-type=\"GeolocationPosition\">cachedPosition</var>'s\n                        <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition-timestamp\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-timestamp-1\"><code>timestamp</code></a>'s value is greater\n                        than <var data-type=\"long\">cacheTime</var>, and\n                        <var data-type=\"GeolocationPosition\">cachedPosition</var>.<a data-link-type=\"attribute\" data-lt=\"[[isHighAccuracy]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-ishighaccuracy\" class=\"internalDFN\" id=\"ref-for-dfn-ishighaccuracy-1\"><code>[[isHighAccuracy]]</code></a>\n                        equals\n                        <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-enablehighaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-enablehighaccuracy-3\"><code>enableHighAccuracy</code></a><del cite=\"#c8\">,\n                        set <var>position</var> to <var data-type=\"GeolocationPosition\">cachedPosition</var>.</del> <ins cite=\"#c8\">:\n                        </ins>"
                    }
                  ]
                },
                {
                  "html": "Otherwise, if <var>position</var> is not <var data-type=\"GeolocationPosition\">cachedPosition</var>, try to\n                  acquire position data from the underlying system, optionally\n                  taking into consideration the value of\n                  <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-enablehighaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-enablehighaccuracy-4\"><code>enableHighAccuracy</code></a> during\n                  acquisition."
                },
                {
                  "html": "If the <var>timeout</var> elapses during acquisition, or acquiring\n                  the device's position results in failure:",
                  "rationale": "stop",
                  "steps": [
                    {
                      "html": "Stop the <var>timeout</var>."
                    },
                    {
                      "html": "Go to <a href=\"https://www.w3.org/TR/geolocation/#errors-reasons\">dealing with\n                      failures</a>."
                    },
                    {
                      "html": "Terminate this algorithm."
                    }
                  ]
                },
                {
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var>positionData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-index-term-map-2\">map</a> with the following\n                      name/value pairs based on the acquired position data:\n                        <dl data-sort=\"\"><dt>\n                            \"accuracy\"\n                          </dt>\n                          <dd>\n                            A non-negative <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-1\"><code>double</code></a> that represents the\n                            accuracy value indicating the 95% confidence level\n                            in meters. Accuracy measures how close the measured\n                            coordinates are to the true position.\n                          </dd>\n                          <dt>\n                            \"altitude\"\n                          </dt>\n                          <dd>\n                            A <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-2\"><code>double?</code></a> that represents the altitude in\n                            meters above the [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/geolocation/#bib-wgs84\" title=\"World Geodetic System 1984 (WGS 84)\">WGS84</a></cite>] ellipsoid, or <code>null</code> if\n                            not available. Altitude measures the height above\n                            sea level.\n                          </dd>\n                          <dt>\n                            \"altitudeAccuracy\"\n                          </dt>\n                          <dd>\n                            A non-negative <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-3\"><code>double?</code></a> that represents the\n                            altitude accuracy, or <code>null</code> if not available,\n                            indicating the 95% confidence level in meters.\n                            Altitude accuracy measures how close the measured\n                            altitude is to the true altitude.\n                          </dd>\n                          <dt>\n                            \"heading\"\n                          </dt>\n                          <dd>\n                            A <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-4\"><code>double?</code></a> that represents the heading in\n                            degrees, or <code>null</code> if not available or the device\n                            is stationary. Heading measures the direction in\n                            which the device is moving relative to true north.\n                          </dd><dt>\n                            \"latitude\"\n                          </dt>\n                          <dd>\n                            A <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-5\"><code>double</code></a> that represents the latitude\n                            coordinates on the Earth's surface in degrees,\n                            using the [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/geolocation/#bib-wgs84\" title=\"World Geodetic System 1984 (WGS 84)\">WGS84</a></cite>] coordinate system. Latitude\n                            measures how far north or south a point is from the\n                            Equator.\n                          </dd>\n                          <dt>\n                            \"longitude\"\n                          </dt>\n                          <dd>\n                            A <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-6\"><code>double</code></a> that represents the longitude\n                            coordinates on the Earth's surface in degrees,\n                            using the [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/geolocation/#bib-wgs84\" title=\"World Geodetic System 1984 (WGS 84)\">WGS84</a></cite>] coordinate system. Longitude\n                            measures how far east or west a point is from the\n                            Prime Meridian.\n                          </dd>\n                          <dt>\n                            \"speed\"\n                          </dt>\n                          <dd>\n                            A non-negative <a data-link-type=\"interface\" data-lt=\"double\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-index-term-double-type-7\"><code>double?</code></a> that represents the\n                            speed in meters per second, or <code>null</code> if not\n                            available. Speed measures how fast the device is\n                            moving.\n                          </dd>\n                          </dl>"
                    },
                    {
                      "html": "Set <var>position</var> to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-a-new-geolocationposition\" class=\"internalDFN\" id=\"ref-for-dfn-a-new-geolocationposition-2\">a new <code>GeolocationPosition</code></a>\n                      passing <var>positionData</var>, <var data-type=\"EpochTimeStamp\">acquisitionTime</var> and\n                      <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-enablehighaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-enablehighaccuracy-5\"><code>enableHighAccuracy</code></a>."
                    },
                    {
                      "html": "Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-11\">this</a>'s <a data-link-type=\"attribute\" data-lt=\"[[cachedPosition]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-cachedposition\" class=\"internalDFN\" id=\"ref-for-dfn-cachedposition-3\"><code>[[cachedPosition]]</code></a> to\n                      <var>position</var>."
                    }
                  ],
                  "html": "If acquiring the position data from the\n                  system succeeds:\n                    <ins cite=\"#c9\">\n                    </ins> <del cite=\"#c9\">\n                    </del>",
                  "additional": [
                    {
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set <var>position</var> to <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-a-new-geolocationposition\" class=\"internalDFN\" id=\"ref-for-dfn-a-new-geolocationposition-3\">a new <code>GeolocationPosition</code></a>\n                      passing <var data-type=\"EpochTimeStamp\">acquisitionTime</var> and\n                      <var data-type=\"PositionOptions\">options</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-positionoptions-enablehighaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-positionoptions-enablehighaccuracy-6\"><code>enableHighAccuracy</code></a>."
                        },
                        {
                          "html": "Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-index-term-this-12\">this</a>'s <a data-link-type=\"attribute\" data-lt=\"[[cachedPosition]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-cachedposition\" class=\"internalDFN\" id=\"ref-for-dfn-cachedposition-4\"><code>[[cachedPosition]]</code></a> to\n                      <var>position</var>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Stop the <var>timeout</var>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-index-term-queue-a-task-3\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-geolocation-task-source-3\">geolocation task source</a> with\n                  a step that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-index-term-invokes-3\">invokes</a> <var data-type=\"PositionCallback\">successCallback</var> with « <var>position</var> »\n                  and \"<code>report</code>\"."
                }
              ]
            }
          ],
          "additional": [
            {
              "html": "Create an implementation-specific <var>timeout</var> task that elapses at\n          <var>timeoutTime</var>, during which it tries to acquire the device's position\n          by running the following steps:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "Dealing with failures:",
                      "html": "If acquiring a position fails, do one of the following\n                  based on the condition that matches the failure:",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "User or system denied permission:",
                              "html": "<p>\n                          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-7\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n                          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-permission_denied\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-permission_denied-4\"><code>PERMISSION_DENIED</code></a>.\n                        </p>"
                            },
                            {
                              "case": "Timeout elapsed:",
                              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-8\">Call back with error</a> with <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n                        <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-timeout\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-timeout-1\"><code>TIMEOUT</code></a>."
                            },
                            {
                              "case": "Data acquisition error or any other reason:",
                              "html": "<a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-call-back-with-error\" class=\"internalDFN\" id=\"ref-for-dfn-call-back-with-error-9\">Call back with error</a> passing <var data-type=\"PositionErrorCallback?\">errorCallback</var> and\n                        <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-position_unavailable\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-position_unavailable-3\"><code>POSITION_UNAVAILABLE</code></a>."
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "call back with error",
      "href": "https://www.w3.org/TR/geolocation/#dfn-call-back-with-error",
      "html": "When instructed to <dfn id=\"dfn-call-back-with-error\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">call back with error</dfn>, given an\n          <a data-link-type=\"idl\" data-lt=\"PositionErrorCallback\" href=\"https://www.w3.org/TR/geolocation/#dom-positionerrorcallback\" class=\"internalDFN\" id=\"ref-for-dom-positionerrorcallback-5\"><code>PositionErrorCallback?</code></a> <var data-type=\"PositionErrorCallback?\">callback</var> and an\n          <a data-link-type=\"interface\" data-lt=\"unsigned short\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-index-term-unsigned-short-type-1\"><code>unsigned short</code></a> <var data-type=\"unsigned short\">code</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var data-type=\"PositionErrorCallback?\">callback</var> is null, return."
        },
        {
          "html": "Let <var data-type=\"GeolocationPositionError\">error</var> be a newly created\n          <a data-link-type=\"idl\" data-lt=\"GeolocationPositionError\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-5\"><code>GeolocationPositionError</code></a> instance whose\n          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-code\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-code-2\"><code>code</code></a> attribute is initialized to <var data-type=\"unsigned short\">code</var>."
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-index-term-queue-a-task-4\">Queue a task</a> on the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-geolocation-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-geolocation-task-source-4\">geolocation task source</a> with a step\n          that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-index-term-invokes-4\">invokes</a> <var data-type=\"PositionErrorCallback?\">callback</var> with « <var data-type=\"GeolocationPositionError\">error</var> » and \"<code>report</code>\"."
        }
      ]
    },
    {
      "name": "A new GeolocationPosition",
      "href": "https://www.w3.org/TR/geolocation/#dfn-a-new-geolocationposition",
      "html": "<dfn id=\"dfn-a-new-geolocationposition\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">A new <code>GeolocationPosition</code></dfn> is constructed with <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-index-term-map-4\">map</a>\n          <var>positionData</var>, <a data-link-type=\"typedef\" data-lt=\"EpochTimeStamp\" href=\"https://www.w3.org/TR/hr-time-3/#dom-epochtimestamp\" id=\"ref-for-index-term-epochtimestamp-3\"><code>EpochTimeStamp</code></a> <var data-type=\"EpochTimeStamp\">timestamp</var> and\n          boolean <var>isHighAccuracy</var> by performing the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"GeolocationCoordinates\">coords</var> be a newly created\n          <a data-link-type=\"idl\" data-lt=\"GeolocationCoordinates\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-6\"><code>GeolocationCoordinates</code></a> instance."
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-index-term-for-each-for-map-1\">For each</a> <var>key</var> → <var>value</var> in <var>positionData</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var data-type=\"GeolocationCoordinates\">coords</var>'s attribute named <var>key</var> to <var>value</var>."
            }
          ]
        },
        {
          "html": "Return a newly created <a data-link-type=\"idl\" data-lt=\"GeolocationPosition\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-8\"><code>GeolocationPosition</code></a> instance with its\n          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition-coords\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-coords-2\"><code>coords</code></a> attribute initialized to <var data-type=\"GeolocationCoordinates\">coords</var> and\n          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition-timestamp\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-timestamp-3\"><code>timestamp</code></a> attribute initialized to\n          <var data-type=\"EpochTimeStamp\">timestamp</var>, and its <a data-link-type=\"attribute\" data-lt=\"[[isHighAccuracy]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-ishighaccuracy\" class=\"internalDFN\" id=\"ref-for-dfn-ishighaccuracy-2\"><code>[[isHighAccuracy]]</code></a>\n          internal slot set to <var>isHighAccuracy</var>."
        }
      ]
    },
    {
      "html": "<strong>A new <code>GeolocationPosition</code></strong> is constructed with\n          <a data-link-type=\"typedef\" data-lt=\"EpochTimeStamp\" href=\"https://www.w3.org/TR/hr-time-3/#dom-epochtimestamp\" id=\"ref-for-index-term-epochtimestamp-4\"><code>EpochTimeStamp</code></a> <var data-type=\"EpochTimeStamp\">timestamp</var> and boolean\n          <var>isHighAccuracy</var> by performing the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"GeolocationCoordinates\">coords</var> be a newly created\n          <a data-link-type=\"idl\" data-lt=\"GeolocationCoordinates\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-7\"><code>GeolocationCoordinates</code></a> instance:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-latitude\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-latitude-2\"><code>latitude</code></a>\n              attribute to a geographic coordinate in decimal degrees."
            },
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-longitude\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-longitude-2\"><code>longitude</code></a>\n              attribute to a geographic coordinate in decimal degrees."
            },
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-accuracy\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-accuracy-2\"><code>accuracy</code></a>\n              attribute to a non-negative real number. The value <em class=\"rfc2119\">SHOULD</em>\n              correspond to a 95% confidence level with respect to the\n              longitude and latitude values."
            },
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-altitude\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-altitude-2\"><code>altitude</code></a>\n              attribute in meters above the [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://www.w3.org/TR/geolocation/#bib-wgs84\" title=\"World Geodetic System 1984 (WGS 84)\">WGS84</a></cite>] ellipsoid, or <code>null</code> if\n              the implementation cannot provide altitude information."
            },
            {
              "html": "Initialize <var>coord</var>'s\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-altitudeaccuracy\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-altitudeaccuracy-2\"><code>altitudeAccuracy</code></a> attribute as\n              non-negative real number, or to <code>null</code> if the implementation\n              cannot provide altitude information. If the altitude accuracy\n              information is provided, it <em class=\"rfc2119\">SHOULD</em> correspond to a 95% confidence\n              level."
            },
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-speed\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-speed-2\"><code>speed</code></a>\n              attribute to a non-negative real number, or as <code>null</code> if the\n              implementation cannot provide speed information."
            },
            {
              "html": "Initialize <var>coord</var>'s <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-heading\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-heading-2\"><code>heading</code></a>\n              attribute in degrees, or <code>null</code> if the implementation cannot\n              provide heading information. If the hosting device is stationary\n              (i.e., the value of the <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-speed\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-speed-3\"><code>speed</code></a>\n              attribute is 0), then initialize the\n              <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates-heading\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-heading-3\"><code>heading</code></a> to <code>NaN</code>."
            }
          ]
        },
        {
          "html": "Return a newly created <a data-link-type=\"idl\" data-lt=\"GeolocationPosition\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-9\"><code>GeolocationPosition</code></a> instance with its\n          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition-coords\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-coords-3\"><code>coords</code></a> attribute initialized to <var data-type=\"GeolocationCoordinates\">coords</var> and\n          <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationposition-timestamp\" class=\"internalDFN\" id=\"ref-for-dom-geolocationposition-timestamp-4\"><code>timestamp</code></a> attribute initialized to\n          <var data-type=\"EpochTimeStamp\">timestamp</var>, and its <a data-link-type=\"attribute\" data-lt=\"[[isHighAccuracy]]\" href=\"https://www.w3.org/TR/geolocation/#dfn-ishighaccuracy\" class=\"internalDFN\" id=\"ref-for-dfn-ishighaccuracy-3\"><code>[[isHighAccuracy]]</code></a>\n          internal slot set to <var>isHighAccuracy</var>."
        }
      ]
    },
    {
      "name": "set emulated position data",
      "href": "https://www.w3.org/TR/geolocation/#dfn-set-emulated-position-data",
      "html": "To <dfn class=\"export\" data-export=\"\" id=\"dfn-set-emulated-position-data\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">set emulated position data</dfn>, given\n        <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-index-term-navigable-1\">navigable</a> <var>navigable</var> and an <var>emulatedPositionData</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Assert <var>emulatedPositionData</var> is either null, a\n        <a data-link-type=\"idl\" data-lt=\"GeolocationCoordinates\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationcoordinates\" class=\"internalDFN\" id=\"ref-for-dom-geolocationcoordinates-9\"><code>GeolocationCoordinates</code></a>, or a <a data-link-type=\"idl\" data-lt=\"GeolocationPositionError\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror\" class=\"internalDFN\" id=\"ref-for-dom-geolocationpositionerror-10\"><code>GeolocationPositionError</code></a>."
        },
        {
          "html": "Let <var>traversable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-index-term-top-level-traversable-for-navigable-1\">top-level traversable</a>."
        },
        {
          "html": "If <var>traversable</var> is not null:",
          "rationale": ".algorithm",
          "steps": [
            {
              "html": "Set <var>traversable</var>'s associated <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-emulated-position-data\" class=\"internalDFN\" id=\"ref-for-dfn-emulated-position-data-1\">emulated position data</a> to\n            <var>emulatedPositionData</var>."
            },
            {
              "html": "User agents <em class=\"rfc2119\">MUST</em> consider this as a \"significant change\" in the\n            <a href=\"https://www.w3.org/TR/geolocation/#wait-for-change\">wait for a significant change of\n            geographic position</a> step."
            }
          ]
        }
      ]
    },
    {
      "name": "get emulated position data",
      "href": "https://www.w3.org/TR/geolocation/#dfn-get-emulated-position-data",
      "html": "To <dfn id=\"dfn-get-emulated-position-data\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">get emulated position data</dfn>, given <a data-link-type=\"idl\" data-lt=\"Geolocation\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocation\" class=\"internalDFN\" id=\"ref-for-dom-geolocation-4\"><code>Geolocation</code></a>\n        <var>geolocation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var>navigable</var> be <var>geolocation</var>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-index-term-relevant-global-object-6\">relevant global object</a>'s\n        <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-index-term-associated-document-6\">associated <code>Document</code></a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-index-term-node-navigable-1\">node navigable</a>."
        },
        {
          "html": "If <var>navigable</var> is null, return null."
        },
        {
          "html": "Let <var>traversable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-index-term-top-level-traversable-for-navigable-2\">top-level traversable</a>."
        },
        {
          "html": "If <var>traversable</var> is null, return null."
        },
        {
          "html": "Return <var>traversable</var>'s associated <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/geolocation/#dfn-emulated-position-data\" class=\"internalDFN\" id=\"ref-for-dfn-emulated-position-data-2\">emulated position data</a>."
        }
      ]
    }
  ]
}