{
  "spec": {
    "title": "Trusted Types",
    "url": "https://www.w3.org/TR/trusted-types/"
  },
  "algorithms": [
    {
      "name": "TrustedTypePolicyFactory/getPropertyType(tagName, property, elementNs)",
      "href": "https://www.w3.org/TR/trusted-types/#dom-trustedtypepolicyfactory-getpropertytype",
      "html": "This function returns the result of the following algorithm:",
      "rationale": "set",
      "steps": [
        {
          "html": "<p>Set <var>localName</var> to <var>tagName</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lowercase\" id=\"ref-for-ascii-lowercase\">ASCII lowercase</a>.</p>"
        },
        {
          "html": "<p>If <var>elementNs</var> is null or an empty string, set <var>elementNs</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#html-namespace\" id=\"ref-for-html-namespace\">HTML namespace</a>.</p>"
        },
        {
          "html": "<p>Let <var>interface</var> be the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-interface\" id=\"ref-for-concept-element-interface\">element interface</a> for <var>localName</var> and <var>elementNs</var>.</p>"
        },
        {
          "html": "<p>Let <var>expectedType</var> be null.</p>"
        },
        {
          "html": "<p>Find the row in the following table, where the first column is \"*\" or <var>interface</var>’s name, and <var>property</var> is in the second column.\nIf a matching row is found, set <var>expectedType</var> to the interface’s name of the value of the third column.</p>\n        <table>\n         <thead>\n          <tr>\n           <th>Element\n           </th><th>Property name\n           </th><th>TrustedType\n  \n         </th></tr></thead><tbody>\n          <tr>\n           <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement\" id=\"ref-for-htmliframeelement\">HTMLIFrameElement</a></code>\n           </td><td>\"srcdoc\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedhtml\" id=\"ref-for-trustedhtml④\">TrustedHTML</a></code>\n    \n          </td></tr><tr>\n           <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement\">HTMLScriptElement</a></code>\n           </td><td>\"innerText\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript③\">TrustedScript</a></code>\n    \n          </td></tr><tr>\n           <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement①\">HTMLScriptElement</a></code>\n           </td><td>\"src\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl②\">TrustedScriptURL</a></code>\n    \n          </td></tr><tr>\n           <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement②\">HTMLScriptElement</a></code>\n           </td><td>\"text\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript④\">TrustedScript</a></code>\n    \n          </td></tr><tr>\n           <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement③\">HTMLScriptElement</a></code>\n           </td><td>\"textContent\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript⑤\">TrustedScript</a></code>\n    \n          </td></tr><tr>\n           <td>\"*\"\n           </td><td>\"innerHTML\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedhtml\" id=\"ref-for-trustedhtml⑤\">TrustedHTML</a></code>\n    \n          </td></tr><tr>\n           <td>\"*\"\n           </td><td>\"outerHTML\"\n           </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedhtml\" id=\"ref-for-trustedhtml⑥\">TrustedHTML</a></code>\n  \n        </td></tr></tbody></table>"
        },
        {
          "html": "<p>Return <var>expectedType</var>.</p>"
        }
      ]
    },
    {
      "name": "TrustedTypePolicyFactory/getAttributeType(tagName, attribute, elementNs, attrNs)",
      "href": "https://www.w3.org/TR/trusted-types/#dom-trustedtypepolicyfactory-getattributetype",
      "html": "This function returns the result of the following algorithm:",
      "rationale": "set",
      "steps": [
        {
          "html": "<p>Set <var>localName</var> to <var>tagName</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lowercase\" id=\"ref-for-ascii-lowercase①\">ASCII lowercase</a>.</p>"
        },
        {
          "html": "<p>Set <var>attribute</var> to <var>attribute</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lowercase\" id=\"ref-for-ascii-lowercase②\">ASCII lowercase</a>.</p>"
        },
        {
          "html": "<p>If <var>elementNs</var> is null or an empty string, set <var>elementNs</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#html-namespace\" id=\"ref-for-html-namespace①\">HTML namespace</a>.</p>"
        },
        {
          "html": "<p>If <var>attrNs</var> is an empty string, set <var>attrNs</var> to null.</p>"
        },
        {
          "html": "<p>Let <var>interface</var> be the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-interface\" id=\"ref-for-concept-element-interface①\">element interface</a> for <var>localName</var> and <var>elementNs</var>.</p>"
        },
        {
          "html": "<p>Let <var>expectedType</var> be null.</p>"
        },
        {
          "html": "<p>Set <var>attributeData</var> to the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-data-for-attribute%E2%91%A0\" id=\"ref-for-get-trusted-type-data-for-attribute①\">get trusted type data for attribute</a> algorithm, with the following arguments:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>interface</var> as <var>element</var></p>\n         </li><li data-md=\"\">\n          <p><var>attribute</var></p>\n         </li><li data-md=\"\">\n          <p><var>attrNs</var></p>\n        </li></ul>"
        },
        {
          "html": "<p>If <var>attributeData</var> is not null, then set <var>expectedType</var> to the interface’s name of the value of the fourth member of <var>attributeData</var>.</p>"
        },
        {
          "html": "<p>Return <var>expectedType</var>.</p>"
        }
      ]
    },
    {
      "name": "create a trusted type policy",
      "href": "https://www.w3.org/TR/trusted-types/#create-a-trusted-type-policy",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-trusted-type-policy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a trusted type policy</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory\" id=\"ref-for-trustedtypepolicyfactory③\">TrustedTypePolicyFactory</a></code> (<var>factory</var>),\na string (<var>policyName</var>), <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dictdef-trustedtypepolicyoptions\" id=\"ref-for-dictdef-trustedtypepolicyoptions④\">TrustedTypePolicyOptions</a></code> dictionary (<var>options</var>), and a\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a> (<var>global</var>) run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>allowedByCSP</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#should-trusted-type-policy-creation-be-blocked-by-content-security-policy\" id=\"ref-for-should-trusted-type-policy-creation-be-blocked-by-content-security-policy\">should Trusted Type policy creation be blocked by content security policy?</a> algorithm with <var>global</var>,\n<var>policyName</var> and <var>factory</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory-created-policy-names\" id=\"ref-for-trustedtypepolicyfactory-created-policy-names\">created policy names</a> value.</p>"
        },
        {
          "html": "<p>If <var>allowedByCSP</var> is <code>\"Blocked\"</code>, throw a TypeError and abort further steps.</p>"
        },
        {
          "html": "<p>If <var>policyName</var> is <code>default</code> and the <var>factory</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory-default-policy\" id=\"ref-for-trustedtypepolicyfactory-default-policy①\">default policy</a>\nvalue is not null, throw a TypeError and abort further steps.</p>"
        },
        {
          "html": "<p>Let <var>policy</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicy\" id=\"ref-for-trustedtypepolicy①⓪\">TrustedTypePolicy</a></code> object.</p>"
        },
        {
          "html": "<p>Set <var>policy</var>’s <code>name</code> property value to <var>policyName</var>.</p>"
        },
        {
          "html": "<p>Set <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicy-options\" id=\"ref-for-trustedtypepolicy-options\">options</a> value to «[\n  \"createHTML\" -&gt; <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-trustedtypepolicyoptions-createhtml\" id=\"ref-for-dom-trustedtypepolicyoptions-createhtml\">createHTML</a></code>\",\n  \"createScript\" -&gt; <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-trustedtypepolicyoptions-createscript\" id=\"ref-for-dom-trustedtypepolicyoptions-createscript\">createScript</a></code>\",\n  \"createScriptURL\" -&gt; <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-trustedtypepolicyoptions-createscripturl\" id=\"ref-for-dom-trustedtypepolicyoptions-createscripturl\">createScriptURL</a></code>\"\n]».</p>"
        },
        {
          "html": "<p>If the <var>policyName</var> is <code>default</code>, set the <var>factory</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory-default-policy\" id=\"ref-for-trustedtypepolicyfactory-default-policy②\">default policy</a> value to <var>policy</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>policyName</var> to <var>factory</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory-created-policy-names\" id=\"ref-for-trustedtypepolicyfactory-created-policy-names①\">created policy names</a>.</p>"
        },
        {
          "html": "<p>Return <var>policy</var>.</p>"
        }
      ]
    },
    {
      "name": "create a trusted type",
      "href": "https://www.w3.org/TR/trusted-types/#create-a-trusted-type",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-trusted-type\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a trusted type</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicy\" id=\"ref-for-trustedtypepolicy①①\">TrustedTypePolicy</a></code> <var>policy</var>, a type name <var>trustedTypeName</var>,\na string <var>value</var> and a list <var>arguments</var>, perform the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>policyValue</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-policy-value\" id=\"ref-for-get-trusted-type-policy-value\">get trusted type policy value</a> with the same arguments as this algorithm and additionally true as <var>throwIfMissing</var>.</p>"
        },
        {
          "html": "<p>If the algorithm threw an error, rethrow the error and abort the following steps.</p>"
        },
        {
          "html": "<p>Let <var>dataString</var> be the result of stringifying <var>policyValue</var>.</p>"
        },
        {
          "html": "<p>If <var>policyValue</var> is null or undefined, set <var>dataString</var> to the empty string.</p>"
        },
        {
          "html": "<p>Return a new instance of an interface with a type\nname <var>trustedTypeName</var>, with its associated data value set to <var>dataString</var>.</p>"
        }
      ]
    },
    {
      "name": "get trusted type policy value",
      "href": "https://www.w3.org/TR/trusted-types/#get-trusted-type-policy-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-trusted-type-policy-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get trusted type policy value</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicy\" id=\"ref-for-trustedtypepolicy①②\">TrustedTypePolicy</a></code> <var>policy</var>, a type name <var>trustedTypeName</var>,\na string <var>value</var>, a list <var>arguments</var>, and a boolean <var>throwIfMissing</var>, perform the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>functionName</var> be a function name for the given <var>trustedTypeName</var>,\nbased on the following table:</p>\n     <table>\n      <tbody>\n       <tr>\n        <th>Function name\n        </th><th>Trusted Type name \n       </th></tr><tr>\n        <td>\"createHTML\"\n        </td><td>\"TrustedHTML\"\n       </td></tr><tr>\n        <td>\"createScript\"\n        </td><td>\"TrustedScript\"\n       </td></tr><tr>\n        <td>\"createScriptURL\"\n        </td><td>\"TrustedScriptURL\"\n     </td></tr></tbody></table>"
        },
        {
          "html": "<p>Let <var>function</var> be <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicy-options\" id=\"ref-for-trustedtypepolicy-options①\">options</a>[<var>functionName</var>].</p>"
        },
        {
          "html": "If <var>function</var> is <code>null</code>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>throwIfMissing</var> throw a TypeError.</p>"
            },
            {
              "html": "<p>Else return <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>args</var> be « <var>value</var> ».</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> each item in <var>arguments</var> to <var>args</var>.</p>"
        },
        {
          "html": "<p>Let <var>policyValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">invoking</a> <var>function</var> with\n<var>args</var> and <code>\"rethrow\"</code>.</p>"
        },
        {
          "html": "<p>Return <var>policyValue</var>.</p>"
        }
      ]
    },
    {
      "name": "get trusted type compliant string",
      "href": "https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-trusted-type-compliant-string\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get trusted type compliant string</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#typedefdef-trustedtype\" id=\"ref-for-typedefdef-trustedtype\">TrustedType</a></code> type (<var>expectedType</var>), a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a> (<var>global</var>),\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#typedefdef-trustedtype\" id=\"ref-for-typedefdef-trustedtype①\">TrustedType</a></code> or a string (<var>input</var>), a string (<var>sink</var>) and a string (<var>sinkGroup</var>), run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>input</var> is an instance of <var>expectedType</var>, return stringified\n<var>input</var> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>requireTrustedTypes</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#does-sink-type-require-trusted-types\" id=\"ref-for-does-sink-type-require-trusted-types\">Does sink type require trusted types?</a> algorithm,\npassing <var>global</var>, <var>sinkGroup</var>, and true.</p>"
        },
        {
          "html": "<p>If <var>requireTrustedTypes</var> is <code>false</code>, return stringified <var>input</var> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>convertedInput</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#process-value-with-a-default-policy\" id=\"ref-for-process-value-with-a-default-policy\">Process value with a default policy</a> with the same arguments as this algorithm.</p>"
        },
        {
          "html": "<p>If the algorithm threw an error, rethrow the error and abort the following steps.</p>"
        },
        {
          "html": "If <var>convertedInput</var> is <code>null</code> or <code>undefined</code>, execute the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>disposition</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#should-sink-type-mismatch-violation-be-blocked-by-content-security-policy\" id=\"ref-for-should-sink-type-mismatch-violation-be-blocked-by-content-security-policy\">should sink type mismatch violation be blocked by content security policy?</a> algorithm,\npassing <var>global</var>, stringified <var>input</var> as <var>source</var>, <var>sinkGroup</var> and <var>sink</var>.</p>"
            },
            {
              "html": "<p>If <var>disposition</var> is <code>“Allowed”</code>, return stringified <var>input</var> and abort further steps.</p>"
            },
            {
              "html": "<p>Throw a TypeError and abort further steps.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>convertedInput</var> is an instance of <var>expectedType</var>.</p>"
        },
        {
          "html": "<p>Return stringified <var>convertedInput</var>.</p>"
        }
      ]
    },
    {
      "name": "process value with a default policy",
      "href": "https://www.w3.org/TR/trusted-types/#process-value-with-a-default-policy",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-value-with-a-default-policy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process value with a default policy</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#typedefdef-trustedtype\" id=\"ref-for-typedefdef-trustedtype②\">TrustedType</a></code> type (<var>expectedType</var>), a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a> (<var>global</var>),\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#typedefdef-trustedtype\" id=\"ref-for-typedefdef-trustedtype③\">TrustedType</a></code> or a string (<var>input</var>), and a string (<var>sink</var>), run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>defaultPolicy</var> be the value of <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#window-trusted-type-policy-factory\" id=\"ref-for-window-trusted-type-policy-factory\">trusted type policy factory</a>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trustedtypepolicyfactory-default-policy\" id=\"ref-for-trustedtypepolicyfactory-default-policy③\">default policy</a>.</p>"
        },
        {
          "html": "<p>Let <var>policyValue</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-policy-value\" id=\"ref-for-get-trusted-type-policy-value①\">get trusted type policy value</a>, with the following arguments:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><var>defaultPolicy</var> as <var>policy</var></p>\n      </li><li data-md=\"\">\n       <p>stringified <var>input</var> as <var>value</var></p>\n      </li><li data-md=\"\">\n       <p><var>expectedType</var>’s type name as <var>trustedTypeName</var></p>\n      </li><li data-md=\"\">\n       <p>« <var>trustedTypeName</var>, <var>sink</var> » as <var>arguments</var></p>\n      </li><li data-md=\"\">\n       <p>false as <var>throwIfMissing</var></p>\n     </li></ul>"
        },
        {
          "html": "<p>If the algorithm threw an error, rethrow the error and abort the following steps.</p>"
        },
        {
          "html": "<p>If <var>policyValue</var> is null or undefined, return <var>policyValue</var>.</p>"
        },
        {
          "html": "<p>Let <var>dataString</var> be the result of stringifying <var>policyValue</var>.</p>"
        },
        {
          "html": "<p>Return a new instance of an interface with a type\nname <var>trustedTypeName</var>, with its associated data value set to <var>dataString</var>.</p>"
        }
      ]
    },
    {
      "name": "prepare the script text",
      "href": "https://www.w3.org/TR/trusted-types/#prepare-the-script-text",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"prepare-the-script-text\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">prepare the script text</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement④\">HTMLScriptElement</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/SVG2/interact.html#InterfaceSVGScriptElement\" id=\"ref-for-InterfaceSVGScriptElement\">SVGScriptElement</a></code> (<var>script</var>), perform the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>sink</var> be \"<code>HTMLScriptElement text</code>\" if <var>script</var> is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement⑤\">HTMLScriptElement</a></code>; otherwise \"<code>SVGScriptElement text</code>\".</p>"
        },
        {
          "html": "<p>If <var>script</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text\">script text</a> value is not equal to its <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-child-text-content\" id=\"ref-for-concept-child-text-content\">child text content</a>,\nset <var>script</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text①\">script text</a> to the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string\">get Trusted Type compliant string</a>, with the following arguments:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl④\">TrustedScriptURL</a></code> as <var>expectedType</var>,</p>\n      </li><li data-md=\"\">\n       <p><var>script</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①\">Document</a></code>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> as <var>global</var>,</p>\n      </li><li data-md=\"\">\n       <p><var>script</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-child-text-content\" id=\"ref-for-concept-child-text-content①\">child text content</a> attribute value as <var>input</var>,</p>\n      </li><li data-md=\"\">\n       <p><var>sink</var>,</p>\n      </li><li data-md=\"\">\n       <p><code>'script'</code> as <var>sinkGroup</var>.</p>\n     </li></ul>\n     <p>If the algorithm threw an error, rethrow the error.</p>"
        }
      ]
    },
    {
      "name": "get trusted type compliant attribute value",
      "href": "https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-attribute-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-trusted-type-compliant-attribute-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get trusted type compliant attribute value</dfn> given a string <var>attributeName</var>, string <var>attributeNs</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element④\">Element</a></code> <var>element</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#typedefdef-trustedtype\" id=\"ref-for-typedefdef-trustedtype④\">TrustedType</a></code> or a string <var>newValue</var>, perform the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>attributeNs</var> is the empty string, set <var>attributeNs</var> to null.</p>"
        },
        {
          "html": "<p>Set <var>attributeData</var> to the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-data-for-attribute%E2%91%A0\" id=\"ref-for-get-trusted-type-data-for-attribute①①\">get Trusted Type data for attribute</a> algorithm, with the following arguments:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><var>element</var></p>\n      </li><li data-md=\"\">\n       <p><var>attributeName</var></p>\n      </li><li data-md=\"\">\n       <p><var>attributeNs</var></p>\n     </li></ul>"
        },
        {
          "html": "If <var>attributeData</var> is null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>newValue</var> is a string, return <var>newValue</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>newValue</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedhtml\" id=\"ref-for-trustedhtml①⓪\">TrustedHTML</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript⑨\">TrustedScript</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl⑤\">TrustedScriptURL</a></code>.</p>"
            },
            {
              "html": "<p>Return <var>value</var>’s associated data.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>expectedType</var> be the value of the fourth member of <var>attributeData</var>.</p>"
        },
        {
          "html": "<p>Let <var>sink</var> be the value of the fifth member of <var>attributeData</var>.</p>"
        },
        {
          "html": "<p>Return the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string①\">get trusted type compliant string</a> with the following arguments:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><var>expectedType</var></p>\n      </li><li data-md=\"\">\n       <p><var>newValue</var> as <var>input</var></p>\n      </li><li data-md=\"\">\n       <p><var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a> as <var>global</var></p>\n      </li><li data-md=\"\">\n       <p><var>sink</var></p>\n      </li><li data-md=\"\">\n       <p>'script' as <var>sinkGroup</var></p>\n     </li></ul>"
        }
      ]
    },
    {
      "name": "get Trusted Type data for attribute",
      "href": "https://www.w3.org/TR/trusted-types/#get-trusted-type-data-for-attribute%E2%91%A0",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-trusted-type-data-for-attribute①\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get Trusted Type data for attribute</dfn> given <var>element</var>, <var>attribute</var>, <var>attributeNs</var>, perform the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be null.</p>"
        },
        {
          "html": "If <var>attributeNs</var> is null, « <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#html-namespace\" id=\"ref-for-html-namespace②\">HTML namespace</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#svg-namespace\" id=\"ref-for-svg-namespace\">SVG namespace</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#mathml-namespace\" id=\"ref-for-mathml-namespace\">MathML namespace</a> » <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-namespace\" id=\"ref-for-concept-element-namespace\">namespace</a>, and <var>attribute</var> is the name of an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#event-handler-content-attributes\" id=\"ref-for-event-handler-content-attributes①\">event handler content attribute</a>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return (<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element⑤\">Element</a></code>, null, <var>attribute</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⓪\">TrustedScript</a></code>, \"Element \" + <var>attribute</var>).</p>"
            }
          ]
        },
        {
          "html": "<p>Find the row in the following table, where <var>element</var> is in the first column, <var>attributeNs</var> is in the second column,\nand <var>attribute</var> is in the third column.\nIf a matching row is found, set <var>data</var> to that row.</p>\n     <table>\n      <thead>\n       <tr>\n        <th>Element\n        </th><th>Attribute namespace\n        </th><th>Attribute local name\n        </th><th>TrustedType\n        </th><th>Sink\n  \n      </th></tr></thead><tbody>\n       <tr>\n        <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#htmliframeelement\" id=\"ref-for-htmliframeelement①\">HTMLIFrameElement</a></code>\n        </td><td>null\n        </td><td>\"srcdoc\"\n        </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedhtml\" id=\"ref-for-trustedhtml①①\">TrustedHTML</a></code>\n        </td><td>\"HTMLIFrameElement srcdoc\"\n    \n       </td></tr><tr>\n        <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/scripting.html#htmlscriptelement\" id=\"ref-for-htmlscriptelement⑥\">HTMLScriptElement</a></code>\n        </td><td>null\n        </td><td>\"src\"\n        </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl⑥\">TrustedScriptURL</a></code>\n        </td><td>\"HTMLScriptElement src\"\n    \n       </td></tr><tr>\n        <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/SVG2/interact.html#InterfaceSVGScriptElement\" id=\"ref-for-InterfaceSVGScriptElement①\">SVGScriptElement</a></code>\n        </td><td>null\n        </td><td>\"href\"\n        </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl⑦\">TrustedScriptURL</a></code>\n        </td><td>\"SVGScriptElement href\"\n    \n       </td></tr><tr>\n        <td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/SVG2/interact.html#InterfaceSVGScriptElement\" id=\"ref-for-InterfaceSVGScriptElement②\">SVGScriptElement</a></code>\n        </td><td><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#xlink-namespace\" id=\"ref-for-xlink-namespace\">XLink namespace</a>\n        </td><td>\"href\"\n        </td><td><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl⑧\">TrustedScriptURL</a></code>\n        </td><td>\"SVGScriptElement href\"\n  \n     </td></tr></tbody></table>"
        },
        {
          "html": "<p>Return <var>data</var>.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-innertext\" id=\"ref-for-dom-htmlscriptelement-innertext①\">innerText</a></code> setter steps are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string③\">get trusted type compliant string</a> with\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⑤\">TrustedScript</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a>, the given value, <code>HTMLScriptElement innerText</code>, and\n<code>script</code>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text②\">script text</a> value to <var>value</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#set-the-inner-text-steps\" id=\"ref-for-set-the-inner-text-steps\">set the inner text steps</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a> and <var>value</var>.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-innertext\" id=\"ref-for-dom-htmlscriptelement-innertext②\">innerText</a></code> getter steps are:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#get-the-text-steps\" id=\"ref-for-get-the-text-steps\">get the text steps</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-textcontent\" id=\"ref-for-dom-htmlscriptelement-textcontent①\">textContent</a></code> setter steps are to, if the given value is null, act as if it was the\nempty string instead, and then do as described below:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string④\">get trusted type compliant string</a> with\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⑥\">TrustedScript</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>, the given value, <code>HTMLScriptElement textContent</code>, and\n<code>script</code>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text③\">script text</a> value to <var>value</var>.</p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#set-text-content\" id=\"ref-for-set-text-content\">set text content</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a> and <var>value</var>.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-textcontent\" id=\"ref-for-dom-htmlscriptelement-textcontent②\">textContent</a></code> getter steps are:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#get-text-content\" id=\"ref-for-get-text-content\">get text content</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>.</p>"
        }
      ]
    },
    {
      "html": "Update the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-text\" id=\"ref-for-dom-htmlscriptelement-text②\">text</a></code> setter steps algorithm as follows.",
      "rationale": "let",
      "steps": [
        {
          "html": "<ins>Let <var>value</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string⑤\">get trusted type compliant string</a> with\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⑦\">TrustedScript</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a>, the given value, <code>HTMLScriptElement text</code>, and\n<code>script</code>.</ins>"
        },
        {
          "html": "<ins>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text④\">script text</a> value to the given value.</ins>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#string-replace-all\" id=\"ref-for-string-replace-all\">String replace all</a> with the given value within <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>.</p>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-src\" id=\"ref-for-dom-htmlscriptelement-src②\">src</a></code> getter steps are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<ins>Let <var>element</var> be the result of running <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>’s get the element.</ins>"
        },
        {
          "html": "<ins>Let <var>contentAttributeValue</var> be the result of running <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>’s get the content attribute.</ins>"
        },
        {
          "html": "<ins>If <var>contentAttributeValue</var> is null, then return the empty string.</ins>"
        },
        {
          "html": "<ins>Let <var>urlString</var> be the result of encoding-parsing-and-serializing a URL given <var>contentAttributeValue</var>, relative to <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document①\">node document</a>.</ins>"
        },
        {
          "html": "<ins>If <var>urlString</var> is not failure, then return <var>urlString</var>.</ins>"
        },
        {
          "html": "<ins>Return <var>contentAttributeValue</var>, converted to a scalar value string.\n</ins>"
        }
      ]
    },
    {
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#dom-htmlscriptelement-src\" id=\"ref-for-dom-htmlscriptelement-src③\">src</a></code> setter steps are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<ins>Let <var>value</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#get-trusted-type-compliant-string\" id=\"ref-for-get-trusted-type-compliant-string⑥\">get trusted type compliant string</a> with\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscripturl\" id=\"ref-for-trustedscripturl①①\">TrustedScriptURL</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>, the given value, <code>HTMLScriptElement src</code>, and\n<code>script</code>.</ins>"
        },
        {
          "html": "<ins>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#attr-script-src\" id=\"ref-for-attr-script-src\">src</a> content attribute to <var>value</var>.</ins>"
        }
      ]
    },
    {
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#parsing-main-incdata\" id=\"ref-for-parsing-main-incdata\">The text insertion mode</a> algorithm as follows:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "An end tag whose tag name is \"script\"",
              "html": "<p>...</p>\n     <ins>\n      <p>Set <var>script</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text⑥\">script text</a> value to its <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-child-text-content\" id=\"ref-for-concept-child-text-content④\">child text content</a>.</p>\n     </ins>\n     <p>If the <span>active speculative HTML parser</span> is null, then <span>prepare the script\n        element</span> <var>script</var>. This might cause some script to execute, which might cause\n        <span data-x=\"dom-document-write\">new characters to be inserted into the tokenizer</span>, and\n        might cause the tokenizer to output more tokens, resulting in a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#nestedParsing\" id=\"ref-for-nestedParsing\">reentrant invocation of the parser</a>.</p>\n     <p>...</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The first few steps of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/#prepare-the-script-element\" id=\"ref-for-prepare-the-script-element\">prepare the script element</a> algorithm are modified as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>el</var>’s <a href=\"https://html.spec.whatwg.org/#already-started\" id=\"script-processing-model:already-started-3\">already started</a> is true, then return.\n  </p>"
        },
        {
          "html": "<p>Let <var>parser document</var> be <var>el</var>’s <a href=\"https://html.spec.whatwg.org/#parser-document\" id=\"script-processing-model:parser-document-2\">parser document</a>.\n  </p>"
        },
        {
          "html": "<p>Set <var>el</var>’s <a href=\"https://html.spec.whatwg.org/#parser-document\" id=\"script-processing-model:parser-document-3\">parser document</a> to null.</p>"
        },
        {
          "html": "<p>If <var>parser document</var> is non-null and <var>el</var> does not have an <code id=\"script-processing-model:attr-script-async-4\"><a href=\"https://html.spec.whatwg.org/#attr-script-async\">async</a></code> attribute, then set <var>el</var>’s <a href=\"https://html.spec.whatwg.org/#script-force-async\" id=\"script-processing-model:script-force-async-2\">force async</a> to true.</p>"
        },
        {
          "html": "<ins>\n      <p>Execute the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#prepare-the-script-text\" id=\"ref-for-prepare-the-script-text\">Prepare the script text</a> algorithm on <var>el</var>. If that algorithm threw an error, then return.</p>\n     </ins>"
        },
        {
          "html": "<p>\n      Let <var>source text</var> be <var>el</var>’s \n      <del><a data-x-internal=\"child-text-content\" href=\"https://dom.spec.whatwg.org/#concept-child-text-content\" id=\"script-processing-model:child-text-content\">child text content</a>.</del>\n      <ins><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#htmlscriptelement-script-text\" id=\"ref-for-htmlscriptelement-script-text⑦\">script text</a> value.</ins>\n     </p>"
        },
        {
          "html": "..."
        }
      ]
    },
    {
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request\">request</a> (<var>request</var>), a string <var>navigation type</var> and a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#content-security-policy-object\" id=\"ref-for-content-security-policy-object\">policy</a> (<var>policy</var>), this algorithm returns <code>\"Blocked\"</code>\nif a navigation violates the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#require-trusted-types-for-directive\" id=\"ref-for-require-trusted-types-for-directive③\">require-trusted-types-for</a> directive’s constraints and <code>\"Allowed\"</code>\notherwise. This constitutes the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#require-trusted-types-for-directive\" id=\"ref-for-require-trusted-types-for-directive④\">require-trusted-types-for</a> directive’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-pre-navigation-check\" id=\"ref-for-directive-pre-navigation-check\">pre-navigation check</a>:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">url</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> is not <code>\"javascript\"</code>, return <code>\"Allowed\"</code> and abort further steps.</p>"
        },
        {
          "html": "<p>Let <var>urlString</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">URL serializer</a> on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">url</a>.</p>"
        },
        {
          "html": "<p>Let <var>encodedScriptSource</var> be the result of removing the leading <code>\"javascript:\"</code> from <var>urlString</var>.</p>"
        },
        {
          "html": "<p>Let <var>convertedScriptSource</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#process-value-with-a-default-policy\" id=\"ref-for-process-value-with-a-default-policy①\">Process value with a default policy</a> algorithm, with the following arguments:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⑧\">TrustedScript</a></code> as <var>expectedType</var></p>\n      </li><li data-md=\"\">\n       <p><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">clients</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a> as <var>global</var></p>\n      </li><li data-md=\"\">\n       <p><var>encodedScriptSource</var> as <var>input</var></p>\n      </li><li data-md=\"\">\n       <p><code>\"Location href\"</code> as <var>sink</var></p>\n     </li></ul>\n     <p>If that algorithm threw an error or <var>convertedScriptSource</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/trusted-types/#trustedscript\" id=\"ref-for-trustedscript①⑨\">TrustedScript</a></code> object, return \"Blocked\" and abort further steps.</p>"
        },
        {
          "html": "<p>Set <var>urlString</var> to be the result of prepending <code>\"javascript:\"</code> to stringified <var>convertedScriptSource</var>.</p>"
        },
        {
          "html": "<p>Let <var>newURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">URL parser</a> on <var>urlString</var>. If the parser returns a failure, return <code>\"Blocked\"</code> and abort further steps.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url②\">url</a> to <var>newURL</var>.</p>"
        },
        {
          "html": "<p>Return <code>\"Allowed\"</code>.</p>"
        }
      ]
    },
    {
      "name": "does sink type require trusted types?",
      "href": "https://www.w3.org/TR/trusted-types/#does-sink-type-require-trusted-types",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"does-sink-type-require-trusted-types\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">does sink type require trusted types?</dfn> algorithm, given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a> (<var>global</var>), a string (<var>sinkGroup</var>) and a boolean (<var>includeReportOnlyPolicies</var>), performs these steps:",
      "rationale": "for",
      "steps": [
        {
          "html": "For each <var>policy</var> in <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#global-object-csp-list\" id=\"ref-for-global-object-csp-list\">CSP list</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-directive-set\" id=\"ref-for-policy-directive-set\">directive set</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives③\">directive</a>\nwhose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-name\" id=\"ref-for-directive-name②\">name</a> is <code>\"require-trusted-types-for\"</code>, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>directive</var> be the <var>policy</var>’s <var>directive set</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives④\">directive</a> whose name\nis <code>\"require-trusted-types-for\"</code></p>"
            },
            {
              "html": "<p>If <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value③\">value</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trusted-types-sink-group\" id=\"ref-for-trusted-types-sink-group③\">trusted-types-sink-group</a> which is a match\nfor <var>sinkGroup</var>, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>enforced</var> be true if <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-disposition\" id=\"ref-for-policy-disposition\">disposition</a> is <code>\"enforce\"</code>, and false otherwise.</p>"
            },
            {
              "html": "<p>If <var>enforced</var> is true, return true.</p>"
            },
            {
              "html": "<p>If <var>includeReportOnlyPolicies</var> is true, return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "should sink type mismatch violation be blocked by content security policy?",
      "href": "https://www.w3.org/TR/trusted-types/#should-sink-type-mismatch-violation-be-blocked-by-content-security-policy",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"should-sink-type-mismatch-violation-be-blocked-by-content-security-policy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">should sink type mismatch violation be blocked by content security policy?</dfn> algorithm, given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global④\">global object</a> (<var>global</var>), a string (<var>sink</var>), a string (<var>sinkGroup</var>) and a string (<var>source</var>), performs the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be <code>\"Allowed\"</code>.</p>"
        },
        {
          "html": "<p>Let <var>sample</var> be <var>source</var>.</p>"
        },
        {
          "html": "If <var>sink</var> is <code>\"Function\"</code>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>sample</var> starts with <code>\"function anonymous\"</code>, strip that from <var>sample</var>.</p>"
            },
            {
              "html": "<p>Otherwise if <var>sample</var> starts with <code>\"async function anonymous\"</code>, strip that from <var>sample</var>.</p>"
            },
            {
              "html": "<p>Otherwise if <var>sample</var> starts with <code>\"function* anonymous\"</code>, strip that from <var>sample</var>.</p>"
            },
            {
              "html": "<p>Otherwise if <var>sample</var> starts with <code>\"async function* anonymous\"</code>, strip that from <var>sample</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>policy</var> in <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#global-object-csp-list\" id=\"ref-for-global-object-csp-list①\">CSP list</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-directive-set\" id=\"ref-for-policy-directive-set①\">directive set</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives⑤\">directive</a>\nwhose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-name\" id=\"ref-for-directive-name③\">name</a> is <code>\"require-trusted-types-for\"</code>, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>directive</var> be the <var>policy</var>’s <var>directive set</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives⑥\">directive</a> whose name\nis <code>\"require-trusted-types-for\"</code></p>"
            },
            {
              "html": "<p>If <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value④\">value</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#trusted-types-sink-group\" id=\"ref-for-trusted-types-sink-group④\">trusted-types-sink-group</a> which is a match\nfor <var>sinkGroup</var>, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>violation</var> be the result of executing\n<a href=\"https://www.w3.org/TR/CSP3/#create-violation-for-global\">Create a violation object for global, policy, and directive</a>\non <var>global</var>, <var>policy</var> and <code>\"require-trusted-types-for\"</code></p>"
            },
            {
              "html": "<p>Set <var>violation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#violation-resource\" id=\"ref-for-violation-resource\">resource</a> to <code>\"trusted-types-sink\"</code>.</p>"
            },
            {
              "html": "<p>Let <var>trimmedSample</var> be the substring of <var>sample</var>, containing its first 40 characters.</p>"
            },
            {
              "html": "<p>Set <var>violation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#violation-sample\" id=\"ref-for-violation-sample\">sample</a> to be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate\">concatenating</a> the list « <var>sink</var>, <var>trimmedSample</var> « using <code>\"|\"</code> as a separator.</p>"
            },
            {
              "html": "<p>Execute <a href=\"https://www.w3.org/TR/CSP3/#report-violation\">Report a violation</a> on <var>violation</var>.</p>"
            },
            {
              "html": "<p>If <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-disposition\" id=\"ref-for-policy-disposition①\">disposition</a> is <code>\"enforce\"</code>, then set <var>result</var> to\n<code>\"Blocked\"</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "Should Trusted Type policy creation be blocked by content security policy?",
      "href": "https://www.w3.org/TR/trusted-types/#should-trusted-type-policy-creation-be-blocked-by-content-security-policy",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"should-trusted-type-policy-creation-be-blocked-by-content-security-policy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Should Trusted Type policy creation be blocked by content security policy?</dfn> algorithm, given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑤\">global object</a> (<var>global</var>), a string (<var>policyName</var>) and a list of\nstrings (<var>createdPolicyNames</var>), performs the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be <code>\"Allowed\"</code>.</p>"
        },
        {
          "html": "For each <var>policy</var> in <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#global-object-csp-list\" id=\"ref-for-global-object-csp-list②\">CSP list</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>createViolation</var> be false.</p>"
            },
            {
              "html": "<p>If <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-directive-set\" id=\"ref-for-policy-directive-set②\">directive set</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives⑦\">directive</a>\nwhich name is <code>\"trusted-types\"</code>, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>directive</var> be the <var>policy</var>’s <var>directive set</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directives\" id=\"ref-for-directives⑧\">directive</a> which name\nis <code>\"trusted-types\"</code></p>"
            },
            {
              "html": "<p>If <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value⑤\">value</a> only contains a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#tt-keyword\" id=\"ref-for-tt-keyword①\">tt-keyword</a> which\nis a match for a value <code>'none'</code>, set <var>createViolation</var> to true.</p>"
            },
            {
              "html": "<p>If <var>createdPolicyNames</var> contains <var>policyName</var> and <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value⑥\">value</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#tt-keyword\" id=\"ref-for-tt-keyword②\">tt-keyword</a> which is a match\nfor a value <code>'allow-duplicates'</code>, set <var>createViolation</var> to true.</p>"
            },
            {
              "html": "<p>If <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value⑦\">value</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#tt-policy-name\" id=\"ref-for-tt-policy-name①\">tt-policy-name</a>,\nwhich value is <var>policyName</var>, and <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#directive-value\" id=\"ref-for-directive-value⑧\">value</a> does not contain a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/trusted-types/#tt-wildcard\" id=\"ref-for-tt-wildcard①\">tt-wildcard</a>, set <var>createViolation</var> to true.</p>"
            },
            {
              "html": "<p>If <var>createViolation</var> is false, skip to the next <var>policy</var>.</p>"
            },
            {
              "html": "<p>Let <var>violation</var> be the result of executing\n<a href=\"https://www.w3.org/TR/CSP3/#create-violation-for-global\">Create a violation object for global, policy, and directive</a> on <var>global</var>, <var>policy</var> and\n<code>\"trusted-types\"</code></p>"
            },
            {
              "html": "<p>Set <var>violation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#violation-resource\" id=\"ref-for-violation-resource①\">resource</a> to <code>\"trusted-types-policy\"</code>.</p>"
            },
            {
              "html": "<p>Set <var>violation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#violation-sample\" id=\"ref-for-violation-sample①\">sample</a> to the substring of <var>policyName</var>, containing its first 40 characters.</p>"
            },
            {
              "html": "<p>Execute <a href=\"https://www.w3.org/TR/CSP3/#report-violation\">Report a violation</a> on <var>violation</var>.</p>"
            },
            {
              "html": "<p>If <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSP3/#policy-disposition\" id=\"ref-for-policy-disposition②\">disposition</a> is <code>\"enforce\"</code>, then set <var>result</var> to\n<code>\"Blocked\"</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    }
  ]
}