{
  "spec": {
    "title": "Web Animations",
    "url": "https://www.w3.org/TR/web-animations-1/"
  },
  "algorithms": [
    {
      "name": "update animations and send events",
      "href": "https://www.w3.org/TR/web-animations-1/#update-animations-and-send-events",
      "html": "When asked to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-export=\"\" id=\"update-animations-and-send-events\">update animations and send events</dfn> for\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/#document\" id=\"ref-for-document\">Document</a></code> <var>doc</var> at timestamp <var>now</var>, run these steps:",
      "rationale": "update",
      "steps": [
        {
          "html": "<p>Update the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-current-time\" id=\"ref-for-timeline-current-time②\">current time</a> of all\n timelines <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-associated-with-a-document\" id=\"ref-for-timeline-associated-with-a-document\">associated with <var>doc</var></a> passing <var>now</var> as the timestamp.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#remove-replaced-animations\" id=\"ref-for-remove-replaced-animations\">Remove replaced animations</a> for <var>doc</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint\" id=\"ref-for-perform-a-microtask-checkpoint\">Perform a microtask checkpoint</a>.</p>"
        },
        {
          "html": "<p>Let <var>events to dispatch</var> be a copy of <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue\">pending animation event\n queue</a>.</p>"
        },
        {
          "html": "<p>Clear <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue①\">pending animation event queue</a>.</p>"
        },
        {
          "html": "Perform a stable sort of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-events\" id=\"ref-for-animation-events①\">animation events</a> in <var>events to dispatch</var> as follows:",
          "rationale": "sort",
          "steps": [
            {
              "html": "<p>Sort the events by their <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#scheduled-event-time\" id=\"ref-for-scheduled-event-time\">scheduled event time</a> such that events\n  that were scheduled to occur earlier, sort before events scheduled to\n  occur later and events whose scheduled event time is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③\">unresolved</a> sort before events with a <span id=\"ref-for-unresolved④\">resolved</span> scheduled event time.</p>"
            },
            {
              "html": "<p>Within events with equal <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#scheduled-event-time\" id=\"ref-for-scheduled-event-time①\">scheduled event times</a>, sort by their <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-composite-order\" id=\"ref-for-animation-composite-order\">composite order</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\" id=\"ref-for-concept-event-dispatch\">Dispatch</a> each of the events in <var>events to dispatch</var> at their\n corresponding target using the order established in the previous step.</p>"
        }
      ]
    },
    {
      "name": "animation/set the timeline of an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-set-the-timeline-of-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-for=\"animation\" data-dfn-type=\"dfn\" data-export=\"\" id=\"animation-set-the-timeline-of-an-animation\">set the timeline of an animation</dfn>, <var>animation</var>, to <var>new timeline</var> which may be null, is as\nfollows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>old timeline</var> be the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline①⑤\">timeline</a> of <var>animation</var>, if any.</p>"
        },
        {
          "html": "<p>If <var>new timeline</var> is the same object as <var>old timeline</var>,\nabort this procedure.</p>"
        },
        {
          "html": "<p>Let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline①⑥\">timeline</a> of <var>animation</var> be <var>new timeline</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①\">start time</a> of <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧\">resolved</a>, make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①\">hold time</a> <span id=\"ref-for-unresolved⑨\">unresolved</span>.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state①\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false, and\nthe <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "name": "animation/set the associated effect of an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-set-the-associated-effect-of-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-for=\"animation\" data-dfn-type=\"dfn\" data-export=\"\" id=\"animation-set-the-associated-effect-of-an-animation\">set the associated effect of an animation</dfn>, <var>animation</var>, to <var>new effect</var> which may be null, is as\nfollows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>old effect</var> be the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-associated-effect\" id=\"ref-for-animation-associated-effect③\">associated effect</a> of <var>animation</var>, if any.</p>"
        },
        {
          "html": "<p>If <var>new effect</var> is the same object as <var>old effect</var>,\nabort this procedure.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task\">pending pause task</a>, reschedule that\ntask to run as soon as <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#ready\" id=\"ref-for-ready\">ready</a>.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task\">pending play task</a>, reschedule that task\nto run as soon as <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#ready\" id=\"ref-for-ready①\">ready</a> to play <var>new\neffect</var>.</p>"
        },
        {
          "html": "<p>If <var>new effect</var> is not <code>null</code> and\nif <var>new effect</var> is the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-associated-effect\" id=\"ref-for-animation-associated-effect④\">associated effect</a> of another <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation⑧\">animation</a>, <var>previous animation</var>, run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-set-the-associated-effect-of-an-animation\" id=\"ref-for-animation-set-the-associated-effect-of-an-animation\">set\nthe associated effect of an animation</a> (this procedure) on <var>previous\nanimation</var> passing null as <var>new effect</var>.</p>"
        },
        {
          "html": "<p>Let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-associated-effect\" id=\"ref-for-animation-associated-effect⑤\">associated effect</a> of <var>animation</var> be <var>new\neffect</var>.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state②\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false, and\nthe <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "html": "If <em>any</em> of the following are true:",
      "rationale": ".switch",
      "steps": [
        {
          "html": "<p>the animation has no associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline①⑦\">timeline</a>, or</p>"
        },
        {
          "html": "<p>the associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline①⑧\">timeline</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline③\">inactive</a>, or</p>"
        },
        {
          "html": "<p>the animation’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①①\">unresolved</a>.</p>"
        }
      ]
    },
    {
      "name": "animation/silently set the current time",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-silently-set-the-current-time",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-for=\"animation\" data-dfn-type=\"dfn\" data-export=\"\" id=\"animation-silently-set-the-current-time\">silently set the current time</dfn> of\nan animation, <var>animation</var>, to <var>seek time</var> is as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>seek time</var> is an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①③\">unresolved</a> time value,\nthen perform the following steps.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time⑨\">current time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①④\">resolved</a>,\n then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> a <span class=\"exceptionname\">TypeError</span>.</p>"
            },
            {
              "html": "<p>Abort these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>Update either <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time④\">hold time</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time④\">start time</a> as follows:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">\n        <p>If <em>any</em> of the following conditions are true:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time⑤\">hold time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⑤\">resolved</a>, or</p>\n         </li><li data-md=\"\">\n          <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time⑤\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⑥\">unresolved</a>, or</p>\n         </li><li data-md=\"\">\n          <p><var>animation</var> has no associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②⓪\">timeline</a> or the\nassociated <span id=\"ref-for-timeline②①\">timeline</span> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline④\">inactive</a>, or</p>\n         </li><li data-md=\"\">\n          <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate③\">playback rate</a> is 0,</p>\n        </li></ul>\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time⑥\">hold time</a> to <var>seek time</var>.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time⑥\">start time</a> to the result of evaluating <code><var>timeline time</var> - (<var>seek time</var> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate④\">playback rate</a>)</code> where <var>timeline time</var> is the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value①⑧\">time value</a> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②②\">timeline</a> associated with <var>animation</var>.</p>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>If <var>animation</var> has no associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②③\">timeline</a> or the associated <span id=\"ref-for-timeline②④\">timeline</span> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline⑤\">inactive</a>,\nmake <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time⑦\">start time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⑦\">unresolved</a>.</p>"
        },
        {
          "html": "<p>Make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#previous-current-time\" id=\"ref-for-previous-current-time\">previous current time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⑧\">unresolved</a>.</p>"
        }
      ]
    },
    {
      "name": "animation/set the current time",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-set-the-current-time",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-for=\"animation\" data-dfn-type=\"dfn\" data-export=\"\" id=\"animation-set-the-current-time\">set the current time</dfn> of an animation, <var>animation</var>, to <var>seek time</var> is as follows:",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run the steps to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-silently-set-the-current-time\" id=\"ref-for-animation-silently-set-the-current-time\">silently set the current time</a> of <var>animation</var> to <var>seek time</var>.</p>"
        },
        {
          "html": "If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①\">pending pause task</a>, synchronously\ncomplete the pause operation by performing the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time⑦\">hold time</a> to <var>seek time</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate\">Apply any pending playback rate</a> to <var>animation</var>.</p>"
            },
            {
              "html": "<p>Make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time⑨\">start time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⑨\">unresolved</a>.</p>"
            },
            {
              "html": "<p>Cancel the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task②\">pending pause task</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise\">current ready promise</a> with <var>animation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state③\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to true, and\nthe <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "name": "set the start time",
      "href": "https://www.w3.org/TR/web-animations-1/#set-the-start-time",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-the-start-time\">set the start time</dfn> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation①⓪\">animation</a>, <var>animation</var>, to <var>new start time</var>,\nis as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>timeline time</var> be the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value①⑨\">time value</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②⑤\">timeline</a> that <var>animation</var> is associated with.\nIf there is no <span id=\"ref-for-timeline②⑥\">timeline</span> associated with <var>animation</var> or the\nassociated timeline is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline⑥\">inactive</a>,\nlet the <var>timeline time</var> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②⓪\">unresolved</a>.</p>"
        },
        {
          "html": "<p>If <var>timeline time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②①\">unresolved</a> and <var>new start\ntime</var> is <span id=\"ref-for-unresolved②②\">resolved</span>, make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time⑧\">hold time</a> <span id=\"ref-for-unresolved②③\">unresolved</span>.</p>"
        },
        {
          "html": "<p>Let <var>previous current time</var> be <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time①②\">current time</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate①\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
        },
        {
          "html": "<p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①①\">start time</a> to <var>new start time</var>.</p>"
        },
        {
          "html": "<p>Update <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time⑨\">hold time</a> based on the first matching\ncondition from the following,</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>new start time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②⑤\">resolved</a>,\n       </dt><dd data-md=\"\">\n        <p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate⑤\">playback rate</a> is not zero,\nmake <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⓪\">hold time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②⑥\">unresolved</a>.</p>\n       </dd><dt data-md=\"\">Otherwise (<var>new start time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②⑦\">unresolved</a>),\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①①\">hold time</a> to <var>previous current\ntime</var> even if <var>previous current time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved②⑧\">unresolved</a>.</p>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task①\">pending play task</a> or\na <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task③\">pending pause task</a>, cancel that task and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①\">current ready promise</a> with <var>animation</var>.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state④\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to true, and\nthe <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "name": "play an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#play-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"play-an-animation\">play an animation</dfn>, <var>animation</var>, given\na flag <var>auto-rewind</var>, is as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>aborted pause</var> be a boolean flag that is true if <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task⑤\">pending pause task</a>, and false otherwise.</p>"
        },
        {
          "html": "<p>Let <var>has pending ready promise</var> be a boolean flag that is\ninitially false.</p>"
        },
        {
          "html": "<p>Let <var>seek time</var> be a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②①\">time value</a> that is initially <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③①\">unresolved</a>.</p>"
        },
        {
          "html": "<p>If the <var>auto-rewind</var> flag is true, perform the steps corresponding to the <em>first</em> matching condition from the following, if any:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">\n        <p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate\">effective playback rate</a> ≥ 0,\nand <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time①④\">current time</a> is <em>either</em>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③②\">unresolved</a>, or</p>\n         </li><li data-md=\"\">\n          <p>less than zero, or</p>\n         </li><li data-md=\"\">\n          <p>greater than or equal to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end\">associated effect end</a>,</p>\n        </li></ul>\n       </dt><dd data-md=\"\">\n        <p>Set <var>seek time</var> to zero.</p>\n       </dd><dt data-md=\"\">\n        <p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate①\">effective playback rate</a> &lt; 0,\nand <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time①⑤\">current time</a> is <em>either</em>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③③\">unresolved</a>, or</p>\n         </li><li data-md=\"\">\n          <p>less than or equal to zero, or</p>\n         </li><li data-md=\"\">\n          <p>greater than <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①\">associated effect end</a>,</p>\n        </li></ul>\n       </dt><dd data-md=\"\">\n        <div class=\"switch\">\n         <dl>\n          <dt data-md=\"\">If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end②\">associated effect end</a> is positive infinity,\n          </dt><dd data-md=\"\">\n           <p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code> and\nabort these steps.</p>\n          </dd><dt data-md=\"\">Otherwise,\n          </dt><dd data-md=\"\">\n           <p>Set <var>seek time</var> to <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end③\">associated effect end</a>.</p>\n         </dd></dl>\n        </div>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>If the following three conditions are <em>all</em> satisfied:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><var>seek time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③④\">unresolved</a>, and</p>\n      </li><li data-md=\"\">\n       <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①④\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③⑤\">unresolved</a>, and</p>\n      </li><li data-md=\"\">\n       <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time①⑥\">current time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③⑥\">unresolved</a>,</p>\n     </li></ul>\n     <p>set <var>seek time</var> to zero.</p>"
        },
        {
          "html": "<p>Let <var>has finite timeline</var> be true if <var>animation</var> has an associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②⑧\">timeline</a> that is not <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#monotonically-increasing-timeline\" id=\"ref-for-monotonically-increasing-timeline①\">monotonically increasing</a>.</p>"
        },
        {
          "html": "<p>If <var>seek time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③⑦\">resolved</a>,</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>has finite timeline</var> is true,\n       </dt><dd data-md=\"\">\n        \n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①③\">hold time</a> to <var>seek time</var>.</p>\n      </dd></dl>\n     </div>",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①⑤\">start time</a> to <var>seek time</var>.</p>"
            },
            {
              "html": "<p>Let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①②\">hold time</a> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③⑧\">unresolved</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate②\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①④\">hold time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved③⑨\">resolved</a>,\nlet its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①⑥\">start time</a> be <span id=\"ref-for-unresolved④⓪\">unresolved</span>.</p>"
        },
        {
          "html": "If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task④\">pending play task</a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task⑥\">pending pause task</a>,",
          "rationale": "cancel",
          "steps": [
            {
              "html": "<p>Cancel that task.</p>"
            },
            {
              "html": "<p>Set <var>has pending ready promise</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>If the following four conditions are <em>all</em> satisfied:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⑤\">hold time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④①\">unresolved</a>, and</p>\n      </li><li data-md=\"\">\n       <p><var>seek time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④②\">unresolved</a>, and</p>\n      </li><li data-md=\"\">\n       <p><var>aborted pause</var> is false, and</p>\n      </li><li data-md=\"\">\n       <p><var>animation</var> does <em>not</em> have a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate\">pending playback rate</a>,</p>\n     </li></ul>\n     <p>abort this procedure.</p>"
        },
        {
          "html": "<p>If <var>has pending ready promise</var> is false,\nlet <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise⑤\">current ready promise</a> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant Realm</a> of <var>animation</var>.</p>"
        },
        {
          "html": "Schedule a task to run as soon as <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#ready\" id=\"ref-for-ready③\">ready</a>.\nThe task shall perform the following steps:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p>Assert that at least one of <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①⑦\">start time</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⑥\">hold\ntime</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④③\">resolved</a>.</p>"
            },
            {
              "html": "<p>Let <var>ready time</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②②\">time value</a> of\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline②⑨\">timeline</a> associated with <var>animation</var> at the moment\nwhen <var>animation</var> became <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#ready\" id=\"ref-for-ready④\">ready</a>.</p>"
            },
            {
              "html": "<p>Perform the steps corresponding to the first matching condition below,\nif any:</p>\n       <div class=\"switch\">\n        <dl>\n         <dt data-md=\"\">If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⑦\">hold time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④④\">resolved</a>,\n         </dt><dd data-md=\"\">\n          \n         </dd><dt data-md=\"\">If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①⑨\">start time</a> is resolved and <var>animation</var> has\na <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①\">pending playback rate</a>,\n         </dt><dd data-md=\"\">\n          \n        </dd></dl>\n       </div>",
              "rationale": ".switch",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate③\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
                },
                {
                  "html": "<p>Let <var>new start time</var> be the result of evaluating <code><var>ready time</var> - <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⑧\">hold time</a> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate⑥\">playback rate</a></code> for <var>animation</var>.\nIf the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate⑦\">playback rate</a> is zero, let <var>new start time</var> be simply <var>ready time</var>.</p>"
                },
                {
                  "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time①⑧\">start time</a> of <var>animation</var> to <var>new start time</var>.</p>"
                },
                {
                  "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate⑧\">playback rate</a> is not 0, make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time①⑨\">hold time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④⑤\">unresolved</a>.</p>"
                }
              ],
              "additional": [
                {
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>current time to match</var> be the result of evaluating <code>(<var>ready time</var> - <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②⓪\">start time</a>) × <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate⑨\">playback rate</a></code> for <var>animation</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate④\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate①⓪\">playback rate</a> is zero, let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time②⓪\">hold time</a> be <var>current time to match</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>new start time</var> be the result of evaluating <code><var>ready time</var> - <var>current time to match</var> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate①①\">playback rate</a></code> for <var>animation</var>.\nIf the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate①②\">playback rate</a> is zero, let <var>new start time</var> be simply <var>ready time</var>.</p>"
                    },
                    {
                      "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②①\">start time</a> of <var>animation</var> to <var>new start time</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise⑥\">current\nready promise</a> with <var>animation</var>.</p>"
            },
            {
              "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state⑤\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false,\nand the <var>synchronously notify</var> flag set to false.</p>"
            }
          ]
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state⑥\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false, and\nthe <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "name": "pause an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#pause-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"pause-an-animation\">pause an animation</dfn>, <var>animation</var>, is as\nfollows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task⑦\">pending pause task</a>, abort these steps.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state\">play state</a> of <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-paused\" id=\"ref-for-play-state-paused\">paused</a>,\nabort these steps.</p>"
        },
        {
          "html": "<p>Let <var>seek time</var> be a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②③\">time value</a> that is initially <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④⑦\">unresolved</a>.</p>"
        },
        {
          "html": "<p>Let <var>has finite timeline</var> be true if <var>animation</var> has an associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline③⓪\">timeline</a> that is not <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#monotonically-increasing-timeline\" id=\"ref-for-monotonically-increasing-timeline②\">monotonically increasing</a>.</p>"
        },
        {
          "html": "<p>If the <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time①⑨\">current time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④⑧\">unresolved</a>,\nperform the steps according to the first matching condition from below:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate①③\">playback rate</a> is ≥ 0,\n       </dt><dd data-md=\"\">\n        <p>Set <var>seek time</var> to zero.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <div class=\"switch\">\n         <dl>\n          <dt data-md=\"\">If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end④\">associated effect end</a> for <var>animation</var> is positive\ninfinity,\n          </dt><dd data-md=\"\">\n           <p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②\">throw</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code> and abort these steps.</p>\n          </dd><dt data-md=\"\">Otherwise,\n          </dt><dd data-md=\"\">\n           <p>Set <var>seek time</var> to <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end⑤\">associated effect\nend</a>.</p>\n         </dd></dl>\n        </div>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>If <var>seek time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved④⑨\">resolved</a>,</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>has finite timeline</var> is true,\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②③\">start time</a> to <var>seek time</var>.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time②①\">hold time</a> to <var>seek time</var>.</p>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>Let <var>has pending ready promise</var> be a boolean flag that is\ninitially false.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task⑧\">pending play task</a>, cancel that task\nand let <var>has pending ready promise</var> be true.</p>"
        },
        {
          "html": "<p>If <var>has pending ready promise</var> is false,\nset <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise⑨\">current ready promise</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant Realm</a> of <var>animation</var>.</p>"
        },
        {
          "html": "The task shall perform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>ready time</var> be the time value of the timeline associated\nwith <var>animation</var> at the moment when the user agent completed\nprocessing necessary to suspend playback of <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-associated-effect\" id=\"ref-for-animation-associated-effect①⓪\">associated effect</a>.</p>"
            },
            {
              "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②④\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑤⓪\">resolved</a> and its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time②②\">hold time</a> is <em>not</em> resolved,\nlet <var>animation</var>’s <span id=\"ref-for-animation-hold-time②③\">hold time</span> be the result of evaluating <code>(<var>ready time</var> - <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②⑤\">start time</a>) × <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate①④\">playback rate</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate⑤\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
            },
            {
              "html": "<p>Make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②⑥\">start time</a> unresolved.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">Resolve</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①⓪\">current\nready promise</a> with <var>animation</var>.</p>"
            },
            {
              "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state⑦\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false,\nand the <var>synchronously notify</var> flag set to false.</p>"
            }
          ]
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state⑧\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false,\nand the <var>synchronously notify</var> flag set to false.</p>"
        }
      ]
    },
    {
      "name": "update an animation’s finished state",
      "href": "https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-an-animations-finished-state\">update an animation’s finished state</dfn> for <var>animation</var>, given a flag <var>did seek</var> (to indicate if\nthe update is being performed after <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-set-the-current-time\" id=\"ref-for-animation-set-the-current-time①\">setting the\ncurrent time</a>), and a flag <var>synchronously notify</var> (to indicate\nthe update was called in a context where we expect finished event queueing\nand finished promise resolution to happen immediately, if at all) is as\nfollows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let the <var>unconstrained current time</var> be the result of\ncalculating the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time②⑧\">current time</a> substituting an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑤③\">unresolved</a> time value for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time②⑥\">hold time</a> if <var>did seek</var> is false.\nIf <var>did seek</var> is true, the <var>unconstrained current time</var> is equal to the <span id=\"ref-for-animation-current-time②⑨\">current time</span>.</p>"
        },
        {
          "html": "Perform the following steps:",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>If <var>did seek</var> is true and the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time③④\">hold time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑤⑧\">resolved</a>, let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time②⑨\">start time</a> be equal to the result of evaluating <code><var>timeline time</var> - (<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time③⑤\">hold time</a> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate②②\">playback rate</a>)</code> where <var>timeline time</var> is the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②⑤\">time value</a> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline③②\">timeline</a> associated with <var>animation</var>.</p>"
            },
            {
              "html": "<p>Let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time③⑥\">hold time</a> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑤⑨\">unresolved</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#previous-current-time\" id=\"ref-for-previous-current-time⑤\">previous current time</a> of <var>animation</var> be the\nresult of calculating its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③⓪\">current time</a>.</p>"
        },
        {
          "html": "<p>Let <var>current finished state</var> be true if the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state①\">play\nstate</a> of <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-finished\" id=\"ref-for-play-state-finished④\">finished</a>.\nOtherwise, let it be false.</p>"
        },
        {
          "html": "If <var>current finished state</var> is true and the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise②\">current finished\npromise</a> is not yet resolved, perform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"finish-notification-steps\">finish notification steps</dfn> refer to the following\nprocedure:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state②\">play state</a> is not equal to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-finished\" id=\"ref-for-play-state-finished⑤\">finished</a>,\nabort these steps.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve④\">Resolve</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise③\">current finished promise</a> object with <var>animation</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-create\" id=\"ref-for-concept-event-create\">Create</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animationplaybackevent\" id=\"ref-for-animationplaybackevent\">AnimationPlaybackEvent</a></code>, <var>finishEvent</var>.</p>"
                },
                {
                  "html": "<p>Set <var>finishEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-type\" id=\"ref-for-dom-event-type\">type</a></code> attribute to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#finish-event\" id=\"ref-for-finish-event\">finish</a>.</p>"
                },
                {
                  "html": "<p>Set <var>finishEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-currenttime\" id=\"ref-for-dom-animationplaybackevent-currenttime\">currentTime</a></code> attribute\nto the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③①\">current time</a> of <var>animation</var>.</p>"
                },
                {
                  "html": "<p>Set <var>finishEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-timelinetime\" id=\"ref-for-dom-animationplaybackevent-timelinetime\">timelineTime</a></code> attribute to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-current-time\" id=\"ref-for-timeline-current-time⑤\">current time</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline③③\">timeline</a> with which <var>animation</var> is associated.\nIf <var>animation</var> is not associated with a timeline, or the timeline\nis <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①⓪\">inactive</a>, let <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-timelinetime\" id=\"ref-for-dom-animationplaybackevent-timelinetime①\">timelineTime</a></code> be <code class=\"esvalue\">null</code>.</p>"
                },
                {
                  "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-document-for-timing\" id=\"ref-for-animation-document-for-timing①\">document for timing</a>, then append <var>finishEvent</var> to its <span id=\"ref-for-animation-document-for-timing②\">document for timing</span>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue②\">pending animation\nevent queue</a> along with its target, <var>animation</var>.\nFor the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#scheduled-event-time\" id=\"ref-for-scheduled-event-time②\">scheduled event time</a>, use the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-time-to-origin-relative-time\" id=\"ref-for-animation-time-to-origin-relative-time\">converting</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①①\">associated effect end</a> to an origin-relative time.</p>\n         <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\" id=\"ref-for-concept-event-dispatch①\">dispatch</a> <var>finishEvent</var> at <var>animation</var>.\nThe task source for this task is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source\">DOM manipulation task\nsource</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>synchronously notify</var> is true, cancel any queued\nmicrotask to run the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#finish-notification-steps\" id=\"ref-for-finish-notification-steps\">finish notification steps</a> for this <var>animation</var>, and run the <span id=\"ref-for-finish-notification-steps①\">finish notification\nsteps</span> immediately.</p>\n       <p>Otherwise, if <var>synchronously notify</var> is false, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-microtask\" id=\"ref-for-queue-a-microtask\">queue\na microtask</a> to run <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#finish-notification-steps\" id=\"ref-for-finish-notification-steps②\">finish notification steps</a> for <var>animation</var> unless there is already a microtask queued to run\nthose steps for <var>animation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>current finished state</var> is false and <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise④\">current finished promise</a> is already\nresolved, set <var>animation</var>’s <span id=\"ref-for-current-finished-promise⑤\">current finished promise</span> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant Realm</a> of <var>animation</var>.</p>"
        }
      ]
    },
    {
      "name": "finish an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#finish-an-animation",
      "html": "An animation can be advanced to the natural end of its current playback\ndirection by using the procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"finish-an-animation\">finish an animation</dfn> for <var>animation</var> defined below:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate②\">effective playback rate</a> is zero,\nor if <var>animation</var>’s <span id=\"ref-for-effective-playback-rate③\">effective playback rate</span> &gt; 0\nand <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①②\">associated effect end</a> is infinity, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③\">throw</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> and\nabort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate⑥\">Apply any pending playback rate</a> to <var>animation</var>.</p>"
        },
        {
          "html": "<p>Set <var>limit</var> as follows:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate②③\">playback rate</a> &gt; 0,\n       </dt><dd data-md=\"\">\n        <p>Let <var>limit</var> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①③\">associated effect end</a>.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Let <var>limit</var> be zero.</p>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-silently-set-the-current-time\" id=\"ref-for-animation-silently-set-the-current-time①\">Silently set the current time</a> to <var>limit</var>.</p>"
        },
        {
          "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⓪\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⓪\">unresolved</a> and <var>animation</var> has an associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①①\">active</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline③④\">timeline</a>, let the <span id=\"ref-for-animation-start-time③①\">start time</span> be the result of evaluating <code><var>timeline time</var> -\n(<var>limit</var> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate②④\">playback rate</a>)</code> where <var>timeline time</var> is the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②⑥\">time\nvalue</a> of the associated <span id=\"ref-for-timeline③⑤\">timeline</span>.</p>"
        },
        {
          "html": "If there is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①①\">pending pause task</a> and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③②\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥①\">resolved</a>,",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time③⑦\">hold time</a> be <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥②\">unresolved</a>.</p>"
            },
            {
              "html": "<p>Cancel the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①②\">pending pause task</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑤\">Resolve</a> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①②\">current ready promise</a> of <var>animation</var> with <var>animation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task①②\">pending play task</a> and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③③\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥③\">resolved</a>, cancel that task and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑥\">resolve</a> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①③\">current ready promise</a> of <var>animation</var> with <var>animation</var>.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state①⓪\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to true,\nand the <var>synchronously notify</var> flag set to true.</p>"
        }
      ]
    },
    {
      "name": "cancel an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#cancel-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cancel-an-animation\">cancel an animation</dfn> for <var>animation</var> is\nas follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state③\">play state</a> is <em>not</em> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-idle\" id=\"ref-for-play-state-idle①\">idle</a>, perform the following steps:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-reset-an-animations-pending-tasks\" id=\"ref-for-animation-reset-an-animations-pending-tasks\">reset an animation’s pending tasks</a> on <var>animation</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise⑧\">current finished promise</a> with a DOMException named \"AbortError\".</p>"
            },
            {
              "html": "<p>Set the [[PromiseIsHandled]] internal slot of\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise⑨\">current finished promise</a> to true.</p>"
            },
            {
              "html": "<p>Let <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-finished-promise\" id=\"ref-for-current-finished-promise①⓪\">current finished promise</a> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant Realm</a> of <var>animation</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-create\" id=\"ref-for-concept-event-create①\">Create</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animationplaybackevent\" id=\"ref-for-animationplaybackevent①\">AnimationPlaybackEvent</a></code>, <var>cancelEvent</var>.</p>"
            },
            {
              "html": "<p>Set <var>cancelEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-type\" id=\"ref-for-dom-event-type①\">type</a></code> attribute to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#cancel-event\" id=\"ref-for-cancel-event①\">cancel</a>.</p>"
            },
            {
              "html": "<p>Set <var>cancelEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-currenttime\" id=\"ref-for-dom-animationplaybackevent-currenttime①\">currentTime</a></code> to <code class=\"esvalue\">null</code>.</p>"
            },
            {
              "html": "<p>Let <var>timeline time</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-current-time\" id=\"ref-for-timeline-current-time⑥\">current time</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline③⑥\">timeline</a> with which <var>animation</var> is associated.\nIf <var>animation</var> is not associated with an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①②\">active timeline</a>, let <var>timeline time</var> be n <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⑤\">unresolved</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②⑦\">time value</a>.</p>"
            },
            {
              "html": "<p>Set <var>cancelEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-timelinetime\" id=\"ref-for-dom-animationplaybackevent-timelinetime②\">timelineTime</a></code> to <var>timeline time</var>. If <var>timeline time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⑥\">unresolved</a>, set it to <code class=\"esvalue\">null</code>.</p>"
            },
            {
              "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-document-for-timing\" id=\"ref-for-animation-document-for-timing③\">document for timing</a>, then append <var>cancelEvent</var> to its <span id=\"ref-for-animation-document-for-timing④\">document for timing</span>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue③\">pending animation\nevent queue</a> along with its target, <var>animation</var>.\nIf <var>animation</var> is associated with an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①③\">active\ntimeline</a> that defines a procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-time-to-origin-relative-time\" id=\"ref-for-timeline-time-to-origin-relative-time①\">convert timeline times to origin-relative\ntime</a>, let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#scheduled-event-time\" id=\"ref-for-scheduled-event-time③\">scheduled event time</a> be the result of applying\nthat procedure to <var>timeline time</var>.\nOtherwise, the <span id=\"ref-for-scheduled-event-time④\">scheduled event time</span> is an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⑦\">unresolved</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value②⑧\">time\nvalue</a>.</p>\n       <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\" id=\"ref-for-concept-event-dispatch②\">dispatch</a> <var>cancelEvent</var> at <var>animation</var>.\nThe task source for this task is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①\">DOM manipulation task\nsource</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time③⑨\">hold time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⑧\">unresolved</a>.</p>"
        },
        {
          "html": "<p>Make <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③④\">start time</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑥⑨\">unresolved</a>.</p>"
        }
      ]
    },
    {
      "name": "animation/reset an animation’s pending tasks",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-reset-an-animations-pending-tasks",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-for=\"animation\" data-dfn-type=\"dfn\" data-export=\"\" id=\"animation-reset-an-animations-pending-tasks\">reset an animation’s pending tasks</dfn> for <var>animation</var> is as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>animation</var> does not have a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task①③\">pending play task</a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①③\">pending pause task</a>, abort this procedure.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task①④\">pending play task</a>, cancel that task.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①④\">pending pause task</a>, cancel that task.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate⑦\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①④\">current ready\npromise</a> with a DOMException named \"AbortError\".</p>"
        },
        {
          "html": "<p>Set the [[PromiseIsHandled]] internal slot of <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①⑤\">current ready promise</a> to true.</p>"
        },
        {
          "html": "<p>Let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-ready-promise\" id=\"ref-for-current-ready-promise①⑥\">current ready promise</a> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\" id=\"ref-for-a-promise-resolved-with①\">creating a new resolved Promise\nobject</a> with value <var>animation</var> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant Realm</a> of <var>animation</var>.</p>"
        }
      ]
    },
    {
      "name": "set the playback rate",
      "href": "https://www.w3.org/TR/web-animations-1/#set-the-playback-rate",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-the-playback-rate\">set the playback rate</dfn> of\nan <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation①⑨\">animation</a>, <var>animation</var> to <var>new playback rate</var> is as follows:",
      "rationale": "clear",
      "steps": [
        {
          "html": "<p>Clear any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate②\">pending playback rate</a> on <var>animation</var>.</p>"
        },
        {
          "html": "<p>Let <var>previous time</var> be the value of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③⑥\">current time</a> of <var>animation</var> before changing the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate②⑦\">playback rate</a>.</p>"
        },
        {
          "html": "<p>Let <var>previous playback rate</var> be the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate④\">effective playback rate</a> of <var>animation</var>.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate②⑧\">playback rate</a> to <var>new playback rate</var>.</p>"
        },
        {
          "html": "<p>Perform the steps corresponding to the <em>first</em> matching condition\nfrom the following, if any:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>animation</var> is associated with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#monotonically-increasing-timeline\" id=\"ref-for-monotonically-increasing-timeline③\">monotonically increasing</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④⓪\">timeline</a> and the <var>previous time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑦⓪\">resolved</a>,\n       </dt><dd data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-set-the-current-time\" id=\"ref-for-animation-set-the-current-time②\">set the current time</a> of <var>animation</var> to <var>previous time</var>.</p>\n       </dd><dt data-md=\"\">\n        <p>If <var>animation</var> is associated with a non-null <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④①\">timeline</a> that is not <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#monotonically-increasing-timeline\" id=\"ref-for-monotonically-increasing-timeline④\">monotonically increasing</a>,\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⑤\">start time</a> of <var>animation</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑦①\">resolved</a>, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①④\">associated effect end</a> is not infinity, and <em>either</em>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>the <var>previous playback rate</var> &lt; 0 and the <var>new playback rate</var> ≥ 0, or</p>\n         </li><li data-md=\"\">\n          <p>the <var>previous playback rate</var> ≥ 0 and the <var>new playback rate</var> &lt; 0,</p>\n        </li></ul>\n       </dt><dd data-md=\"\">\n        <p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⑥\">start time</a> to the result of evaluating <code><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-effect-end\" id=\"ref-for-associated-effect-end①⑤\">associated effect end</a> - <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⑦\">start time</a></code> for <var>animation</var>.</p>\n        \n      </dd></dl>\n     </div>"
        }
      ]
    },
    {
      "name": "apply any pending playback rate",
      "href": "https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate",
      "html": "When an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation②②\">animation</a>, <var>animation</var>, is to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-lt=\"apply any pending playback rate\" data-noexport=\"\" id=\"apply-any-pending-playback-rate\">apply any pending playback\nrate</dfn> the following steps are performed:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>animation</var> does not have a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate⑤\">pending playback rate</a>, abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate③①\">playback rate</a> to its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate⑥\">pending playback rate</a>.</p>"
        },
        {
          "html": "<p>Clear <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate⑦\">pending playback rate</a>.</p>"
        }
      ]
    },
    {
      "name": "seamlessly update the playback rate",
      "href": "https://www.w3.org/TR/web-animations-1/#seamlessly-update-the-playback-rate",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"seamlessly-update-the-playback-rate\">seamlessly update the playback rate</dfn> an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation②③\">animation</a>, <var>animation</var>, to <var>new playback rate</var> preserving its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③⑦\">current time</a> is as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>previous play state</var> be <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state⑤\">play state</a>.</p>"
        },
        {
          "html": "<p>Let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①⓪\">pending playback rate</a> be <var>new playback rate</var>.</p>"
        },
        {
          "html": "<p>Perform the steps corresponding to the first matching condition from below:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-play-task\" id=\"ref-for-pending-play-task①⑤\">pending play task</a> or a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-pause-task\" id=\"ref-for-pending-pause-task①⑤\">pending pause task</a>,\n       </dt><dd data-md=\"\">\n        <p>Abort these steps.</p>\n        \n       </dd><dt data-md=\"\">If <var>previous play state</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-idle\" id=\"ref-for-play-state-idle②\">idle</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-paused\" id=\"ref-for-play-state-paused③\">paused</a>, or <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③⑧\">current time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑦②\">unresolved</a>,\n       </dt><dd data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate⑧\">Apply any pending playback rate</a> on <var>animation</var>.</p>\n        \n       </dd><dt data-md=\"\">If <var>previous play state</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-state-finished\" id=\"ref-for-play-state-finished⑧\">finished</a>,\n       </dt><dd data-md=\"\">\n        \n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-an-animation\" id=\"ref-for-play-an-animation①\">play an animation</a> for <var>animation</var> with the <var>auto-rewind</var> flag set to false.</p>\n      </dd></dl>\n     </div>",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>Let the <var>unconstrained current time</var> be the result of calculating\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time③⑨\">current time</a> of <var>animation</var> substituting an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑦③\">unresolved</a> time value for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-hold-time\" id=\"ref-for-animation-hold-time④⓪\">hold time</a>.</p>"
            },
            {
              "html": "<p>Let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⑧\">start time</a> be\nthe result of evaluating the following expression:</p>\n          <blockquote> <code><var>timeline time</var> - (<var>unconstrained current time</var> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①②\">pending playback rate</a>)</code> </blockquote>\n          <p>Where <var>timeline time</var> is the current <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③①\">time value</a> of\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④②\">timeline</a> associated with <var>animation</var>.</p>\n          <p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①③\">pending playback rate</a> is zero, let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time③⑨\">start time</a> be <var>timeline time</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#apply-any-pending-playback-rate\" id=\"ref-for-apply-any-pending-playback-rate⑨\">Apply any pending playback rate</a> on <var>animation</var>.</p>"
            },
            {
              "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-an-animations-finished-state\" id=\"ref-for-update-an-animations-finished-state①①\">update an animation’s finished state</a> for <var>animation</var> with the <var>did seek</var> flag set to false,\nand the <var>synchronously notify</var> flag set to false.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "reverse an animation",
      "href": "https://www.w3.org/TR/web-animations-1/#reverse-an-animation",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"reverse-an-animation\">reverse an animation</dfn> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation②④\">animation</a> <var>animation</var> is as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If there is no <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④③\">timeline</a> associated with <var>animation</var>, or the\nassociated <span id=\"ref-for-timeline④④\">timeline</span> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①④\">inactive</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④\">throw</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code> and\nabort these steps.</p>"
        },
        {
          "html": "<p>Let <var>original pending playback rate</var> be <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①④\">pending playback\nrate</a>.</p>"
        },
        {
          "html": "<p>Let <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①⑤\">pending playback rate</a> be the additive inverse of\nits <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate⑥\">effective playback rate</a> (i.e. <code>-<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effective-playback-rate\" id=\"ref-for-effective-playback-rate⑦\">effective playback rate</a></code>).</p>"
        },
        {
          "html": "<p>Run the steps to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-an-animation\" id=\"ref-for-play-an-animation②\">play an animation</a> for <var>animation</var> with the <var>auto-rewind</var> flag set to true.</p>\n     <p>If the steps to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-an-animation\" id=\"ref-for-play-an-animation③\">play an animation</a> throw an exception, set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-playback-rate\" id=\"ref-for-pending-playback-rate①⑥\">pending playback rate</a> to <var>original pending playback rate</var> and propagate the exception.</p>"
        }
      ]
    },
    {
      "name": "animation time to timeline time",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-time-to-timeline-time",
      "html": "To <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-lt=\"animation time to timeline time\" data-noexport=\"\" id=\"animation-time-to-timeline-time\">convert an animation time to\ntimeline time a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③③\">time value</a>, <var>time</var>, that is relative to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time④④\">start\ntime</a> of an animation, <var>animation</var>, perform the following steps:</dfn>",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧①\">unresolved</a>, return <var>time</var>.</p>"
        },
        {
          "html": "<p>If <var>time</var> is infinity, return an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧②\">unresolved</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③④\">time value</a>.</p>"
        },
        {
          "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate③③\">playback rate</a> is zero,\n return an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧③\">unresolved</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③⑤\">time value</a>.</p>"
        },
        {
          "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time④⑤\">start time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧④\">unresolved</a>,\n return an <span id=\"ref-for-unresolved⑧⑤\">unresolved</span> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③⑥\">time value</a>.</p>"
        },
        {
          "html": "<p>Return the result of calculating: <code><var>time</var> × (1 / <var>playback rate</var>) + <var>start time</var></code> (where <var>playback rate</var> and <var>start time</var> are the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-rate\" id=\"ref-for-playback-rate③④\">playback rate</a> and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-start-time\" id=\"ref-for-animation-start-time④⑥\">start time</a> of <var>animation</var>, respectively).</p>"
        }
      ]
    },
    {
      "name": "animation time to origin-relative time",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-time-to-origin-relative-time",
      "html": "To <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-lt=\"animation time to origin-relative time\" data-noexport=\"\" id=\"animation-time-to-origin-relative-time\">convert a timeline time to\nan origin-relative time</dfn> a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③⑦\">time value</a>, <var>time</var>, that is expressed in the\nsame scale as the <span id=\"ref-for-time-value③⑧\">time values</span> of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④⑧\">timeline</a>, <var>timeline</var>, perform the\nfollowing steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>timeline time</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-time-to-timeline-time\" id=\"ref-for-animation-time-to-timeline-time\">converting</a> <var>time</var> from an animation time to a timeline time.</p>"
        },
        {
          "html": "<p>If <var>timeline time</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧⑥\">unresolved</a>,\n return <var>time</var>.</p>"
        },
        {
          "html": "<p>If <var>animation</var> is not associated with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline④⑨\">timeline</a>,\n return an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧⑦\">unresolved</a> time value.</p>"
        },
        {
          "html": "<p>If <var>animation</var> is associated with an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#inactive-timeline\" id=\"ref-for-inactive-timeline①⑦\">inactive timeline</a>,\n return an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧⑧\">unresolved</a> time value.</p>"
        },
        {
          "html": "<p>If there is no procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-time-to-origin-relative-time\" id=\"ref-for-timeline-time-to-origin-relative-time②\">convert a timeline time to an origin-relative time</a> for the\n timeline associated with <var>animation</var>,\n return an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved⑧⑨\">unresolved</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#time-value\" id=\"ref-for-time-value③⑨\">time value</a>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-time-to-origin-relative-time\" id=\"ref-for-timeline-time-to-origin-relative-time③\">converting</a> <var>timeline time</var> to an origin-relative time using\n the procedure defined for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline⑤⓪\">timeline</a> associated with <var>animation</var>.</p>"
        }
      ]
    },
    {
      "name": "overall progress",
      "href": "https://www.w3.org/TR/web-animations-1/#overall-progress",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"overall-progress\">overall progress</dfn> describes the number of iterations that\nhave completed (including partial iterations) and is defined as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#active-time\" id=\"ref-for-active-time①①\">active time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⓪①\">unresolved</a>, return <span id=\"ref-for-unresolved①⓪②\">unresolved</span>.</p>"
        },
        {
          "html": "<p>Calculate an initial value for <var>overall progress</var> based on the\nfirst matching condition from below,</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-duration\" id=\"ref-for-iteration-duration①①\">iteration duration</a> is zero,\n       </dt><dd data-md=\"\">\n        <p>If the animation effect is in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-before-phase\" id=\"ref-for-animation-effect-before-phase⑥\">before phase</a>, let <var>overall progress</var> be zero, otherwise, let it be equal\nto the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-count\" id=\"ref-for-iteration-count①①\">iteration count</a>.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Let <var>overall progress</var> be the result of calculating <code><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#active-time\" id=\"ref-for-active-time①②\">active time</a> / <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-duration\" id=\"ref-for-iteration-duration①②\">iteration duration</a></code>.</p>\n      </dd></dl>\n     </div>"
        },
        {
          "html": "<p>Return the result of calculating <code><var>overall\nprogress</var> + <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-start\" id=\"ref-for-iteration-start⑦\">iteration start</a></code>.</p>"
        }
      ]
    },
    {
      "name": "simple iteration progress",
      "href": "https://www.w3.org/TR/web-animations-1/#simple-iteration-progress",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"simple-iteration-progress\">simple iteration progress</dfn> is a fraction of the progress\nthrough the current iteration that ignores transformations to the time\nintroduced by the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction①\">playback direction</a> or <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function\">timing functions</a> applied to the effect, and is calculated as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#overall-progress\" id=\"ref-for-overall-progress②\">overall progress</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⓪③\">unresolved</a>,\nreturn <span id=\"ref-for-unresolved①⓪④\">unresolved</span>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#overall-progress\" id=\"ref-for-overall-progress③\">overall progress</a> is infinity, let the <var>simple iteration\nprogress</var> be <code><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-start\" id=\"ref-for-iteration-start⑧\">iteration start</a> % 1.0</code>,\notherwise, let the <var>simple iteration progress</var> be <code><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#overall-progress\" id=\"ref-for-overall-progress④\">overall progress</a> % 1.0</code>.</p>"
        },
        {
          "html": "<p>If <em>all</em> of the following conditions are true,</p>\n     <ul>\n      <li data-md=\"\">\n       <p>the <var>simple iteration progress</var> calculated above is zero, <em>and</em></p>\n      </li><li data-md=\"\">\n       <p>the animation effect is in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-active-phase\" id=\"ref-for-animation-effect-active-phase⑥\">active phase</a> <em>or</em> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-after-phase\" id=\"ref-for-animation-effect-after-phase⑥\">after phase</a>, <em>and</em></p>\n      </li><li data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#active-time\" id=\"ref-for-active-time①③\">active time</a> is equal to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#active-duration\" id=\"ref-for-active-duration①⑦\">active duration</a>, <em>and</em></p>\n      </li><li data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-count\" id=\"ref-for-iteration-count①②\">iteration count</a> is <em>not</em> equal to zero.</p>\n     </li></ul>\n     <p>let the <var>simple iteration progress</var> be 1.0.</p>"
        },
        {
          "html": "<p>Return <var>simple iteration progress</var>.</p>"
        }
      ]
    },
    {
      "name": "current iteration",
      "href": "https://www.w3.org/TR/web-animations-1/#current-iteration",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"current-iteration\">current iteration</dfn> can be calculated using the\nfollowing steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#active-time\" id=\"ref-for-active-time①④\">active time</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⓪⑤\">unresolved</a>, return <span id=\"ref-for-unresolved①⓪⑥\">unresolved</span>.</p>"
        },
        {
          "html": "<p>If the animation effect is in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-after-phase\" id=\"ref-for-animation-effect-after-phase⑦\">after phase</a> <em>and</em> the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-count\" id=\"ref-for-iteration-count①④\">iteration count</a> is infinity, return infinity.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#simple-iteration-progress\" id=\"ref-for-simple-iteration-progress②\">simple iteration progress</a> is 1.0,\nreturn <code>floor(<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#overall-progress\" id=\"ref-for-overall-progress⑤\">overall progress</a>) - 1</code>.</p>"
        },
        {
          "html": "<p>Otherwise, return <code>floor(<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#overall-progress\" id=\"ref-for-overall-progress⑥\">overall progress</a>)</code>.</p>"
        }
      ]
    },
    {
      "name": "directed progress",
      "href": "https://www.w3.org/TR/web-animations-1/#directed-progress",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"directed-progress\">directed progress</dfn> is calculated from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#simple-iteration-progress\" id=\"ref-for-simple-iteration-progress③\">simple iteration progress</a> using the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#simple-iteration-progress\" id=\"ref-for-simple-iteration-progress④\">simple iteration progress</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⓪⑦\">unresolved</a>, return <span id=\"ref-for-unresolved①⓪⑧\">unresolved</span>.</p>"
        },
        {
          "html": "<p>Calculate the <var>current direction</var> using the first\nmatching condition from the following list:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction②\">playback direction</a> is <code>normal</code>,\n       </dt><dd data-md=\"\">\n        <p>Let the <var>current direction</var> be forwards.</p>\n       </dd><dt data-md=\"\">If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction③\">playback direction</a> is <code>reverse</code>,\n       </dt><dd data-md=\"\">\n        <p>Let the <var>current direction</var> be reverse.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        \n      </dd></dl>\n     </div>",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>Let <var>d</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#current-iteration\" id=\"ref-for-current-iteration①\">current iteration</a>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction④\">playback direction</a> is <code>alternate-reverse</code> increment <var>d</var> by 1.</p>"
            },
            {
              "html": "<p>If <code><var>d</var> % 2 == 0</code>, let the <var>current direction</var> be forwards, otherwise let\n  the <var>current direction</var> be reverse.\n  If <var>d</var> is infinity, let the <var>current direction</var> be forwards.</p>"
            }
          ]
        },
        {
          "html": "<p>If the <var>current direction</var> is forwards then return\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#simple-iteration-progress\" id=\"ref-for-simple-iteration-progress⑤\">simple iteration progress</a>.</p>\n     <p>Otherwise, return <code>1.0 - <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#simple-iteration-progress\" id=\"ref-for-simple-iteration-progress⑥\">simple iteration progress</a></code>.</p>"
        }
      ]
    },
    {
      "name": "transformed progress",
      "href": "https://www.w3.org/TR/web-animations-1/#transformed-progress",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-export=\"\" id=\"transformed-progress\">transformed progress</dfn> is calculated from the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#directed-progress\" id=\"ref-for-directed-progress③\">directed progress</a> using the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#directed-progress\" id=\"ref-for-directed-progress④\">directed progress</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①⓪⑨\">unresolved</a>,\nreturn <span id=\"ref-for-unresolved①①⓪\">unresolved</span>.</p>"
        },
        {
          "html": "Calculate the value of the <var>before flag</var> as follows:",
          "rationale": "determine",
          "steps": [
            {
              "html": "<p>Determine the <var>current direction</var> using the procedure\ndefined in <a href=\"https://www.w3.org/TR/web-animations-1/#calculating-the-directed-progress\">§ 4.9.1 Calculating the directed progress</a>.</p>"
            },
            {
              "html": "<p>If the <var>current direction</var> is <span class=\"prop-value\">forwards</span>,\nlet <var>going forwards</var> be true, otherwise it is false.</p>"
            },
            {
              "html": "<p>The <var>before flag</var> is set if the animation effect is\nin the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-before-phase\" id=\"ref-for-animation-effect-before-phase⑦\">before phase</a> and <var>going forwards</var> is true; or if\nthe animation effect is in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-after-phase\" id=\"ref-for-animation-effect-after-phase⑧\">after phase</a> and <var>going\nforwards</var> is false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of evaluating the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑥⑤\">animation effect</a>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function④\">timing\nfunction</a> passing <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#directed-progress\" id=\"ref-for-directed-progress⑤\">directed progress</a> as the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#input-progress-value\" id=\"ref-for-input-progress-value\">input progress value</a> and <var>before flag</var> as the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#before-flag\" id=\"ref-for-before-flag\">before flag</a>.</p>"
        }
      ]
    },
    {
      "name": "compute missing keyframe offsets",
      "href": "https://www.w3.org/TR/web-animations-1/#compute-missing-keyframe-offsets",
      "html": "To produce <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset\">computed keyframe offsets</a>, we define a procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-missing-keyframe-offsets\">compute missing keyframe offsets</dfn> that takes a sequence of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑨\">keyframes</a>, <var>keyframes</var>, and has the following steps:",
      "rationale": "for",
      "steps": [
        {
          "html": "<p>For each <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe①⓪\">keyframe</a>, in <var>keyframes</var>,\nlet the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①\">computed keyframe offset</a> of the <span id=\"ref-for-keyframe①①\">keyframe</span> be equal to its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-offset\" id=\"ref-for-keyframe-offset⑤\">keyframe offset</a> value.</p>"
        },
        {
          "html": "<p>If <var>keyframes</var> contains more than one <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe①②\">keyframe</a> and the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset②\">computed keyframe offset</a> of\nthe first <span id=\"ref-for-keyframe①③\">keyframe</span> in <var>keyframes</var> is null,\nset the <span id=\"ref-for-computed-keyframe-offset③\">computed keyframe offset</span> of\nthe first <span id=\"ref-for-keyframe①④\">keyframe</span> to 0.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset④\">computed keyframe offset</a> of the last <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe①⑤\">keyframe</a> in <var>keyframes</var> is null, set its <span id=\"ref-for-computed-keyframe-offset⑤\">computed keyframe offset</span> to 1.</p>"
        },
        {
          "html": "calculate the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset⑧\">computed keyframe offset</a> of\neach <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe①⑧\">keyframe</a> between <var>A</var> and <var>B</var> as follows:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"offsetk\">offset<sub><var>k</var></sub></dfn> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset⑨\">computed\nkeyframe offset</a> of a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe①⑨\">keyframe</a> <var>k</var>.</p>"
            },
            {
              "html": "<p>Let <var>n</var> be the number of keyframes <em>between</em> and\nincluding <var>A</var> and <var>B</var> minus 1.</p>"
            },
            {
              "html": "<p>Let <var>index</var> refer to the position of <var>keyframe</var> in the sequence of keyframes between <var>A</var> and <var>B</var> such that the first keyframe\nafter <var>A</var> has an <var>index</var> of 1.</p>"
            },
            {
              "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①⓪\">computed keyframe offset</a> of <var>keyframe</var> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#offsetk\" id=\"ref-for-offsetk\">offset</a><sub><var>A</var></sub> +\n(<span id=\"ref-for-offsetk①\">offset</span><sub><var>B</var></sub> − <span id=\"ref-for-offsetk②\">offset</span><sub><var>A</var></sub>)\n× <var>index</var> / <var>n</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframes\" id=\"ref-for-computed-keyframes\">Computed keyframes</a> are produced using the following procedure.\nNote that this procedure is only performed on a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect⑦\">keyframe effect</a> having\nan <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target⑥\">effect target</a> for which computed property values can be calculated.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>computed keyframes</var> be an empty list of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②⓪\">keyframes</a>.</p>"
        },
        {
          "html": "For each <var>keyframe</var> in the list of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②①\">keyframes</a> specified on\nthis <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect⑧\">keyframe effect</a>, perform the following steps:",
          "rationale": "add",
          "steps": [
            {
              "html": "<p>Add a new empty <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②②\">keyframe</a>, <var>computed keyframe</var>, to <var>computed keyframes</var>.</p>"
            },
            {
              "html": "If conflicts arise when expanding shorthand properties or replacing\nlogical properties with physical properties, apply the following rules\nin order until the conflict is resolved:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<p>Longhand properties override shorthand properties (e.g. <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/css-backgrounds-3/#propdef-border-top-color\" id=\"ref-for-propdef-border-top-color\">border-top-color</a> overrides <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/css-backgrounds-3/#propdef-border-top\" id=\"ref-for-propdef-border-top\">border-top</a>).</p>"
                },
                {
                  "html": "<p>Shorthand properties with fewer longhand components override those\nwith more longhand components (e.g. <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/css-backgrounds-3/#propdef-border-top\" id=\"ref-for-propdef-border-top①\">border-top</a> overrides <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/css-backgrounds-3/#propdef-border-color\" id=\"ref-for-propdef-border-color\">border-color</a>).</p>"
                },
                {
                  "html": "<p>Physical properties override logical properties.</p>"
                },
                {
                  "html": "<p>For shorthand properties with an equal number of longhand\ncomponents, properties whose IDL name (see the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom/#css-property-to-idl-attribute\" id=\"ref-for-css-property-to-idl-attribute\">CSS property to\nIDL attribute</a> algorithm <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-cssom\">[CSSOM]</a>) appears earlier when\nsorted in ascending order by the Unicode codepoints that make up\neach IDL name, override those who appear later.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Apply the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#compute-missing-keyframe-offsets\" id=\"ref-for-compute-missing-keyframe-offsets\">compute missing keyframe offsets</a> to <var>computed keyframes</var>.</p>"
        },
        {
          "html": "<p>Return <var>computed keyframes</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-value\" id=\"ref-for-effect-value③\">effect value</a> of a single property referenced by a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect⑨\">keyframe\neffect</a> as one of its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#target-property\" id=\"ref-for-target-property①\">target properties</a>, for a\ngiven <var>iteration progress</var>, <var>current iteration</var> and <var>underlying value</var> is calculated as follows.",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>iteration progress</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#unresolved\" id=\"ref-for-unresolved①①①\">unresolved</a> abort this\nprocedure.</p>"
        },
        {
          "html": "<p>Let <var>target property</var> be the longhand property for which the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-value\" id=\"ref-for-effect-value④\">effect value</a> is to be calculated.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-type\" id=\"ref-for-animation-type⑤\">animation type</a> of the <var>target property</var> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#not-animatable\" id=\"ref-for-not-animatable②\">not animatable</a> abort this procedure\nsince the effect cannot be applied.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect①⓪\">keyframe effect</a> does not have an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target⑧\">effect target</a>,\nor if the <span id=\"ref-for-keyframe-effect-effect-target⑨\">effect target</span> cannot have computed property values\ncalculated, abort this procedure.</p>"
        },
        {
          "html": "<p>Define the <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"neutral-value-for-composition\">neutral value for composition</dfn> as a value\nwhich, when combined with an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#underlying-value\" id=\"ref-for-underlying-value①\">underlying value</a> using the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation-add\" id=\"ref-for-composite-operation-add\">add</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation②\">composite\noperation</a>, produces the <span id=\"ref-for-underlying-value②\">underlying value</span>.</p>"
        },
        {
          "html": "<p>Let <var>property-specific keyframes</var> be the result of\ngetting the set of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframes\" id=\"ref-for-computed-keyframes①\">computed keyframes</a> for this <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect①①\">keyframe\neffect</a>.</p>"
        },
        {
          "html": "<p>Remove any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②③\">keyframes</a> from <var>property-specific\nkeyframes</var> that do not have a property value for <var>target property</var>.</p>"
        },
        {
          "html": "<p>If <var>property-specific keyframes</var> is empty, return <var>underlying value</var>.</p>"
        },
        {
          "html": "<p>If there is no <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②④\">keyframe</a> in <var>property-specific\nkeyframes</var> with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①①\">computed keyframe offset</a> of\n0, create a new <span id=\"ref-for-keyframe②⑤\">keyframe</span> with a <span id=\"ref-for-computed-keyframe-offset①②\">computed keyframe offset</span> of\n0, a property value set to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#neutral-value-for-composition\" id=\"ref-for-neutral-value-for-composition\">neutral value for\ncomposition</a>, and a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation③\">composite operation</a> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation-add\" id=\"ref-for-composite-operation-add①\">add</a>, and prepend it to the\nbeginning of <var>property-specific keyframes</var>.</p>"
        },
        {
          "html": "<p>Similarly, if there is no <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②⑥\">keyframe</a> in <var>property-specific keyframes</var> with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①③\">computed keyframe\noffset</a> of 1,\ncreate a new <span id=\"ref-for-keyframe②⑦\">keyframe</span> with a <span id=\"ref-for-computed-keyframe-offset①④\">computed keyframe offset</span> of 1,\na property value set to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#neutral-value-for-composition\" id=\"ref-for-neutral-value-for-composition①\">neutral value for composition</a>,\nand a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation④\">composite operation</a> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation-add\" id=\"ref-for-composite-operation-add②\">add</a>, and append it to the\nend of <var>property-specific keyframes</var>.</p>"
        },
        {
          "html": "<p>Let <var>interval endpoints</var> be an empty sequence of\nkeyframes.</p>"
        },
        {
          "html": "<p>Populate <var>interval endpoints</var> by following the steps from\nthe first matching condition from below:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>iteration progress</var> &lt; 0 and there is more\nthan one <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②⑧\">keyframe</a> in <var>property-specific\nkeyframes</var> with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①⑤\">computed keyframe offset</a> of\n0,\n       </dt><dd data-md=\"\">\n        <p>Add the first <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe②⑨\">keyframe</a> in <var>property-specific\nkeyframes</var> to <var>interval endpoints</var>.</p>\n       </dd><dt data-md=\"\">If <var>iteration progress</var> ≥ 1 and there is more\nthan one <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe③⓪\">keyframe</a> in <var>property-specific\nkeyframes</var> with a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①⑥\">computed keyframe offset</a> of\n1,\n       </dt><dd data-md=\"\">\n        <p>Add the last <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe③①\">keyframe</a> in <var>property-specific\nkeyframes</var> to <var>interval endpoints</var>.</p>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        \n      </dd></dl>\n     </div>",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>Append to <var>interval endpoints</var> the last <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe③②\">keyframe</a> in <var>property-specific\nkeyframes</var> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①⑦\">computed keyframe offset</a> is less than\nor equal to <var>iteration progress</var> and less than 1.  If\nthere is no such <span id=\"ref-for-keyframe③③\">keyframe</span> (because, for example,\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-progress\" id=\"ref-for-iteration-progress①⓪\">iteration progress</a> is negative), add the last <span id=\"ref-for-keyframe③④\">keyframe</span> whose <span id=\"ref-for-computed-keyframe-offset①⑧\">computed keyframe offset</span> is 0.</p>"
            },
            {
              "html": "<p>Append to <var>interval endpoints</var> the next <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe③⑤\">keyframe</a> in <var>property-specific keyframes</var> after the one added in the previous step.</p>"
            }
          ]
        },
        {
          "html": "For each <var>keyframe</var> in <var>interval endpoints</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>keyframe</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation⑤\">composite operation</a> that is <em>not</em> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation-replace\" id=\"ref-for-composite-operation-replace\">replace</a>, or <var>keyframe</var> has no <span id=\"ref-for-composite-operation⑥\">composite operation</span> and the <span id=\"ref-for-composite-operation⑦\">composite operation</span> of this <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect①②\">keyframe\neffect</a> is <em>not</em> <span id=\"ref-for-composite-operation-replace①\">replace</span>, then\nperform the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>composite operation to use</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation⑧\">composite operation</a> of <var>keyframe</var>, or if\nit has none, the <span id=\"ref-for-composite-operation⑨\">composite operation</span> of this <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect①③\">keyframe effect</a>.</p>"
                },
                {
                  "html": "<p>Let <var>value to combine</var> be the property value of <var>target property</var> specified on <var>keyframe</var>.</p>"
                },
                {
                  "html": "<p>Replace the property value of <var>target property</var> on <var>keyframe</var> with the result of combining <var>underlying value</var> (<var>V</var><sub>a</sub>) and <var>value to combine</var> (<var>V</var><sub>b</sub>)\nusing the procedure for the <var>composite operation to use</var> corresponding to the <var>target property</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-type\" id=\"ref-for-animation-type⑥\">animation type</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If there is only one keyframe in <var>interval endpoints</var> return the property value of <var>target property</var> on that\nkeyframe.</p>"
        },
        {
          "html": "<p>Let <var>start offset</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset①⑨\">computed keyframe offset</a> of the\nfirst keyframe in <var>interval endpoints</var>.</p>"
        },
        {
          "html": "<p>Let <var>end offset</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset②⓪\">computed keyframe offset</a> of\nlast keyframe in <var>interval endpoints</var>.</p>"
        },
        {
          "html": "<p>Let <var>interval distance</var> be the result of evaluating <code>(<var>iteration progress</var> - <var>start offset</var>) /\n(<var>end offset</var> - <var>start offset</var>)</code>.</p>"
        },
        {
          "html": "<p>Let <var>transformed distance</var> be the result of evaluating\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function⑦\">timing function</a> associated with the first keyframe in <var>interval endpoints</var> passing <var>interval distance</var> as the input progress.</p>"
        },
        {
          "html": "<p>Return the result of applying the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-values-4/#interpolation\" id=\"ref-for-interpolation①\">interpolation procedure</a> defined\nby the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-type\" id=\"ref-for-animation-type⑦\">animation type</a> of the <var>target property</var>,\nto the values of the <var>target property</var> specified on the\ntwo keyframes in <var>interval endpoints</var> taking the first such\nvalue as <var>V</var><sub>start</sub> and the second as <var>V</var><sub>end</sub> and using <var>transformed\ndistance</var> as the interpolation parameter <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "animation composite order",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-composite-order",
      "html": "The relative <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-export=\"\" data-local-lt=\"composite order\" data-lt=\"animation composite order\" id=\"animation-composite-order\">composite order</dfn> of any two <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect②③\">keyframe effects</a>, <var>A</var> and <var>B</var>,\nwithin an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-stack\" id=\"ref-for-effect-stack⑤\">effect stack</a> is\nestablished by comparing their properties as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let the <dfn class=\"dfn-paneled\" data-dfn-for=\"animation effect\" data-dfn-type=\"dfn\" data-lt=\"associated animation\" data-noexport=\"\" id=\"animation-effect-associated-animation\">associated animation of an animation effect</dfn> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation④⑥\">animation</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-with-an-animation\" id=\"ref-for-associated-with-an-animation⑧\">associated</a> with the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑦⑤\">animation effect</a>.</p>"
        },
        {
          "html": "Sort <var>A</var> and <var>B</var> by applying the following conditions in turn until the\norder is resolved,",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>A</var> and <var>B</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-associated-animation\" id=\"ref-for-animation-effect-associated-animation\">associated animations</a> differ\nby <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-class\" id=\"ref-for-animation-class②\">class</a>,\nsort by any inter-class composite order defined\nfor the corresponding classes.</p>"
            },
            {
              "html": "<p>If <var>A</var> and <var>B</var> are still not sorted,\nsort by any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-class\" id=\"ref-for-animation-class③\">class</a>-specific composite order\ndefined by the common class of <var>A</var> and <var>B</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-associated-animation\" id=\"ref-for-animation-effect-associated-animation①\">associated animations</a>.</p>"
            },
            {
              "html": "<p>If <var>A</var> and <var>B</var> are still not sorted,\nsort by the position of their <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-associated-animation\" id=\"ref-for-animation-effect-associated-animation②\">associated animations</a> in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#global-animation-list\" id=\"ref-for-global-animation-list\">global animation list</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composited-value\" id=\"ref-for-composited-value②\">composited value</a> calculated for a CSS <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#target-property\" id=\"ref-for-target-property⑧\">target\nproperty</a> is applied using the following process.",
      "rationale": "establish",
      "steps": [
        {
          "html": "<p>Calculate the <var>base value</var> of the property as\nthe value generated for that property by computing the computed value\nfor that property in the absence of animations.</p>"
        },
        {
          "html": "<p>Establish the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-stack\" id=\"ref-for-effect-stack①⓪\">effect stack</a> for the property (see <a href=\"https://www.w3.org/TR/web-animations-1/#the-effect-stack\">§ 5.4.2 The effect stack</a>).</p>"
        },
        {
          "html": "<p>Calculate the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composited-value\" id=\"ref-for-composited-value③\">composited value</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-stack\" id=\"ref-for-effect-stack①①\">effect\nstack</a> passing in the <var>base value</var> of the property\nas the initial <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#underlying-value\" id=\"ref-for-underlying-value①②\">underlying value</a> (see <a href=\"https://www.w3.org/TR/web-animations-1/#calculating-the-result-of-an-effect-stack\">§ 5.4.3 Calculating the result of an effect stack</a>).</p>"
        },
        {
          "html": "<p>Insert the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composited-value\" id=\"ref-for-composited-value④\">composited value</a> into the CSS cascade at the\nlevel defined for the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-class\" id=\"ref-for-animation-class⑤\">class</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation④⑧\">animation</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect-associated-animation\" id=\"ref-for-animation-effect-associated-animation④\">associated with</a> the\neffect at the top of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-stack\" id=\"ref-for-effect-stack①②\">effect stack</a> established for the target\nproperty.</p>"
        }
      ]
    },
    {
      "html": "perform the following steps:",
      "rationale": "set",
      "steps": [
        {
          "html": "<p>Set <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#replace-state\" id=\"ref-for-replace-state⑤\">replace state</a> to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#removed-replace-state\" id=\"ref-for-removed-replace-state③\">removed</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-create\" id=\"ref-for-concept-event-create②\">Create</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animationplaybackevent\" id=\"ref-for-animationplaybackevent②\">AnimationPlaybackEvent</a></code>, <var>removeEvent</var>.</p>"
        },
        {
          "html": "<p>Set <var>removeEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-type\" id=\"ref-for-dom-event-type②\">type</a></code> attribute to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#remove-event\" id=\"ref-for-remove-event\">remove</a>.</p>"
        },
        {
          "html": "<p>Set <var>removeEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-currenttime\" id=\"ref-for-dom-animationplaybackevent-currenttime②\">currentTime</a></code> attribute\n to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-current-time\" id=\"ref-for-animation-current-time④⑨\">current time</a> of <var>animation</var>.</p>"
        },
        {
          "html": "<p>Set <var>removeEvent</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animationplaybackevent-timelinetime\" id=\"ref-for-dom-animationplaybackevent-timelinetime③\">timelineTime</a></code> attribute to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-current-time\" id=\"ref-for-timeline-current-time⑦\">current time</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline⑤③\">timeline</a> with which <var>animation</var> is associated.</p>"
        },
        {
          "html": "<p>If <var>animation</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-document-for-timing\" id=\"ref-for-animation-document-for-timing⑤\">document for timing</a>, then append <var>removeEvent</var> to its <span id=\"ref-for-animation-document-for-timing⑥\">document for timing</span>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue④\">pending animation event queue</a> along with its target, <var>animation</var>.\n For the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#scheduled-event-time\" id=\"ref-for-scheduled-event-time⑥\">scheduled event time</a>, use the result of\n applying the procedure to convert <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-time-to-origin-relative-time\" id=\"ref-for-timeline-time-to-origin-relative-time④\">timeline time to origin-relative time</a> to\n the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline-current-time\" id=\"ref-for-timeline-current-time⑧\">current time</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#timeline\" id=\"ref-for-timeline⑤④\">timeline</a> with which <var>animation</var> is associated.</p>\n     <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②\">queue a task</a> to <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\" id=\"ref-for-concept-event-dispatch③\">dispatch</a> <var>removeEvent</var> at <var>animation</var>.\n The task source for this task is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source②\">DOM manipulation task\n source</a>.</p>"
        }
      ]
    },
    {
      "name": "Animation/Animation(effect, timeline)",
      "href": "https://www.w3.org/TR/web-animations-1/#dom-animation-animation",
      "html": "Creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animation\" id=\"ref-for-animation③\">Animation</a></code> object using the following procedure.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>animation</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animation\" id=\"ref-for-animation④\">Animation</a></code> object.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-set-the-timeline-of-an-animation\" id=\"ref-for-animation-set-the-timeline-of-an-animation\">set the timeline of an animation</a> on <var>animation</var> passing <var>timeline</var> as the <var>new\ntimeline</var> or, if a <var>timeline</var> argument is missing,\npassing the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#document-default-document-timeline\" id=\"ref-for-document-default-document-timeline⑤\">default document timeline</a> of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/#document\" id=\"ref-for-document⑨\">Document</a></code> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated</a> with the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> that is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object③\">current global object</a>.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-set-the-associated-effect-of-an-animation\" id=\"ref-for-animation-set-the-associated-effect-of-an-animation①\">set the associated effect of an animation</a> on <var>animation</var> passing <var>source</var> as the <var>new\neffect</var>.</p>"
        }
      ]
    },
    {
      "name": "commit computed styles",
      "href": "https://www.w3.org/TR/web-animations-1/#commit-computed-styles",
      "html": "To <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"commit-computed-styles\">commit computed styles</dfn> for an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation⑥⑦\">animation</a>, <var>animation</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>targets</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">set</a> of all <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target①⑤\">effect targets</a> for <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑧④\">animation effects</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-with-an-animation\" id=\"ref-for-associated-with-an-animation①①\">associated</a> with <var>animation</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>target</var> in <var>targets</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>target</var> is not an element capable of having a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-style-attr/#style-attribute\" id=\"ref-for-style-attribute\">style\n  attribute</a> <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-css-style-attr\">[CSS-STYLE-ATTR]</a> (for example, it is a pseudo-element or is an element in\n  a document format for which style attributes are not defined) <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#nomodificationallowederror\" id=\"ref-for-nomodificationallowederror\">NoModificationAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If, after applying any pending style changes, <var>target</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#being-rendered\" id=\"ref-for-being-rendered\">being rendered</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥\">throw</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>inline style</var> be the result of getting the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/cssom-1/#css-declaration-block\" id=\"ref-for-css-declaration-block\">CSS declaration block</a> corresponding to <var>target</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-style-attr/#style-attribute\" id=\"ref-for-style-attribute①\">style attribute</a>.\n  If <var>target</var> does not <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-attribute-has\" id=\"ref-for-concept-element-attribute-has\">have</a> a <span id=\"ref-for-style-attribute②\">style attribute</span>,\n  let <var>inline style</var> be a new empty <span id=\"ref-for-css-declaration-block①\">CSS declaration block</span> with\n  the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/cssom-1/#cssstyledeclaration-owner-node\" id=\"ref-for-cssstyledeclaration-owner-node\">owner node</a> set to <var>target</var>.</p>"
            },
            {
              "html": "<p>Let <var>targeted properties</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">set</a> of physical longhand properties\n  that are a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#target-property\" id=\"ref-for-target-property①②\">target property</a> for at least one <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑧⑤\">animation effect</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-with-an-animation\" id=\"ref-for-associated-with-an-animation①②\">associated</a> with <var>animation</var> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target①⑥\">effect target</a> is <var>target</var>.</p>"
            },
            {
              "html": "For each property, <var>property</var>, in <var>targeted properties</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>partialEffectStack</var> be a copy of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-stack\" id=\"ref-for-effect-stack①④\">effect stack</a> for <var>property</var> on <var>target</var>.</p>"
                },
                {
                  "html": "<p>If <var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#replace-state\" id=\"ref-for-replace-state⑨\">replace state</a> is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#removed-replace-state\" id=\"ref-for-removed-replace-state⑥\">removed</a>,\n   add all <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑧⑥\">animation effects</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-with-an-animation\" id=\"ref-for-associated-with-an-animation①③\">associated</a> with <var>animation</var> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target①⑦\">effect target</a> is <var>target</var> and which include <var>property</var> as a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#target-property\" id=\"ref-for-target-property①③\">target property</a> to <var>partialEffectStack</var>.</p>"
                },
                {
                  "html": "<p>Remove from <var>partialEffectStack</var> any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-effect\" id=\"ref-for-animation-effect⑧⑦\">animation effects</a> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#associated-with-an-animation\" id=\"ref-for-associated-with-an-animation①④\">associated</a> <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#concept-animation\" id=\"ref-for-concept-animation⑥⑧\">animation</a> has a higher <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-composite-order\" id=\"ref-for-animation-composite-order②\">composite order</a> than <var>animation</var>.</p>"
                },
                {
                  "html": "<p>Let <var>effect value</var> be the result of calculating the result of <var>partialEffectStack</var> for <var>property</var> using <var>target</var>’s computed\n   style (see <a href=\"https://www.w3.org/TR/web-animations-1/#calculating-the-result-of-an-effect-stack\">§ 5.4.3 Calculating the result of an effect stack</a>).</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/cssom-1/#set-a-css-declaration\" id=\"ref-for-set-a-css-declaration\">Set a CSS declaration</a> <var>property</var> for <var>effect value</var> in <var>inline style</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/cssom-1/#update-style-attribute-for\" id=\"ref-for-update-style-attribute-for\">Update style attribute for</a> <var>inline style</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "update the timing properties of an animation effect",
      "href": "https://www.w3.org/TR/web-animations-1/#update-the-timing-properties-of-an-animation-effect",
      "html": "To <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-the-timing-properties-of-an-animation-effect\">update the timing properties of an animation effect</dfn>, <var>effect</var>,\nfrom an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-effecttiming\" id=\"ref-for-dictdef-effecttiming⑦\">EffectTiming</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-optionaleffecttiming\" id=\"ref-for-dictdef-optionaleffecttiming③\">OptionalEffectTiming</a></code> object, <var>input</var>, perform\nthe following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-iterationstart\" id=\"ref-for-dom-effecttiming-iterationstart④\">iterationStart</a></code> member of <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a> and is less than zero, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑦\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
        },
        {
          "html": "<p>If the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-iterations\" id=\"ref-for-dom-effecttiming-iterations③\">iterations</a></code> member of <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>,\nand is less than zero or is the value <code class=\"esvalue\">NaN</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑧\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
        },
        {
          "html": "<p>If the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-duration\" id=\"ref-for-dom-effecttiming-duration⑤\">duration</a></code> member of <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>,\nand is less than zero or is the value <code class=\"esvalue\">NaN</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑨\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
        },
        {
          "html": "<p>If the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-easing\" id=\"ref-for-dom-effecttiming-easing①\">easing</a></code> member of <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a> but cannot be parsed using the <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-easing-1/#typedef-easing-function\" id=\"ref-for-typedef-easing-function①\" title=\"Expands to: linear\">&lt;easing-function&gt;</a> production <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-css-easing-1\">[CSS-EASING-1]</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⓪\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
        },
        {
          "html": "<p>Assign each member that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a> in <var>input</var> to the\ncorresponding timing property of <var>effect</var> as follows:</p>\n     <ul>\n      <li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-delay\" id=\"ref-for-dom-effecttiming-delay①\">delay</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#start-delay\" id=\"ref-for-start-delay①⑦\">start delay</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-enddelay\" id=\"ref-for-dom-effecttiming-enddelay①\">endDelay</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#end-delay\" id=\"ref-for-end-delay⑤\">end delay</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-fill\" id=\"ref-for-dom-effecttiming-fill③\">fill</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#fill-mode\" id=\"ref-for-fill-mode①④\">fill mode</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-iterationstart\" id=\"ref-for-dom-effecttiming-iterationstart⑤\">iterationStart</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-start\" id=\"ref-for-iteration-start①⓪\">iteration start</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-iterations\" id=\"ref-for-dom-effecttiming-iterations④\">iterations</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-count\" id=\"ref-for-iteration-count①⑥\">iteration count</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-duration\" id=\"ref-for-dom-effecttiming-duration⑥\">duration</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-duration\" id=\"ref-for-iteration-duration①⑤\">iteration duration</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-direction\" id=\"ref-for-dom-effecttiming-direction①\">direction</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction⑥\">playback direction</a></p>\n      </li><li data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-easing\" id=\"ref-for-dom-effecttiming-easing②\">easing</a></code> → <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function⑨\">timing function</a></p>\n     </li></ul>"
        }
      ]
    },
    {
      "name": "KeyframeEffect/KeyframeEffect(target, keyframes, options)",
      "href": "https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-keyframeeffect",
      "html": "Creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect②\">KeyframeEffect</a></code> object using the following procedure:",
      "rationale": "create",
      "steps": [
        {
          "html": "<p>Create a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect③\">KeyframeEffect</a></code> object, <var>effect</var>.</p>\n       <p></p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-target-target-element\" id=\"ref-for-effect-target-target-element④\">target element</a> of <var>effect</var> to <var>target</var>.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-target-target-pseudo-selector\" id=\"ref-for-effect-target-target-pseudo-selector②\">target pseudo-selector</a> to the result corresponding to the first\nmatching condition from below.</p>\n        <dl>\n         <dt data-md=\"\">If <var>options</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-keyframeeffectoptions\" id=\"ref-for-dictdef-keyframeeffectoptions①\">KeyframeEffectOptions</a></code> object with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffectoptions-pseudoelement\" id=\"ref-for-dom-keyframeeffectoptions-pseudoelement\">pseudoElement</a></code> property,\n         </dt><dd data-md=\"\">\n          <p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-target-target-pseudo-selector\" id=\"ref-for-effect-target-target-pseudo-selector③\">target pseudo-selector</a> to the value of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffectoptions-pseudoelement\" id=\"ref-for-dom-keyframeeffectoptions-pseudoelement①\">pseudoElement</a></code> property.</p>\n          <p>When assigning this property, the error-handling defined for the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-pseudoelement\" id=\"ref-for-dom-keyframeeffect-pseudoelement①\">pseudoElement</a></code> setter on the interface is applied.\nIf the setter requires an exception to be thrown, this procedure\nmust throw the same exception and abort all further steps.</p>\n         </dd><dt data-md=\"\">Otherwise,\n         </dt><dd data-md=\"\">\n          <p>Set the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#effect-target-target-pseudo-selector\" id=\"ref-for-effect-target-target-pseudo-selector④\">target pseudo-selector</a> to <code>null</code>.</p>\n        </dd></dl>"
        },
        {
          "html": "<p>Let <var>timing input</var> be the result corresponding to the first\nmatching condition from below.</p>\n        <dl>\n         <dt data-md=\"\">If <var>options</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-keyframeeffectoptions\" id=\"ref-for-dictdef-keyframeeffectoptions②\">KeyframeEffectOptions</a></code> object,\n         </dt><dd data-md=\"\">\n          <p>Let <var>timing input</var> be <var>options</var>.</p>\n         </dd><dt data-md=\"\">Otherwise (if <var>options</var> is a <code>double</code>),\n         </dt><dd data-md=\"\">\n          <p>Let <var>timing input</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-effecttiming\" id=\"ref-for-dictdef-effecttiming⑨\">EffectTiming</a></code> object with all members set to their default values\nand <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-duration\" id=\"ref-for-dom-effecttiming-duration⑦\">duration</a></code> set to <var>options</var>.</p>\n        </dd></dl>"
        },
        {
          "html": "<p>Call the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#update-the-timing-properties-of-an-animation-effect\" id=\"ref-for-update-the-timing-properties-of-an-animation-effect①\">update the timing properties of an\nanimation effect</a> of <var>effect</var> from <var>timing input</var>.</p>\n        <p>If that procedure causes an exception to be thrown, propagate the\nexception and abort this procedure.</p>"
        },
        {
          "html": "<p>If <var>options</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-keyframeeffectoptions\" id=\"ref-for-dictdef-keyframeeffectoptions③\">KeyframeEffectOptions</a></code> object, assign\nthe <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-composite\" id=\"ref-for-dom-keyframeeffect-composite①\">composite</a></code> property of <var>effect</var> to\nthe corresponding value from <var>options</var>.</p>\n        <p>When assigning this property, the error-handling defined for the\ncorresponding setter on the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect④\">KeyframeEffect</a></code> interface is applied.\nIf the setter requires an exception to be thrown for the value\nspecified by <var>options</var>, this procedure must <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①①\">throw</a> the same exception and abort all further steps.</p>"
        },
        {
          "html": "<p>Initialize the set of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe④④\">keyframes</a> by performing the procedure\ndefined for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-setkeyframes\" id=\"ref-for-dom-keyframeeffect-setkeyframes①\">setKeyframes()</a></code> passing <var>keyframes</var> as the input.</p>"
        }
      ]
    },
    {
      "name": "KeyframeEffect/KeyframeEffect(source)",
      "href": "https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-keyframeeffect-source",
      "html": "Creates a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect⑤\">KeyframeEffect</a></code> object with the same properties\nas <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-keyframeeffect-source-source\" id=\"ref-for-dom-keyframeeffect-keyframeeffect-source-source①\">source</a></code> using the following procedure:",
      "rationale": "create",
      "steps": [
        {
          "html": "<p>Create a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect⑥\">KeyframeEffect</a></code> object, <var>effect</var>.</p>"
        },
        {
          "html": "<p>Set the following properties of <var>effect</var> using the\ncorresponding values of <var>source</var>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target①⑧\">effect target</a>,</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe④⑥\">keyframes</a>,</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#composite-operation\" id=\"ref-for-composite-operation①②\">composite operation</a>, and</p>\n         </li><li data-md=\"\">\n          <p>all specified timing properties:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#start-delay\" id=\"ref-for-start-delay①⑧\">start delay</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#end-delay\" id=\"ref-for-end-delay⑦\">end delay</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#fill-mode\" id=\"ref-for-fill-mode①⑤\">fill mode</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-start\" id=\"ref-for-iteration-start①①\">iteration start</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-count\" id=\"ref-for-iteration-count①⑦\">iteration count</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#iteration-duration\" id=\"ref-for-iteration-duration①⑦\">iteration duration</a>,</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#playback-direction\" id=\"ref-for-playback-direction⑦\">playback direction</a>, and</p>\n           </li><li data-md=\"\">\n            <p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function①⓪\">timing function</a>.</p>\n          </li></ul>\n        </li></ul>"
        }
      ]
    },
    {
      "name": "KeyframeEffect/getKeyframes()",
      "href": "https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-getkeyframes",
      "html": "Since <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑤⓪\">keyframes</a> are represented by a partially open-ended dictionary\ntype that is not currently able to be expressed with WebIDL, the procedure\nused to prepare the result of this method is defined in prose below:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty sequence of objects.</p>"
        },
        {
          "html": "Let <var>keyframes</var> be one of the following:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If this <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect③⑥\">keyframe effect</a> is associated with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/css-animations-2/#cssanimation\" id=\"ref-for-cssanimation\">CSSAnimation</a></code>, and its <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑤①\">keyframes</a> have not been replaced\nby a successful call to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-setkeyframes\" id=\"ref-for-dom-keyframeeffect-setkeyframes②\">setKeyframes()</a></code>;\nthe <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframes\" id=\"ref-for-computed-keyframes④\">computed keyframes</a> for this <span id=\"ref-for-keyframe-effect③⑦\">keyframe effect</span>.</p>"
            },
            {
              "html": "<p>Otherwise, the result of applying the procedure <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#compute-missing-keyframe-offsets\" id=\"ref-for-compute-missing-keyframe-offsets②\">compute missing keyframe offsets</a> to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑤②\">keyframes</a> for this <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-effect\" id=\"ref-for-keyframe-effect③⑧\">keyframe effect</a>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>keyframe</var> in <var>keyframes</var> perform the following steps:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "<p>Initialize a dictionary object, <var>output keyframe</var>, using\nthe following definition:</p>\n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"idl-code\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-basecomputedkeyframe\"><code><c- g=\"\">BaseComputedKeyframe</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-basecomputedkeyframe\"></a></dfn> {\n     <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②②\"><c- b=\"\">double</c-></a>?                  <dfn class=\"dfn-paneled idl-code\" data-default=\"null\" data-dfn-for=\"BaseComputedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"double?                  \" id=\"dom-basecomputedkeyframe-offset\"><code><c- g=\"\">offset</c-></code></dfn> = <c- b=\"\">null</c->;\n     <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②③\"><c- b=\"\">double</c-></a>                   <dfn class=\"dfn-paneled idl-code\" data-dfn-for=\"BaseComputedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"double                   \" id=\"dom-basecomputedkeyframe-computedoffset\"><code><c- g=\"\">computedOffset</c-></code></dfn>;\n     <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑦\"><c- b=\"\">DOMString</c-></a>                <dfn class=\"dfn-paneled idl-code\" data-default=\"&quot;linear&quot;\" data-dfn-for=\"BaseComputedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString                \" id=\"dom-basecomputedkeyframe-easing\"><code><c- g=\"\">easing</c-></code></dfn> = \"linear\";\n     <a data-link-type=\"idl-name\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto\"><c- n=\"\">CompositeOperationOrAuto</c-></a> <dfn class=\"dfn-paneled idl-code\" data-default=\"&quot;auto&quot;\" data-dfn-for=\"BaseComputedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"CompositeOperationOrAuto \" id=\"dom-basecomputedkeyframe-composite\"><code><c- g=\"\">composite</c-></code></dfn> = \"auto\";\n};\n</pre>"
            },
            {
              "html": "<p>Set the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basecomputedkeyframe-offset\" id=\"ref-for-dom-basecomputedkeyframe-offset\">offset</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basecomputedkeyframe-computedoffset\" id=\"ref-for-dom-basecomputedkeyframe-computedoffset\">computedOffset</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basecomputedkeyframe-easing\" id=\"ref-for-dom-basecomputedkeyframe-easing\">easing</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basecomputedkeyframe-composite\" id=\"ref-for-dom-basecomputedkeyframe-composite\">composite</a></code> members of <var>output keyframe</var> to the respective <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-offset\" id=\"ref-for-keyframe-offset⑦\">keyframe offset</a>, <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset②⑤\">computed keyframe offset</a>,\nkeyframe-specific <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function①②\">timing function</a>, and <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-specific-composite-operation\" id=\"ref-for-keyframe-specific-composite-operation②\">keyframe-specific composite operation</a> values of <var>keyframe</var>.</p>"
            },
            {
              "html": "For each animation property-value pair in <var>keyframe</var>, <var>declaration</var>, perform the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>property name</var> be the result of applying the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-property-name-to-idl-attribute-name\" id=\"ref-for-animation-property-name-to-idl-attribute-name\">animation property name to IDL attribute name</a> algorithm\nto the property name of <var>declaration</var>.</p>"
                },
                {
                  "html": "<p>Let <var>IDL value</var> be the result of serializing\nthe property value of <var>declaration</var> by passing <var>declaration</var> to the algorithm to <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom/#serialize-a-css-value\" id=\"ref-for-serialize-a-css-value\">serialize a CSS\nvalue</a> <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-cssom\">[CSSOM]</a>.</p>"
                },
                {
                  "html": "<p>Let <var>value</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#DOMString-to-es\" id=\"ref-for-DOMString-to-es\">converting</a> <var>IDL value</var> to an\nECMAScript String value.</p>"
                },
                {
                  "html": "<p>Call the <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc\" id=\"ref-for-sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc\">[[DefineOwnProperty]]</a> internal method on <var>output keyframe</var> with property name <var>property\nname</var>,\nProperty Descriptor {\n[[Writable]]: <span class=\"esvalue\">true</span>,\n[[Enumerable]]: <span class=\"esvalue\">true</span>,\n[[Configurable]]: <span class=\"esvalue\">true</span>,\n[[Value]]: <var>value</var> }\nand Boolean flag <span class=\"esvalue\">false.</span></p>"
                }
              ]
            },
            {
              "html": "<p>Append <var>output keyframe</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "animation property name to IDL attribute name",
      "href": "https://www.w3.org/TR/web-animations-1/#animation-property-name-to-idl-attribute-name",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"animation-property-name-to-idl-attribute-name\">animation property name to IDL attribute name</dfn> algorithm for <var>property</var> is as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>property</var> follows the <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-variables-1/#typedef-custom-property-name\" id=\"ref-for-typedef-custom-property-name\">&lt;custom-property-name&gt;</a> production,\nreturn <var>property</var>.</p>"
        },
        {
          "html": "<p>If <var>property</var> refers to the CSS <a class=\"property css\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css2/#propdef-float\" id=\"ref-for-propdef-float\">float</a> property,\nreturn the string \"cssFloat\".</p>"
        },
        {
          "html": "<p>If <var>property</var> refers to the CSS <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/motion-1/#propdef-offset\" id=\"ref-for-propdef-offset\">offset</a> property,\nreturn the string \"cssOffset\".</p>"
        },
        {
          "html": "<p>Otherwise, return the result of applying the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom/#css-property-to-idl-attribute\" id=\"ref-for-css-property-to-idl-attribute①\">CSS property to IDL\nattribute</a> algorithm <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-cssom\">[CSSOM]</a> to <var>property</var>.</p>"
        }
      ]
    },
    {
      "name": "IDL attribute name to animation property name",
      "href": "https://www.w3.org/TR/web-animations-1/#idl-attribute-name-to-animation-property-name",
      "html": "The <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"idl-attribute-name-to-animation-property-name\">IDL attribute name to animation property name</dfn> algorithm for <var>attribute</var> is as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>attribute</var> conforms to the <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-variables-1/#typedef-custom-property-name\" id=\"ref-for-typedef-custom-property-name①\">&lt;custom-property-name&gt;</a> production,\nreturn <var>attribute</var>.</p>"
        },
        {
          "html": "<p>If <var>attribute</var> is the string \"cssFloat\", then return\nan animation property representing the CSS <a class=\"property css\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css2/#propdef-float\" id=\"ref-for-propdef-float①\">float</a> property.</p>"
        },
        {
          "html": "<p>If <var>attribute</var> is the string \"cssOffset\", then return\nan animation property representing the CSS <a class=\"property css\" data-link-type=\"property\" href=\"https://www.w3.org/TR/motion-1/#propdef-offset\" id=\"ref-for-propdef-offset①\">offset</a> property.</p>"
        },
        {
          "html": "<p>Otherwise, return the result of applying the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom/#idl-attribute-to-css-property\" id=\"ref-for-idl-attribute-to-css-property\">IDL attribute to CSS\nproperty</a> algorithm <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-cssom\">[CSSOM]</a> to <var>attribute</var>.</p>"
        }
      ]
    },
    {
      "name": "check the completion record",
      "href": "https://www.w3.org/TR/web-animations-1/#check-the-completion-record",
      "html": "The instruction, <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-the-completion-record\">check the completion record</dfn> of <var>result</var>,\nwhere <var>result</var> is a <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type\">completion record</a> from calling\nan ECMAScript operation, is equivalent to the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>result</var> is an <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①\">abrupt completion</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①③\">throw</a> the exception contained in the [[value]] field of <var>result</var> and abort the procedure.</p>"
        },
        {
          "html": "<p>Replace <var>result</var> with the value contained in the [[value]] field\nof <var>result</var>.</p>"
        }
      ]
    },
    {
      "html": "and returns a map from either property names to DOMString values if <var>allow\nlists</var> is false, or from property names to sequences of DOMString values\notherwise, using the following procedure:",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#es-to-dictionary\" id=\"ref-for-es-to-dictionary\">convert an ECMAScript\nvalue to a dictionary type</a> <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-webidl\">[WEBIDL]</a> with <var>keyframe input</var> as the ECMAScript value, and the dictionary type depending on the value of\nthe <var>allow lists</var> flag as follows:</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>allow lists</var> is true,\n       </dt><dd data-md=\"\">\n        <p>Use the following dictionary type:</p>\n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"idl-code\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-basepropertyindexedkeyframe\"><code><c- g=\"\">BasePropertyIndexedKeyframe</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-basepropertyindexedkeyframe\"></a></dfn> {\n    (<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②④\"><c- b=\"\">double</c-></a>? <c- b=\"\">or</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②⑤\"><c- b=\"\">double</c-></a>?&gt;)                         <dfn class=\"idl-code\" data-default=\"[]\" data-dfn-for=\"BasePropertyIndexedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"(double? or sequence<double?>)                         \" id=\"dom-basepropertyindexedkeyframe-offset\"><code><c- g=\"\">offset</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basepropertyindexedkeyframe-offset\"></a></dfn> = [];\n    (<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑧\"><c- b=\"\">DOMString</c-></a> <c- b=\"\">or</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence②\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑨\"><c- b=\"\">DOMString</c-></a>&gt;)                     <dfn class=\"idl-code\" data-default=\"[]\" data-dfn-for=\"BasePropertyIndexedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"(DOMString or sequence<DOMString>)                     \" id=\"dom-basepropertyindexedkeyframe-easing\"><code><c- g=\"\">easing</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basepropertyindexedkeyframe-easing\"></a></dfn> = [];\n    (<a data-link-type=\"idl-name\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto①\"><c- n=\"\">CompositeOperationOrAuto</c-></a> <c- b=\"\">or</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence③\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto②\"><c- n=\"\">CompositeOperationOrAuto</c-></a>&gt;) <dfn class=\"idl-code\" data-default=\"[]\" data-dfn-for=\"BasePropertyIndexedKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"(CompositeOperationOrAuto or sequence<CompositeOperationOrAuto>) \" id=\"dom-basepropertyindexedkeyframe-composite\"><code><c- g=\"\">composite</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basepropertyindexedkeyframe-composite\"></a></dfn> = [];\n};\n</pre>\n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        <p>Use the following dictionary type,</p>\n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"idl-code\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-basekeyframe\"><code><c- g=\"\">BaseKeyframe</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-basekeyframe\"></a></dfn> {\n    <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②⑥\"><c- b=\"\">double</c-></a>?                  <dfn class=\"idl-code\" data-default=\"null\" data-dfn-for=\"BaseKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"double?                  \" id=\"dom-basekeyframe-offset\"><code><c- g=\"\">offset</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basekeyframe-offset\"></a></dfn> = <c- b=\"\">null</c->;\n    <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①⓪\"><c- b=\"\">DOMString</c-></a>                <dfn class=\"idl-code\" data-default=\"&quot;linear&quot;\" data-dfn-for=\"BaseKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString                \" id=\"dom-basekeyframe-easing\"><code><c- g=\"\">easing</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basekeyframe-easing\"></a></dfn> = \"linear\";\n    <a data-link-type=\"idl-name\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto③\"><c- n=\"\">CompositeOperationOrAuto</c-></a> <dfn class=\"idl-code\" data-default=\"&quot;auto&quot;\" data-dfn-for=\"BaseKeyframe\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"CompositeOperationOrAuto \" id=\"dom-basekeyframe-composite\"><code><c- g=\"\">composite</c-></code><a class=\"self-link\" href=\"https://www.w3.org/TR/web-animations-1/#dom-basekeyframe-composite\"></a></dfn> = \"auto\";\n};\n</pre>\n      </dd></dl>\n     </div>\n     <p>Store the result of this procedure as <var>keyframe output</var>.</p>"
        },
        {
          "html": "Build up a list of <var>animatable properties</var> as follows:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>animatable properties</var> be a list of property\nnames (including shorthand properties that have longhand sub-properties\nthat are animatable) that can be animated by the implementation.</p>"
            },
            {
              "html": "<p>Convert each property name in <var>animatable properties</var> to the equivalent IDL attribute by applying the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#animation-property-name-to-idl-attribute-name\" id=\"ref-for-animation-property-name-to-idl-attribute-name①\">animation property name to IDL attribute name</a> algorithm.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>input properties</var> be the result of calling the <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-enumerableownnames\" id=\"ref-for-sec-enumerableownnames\">EnumerableOwnNames</a> operation with <var>keyframe input</var> as\nthe object.</p>"
        },
        {
          "html": "<p>Make up a new list <var>animation properties</var> that consists of\nall of the properties that are in <em>both</em> <var>input\nproperties</var> and <var>animatable properties</var>, <em>or</em> which are in <var>input properties</var> and conform to the <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-variables-1/#typedef-custom-property-name\" id=\"ref-for-typedef-custom-property-name②\">&lt;custom-property-name&gt;</a> production.</p>"
        },
        {
          "html": "<p>Sort <var>animation properties</var> in ascending order by the Unicode\ncodepoints that define each property name.</p>"
        },
        {
          "html": "For each <var>property name</var> in <var>animation properties</var>,",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>raw value</var> be the result of calling the <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-ordinary-object-internal-methods-and-internal-slots-get-p-receiver\" id=\"ref-for-sec-ordinary-object-internal-methods-and-internal-slots-get-p-receiver\">[[Get]]</a> internal method on <var>keyframe input</var>, with <var>property\nname</var> as the property key and <var>keyframe input</var> as the\nreceiver.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#check-the-completion-record\" id=\"ref-for-check-the-completion-record\">Check the completion record</a> of <var>raw value</var>.</p>"
            },
            {
              "html": "<p>Convert <var>raw value</var> to a DOMString or sequence of DOMStrings <var>property values</var> as follows:</p>\n       <div class=\"switch\">\n        <dl>\n         <dt data-md=\"\">If <var>allow lists</var> is true,\n         </dt><dd data-md=\"\">\n          <p>Let <var>property values</var> be the result of converting <var>raw\nvalue</var> to IDL type <code>(DOMString or\nsequence&lt;DOMString&gt;)</code> using the <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value\">procedures\ndefined for converting an ECMAScript value to an IDL value</a> <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-webidl\">[WEBIDL]</a>.</p>\n          <p>If <var>property values</var> is a single DOMString, replace <var>property values</var> with a sequence of DOMStrings with the\noriginal value of <var>property values</var> as the only element.</p>\n         </dd><dt data-md=\"\">Otherwise,\n         </dt><dd data-md=\"\">\n          <p>Let <var>property values</var> be the result of converting <var>raw\nvalue</var> to a DOMString using the <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#es-to-DOMString\" id=\"ref-for-es-to-DOMString\">procedure for converting an ECMAScript value to\na DOMString</a> <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/web-animations-1/#biblio-webidl\">[WEBIDL]</a>.</p>\n        </dd></dl>\n       </div>"
            },
            {
              "html": "<p>Calculate the <var>normalized property name</var> as the result of\napplying the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#idl-attribute-name-to-animation-property-name\" id=\"ref-for-idl-attribute-name-to-animation-property-name\">IDL attribute name to animation property name</a> algorithm to <var>property name</var>.</p>"
            },
            {
              "html": "<p>Add a property to <var>keyframe output</var> with <var>normalized\nproperty name</var> as the property name, and <var>property values</var> as the property value.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>keyframe output</var>.</p>"
        }
      ]
    },
    {
      "name": "process a keyframes argument",
      "href": "https://www.w3.org/TR/web-animations-1/#process-a-keyframes-argument",
      "html": "The procedure to <dfn class=\"dfn-paneled\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-a-keyframes-argument\">process a keyframes argument</dfn> takes a nullable\nECMAScript object, <var>object</var>, as input and returns a sequence of\nkeyframes using the following procedure:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>object</var> is null, return an empty sequence of keyframes.</p>"
        },
        {
          "html": "<p>Let <var>processed keyframes</var> be an empty sequence of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑤⑨\">keyframes</a>.</p>"
        },
        {
          "html": "<p>Let <var>method</var> be the result of <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-getmethod\" id=\"ref-for-sec-getmethod\">GetMethod</a>(<var>object</var>, <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-well-known-symbols\" id=\"ref-for-sec-well-known-symbols\">@@iterator</a>).</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#check-the-completion-record\" id=\"ref-for-check-the-completion-record①\">Check the completion record</a> of <var>method</var>.</p>"
        },
        {
          "html": "<p>Perform the steps corresponding to the first matching condition from below,</p>\n     <div class=\"switch\">\n      <dl>\n       <dt data-md=\"\">If <var>method</var> is not <span class=\"esvalue\">undefined</span>,\n       </dt><dd data-md=\"\">\n        \n       </dd><dt data-md=\"\">Otherwise,\n       </dt><dd data-md=\"\">\n        \n      </dd></dl>\n     </div>",
          "rationale": ".switch",
          "steps": [
            {
              "html": "<p>Let <var>iter</var> be <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-getiterator\" id=\"ref-for-sec-getiterator\">GetIterator</a>(<var>object</var>, <var>method</var>).</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#check-the-completion-record\" id=\"ref-for-check-the-completion-record②\">Check the completion record</a> of <var>iter</var>.</p>"
            },
            {
              "html": "Repeat:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>next</var> be <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-iteratorstep\" id=\"ref-for-sec-iteratorstep\">IteratorStep</a>(<var>iter</var>).</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#check-the-completion-record\" id=\"ref-for-check-the-completion-record③\">Check the completion record</a> of <var>next</var>.</p>"
                },
                {
                  "html": "<p>If <var>next</var> is false abort this loop.</p>"
                },
                {
                  "html": "<p>Let <var>nextItem</var> be <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-iteratorvalue\" id=\"ref-for-sec-iteratorvalue\">IteratorValue</a>(next).</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#check-the-completion-record\" id=\"ref-for-check-the-completion-record④\">Check the completion record</a> of <var>nextItem</var>.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values\">Type</a>(<var>nextItem</var>) is not Undefined, Null or Object, then\nthrow a <span class=\"exceptionname\">TypeError</span> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>Append to <var>processed keyframes</var> the result of\nrunning the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#process-a-keyframe-like-object\" id=\"ref-for-process-a-keyframe-like-object\">process a keyframe-like object</a> passing <var>nextItem</var> as the <var>keyframe input</var> and with the <var>allow lists</var> flag set to false.</p>"
                }
              ]
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>property-indexed keyframe</var> be the result of\nrunning the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#process-a-keyframe-like-object\" id=\"ref-for-process-a-keyframe-like-object①\">process a keyframe-like object</a> passing <var>object</var> as the <var>keyframe input</var> and with the <var>allow lists</var> flag set to true.</p>"
                },
                {
                  "html": "For each member, <var>m</var>, in <var>property-indexed\nkeyframe</var>, perform the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>property name</var> be the key for <var>m</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>property name</var> is \"composite\", or\n\"easing\", or \"offset\", skip the\nremaining steps in this loop and continue from the next member\nin <var>property-indexed keyframe</var> after <var>m</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>property values</var> be the value for <var>m</var>.</p>"
                    },
                    {
                      "html": "<p>Let <var>property keyframes</var> be an empty sequence of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥⓪\">keyframes</a>.</p>"
                    },
                    {
                      "html": "For each value, <var>v</var>, in <var>property values</var> perform the following steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>k</var> be a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥①\">keyframe</a> with a null <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-offset\" id=\"ref-for-keyframe-offset①⓪\">keyframe offset</a>.</p>"
                        },
                        {
                          "html": "<p>Add the property-value pair, <var>property name</var> → <var>v</var>, to <var>k</var>.</p>"
                        },
                        {
                          "html": "<p>Append <var>k</var> to <var>property keyframes</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Apply the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#compute-missing-keyframe-offsets\" id=\"ref-for-compute-missing-keyframe-offsets③\">compute missing keyframe\noffsets</a> to <var>property keyframes</var>.</p>"
                    },
                    {
                      "html": "<p>Add <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥②\">keyframes</a> in <var>property keyframes</var> to <var>processed keyframes</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Sort <var>processed keyframes</var> by the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset②⑥\">computed\nkeyframe offset</a> of each <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥③\">keyframe</a> in increasing order.</p>"
                },
                {
                  "html": "<p>Merge adjacent <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥④\">keyframes</a> in <var>processed keyframes</var> when they have equal <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#computed-keyframe-offset\" id=\"ref-for-computed-keyframe-offset②⑦\">computed keyframe offsets</a>.</p>"
                },
                {
                  "html": "<p>Let <var>offsets</var> be a sequence of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-nullable-type\" id=\"ref-for-dfn-nullable-type\">nullable</a> <code>double</code> values assigned based on the type of the\n\"offset\" member of the <var>property-indexed\nkeyframe</var> as follows:</p>\n          <div class=\"switch\">\n           <dl>\n            <dt data-md=\"\"><code>sequence&lt;double?&gt;</code>,\n            </dt><dd data-md=\"\">\n             <p>The value of \"offset\" as-is.</p>\n            </dd><dt data-md=\"\"><code>double?</code>,\n            </dt><dd data-md=\"\">\n             <p>A sequence of length one with the value of \"offset\"\nas its single item, i.e.\n«&nbsp;<code>offset</code>&nbsp;»,</p>\n           </dd></dl>\n          </div>"
                },
                {
                  "html": "<p>Assign each value in <var>offsets</var> to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-offset\" id=\"ref-for-keyframe-offset①①\">keyframe\noffset</a> of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥⑤\">keyframe</a> with corresponding position in <var>processed keyframes</var> until the end of either sequence is\nreached.</p>"
                },
                {
                  "html": "<p>Let <var>easings</var> be a sequence of <code>DOMString</code> values assigned based on the type of the \"easing\" member\nof the <var>property-indexed keyframe</var> as follows:</p>\n          <div class=\"switch\">\n           <dl>\n            <dt data-md=\"\"><code>sequence&lt;DOMString&gt;</code>,\n            </dt><dd data-md=\"\">\n             <p>The value of \"easing\" as-is.</p>\n            </dd><dt data-md=\"\"><code>DOMString</code>,\n            </dt><dd data-md=\"\">\n             <p>A sequence of length one with the value of \"easing\"\nas its single item, i.e.\n«&nbsp;<code>easing</code>&nbsp;»,</p>\n           </dd></dl>\n          </div>"
                },
                {
                  "html": "<p>If <var>easings</var> is an empty sequence, let it be a sequence\nof length one containing the single value \"linear\", i.e.\n«&nbsp;\"linear\"&nbsp;».</p>"
                },
                {
                  "html": "<p>If <var>easings</var> has fewer items than <var>processed\nkeyframes</var>, repeat the elements in <var>easings</var> successively starting from the beginning of the list until <var>easings</var> has as many items as <var>processed\nkeyframes</var>.</p>"
                },
                {
                  "html": "<p>If <var>easings</var> has more items than <var>processed\nkeyframes</var>, store the excess items as <var>unused\neasings</var>.</p>"
                },
                {
                  "html": "<p>Assign each value in <var>easings</var> to a property named\n\"easing\" on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥⑥\">keyframe</a> with the corresponding\nposition in <var>processed keyframes</var> until the end of <var>processed keyframes</var> is reached.</p>"
                },
                {
                  "html": "If the \"composite\" member of the <var>property-indexed\nkeyframe</var> is <em>not</em> an empty sequence:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>composite modes</var> be a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto④\">CompositeOperationOrAuto</a></code> values assigned from the\n\"composite\" member of <var>property-indexed\nkeyframe</var>.\nIf that member is a single <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#enumdef-compositeoperationorauto\" id=\"ref-for-enumdef-compositeoperationorauto⑤\">CompositeOperationOrAuto</a></code> value\noperation, let <var>composite modes</var> be a sequence of\nlength one, with the value of the \"composite\" as its\nsingle item.</p>"
                    },
                    {
                      "html": "<p>As with <var>easings</var>, if <var>composite modes</var> has fewer items than <var>processed keyframes</var>, repeat the\nelements in <var>composite modes</var> successively starting\nfrom the beginning of the list until <var>composite modes</var> has as many items as <var>processed keyframes</var>.</p>"
                    },
                    {
                      "html": "<p>Assign each value in <var>composite modes</var> that is not <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-compositeoperationorauto-auto\" id=\"ref-for-dom-compositeoperationorauto-auto②\">auto</a></code> to the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-specific-composite-operation\" id=\"ref-for-keyframe-specific-composite-operation⑤\">keyframe-specific composite operation</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥⑦\">keyframe</a> with the corresponding position in <var>processed keyframes</var> until the end of <var>processed\nkeyframes</var> is reached.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>processed keyframes</var> is not <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#loosely-sorted-by-offset\" id=\"ref-for-loosely-sorted-by-offset\">loosely sorted by\noffset</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①④\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort these steps.</p>"
        },
        {
          "html": "<p>If there exist any <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe\" id=\"ref-for-keyframe⑥⑧\">keyframe</a> in <var>processed keyframes</var> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#keyframe-offset\" id=\"ref-for-keyframe-offset①②\">keyframe offset</a> is non-null and less\nthan zero or greater than one, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑤\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort these steps.</p>"
        },
        {
          "html": "For each <var>frame</var> in <var>processed keyframes</var>, perform the\nfollowing steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For each property-value pair in <var>frame</var>, parse the property\nvalue using the syntax specified for that property.</p>\n       <p>If the property value is invalid according to the syntax for the\nproperty, discard the property-value pair.\nUser agents that provide support for diagnosing errors in content\nSHOULD produce an appropriate warning highlighting the invalid\nproperty value.</p>"
            },
            {
              "html": "<p>Let the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-easing-1/#easing-function\" id=\"ref-for-easing-function①⑥\">timing function</a> of <var>frame</var> be the result of\nparsing the \"easing\" property on <var>frame</var> using the\nCSS syntax defined for the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-easing\" id=\"ref-for-dom-effecttiming-easing④\">easing</a></code> member of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-effecttiming\" id=\"ref-for-dictdef-effecttiming①②\">EffectTiming</a></code> dictionary.</p>\n       <p>If parsing the \"easing\" property fails, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑥\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
            }
          ]
        },
        {
          "html": "<p>Parse each of the values in <var>unused easings</var> using the CSS syntax\ndefined for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-effecttiming-easing\" id=\"ref-for-dom-effecttiming-easing⑤\">easing</a></code> member of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-effecttiming\" id=\"ref-for-dictdef-effecttiming①③\">EffectTiming</a></code> interface, and if any of the values fail to parse, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑦\">throw</a> a <span class=\"exceptionname\">TypeError</span> and abort this procedure.</p>"
        }
      ]
    },
    {
      "name": "Animatable/animate(keyframes, options)",
      "href": "https://www.w3.org/TR/web-animations-1/#dom-animatable-animate",
      "html": "Performs the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>target</var> be the object on which this method was called.</p>"
        },
        {
          "html": "<p>Construct a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#keyframeeffect\" id=\"ref-for-keyframeeffect①③\">KeyframeEffect</a></code> object, <var>effect</var>,\nin the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant Realm</a> of <var>target</var> by using the same\nprocedure as the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-keyframeeffect-keyframeeffect\" id=\"ref-for-dom-keyframeeffect-keyframeeffect⑤\">KeyframeEffect(target, keyframes,\noptions)</a></code> constructor, passing <var>target</var> as the <var>target</var> argument, and the <var>keyframes</var> and <var>options</var> arguments as supplied.</p>\n        <p>If the above procedure causes an exception to be thrown, propagate the\nexception and abort this procedure.</p>"
        },
        {
          "html": "<p>If <var>options</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-keyframeanimationoptions\" id=\"ref-for-dictdef-keyframeanimationoptions②\">KeyframeAnimationOptions</a></code> object, let <var>timeline</var> be the <code>timeline</code> member of <var>options</var> or, if <code>timeline</code> member of <var>options</var> is missing, be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#document-default-document-timeline\" id=\"ref-for-document-default-document-timeline⑦\">default document timeline</a> of the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a> of the element on which this method was\ncalled.</p>"
        },
        {
          "html": "<p>Construct a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#animation\" id=\"ref-for-animation①⓪\">Animation</a></code> object, <var>animation</var>, in\nthe <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant Realm</a> of <var>target</var> by using the\nsame procedure as the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animation-animation\" id=\"ref-for-dom-animation-animation①\">Animation()</a></code> constructor, passing <var>effect</var> and <var>timeline</var> as arguments of the same name.</p>"
        },
        {
          "html": "<p>If <var>options</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dictdef-keyframeanimationoptions\" id=\"ref-for-dictdef-keyframeanimationoptions③\">KeyframeAnimationOptions</a></code> object,\nassign the value of the <code>id</code> member of <var>options</var> to <var>animation</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/web-animations-1/#dom-animation-id\" id=\"ref-for-dom-animation-id①\">id</a></code> attribute.</p>"
        },
        {
          "html": "<p>Run the procedure to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/web-animations-1/#play-an-animation\" id=\"ref-for-play-an-animation⑤\">play an animation</a> for <var>animation</var> with the <var>auto-rewind</var> flag set to true.</p>"
        },
        {
          "html": "<p>Return <var>animation</var>.</p>"
        }
      ]
    }
  ]
}