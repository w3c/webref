{
  "spec": {
    "title": "Media Capture and Streams",
    "url": "https://www.w3.org/TR/mediacapture-streams/"
  },
  "algorithms": [
    {
      "name": "MediaStream/constructor()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-constructor",
      "html": "The MediaStream <dfn data-idl=\"constructor\" data-dfn-for=\"MediaStream\" data-export=\"\" data-dfn-type=\"constructor\" id=\"dom-mediastream-constructor\" data-title=\"constructor\" data-lt=\"constructor()\" data-local-lt=\"MediaStream.constructor|MediaStream.constructor()|constructor\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>constructor</code></dfn> composes a new\n      stream out of existing tracks. It takes an optional argument of type\n      <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-17\"><code>MediaStream</code></a> or an array of\n      <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-9\"><code>MediaStreamTrack</code></a> objects. When the constructor is invoked, the User\n      Agent must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>stream</var> be a newly constructed\n          <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-18\"><code>MediaStream</code></a> object.</p>"
        },
        {
          "html": "<p>Initialize <var>stream</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-id\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-id-1\"><code>id</code></a>  attribute to a newly generated\n          value.</p>"
        },
        {
          "html": "If the constructor's argument is present, run the following\n          steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>Construct a set of tracks <var>tracks</var> based on the type\n              of argument:</p>\n              <ul>\n                <li>\n                  <p>A <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-19\"><code>MediaStream</code></a> object:</p>\n                  <p>Let <var>tracks</var> be a set containing all the\n                  <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-10\"><code>MediaStreamTrack</code></a> objects in the\n                  <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-20\"><code>MediaStream</code></a> <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-track-set-1\">track\n                  set</a>.</p>\n                </li>\n                <li>\n                  <p>A sequence of <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-11\"><code>MediaStreamTrack</code></a>\n                  objects:</p>\n                  <p>Let <var>tracks</var> be a set containing all the\n                  <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-12\"><code>MediaStreamTrack</code></a> objects in the provided\n                  sequence.</p>\n                </li>\n              </ul>"
            },
            {
              "html": "For each <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-13\"><code>MediaStreamTrack</code></a>,\n              <var>track</var> , in <var>tracks</var>, run the following\n              steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>track</var> is already in <var>stream</var>'s\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-2\">track set</a>, skip\n                  <var>track</var>.</p>"
                },
                {
                  "html": "<p>Otherwise, add <var>track</var> to <var>stream</var>'s\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-3\">track set</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "MediaStream/add a track",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-add-a-track",
      "html": "To <dfn class=\"abstract-op\" data-dfn-for=\"MediaStream\" data-dfn-type=\"abstract-op\" id=\"dfn-add-a-track\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">add a track</dfn> <var>track</var> to a\n      <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-32\"><code>MediaStream</code></a> <var>stream</var>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-5\">User Agent</a> <em class=\"rfc2119\">MUST</em>\n      run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>track</var> is already in <var>stream's</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-6\">track set</a>, then abort these steps.</p>"
        },
        {
          "html": "<p>Add <var>track</var> to <var>stream</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-7\">track set</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fire-a-track-event\" class=\"internalDFN\" id=\"ref-for-dfn-fire-a-track-event-1\">Fire a track event</a> named <a data-link-type=\"idl\" data-lt=\"addtrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediastream-addtrack\" class=\"internalDFN\" id=\"ref-for-event-mediastream-addtrack-1\"><code>addtrack</code></a> with\n          <var>track</var> at <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "MediaStream/remove a track",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-remove-a-track",
      "html": "To <dfn class=\"abstract-op\" data-dfn-for=\"MediaStream\" data-dfn-type=\"abstract-op\" id=\"dfn-remove-a-track\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">remove a track</dfn> <var>track</var> from a\n      <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-33\"><code>MediaStream</code></a> <var>stream</var>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-6\">User Agent</a> <em class=\"rfc2119\">MUST</em>\n      run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>track</var> is not in <var>stream's</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-8\">track set</a>, then abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" data-lt=\"Remove a track\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-remove-a-track\" class=\"internalDFN\" id=\"ref-for-dfn-remove-a-track-1\">Remove</a> <var>track</var> from <var>stream</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-9\">track set</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fire-a-track-event\" class=\"internalDFN\" id=\"ref-for-dfn-fire-a-track-event-2\">Fire a track event</a> named <a data-link-type=\"idl\" data-lt=\"removetrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediastream-removetrack\" class=\"internalDFN\" id=\"ref-for-event-mediastream-removetrack-1\"><code>removetrack</code></a> with\n          <var>track</var> at <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "MediaStream/addTrack()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-addtrack",
      "html": "When the <a data-link-type=\"idl\" data-lt=\"addTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-addtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-addtrack-3\"><code>addTrack</code></a> method is\n              invoked, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-9\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the methods argument and\n                  <var>stream</var> the <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-43\"><code>MediaStream</code></a> object\n                  on which the method was called.</p>"
        },
        {
          "html": "<p>If <var>track</var> is already in <var>stream</var>'s\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-17\">track set</a>, then abort these\n                  steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" data-lt=\"Add a track\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-add-a-track\" class=\"internalDFN\" id=\"ref-for-dfn-add-a-track-1\">Add</a> <var>track</var> to <var>stream</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-18\">track set</a>.</p>"
        }
      ]
    },
    {
      "name": "MediaStream/removeTrack()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-removetrack",
      "html": "When the <a data-link-type=\"idl\" data-lt=\"removeTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-removetrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-removetrack-3\"><code>removeTrack</code></a>\n              method is invoked, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-10\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following\n              steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the methods argument and\n                  <var>stream</var> the <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-45\"><code>MediaStream</code></a> object\n                  on which the method was called.</p>"
        },
        {
          "html": "<p>If <var>track</var> is not in <var>stream's</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-19\">track set</a>, then abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" data-lt=\"Remove a track\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-remove-a-track\" class=\"internalDFN\" id=\"ref-for-dfn-remove-a-track-2\">Remove</a> <var>track</var> from <var>stream</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" id=\"ref-for-dfn-track-set-20\">track set</a>.</p>"
        }
      ]
    },
    {
      "name": "MediaStream/clone()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-clone",
      "html": "When the <a data-link-type=\"idl\" data-lt=\"clone()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-clone\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-clone-2\"><code>clone</code></a><code>()</code> method is invoked, the User\n              Agent <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>streamClone</var> be a newly constructed\n                  <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-47\"><code>MediaStream</code></a> object.</p>"
        },
        {
          "html": "<p>Initialize <var>streamClone</var>.<a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-48\"><code>MediaStream</code></a>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-id\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-id-5\"><code>id</code></a> to a newly\n                  generated value.</p>"
        },
        {
          "html": "<p><a href=\"https://www.w3.org/TR/mediacapture-streams/#track-clone\" id=\"ref-for-track-clone-1\">Clone each track</a> in this\n                  <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-49\"><code>MediaStream</code></a> object and add the result to\n                  <var>streamClone</var>'s <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-track-set\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-track-set-21\">track\n                  set</a>.</p>"
        },
        {
          "html": "Return <var>streamClone</var>."
        }
      ]
    },
    {
      "name": "source stopped state",
      "href": "https://www.w3.org/TR/mediacapture-streams/#source-stopped",
      "html": "A script can indicate that a <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-47\"><code>MediaStreamTrack</code></a>\n      object no longer needs its source with the <a data-link-type=\"idl\" data-lt=\"stop()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-stop-1\"><code>stop</code></a><code>()</code>\n      method. When all tracks\n      using a source have been stopped or ended by some other means, the source\n      is <dfn id=\"source-stopped\" data-lt=\"source stopped state|stopped\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">stopped</dfn>. If the source is a device\n      exposed by <a data-link-type=\"idl\" data-lt=\"getUserMedia()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getusermedia-5\"><code>getUserMedia</code></a><code>()</code>, then when\n      the source is stopped, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-14\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>mediaDevices</var> be the <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-1\"><code>MediaDevices</code></a> object in question.</p>"
        },
        {
          "html": "<p>Let <var>deviceId</var> be the source device's <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-deviceid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-deviceid-1\"><code>deviceId</code></a>.</p>"
        },
        {
          "html": "<p>Set <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesLiveMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-deviceslivemap\" class=\"internalDFN\" id=\"ref-for-dfn-deviceslivemap-1\"><code>[[devicesLiveMap]]</code></a>[<var>deviceId</var>] to\n          <code>false</code>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a>\n          of the permission associated with the device's kind and\n          <var>deviceId</var> for <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\">relevant settings object</a>,\n          is not \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\", then set\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-devicesaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-devicesaccessiblemap-1\"><code>[[devicesAccessibleMap]]</code></a>[<var>deviceId</var>] to\n          <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "MediaStreamTrack/[[Source]]",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-source-0",
      "html": "To <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-create-a-mediastreamtrack\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">create a MediaStreamTrack</dfn> with an underlying\n      <var>source</var>, and a <var>mediaDevicesToTieSourceTo</var>, run the\n      following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be a new object of type <var>source</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtrack-source-type\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtrack-source-type-1\">MediaStreamTrack source type</a>.</p>\n          <p>Initialize track with the following internal slots:</p>\n          <ul data-dfn-for=\"MediaStreamTrack\">\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-source-0\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Source]]</dfn>,\n              initialized to <var>source</var>.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-id\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Id]]</dfn>,\n              initialized to a newly generated unique identifier string. See\n              <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-50\"><code>MediaStream</code></a>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream-id\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-id-6\"><code>id</code></a> attribute for guidelines on how to generate\n              such an identifier.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-kind\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Kind]]</dfn>,\n              initialized to <dfn id=\"dfn-audio\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\"><code>\"audio\"</code></dfn> if <var>source</var> is\n              an audio source, or <dfn id=\"dfn-video\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\"><code>\"video\"</code></dfn> if\n              <var>source</var> is a video source.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-label\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Label]]</dfn>,\n              initialized to <var>source</var>'s label, if provided by the User\n              Agent, or <code>\"\"</code> otherwise. <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-15\">User Agents</a> <em class=\"rfc2119\">MAY</em> label audio and\n              video sources (e.g., \"Internal microphone\" or \"External USB Webcam\").\n              </p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-readystate\" tabindex=\"0\" aria-haspopup=\"dialog\">[[ReadyState]]</dfn>,\n              initialized to \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.live\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.live-1\"><code>live</code></a>\".</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-enabled\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Enabled]]</dfn>,\n              initialized to <code>true</code>.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaStreamTrack\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-muted\" tabindex=\"0\" aria-haspopup=\"dialog\">[[Muted]]</dfn>,\n              initialized to <code>true</code> if <var>source</var> is\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-muted-0\" class=\"internalDFN\" id=\"ref-for-dfn-muted-0-1\">muted</a>, and <code>false</code> otherwise.</p>\n            </li>\n            <li>\n              <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-capabilities-0\" class=\"internalDFN\" id=\"ref-for-dfn-capabilities-0-1\">[[Capabilities]]</a>,\n              <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-constraints-1\">[[Constraints]]</a>, and\n              <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-1\">[[Settings]]</a>, all initialized as\n              specified in the <a data-link-type=\"idl\" data-lt=\"ConstrainablePattern\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-constrainablepattern\" class=\"internalDFN\" id=\"ref-for-dom-constrainablepattern-5\"><code>ConstrainablePattern</code></a>.<p></p>\n            </li>\n          </ul>"
        },
        {
          "html": "<p>If <var>mediaDevicesToTieSourceTo</var> is not <code>null</code>,\n          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-tie-track-source-to-mediadevices\" class=\"internalDFN\" id=\"ref-for-dfn-tie-track-source-to-mediadevices-1\">tie track source to <code>MediaDevices</code></a> with <var>source</var> and <var>mediaDevicesToTieSourceTo</var>.</p>"
        },
        {
          "html": "<p>Run <var>source</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtrack-source-specific-construction-steps\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtrack-source-specific-construction-steps-1\">MediaStreamTrack source-specific construction steps</a>\n          with <var>track</var> as parameter.</p>"
        },
        {
          "html": "<p>Return <var>track</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize the underlying source",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-initialize-the-underlying-source",
      "html": "To <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-initialize-the-underlying-source\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">initialize the underlying source</dfn> of <var>track</var>\n      to <var>source</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>track</var>.<a data-link-type=\"attribute\" data-lt=\"[[Source]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-source-0\" class=\"internalDFN\" id=\"ref-for-dfn-source-0-1\"><code>[[Source]]</code></a> to\n          <var>source</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>track</var>'s <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-capabilities-0\" class=\"internalDFN\" id=\"ref-for-dfn-capabilities-0-2\">[[Capabilities]]</a>,\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-constraints-2\">[[Constraints]]</a>, and\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-2\">[[Settings]]</a>, as\n          specified in the <a data-link-type=\"idl\" data-lt=\"ConstrainablePattern\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-constrainablepattern\" class=\"internalDFN\" id=\"ref-for-dom-constrainablepattern-6\"><code>ConstrainablePattern</code></a>.</p>"
        }
      ]
    },
    {
      "name": "tie track source to MediaDevices",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-tie-track-source-to-mediadevices",
      "html": "To <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-tie-track-source-to-mediadevices\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">tie track source to <code>MediaDevices</code></dfn>, given <var>source</var> and\n      <var>mediaDevices</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Add <var>source</var> to\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[mediaStreamTrackSources]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtracksources\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtracksources-1\"><code>[[mediaStreamTrackSources]]</code></a>.</p>"
        }
      ]
    },
    {
      "name": "stop all sources",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-stop-all-sources",
      "html": "To <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-stop-all-sources\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">stop all sources</dfn> of a <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\">global object</a>, named <var>globalObject</var>,\n      the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-16\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>For each <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-48\"><code>MediaStreamTrack</code></a> object <var>track</var> whose\n        <a href=\"https://html.spec.whatwg.org/multipage/#concept-relevant-global\">relevant global object</a> is <var>globalObject</var>,\n        set <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-1\"><code>[[ReadyState]]</code></a> to\n        \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-1\"><code>ended</code></a>\".</p>"
        },
        {
          "html": "<p>If <var>globalObject</var> is a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>, then for each <var>source</var> in\n        <var>globalObject</var>'s\n        <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-associated-mediadevices\" class=\"internalDFN\" id=\"ref-for-dfn-associated-mediadevices-1\">associated <code>MediaDevices</code></a>.<a data-link-type=\"attribute\" data-lt=\"[[mediaStreamTrackSources]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtracksources\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtracksources-2\"><code>[[mediaStreamTrackSources]]</code></a>,\n        <a data-link-type=\"dfn|abstract-op\" data-lt=\"stopped\" href=\"https://www.w3.org/TR/mediacapture-streams/#source-stopped\" class=\"internalDFN\" id=\"ref-for-source-stopped-1\">stop</a> <var>source</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-17\">User Agent</a> <em class=\"rfc2119\">MUST</em> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-stop-all-sources\" class=\"internalDFN\" id=\"ref-for-dfn-stop-all-sources-1\">stop all sources</a> of a <var>globalObject</var> in the following conditions:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>globalObject</var> is a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> object and the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps\">unloading document cleanup steps</a>\n        are executed for its <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated document</a>.</p>"
        },
        {
          "html": "<p>If <var>globalObject</var> is a <a data-link-type=\"idl\" data-lt=\"WorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope\"><code>WorkerGlobalScope</code></a> object and its\n        <a href=\"https://html.spec.whatwg.org/multipage/workers.html#dom-workerglobalscope-closing\">closing</a> flag is set to true.</p>"
        }
      ]
    },
    {
      "name": "clone a track",
      "href": "https://www.w3.org/TR/mediacapture-streams/#track-clone",
      "html": "To <dfn class=\"abstract-op\" id=\"track-clone\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">clone a track</dfn> the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-18\">User Agent</a> <em class=\"rfc2119\">MUST</em> run\n      the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-49\"><code>MediaStreamTrack</code></a>\n          object to be cloned.</p>"
        },
        {
          "html": "<p>Let <var>source</var> be <var>track</var>'s\n          <a data-link-type=\"attribute\" data-lt=\"[[Source]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-source-0\" class=\"internalDFN\" id=\"ref-for-dfn-source-0-2\"><code>[[Source]]</code></a>.</p>"
        },
        {
          "html": "<p>Let <var>trackClone</var> be the result of\n          <a data-link-type=\"dfn|abstract-op\" data-lt=\"create a MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-create-a-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dfn-create-a-mediastreamtrack-1\">creating a MediaStreamTrack</a> with\n          <var>source</var> and <code>null</code>.\n          </p>"
        },
        {
          "html": "<p>Set <var>trackClone</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-2\"><code>[[ReadyState]]</code></a> to\n            <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-3\"><code>[[ReadyState]]</code></a> value.</p>"
        },
        {
          "html": "<p>Set <var>trackClone</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-capabilities-0\" class=\"internalDFN\" id=\"ref-for-dfn-capabilities-0-3\">[[Capabilities]]</a> to a clone of\n          <var>track</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-capabilities-0\" class=\"internalDFN\" id=\"ref-for-dfn-capabilities-0-4\">[[Capabilities]]</a>.</p>"
        },
        {
          "html": "<p>Set <var>trackClone</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-constraints-3\">[[Constraints]]</a> to a clone of\n          <var>track</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-constraints-4\">[[Constraints]]</a>.</p>"
        },
        {
          "html": "<p>Set <var>trackClone</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-3\">[[Settings]]</a> to a clone of\n          <var>track</var>'s\n          <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-4\">[[Settings]]</a>.</p>"
        },
        {
          "html": "<p>Run <var>source</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtrack-source-specific-clone-steps\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtrack-source-specific-clone-steps-1\">MediaStreamTrack source-specific clone steps</a> with <var>track</var> and <var>trackClone</var> as parameters.</p>"
        },
        {
          "html": "<p>Return <var>trackClone</var>.</p>"
        }
      ]
    },
    {
      "name": "MediaStreamTrack/set a track's muted state",
      "href": "https://www.w3.org/TR/mediacapture-streams/#set-track-muted",
      "html": "To <dfn class=\"export abstract-op\" data-dfn-for=\"MediaStreamTrack\" id=\"set-track-muted\" data-dfn-type=\"abstract-op\" data-export=\"\" tabindex=\"0\" aria-haspopup=\"dialog\">set a track's muted state</dfn> to\n        <var>newState</var>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-24\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-55\"><code>MediaStreamTrack</code></a> in\n            question.</p>"
        },
        {
          "html": "<p>If <var>track</var>.<a data-link-type=\"attribute\" data-lt=\"[[Muted]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-muted\" class=\"internalDFN\" id=\"ref-for-dfn-muted-1\"><code>[[Muted]]</code></a> is already\n            <var>newState</var>, then abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>track</var>.<a data-link-type=\"attribute\" data-lt=\"[[Muted]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-muted\" class=\"internalDFN\" id=\"ref-for-dfn-muted-2\"><code>[[Muted]]</code></a> to\n            <var>newState</var>.</p>"
        },
        {
          "html": "<p>If <var>newState</var> is <code>true</code> let\n            <var>eventName</var> be <a data-link-type=\"idl\" data-lt=\"mute\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediastreamtrack-mute\" class=\"internalDFN\" id=\"ref-for-event-mediastreamtrack-mute-2\"><code>mute</code></a>, otherwise\n            <a data-link-type=\"idl\" data-lt=\"unmute\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediastreamtrack-unmute\" class=\"internalDFN\" id=\"ref-for-event-mediastreamtrack-unmute-2\"><code>unmute</code></a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named <var>eventName</var> on\n            <var>track</var>.</p>"
        }
      ]
    },
    {
      "name": "track ended by the User agent",
      "href": "https://www.w3.org/TR/mediacapture-streams/#ends-nostop",
      "html": "When a <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-68\"><code>MediaStreamTrack</code></a> <var>track</var>\n        <dfn data-lt=\"track ended by the User agent|ends for any reason other than the stop() method being invoked\" data-for=\"MediaStreamTrack\" data-export=\"\" id=\"ends-nostop\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">ends for any reason other than the <code>stop()</code> method being\n        invoked</dfn>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-25\">User Agent</a> <em class=\"rfc2119\">MUST</em> queue a task that runs the following\n        steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-4\"><code>[[ReadyState]]</code></a>\n            has the value \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-2\"><code>ended</code></a>\" already, then abort these\n            steps.</p>"
        },
        {
          "html": "<p>Set <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-5\"><code>[[ReadyState]]</code></a>\n            to \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-3\"><code>ended</code></a>\".</p>"
        },
        {
          "html": "<p>Notify <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[Source]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-source-0\" class=\"internalDFN\" id=\"ref-for-dfn-source-0-3\"><code>[[Source]]</code></a> that <var>track</var> is\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#track-ended\" class=\"internalDFN\" id=\"ref-for-track-ended-7\">ended</a> so that the source may be <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#source-stopped\" class=\"internalDFN\" id=\"ref-for-source-stopped-3\">stopped</a>, unless other\n            <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-69\"><code>MediaStreamTrack</code></a> objects depend on it.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named <a data-link-type=\"event\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediastreamtrack-ended\" class=\"internalDFN\" id=\"ref-for-event-mediastreamtrack-ended-1\">ended</a> at the object.</p>"
        }
      ]
    },
    {
      "name": "device permission revocation algorithm",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-device-permission-revocation-algorithm",
      "html": "To invoke the <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-device-permission-revocation-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">device permission revocation algorithm</dfn> with <var>permissionName</var>,\n        run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>tracks</var> be the set of all currently\n            \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.live\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.live-4\"><code>live</code></a>\" <code>MediaStreamTrack</code>s\n            whose permission associated with this kind of track (<a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-camera\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-camera-1\"><code>\"camera\"</code></a> or <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-microphone\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-microphone-1\"><code>\"microphone\"</code></a>)\n            matches <var>permissionName</var>.</p>"
        },
        {
          "html": "<p>For each <var>track</var> in <var>tracks</var>,\n            <a href=\"https://www.w3.org/TR/mediacapture-streams/#ends-nostop\" id=\"ref-for-ends-nostop-2\">end</a> the track.</p>"
        }
      ]
    },
    {
      "name": "MediaStreamTrack/stop()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop",
      "html": "When a <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-73\"><code>MediaStreamTrack</code></a> object's\n                <a data-link-type=\"idl\" data-lt=\"stop()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-stop-5\"><code>stop</code></a><code>()</code> method is invoked, the User\n                Agent <em class=\"rfc2119\">MUST</em> run following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the current\n                    <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-74\"><code>MediaStreamTrack</code></a> object.</p>"
        },
        {
          "html": "<p>If <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-7\"><code>[[ReadyState]]</code></a>\n                    is \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-4\"><code>ended</code></a>\", then abort these steps.</p>"
        },
        {
          "html": "<p>Notify <var>track</var>'s source that <var>track</var>\n                    is <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#track-ended\" class=\"internalDFN\" id=\"ref-for-track-ended-10\">ended</a>.</p>\n                    <p>A source that is notified of a track ending will be\n                    <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#source-stopped\" class=\"internalDFN\" id=\"ref-for-source-stopped-4\">stopped</a>, unless other\n                    <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-75\"><code>MediaStreamTrack</code></a> objects depend on\n                    it.</p>"
        },
        {
          "html": "<p>Set <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-8\"><code>[[ReadyState]]</code></a>\n                    to \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-5\"><code>ended</code></a>\".</p>"
        }
      ]
    },
    {
      "name": "MediaStreamTrack/getSettings()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getsettings",
      "html": "When a <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-77\"><code>MediaStreamTrack</code></a> object's <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-78\"><code>MediaStreamTrack</code></a>.<a data-link-type=\"idl\" data-lt=\"getSettings()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getsettings\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-getsettings-2\"><code>getSettings</code></a><code>()</code> method is invoked,\n                the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-27\">User Agent</a> <em class=\"rfc2119\">MUST</em> run following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the current <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-79\"><code>MediaStreamTrack</code></a> object.</p>"
        },
        {
          "html": "If <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-9\"><code>[[ReadyState]]</code></a>\n                    is \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-6\"><code>ended</code></a>\", run the following sub steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>settings</var> be a new <a data-link-type=\"idl\" data-lt=\"MediaTrackSettings\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediatracksettings\" class=\"internalDFN\" id=\"ref-for-dom-mediatracksettings-2\"><code>MediaTrackSettings</code></a> dictionary.</p>"
            },
            {
              "html": "<p>\n                        For each <var>property</var> of the <a href=\"https://www.w3.org/TR/mediacapture-streams/#list-of-inherent-constrainable-track-properties\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-list-of-inherent-constrainable-track-properties-1\">list of inherent constrainable track properties</a>,\n                        add a corresponding property to <var>settings</var> if <var>track</var> had such property\n                        at the time it was ended, with the value at the time <var>track</var> was ended.\n                      </p>"
            },
            {
              "html": "<p>Return <var>settings</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the current settings of the track as defined in\n                    <a href=\"https://www.w3.org/TR/mediacapture-streams/#constrainable-interface\">ConstrainablePattern Interface</a>.</p>"
        }
      ]
    },
    {
      "name": "must not be exposed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-must-not-be-exposed",
      "html": "When a <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-80\"><code>MediaStreamTrack</code></a> object's\n                <a data-link-type=\"idl\" data-lt=\"applyConstraints()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-applyconstraints-2\"><code>applyConstraints</code></a><code>()</code> method is invoked, the User\n                Agent <em class=\"rfc2119\">MUST</em> run following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>track</var> be the current\n                    <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-81\"><code>MediaStreamTrack</code></a> object.</p>"
        },
        {
          "html": "If <var>track</var>'s <a data-link-type=\"attribute\" data-lt=\"[[ReadyState]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-readystate\" class=\"internalDFN\" id=\"ref-for-dfn-readystate-10\"><code>[[ReadyState]]</code></a>\n                    is \"<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#idl-def-MediaStreamTrackState.ended\" class=\"internalDFN\" id=\"ref-for-idl-def-MediaStreamTrackState.ended-7\"><code>ended</code></a>\", run the following sub steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>p</var> be a new promise.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var>p</var> with <code>undefined</code>.</p>"
            },
            {
              "html": "<p>Return <var>p</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Invoke and return the result of the\n                    <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-template-method\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-applyconstraints-template-method-1\">applyConstraints template method</a> where:</p>\n                    <ul>\n                      <li>In the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-1\">SelectSettings</a> algorithm,\n                        <ul>\n                          <li>\n                            <var>object</var> is the\n                            <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-82\"><code>MediaStreamTrack</code></a> on which this\n                            method was called, and\n                          </li>\n                          <li>\n                            <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-1\">settings dictionary</a> refers to a possible\n                            instance of the <a data-link-type=\"idl\" data-lt=\"MediaTrackSettings\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediatracksettings\" class=\"internalDFN\" id=\"ref-for-dom-mediatracksettings-3\"><code>MediaTrackSettings</code></a>\n                            dictionary. The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-28\">User Agent</a> <em class=\"rfc2119\">MUST NOT</em> include inherent\n                            unchangeable device properties as members unless\n                            they are in the <a href=\"https://www.w3.org/TR/mediacapture-streams/#list-of-inherent-constrainable-track-properties\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-list-of-inherent-constrainable-track-properties-2\">list of inherent constrainable\n                            track properties</a>, or otherwise include\n                            device properties that <dfn id=\"dfn-must-not-be-exposed\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">must not be exposed</dfn>.\n                            \n                          </li>\n                        </ul>\n                      </li>\n                      <li>In step 3 of the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-applyconstraints-algorithm-1\">ApplyConstraints algorithm</a>, all\n                      changes listed are to be made to <var>object</var>, and\n                      </li>\n                      <li>In step 4 of the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-applyconstraints-algorithm-2\">ApplyConstraints algorithm</a>, the\n                      requirement on getConstraints() applies to the\n                      getConstraints() method of <var>object</var>.</li>\n                    </ul>"
        }
      ]
    },
    {
      "name": "OverconstrainedError",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-overconstrainederror",
      "html": "Run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>constraint</var> be the constructor's first\n                argument.</p>"
        },
        {
          "html": "<p>Let <var>message</var> be the constructor's second argument.\n                </p>"
        },
        {
          "html": "<p>Let <var>e</var> be a new\n                <a data-link-type=\"idl\" data-lt=\"OverconstrainedError\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-overconstrainederror\" class=\"internalDFN\" id=\"ref-for-dom-overconstrainederror-2\"><code>OverconstrainedError</code></a> object.</p>"
        },
        {
          "html": "<p>Invoke the <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> constructor of\n                <var>e</var> with the <code>message</code> argument set to\n                <var>message</var> and the <code>name</code> argument set to\n                <code>\"OverconstrainedError\"</code>.</p>"
        },
        {
          "html": "<p>Set <var>e.constraint</var> to <var>constraint</var>.</p>"
        },
        {
          "html": "<p>Return <var>e</var>.</p>"
        }
      ]
    },
    {
      "name": "MediaDevices/[[devicesLiveMap]]",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-deviceslivemap",
      "html": "To <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-create-a-mediadevices\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">create a MediaDevices</dfn> object, given <var>realm</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>mediaDevices</var> be a new <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-9\"><code>MediaDevices</code></a> object in <var>realm</var>,\n          initalized with the following internal slots:</p>\n          <ul data-dfn-for=\"MediaDevices\">\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaDevices\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-deviceslivemap\" tabindex=\"0\" aria-haspopup=\"dialog\">[[devicesLiveMap]]</dfn>,\n               initialized to an empty <a data-link-type=\"dfn|abstract-op\" data-lt=\"ordered map\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaDevices\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-devicesaccessiblemap\" tabindex=\"0\" aria-haspopup=\"dialog\">[[devicesAccessibleMap]]</dfn>,\n               initialized to an empty <a data-link-type=\"dfn|abstract-op\" data-lt=\"ordered map\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.</p>\n            </li>\n            <li>\n              <p><dfn data-idl=\"\" data-dfn-for=\"MediaDevices\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-kindsaccessiblemap\" tabindex=\"0\" aria-haspopup=\"dialog\">[[kindsAccessibleMap]]</dfn>,\n               initialized to an empty <a data-link-type=\"dfn|abstract-op\" data-lt=\"ordered map\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\">map</a>.</p>\n            </li>\n            <li>\n              <p><dfn data-dfn-for=\"MediaDevices\" data-idl=\"\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-storeddevicelist\" tabindex=\"0\" aria-haspopup=\"dialog\">[[storedDeviceList]]</dfn>, initialized\n              to a <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">list</a> of all media input and output devices available\n              to the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-48\">User Agent</a>.</p>\n            </li>\n            <li>\n              <p><dfn data-dfn-for=\"MediaDevices\" data-idl=\"\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-canexposecamerainfo\" tabindex=\"0\" aria-haspopup=\"dialog\">[[canExposeCameraInfo]]</dfn>, initialized\n              to <code>false</code>.</p>\n            </li>\n            <li>\n              <p><dfn data-dfn-for=\"MediaDevices\" data-idl=\"\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-canexposemicrophoneinfo\" tabindex=\"0\" aria-haspopup=\"dialog\">[[canExposeMicrophoneInfo]]</dfn>, initialized\n              to <code>false</code>.</p>\n            </li>\n            <li>\n              <p><dfn data-dfn-for=\"MediaDevices\" data-idl=\"\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-mediastreamtracksources\" tabindex=\"0\" aria-haspopup=\"dialog\">[[mediaStreamTrackSources]]</dfn>, initialized\n              to an empty <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\">set</a>.</p>\n            </li>\n          </ul>"
        },
        {
          "html": "<p>Let <var>settings</var> be <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>For each kind of device, <var>kind</var>, that\n          <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-10\"><code>MediaDevices</code></a>.<a data-link-type=\"idl\" data-lt=\"getUserMedia()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getusermedia-13\"><code>getUserMedia</code></a><code>()</code> exposes, run the following step:</p><p>\n          </p>",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[kindsAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-kindsaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-kindsaccessiblemap-1\"><code>[[kindsAccessibleMap]]</code></a><var>[kind]</var>\n              to either <code>true</code>\n              if the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a>\n              of the permission associated with <var>kind</var> (e.g. <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-camera\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-camera-2\"><code>\"camera\"</code></a>,\n              <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-microphone\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-microphone-2\"><code>\"microphone\"</code></a>) for <var>settings</var> is \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\", or to\n              <code>false</code> otherwise.</p>"
            }
          ]
        },
        {
          "html": "<p>For each individual device that <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-11\"><code>MediaDevices</code></a>.<a data-link-type=\"idl\" data-lt=\"getUserMedia()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getusermedia-14\"><code>getUserMedia</code></a><code>()</code>\n          exposes, using the device's\n          deviceId, <var>deviceId</var>, run the following step:</p><p>\n          </p>",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesLiveMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-deviceslivemap\" class=\"internalDFN\" id=\"ref-for-dfn-deviceslivemap-3\"><code>[[devicesLiveMap]]</code></a><var>[deviceId]</var> to <code>false</code>, and\n              set <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-devicesaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-devicesaccessiblemap-2\"><code>[[devicesAccessibleMap]]</code></a><var>[deviceId]</var> to either\n              <code>true</code> if the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a>\n              of the permission associated with the devices kind and\n              <var>deviceId</var> for <var>settings</var>, is \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\", or to\n              <code>false</code> otherwise.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>mediaDevices</var>.</p>"
        }
      ]
    },
    {
      "html": "For each kind of device, <var>kind</var>, that <a data-link-type=\"idl\" data-lt=\"getUserMedia()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getusermedia-15\"><code>getUserMedia</code></a><code>()</code> exposes,\n      <a data-link-type=\"dfn|abstract-op\" data-lt=\"permission state\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">whenever a transition occurs of the permission state</a> of the permission associated with <var>kind</var> for\n      <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\">relevant settings object</a>,\n      run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the transition is to \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\" from another value, then set\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[kindsAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-kindsaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-kindsaccessiblemap-2\"><code>[[kindsAccessibleMap]]</code></a><var>[kind]</var> to <code>true</code>.</p>"
        },
        {
          "html": "<p>If the transition is from \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\" to another value, then set\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[kindsAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-kindsaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-kindsaccessiblemap-3\"><code>[[kindsAccessibleMap]]</code></a><var>[kind]</var> to <code>false</code>.</p>"
        }
      ]
    },
    {
      "html": "For each device that <a data-link-type=\"idl\" data-lt=\"getUserMedia()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getusermedia-16\"><code>getUserMedia</code></a><code>()</code> exposes, whenever a transition occurs of the\n      <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a> of the permission associated with the device's kind\n      and the device's deviceId, <var>deviceId</var>, for\n      <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\">relevant settings object</a>, run the following\n      steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the transition is to \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\" from another value, then set\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-devicesaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-devicesaccessiblemap-3\"><code>[[devicesAccessibleMap]]</code></a><var>[deviceId]</var> to <code>true</code>,\n          if it isnt already <code>true</code>.</p>"
        },
        {
          "html": "<p>If the transition is from \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\" to another value, and the\n          device is currently <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#source-stopped\" class=\"internalDFN\" id=\"ref-for-source-stopped-6\">stopped</a>, then set\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-devicesaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-devicesaccessiblemap-4\"><code>[[devicesAccessibleMap]]</code></a><var>[deviceId]</var> to\n          <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "device change notification steps",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-device-change-notification-steps",
      "html": "When new media input and/or output devices are made available to the\n      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-49\">User Agent</a>, or any available input and/or output device becomes\n      unavailable, or the system default for input and/or output devices of a\n      <a data-link-type=\"idl\" data-lt=\"MediaDeviceKind\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevicekind\" class=\"internalDFN\" id=\"ref-for-dom-mediadevicekind-1\"><code>MediaDeviceKind</code></a> changed, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-50\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following\n      <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-device-change-notification-steps\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">device change notification steps</dfn> for each <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-12\"><code>MediaDevices</code></a>\n      object, <var>mediaDevices</var>, for which <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-enumeration-can-proceed\" class=\"internalDFN\" id=\"ref-for-device-enumeration-can-proceed-1\">device enumeration can proceed</a> is <code>true</code>,\n      but for no other <a data-link-type=\"idl\" data-lt=\"MediaDevices\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-13\"><code>MediaDevices</code></a> object:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>lastExposedDevices</var> be the result of\n          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-list-of-device-info-objects\" class=\"internalDFN\" id=\"ref-for-creating-a-list-of-device-info-objects-1\">creating a list of device info objects</a> with <var>mediaDevices</var> and\n          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[storedDeviceList]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-storeddevicelist\" class=\"internalDFN\" id=\"ref-for-dfn-storeddevicelist-1\"><code>[[storedDeviceList]]</code></a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceList</var> be the list of all media input and/or\n          output devices available to the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-51\">User Agent</a>.</p>"
        },
        {
          "html": "<p>Let <var>newExposedDevices</var> be the result of\n          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-list-of-device-info-objects\" class=\"internalDFN\" id=\"ref-for-creating-a-list-of-device-info-objects-2\">creating a list of device info objects</a> with <var>mediaDevices</var> and\n          <var>deviceList</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"idl\" data-lt=\"MediaDeviceInfo\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-3\"><code>MediaDeviceInfo</code></a> objects in <var>newExposedDevices</var>\n          match those in <var>lastExposedDevices</var> and have the same order,\n          then abort these steps.</p>"
        },
        {
          "html": "<p>Set <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[storedDeviceList]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-storeddevicelist\" class=\"internalDFN\" id=\"ref-for-dfn-storeddevicelist-2\"><code>[[storedDeviceList]]</code></a> to\n          <var>deviceList</var>.</p>"
        },
        {
          "html": "<p>Queue a task that <a data-link-type=\"dfn|abstract-op\" data-lt=\"fire an event\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fires an event</a> named <a data-link-type=\"idl\" data-lt=\"devicechange\" href=\"https://www.w3.org/TR/mediacapture-streams/#event-mediadevices-devicechange\" class=\"internalDFN\" id=\"ref-for-event-mediadevices-devicechange-2\"><code>devicechange</code></a>,\n          using the <a data-link-type=\"idl\" data-lt=\"DeviceChangeEvent\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-devicechangeevent\" class=\"internalDFN\" id=\"ref-for-dom-devicechangeevent-2\"><code>DeviceChangeEvent</code></a> constructor with <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-devicechangeeventinit-devices\" class=\"internalDFN\" id=\"ref-for-dom-devicechangeeventinit-devices-1\"><code>devices</code></a>\n          initialized to <var>newExposedDevices</var>, at <var>mediaDevices</var>.</p>\n          <p>The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-52\">User Agent</a> <em class=\"rfc2119\">MAY</em> combine firing multiple events into firing one\n          event when several events are due or when multiple devices are added\n          or removed at the same time, e.g. a camera with a microphone.</p>"
        }
      ]
    },
    {
      "name": "MediaDevices/enumerateDevices()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-enumeratedevices",
      "html": "When the <a data-link-type=\"idl\" data-lt=\"enumerateDevices()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-enumeratedevices\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-enumeratedevices-4\"><code>enumerateDevices</code></a><code>()</code> method is\n              called, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-57\">User Agent</a> must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be a new promise.</p>"
        },
        {
          "html": "<p>Let <var>proceed</var> be the result of\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-enumeration-can-proceed\" class=\"internalDFN\" id=\"ref-for-device-enumeration-can-proceed-3\">device enumeration can proceed</a> with <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.</p>"
        },
        {
          "html": "<p>Let <var>mediaDevices</var> be <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.</p>"
        },
        {
          "html": "Run the following steps in parallel:",
          "rationale": "while",
          "steps": [
            {
              "html": "<p>While <var>proceed</var> is <code>false</code>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-58\">User Agent</a>\n                      <em class=\"rfc2119\">MUST</em> wait to proceed to the next step until a task queued\n                      to set <var>proceed</var> to the result of\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-enumeration-can-proceed\" class=\"internalDFN\" id=\"ref-for-device-enumeration-can-proceed-4\">device enumeration can proceed</a> with <var>mediaDevices</var>, would set\n                      <var>proceed</var> to <code>true</code>.</p>"
            },
            {
              "html": "<p>Let <var>resultList</var> be the result of\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-list-of-device-info-objects\" class=\"internalDFN\" id=\"ref-for-creating-a-list-of-device-info-objects-3\">creating a list of device info objects</a> with <var>mediaDevices</var> and\n                      <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[storedDeviceList]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-storeddevicelist\" class=\"internalDFN\" id=\"ref-for-dfn-storeddevicelist-3\"><code>[[storedDeviceList]]</code></a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var>p</var> with <var>resultList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "creating a list of device info objects",
      "href": "https://www.w3.org/TR/mediacapture-streams/#creating-a-list-of-device-info-objects",
      "html": "To perform\n              <dfn class=\"abstract-op\" id=\"creating-a-list-of-device-info-objects\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">\n              creating a list of device info objects</dfn>, given\n              <var>mediaDevices</var> and <var>deviceList</var>,\n              run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>resultList</var> be an empty list.</p>"
        },
        {
          "html": "<p>Let <var>microphoneList</var>, <var>cameraList</var> and <var>otherDeviceList</var> be empty lists.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>mediaDevices</var>'s\n                  <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a>.</p>"
        },
        {
          "html": "Run the following sub steps for each discovered device in <var>deviceList</var>, <var>device</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var> is not a microphone, or <var>document</var> is not\n                      <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the feature identified by <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-microphone\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-microphone-3\"><code>\"microphone\"</code></a>,\n                      abort these sub steps and continue with the next device (if any).</p>"
            },
            {
              "html": "<p>Let <var>deviceInfo</var> be the result of\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-device-info-object\" class=\"internalDFN\" id=\"ref-for-creating-a-device-info-object-1\">creating a device info object</a> to represent <var>device</var>,\n                      with <var>mediaDevices</var>.</p>"
            },
            {
              "html": "<p>If <var>device</var> is the system default microphone,\n                      prepend <var>deviceInfo</var> to <var>microphoneList</var>.\n                      Otherwise, append <var>deviceInfo</var> to <var>microphoneList</var>.</p>"
            }
          ]
        },
        {
          "html": "Run the following sub steps for each discovered device in <var>deviceList</var>, <var>device</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var> is not a camera, or <var>document</var> is not\n                      <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the feature identified by <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-camera\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-camera-3\"><code>\"camera\"</code></a>,\n                      abort these sub steps and continue with the next device (if any).</p>"
            },
            {
              "html": "<p>Let <var>deviceInfo</var> be the result of\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-device-info-object\" class=\"internalDFN\" id=\"ref-for-creating-a-device-info-object-2\">creating a device info object</a> to represent <var>device</var>,\n                      with <var>mediaDevices</var>.</p>"
            },
            {
              "html": "<p>If <var>device</var> is the system default camera,\n                      prepend <var>deviceInfo</var> to <var>cameraList</var>.\n                      Otherwise, append <var>deviceInfo</var> to <var>cameraList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#microphone-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-microphone-information-can-be-exposed-1\">microphone information can be exposed</a> on <var>mediaDevices</var> is <code>false</code>,\n                    truncate <var>microphoneList</var> to its first item.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#camera-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-camera-information-can-be-exposed-1\">camera information can be exposed</a> on <var>mediaDevices</var> is <code>false</code>,\n                    truncate <var>cameraList</var> to its first item.</p>"
        },
        {
          "html": "Run the following sub steps for each discovered device in <var>deviceList</var>, <var>device</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var> is a microphone or <var>device</var> is a camera,\n                      abort these sub steps and continue with the next device (if any).</p>"
            },
            {
              "html": "<p>Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-exposure-decision-non-camera-microphone\" class=\"internalDFN\" id=\"ref-for-device-exposure-decision-non-camera-microphone-1\">exposure decision algorithm for devices other than camera and microphone</a>,\n                      with <var>device</var>, <var>microphoneList</var>, <var>cameraList</var> and\n                      <var>mediaDevices</var> as input.\n                      If the result of this algorithm is <code>false</code>,\n                      abort these sub steps and continue with the next device (if any).</p>"
            },
            {
              "html": "<p>Let <var>deviceInfo</var> be the result of\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#creating-a-device-info-object\" class=\"internalDFN\" id=\"ref-for-creating-a-device-info-object-3\">creating a device info object</a> to represent <var>device</var>,\n                      with <var>mediaDevices</var>.</p>"
            },
            {
              "html": "<p>If <var>device</var> is the system default audio output,\n                      prepend <var>deviceInfo</var> to <var>otherDeviceList</var>.\n                      Otherwise, append <var>deviceInfo</var> to <var>otherDeviceList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Append to <var>resultList</var> all devices of <var>microphoneList</var> in order.</p>"
        },
        {
          "html": "<p>Append to <var>resultList</var> all devices of <var>cameraList</var> in order.</p>"
        },
        {
          "html": "<p>Append to <var>resultList</var> all devices of <var>otherDeviceList</var> in order.</p>"
        },
        {
          "html": "<p>Return <var>resultList</var>.</p>"
        }
      ]
    },
    {
      "name": "creating a device info object",
      "href": "https://www.w3.org/TR/mediacapture-streams/#creating-a-device-info-object",
      "html": "To perform <dfn class=\"abstract-op\" id=\"creating-a-device-info-object\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">creating a device info object</dfn> to represent a discovered device,\n        <var>device</var>, given <var>mediaDevices</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deviceInfo</var> be a new <a data-link-type=\"idl\" data-lt=\"MediaDeviceInfo\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-8\"><code>MediaDeviceInfo</code></a> object to represent <var>device</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-kind\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-kind-4\"><code>kind</code></a> for <var>device</var>.</p>"
        },
        {
          "html": "<p>If <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-kind\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-kind-5\"><code>kind</code></a> is equal to \"videoinput\"\n            and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#camera-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-camera-information-can-be-exposed-2\">camera information can be exposed</a> on <var>mediaDevices</var> is <code>false</code>, return <var>deviceInfo</var>.</p>"
        },
        {
          "html": "<p>If <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-kind\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-kind-6\"><code>kind</code></a> is equal to \"audioinput\"\n            and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#microphone-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-microphone-information-can-be-exposed-2\">microphone information can be exposed</a> on <var>mediaDevices</var> is <code>false</code>, return <var>deviceInfo</var>.</p>"
        },
        {
          "html": "<p>Initialize <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-label\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-label-3\"><code>label</code></a> for <var>device</var>.</p>"
        },
        {
          "html": "<p>If a stored <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-deviceid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-deviceid-6\"><code>deviceId</code></a> exists for\n            <var>device</var>, initialize <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-deviceid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-deviceid-7\"><code>deviceId</code></a> to that value.\n            Otherwise, let <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-deviceid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-deviceid-8\"><code>deviceId</code></a> be a\n            newly generated unique identifier as described under <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-deviceid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-deviceid-9\"><code>deviceId</code></a>.</p>"
        },
        {
          "html": "<p>If <var>device</var> belongs to the same physical\n            device as a device already represented for <var>document</var>,\n            initialize <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-groupid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-groupid-4\"><code>groupId</code></a> to the\n            <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-groupid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-groupid-5\"><code>groupId</code></a> value of the existing <a data-link-type=\"idl\" data-lt=\"MediaDeviceInfo\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-9\"><code>MediaDeviceInfo</code></a> object.\n            Otherwise, let <var>deviceInfo</var>.<a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-groupid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-groupid-6\"><code>groupId</code></a> be a\n            newly generated unique identifier as described under <a data-link-type=\"idl\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadeviceinfo-groupid\" class=\"internalDFN\" id=\"ref-for-dom-mediadeviceinfo-groupid-7\"><code>groupId</code></a>.</p>"
        },
        {
          "html": "<p>Return <var>deviceInfo</var></p>"
        }
      ]
    },
    {
      "name": "device enumeration can proceed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#device-enumeration-can-proceed",
      "html": "To perform a <dfn class=\"abstract-op\" id=\"device-enumeration-can-proceed\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">device enumeration can proceed</dfn> check, given <var>mediaDevices</var>,\n        run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-62\">User Agent</a> <em class=\"rfc2119\">MAY</em> return <code>true</code> if\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-device-information-can-be-exposed-1\">device information can be exposed</a> on <var>mediaDevices</var>.\n          </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-is-in-view\" class=\"internalDFN\" id=\"ref-for-dfn-is-in-view-5\">is in view</a> with <var>mediaDevices</var>.</p>"
        }
      ]
    },
    {
      "name": "device information can be exposed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#device-information-can-be-exposed",
      "html": "To perform a <dfn class=\"abstract-op\" id=\"device-information-can-be-exposed\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">device information can be exposed</dfn>\n        check, given <var>mediaDevices</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#camera-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-camera-information-can-be-exposed-3\">camera information can be exposed</a> on <var>mediaDevices</var>,\n            return <code>true</code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#microphone-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-microphone-information-can-be-exposed-3\">microphone information can be exposed</a> on <var>mediaDevices</var>,\n            return <code>true</code>.</p>"
        },
        {
          "html": "<p>Return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "camera information can be exposed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#camera-information-can-be-exposed",
      "html": "To perform a <dfn class=\"abstract-op\" id=\"camera-information-can-be-exposed\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">camera information can be exposed</dfn>\n        check, given <var>mediaDevices</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If any of the local devices of kind \"videoinput\" are attached to a live\n            <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-109\"><code>MediaStreamTrack</code></a> in <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a>, return <code>true</code>.</p>"
        },
        {
          "html": "<p>Return <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[canExposeCameraInfo]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-canexposecamerainfo\" class=\"internalDFN\" id=\"ref-for-dfn-canexposecamerainfo-1\"><code>[[canExposeCameraInfo]]</code></a>.</p>"
        }
      ]
    },
    {
      "name": "microphone information can be exposed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#microphone-information-can-be-exposed",
      "html": "To perform a <dfn class=\"abstract-op\" id=\"microphone-information-can-be-exposed\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">microphone information can be exposed</dfn>\n        check, given <var>mediaDevices</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If any of the local devices of kind \"audioinput\" are attached to a live\n            <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-110\"><code>MediaStreamTrack</code></a> in the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a>, return <code>true</code>.</p>"
        },
        {
          "html": "<p>Return <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[canExposeMicrophoneInfo]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-canexposemicrophoneinfo\" class=\"internalDFN\" id=\"ref-for-dfn-canexposemicrophoneinfo-1\"><code>[[canExposeMicrophoneInfo]]</code></a>.</p>"
        }
      ]
    },
    {
      "name": "Document/is in view",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-is-in-view",
      "html": "To perform an <dfn data-dfn-for=\"Document\" class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-is-in-view\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">is in view</dfn> check, given <var>mediaDevices</var>, run the following\n        steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a> is\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active</a> and its <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\">visibility state</a>\n            is <code>\"visible\"</code>, return <code>true</code>. Otherwise, return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "has system focus",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-has-system-focus",
      "html": "To perform a <dfn id=\"dfn-has-system-focus\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">has system focus</dfn> check, given <var>mediaDevices</var>, run the following\n        steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>mediaDevices</var>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\">navigable</a>'s\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\">top-level traversable</a> has\n            <a href=\"https://html.spec.whatwg.org/multipage/#tlbc-system-focus\">system focus</a>, return\n            <code>true</code>. Otherwise, return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "set the device information exposure",
      "href": "https://www.w3.org/TR/mediacapture-streams/#set-device-information-exposure",
      "html": "To <dfn class=\"abstract-op\" id=\"set-device-information-exposure\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">set the device information exposure</dfn> on\n        <var>mediaDevices</var>, given a <var>requestedTypes</var> <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\">set</a>, and a boolean <var>value</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-video\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-video-2\"><code>\"video\"</code></a> is in <var>requestedTypes</var>, then set\n            <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[canExposeCameraInfo]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-canexposecamerainfo\" class=\"internalDFN\" id=\"ref-for-dfn-canexposecamerainfo-2\"><code>[[canExposeCameraInfo]]</code></a> to <var>value</var>.</p>"
        },
        {
          "html": "<p>If <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-audio\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-audio-3\"><code>\"audio\"</code></a> is in <var>requestedTypes</var>, then set\n            <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[canExposeMicrophoneInfo]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-canexposemicrophoneinfo\" class=\"internalDFN\" id=\"ref-for-dfn-canexposemicrophoneinfo-2\"><code>[[canExposeMicrophoneInfo]]</code></a> to\n            <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "context is capturing",
      "href": "https://www.w3.org/TR/mediacapture-streams/#context-is-capturing",
      "html": "To perform a <dfn class=\"abstract-op\" id=\"context-is-capturing\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">context is capturing</dfn> check\n        for <var>globalObject</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>globalObject</var> is not a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>, then return false.</p>"
        },
        {
          "html": "<p>Let <var>mediaDevices</var> be <var>globalObject</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-associated-mediadevices\" class=\"internalDFN\" id=\"ref-for-dfn-associated-mediadevices-4\">associated <code>MediaDevices</code></a>.</p>"
        },
        {
          "html": "For each <var>source</var> in <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[mediaStreamTrackSources]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-mediastreamtracksources\" class=\"internalDFN\" id=\"ref-for-dfn-mediastreamtracksources-3\"><code>[[mediaStreamTrackSources]]</code></a>,\n           run the following sub steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>source</var> is <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#source-stopped\" class=\"internalDFN\" id=\"ref-for-source-stopped-7\">stopped</a> or <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-muted-0\" class=\"internalDFN\" id=\"ref-for-dfn-muted-0-3\">muted</a>, abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>deviceId</var> be <var>source</var>'s device's deviceId.</p>"
            },
            {
              "html": "<p>If <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesLiveMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-deviceslivemap\" class=\"internalDFN\" id=\"ref-for-dfn-deviceslivemap-4\"><code>[[devicesLiveMap]]</code></a>[<var>deviceId</var>] is\n               <code>true</code>, return <code>true</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "MediaDevices/getUserMedia()",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getusermedia",
      "html": "When the <dfn data-export=\"\" data-dfn-type=\"method\" id=\"dom-mediadevices-getusermedia\" data-idl=\"operation\" data-title=\"getUserMedia()\" data-dfn-for=\"MediaDevices\" data-type=\"Promise\" data-lt=\"getUserMedia()|getUserMedia(constraints)\" data-local-lt=\"MediaDevices.getUserMedia|MediaDevices.getUserMedia()|getUserMedia\" tabindex=\"0\" aria-haspopup=\"dialog\"><code>getUserMedia()</code></dfn> method is\n              called, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-77\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>constraints</var> be the method's first\n                  argument.</p>"
        },
        {
          "html": "<p>Let <var>requestedMediaTypes</var> be the set of media\n                  types in <var>constraints</var> with either a dictionary\n                  value or a value of <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>requestedMediaTypes</var> is the empty set, return\n                  a promise <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">rejected</a> with a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>. The\n                  word \"optional\" occurs in the WebIDL due to WebIDL rules, but\n                  the argument <em class=\"rfc2119\">MUST</em> be supplied in order for the call to\n                  succeed.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s\n                  <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document</code></a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is NOT\n                  <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active</a>, return a promise <a data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">rejected</a>\n                  with a <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> object whose <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-name\"><code>name</code></a>\n                  attribute has the value \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\".</p>"
        },
        {
          "html": "<p>If <var>requestedMediaTypes</var> contains \"audio\" and\n                    <var>document</var> is not <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the\n                    feature identified by the \"microphone\" permission name,\n                    jump to the step labeled <em>Permission Failure</em> below.</p>"
        },
        {
          "html": "<p>If <var>requestedMediaTypes</var> contains \"video\" and\n                    <var>document</var> is not <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the\n                    feature identified by the \"camera\" permission name,\n                    jump to the step labeled <em>Permission Failure</em> below.</p>"
        },
        {
          "html": "<p>Let <var>mediaDevices</var> be <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.</p>"
        },
        {
          "html": "<p>Let <var>isInView</var> be the result of the\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-is-in-view\" class=\"internalDFN\" id=\"ref-for-dfn-is-in-view-6\">is in view</a> algorithm.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be a new promise.</p>"
        },
        {
          "html": "Run the following steps in parallel:",
          "rationale": "while",
          "steps": [
            {
              "html": "<p>While <var>isInView</var> is <code>false</code>, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-78\">User Agent</a>\n                      <em class=\"rfc2119\">MUST</em> wait to proceed to the next step until a task queued\n                      to set <var>isInView</var> to the result of the\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-is-in-view\" class=\"internalDFN\" id=\"ref-for-dfn-is-in-view-7\">is in view</a> algorithm, would set\n                      <var>isInView</var> to <code>true</code>.</p>"
            },
            {
              "html": "<p>Let <var>finalSet</var> be an (initially) empty\n                      set.</p>"
            },
            {
              "html": "For each media type <var>kind</var> in\n                      <var>requestedMediaTypes</var>, run the following steps:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<p>For each possible configuration of each possible\n                          source device of media of type <var>kind</var>, conceive a\n                          <dfn id=\"dfn-candidate\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">candidate</dfn> as a placeholder for an eventual\n                          <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-113\"><code>MediaStreamTrack</code></a> holding a source device and configured with a <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-2\">settings\n                          dictionary</a> comprised of its specific settings.</p>\n                          <p>Call this set of candidates the\n                          <var>candidateSet</var>.</p>\n                          <p>If <var>candidateSet</var> is the empty set,\n                          jump to the step labeled <em>NotFound Failure</em> below.</p>"
                },
                {
                  "html": "If the value of the <var>kind</var> entry of\n                        <var>constraints</var> is <code>true</code>, set <var>CS</var> to\n                        the empty constraint set (no constraint). Otherwise,\n                        continue with <var>CS</var> set to the value of the\n                        <var>kind</var> entry of <var>constraints</var>."
                },
                {
                  "html": "Remove any constrainable property inside of\n                        <var>CS</var> that are not defined for\n                        <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-114\"><code>MediaStreamTrack</code></a> objects of type\n                        <var>kind</var>. This means that audio-only constraints\n                        inside of <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-video\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-video-3\"><code>\"video\"</code></a> and video-only constraints inside of\n                        <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-audio\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-audio-4\"><code>\"audio\"</code></a> are simply ignored rather than causing\n                        <code>OverconstrainedError</code>."
                },
                {
                  "html": "<p>If <var>CS</var> contains a member that is a\n                        <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-required-constraints\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-required-constraints-6\">required constraint</a> and whose name is not in the\n                        list of <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-allowed-required-constraints-for-device-selection\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-allowed-required-constraints-for-device-selection-1\">allowed required constraints for device selection</a>,\n                        then <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var>p</var> with a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>, and abort\n                        these steps.</p>"
                },
                {
                  "html": "<p>Run the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-2\">SelectSettings</a> algorithm on each\n                          candidate in <var>candidateSet</var> with <var>CS</var>\n                          as the constraint set. If the algorithm returns\n                          <code>undefined</code>, remove the candidate from\n                          <var>candidateSet</var>. This eliminates devices\n                          unable to satisfy the constraints, by verifying that\n                          at least one settings dictionary exists that\n                          satisfies the constraints.</p>\n                          <p>If <var>candidateSet</var> is the empty set, let\n                          <var>failedConstraint</var>  be any\n                          <a data-lt=\"required constraints\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-required-constraints\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-required-constraints-7\">required constraint</a>\n                          whose fitness distance was infinity for\n                          all settings dictionaries examined while executing\n                          the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-3\">SelectSettings</a> algorithm, or\n                          <code>\"\"</code> if there isn't one, and jump to the\n                          step labeled <em>Constraint Failure</em> below.</p>\n                          <p class=\"fingerprint\">This error gives information\n                          about what the underlying device is not capable of\n                          producing, before the user has given any\n                          authorization to any device, and can thus be used as\n                          a fingerprinting surface.<img src=\"https://www.w3.org/TR/mediacapture-streams/images/fingerprint.png\" alt=\"(This is a fingerprinting vector.)\" width=\"15\" height=\"21\"></p>"
                },
                {
                  "html": "<p>Read the current <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a> for all\n                          candidate devices in <var>candidateSet</var> that are\n                          not attached to a live <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-115\"><code>MediaStreamTrack</code></a>\n                          in the current <a data-link-type=\"idl\" data-lt=\"Document\" data-type=\"interface\" href=\"https://dom.spec.whatwg.org/#document\"><code>Document</code></a>. Remove from\n                          <var>candidateSet</var> any candidate whose device's\n                          permission state is \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\"><code>denied</code></a>\".</p>\n                          <p>If <var>candidateSet</var> is now empty,\n                          indicating that all devices of this type are in state\n                          \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\"><code>denied</code></a>\", jump to the step labeled\n                          <em>PermissionFailure</em> below.</p>"
                },
                {
                  "html": "<p>Optionally, e.g., based on a previously-established\n                          user preference, for security reasons, or due to platform\n                          limitations, jump to the step labeled <em>Permission\n                          Failure</em> below.</p>"
                },
                {
                  "html": "<p>Add all candidates from <var>candidateSet</var> to\n                          <var>finalSet</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>stream</var> be a new and empty\n                      <a data-link-type=\"idl\" data-lt=\"MediaStream\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastream\" class=\"internalDFN\" id=\"ref-for-dom-mediastream-91\"><code>MediaStream</code></a> object.</p>"
            },
            {
              "html": "For each media type <var>kind</var> in\n                      <var>requestedMediaTypes</var>, run the following sub steps,\n                      preferably at the same time:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-request-permission-to-use\">Request permission to use</a> a <a data-link-type=\"idl\" data-lt=\"PermissionDescriptor\" data-type=\"dictionary\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor\"><code>PermissionDescriptor</code></a> with its <a data-link-type=\"idl\" data-type=\"dict-member\" href=\"https://www.w3.org/TR/permissions/#dom-permissiondescriptor-name\"><code>name</code></a> member set\n                          to the permission name associated with <var>kind</var>\n                          (e.g. <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-camera\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-camera-4\"><code>\"camera\"</code></a> for <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-video\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-video-4\"><code>\"video\"</code></a>, <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-microphone\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-microphone-4\"><code>\"microphone\"</code></a> for <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-audio\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-audio-5\"><code>\"audio\"</code></a>),\n                          while considering all devices attached to a\n                          live and <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-same-permission\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-same-permission-1\">same-permission</a>\n                          <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-116\"><code>MediaStreamTrack</code></a> in the current <a data-link-type=\"idl\" data-lt=\"Document\" data-type=\"interface\" href=\"https://dom.spec.whatwg.org/#document\"><code>Document</code></a>\n                          to have permission status \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\",\n                          resulting in a set of provided media.\n                          <dfn id=\"dfn-same-permission\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">Same-permission</dfn> in this context means a\n                          <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-117\"><code>MediaStreamTrack</code></a> that required the same level of\n                          permission to obtain as what is being requested (e.g. not\n                          isolated).</p>\n                          <p>When asking the users permission, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-80\">User Agent</a>\n                          <em class=\"rfc2119\">MUST</em> disclose whether permission will be granted only to\n                          the device chosen, or to all devices of that\n                          <var>kind</var>.</p>"
                },
                {
                  "html": "<p>If the result of the request is \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\"><code>denied</code></a>\",\n                          jump to the step labeled <em>Permission Failure</em> below.</p>"
                },
                {
                  "html": "<p>Let <var>hasSystemFocus</var> be <code>false</code>.</p>"
                },
                {
                  "html": "<p>While <var>hasSystemFocus</var> is <code>false</code>, the\n                          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-81\">User Agent</a> <em class=\"rfc2119\">MUST</em> wait to proceed to the next step\n                          until a task queued to set <var>hasSystemFocus</var>\n                          to the result of the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-has-system-focus\" class=\"internalDFN\" id=\"ref-for-dfn-has-system-focus-1\">has system focus</a>\n                          algorithm, would set <var>hasSystemFocus</var> to\n                          <code>true</code>.</p>"
                },
                {
                  "html": "<p>Let <var>finalCandidate</var> be the provided media, which\n                          <em class=\"rfc2119\">MUST</em> be precisely one <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-candidate\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-candidate-1\">candidate</a> of type <var>kind</var> from\n                          <var>finalSet</var>. The decision of which candidate to\n                          choose from the <var>finalSet</var> is completely up to\n                          the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-82\">User Agent</a> and may be determined by asking the user.\n                          </p>\n                          <p>The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-83\">User Agent</a> <em class=\"rfc2119\">SHOULD</em> use the value of the computed\n                          <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fitness-distance\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-fitness-distance-1\">fitness distance</a> from the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-4\">SelectSettings</a>\n                          algorithm as an input to the selection algorithm.\n                          However, it <em class=\"rfc2119\">MAY</em> also use other internally-available\n                          information about the devices, such as user preference.</p>\n                          <p><a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-84\">User Agents</a> are encouraged to default to using the\n                          user's primary or system default device for <var>kind</var>\n                          (when possible). <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-85\">User Agents</a>\n                          <em class=\"rfc2119\">MAY</em> allow users to use any media source, including\n                          pre-recorded media files.</p>"
                },
                {
                  "html": "<p>The result of the request is \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-granted\"><code>granted</code></a>\".\n                          If a hardware error such as an OS/program/webpage lock prevents access,\n                          remove the corresponding candidate from <var>finalSet</var>.\n                          If <var>finalSet</var> has no candidates of type <var>kind</var>,\n                          <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var>p</var> with a new\n                          <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> object whose\n                          <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-name\"><code>name</code></a> attribute has the value\n                          \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notreadableerror\"><code>NotReadableError</code></a>\" and abort these steps.\n                          Otherwise, restart these sub steps with the updated <var>finalSet</var>.</p>\n                          <p>If device access fails for any reason other than those listed above,\n                          remove the corresponding candidate from <var>finalSet</var>.\n                          If <var>finalSet</var> has no candidates of type <var>kind</var>,\n                          <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var>p</var> with a new <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>\n                          object whose <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-name\"><code>name</code></a> attribute has the\n                          value \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError</code></a>\" and abort these steps.\n                          Otherwise, restart these sub steps with the updated <var>finalSet</var>.</p>"
                },
                {
                  "html": "<p>Let <var>grantedDevice</var> be\n                            <var>finalCandidate</var>'s source device.</p>"
                },
                {
                  "html": "<p>Using <var>grantedDevice</var>'s deviceId, <var>deviceId</var>, set\n                          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesLiveMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-deviceslivemap\" class=\"internalDFN\" id=\"ref-for-dfn-deviceslivemap-5\"><code>[[devicesLiveMap]]</code></a>[<var>deviceId</var>] to\n                          <code>true</code>, if it isnt already <code>true</code>,\n                          and set\n                          <var>mediaDevices</var>.<a data-link-type=\"attribute\" data-lt=\"[[devicesAccessibleMap]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-devicesaccessiblemap\" class=\"internalDFN\" id=\"ref-for-dfn-devicesaccessiblemap-5\"><code>[[devicesAccessibleMap]]</code></a>[<var>deviceId</var>] to\n                          <code>true</code>, if it isnt already\n                          <code>true</code>.</p>"
                },
                {
                  "html": "<p>Let <var>track</var> be the result of\n                          <a data-link-type=\"dfn|abstract-op\" data-lt=\"create a MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-create-a-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dfn-create-a-mediastreamtrack-2\">creating a MediaStreamTrack</a>\n                          with <var>grantedDevice</var> and <var>mediaDevices</var>.\n                          The source of the <a data-link-type=\"idl\" data-lt=\"MediaStreamTrack\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack\" class=\"internalDFN\" id=\"ref-for-dom-mediastreamtrack-118\"><code>MediaStreamTrack</code></a> <em class=\"rfc2119\">MUST NOT</em> change.</p>"
                },
                {
                  "html": "<p>Add <var>track</var> to <var>stream</var>'s track set.</p>"
                }
              ]
            },
            {
              "html": "<p>Run the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-applyconstraints-algorithm-3\">ApplyConstraints algorithm</a> on all\n                      tracks in <var>stream</var> with the appropriate\n                      constraints. If any of them returns something other than\n                      <code>undefined</code>, let <var>failedConstraint</var> be\n                      that result and jump to the step labeled\n                      <em>Constraint Failure</em> below.</p>"
            },
            {
              "html": "<p>For each <var>track</var> in <var>stream</var>,\n                      <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-tie-track-source-to-mediadevices\" class=\"internalDFN\" id=\"ref-for-dfn-tie-track-source-to-mediadevices-2\">tie track source to <code>MediaDevices</code></a> with\n                      <var>track</var>.<a data-link-type=\"attribute\" data-lt=\"[[Source]]\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-source-0\" class=\"internalDFN\" id=\"ref-for-dfn-source-0-4\"><code>[[Source]]</code></a> and\n                      <var>mediaDevices</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#set-device-information-exposure\" class=\"internalDFN\" id=\"ref-for-set-device-information-exposure-1\">Set the device information exposure</a> on <var>mediaDevices</var>\n                      with <code>requestedMediaTypes</code> and <code>true</code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <var>p</var> with <var>stream</var> and\n                      abort these steps.</p>"
            },
            {
              "html": "<em>NotFound Failure</em>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>\n                          If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#getUserMedia-specific-failure-is-allowed\" class=\"internalDFN\" id=\"ref-for-getUserMedia-specific-failure-is-allowed-1\">getUserMedia specific failure is allowed</a>\n                          given <var>requestedMediaTypes</var>\n                          returns <code>false</code>, jump to the step\n                          labeled <em>Permission Failure</em> below.\n                        </p>"
                },
                {
                  "html": "<p>\n                          <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> <var>p</var> with a new\n                          <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> object whose <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-name\"><code>name</code></a> attribute\n                          has the value \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notfounderror\"><code>NotFoundError</code></a>\".</p>\n                        <p></p>"
                }
              ]
            },
            {
              "html": "<em>Constraint Failure</em>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>\n                          If <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#getUserMedia-specific-failure-is-allowed\" class=\"internalDFN\" id=\"ref-for-getUserMedia-specific-failure-is-allowed-2\">getUserMedia specific failure is allowed</a>\n                          given <var>requestedMediaTypes</var>\n                          returns <code>false</code>, jump to the step\n                          labeled <em>Permission Failure</em> below.\n                        </p>"
                },
                {
                  "html": "<p>\n                          Let <var>message</var> be\n                          either <code>undefined</code> or an informative\n                          human-readable message, let <var>constraint</var> be\n                          <var>failedConstraint</var> if\n                          <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#device-information-can-be-exposed\" class=\"internalDFN\" id=\"ref-for-device-information-can-be-exposed-2\">device information can be exposed</a> is\n                          <code>true</code>, or <code>\"\"</code> otherwise.\n                        </p>"
                },
                {
                  "html": "<p>\n                          <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> <var>p</var> with a new\n                          <code>OverconstrainedError</code> created by calling\n                          <code>OverconstrainedError(<var>constraint</var>,\n                          <var>message</var>)</code>.</p>\n                        <p></p>"
                }
              ]
            },
            {
              "html": "<p><em>Permission Failure</em>: <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a>\n                      <var>p</var> with a new <a data-link-type=\"idl\" data-lt=\"DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>\n                      object whose <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-name\"><code>name</code></a> attribute has the\n                      value \"<a data-link-type=\"idl\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "getUserMedia specific failure is allowed",
      "href": "https://www.w3.org/TR/mediacapture-streams/#getUserMedia-specific-failure-is-allowed",
      "html": "To check whether <dfn class=\"abstract-op\" id=\"getUserMedia-specific-failure-is-allowed\" data-dfn-type=\"abstract-op\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">getUserMedia specific failure is allowed</dfn>,\n        given <var>requestedMediaTypes</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>requestedMediaTypes</var> contains \"audio\", read the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a>\n            for the descriptor whose name is \"microphone\". If the result of the request is\n            \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\"><code>denied</code></a>\", return <code>false</code>.</p>"
        },
        {
          "html": "<p>If <var>requestedMediaTypes</var> contains \"video\", read the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\">permission state</a>\n            for the descriptor whose name is \"camera\". If the result of the request is\n            \"<a data-link-type=\"idl\" data-type=\"enum-value\" href=\"https://www.w3.org/TR/permissions/#dom-permissionstate-denied\"><code>denied</code></a>\", return <code>false</code>.</p>"
        },
        {
          "html": "<p>Return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "applyConstraints template method",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-template-method",
      "html": "When the <dfn id=\"dfn-applyconstraints-template-method\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">applyConstraints template method</dfn> is invoked, the\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-121\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>object</var> be the object on which this method\n                  was invoked.</p>"
        },
        {
          "html": "<p>Let <var>newConstraints</var> be the argument to this\n                  method.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be a new promise.</p>"
        },
        {
          "html": "Run the following steps in parallel, maintaining the order\n                  of invocations if this method is called multiple times:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>failedConstraint</var> be the result of\n                      running the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-applyconstraints-algorithm-6\">ApplyConstraints algorithm</a> with\n                      <var>newConstraints</var> as the argument.</p>"
            },
            {
              "html": "<p>Let <var>successfulSettings</var> be the\n                      <var>object</var>'s current settings after the algorithm\n                      in the above step has finished.</p>"
            },
            {
              "html": "Queue a task that runs the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>failedConstraint</var> is not\n                          <code>undefined</code>, let <var>message</var> be either\n                          <code>undefined</code> or an informative human-readable\n                          message, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var>p</var> with a new\n                          <code>OverconstrainedError</code> created by calling\n                          <code>OverconstrainedError(<var>failedConstraint</var>,\n                          <var>message</var>)</code>, and abort these steps. The\n                          existing constraints remain in effect in this case.</p>"
                },
                {
                  "html": "<p>Set <var>object</var>'s <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraints\" class=\"internalDFN\" id=\"ref-for-dfn-constraints-6\">[[Constraints]]</a>\n                          internal slot to <var>newConstraints</var> or a\n                          <code>Constraints</code> dictionary that has the\n                          identical effect in all situations as\n                          <var>newConstraints</var>.</p>"
                },
                {
                  "html": "<p>Set <var>object</var>'s <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-6\">[[Settings]]</a>\n                          internal slot to <var>successfulSettings</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var>p</var> with\n                          <code>undefined</code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "fitness distance",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-fitness-distance",
      "html": "We define the <dfn data-export=\"\" id=\"dfn-fitness-distance\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">fitness distance</dfn> between a\n              <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-3\">settings dictionary</a> and a constraint set <var>CS</var> as\n              the sum, for each member (represented by a\n              <var>constraintName</var> and <var>constraintValue</var> pair)\n              which <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\">exist</a>s in\n              <var>CS</var>, of the following values:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>constraintName</var> is not supported by the\n                  <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-122\">User Agent</a>, the fitness distance is 0.</p>"
        },
        {
          "html": "<p>If the constraint is <dfn id=\"dfn-required\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">required</dfn>\n                  (<var>constraintValue</var>\n                  either contains one or more members named 'min', 'max', or\n                  'exact', or is itself a bare value and bare values are to be\n                  treated as 'exact'), and the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-4\">settings dictionary</a>'s\n                  <var>constraintName</var> member's value does not satisfy the\n                  constraint or doesn't <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\">exist</a>, the fitness distance is\n                  positive infinity.</p>"
        },
        {
          "html": "<p>If the constraint does not apply for this type of object,\n                  the fitness distance is 0 (that is, the constraint does not\n                  influence the fitness distance).</p>"
        },
        {
          "html": "<p>If <var>constraintValue</var> is a boolean, but the\n                  constrainable property is not, then the fitness distance is\n                  based on whether the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-5\">settings dictionary</a>'s\n                  <var>constraintName</var> member <a data-link-type=\"dfn|abstract-op\" data-lt=\"exist\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\">exists</a> or\n                  not, from the formula\n                  </p><pre aria-busy=\"false\"><code class=\"hljs\">(constraintValue == exists) ? 0 : 1</code></pre>"
        },
        {
          "html": "<p>If the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-6\">settings dictionary</a>'s <var>constraintName</var>\n                  member does <a data-link-type=\"dfn|abstract-op\" data-lt=\"exist\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\">not exist</a>, the fitness distance\n                  is 1.</p>"
        },
        {
          "html": "If no ideal value is specified (<var>constraintValue</var>\n                either contains no member named 'ideal', or, if bare values are\n                to be treated as 'ideal', isn't a bare value), the fitness\n                distance is 0."
        },
        {
          "html": "For all positive numeric constraints (such as\n                height, width, frameRate, aspectRatio, sampleRate and\n                sampleSize), the fitness distance is the result of the formula\n                  <pre aria-busy=\"false\"><code class=\"hljs\">(actual == ideal) ? 0 : |actual - ideal| / max(|actual|, |ideal|)</code></pre>"
        },
        {
          "html": "For all string, enum and boolean constraints (e.g.\n                deviceId, groupId, facingMode, resizeMode, echoCancellation),\n                the fitness distance is the result of the formula\n                  <pre aria-busy=\"false\"><code class=\"hljs\">(actual == ideal) ? 0 : 1</code></pre>"
        }
      ]
    },
    {
      "name": "SelectSettings",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings",
      "html": "We define the <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-selectsettings\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">SelectSettings</dfn> algorithm as\n              follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Each <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-constraint\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-constraint-1\">constraint</a> specifies one\n                or more values (or a range of values) for its property. A\n                property <em class=\"rfc2119\">MAY</em> appear more than once in the list of 'advanced'\n                ConstraintSets. If an empty list has been given as the value\n                for a constraint, it <em class=\"rfc2119\">MUST</em> be interpreted as if the constraint\n                were not specified (in other words, an empty constraint == no\n                constraint).\n                  <p>Note that unknown properties are discarded by WebIDL,\n                  which means that unknown/unsupported required constraints\n                  will silently disappear. To avoid this being a surprise,\n                  application authors are expected to first use the\n                  <a data-link-type=\"idl\" data-lt=\"getSupportedConstraints()\" href=\"https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-getsupportedconstraints\" class=\"internalDFN\" id=\"ref-for-dom-mediadevices-getsupportedconstraints-3\"><code>getSupportedConstraints</code></a><code>()</code> method as shown in the\n                  Examples below.</p>"
        },
        {
          "html": "Let <var>object</var> be the\n                <code><a href=\"https://www.w3.org/TR/mediacapture-streams/#dom-constrainablepattern\" class=\"internalDFN\" data-link-type=\"idl\" id=\"ref-for-dom-constrainablepattern-10\"><code>ConstrainablePattern</code></a></code> object on which this\n                algorithm is applied. Let <var>copy</var> be an unconstrained\n                copy of <var>object</var> (i.e., <var>copy</var> should behave\n                as if it were <var>object</var> with all ConstraintSets\n                removed.)"
        },
        {
          "html": "<p>For every possible <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-7\">settings dictionary</a> of\n                  <var>copy</var> compute its <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fitness-distance\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-fitness-distance-3\">fitness distance</a>, treating\n                  bare values of properties as ideal values. Let\n                  <var>candidates</var> be the set of <a data-lt=\"settings dictionary\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-dictionary\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-settings-dictionary-8\">settings dictionaries</a> for which the\n                  fitness distance is finite.</p>"
        },
        {
          "html": "<p>If <var>candidates</var> is empty, return\n                  <code>undefined</code> as the result of the\n                  <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-5\">SelectSettings</a> algorithm.</p>"
        },
        {
          "html": "Iterate over the 'advanced' ConstraintSets in\n                <var>newConstraints</var> in the order in which they were\n                specified. For each ConstraintSet:",
          "rationale": "compute",
          "steps": [
            {
              "html": "<p>compute the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fitness-distance\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-fitness-distance-4\">fitness distance</a> between it and\n                      each settings dictionary in <var>candidates</var>,\n                      treating bare values of properties as exact.</p>"
            },
            {
              "html": "<p>If the fitness distance is finite for one or more\n                      settings dictionaries in <var>candidates</var>, keep\n                      those settings dictionaries in <var>candidates</var>,\n                      discarding others.</p>\n                      <p>If the fitness distance is infinite for all settings\n                      dictionaries in <var>candidates</var>, ignore this\n                      ConstraintSet.</p>"
            }
          ]
        },
        {
          "html": "<p>Select one settings dictionary from <var>candidates</var>,\n                  and return it as the result of the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-6\">SelectSettings</a>\n                  algorithm. The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-123\">User Agent</a> <em class=\"rfc2119\">MUST</em> use one with the smallest\n                  <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-fitness-distance\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-fitness-distance-5\">fitness distance</a>, as calculated in step 3. If more than\n                  one settings dictionary have the smallest fitness distance,\n                  the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-124\">User Agent</a> chooses one of them based on system default property values\n                  and <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-125\">User Agent</a> default property values.</p>"
        }
      ]
    },
    {
      "name": "ApplyConstraints algorithm",
      "href": "https://www.w3.org/TR/mediacapture-streams/#dfn-applyconstraints-algorithm",
      "html": "To apply the <dfn class=\"abstract-op\" data-dfn-type=\"abstract-op\" id=\"dfn-applyconstraints-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-export=\"\">ApplyConstraints algorithm</dfn> to an\n              <var>object</var>, given <var>newConstraints</var> as an\n              argument, the <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-128\">User Agent</a> <em class=\"rfc2119\">MUST</em> run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>successfulSettings</var> be the result of running\n                  the <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-7\">SelectSettings</a> algorithm with\n                  <var>newConstraints</var> as the constraint set.</p>"
        },
        {
          "html": "<p>If <var>successfulSettings</var> is\n                  <code>undefined</code>, let <var>failedConstraint</var> be\n                  any <a data-lt=\"required constraints\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-required-constraints\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-required-constraints-10\">required constraint</a>\n                  whose fitness distance was infinity\n                  for all settings dictionaries examined while executing the\n                  <a href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-selectsettings\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-selectsettings-8\">SelectSettings</a> algorithm, or <code>\"\"</code> if there\n                  isn't one, and then return\n                  <var>failedConstraint</var> and abort these steps.</p>"
        },
        {
          "html": "In a single operation, remove the existing constraints from\n                <var>object</var>, apply <var>newConstraints</var>, and apply\n                <var>successfulSettings</var> as the current settings."
        },
        {
          "html": "Return <code>undefined</code>."
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn|abstract-op\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-user-agent\" class=\"internalDFN\" id=\"ref-for-dfn-user-agent-129\">User Agent</a> <em class=\"rfc2119\">MAY</em> choose new settings for the constrainable\n              properties of the object at any time. When it does so it <em class=\"rfc2119\">MUST</em>\n              attempt to satisfy all current Constraints, in the manner\n              described in the algorithm above, let\n              <var>successfulSettings</var> be the resulting new settings, and\n              queue a task to run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>object</var> be the\n                  <code><a href=\"https://www.w3.org/TR/mediacapture-streams/#dom-constrainablepattern\" class=\"internalDFN\" data-link-type=\"idl\" id=\"ref-for-dom-constrainablepattern-11\"><code>ConstrainablePattern</code></a></code> object on which new\n                  settings for one or more constrainable properties have changed.\n                  </p>"
        },
        {
          "html": "<p>Set <var>object</var>'s <a data-link-type=\"attribute\" href=\"https://www.w3.org/TR/mediacapture-streams/#dfn-settings-0\" class=\"internalDFN\" id=\"ref-for-dfn-settings-0-7\">[[Settings]]</a> internal\n                  slot to <var>successfulSettings</var>.</p>"
        }
      ]
    }
  ]
}