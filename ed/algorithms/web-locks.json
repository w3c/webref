{
  "spec": {
    "title": "Web Locks API",
    "url": "https://w3c.github.io/web-locks/"
  },
  "algorithms": [
    {
      "name": "obtain a lock manager",
      "href": "https://w3c.github.io/web-locks/#obtain-a-lock-manager",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-lock-manager\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a lock manager</dfn>, given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object\">environment settings object</a> <var>environment</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>map</var> be the result of <a data-link-type=\"dfn\" href=\"https://storage.spec.whatwg.org/#obtain-a-local-storage-bottle-map\" id=\"ref-for-obtain-a-local-storage-bottle-map\">obtaining a local storage bottle map</a> given <var>environment</var> and \"<code>web-locks</code>\".</p>"
        },
        {
          "html": "<p>If <var>map</var> is failure, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>bottle</var> be <var>map</var>’s associated <a data-link-type=\"dfn\" href=\"https://storage.spec.whatwg.org/#storage-bottle\" id=\"ref-for-storage-bottle①\">storage bottle</a>.</p>"
        },
        {
          "html": "<p>Return <var>bottle</var>’s associated <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager\" id=\"ref-for-lock-manager②\">lock manager</a>.</p>"
        }
      ]
    },
    {
      "name": "waiting promise settles",
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①⓪\">lock</a> <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-waiting-promise\" id=\"ref-for-lock-concept-waiting-promise③\">waiting promise</a> settles (fulfills or rejects), <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps①\">enqueue the following steps</a> on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue\">lock task queue</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#release-the-lock\" id=\"ref-for-release-the-lock\">Release the lock</a> <var>lock</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-released-promise\" id=\"ref-for-lock-concept-released-promise③\">released promise</a> with <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-waiting-promise\" id=\"ref-for-lock-concept-waiting-promise④\">waiting promise</a>.</p>"
        }
      ]
    },
    {
      "name": "get the lock request queue",
      "href": "https://w3c.github.io/web-locks/#get-the-lock-request-queue",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-lock-request-queue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the lock request queue</dfn> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map\">lock request queue map</a> <var>queueMap</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#resource-name\" id=\"ref-for-resource-name④\">resource name</a> <var>name</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>queueMap</var>[<var>name</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">set</a> <var>queueMap</var>[<var>name</var>] to a new empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-queue\" id=\"ref-for-lock-request-queue①\">lock request queue</a>.</p>"
        },
        {
          "html": "<p>Return <var>queueMap</var>[<var>name</var>].</p>"
        }
      ]
    },
    {
      "name": "grantable",
      "href": "https://w3c.github.io/web-locks/#grantable",
      "html": "A <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request\" id=\"ref-for-lock-request④\">lock request</a> <var>request</var> is said to be <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"grantable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">grantable</dfn> if the following steps return true:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>manager</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-manager\" id=\"ref-for-lock-request-manager\">manager</a>.</p>"
        },
        {
          "html": "<p>Let <var>queueMap</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map①\">lock request queue map</a>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-name\" id=\"ref-for-lock-request-name\">name</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#get-the-lock-request-queue\" id=\"ref-for-get-the-lock-request-queue\">getting the lock request queue</a> from <var>queueMap</var> for <var>name</var>.</p>"
        },
        {
          "html": "<p>Let <var>held</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-held-lock-set\" id=\"ref-for-lock-manager-held-lock-set\">held lock set</a></p>"
        },
        {
          "html": "<p>Let <var>mode</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-mode\" id=\"ref-for-lock-request-mode\">mode</a></p>"
        },
        {
          "html": "<p>If <var>queue</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is not empty</a> and <var>request</var> is not the first <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item\">item</a> in <var>queue</var>, then return false.</p>"
        },
        {
          "html": "<p>If <var>mode</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#dom-lockmode-exclusive\" id=\"ref-for-dom-lockmode-exclusive⑤\">exclusive</a></code>\", then return true if no <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①②\">lock</a> in <var>held</var> has <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-name\" id=\"ref-for-lock-concept-name\">name</a> equal to <var>name</var>, and false otherwise.</p>"
        },
        {
          "html": "<p>Otherwise, <var>mode</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#dom-lockmode-shared\" id=\"ref-for-dom-lockmode-shared④\">shared</a></code>\"; return true if no <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①③\">lock</a> in <var>held</var> has <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-mode\" id=\"ref-for-lock-concept-mode\">mode</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#dom-lockmode-exclusive\" id=\"ref-for-dom-lockmode-exclusive⑥\">exclusive</a></code>\" and has <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-name\" id=\"ref-for-lock-concept-name①\">name</a> equal to <var>name</var>, and false otherwise.</p>"
        }
      ]
    },
    {
      "name": "terminate remaining locks and requests",
      "href": "https://w3c.github.io/web-locks/#terminate-remaining-locks-and-requests",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"terminate-remaining-locks-and-requests\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">terminate remaining locks and requests</dfn> with <var>agent</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps②\">enqueue the following steps</a> on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue①\">lock task queue</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request\" id=\"ref-for-lock-request⑤\">lock request</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-agent\" id=\"ref-for-lock-request-agent\">agent</a> equal to <var>agent</var>:",
          "rationale": "abort",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#abort-the-request\" id=\"ref-for-abort-the-request\">Abort the request</a> <var>request</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①④\">lock</a> <var>lock</var> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-agent\" id=\"ref-for-lock-concept-agent\">agent</a> equal to <var>agent</var>:",
          "rationale": "release",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#release-the-lock\" id=\"ref-for-release-the-lock①\">Release the lock</a> <var>lock</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "LockManager request method",
      "href": "https://w3c.github.io/web-locks/#dom-lockmanager-request",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"LockManager\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-lockmanager-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>request(<var>name</var>, <var>callback</var>)</code></dfn> and <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"LockManager\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-lockmanager-request-name-options-callback\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>request(<var>name</var>, <var>options</var>, <var>callback</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>options</var> was not passed, then let <var>options</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#dictdef-lockoptions\" id=\"ref-for-dictdef-lockoptions①\">LockOptions</a></code> dictionary with default members.</p>"
        },
        {
          "html": "<p>Let <var>environment</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <var>environment</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>manager</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#obtain-a-lock-manager\" id=\"ref-for-obtain-a-lock-manager\">obtaining a lock manager</a> given <var>environment</var>. If that returned failure, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>name</var> starts with U+002D HYPHEN-MINUS (-), then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If both <var>options</var>[\"<code>steal</code>\"] and <var>options</var>[\"<code>ifAvailable</code>\"] are true, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with③\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>steal</code>\"] is true and <var>options</var>[\"<code>mode</code>\"] is not \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#dom-lockmode-exclusive\" id=\"ref-for-dom-lockmode-exclusive⑨\">exclusive</a></code>\", then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with④\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror②\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>, and either of <var>options</var>[\"<code>steal</code>\"] or <var>options</var>[\"<code>ifAvailable</code>\"] is true, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑤\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑥\">a promise rejected with</a> <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#request-a-lock\" id=\"ref-for-request-a-lock\">Request a lock</a> with <var>promise</var>, the current <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#agent\" id=\"ref-for-agent⑦\">agent</a>, <var>environment</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-id\" id=\"ref-for-concept-environment-id\">id</a>, <var>manager</var>, <var>callback</var>, <var>name</var>, <var>options</var>[\"<code>mode</code>\"], <var>options</var>[\"<code>ifAvailable</code>\"], <var>options</var>[\"<code>steal</code>\"], and <var>options</var>[\"<code>signal</code>\"].</p>"
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "LockManager/query()",
      "href": "https://w3c.github.io/web-locks/#dom-lockmanager-query",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"LockManager\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-lockmanager-query\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>query()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>environment</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <var>environment</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active①\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑦\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>manager</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#obtain-a-lock-manager\" id=\"ref-for-obtain-a-lock-manager①\">obtaining a lock manager</a> given <var>environment</var>. If that returned failure, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑧\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps③\">Enqueue the steps</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#snapshot-the-lock-state\" id=\"ref-for-snapshot-the-lock-state\">snapshot the lock state</a> for <var>manager</var> with <var>promise</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue②\">lock task queue</a>.</p>"
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "request a lock",
      "href": "https://w3c.github.io/web-locks/#request-a-lock",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-a-lock\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">request a lock</dfn> with <var>promise</var>, <var>agent</var>, <var>clientId</var>, <var>manager</var>, <var>callback</var>, <var>name</var>, <var>mode</var>, <var>ifAvailable</var>, <var>steal</var>, and <var>signal</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request\" id=\"ref-for-lock-request⑦\">lock request</a> (<var>agent</var>, <var>clientId</var>, <var>manager</var>, <var>name</var>, <var>mode</var>, <var>callback</var>, <var>promise</var>, <var>signal</var>).</p>"
        },
        {
          "html": "<p>If <var>signal</var> is present, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">add</a> the algorithm <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#signal-to-abort-the-request\" id=\"ref-for-signal-to-abort-the-request\">signal to abort the request</a> <var>request</var> with <var>signal</var> to <var>signal</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps④\">Enqueue the following steps</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue③\">lock task queue</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>queueMap</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map②\">lock request queue map</a>.</p>"
            },
            {
              "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#get-the-lock-request-queue\" id=\"ref-for-get-the-lock-request-queue①\">getting the lock request queue</a> from <var>queueMap</var> for <var>name</var>.</p>"
            },
            {
              "html": "<p>Let <var>held</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-held-lock-set\" id=\"ref-for-lock-manager-held-lock-set①\">held lock set</a>.</p>"
            },
            {
              "html": "If <var>steal</var> is true, then run these steps:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>lock</var> of <var>held</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-name\" id=\"ref-for-lock-concept-name③\">name</a> is <var>name</var>, then run these steps:",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">Remove</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①⑧\">lock</a> from <var>held</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-released-promise\" id=\"ref-for-lock-concept-released-promise⑤\">released promise</a> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror②\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-prepend\" id=\"ref-for-list-prepend\">Prepend</a> <var>request</var> in <var>queue</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, run these steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>ifAvailable</var> is true and <var>request</var> is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#grantable\" id=\"ref-for-grantable\">grantable</a>,\n then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps⑤\">enqueue the following steps</a> on <var>callback</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object③\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop\">responsible event loop</a>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>r</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">invoking</a> <var>callback</var> with <code>null</code> as the only argument.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">Resolve</a> <var>promise</var> with <var>r</var> and abort these steps.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#queue-enqueue\" id=\"ref-for-queue-enqueue\">Enqueue</a> <var>request</var> in <var>queue</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#process-the-lock-request-queue\" id=\"ref-for-process-the-lock-request-queue\">Process the lock request queue</a> <var>queue</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>request</var>.</p>"
        }
      ]
    },
    {
      "name": "release the lock",
      "href": "https://w3c.github.io/web-locks/#release-the-lock",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"release-the-lock\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">release the lock</dfn> <var>lock</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: these steps are running on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue④\">lock task queue</a>.</p>"
        },
        {
          "html": "<p>Let <var>manager</var> be <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-manager\" id=\"ref-for-lock-concept-manager\">manager</a>.</p>"
        },
        {
          "html": "<p>Let <var>queueMap</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map③\">lock request queue map</a>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#resource-name\" id=\"ref-for-resource-name⑥\">resource name</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#get-the-lock-request-queue\" id=\"ref-for-get-the-lock-request-queue②\">getting the lock request queue</a> from <var>queueMap</var> for <var>name</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">Remove</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept①⑨\">lock</a> from the <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-held-lock-set\" id=\"ref-for-lock-manager-held-lock-set②\">held lock set</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#process-the-lock-request-queue\" id=\"ref-for-process-the-lock-request-queue①\">Process the lock request queue</a> <var>queue</var>.</p>"
        }
      ]
    },
    {
      "name": "abort the request",
      "href": "https://w3c.github.io/web-locks/#abort-the-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"abort-the-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">abort the request</dfn> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: these steps are running on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue⑤\">lock task queue</a>.</p>"
        },
        {
          "html": "<p>Let <var>manager</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-manager\" id=\"ref-for-lock-request-manager①\">manager</a>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-name\" id=\"ref-for-lock-request-name①\">name</a>.</p>"
        },
        {
          "html": "<p>Let <var>queueMap</var> be <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map④\">lock request queue map</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#get-the-lock-request-queue\" id=\"ref-for-get-the-lock-request-queue③\">getting the lock request queue</a> from <var>queueMap</var> for <var>name</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">Remove</a> <var>request</var> from <var>queue</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#process-the-lock-request-queue\" id=\"ref-for-process-the-lock-request-queue②\">Process the lock request queue</a> <var>queue</var>.</p>"
        }
      ]
    },
    {
      "name": "signal to abort the request",
      "href": "https://w3c.github.io/web-locks/#signal-to-abort-the-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"signal-to-abort-the-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">signal to abort the request</dfn> <var>request</var> with <var>signal</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps⑥\">Enqueue the steps</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#abort-the-request\" id=\"ref-for-abort-the-request①\">abort the request</a> <var>request</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue⑥\">lock task queue</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-promise\" id=\"ref-for-lock-request-promise\">promise</a> with <var>signal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
        }
      ]
    },
    {
      "name": "process the lock request queue",
      "href": "https://w3c.github.io/web-locks/#process-the-lock-request-queue",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-the-lock-request-queue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process the lock request queue</dfn> <var>queue</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: these steps are running on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue⑦\">lock task queue</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>request</var> of <var>queue</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var> is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#grantable\" id=\"ref-for-grantable①\">grantable</a>, then return.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">Remove</a> <var>request</var> from <var>queue</var>.</p>"
            },
            {
              "html": "<p>Let <var>agent</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-agent\" id=\"ref-for-lock-concept-agent①\">agent</a>.</p>"
            },
            {
              "html": "<p>Let <var>manager</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-manager\" id=\"ref-for-lock-request-manager②\">manager</a>.</p>"
            },
            {
              "html": "<p>Let <var>clientId</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-clientid\" id=\"ref-for-lock-request-clientid\">clientId</a>.</p>"
            },
            {
              "html": "<p>Let <var>name</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-name\" id=\"ref-for-lock-request-name②\">name</a>.</p>"
            },
            {
              "html": "<p>Let <var>mode</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-mode\" id=\"ref-for-lock-request-mode①\">mode</a>.</p>"
            },
            {
              "html": "<p>Let <var>callback</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-callback\" id=\"ref-for-lock-request-callback\">callback</a>.</p>"
            },
            {
              "html": "<p>Let <var>p</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-promise\" id=\"ref-for-lock-request-promise①\">promise</a>.</p>"
            },
            {
              "html": "<p>Let <var>signal</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-signal\" id=\"ref-for-lock-request-signal\">signal</a>.</p>"
            },
            {
              "html": "<p>Let <var>waiting</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a>.</p>"
            },
            {
              "html": "<p>Let <var>lock</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept\" id=\"ref-for-lock-concept②⓪\">lock</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-agent\" id=\"ref-for-lock-concept-agent②\">agent</a> <var>agent</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-clientid\" id=\"ref-for-lock-concept-clientid\">clientId</a> <var>clientId</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-manager\" id=\"ref-for-lock-concept-manager①\">manager</a> <var>manager</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-mode\" id=\"ref-for-lock-concept-mode②\">mode</a> <var>mode</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-name\" id=\"ref-for-lock-concept-name④\">name</a> <var>name</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-released-promise\" id=\"ref-for-lock-concept-released-promise⑥\">released promise</a> <var>p</var>, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-waiting-promise\" id=\"ref-for-lock-concept-waiting-promise⑤\">waiting promise</a> <var>waiting</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>lock</var> to <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-held-lock-set\" id=\"ref-for-lock-manager-held-lock-set③\">held lock set</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps⑦\">Enqueue the following steps</a> on <var>callback</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object④\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop①\">responsible event loop</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>signal</var> is present, then run these steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>signal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>, then run these steps:",
                      "rationale": "enqueue",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps⑧\">Enqueue the following step</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue⑧\">lock task queue</a>:",
                          "rationale": "release",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#release-the-lock\" id=\"ref-for-release-the-lock②\">Release the lock</a> <var>lock</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Return.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-remove\" id=\"ref-for-abortsignal-remove\">Remove</a> the algorithm <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#signal-to-abort-the-request\" id=\"ref-for-signal-to-abort-the-request①\">signal to abort the request</a> <var>request</var> from <var>signal</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>r</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function①\">invoking</a> <var>callback</var> with a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/web-locks/#lock\" id=\"ref-for-lock④\">Lock</a></code> object associated with <var>lock</var> as the only argument.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>waiting</var> with <var>r</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "snapshot the lock state",
      "href": "https://w3c.github.io/web-locks/#snapshot-the-lock-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"snapshot-the-lock-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">snapshot the lock state</dfn> for <var>manager</var> with <var>promise</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: these steps are running on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-task-queue\" id=\"ref-for-lock-task-queue⑨\">lock task queue</a>.</p>"
        },
        {
          "html": "<p>Let <var>pending</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>queue</var> of <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-lock-request-queue-map\" id=\"ref-for-lock-manager-lock-request-queue-map⑤\">lock request queue map</a>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">values</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>request</var> of <var>queue</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> «[ \"name\" → <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-name\" id=\"ref-for-lock-request-name③\">name</a>, \"mode\" → <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-mode\" id=\"ref-for-lock-request-mode②\">mode</a>, \"clientId\" → <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-request-clientid\" id=\"ref-for-lock-request-clientid①\">clientId</a> ]» to <var>pending</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>held</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>lock</var> of <var>manager</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-manager-held-lock-set\" id=\"ref-for-lock-manager-held-lock-set④\">held lock set</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> «[ \"name\" → <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-name\" id=\"ref-for-lock-concept-name⑤\">name</a>, \"mode\" → <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-mode\" id=\"ref-for-lock-concept-mode③\">mode</a>, \"clientId\" → <var>lock</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/web-locks/#lock-concept-clientid\" id=\"ref-for-lock-concept-clientid①\">clientId</a> ]» to <var>held</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">Resolve</a> <var>promise</var> with «[ \"held\" → <var>held</var>, \"pending\" → <var>pending</var> ]».</p>"
        }
      ]
    }
  ]
}