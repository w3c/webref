{
  "spec": {
    "title": "CSS Ruby Annotation Layout Module Level 1",
    "url": "https://drafts.csswg.org/css-ruby-1/"
  },
  "algorithms": [
    {
      "html": "The CSS model does not require that the document language\n\tinclude elements that correspond to each of these components.\n\tMissing parts of the structure are implied through the anonymous box generation rules <a href=\"https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes\">similar to those used to normalize tables</a>. <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-ruby-1/#biblio-css2\" title=\"Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification\">[CSS2]</a>",
      "rationale": "generate",
      "steps": [
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-inlinize\"></a><strong><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#inlinify\" id=\"ref-for-inlinify\">Inlinify</a> block-level boxes:</strong> Any in-flow boxes directly contained by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①②\">ruby container</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box①\">ruby base container</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box①\">ruby annotation container</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box⑤\">ruby base box</a>,\n\t\t\tor <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box⑤\">ruby annotation box</a> are “<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#inlinify\" id=\"ref-for-inlinify①\">inlinified</a>” per <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-ruby-1/#biblio-css-display-3\" title=\"CSS Display Module Level 3\">[CSS-DISPLAY-3]</a>),\n\t\t\tand their <a class=\"property css\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-display-4/#propdef-display\" id=\"ref-for-propdef-display⑨\">display</a> value computed accordingly,\n\t\t\tso that they contain only inline-level content.\n\t\t\tFor example,\n\t\t\tthe <span class=\"property\" id=\"ref-for-propdef-display①⓪\">display</span> property of an in-flow element with <span class=\"css\" id=\"ref-for-propdef-display①①\">display: block</span> parented by an element with <span class=\"css\" id=\"ref-for-propdef-display①②\">display: ruby-text</span> computes to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-display-4/#valdef-display-inline-block\" id=\"ref-for-valdef-display-inline-block\">inline-block</a>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-anon-ruby\"></a><strong>Generate anonymous ruby containers:</strong> Any <a href=\"https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes\">consecutive</a> sequence of\n\t\t\timproperly-contained <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box②\">ruby base containers</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box②\">ruby annotation containers</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box⑥\">ruby bases</a>,\n\t\t\tand/or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box⑥\">ruby annotations</a> (and any intervening <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-text-4/#white-space\" id=\"ref-for-white-space\">white space</a>)\n\t\t\tis wrapped in an anonymous <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①③\">ruby container</a>.\n\t\t\tFor the purpose of this step: \n     <ul>\n      <li>an improperly-contained <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box⑦\">ruby base</a> is one not parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box③\">ruby base container</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①④\">ruby container</a> \n      </li><li>an improperly-contained <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box⑦\">ruby annotation</a> is one not parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box③\">ruby annotation container</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①⑤\">ruby container</a> \n      </li><li> an improperly-contained <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box④\">ruby base container</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box④\">ruby annotation container</a> is one not parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①⑥\">ruby container</a> \n     </li></ul>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-bare-inlines\"></a><strong>Wrap misparented inline-level content:</strong> Any consecutive sequence of text and inline-level boxes\n\t\t\tdirectly parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①⑦\">ruby container</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box⑤\">ruby base container</a> is wrapped in an anonymous <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box⑧\">ruby base</a>.\n\t\t\tSimilarly, any consecutive sequence of text and inline-level boxes\n\t\t\tdirectly parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box⑤\">ruby annotation container</a> is wrapped in an anonymous <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box⑧\">ruby annotation</a>.\n\t\t\t(For this purpose, misparented <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#internal-table-element\" id=\"ref-for-internal-table-element①\">internal table elements</a> are treated as <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#inline-level\" id=\"ref-for-inline-level①\">inline-level content</a> since, being parented by ruby boxes,\n\t\t\tthey will be ultimately wrapped by an <span id=\"ref-for-inline-level②\">inline-level</span> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-tables-3/#table-wrapper-box\" id=\"ref-for-table-wrapper-box\">table wrapper box</a>.) \n     <p>However, if an anonymous box so constructed contains only <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-text-4/#white-space\" id=\"ref-for-white-space①\">white space</a>,\n\t\t\tit is considered <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"intra-ruby-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">intra-ruby white space</dfn> and is either discarded\n\t\t\tor preserved\n\t\t\tas described below.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-trim-space\"></a><strong>Trim leading/trailing white space:</strong> Any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#intra-ruby-white-space\" id=\"ref-for-intra-ruby-white-space\">intra-ruby white space</a> that is not the sole <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#in-flow\" id=\"ref-for-in-flow\">in-flow</a> child of its parent\n\t\t\tand is the first or last <span id=\"ref-for-in-flow①\">in-flow</span> child of\n\t\t\ta <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-container\" id=\"ref-for-ruby-container①⑧\">ruby container</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box⑥\">ruby annotation container</a>, or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box⑥\">ruby base container</a> is removed, as if it had <a class=\"css\" data-link-type=\"propdesc\" href=\"https://drafts.csswg.org/css-display-4/#propdef-display\" id=\"ref-for-propdef-display①③\">display: none</a>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-discard-space\"></a><strong>Remove inter-level white space:</strong> Any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#intra-ruby-white-space\" id=\"ref-for-intra-ruby-white-space①\">intra-ruby white space</a> whose immediately adjacent <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#in-flow\" id=\"ref-for-in-flow②\">in-flow</a> siblings match one of the patterns below\n\t\t\tis <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"inter-level-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">inter-level white space</dfn> and is removed, as if it had <a class=\"css\" data-link-type=\"propdesc\" href=\"https://drafts.csswg.org/css-display-4/#propdef-display\" id=\"ref-for-propdef-display①④\">display: none</a>. \n     <div class=\"overlarge\"><table class=\"data\">\n      <thead>\n       <tr>\n        <th>Previous box \n        </th><th>Next box \n      </th></tr></thead><tbody>\n       <tr>\n        <td>any \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box⑦\">ruby annotation container</a> \n       </td></tr><tr>\n        <td>not <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box⑨\">ruby annotation</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①⓪\">ruby annotation</a> \n     </td></tr></tbody></table></div>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-interpret-space\"></a><strong>Interpret intra-level white space:</strong> Any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#intra-ruby-white-space\" id=\"ref-for-intra-ruby-white-space②\">intra-ruby white space</a> box\n\t\t\twhose immediately adjacent <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#in-flow\" id=\"ref-for-in-flow③\">in-flow</a> siblings match one of the patterns below\n\t\t\tis assigned the box type and subtype defined in the table below: \n     <div class=\"overlarge\"><table class=\"data\">\n      <colgroup span=\"2\">\n      </colgroup><colgroup span=\"2\">\n      </colgroup><thead>\n       <tr>\n        <th>Previous box \n        </th><th>Next box \n        </th><th>Box type \n        </th><th>Subtype \n      </th></tr></thead><tbody>\n       <tr>\n        <td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box⑨\">ruby base</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①⓪\">ruby base</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①①\">ruby base</a> \n        </td><td><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"inter-base-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">inter-base white space</dfn> \n       </td></tr><tr>\n        <td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①①\">ruby annotation</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①②\">ruby annotation</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①③\">ruby annotation</a> \n        </td><td><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"inter-annotation-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">inter-annotation white space</dfn> \n       </td></tr><tr>\n        <td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①④\">ruby annotation</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box⑧\">ruby annotation container</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①②\">ruby base</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box⑦\">ruby base container</a> \n        </td><td rowspan=\"3\"><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①③\">ruby base</a> \n        </td><td rowspan=\"3\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"inter-segment-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">inter-segment white space</dfn> \n       </td></tr><tr>\n        <td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①④\">ruby base</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box⑧\">ruby base container</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box⑨\">ruby base container</a> \n       </td></tr><tr>\n        <td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box①⓪\">ruby base container</a> \n        </td><td><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①⑤\">ruby base</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box①①\">ruby base container</a> \n     </td></tr></tbody></table></div>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"intra-level-white-space\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">intra-level white space</dfn> boxes defined above\n\t\t\tare treated specially for <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#pairing\" id=\"ref-for-pairing①\">pairing</a> and layout.\n\t\t\tSee below."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-unbreak\"></a><strong>Suppress line breaks:</strong> Convert all forced line breaks inside <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①⑤\">ruby annotations</a> (regardless of <a class=\"property css\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-text-4/#propdef-white-space\" id=\"ref-for-propdef-white-space\">white-space</a> value)\n\t\t\tas defined for collapsible segment breaks in <a href=\"https://www.w3.org/TR/css-text-3/#line-break-transform\">CSS Text Level 3 § 4.1.2</a>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-ruby-1/#anon-gen-anon-containers\"></a><strong>Generate anonymous level containers:</strong> Any consecutive sequence of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-box\" id=\"ref-for-ruby-base-box①⑥\">ruby bases</a> and <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#inter-base-white-space\" id=\"ref-for-inter-base-white-space\">inter-base white space</a> (and not <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#inter-segment-white-space\" id=\"ref-for-inter-segment-white-space\">inter-segment white space</a>)\n\t\t\tnot parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-base-container-box\" id=\"ref-for-ruby-base-container-box①②\">ruby base container</a> is wrapped in an anonymous <span id=\"ref-for-ruby-base-container-box①③\">ruby base container</span>.\n\t\t\tSimilarly, any consecutive sequence of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-box\" id=\"ref-for-ruby-annotation-box①⑥\">ruby annotations</a> and <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#inter-annotation-white-space\" id=\"ref-for-inter-annotation-white-space\">inter-annotation white space</a> not parented by a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-ruby-1/#ruby-annotation-container-box\" id=\"ref-for-ruby-annotation-container-box⑨\">ruby annotation container</a> is wrapped in an anonymous <span id=\"ref-for-ruby-annotation-container-box①⓪\">ruby annotation container</span>."
        }
      ]
    }
  ]
}