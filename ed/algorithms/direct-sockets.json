{
  "spec": {
    "title": "Direct Sockets API",
    "url": "https://wicg.github.io/direct-sockets/"
  },
  "algorithms": [
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n          not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-1\"><code>direct-sockets</code></a>\", throw a\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-keepalivedelay\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-keepalivedelay-1\"><code>keepAliveDelay</code></a>\"] is less than 1,000, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-sendbuffersize\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-sendbuffersize-1\"><code>sendBufferSize</code></a>\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-receivebuffersize\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-receivebuffersize-1\"><code>receiveBufferSize</code></a>\"] is equal to 0, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>remoteAddress</var> resolves to an IP address belonging to the\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"IP address space\" data-xref-for=\"IP address space\" class=\"respec-offending-element\" title=\"No matching definition found.\" id=\"respec-offender-no-matching-definition-found\">private</a> network address space and <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n              not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets-private\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-private-1\"><code>direct-sockets-private</code></a>\", <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-1\">TCPSocket task source</a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "Invoke the operating system to open a TCP socket using the given <var>remoteAddress</var> and\n              <var>remotePort</var> and the connection parameters (or their defaults) specified in <var>options</var>."
            },
            {
              "html": "If this fails for any other reason, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-2\">TCPSocket task source</a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-2\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-2\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-3\">TCPSocket task source</a> to run the\n              following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpsocket-readable-stream-1\">Initialize</a> <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPSocket writable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpsocket-writable-stream-1\">Initialize</a> <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-1\"><code>[[writable]]</code></a>."
                },
                {
                  "html": "Let <var data-type=\"TCPSocketOpenInfo\">openInfo</var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-2\"><code>TCPSocketOpenInfo</code></a>."
                },
                {
                  "html": "Set <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-readable-3\"><code>readable</code></a>\"] to\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-2\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "Set <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-writable\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-writable-3\"><code>writable</code></a>\"] to\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-2\"><code>[[writable]]</code></a>."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"TCPSocketOpenInfo\">openInfo</var> using the information provided by the\n                  operating system:\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-remoteaddress-1\"><code>remoteAddress</code></a>\"],\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-remoteport-1\"><code>remotePort</code></a>\"],\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-localaddress-1\"><code>localAddress</code></a>\"] and\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-localport-1\"><code>localPort</code></a>\"]."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-3\"><code>[[openedPromise]]</code></a> with <var data-type=\"TCPSocketOpenInfo\">openInfo</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream</code></a>."
        },
        {
          "html": "Let <var>pullAlgorithm</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize</var> be the\n              <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-desired-size-to-fill-up-to-the-high-water-mark\" href=\"https://streams.spec.whatwg.org/#readablestream-desired-size-to-fill-up-to-the-high-water-mark\">desired size to fill up to the high water mark</a> for\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-4\"><code>[[readable]]</code></a>."
            },
            {
              "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-5\"><code>[[readable]]</code></a>'s <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-current-byob-request-view\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view</a>\n              is non-null, then set <var>desiredSize</var> to <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-6\"><code>[[readable]]</code></a>'s\n              <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-current-byob-request-view\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view</a>'s <a data-link-type=\"dfn\" data-link-for=\"BufferSource\" data-xref-for=\"BufferSource\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"buffersource-byte-length\" href=\"https://webidl.spec.whatwg.org/#buffersource-byte-length\">byte length</a>."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to read up to <var>desiredSize</var> bytes from the socket,\n                  placing the result in the <a data-link-type=\"dfn\" data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"byte-sequence\" href=\"https://infra.spec.whatwg.org/#byte-sequence\">byte sequence</a> <var>bytes</var>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-4\">TCPSocket task source</a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the connection was closed gracefully, run the following steps:",
                      "rationale": "invoke",
                      "steps": [
                        {
                          "html": "Invoke <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-close\" href=\"https://streams.spec.whatwg.org/#readablestream-close\">close</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-7\"><code>[[readable]]</code></a>."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-1\">handle closing the TCPSocket readable stream</a>."
                        }
                      ]
                    },
                    {
                      "html": "If no errors were encountered, then:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-8\"><code>[[readable]]</code></a>'s\n                          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-current-byob-request-view\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view</a> is non-null,\n                          then <a data-link-type=\"dfn\" data-link-for=\"ArrayBufferView\" data-xref-for=\"ArrayBufferView\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"arraybufferview-write\" href=\"https://webidl.spec.whatwg.org/#arraybufferview-write\">write</a> <var>bytes</var> into\n                          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-9\"><code>[[readable]]</code></a>'s\n                          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-current-byob-request-view\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view</a>, and set\n                          <var>view</var> to <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-10\"><code>[[readable]]</code></a>'s\n                          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-current-byob-request-view\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view</a>."
                        },
                        {
                          "html": "Otherwise, set <var>view</var> to the result of\n                          <a data-link-type=\"dfn\" data-link-for=\"ArrayBufferView\" data-xref-for=\"ArrayBufferView\" data-lt=\"create\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"arraybufferview-create\" href=\"https://webidl.spec.whatwg.org/#arraybufferview-create\">creating</a> a <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"Uint8Array\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-Uint8Array\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\"><code>Uint8Array</code></a> from\n                          <var>bytes</var> in <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-realm\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\">relevant Realm</a>."
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-enqueue\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">Enqueue</a> <var>view</var> into\n                          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-11\"><code>[[readable]]</code></a>."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-error\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-12\"><code>[[readable]]</code></a> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> and invoke the steps\n                      to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-2\">handle closing the TCPSocket readable stream</a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm</var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-3\">handle closing the TCPSocket readable stream</a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support\">Set up with byte reading support</a> <var data-type=\"ReadableStream\">stream</var> with\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-pullalgorithm\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-pullalgorithm\">pullAlgorithm</a></i>\n          set to <var>pullAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-cancelalgorithm\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-cancelalgorithm\">cancelAlgorithm</a></i>\n          set to <var>cancelAlgorithm</var>, and\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-highwatermark\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-highwatermark\">highWaterMark</a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-13\"><code>[[readable]]</code></a> to <var data-type=\"ReadableStream\">stream</var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-3\"><code>[[writable]]</code></a> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-5\">TCPSocket task source</a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-4\"><code>[[writable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-3\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-5\"><code>[[writable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-14\"><code>[[readable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-4\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-15\"><code>[[readable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-5\"><code>[[closedPromise]]</code></a> with <code>undefined</code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"WritableStream\">stream</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream\" href=\"https://streams.spec.whatwg.org/#writablestream\"><code>WritableStream</code></a>."
        },
        {
          "html": "Let <var data-type=\"AbortSignal\">signal</var> be <var data-type=\"WritableStream\">stream</var>'s <a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-signal\" href=\"https://streams.spec.whatwg.org/#writablestream-signal\">signal</a>."
        },
        {
          "html": "Let <var>writeAlgorithm</var> be the following steps, given <var>chunk</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise</var> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
            },
            {
              "html": "Assert: <var data-type=\"AbortSignal\">signal</var> is not <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-aborted\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted</a>."
            },
            {
              "html": "If <var>chunk</var> cannot be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value</a> of type\n              <a data-xref-type=\"_IDL_\" data-link-type=\"typedef\" data-lt=\"BufferSource\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"BufferSource\" href=\"https://webidl.spec.whatwg.org/#BufferSource\"><code>BufferSource</code></a>, reject <var data-type=\"Promise\">promise</var> with a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> and return\n              <var data-type=\"Promise\">promise</var>. Otherwise, save the result of the conversion in\n              <var data-type=\"BufferSource\">source</var>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"dfn-get-buffer-source-copy\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\">Get a copy of the buffer source</a> <var data-type=\"BufferSource\">source</var> and save the result in\n              <var>bytes</var>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">In parallel</a>, run the following steps:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to write <var>bytes</var> to the socket."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-6\">TCPSocket task source</a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the chunk was successfully written, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var data-type=\"Promise\">promise</var> with <code>undefined</code>."
                    },
                    {
                      "html": "If a network or operating system error was encountered:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> <var data-type=\"Promise\">promise</var> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                          <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-1\">handle closing the TCPSocket writable stream</a>."
                        }
                      ]
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal</var> is <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-aborted\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted</a>, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var data-type=\"Promise\">promise</var>\n                      with <var data-type=\"AbortSignal\">signal</var>'s <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-abort-reason\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason</a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise</var>."
            }
          ]
        },
        {
          "html": "Let <var>abortAlgorithm</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise</var> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
            },
            {
              "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to shutdown the socket for writing."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-7\">TCPSocket task source</a> to run the\n                  following steps:",
                  "rationale": "invoke",
                  "steps": [
                    {
                      "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-2\">handle closing the TCPSocket writable stream</a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <var data-type=\"Promise\">promise</var> with <code>undefined</code>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise</var>."
            }
          ]
        },
        {
          "html": "Let <var>closeAlgorithm</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise</var> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
            },
            {
              "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to shutdown the socket for writing."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-8\">TCPSocket task source</a> to run the\n                  following steps:",
                  "rationale": "invoke",
                  "steps": [
                    {
                      "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-3\">handle closing the TCPSocket writable stream</a>."
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal</var> is <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-aborted\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted</a>, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var data-type=\"Promise\">promise</var>\n                      with <var data-type=\"AbortSignal\">signal</var>'s <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-abort-reason\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason</a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <var data-type=\"Promise\">promise</var> with <code>undefined</code>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise</var>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up\">Set up</a> <var data-type=\"WritableStream\">stream</var> with\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-writealgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm\">writeAlgorithm</a></i>\n          set to <var>writeAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-abortalgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm\">abortAlgorithm</a></i>\n          set to <var>abortAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-closealgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm\">closeAlgorithm</a></i>\n          set to <var>closeAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-highwatermark\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-highwatermark\">highWaterMark</a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-add\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\">Add</a> the following abort steps to <var data-type=\"AbortSignal\">signal</var>:",
          "rationale": "cause",
          "steps": [
            {
              "html": "Cause any invocation of the operating system to write to the\n              socket to return as soon as possible no matter how much data has\n              been written."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-7\"><code>[[writable]]</code></a> to <var data-type=\"WritableStream\">stream</var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-16\"><code>[[readable]]</code></a> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-9\">TCPSocket task source</a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-17\"><code>[[readable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-6\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-18\"><code>[[readable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-8\"><code>[[writable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-7\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-9\"><code>[[writable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-8\"><code>[[closedPromise]]</code></a> with <code>undefined</code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-5\"><code>[[openedPromise]]</code></a> is rejected or not yet resolved, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a>\n          with\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-10\"><code>[[closedPromise]]</code></a> is settled, return\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-11\"><code>[[closedPromise]]</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-21\"><code>[[readable]]</code></a> or <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-12\"><code>[[writable]]</code></a> are <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise</var> be the result of invoking\n          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-cancel\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-22\"><code>[[readable]]</code></a>."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise</var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Let <var data-type=\"Promise\">abortPromise</var> be the result of invoking\n          <a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-abort\" href=\"https://streams.spec.whatwg.org/#writablestream-abort\">abort</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-13\"><code>[[writable]]</code></a>."
        },
        {
          "html": "Set <var data-type=\"Promise\">abortPromise</var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-12\"><code>[[closedPromise]]</code></a>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n          not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-2\"><code>direct-sockets</code></a>\", throw a\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If any of <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-multicasttimetolive\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-multicasttimetolive-1\"><code>multicastTimeToLive</code></a>\"],\n          <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-multicastloopback\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-multicastloopback-1\"><code>multicastLoopback</code></a>\"],\n          or <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-multicastallowaddresssharing\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-multicastallowaddresssharing-1\"><code>multicastAllowAddressSharing</code></a>\"] is specified, and <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the \n          <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets-multicast\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-multicast-1\"><code>direct-sockets-multicast</code></a>\",\n           throw a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If only one of <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteaddress-2\"><code>remoteAddress</code></a>\"] and\n          <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteport-2\"><code>remotePort</code></a>\"] is specified, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "Alternatively, if both <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteaddress-3\"><code>remoteAddress</code></a>\"] and\n          <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteport-3\"><code>remotePort</code></a>\"] are specified, assume <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-2\"><code>connected</code></a>\n          <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-7\"><code>mode</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localport-1\"><code>localPort</code></a>\"] is equal to 0 or specified without\n          <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-2\"><code>localAddress</code></a>\"], throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-3\"><code>localAddress</code></a>\"] is specified:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-3\"><code>connected</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-8\"><code>mode</code></a> was previously inferred, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
            },
            {
              "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-4\"><code>localAddress</code></a>\"] is not a valid IP address,\n              throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
            },
            {
              "html": "Assume <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-2\"><code>bound</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-9\"><code>mode</code></a>."
            }
          ]
        },
        {
          "html": "If no <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-10\"><code>mode</code></a> has been inferred at this point, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-dnsquerytype-1\"><code>dnsQueryType</code></a>\"] is specified in <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-3\"><code>bound</code></a>\n          <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-11\"><code>mode</code></a>, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-ipv6only\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-ipv6only-1\"><code>ipv6Only</code></a>\"] is specified:",
          "rationale": "if",
          "steps": [
            {
              "html": "If inferred <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-12\"><code>mode</code></a> is <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-4\"><code>connected</code></a>, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
            },
            {
              "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-5\"><code>localAddress</code></a>\"] is not equal to the IPv6\n              unspecified address (<code>::</code>), throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
            }
          ]
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-sendbuffersize\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-sendbuffersize-1\"><code>sendBufferSize</code></a>\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-receivebuffersize\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-receivebuffersize-1\"><code>receiveBufferSize</code></a>\"] is equal to 0, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If the inferred <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-13\"><code>mode</code></a> is <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-5\"><code>connected</code></a> and <var>remoteAddress</var> resolves to an IP address belonging to the\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"IP address space\" data-xref-for=\"IP address space\" class=\"respec-offending-element\" title=\"No matching definition found.\" id=\"respec-offender-no-matching-definition-found-0\">private</a> network address space and <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n              not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets-private\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-private-2\"><code>direct-sockets-private</code></a>\", <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-1\">UDPSocket task source</a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-1\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-1\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "If the inferred <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-14\"><code>mode</code></a> is <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-4\"><code>bound</code></a> and either <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n              not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets-private\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-private-3\"><code>direct-sockets-private</code></a>\"\n              or the requested <var>localPort</var> is less than 1024, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-2\">UDPSocket task source</a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-2\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-2\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "Invoke the operating system to open a UDP socket using the inferred\n              <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-16\"><code>mode</code></a> and the parameters (or their defaults) specified in <var>options</var>."
            },
            {
              "html": "If this fails for any reason, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-3\">UDPSocket task source</a> to run the following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-3\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-3\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-4\">UDPSocket task source</a> to run the following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize UDPSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-udpsocket-readable-stream-1\">Initialize</a> <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-1\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize UDPSocket writable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-udpsocket-writable-stream-1\">Initialize</a> <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-1\"><code>[[writable]]</code></a>."
                },
                {
                  "html": "Let <var data-type=\"UDPSocketOpenInfo\">openInfo</var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-2\"><code>UDPSocketOpenInfo</code></a>."
                },
                {
                  "html": "Set <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-readable-3\"><code>readable</code></a>\"] to\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-2\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "Set <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-writable\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-writable-3\"><code>writable</code></a>\"] to\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-2\"><code>[[writable]]</code></a>."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"UDPSocketOpenInfo\">openInfo</var> using the information provided by the\n                  operating system:\n                  <ul>\n                    <li>\n                      For <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-5\"><code>bound</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-17\"><code>mode</code></a>, populate only\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localaddress-1\"><code>localAddress</code></a>\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localport-1\"><code>localPort</code></a>\"].\n                    </li><li>\n                      For <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-7\"><code>connected</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-18\"><code>mode</code></a>, populate\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localaddress-2\"><code>localAddress</code></a>\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localport-2\"><code>localPort</code></a>\"] as well as\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-remoteaddress-1\"><code>remoteAddress</code></a>\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-remoteport-1\"><code>remotePort</code></a>\"].\n                  </li></ul>"
                },
                {
                  "html": "Resolve <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-4\"><code>[[openedPromise]]</code></a> with <var data-type=\"UDPSocketOpenInfo\">openInfo</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream</code></a>."
        },
        {
          "html": "Let <var>pullAlgorithm</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize</var> be the\n              <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-desired-size-to-fill-up-to-the-high-water-mark\" href=\"https://streams.spec.whatwg.org/#readablestream-desired-size-to-fill-up-to-the-high-water-mark\">desired size to fill up to the high water mark</a> for\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-9\"><code>[[readable]]</code></a>."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to provide up to <var>desiredSize</var> UDP packets from the\n                  socket."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-5\">UDPSocket task source</a> to run the\n                  following steps for each received packet:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If no errors were encountered, for each packet received run the following\n                      steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var>bytes</var> be a <a data-link-type=\"dfn\" data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"byte-sequence\" href=\"https://infra.spec.whatwg.org/#byte-sequence\">byte sequence</a> containing the packet payload."
                        },
                        {
                          "html": "Let <var>buffer</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"ArrayBuffer\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-ArrayBuffer\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\"><code>ArrayBuffer</code></a> created from <var>bytes</var>."
                        },
                        {
                          "html": "Let <var>chunk</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"Uint8Array\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-Uint8Array\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\"><code>Uint8Array</code></a> view over <var>buffer</var>,\n                          who's length is the length of <var>bytes</var>."
                        },
                        {
                          "html": "Let <var data-type=\"UDPMessage\">message</var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-4\"><code>UDPMessage</code></a>."
                        },
                        {
                          "html": "Set <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-data\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-data-2\"><code>data</code></a>\"] to <var>chunk</var>."
                        },
                        {
                          "html": "If the socket is operating in <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-10\"><code>bound</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-28\"><code>mode</code></a>:",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "Set <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-2\"><code>remoteAddress</code></a>\"] to the source address\n                              of the packet."
                            },
                            {
                              "html": "Set <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-2\"><code>remotePort</code></a>\"] to the source port of the\n                              packet."
                            }
                          ]
                        },
                        {
                          "html": "Invoke <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-enqueue\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">enqueue</a> on\n                          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-10\"><code>[[readable]]</code></a> with <var data-type=\"UDPMessage\">message</var>."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-error\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-11\"><code>[[readable]]</code></a> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>, discard other packets and invoke the\n                      steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-readable-stream-1\">handle closing the UDPSocket readable stream</a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm</var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-readable-stream-2\">handle closing the UDPSocket readable stream</a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up</a> <var data-type=\"ReadableStream\">stream</var> with\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-pullalgorithm\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm\">pullAlgorithm</a></i>\n          set to <var>pullAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-cancelalgorithm\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a></i>\n          set to <var>cancelAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up-highwatermark\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark\">highWaterMark</a></i>\n          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up</a> <var data-type=\"ReadableStream\">stream</var> with\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-12\"><code>[[readable]]</code></a> to <var data-type=\"ReadableStream\">stream</var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-9\"><code>[[writable]]</code></a> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-6\">UDPSocket task source</a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-10\"><code>[[writable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-4\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-11\"><code>[[writable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-13\"><code>[[readable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-5\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-14\"><code>[[readable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-6\"><code>[[closedPromise]]</code></a> with <code>undefined</code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"WritableStream\">stream</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream\" href=\"https://streams.spec.whatwg.org/#writablestream\"><code>WritableStream</code></a>."
        },
        {
          "html": "Let <var data-type=\"AbortSignal\">signal</var> be <var data-type=\"WritableStream\">stream</var>'s <a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-signal\" href=\"https://streams.spec.whatwg.org/#writablestream-signal\">signal</a>."
        },
        {
          "html": "Let <var>writeAlgorithm</var> be the following steps, given <var>chunk</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise</var> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
            },
            {
              "html": "Assert: <var data-type=\"AbortSignal\">signal</var> is not <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-aborted\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted</a>."
            },
            {
              "html": "Let <var data-type=\"UDPMessage\">message</var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-5\"><code>UDPMessage</code></a>."
            },
            {
              "html": "If <var>chunk</var> cannot be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value</a> of type\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-6\"><code>UDPMessage</code></a>, reject <var data-type=\"Promise\">promise</var> with a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> and return\n              <var data-type=\"Promise\">promise</var>. Otherwise, save the result of the conversion in\n              <var data-type=\"UDPMessage\">message</var>."
            },
            {
              "html": "If either <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-3\"><code>remoteAddress</code></a>\"],\n              <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-3\"><code>remotePort</code></a>\"] or\n              <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-dnsquerytype-2\"><code>dnsQueryType</code></a>\"] <b>is specified</b> in\n              <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-12\"><code>connected</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-29\"><code>mode</code></a>, reject <var data-type=\"Promise\">promise</var> with a\n              <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> and return <var data-type=\"Promise\">promise</var>."
            },
            {
              "html": "If either <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-4\"><code>remoteAddress</code></a>\"]\n              or <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-4\"><code>remotePort</code></a>\"] <b>is not specified</b> in\n              <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-11\"><code>bound</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-30\"><code>mode</code></a>, reject <var data-type=\"Promise\">promise</var> with a\n              <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> and return <var data-type=\"Promise\">promise</var>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"dfn-get-buffer-source-copy\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\">Get a copy of the buffer source</a> <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-data\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-data-3\"><code>data</code></a>\"] and save the\n              result in <var>bytes</var>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">In parallel</a>, run the following steps:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to send <var>bytes</var> to the socket.\n                  <ul>\n                    <li>\n                      In <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-13\"><code>connected</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-31\"><code>mode</code></a> the data is routed to the\n                      address/port specified upon construction.\n                    </li><li>\n                      In <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-12\"><code>bound</code></a> <a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-32\"><code>mode</code></a> the data is routed to\n                      <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-5\"><code>remoteAddress</code></a>\"] and\n                      <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-5\"><code>remotePort</code></a>\"].\n                      <var data-type=\"UDPMessage\">message</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-dnsquerytype-3\"><code>dnsQueryType</code></a>\"] can be optionally supplied to\n                      control whether DNS resolution routine returns an IPv4 or an IPv6 record.\n                  </li></ul>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-7\">UDPSocket task source</a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the data was successfully written, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <var data-type=\"Promise\">promise</var> with <code>undefined</code>."
                    },
                    {
                      "html": "If a network or operating system error was encountered:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> <var data-type=\"Promise\">promise</var> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                          <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-1\">handle closing the UDPSocket writable stream</a>."
                        }
                      ]
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal</var> is <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-aborted\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted</a>, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <var data-type=\"Promise\">promise</var>\n                      with <var data-type=\"AbortSignal\">signal</var>'s <a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-abort-reason\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason</a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise</var>."
            }
          ]
        },
        {
          "html": "Let <var>abortAlgorithm</var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-2\">handle closing the UDPSocket writable stream</a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "Let <var>closeAlgorithm</var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-3\">handle closing the UDPSocket writable stream</a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up\">Set up</a> <var data-type=\"WritableStream\">stream</var> with\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-writealgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm\">writeAlgorithm</a></i>\n          set to <var>writeAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-abortalgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm\">abortAlgorithm</a></i>\n          set to <var>abortAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-closealgorithm\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm\">closeAlgorithm</a></i>\n          set to <var>closeAlgorithm</var>,\n          <i><a data-link-type=\"dfn\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-set-up-highwatermark\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-highwatermark\">highWaterMark</a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"\" data-cite-frag=\"abortsignal-add\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\">Add</a> the following abort steps to <var data-type=\"AbortSignal\">signal</var>:",
          "rationale": "cause",
          "steps": [
            {
              "html": "Cause any invocation of the operating system to write to the\n              socket to return as soon as possible no matter how much data has\n              been written."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-13\"><code>[[writable]]</code></a> to <var data-type=\"WritableStream\">stream</var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-15\"><code>[[readable]]</code></a> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-8\">UDPSocket task source</a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-16\"><code>[[readable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-7\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-17\"><code>[[readable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-14\"><code>[[writable]]</code></a> is errored,\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-8\"><code>[[closedPromise]]</code></a>\n                  with <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-15\"><code>[[writable]]</code></a>.<code>[[storedPromise]]</code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-9\"><code>[[closedPromise]]</code></a> with <code>undefined</code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-6\"><code>[[openedPromise]]</code></a> is rejected or not yet resolved, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a>\n          with\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-11\"><code>[[closedPromise]]</code></a> is settled, return\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-12\"><code>[[closedPromise]]</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-20\"><code>[[readable]]</code></a> or <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-18\"><code>[[writable]]</code></a> are <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise</var> be the result of invoking\n          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-cancel\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-21\"><code>[[readable]]</code></a>."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise</var>.[[PromiseIsHandled]] as handled."
        },
        {
          "html": "Let <var data-type=\"Promise\">abortPromise</var> be the result of invoking\n          <a data-link-type=\"dfn\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"writablestream-abort\" href=\"https://streams.spec.whatwg.org/#writablestream-abort\">abort</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-19\"><code>[[writable]]</code></a>."
        },
        {
          "html": "Set <var data-type=\"Promise\">abortPromise</var>.[[PromiseIsHandled]] as handled."
        },
        {
          "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-13\"><code>[[closedPromise]]</code></a>."
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"joinGroup(ipAddress)\" href=\"https://wicg.github.io/direct-sockets/#dom-multicastcontroller-joingroup\" class=\"internalDFN\" id=\"ref-for-dom-multicastcontroller-joingroup-2\"><code>joinGroup</code></a><code>(<var>ipAddress</var>)</code> method joins the multicast group at the given <code>ipAddress</code> and\n        the <code>localPort</code> it was bound to.",
      "rationale": "if",
      "steps": [
        {
          "html": "If <code>ipAddress</code> is not a valid IP address, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If the socket has already joined or in the process of joining a multicast group with\n          specified <code>ipAddress</code> throw an \"<code>InvalidStateError</code>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If the associated <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"[[socket]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-socket\" class=\"internalDFN\" id=\"ref-for-dfn-socket-1\"><code>[[socket]]</code></a> was closed or aborted, throw an \"<code>InvalidStateError</code>\"\n          <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "Let <code>promise</code> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to join the multicast group specified by <code>ipAddress</code>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the\n               <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-10\">UDPSocket task source</a> to run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the operating system returned a failure, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <code>promise</code> with\n                   a \"<code>NetworkError</code>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> and abort these steps."
                },
                {
                  "html": "Add <code>ipAddress</code> to <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"[[joinedGroups]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-joinedgroups\" class=\"internalDFN\" id=\"ref-for-dfn-joinedgroups-1\"><code>[[joinedGroups]]</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <code>promise</code> with <code>undefined</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Return <code>promise</code>."
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"leaveGroup(ipAddress)\" href=\"https://wicg.github.io/direct-sockets/#dom-multicastcontroller-leavegroup\" class=\"internalDFN\" id=\"ref-for-dom-multicastcontroller-leavegroup-2\"><code>leaveGroup</code></a><code>(<var>ipAddress</var>)</code> method leaves a multicast group previously joined via\n        <a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"joinGroup(ipAddress)\" href=\"https://wicg.github.io/direct-sockets/#dom-multicastcontroller-joingroup\" class=\"internalDFN\" id=\"ref-for-dom-multicastcontroller-joingroup-4\"><code>joinGroup</code></a><code>(<var>ipAddress</var>)</code>.",
      "rationale": "if",
      "steps": [
        {
          "html": "If <code>ipAddress</code> is not a valid IP address, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If the socket has never joined the multicast group at the <code>ipAddress</code>, already left it or in the process of\n          leaving it, throw an \"<code>InvalidStateError</code>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If the associated <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"[[socket]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-socket\" class=\"internalDFN\" id=\"ref-for-dfn-socket-2\"><code>[[socket]]</code></a> was closed or aborted, throw an \"<code>InvalidStateError</code>\"\n          <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "Let <code>promise</code> be <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-new-promise\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to leave the multicast group specified by <code>ipAddress</code>."
            },
            {
              "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the\n               <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-11\">UDPSocket task source</a> to run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the operating system returned a failure, <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> <code>promise</code> with\n                   a \"<code>NetworkError</code>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> and abort these steps."
                },
                {
                  "html": "Remove <code>ipAddress</code> from <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"MulticastController\" data-xref-for=\"MulticastController\" data-lt=\"[[joinedGroups]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-joinedgroups\" class=\"internalDFN\" id=\"ref-for-dfn-joinedgroups-2\"><code>[[joinedGroups]]</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <code>promise</code> with <code>undefined</code>."
                }
              ]
            }
          ]
        },
        {
          "html": "Return <code>promise</code>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a>'s <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document</a> is\n          not <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" data-cite=\"permissions-policy\" data-cite-path=\"\" data-cite-frag=\"policy-controlled-feature\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature</a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-3\"><code>direct-sockets</code></a>\", throw a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <var>localAddress</var> is not a valid IP address, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-localport-1\"><code>localPort</code></a>\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-backlog\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-backlog-1\"><code>backlog</code></a>\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "If <var>options</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-ipv6only\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-ipv6only-1\"><code>ipv6Only</code></a>\"] is true but <code>localAddress</code> is not equal\n          to the IPv6 unspecified address (<code>::</code>), throw a <a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"exceptiondef-typeerror\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "If the requested <var>localPort</var> is less than 32678, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-1\">TCPServerSocket task source</a> to run the following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-1\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-1\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"notallowederror\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "Invoke the operating system to open a TCP server socket using the given <var>localAddress</var>\n              and the connection parameters (or their defaults) specified in <var>options</var>."
            },
            {
              "html": "If this fails for any reason, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-2\">TCPServerSocket task source</a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-2\"><code>[[openedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject</a> the <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-2\"><code>[[closedPromise]]</code></a> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n              <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-3\">TCPServerSocket task source</a> to run the following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPServerSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpserversocket-readable-stream-1\">Initialize</a> <a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-1\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "Let <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-2\"><code>TCPServerSocketOpenInfo</code></a>."
                },
                {
                  "html": "Set <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-readable-2\"><code>readable</code></a>\"] to\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-2\"><code>[[readable]]</code></a>."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var> using the information provided by the\n                  operating system:\n                  <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-localaddress-1\"><code>localAddress</code></a>\"] and\n                  <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var>[\"<a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-localport-1\"><code>localPort</code></a>\"]."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-3\"><code>[[openedPromise]]</code></a> with <var data-type=\"TCPServerSocketOpenInfo\">openInfo</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream</code></a>."
        },
        {
          "html": "Let <var>pullAlgorithm</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize</var> be the\n              <a href=\"https://streams.spec.whatwg.org/#desired-size-to-fill-a-streams-internal-queue\">desired\n                size</a>\n              of <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-4\"><code>[[readable]]</code></a>'s\n              <a href=\"https://streams.spec.whatwg.org/#internal-queues\">internal queue</a>."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to accept up to <var>desiredSize</var> incoming connections."
                },
                {
                  "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n                  <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-4\">TCPServerSocket task source</a> to run the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the connection was closed gracefully, run the following steps:",
                      "rationale": "invoke",
                      "steps": [
                        {
                          "html": "Invoke <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-close\" href=\"https://streams.spec.whatwg.org/#readablestream-close\">close</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-5\"><code>[[readable]]</code></a>."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-1\">handle closing the TCPServerSocket readable stream</a>."
                        }
                      ]
                    },
                    {
                      "html": "If no errors were encountered run the following steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var>tcpSocket</var> be a <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"new\" href=\"https://webidl.spec.whatwg.org/#new\">new</a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPSocket\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocket\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocket-3\"><code>TCPSocket</code></a> accepted by the operating system."
                        },
                        {
                          "html": "Invoke <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-enqueue\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">enqueue</a> on\n                          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-6\"><code>[[readable]]</code></a> with <var>tcpSocket</var>."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-error\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-7\"><code>[[readable]]</code></a> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"networkerror\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a> and invoke the steps\n                      to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-2\">handle closing the TCPServerSocket readable stream</a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm</var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-3\">handle closing the TCPServerSocket readable stream</a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"a-promise-resolved-with\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with</a> <code>undefined</code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-set-up\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up</a> <var data-type=\"ReadableStream\">stream</var> with\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm\">pullAlgorithm</a>\n          set to <var>pullAlgorithm</var>,\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a>\n          set to <var>cancelAlgorithm</var>,\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark\">highWaterMark</a>\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-8\"><code>[[readable]]</code></a> to <var data-type=\"ReadableStream\">stream</var>."
        }
      ]
    },
    {
      "rationale": "invoke",
      "steps": [
        {
          "html": "Invoke the operating system to close the socket."
        },
        {
          "html": "<a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object</a> of\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-5\">TCPServerSocket task source</a> to\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"resolve\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve</a> <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-3\"><code>[[closedPromise]]</code></a>\n          with <code>undefined</code>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-5\"><code>[[openedPromise]]</code></a> is rejected or not yet resolved,\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-5\"><code>[[closedPromise]]</code></a> is settled, return\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-6\"><code>[[closedPromise]]</code></a>."
        },
        {
          "html": "If <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-11\"><code>[[readable]]</code></a> is <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"reject\" href=\"https://webidl.spec.whatwg.org/#reject\">reject</a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"exception\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"invalidstateerror\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a>\" <a data-xref-type=\"_IDL_\" data-link-type=\"interface\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"idl-DOMException\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException</code></a>."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise</var> be the result of invoking\n          <a data-link-type=\"dfn\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"\" data-cite-frag=\"readablestream-cancel\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel</a> on <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-12\"><code>[[readable]]</code></a>."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise</var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Return <a data-link-type=\"dfn\" data-cite=\"webidl\" data-cite-path=\"\" data-cite-frag=\"this\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>.<a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-7\"><code>[[closedPromise]]</code></a>."
        }
      ]
    }
  ]
}