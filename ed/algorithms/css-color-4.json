{
  "spec": {
    "title": "CSS Color Module Level 4",
    "url": "https://drafts.csswg.org/css-color-4/"
  },
  "algorithms": [
    {
      "name": "parse a CSS <color> value",
      "href": "https://drafts.csswg.org/css-color-4/#parse-a-css-color-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"parse-a-css-color-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a CSS <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color①①\">&lt;color&gt;</a> value</dfn>,\n\tgiven a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string\">string</a> <var>input</var>,\n\tand an optional context <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element\" id=\"ref-for-concept-element\">element</a> <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-syntax-3/#css-parse-something-according-to-a-css-grammar\" id=\"ref-for-css-parse-something-according-to-a-css-grammar\">Parse</a> <var>input</var> as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color①②\">&lt;color&gt;</a>.\nIf the result is failure,\nreturn failure;\notherwise, let <var>color</var> be the result.</p>"
        },
        {
          "html": "<p>Let <var>used color</var> be the result of <a href=\"https://drafts.csswg.org/css-color-4/#resolving-color-values\">resolving</a> <var>color</var>\nto a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#used-color\" id=\"ref-for-used-color\">used color</a>.\nIf the value of other properties\non the element a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color①③\">&lt;color&gt;</a> is on\nis required to do the resolution\n(such as resolving a <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor③\">currentcolor</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors\">system color</a>),\nuse <var>element</var> if it was passed,\nor the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#initial-value\" id=\"ref-for-initial-value\">initial values</a> of the properties if not.</p>"
        },
        {
          "html": "<p>Return <var>used color</var>.</p>"
        }
      ]
    },
    {
      "html": "Conversion to the polar form is trivial:",
      "rationale": "if",
      "steps": [
        {
          "html": "C = sqrt(a^2 + b^2)"
        },
        {
          "html": "if (C &gt; epsilon) H = atan2(b, a) else H is missing"
        },
        {
          "html": "L is the same"
        }
      ]
    },
    {
      "html": "Conversion to the rectangular form is trivial:",
      "rationale": "if",
      "steps": [
        {
          "html": "If H is missing, a = b = 0"
        },
        {
          "html": "Otherwise,",
          "ignored": [
            "a = C cos(H) b = C sin(H)"
          ]
        },
        {
          "html": "L is the same"
        }
      ]
    },
    {
      "html": "For all predefined RGB color spaces,\n\tconversion to Lab requires several steps,\n\talthough in practice all but the first step are linear calculations and can be combined.",
      "rationale": "convert",
      "steps": [
        {
          "html": "Convert from gamma-encoded RGB to linear-light RGB (undo gamma encoding)"
        },
        {
          "html": "Convert from linear RGB to CIE XYZ"
        },
        {
          "html": "If needed, convert from a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d65\" id=\"ref-for-d65①②\">D65</a> whitepoint\n\t\t\t(used by <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb\" id=\"ref-for-valdef-color-srgb⑥\">sRGB</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-display-p3\" id=\"ref-for-valdef-color-display-p3⑧\">display-p3</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-a98-rgb\" id=\"ref-for-valdef-color-a98-rgb③\">a98-rgb</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-rec2020\" id=\"ref-for-valdef-color-rec2020④\">rec2020</a>)\n\t\t\tto the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50④\">D50</a> whitepoint used in Lab,\n\t\t\twith the linear Bradford transform. <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb⑤\">prophoto-rgb</a> already has a <span id=\"ref-for-d50⑤\">D50</span> whitepoint."
        },
        {
          "html": "Convert D50-adapted XYZ to Lab"
        }
      ]
    },
    {
      "html": "Conversion to Oklab is similar,\n\tbut the chromatic adaptation step\n\tis only needed for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb⑥\">prophoto-rgb</a>.",
      "rationale": "convert",
      "steps": [
        {
          "html": "Convert from gamma-encoded RGB to linear-light RGB (undo gamma encoding)"
        },
        {
          "html": "Convert from linear RGB to CIE XYZ"
        },
        {
          "html": "If needed, convert from a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50⑥\">D50</a> whitepoint (used by <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb⑦\">prophoto-rgb</a>)\n\t\t\tto the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d65\" id=\"ref-for-d65①③\">D65</a> whitepoint used in Oklab,\n\t\t\twith the linear Bradford transform."
        },
        {
          "html": "Convert D65-adapted XYZ to Oklab"
        }
      ]
    },
    {
      "html": "Conversion from Lab to predefined spaces like <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-display-p3\" id=\"ref-for-valdef-color-display-p3⑨\">display-p3</a> or <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-rec2020\" id=\"ref-for-valdef-color-rec2020⑤\">rec2020</a>\n\talso requires multiple steps,\n\tand again in practice all but the last step are linear calculations and can be combined.",
      "rationale": "convert",
      "steps": [
        {
          "html": "Convert Lab to (D50-adapted) XYZ"
        },
        {
          "html": "If needed, convert from a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50⑦\">D50</a> whitepoint (used by Lab)\n\t\t\tto the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d65\" id=\"ref-for-d65①④\">D65</a> whitepoint used in sRGB and most other RGB spaces,\n\t\t\twith the linear Bradford transform. <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb⑧\">prophoto-rgb</a>' does not require this step."
        },
        {
          "html": "Convert from (D65-adapted) CIE XYZ to linear RGB"
        },
        {
          "html": "Convert from linear-light RGB to RGB (do gamma encoding)"
        }
      ]
    },
    {
      "html": "Conversion from Oklab is similar,\n\tbut the chromatic adaptation step\n\tis only needed for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb⑨\">prophoto-rgb</a>.",
      "rationale": "convert",
      "steps": [
        {
          "html": "Convert Oklab to (D65-adapted) XYZ"
        },
        {
          "html": "If needed, convert from a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d65\" id=\"ref-for-d65①⑤\">D65</a> whitepoint (used by Oklab)\n\t\t\tto the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50⑧\">D50</a> whitepoint used in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb①⓪\">prophoto-rgb</a>,\n\t\t\twith the linear Bradford transform."
        },
        {
          "html": "Convert from (D65-adapted) CIE XYZ to linear RGB"
        },
        {
          "html": "Convert from linear-light RGB to RGB (do gamma encoding)"
        }
      ]
    },
    {
      "html": "Conversion from one predefined RGB color space to another\n\trequires multiple steps,\n\tone of which is only needed when the whitepoints differ.\n\tTo convert from <em>src</em> to <em>dest</em>:",
      "rationale": "convert",
      "steps": [
        {
          "html": "Convert from gamma-encoded <em>src</em>RGB to linear-light <em>src</em>RGB (undo gamma encoding)"
        },
        {
          "html": "Convert from linear <em>src</em>RGB to CIE XYZ"
        },
        {
          "html": "If <em>src</em> and <em>dest</em> have different whitepoints,\n\t\t\tconvert the XYZ value from <em>src</em>White to <em>dest</em>White\n\t\t\twith the linear Bradford transform."
        },
        {
          "html": "Convert from CIE XYZ to linear <em>dest</em>RGB"
        },
        {
          "html": "Convert from linear-light <em>dest</em>RGB to <em>dest</em>RGB (do gamma encoding)"
        }
      ]
    },
    {
      "html": "To convert a color <var>col1</var> in a source color space <var>src</var>\nwith white point <var>src-white</var>\nto a color <var>col2</var> in destination color space <var>dest</var>\nwith white point <var>dest-white</var>:",
      "rationale": "if",
      "steps": [
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-polrect\"></a>If <var>src</var> is in a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#cylindrical-polar-color\" id=\"ref-for-cylindrical-polar-color②\">cylindrical polar color</a> representation,\n\tfirst convert <var>col1</var>\n\tto the corresponding <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#rectangular-orthogonal-color\" id=\"ref-for-rectangular-orthogonal-color①\">rectangular orthogonal color</a> representation\n\tand let this be the new <var>col1</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-missing\"></a>Replace any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component⑦\">missing component</a> with zero."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-tolinear\"></a>If <var>src</var> is not a linear-light representation,\n\tconvert it to linear light (undo gamma-encoding)\n\tand let this be the new <var>col1</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-toXYZ\"></a>Convert <var>col1</var> to CIE XYZ with a given whitepoint <var>src-white</var>\n\tand let this be <var>xyz</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-CAT\"></a>If <var>dest-white</var> is not the same as <var>src-white</var>,\n\tchromatically adapt <var>xyz</var> to <var>dest-white</var>\n\tusing a linear Bradford <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#chromatic-adaptation-transform\" id=\"ref-for-chromatic-adaptation-transform\">chromatic adaptation transform</a>,\n\tand let this be the new <var>xyz</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-destpolar\"></a>If <var>dest</var> is a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#cylindrical-polar-color\" id=\"ref-for-cylindrical-polar-color③\">cylindrical polar color</a> representation,\n\tlet <var>dest-rect</var> be the corresponding  <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#rectangular-orthogonal-color\" id=\"ref-for-rectangular-orthogonal-color②\">rectangular orthogonal color</a> representation.\n\tOtherwise, let <var>dest-rect</var> be <var>dest</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-fromXYZ\"></a>Convert <var>xyz</var> to <var>dest</var>,\n\tfollowed by applying any transfer function (gamma encoding),\n\tproducing <var>col2</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-display\"></a>If <var>dest</var> is a physical output color space, such as a display,\n\tthen <var>col2</var> must be <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-gamut-mapped\" id=\"ref-for-css-gamut-mapped③\">css gamut mapped</a>\n\tso that it <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#can-be-displayed\" id=\"ref-for-can-be-displayed\">can be displayed</a>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#convert-rectpol\"></a>If <var>dest-rect</var> is not the same as <var>dest</var>,\n\tin other words <var>dest</var> is a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#cylindrical-polar-color\" id=\"ref-for-cylindrical-polar-color④\">cylindrical polar color</a> representation,\n\tconvert from <var>dest-rect</var> to <var>dest</var>, and let this be <var>col2</var>.\n\tThis may produce <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component⑧\">missing component</a>s."
        }
      ]
    },
    {
      "name": "to gamut map a color by binary search with local MINDE",
      "href": "https://drafts.csswg.org/css-color-4/#binary-search-gamut-map-with-local-minde",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"binary-search-gamut-map-with-local-minde\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Binary Search Gamut Map with Local MINDE</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of a destination color space <var>destination</var>:\n\n\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.3\" id=\"GMA-EdgeSeeker\"><span class=\"secno\">13.2.3. </span><span class=\"content\">\n\tThe EdgeSeeker Gamut Mapping\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#GMA-EdgeSeeker\"></a></h4>\n    <p>The EdgeSeeker algorithm is a geometric and lookup-table-based approach,\n\toriginally developed by Alexey Ardov \n\tfor the color.js library <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-colorjs-edgeseeker\" title=\"EdgeSeeker Gamut Mapping algorithm\">[colorjs-EdgeSeeker]</a>.</p>\n    <p>For any given hue, the gamut boundary slice\n\tis represented as a curved top section\n\tand a linear bottom section,\n\tjoning at the highest chroma point for that hue.</p>\n    <p>To initialize this algorithm,\n\tfor a given target RGB space,\n\ta lookup table (LUT) is constructed\n\tcontaining the highest-chroma Oklch color on each hue slice.\n\tLinear interpolation between closest LUT values\n\tis used to then estimate the highest-chroma color\n\tfor the exact hue of each color to be gamut mapped.</p>\n    <p>Intersection of the constant-lightness ray\n\twith the gamut boundary is then calculated,\n\twhich is fast for the lower (linear) part of the boundary\n\tand still fairly fast for the upper (curved) portion.</p>\n    <p>This gives good results, at the expense of memory for the LUT.</p>\n    <h4 class=\"heading settled\" data-level=\"13.2.4\" id=\"pseudo-edgeseeker\"><span class=\"secno\">13.2.4. </span><span class=\"content\">\nSample Pseudocode for the EdgeSeeker Gamut Mapping</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#pseudo-edgeseeker\"></a></h4>\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.5\" id=\"GMA-Raytrace\"><span class=\"secno\">13.2.5. </span><span class=\"content\">\n\tThe Ray Trace Gamut Mapping \n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#GMA-Raytrace\"></a></h4>\n    <p>The Ray Trace algorithm is a geometric approach\n\tto RGB gamut mapping,\n\tfor fast chroma reduction with constant lightness.\n\tIt was originally developed by Isaac Muse\n\tfor the Coloraide Python Library <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-coloraide-ray-trace\" title=\"Ray Tracing Chroma Reduction\">[Coloraide-Ray-Trace]</a>.</p>\n    <p>The color to be mapped is first converted to Oklch,\n\tand then the achromatic version of that color is generated,\n\twhich will be the neutral axis anchor.\n\tThese two colors are then converted to \n\tthe linear-light version of the target RGB space.</p>\n    <p>Because the gamut boundary is now an axis-aligned cube,\n\tfinding the intersection is faster.</p>\n    <p>A ray is cast from the inside of the RGB cube,\n\tfrom the anchor point to the current color. \n\tThe intersection along this path \n\twith the RGB gamut surface is then found;\n\tthis is the first approximation to the gamut mapped color.</p>\n    <p>As RGB spaces are not perceptually uniform,\n\ta constant hue, constant lightness ray\n\tis actually a curved path in RGB space.</p>\n    <p>The first approximation is converted back to Oklch\n\tto correct the color in the perceptual color space \n\tby projecting the point back onto the chroma reduction path, \n\tcorrecting the color’s hue and lightness. \n\tThe corrected color becomes the new current color \n\tand should be a much closer color on the reduced chroma line.</p>\n    <p>This process is repeated (a maximum of three more times),\n\teach time finding a better, closer color on the path. \n\tFinally, simple clipping is used to account for floating point math errors.</p>\n    <p>The results are comparable to binary search with local MINDE\n\tusing a low JND, \n\tbut resolves much faster \n\tand within more predictable, consistent time.</p>\n    <figure>\n     \n\t\t<img alt=\"\" height=\"800\" src=\"https://drafts.csswg.org/css-color-4/images/raytrace-gma.png\" width=\"800\">\n\t\t\n     <figcaption>Ray Trace gamut mpping to the sRGB gamut,\n\t\t\tshowing the curved path of chroma reduction\n\t\t\tas approximated over a maximum\n\t\t\tof four iterations.<br>\n\t\t\tImage copyright Isaac Muse.\n\t\t</figcaption>\n    </figure>\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.6\" id=\"pseudo-raytrace\"><span class=\"secno\">13.2.6. </span><span class=\"content\">\nSample Pseudocode for the Ray Trace Gamut Mapping</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#pseudo-raytrace\"></a></h4>\n    <div class=\"algorithm\" data-algorithm=\"to gamut map a color by Ray Tracing\">\n     \n\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"ray-trace-gamut-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Ray Trace Gamut Map</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of an RGB destination color space <var>destination</var>:\n\n\t\n     \n     <div class=\"algorithm\" data-algorithm=\"to cast a ray\">\n      \n\t\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cast-a-ray\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cast a ray</dfn> through a linear-light RGB space\n\t\tfrom <var>start</var> to <var>end</var> \n\t\t(in gamut mapping,\n\t\t<var>start</var> is an anchor within the RGB gamut \n\t\tand <var>end</var> is the gamut mapped color, on the cubical gamut surface):\n\n\t\n      \n     </div>\n     <h5 class=\"heading settled\" data-level=\"13.2.6.1\" id=\"raytrace-footnotes\"><span class=\"secno\">13.2.6.1. </span><span class=\"content\">Footnotes for Ray Trace algorithm</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnotes\"></a></h5>\n     \n    </div>\n    <h2 class=\"heading settled\" data-level=\"14\" id=\"resolving-color-values\"><span class=\"secno\">14. </span><span class=\"content\">\nResolving <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color①⑨\">&lt;color&gt;</a> Values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-color-values\"></a></h2>\n    <p>Unless otherwise specified for a particular property,\n\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#specified-value\" id=\"ref-for-specified-value\">specified</a> colors are resolved to\n\t<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"computed color\" id=\"computed-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①\">computed</a> colors</dfn>\n\tand then further to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"used color\" id=\"used-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value②\">used</a> colors</dfn> as described below.</p>\n    <p>The <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-1/#resolved-value\" id=\"ref-for-resolved-value\">resolved value</a> of a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⓪\">&lt;color&gt;</a> is its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value③\">used value</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.1\" id=\"resolving-sRGB-values\"><span class=\"secno\">14.1. </span><span class=\"content\">\nResolving sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-sRGB-values\"></a></h3>\n    <p>This applies to:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color③\">hex colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①④\">rgb()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba⑨\">rgba()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsl\" id=\"ref-for-funcdef-hsl①⑦\">hsl()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsla\" id=\"ref-for-funcdef-hsla①①\">hsla()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①⓪\">hwb()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color②\">named colors</a></p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors①\">system colors</a></p>\n     </li><li data-md=\"\">\n      <p><a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-colors</a></p>\n    </li></ul>\n    <p>It does <em>not</em> apply to:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color⑧\">color()</a> values using the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb\" id=\"ref-for-valdef-color-srgb⑨\">srgb</a> or <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb-linear\" id=\"ref-for-valdef-color-srgb-linear⑥\">srgb-linear</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑥\">color space</a>s.</p>\n    </li></ul>\n    <p>If the sRGB color was explicitly specified by the author as a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color③\">named color</a>,\n\tor as a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors②\">system color</a>,\n\tthe <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value\">declared value</a> is that named or system color, converted to\n\t<a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>.\n\tThe computed and used value\n\tis the corresponding sRGB color,\n\tpaired with the specified alpha component\n\t(after clamping to [0, 1])\n\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Otherwise, the declared, computed and used value\n\tis the corresponding sRGB color,\n\tpaired with the specified alpha component\n\t(after clamping to [0, 1])\n\tand defaulting to opaque if unspecified).</p>\n    <p>For historical reasons, when <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#funcdef-calc\" id=\"ref-for-funcdef-calc\">calc()</a> in sRGB colors\n\tresolves to a single value,\n\tthe declared value serialises without the \"calc(\" \")\" wrapper.</p>\n    \n    \n    <p>Also for historical reasons,\n\twhen calc() is simplified down to a single value,\n\tthe color values are clamped to [0.0, 255.0].</p>\n    \n    <p>This clamping also takes care of values such as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc-infinity\" id=\"ref-for-valdef-calc-infinity\">Infinity</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc--infinity\" id=\"ref-for-valdef-calc--infinity\">-Infinity</a>, and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc-nan\" id=\"ref-for-valdef-calc-nan\">NaN</a> which will clamp at 255, 0 and 0 respectively.</p>\n    \n    \n    <h3 class=\"heading settled\" data-level=\"14.2\" id=\"resolving-lab-lch-values\"><span class=\"secno\">14.2. </span><span class=\"content\">\nResolving Lab and LCH values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-lab-lch-values\"></a></h3>\n    <p>This applies to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑤\">lab()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑥\">lch()</a> values.</p>\n    <p>The declared, computed and used value\n\t\tis the corresponding CIE Lab or LCH color\n\t\t(after clamping of L, C and H)\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⓪\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③②\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Although the values of a, b and C\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.3\" id=\"resolving-oklab-oklch-values\"><span class=\"secno\">14.3. </span><span class=\"content\">\nResolving Oklab and OkLCh values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-oklab-oklch-values\"></a></h3>\n    <p>This applies to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑤\">oklab()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklch\" id=\"ref-for-funcdef-oklch⑥\">oklch()</a> values.</p>\n    <p>The declared, computed and used value\n\t\tis the corresponding Oklab or OkLCh color\n\t\t(after clamping of L, C and H)\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③①\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③③\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Although the values of a, b and C\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity①\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.4\" id=\"resolving-color-function-values\"><span class=\"secno\">14.4. </span><span class=\"content\">\nResolving values of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color⑨\">color()</a> function</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-color-function-values\"></a></h3>\n    <p>The declared, computed and used value\n\t\tis the color in the specified <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑦\">color space</a>,\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③②\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③④\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>For colors specified in the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz\" id=\"ref-for-valdef-color-xyz⑤\">xyz</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑧\">color space</a>,\n\t\twhich is an alias of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d65\" id=\"ref-for-valdef-color-xyz-d65③\">xyz-d65</a> <span id=\"ref-for-color-space⑨\">color space</span>,\n\t\tthe computed and used value\n\t\tis in the <span class=\"css\" id=\"ref-for-valdef-color-xyz-d65④\">xyz-d65</span> <span id=\"ref-for-color-space①⓪\">color space</span>.</p>\n    \n    <p>Although the values of r, g, b, x, y and z\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity②\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.5\" id=\"resolving-other-colors\"><span class=\"secno\">14.5. </span><span class=\"content\">Resolving other colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-other-colors\"></a></h3>\n    <p>This applies to <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors③\">system colors</a>\n\t(including the <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color\">&lt;deprecated-color&gt;</a>s),\n\t<a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent③\">transparent</a>,\n\tand <span class=\"css\">currentcolor</span>.</p>\n    <p>The declared value for each <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-system-color\" id=\"ref-for-typedef-system-color①⓪\">&lt;system-color&gt;</a> keyword\n\tand <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color①\">&lt;deprecated-color&gt;</a> keyword\n\tis itself.\n\tThe computed value\n\tis the corresponding color in its color space.\n\tHowever, such colors must not be altered by\n\t'forced colors mode'.</p>\n    \n    <p>The declared value of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent④\">transparent</a> is \"transparent\"\n\twhile the computed and used value  is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#transparent-black\" id=\"ref-for-transparent-black①\">transparent black</a>.</p>\n    <p>The <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①①\">currentcolor</a> keyword computes to itself.</p>\n    <p>In the <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-4/#propdef-color\" id=\"ref-for-propdef-color④\">color</a> property,\n\tthe used value of <span class=\"css\">currentcolor</span> is the \n\tresolved <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#inherited-value\" id=\"ref-for-inherited-value\">inherited value</a>.\n\tIn any other property,\n\tits used value is the used value of the <span class=\"property\" id=\"ref-for-propdef-color⑤\">color</span> property on the same element.</p>\n    \n    \n    \n    <h2 class=\"heading settled\" data-level=\"15\" id=\"serializing-color-values\"><span class=\"secno\">15. </span><span class=\"content\">\nSerializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②①\">&lt;color&gt;</a> Values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-color-values\"></a></h2>\n    <p>This section updates and replaces that part of CSS Object Model, section\n<a href=\"https://drafts.csswg.org/cssom-1/#serializing-css-values\"> Serializing CSS Values</a>, which relates to serializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②②\">&lt;color&gt;</a> values.</p>\n    <p>In this section, the strings used in the specification and the corresponding characters are as follows.</p>\n    <div class=\"overlarge\"><table class=\"data\">\n     <tbody>\n      <tr>\n       <th>String\n       </th><th>Character(s)\n      </th></tr><tr>\n       <td>\" \"\n       </td><td>U+0020 SPACE\n      </td></tr><tr>\n       <td>\"#\"\n       </td><td>U+0023 NUMBER SIGN\n      </td></tr><tr>\n       <td>\",\"\n       </td><td>U+002C COMMA\n      </td></tr><tr>\n       <td>\"-\"\n       </td><td>U+002D HYPHEN-MINUS\n      </td></tr><tr>\n       <td>\".\"\n       </td><td>U+002E FULL STOP\n      </td></tr><tr>\n       <td>\"/\"\n       </td><td>U+002F SOLIDUS\n      </td></tr><tr>\n       <td>\"none\"\n       </td><td>U+006E LATIN SMALL LETTER N<br>\n\t\t\tU+006F LATIN SMALL LETTER O<br>\n\t\t\tU+006E LATIN SMALL LETTER N<br>\n\t\t\tU+0065 LATIN SMALL LETTER E\n\t\t\n    </td></tr></tbody></table></div>\n    <p>The string \".\" shall be used as a decimal separator,\nregardless of locale,\nand there shall be no thousands separator.</p>\n    <p>For syntactic forms which support <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component②⓪\">missing color components</a>,\nthe value <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①①\">none</a> (equivalently NONE, nOnE, etc),\nshall be serialized in all-lowercase\nas the string \"none\".</p>\n    <h3 class=\"heading settled\" data-level=\"15.1\" id=\"serializing-alpha-values\"><span class=\"secno\">15.1. </span><span class=\"content\">\nSerializing alpha values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\"></a></h3>\n    <p>This applies to any <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②③\">&lt;color&gt;</a> value which can take an optional alpha value.\n\tIt does not apply to the <span class=\"css\">opacity</span> property.</p>\n    <p>If, after clamping to the range [0, 1] the alpha is 1,\n\tit is omitted from the serialization;\n\tan implicit value of 1 (fully opaque) is the default.</p>\n    <p>If the alpha is any other value than 1,\n\tit is explicitly included in the serialization as described below.</p>\n    <p>If the value is internally represented as an integer\n\tbetween 0 and 255 inclusive (i.e. 8-bit unsigned integer),\n\tfollow these steps:</p>\n    \n    <p>Otherwise, return the result of serializing the given value\n\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③④\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③⑤\">&lt;percentage&gt;</a>).</p>\n    \n    <p>The <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑤\">&lt;number&gt;</a> value is expressed in base ten,\n\twith the \".\" character as decimal separator.\n\tThe leading zero must not be omitted.\n\tTrailing zeroes must be omitted.</p>\n    \n    <p>The precision with which alpha values are retained,\n\tand thus the number of decimal places in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip integer percentage values.\n\tThus, the serialized value must contain\n\tat least two decimal places\n\t(unless trailing zeroes have been removed).\n\tValues must be\n\t<a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p>Because <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color-alpha-value\" id=\"ref-for-typedef-color-alpha-value②④\">&lt;alpha-value&gt;</a>s which were specified outside the valid range\n\tare clamped at parse time, the declared value will be clamped.\n\tHowever, per <a href=\"https://drafts.csswg.org/css-values-4/#calc-range\"><cite>CSS Values 4</cite> § 10.12 Range Checking</a>, <span class=\"production\" id=\"ref-for-typedef-color-alpha-value②⑤\">&lt;alpha-value&gt;</span>s\n\tspecified using calc() are not clamped when the specified form is serialized;\n\tbut the computed values are clamped.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.2\" id=\"serializing-sRGB-values\"><span class=\"secno\">15.2. </span><span class=\"content\">\nSerializing sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-sRGB-values\"></a></h3>\n    <p>The serialized form of the following sRGB values:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color④\">hex colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑤\">rgb()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①⓪\">rgba()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsl\" id=\"ref-for-funcdef-hsl①⑧\">hsl()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsla\" id=\"ref-for-funcdef-hsla①②\">hsla()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①①\">hwb()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color④\">named colors</a></p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors④\">system colors</a></p>\n     </li><li data-md=\"\">\n      <p><a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑤\">transparent</a></p>\n    </li></ul>\n    <p>is derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value①\">declared value</a>.</p>\n    <p>When serializing the value of a property\n\twhich was set by the author to a CSS <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color⑤\">named color</a>,\n\ta <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑤\">system color</a>,\n\ta <a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-color</a>,\n\tor <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑥\">transparent</a>\n\ttherefore, for the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value②\">declared value</a>,\n\tthe <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tkeyword value is retained.\n\tFor the computed and used value,\n\tthe corresponding sRGB value is used.</p>\n    \n    <p>Thus, the serialized declared value of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑦\">transparent</a> is the string \"transparent\",\n\twhile the serialized computed value of <span class=\"css\" id=\"ref-for-valdef-color-transparent⑧\">transparent</span> is the string \"rgba(0, 0, 0, 0)\".</p>\n    <p>For all other sRGB values,\n\tthe declared, computed and used value\n\tis the corresponding sRGB value.</p>\n    <p>During serialization,\n\tany <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component②①\">missing</a> values\n\tare converted to 0.</p>\n    <h4 class=\"heading settled\" data-level=\"15.2.1\" id=\"HTML-compatible-serialization-of-srgb\"><span class=\"secno\">15.2.1. </span><span class=\"content\">HTML-compatible serialization of sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#HTML-compatible-serialization-of-srgb\"></a></h4>\n    <p>If the following conditions are all true:</p>\n    \n    <p>Then corresponding sRGB values are serialized in 6-digit <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color⑤\">hex color notation</a> as follows:</p>\n    <p>A seven-character string consisting of the character \"#\", followed immediately by the two-digit hexadecimal representations of the red component, the green component, and the blue component, in that order, using <a href=\"https://infra.spec.whatwg.org/#ascii-lower-hex-digit\">ASCII lower hex digits</a>. No spaces are permitted.</p>\n    \n    <p>Otherwise, for sRGB the <a href=\"https://drafts.csswg.org/css-color-4/#css-serialization-of-srgb\">CSS serialization of sRGB values is used</a> and for other color spaces, the relevant <a href=\"https://drafts.csswg.org/css-color-4/#serializing-color-values\">serialization</a> of the <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②④\">&lt;color&gt;</a> value.</p>\n    \n    \n    <h4 class=\"heading settled\" data-level=\"15.2.2\" id=\"css-serialization-of-srgb\"><span class=\"secno\">15.2.2. </span><span class=\"content\">CSS serialization of sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#css-serialization-of-srgb\"></a></h4>\n    <p>Corresponding sRGB values use either the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑥\">rgb()</a> or <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①①\">rgba()</a> form\n\t(depending on whether the (clamped) alpha is exactly 1, or not),\n\twith all <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>For compatibility, the sRGB component values\n\tare serialized in <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑥\">&lt;number&gt;</a> form, not <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③⑥\">&lt;percentage&gt;</a>.\n\tAlso for compatibility,\n\tthe component values are serialized in base 10,\n\twith a range of [0-255], regardless of\n\tthe bit depth with which they are stored.</p>\n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tAlso, for compatibility, if the alpha is exactly 1,\n\tthe <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑦\">rgb()</a> form is used,\n\twith an implicit alpha;\n\totherwise, the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①②\">rgba()</a> form is used,\n\twith an explicit alpha value.</p>\n    <p>For compatibility,\n\tthe legacy form with comma separators is used;\n\texactly one ASCII space follows each comma.\n\tThis includes the comma (not slash) used\n\tto separate the blue component of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①③\">rgba()</a>\n\tfrom the alpha value.</p>\n    \n    \n    \n    <p id=\"sRGB-precision\">\n\tThe precision with which sRGB component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip eight bit values.\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.\n\t</p>\n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.\n\tThis means that sRGB colors specified with integer component values\n\twill serialize with backwards-compatible integer values.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.3\" id=\"serializing-lab-lch\"><span class=\"secno\">15.3. </span><span class=\"content\">\nSerializing Lab and LCH values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-lab-lch\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑦\">lch()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑥\">lab()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value②\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-lab⑦\">lab()</span> or <span class=\"css\" id=\"ref-for-funcdef-lch⑧\">lch()</span> forms,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>The component values are serialized in base 10;\n\tthe L, a, b and C component values\n\tare serialized as <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑨\">&lt;number&gt;</a>,\n\tusing the <a href=\"https://drafts.csswg.org/css-color-4/#prr-lab\">Lab percentage reference ranges</a>\n\tor the <a href=\"https://drafts.csswg.org/css-color-4/#prr-lch\">LCH percentage reference ranges</a>\n\tas appropriate\n\tto perform percentage to number conversion;\n\tthus 0% L maps to 0\n\tand 100% L maps to 100.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values.</p>\n    \n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>The precision with which <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑧\">lab()</a> component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut due to the wide gamut must be sufficient\n\tto round-trip L values between 0 and 100,\n\tand a and b values between ±127,\n\twith at least sixteen bit precision;\n\tthis will result in at least three decimal places\n\tunless trailing zeroes have been omitted.\n\t(half float or float, is recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate the b component value from the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.4\" id=\"serializing-oklab-oklch\"><span class=\"secno\">15.4. </span><span class=\"content\">\nSerializing Oklab and OkLCh values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-oklab-oklch\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklch\" id=\"ref-for-funcdef-oklch⑦\">oklch()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑥\">oklab()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value③\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-oklab⑦\">oklab()</span> or <span class=\"css\" id=\"ref-for-funcdef-oklch⑧\">oklch()</span> forms,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>The component values are serialized in base 10;\n\tthe L, a, b and C component values\n\tare serialized as <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④⓪\">&lt;number&gt;</a>\n\tusing the <a href=\"https://drafts.csswg.org/css-color-4/#prr-oklab\">Oklab percentage reference ranges</a>\n\tor the <a href=\"https://drafts.csswg.org/css-color-4/#prr-oklch\">OkLCh percentage reference ranges</a>\n\tas appropriate\n\tto perform percentage to number conversion;\n\tthus 0% L maps to 0\n\tand 100% L maps to 1.0.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values.</p>\n    \n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>The precision with which <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑧\">oklab()</a> component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut due to the wide gamut must be sufficient\n\tto round-trip L values between 0 and 1 (0% and 100%),\n\tand a, b and C values between ±0.5,\n\twith at least sixteen bit precision;\n\tthis will result in at least five decimal places\n\tunless trailing zeroes have been omitted.\n\t(half float or float, is recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate the final color component (b, or C) value from the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.5\" id=\"serializing-color-function-values\"><span class=\"secno\">15.5. </span><span class=\"content\">\nSerializing values of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⓪\">color()</a> function</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-color-function-values\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①①\">color()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value④\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-color①②\">color()</span> form,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name\n\tand the color space name.</p>\n    <p>The component values are serialized in base 10,\n\tas <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④①\">&lt;number&gt;</a>.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values,\n\tand also between the color space name and the first color component.</p>\n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>If the color space is sRGB, the color space is still explicitly required in the serialized result.</p>\n    <p>For the predefined color spaces,\n\tthe <em>minimum</em> precision for round-tripping is as follows:</p>\n    <div class=\"overlarge\"><table class=\"data\" id=\"predefined-precision-table\">\n     <tbody>\n      <tr>\n       <th>color space\n       </th><th>Minimum bits\n      </th></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb\" id=\"ref-for-valdef-color-srgb①⓪\">srgb</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb-linear\" id=\"ref-for-valdef-color-srgb-linear⑦\">srgb-linear</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-display-p3\" id=\"ref-for-valdef-color-display-p3①①\">display-p3</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><span class=\"css\">display-p3-linear</span>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-a98-rgb\" id=\"ref-for-valdef-color-a98-rgb⑤\">a98-rgb</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb①④\">prophoto-rgb</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-rec2020\" id=\"ref-for-valdef-color-rec2020⑦\">rec2020</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz\" id=\"ref-for-valdef-color-xyz⑥\">xyz</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d50\" id=\"ref-for-valdef-color-xyz-d50③\">xyz-d50</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d65\" id=\"ref-for-valdef-color-xyz-d65⑤\">xyz-d65</a>\n       </td><td>16\n    </td></tr></tbody></table></div>\n    <p>(16bit, half-float, or float <em>per component</em>\n\tis recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate\n\tthe final color component value\n\tfrom the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.6\" id=\"serializing-other-colors\"><span class=\"secno\">15.6. </span><span class=\"content\">\nSerializing other colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-other-colors\"></a></h3>\n    <p>This applies to\n\t<a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①③\">currentcolor</a>.</p>\n    <p>The serialized form of this value\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑤\">computed value</a>\n\tand uses <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the color name.</p>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①④\">currentColor</a> is the string \"currentcolor\".</p>\n    <h2 class=\"heading settled\" data-level=\"16\" id=\"serializing-opacity-values\"><span class=\"secno\">16. </span><span class=\"content\">\nSerializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-opacity-opacity-value\" id=\"ref-for-typedef-opacity-opacity-value④\">&lt;opacity-value&gt;</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-opacity-values\"></a></h2>\n    <p>This applies to the <span class=\"css\">opacity</span> property.</p>\n    <p>If the specified value for an opacity value\n\tmatches a literal <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-percentage-token\" id=\"ref-for-typedef-percentage-token\">&lt;percentage-token&gt;</a>\n\t(i.e. does not use <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#funcdef-calc\" id=\"ref-for-funcdef-calc②\">calc()</a>)\n\tit should be serialized as the equivalent\n\t<a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④②\">&lt;number&gt;</a> (0% maps to 0, 100% maps to 1) value.\n\tvalue. \n\tOtherwise, the specified value \n\tfor an opacity value \n\tshould serialize using \n\tthe standard serialization for the grammar.</p>\n    <p>This <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④③\">&lt;number&gt;</a> value is expressed in base ten,\n\twith the \".\" character as decimal separator.\n\tThe leading zero must not be omitted.\n\tTrailing zeroes must be omitted.</p>\n    <p>Opacity values outside the range [0,1]\n\tare preserved, without clamping, in the serialized specified value.</p>\n    <p>The precision with which opacity values are retained,\n\tand thus the number of decimal places in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip integer percentage values.\n\tThus, the serialized value must contain\n\tat least two decimal places\n\t(unless trailing zeroes have been removed).\n\tValues must be\n\t<a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded \n\ttowards +∞</a>, not truncated.</p>\n    <h2 class=\"heading settled\" data-level=\"17\" id=\"sample\"><span class=\"secno\">17. </span><span class=\"content\">\nDefault Style Rules</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#sample\"></a></h2>\n    <p>The following stylesheet is informative, not normative.  This style sheet could be used by an implementation as part of its default styling of HTML documents.</p>\n<pre class=\"highlight lang-css\"><c- c=\"\">/* traditional desktop user agent colors for hyperlinks */</c->\n:link <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> LinkText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n:visited <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> VisitedText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n:active <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> ActiveText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n</pre>\n    <h2 class=\"heading settled\" data-level=\"18\" id=\"color-conversion-code\"><span class=\"secno\">18. </span><span class=\"content\">\nSample code for Color Conversions</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-conversion-code\"></a></h2>\n    <p><em>This section is not normative.</em></p>\n    \n    <p>For clarity, <a href=\"https://drafts.csswg.org/css-color-4/multiply-matrices.js\">a library</a> is used for matrix multiplication.\n(This is more readable than inlining all the multiplies and adds).\nThe matrices are in <a href=\"https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry/row-major-vs-column-major-vector\">column-major order</a>.</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// Sample code for color conversions</c->\n<c- c1=\"\">// Conversion can also be done using ICC profiles and a Color Management System</c->\n<c- c1=\"\">// For clarity, a library is used for matrix multiplication (multiply-matrices.js)</c->\n\n<c- c1=\"\">// standard white points, defined by 4-figure CIE x,y chromaticities</c->\n<c- a=\"\">const</c-> D50 <c- o=\"\">=</c-> <c- p=\"\">[</c-><c- mf=\"\">0.3457</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">,</c-> <c- mf=\"\">1.00000</c-><c- p=\"\">,</c-> <c- p=\"\">(</c-><c- mf=\"\">1.0</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3457</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">];</c->\n<c- a=\"\">const</c-> D65 <c- o=\"\">=</c-> <c- p=\"\">[</c-><c- mf=\"\">0.3127</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">,</c-> <c- mf=\"\">1.00000</c-><c- p=\"\">,</c-> <c- p=\"\">(</c-><c- mf=\"\">1.0</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3127</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">];</c->\n\n<c- c1=\"\">// sRGB-related functions</c->\n\n<c- a=\"\">function</c-> lin_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of sRGB values</c->\n\t<c- c1=\"\">// where in-gamut values are in the range [0 - 1]</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// https://en.wikipedia.org/wiki/SRGB</c->\n\t<c- c1=\"\">// Extended transfer function:</c->\n\t<c- c1=\"\">// for negative values,  linear portion is extended on reflection of axis,</c->\n\t<c- c1=\"\">// then reflected power function is used.</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&lt;=</c-> <c- mf=\"\">0.04045</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> val <c- o=\"\">/</c-> <c- mf=\"\">12.92</c-><c- p=\"\">;</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> <c- p=\"\">(</c->Math<c- p=\"\">.</c->pow<c- p=\"\">((</c->abs <c- o=\"\">+</c-> <c- mf=\"\">0.055</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">1.055</c-><c- p=\"\">,</c-> <c- mf=\"\">2.4</c-><c- p=\"\">));</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light sRGB values in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// https://en.wikipedia.org/wiki/SRGB</c->\n\t<c- c1=\"\">// Extended transfer function:</c->\n\t<c- c1=\"\">// For negative values, linear portion extends on reflection</c->\n\t<c- c1=\"\">// of axis, then uses reflected pow below that</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&gt;</c-> <c- mf=\"\">0.0031308</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> <c- p=\"\">(</c-><c- mf=\"\">1.055</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">2.4</c-><c- p=\"\">)</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.055</c-><c- p=\"\">);</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> <c- mf=\"\">12.92</c-> <c- o=\"\">*</c-> val<c- p=\"\">;</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_sRGB_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light sRGB values to CIE XYZ</c->\n\t<c- c1=\"\">// using sRGB's own white, D65 (no chromatic adaptation)</c->\n\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">506752</c-> <c- o=\"\">/</c-> <c- mf=\"\">1228815</c-><c- p=\"\">,</c->  <c- mf=\"\">87881</c-> <c- o=\"\">/</c-> <c- mf=\"\">245763</c-><c- p=\"\">,</c->   <c- mf=\"\">12673</c-> <c- o=\"\">/</c->   <c- mf=\"\">70218</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">87098</c-> <c- o=\"\">/</c->  <c- mf=\"\">409605</c-><c- p=\"\">,</c-> <c- mf=\"\">175762</c-> <c- o=\"\">/</c-> <c- mf=\"\">245763</c-><c- p=\"\">,</c->   <c- mf=\"\">12673</c-> <c- o=\"\">/</c->  <c- mf=\"\">175545</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">7918</c-> <c- o=\"\">/</c->  <c- mf=\"\">409605</c-><c- p=\"\">,</c->  <c- mf=\"\">87881</c-> <c- o=\"\">/</c-> <c- mf=\"\">737289</c-><c- p=\"\">,</c-> <c- mf=\"\">1001167</c-> <c- o=\"\">/</c-> <c- mf=\"\">1053270</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_sRGB<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light sRGB</c->\n\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">12831</c-> <c- o=\"\">/</c->   <c- mf=\"\">3959</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">329</c-> <c- o=\"\">/</c->    <c- mf=\"\">214</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1974</c-> <c- o=\"\">/</c->   <c- mf=\"\">3959</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">851781</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">1648619</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">36519</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->     <c- mf=\"\">705</c-> <c- o=\"\">/</c->  <c- mf=\"\">12673</c-><c- p=\"\">,</c->   <c- o=\"\">-</c-><c- mf=\"\">2585</c-> <c- o=\"\">/</c->  <c- mf=\"\">12673</c-><c- p=\"\">,</c->   <c- mf=\"\">705</c-> <c- o=\"\">/</c->    <c- mf=\"\">667</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">//  display-p3-related functions</c->\n\n\n<c- a=\"\">function</c-> lin_P3<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of display-p3 RGB values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\n\t<c- k=\"\">return</c-> lin_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">);</c->\t<c- c1=\"\">// same as sRGB</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_P3<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light display-p3 RGB  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\n\t<c- k=\"\">return</c-> gam_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">);</c->\t<c- c1=\"\">// same as sRGB</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_P3_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light display-p3 values to CIE XYZ</c->\n\t<c- c1=\"\">// using  D65 (no chromatic adaptation)</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">608311</c-> <c- o=\"\">/</c-> <c- mf=\"\">1250200</c-><c- p=\"\">,</c-> <c- mf=\"\">189793</c-> <c- o=\"\">/</c-> <c- mf=\"\">714400</c-><c- p=\"\">,</c->  <c- mf=\"\">198249</c-> <c- o=\"\">/</c-> <c- mf=\"\">1000160</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">35783</c-> <c- o=\"\">/</c->  <c- mf=\"\">156275</c-><c- p=\"\">,</c-> <c- mf=\"\">247089</c-> <c- o=\"\">/</c-> <c- mf=\"\">357200</c-><c- p=\"\">,</c->  <c- mf=\"\">198249</c-> <c- o=\"\">/</c-> <c- mf=\"\">2500400</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->      <c- mf=\"\">0</c-> <c- o=\"\">/</c->       <c- mf=\"\">1</c-><c- p=\"\">,</c->  <c- mf=\"\">32229</c-> <c- o=\"\">/</c-> <c- mf=\"\">714400</c-><c- p=\"\">,</c-> <c- mf=\"\">5220557</c-> <c- o=\"\">/</c-> <c- mf=\"\">5000800</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_P3<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light P3</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">446124</c-> <c- o=\"\">/</c-> <c- mf=\"\">178915</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">333277</c-> <c- o=\"\">/</c-> <c- mf=\"\">357830</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">72051</c-> <c- o=\"\">/</c-> <c- mf=\"\">178915</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">14852</c-> <c- o=\"\">/</c->  <c- mf=\"\">17905</c-><c- p=\"\">,</c->   <c- mf=\"\">63121</c-> <c- o=\"\">/</c->  <c- mf=\"\">35810</c-><c- p=\"\">,</c->    <c- mf=\"\">423</c-> <c- o=\"\">/</c->  <c- mf=\"\">17905</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">11844</c-> <c- o=\"\">/</c-> <c- mf=\"\">330415</c-><c- p=\"\">,</c->  <c- o=\"\">-</c-><c- mf=\"\">50337</c-> <c- o=\"\">/</c-> <c- mf=\"\">660830</c-><c- p=\"\">,</c-> <c- mf=\"\">316169</c-> <c- o=\"\">/</c-> <c- mf=\"\">330415</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// prophoto-rgb functions</c->\n\n<c- a=\"\">function</c-> lin_ProPhoto<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of prophoto-rgb values</c->\n\t<c- c1=\"\">// where in-gamut colors are in the range [0.0 - 1.0]</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// Transfer curve is gamma 1.8 with a small linear portion</c->\n\t<c- c1=\"\">// Extended transfer function</c->\n\t<c- a=\"\">const</c-> Et2 <c- o=\"\">=</c-> <c- mf=\"\">16</c-><c- o=\"\">/</c-><c- mf=\"\">512</c-><c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&lt;=</c-> Et2<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> val <c- o=\"\">/</c-> <c- mf=\"\">16</c-><c- p=\"\">;</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1.8</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_ProPhoto<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light prophoto-rgb  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// Transfer curve is gamma 1.8 with a small linear portion</c->\n\t<c- c1=\"\">// TODO for negative values, extend linear portion on reflection of axis, then add pow below that</c->\n\t<c- a=\"\">const</c-> Et <c- o=\"\">=</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">512</c-><c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&gt;=</c-> Et<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">1.8</c-><c- p=\"\">);</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> <c- mf=\"\">16</c-> <c- o=\"\">*</c-> val<c- p=\"\">;</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_ProPhoto_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light prophoto-rgb values to CIE D50 XYZ</c->\n\t<c- c1=\"\">// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy</c->\n\t<c- c1=\"\">// see https://github.com/w3c/csswg-drafts/issues/7675</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.79776664490064230</c-><c- p=\"\">,</c->  <c- mf=\"\">0.13518129740053308</c-><c- p=\"\">,</c->  <c- mf=\"\">0.03134773412839220</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.28807482881940130</c-><c- p=\"\">,</c->  <c- mf=\"\">0.71183523424187300</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00008993693872564</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.82510460251046020</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_ProPhoto<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert D50 XYZ to linear-light prophoto-rgb</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.34578688164715830</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.25557208737979464</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.05110186497554526</c-> <c- p=\"\">],</c->\n        <c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.54463070512490190</c-><c- p=\"\">,</c->  <c- mf=\"\">1.50824774284514680</c-><c- p=\"\">,</c->  <c- mf=\"\">0.02052744743642139</c-> <c- p=\"\">],</c->\n        <c- p=\"\">[</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">1.21196754563894520</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// a98-rgb functions</c->\n\n<c- a=\"\">function</c-> lin_a98rgb<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of a98-rgb values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// negative values are also now accepted</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t  \t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">563</c-><c- o=\"\">/</c-><c- mf=\"\">256</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_a98rgb<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light a98-rgb  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// negative values are also now accepted</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">256</c-><c- o=\"\">/</c-><c- mf=\"\">563</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_a98rgb_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light a98-rgb values to CIE XYZ</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html</c->\n\t<c- c1=\"\">// has greater numerical precision than section 4.3.5.3 of</c->\n\t<c- c1=\"\">// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf</c->\n\t<c- c1=\"\">// but the values below were calculated from first principles</c->\n\t<c- c1=\"\">// from the chromaticity coordinates of R G B W</c->\n\t<c- c1=\"\">// see matrixmaker.html</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">573536</c-> <c- o=\"\">/</c->  <c- mf=\"\">994567</c-><c- p=\"\">,</c->  <c- mf=\"\">263643</c-> <c- o=\"\">/</c-> <c- mf=\"\">1420810</c-><c- p=\"\">,</c->  <c- mf=\"\">187206</c-> <c- o=\"\">/</c->  <c- mf=\"\">994567</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">591459</c-> <c- o=\"\">/</c-> <c- mf=\"\">1989134</c-><c- p=\"\">,</c-> <c- mf=\"\">6239551</c-> <c- o=\"\">/</c-> <c- mf=\"\">9945670</c-><c- p=\"\">,</c->  <c- mf=\"\">374412</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">53769</c-> <c- o=\"\">/</c-> <c- mf=\"\">1989134</c-><c- p=\"\">,</c->  <c- mf=\"\">351524</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-><c- p=\"\">,</c-> <c- mf=\"\">4929758</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_a98rgb<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light a98-rgb</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1829569</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">506331</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">308931</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">851781</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">1648619</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-><c- p=\"\">,</c->   <c- mf=\"\">36519</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">16779</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">147721</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-><c- p=\"\">,</c-> <c- mf=\"\">1266979</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">//Rec. 2020-related functions</c->\n\n<c- a=\"\">function</c-> lin_2020<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of rec2020 RGB values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1</c->\n\t<c- c1=\"\">//  with b (black lift) = 0 and a (user gain) = 1</c->\n\t<c- c1=\"\">//  defined over the extended range, not clamped</c->\n\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">2.4</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_2020<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light rec2020 RGB  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1</c->\n\t<c- c1=\"\">//  with b (black lift) = 0 and a (user gain) = 1</c->\n\t<c- c1=\"\">//  defined over the extended range, not clamped</c->\n\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-> <c- o=\"\">/</c-> <c- mf=\"\">2.4</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_2020_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light rec2020 values to CIE XYZ</c->\n\t<c- c1=\"\">// using  D65 (no chromatic adaptation)</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">63426534</c-> <c- o=\"\">/</c-> <c- mf=\"\">99577255</c-><c- p=\"\">,</c->  <c- mf=\"\">20160776</c-> <c- o=\"\">/</c-> <c- mf=\"\">139408157</c-><c- p=\"\">,</c->  <c- mf=\"\">47086771</c-> <c- o=\"\">/</c-> <c- mf=\"\">278816314</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">26158966</c-> <c- o=\"\">/</c-> <c- mf=\"\">99577255</c-><c- p=\"\">,</c-> <c- mf=\"\">472592308</c-> <c- o=\"\">/</c-> <c- mf=\"\">697040785</c-><c- p=\"\">,</c->   <c- mf=\"\">8267143</c-> <c- o=\"\">/</c-> <c- mf=\"\">139408157</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->        <c- mf=\"\">0</c-> <c- o=\"\">/</c->        <c- mf=\"\">1</c-><c- p=\"\">,</c->  <c- mf=\"\">19567812</c-> <c- o=\"\">/</c-> <c- mf=\"\">697040785</c-><c- p=\"\">,</c-> <c- mf=\"\">295819943</c-> <c- o=\"\">/</c-> <c- mf=\"\">278816314</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\t<c- c1=\"\">// 0 is actually calculated as  4.994106574466076e-17</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_2020<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light rec2020</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">30757411</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">6372589</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">4539589</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">19765991</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-><c- p=\"\">,</c-> <c- mf=\"\">47925759</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-><c- p=\"\">,</c->   <c- mf=\"\">467509</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->    <c- mf=\"\">792561</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1921689</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-><c- p=\"\">,</c-> <c- mf=\"\">42328811</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Chromatic adaptation</c->\n\n<c- a=\"\">function</c-> D65_to_D50<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Bradford chromatic adaptation from D65 to D50</c->\n\t<c- c1=\"\">// The matrix below is the result of three operations:</c->\n\t<c- c1=\"\">// - convert from XYZ to retinal cone domain</c->\n\t<c- c1=\"\">// - scale components from one reference white to another</c->\n\t<c- c1=\"\">// - convert back to XYZ</c->\n\t<c- c1=\"\">// see https://github.com/LeaVerou/color.js/pull/354/files</c->\n\t\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c->  <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.0479297925449969</c-><c- p=\"\">,</c->    <c- mf=\"\">0.022946870601609652</c-><c- p=\"\">,</c->  <c- o=\"\">-</c-><c- mf=\"\">0.05019226628920524</c->  <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.02962780877005599</c-><c- p=\"\">,</c->   <c- mf=\"\">0.9904344267538799</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">0.017073799063418826</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.009243040646204504</c-><c- p=\"\">,</c->  <c- mf=\"\">0.015055191490298152</c-><c- p=\"\">,</c->   <c- mf=\"\">0.7518742814281371</c->   <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> D50_to_D65<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Bradford chromatic adaptation from D50 to D65</c->\n\t<c- c1=\"\">// See https://github.com/LeaVerou/color.js/pull/360/files</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.955473421488075</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">0.02309845494876471</c-><c- p=\"\">,</c->   <c- mf=\"\">0.06325924320057072</c->  <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0283697093338637</c-><c- p=\"\">,</c->    <c- mf=\"\">1.0099953980813041</c-><c- p=\"\">,</c->    <c- mf=\"\">0.021041441191917323</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.012314014864481998</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.020507649298898964</c-><c- p=\"\">,</c->  <c- mf=\"\">1.330365926242124</c->    <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// CIE Lab and LCH</c->\n\n<c- a=\"\">function</c-> XYZ_to_Lab<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Assuming XYZ is relative to D50, convert to CIE Lab</c->\n\t<c- c1=\"\">// from CIE standard, which now defines these as a rational fraction</c->\n\t<c- a=\"\">var</c-> ε <c- o=\"\">=</c-> <c- mf=\"\">216</c-><c- o=\"\">/</c-><c- mf=\"\">24389</c-><c- p=\"\">;</c->  <c- c1=\"\">// 6^3/29^3</c->\n\t<c- a=\"\">var</c-> κ <c- o=\"\">=</c-> <c- mf=\"\">24389</c-><c- o=\"\">/</c-><c- mf=\"\">27</c-><c- p=\"\">;</c->   <c- c1=\"\">// 29^3/3^3</c->\n\n\t<c- c1=\"\">// compute xyz, which is XYZ scaled relative to reference white</c->\n\t<c- a=\"\">var</c-> xyz <c- o=\"\">=</c-> XYZ<c- p=\"\">.</c->map<c- p=\"\">((</c->value<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> value <c- o=\"\">/</c-> D50<c- p=\"\">[</c->i<c- p=\"\">]);</c->\n\n\t<c- c1=\"\">// now compute f</c->\n\t<c- a=\"\">var</c-> f <c- o=\"\">=</c-> xyz<c- p=\"\">.</c->map<c- p=\"\">(</c->value <c- p=\"\">=&gt;</c-> value <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c-> Math<c- p=\"\">.</c->cbrt<c- p=\"\">(</c->value<c- p=\"\">)</c-> <c- o=\"\">:</c-> <c- p=\"\">(</c->κ <c- o=\"\">*</c-> value <c- o=\"\">+</c-> <c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">);</c->\n\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">(</c-><c- mf=\"\">116</c-> <c- o=\"\">*</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">-</c-> <c- mf=\"\">16</c-><c- p=\"\">,</c-> \t <c- c1=\"\">// L</c->\n\t\t<c- mf=\"\">500</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]),</c-> <c- c1=\"\">// a</c->\n\t\t<c- mf=\"\">200</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">])</c->  <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n\t<c- c1=\"\">// L in range [0,100]. For use in CSS, add a percent</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> Lab_to_XYZ<c- p=\"\">(</c->Lab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Convert Lab to D50-adapted XYZ</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_Lab_to_XYZ.html</c->\n\t<c- a=\"\">var</c-> κ <c- o=\"\">=</c-> <c- mf=\"\">24389</c-><c- o=\"\">/</c-><c- mf=\"\">27</c-><c- p=\"\">;</c->   <c- c1=\"\">// 29^3/3^3</c->\n\t<c- a=\"\">var</c-> ε <c- o=\"\">=</c-> <c- mf=\"\">216</c-><c- o=\"\">/</c-><c- mf=\"\">24389</c-><c- p=\"\">;</c->  <c- c1=\"\">// 6^3/29^3</c->\n\t<c- a=\"\">var</c-> f <c- o=\"\">=</c-> <c- p=\"\">[];</c->\n\n\t<c- c1=\"\">// compute f, starting with the luminance-related term</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> <c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">+</c-> <c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">;</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-><c- o=\"\">/</c-><c- mf=\"\">500</c-> <c- o=\"\">+</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">];</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-><c- o=\"\">/</c-><c- mf=\"\">200</c-><c- p=\"\">;</c->\n\n\t<c- c1=\"\">// compute xyz</c->\n\t<c- a=\"\">var</c-> xyz <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\tMath<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c-> <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c->   Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->            <c- o=\"\">:</c-> <c- p=\"\">(</c-><c- mf=\"\">116</c-><c- o=\"\">*</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">-</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c->κ<c- p=\"\">,</c->\n\t\tLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">&gt;</c-> κ <c- o=\"\">*</c-> ε <c- o=\"\">?</c->         Math<c- p=\"\">.</c->pow<c- p=\"\">((</c->Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">+</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">,</c-><c- mf=\"\">3</c-><c- p=\"\">)</c-> <c- o=\"\">:</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">/</c->κ<c- p=\"\">,</c->\n\t\tMath<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->  <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c->  Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->            <c- o=\"\">:</c-> <c- p=\"\">(</c-><c- mf=\"\">116</c-><c- o=\"\">*</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-><c- o=\"\">-</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c->κ\n\t<c- p=\"\">];</c->\n\n\t<c- c1=\"\">// Compute XYZ by scaling xyz by reference white</c->\n\t<c- k=\"\">return</c-> xyz<c- p=\"\">.</c->map<c- p=\"\">((</c->value<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> value <c- o=\"\">*</c-> D50<c- p=\"\">[</c->i<c- p=\"\">]);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> Lab_to_LCH<c- p=\"\">(</c->Lab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- a=\"\">var</c-> epsilon <c- o=\"\">=</c-> <c- mf=\"\">0.0015</c-><c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> chroma <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">],</c-> <c- mf=\"\">2</c-><c- p=\"\">)</c-> <c- o=\"\">+</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> <c- mf=\"\">2</c-><c- p=\"\">));</c-> <c- c1=\"\">// Chroma</c->\n\t<c- a=\"\">var</c-> hue <c- o=\"\">=</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">*</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->hue <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> hue <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->chroma <c- o=\"\">&lt;=</c-> epsilon<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> <c- kc=\"\">NaN</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tchroma<c- p=\"\">,</c-> <c- c1=\"\">// Chroma</c->\n\t\thue <c- c1=\"\">// Hue, in degrees [0 to 360)</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> LCH_to_Lab<c- p=\"\">(</c->LCH<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Convert from polar form</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->LCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">),</c-> <c- c1=\"\">// a</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->LCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// OKLab and OKLCH</c->\n<c- c1=\"\">// https://bottosson.github.io/posts/oklab/</c->\n\n<c- c1=\"\">// XYZ &lt;-&gt; LMS matrices recalculated for consistent reference white</c->\n<c- c1=\"\">// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484</c->\n<c- c1=\"\">// recalculated for 64bit precision</c->\n<c- c1=\"\">// see https://github.com/color-js/color.js/pull/357</c->\n\n<c- a=\"\">function</c-> XYZ_to_OKLab<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Given XYZ relative to D65, convert to OKLab</c->\n\t<c- a=\"\">var</c-> XYZtoLMS <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.8190224379967030</c-><c- p=\"\">,</c-> <c- mf=\"\">0.3619062600528904</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.1288737815209879</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0329836539323885</c-><c- p=\"\">,</c-> <c- mf=\"\">0.9292868615863434</c-><c- p=\"\">,</c->  <c- mf=\"\">0.0361446663506424</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0481771893596242</c-><c- p=\"\">,</c-> <c- mf=\"\">0.2642395317527308</c-><c- p=\"\">,</c->  <c- mf=\"\">0.6335478284694309</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\t<c- a=\"\">var</c-> LMStoOKLab <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.2104542683093140</c-><c- p=\"\">,</c->  <c- mf=\"\">0.7936177747023054</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0040720430116193</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.9779985324311684</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">2.4285922420485799</c-><c- p=\"\">,</c->  <c- mf=\"\">0.4505937096174110</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0259040424655478</c-><c- p=\"\">,</c->  <c- mf=\"\">0.7827717124575296</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.8086757549230774</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- a=\"\">var</c-> LMS <c- o=\"\">=</c-> multiplyMatrices<c- p=\"\">(</c->XYZtoLMS<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n\t<c- c1=\"\">// JavaScript Math.cbrt returns a sign-matched cube root</c->\n\t<c- c1=\"\">// beware if porting to other languages</c->\n\t<c- c1=\"\">// especially if tempted to use a general power function</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->LMStoOKLab<c- p=\"\">,</c-> LMS<c- p=\"\">.</c->map<c- p=\"\">(</c->c <c- p=\"\">=&gt;</c-> Math<c- p=\"\">.</c->cbrt<c- p=\"\">(</c->c<c- p=\"\">)));</c->\n\t<c- c1=\"\">// L in range [0,1]. For use in CSS, multiply by 100 and add a percent</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLab_to_XYZ<c- p=\"\">(</c->OKLab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Given OKLab, convert to XYZ relative to D65</c->\n\t<c- a=\"\">var</c-> LMStoXYZ <c- o=\"\">=</c->  <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.2268798758459243</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.5578149944602171</c-><c- p=\"\">,</c->  <c- mf=\"\">0.2813910456659647</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0405757452148008</c-><c- p=\"\">,</c->  <c- mf=\"\">1.1122868032803170</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0717110580655164</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0763729366746601</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.4214933324022432</c-><c- p=\"\">,</c->  <c- mf=\"\">1.5869240198367816</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\t<c- a=\"\">var</c-> OKLabtoLMS <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.3963377773761749</c-><c- p=\"\">,</c->  <c- mf=\"\">0.2158037573099136</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.1055613458156586</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0638541728258133</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0894841775298119</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1.2914855480194092</c-> <c- p=\"\">]</c->\n    <c- p=\"\">];</c->\n\n\t<c- a=\"\">var</c-> LMSnl <c- o=\"\">=</c-> multiplyMatrices<c- p=\"\">(</c->OKLabtoLMS<c- p=\"\">,</c-> OKLab<c- p=\"\">);</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->LMStoXYZ<c- p=\"\">,</c-> LMSnl<c- p=\"\">.</c->map<c- p=\"\">(</c->c <c- p=\"\">=&gt;</c-> c <c- o=\"\">**</c-> <c- mf=\"\">3</c-><c- p=\"\">));</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLab_to_OKLCH<c- p=\"\">(</c->OKLab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- a=\"\">var</c-> epsilon <c- o=\"\">=</c-> <c- mf=\"\">0.000004</c-><c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> hue <c- o=\"\">=</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->OKLab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> OKLab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">*</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> chroma <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->OKLab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> OKLab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->hue <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> hue <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->chroma <c- o=\"\">&lt;=</c-> epsilon<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> <c- kc=\"\">NaN</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tOKLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tchroma<c- p=\"\">,</c->\n\t\thue\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLCH_to_OKLab<c- p=\"\">(</c->OKLCH<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->OKLCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">),</c-> <c- c1=\"\">// a</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->OKLCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c->  <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Premultiplied alpha conversions</c->\n\n<c- a=\"\">function</c-> rectangular_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n<c- c1=\"\">// given a color in a rectangular orthogonal colorspace</c->\n<c- c1=\"\">// and an alpha value</c->\n<c- c1=\"\">// return the premultiplied form</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">*</c-> alpha<c- p=\"\">)</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> rectangular_un_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n<c- c1=\"\">// given a premultiplied color in a rectangular orthogonal colorspace</c->\n<c- c1=\"\">// and an alpha value</c->\n<c- c1=\"\">// return the actual color</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->alpha <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- k=\"\">return</c-> color<c- p=\"\">;</c-> <c- c1=\"\">// avoid divide by zero</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">/</c-> alpha<c- p=\"\">)</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> polar_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> hueIndex<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// given a color in a cylindicalpolar colorspace</c->\n\t<c- c1=\"\">// and an alpha value</c->\n\t<c- c1=\"\">// return the premultiplied form.</c->\n\t<c- c1=\"\">// the index says which entry in the color array corresponds to hue angle</c->\n\t<c- c1=\"\">// for example, in OKLCH it would be 2</c->\n\t<c- c1=\"\">// while in HSL it would be 0</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">*</c-> <c- p=\"\">(</c->hueIndex <c- o=\"\">===</c-> i<c- o=\"\">?</c-> <c- mf=\"\">1</c-> <c- o=\"\">:</c-> alpha<c- p=\"\">))</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> polar_un_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> hueIndex<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// given a color in a cylindicalpolar colorspace</c->\n\t<c- c1=\"\">// and an alpha value</c->\n\t<c- c1=\"\">// return the actual color.</c->\n\t<c- c1=\"\">// the hueIndex says which entry in the color array corresponds to hue angle</c->\n\t<c- c1=\"\">// for example, in OKLCH it would be 2</c->\n\t<c- c1=\"\">// while in HSL it would be 0</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->alpha <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- k=\"\">return</c-> color<c- p=\"\">;</c-> <c- c1=\"\">// avoid divide by zero</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">/</c-> <c- p=\"\">(</c->hueIndex <c- o=\"\">===</c-> i<c- o=\"\">?</c-> <c- mf=\"\">1</c-> <c- o=\"\">:</c-> alpha<c- p=\"\">))</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Convenience functions can easily be defined, such as</c->\n<c- a=\"\">function</c-> hsl_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- k=\"\">return</c-> polar_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> <c- mf=\"\">0</c-><c- p=\"\">);</c->\n<c- p=\"\">}</c->\n</pre>\n    <h2 class=\"heading settled\" data-level=\"19\" id=\"color-difference-code\"><span class=\"secno\">19. </span><span class=\"content\">\nSample Code for ΔE2000 and ΔEOK Color Differences</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-code\"></a></h2>\n    <p><em>This section is not normative.</em></p>\n    \n    <h3 class=\"heading settled\" data-level=\"19.1\" id=\"color-difference-2000\"><span class=\"secno\">19.1. </span><span class=\"content\">ΔE2000</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-2000\"></a></h3>\n    <p>\n\tThe simplest color difference metric, ΔE76,\n\tis simply the Euclidean distance in Lab color space.\n\tWhile this is a good first approximation,\n\tcolor-critical industries such as printing and fabric dyeing\n\tsoon developed improved formulae.\n\tCurrently, the most widely used formula\n\tis ΔE2000.\n\tIt corrects a number of known asymmetries and non-linearities\n\tcompared to ΔE76.\n\tBecause the formula is complex,\n\tand critically dependent on the sign\n\tof various intermediate calculations,\n\timplementations are often incorrect <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-sharma\" title=\"The CIEDE2000 Color-Difference Formula: Implementation Notes, Supplementary Test Data, and Mathematical Observations\">[Sharma]</a>.\n</p>\n    <p>\n\tThe sample code below has been\n\t<a href=\"https://colorjs.io/test/?test=delta\">validated</a>\n\tto five significant figures\n\tagainst the test suite of paired Lab values and expected ΔE2000\n\tpublished by <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-sharma\" title=\"The CIEDE2000 Color-Difference Formula: Implementation Notes, Supplementary Test Data, and Mathematical Observations\">[Sharma]</a> and is correct.\n</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// deltaE2000 is a statistically significant improvement</c->\n<c- c1=\"\">// over deltaE76 and deltaE94,</c->\n<c- c1=\"\">// and is recommended by the CIE and Idealliance</c->\n<c- c1=\"\">// especially for color differences less than 10 deltaE76</c->\n<c- c1=\"\">// but is wicked complicated</c->\n<c- c1=\"\">// and many implementations have small errors!</c->\n\n<c- d=\"\">/**</c->\n<c- d=\"\"> * @param {number[]} reference - Array of CIE Lab values: L as 0..100, a and b as around -150..150</c->\n<c- d=\"\"> * @param {number[]} sample - Array of CIE Lab values: L as 0..100, a and b as around -150..150</c->\n<c- d=\"\"> * @return {number} How different a color sample is from reference</c->\n<c- d=\"\"> */</c->\n\n<c- a=\"\">function</c-> deltaE2000 <c- p=\"\">(</c->reference<c- p=\"\">,</c-> sample<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\n    <c- c1=\"\">// Given a reference and a sample color,</c->\n    <c- c1=\"\">// both in CIE Lab,</c->\n    <c- c1=\"\">// calculate deltaE 2000.</c->\n\n    <c- c1=\"\">// This implementation assumes the parametric</c->\n    <c- c1=\"\">// weighting factors kL, kC and kH</c->\n    <c- c1=\"\">// (for the influence of viewing conditions)</c->\n    <c- c1=\"\">// are all 1, as seems typical.</c->\n\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L1<c- p=\"\">,</c-> a1<c- p=\"\">,</c-> b1<c- p=\"\">]</c-> <c- o=\"\">=</c-> reference<c- p=\"\">;</c->\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L2<c- p=\"\">,</c-> a2<c- p=\"\">,</c-> b2<c- p=\"\">]</c-> <c- o=\"\">=</c-> sample<c- p=\"\">;</c->\n    <c- a=\"\">let</c-> C1 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->a1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n    <c- a=\"\">let</c-> C2 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->a2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- a=\"\">let</c-> Cbar <c- o=\"\">=</c-> <c- p=\"\">(</c->C1 <c- o=\"\">+</c-> C2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c-> <c- c1=\"\">// mean Chroma</c->\n\n\t<c- c1=\"\">// calculate a-axis asymmetry factor from mean Chroma</c->\n\t<c- c1=\"\">// this turns JND ellipses for near-neutral colors back into circles</c->\n\t<c- a=\"\">let</c-> C7 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Cbar<c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\t<c- a=\"\">const</c-> Gfactor <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c-><c- mf=\"\">25</c-><c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> G <c- o=\"\">=</c-> <c- mf=\"\">0.5</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">-</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->C7<c- o=\"\">/</c-><c- p=\"\">(</c->C7<c- o=\"\">+</c->Gfactor<c- p=\"\">)));</c->\n\n\t<c- c1=\"\">// scale a axes by asymmetry factor</c->\n\t<c- c1=\"\">// this by the way is why there is no Lab2000 color space</c->\n\t<c- a=\"\">let</c-> adash1 <c- o=\"\">=</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">+</c-> G<c- p=\"\">)</c-> <c- o=\"\">*</c-> a1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> adash2 <c- o=\"\">=</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">+</c-> G<c- p=\"\">)</c-> <c- o=\"\">*</c-> a2<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// calculate new Chroma from scaled a and original b axes</c->\n\t<c- a=\"\">let</c-> Cdash1 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->adash1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> Cdash2 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->adash2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// calculate new hues, with zero hue for true neutrals</c->\n\t<c- c1=\"\">// and in degrees, not radians</c->\n\t<c- a=\"\">const</c-> π <c- o=\"\">=</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- a=\"\">const</c-> r2d <c- o=\"\">=</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> π<c- p=\"\">;</c->\n\t<c- a=\"\">const</c-> d2r <c- o=\"\">=</c-> π <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> h1 <c- o=\"\">=</c-> <c- p=\"\">(</c->adash1 <c- o=\"\">===</c-> <c- mf=\"\">0</c-> <c- o=\"\">&amp;&amp;</c-> b1 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-><c- o=\"\">?</c-> <c- mf=\"\">0</c-><c- o=\"\">:</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->b1<c- p=\"\">,</c-> adash1<c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> h2 <c- o=\"\">=</c-> <c- p=\"\">(</c->adash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-> <c- o=\"\">&amp;&amp;</c-> b2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-><c- o=\"\">?</c-> <c- mf=\"\">0</c-><c- o=\"\">:</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->b2<c- p=\"\">,</c-> adash2<c- p=\"\">);</c->\n\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->h1 <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\th1 <c- o=\"\">+=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> π<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->h2 <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\th2 <c- o=\"\">+=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> π<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\n\th1 <c- o=\"\">*=</c-> r2d<c- p=\"\">;</c->\n\th2 <c- o=\"\">*=</c-> r2d<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Lightness and Chroma differences; sign matters</c->\n\t<c- a=\"\">let</c-> ΔL <c- o=\"\">=</c-> L2 <c- o=\"\">-</c-> L1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> ΔC <c- o=\"\">=</c-> Cdash2 <c- o=\"\">-</c-> Cdash1<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Hue difference, taking care to get the sign correct</c->\n\t<c- a=\"\">let</c-> hdiff <c- o=\"\">=</c-> h2 <c- o=\"\">-</c-> h1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> hsum <c- o=\"\">=</c-> h1 <c- o=\"\">+</c-> h2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> habs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->hdiff<c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> Δh<c- p=\"\">;</c->\n\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">*</c-> Cdash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> <c- mf=\"\">0</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->habs <c- o=\"\">&lt;=</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hdiff <c- o=\"\">&gt;</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff <c- o=\"\">-</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hdiff <c- o=\"\">&lt;</c-> <c- o=\"\">-</c-><c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- p=\"\">{</c->\n\t\tconsole<c- p=\"\">.</c->log<c- p=\"\">(</c-><c- u=\"\">\"the unthinkable has happened\"</c-><c- p=\"\">);</c->\n\t<c- p=\"\">}</c->\n\n\t<c- c1=\"\">// weighted Hue difference, more for larger Chroma</c->\n\t<c- a=\"\">let</c-> ΔH <c- o=\"\">=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Cdash2 <c- o=\"\">*</c-> Cdash1<c- p=\"\">)</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->Δh <c- o=\"\">*</c-> d2r <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// calculate mean Lightness and Chroma</c->\n\t<c- a=\"\">let</c-> Ldash <c- o=\"\">=</c-> <c- p=\"\">(</c->L1 <c- o=\"\">+</c-> L2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Cdash <c- o=\"\">=</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">+</c-> Cdash2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Cdash7 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Cdash<c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// Compensate for non-linearity in the blue region of Lab.</c->\n\t<c- c1=\"\">// Four possibilities for hue weighting factor,</c->\n\t<c- c1=\"\">// depending on the angles, to get the correct sign</c->\n\t<c- a=\"\">let</c-> hdash<c- p=\"\">;</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">*</c-> Cdash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> hsum<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->habs <c- o=\"\">&lt;=</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> hsum <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hsum <c- o=\"\">&lt;</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> <c- p=\"\">(</c->hsum <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> <c- p=\"\">(</c->hsum <c- o=\"\">-</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\n\t<c- c1=\"\">// positional corrections to the lack of uniformity of CIELAB</c->\n\t<c- c1=\"\">// These are all trying to make JND ellipsoids more like spheres</c->\n\n\t<c- c1=\"\">// SL Lightness crispening factor</c->\n\t<c- c1=\"\">// a background with L=50 is assumed</c->\n\t<c- a=\"\">let</c-> lsq <c- o=\"\">=</c-> <c- p=\"\">(</c->Ldash <c- o=\"\">-</c-> <c- mf=\"\">50</c-><c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> SL <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- p=\"\">((</c-><c- mf=\"\">0.015</c-> <c- o=\"\">*</c-> lsq<c- p=\"\">)</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c-><c- mf=\"\">20</c-> <c- o=\"\">+</c-> lsq<c- p=\"\">));</c->\n\n\t<c- c1=\"\">// SC Chroma factor, similar to those in CMC and deltaE 94 formulae</c->\n\t<c- a=\"\">let</c-> SC <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- mf=\"\">0.045</c-> <c- o=\"\">*</c-> Cdash<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Cross term T for blue non-linearity</c->\n\t<c- a=\"\">let</c-> T <c- o=\"\">=</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\tT <c- o=\"\">-=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.17</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">((</c->     hdash <c- o=\"\">-</c-> <c- mf=\"\">30</c-><c- p=\"\">)</c->  <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">+=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.24</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->  <c- mf=\"\">2</c-> <c- o=\"\">*</c-> hdash        <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">+=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.32</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(((</c-><c- mf=\"\">3</c-> <c- o=\"\">*</c-> hdash<c- p=\"\">)</c-> <c- o=\"\">+</c-> <c- mf=\"\">6</c-><c- p=\"\">)</c->  <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">-=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.20</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(((</c-><c- mf=\"\">4</c-> <c- o=\"\">*</c-> hdash<c- p=\"\">)</c-> <c- o=\"\">-</c-> <c- mf=\"\">63</c-><c- p=\"\">)</c-> <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\n\t<c- c1=\"\">// SH Hue factor depends on Chroma,</c->\n\t<c- c1=\"\">// as well as adjusted hue angle like deltaE94.</c->\n\t<c- a=\"\">let</c-> SH <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- mf=\"\">0.015</c-> <c- o=\"\">*</c-> Cdash <c- o=\"\">*</c-> T<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// RT Hue rotation term compensates for rotation of JND ellipses</c->\n\t<c- c1=\"\">// and Munsell constant hue lines</c->\n\t<c- c1=\"\">// in the medium-high Chroma blue region</c->\n\t<c- c1=\"\">// (Hue 225 to 315)</c->\n\t<c- a=\"\">let</c-> Δθ <c- o=\"\">=</c-> <c- mf=\"\">30</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->exp<c- p=\"\">(</c-><c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">*</c-> <c- p=\"\">(((</c->hdash <c- o=\"\">-</c-> <c- mf=\"\">275</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">25</c-><c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">));</c->\n\t<c- a=\"\">let</c-> RC <c- o=\"\">=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Cdash7<c- o=\"\">/</c-><c- p=\"\">(</c->Cdash7 <c- o=\"\">+</c-> Gfactor<c- p=\"\">));</c->\n\t<c- a=\"\">let</c-> RT <c- o=\"\">=</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c-><c- mf=\"\">2</c-> <c- o=\"\">*</c-> Δθ <c- o=\"\">*</c-> d2r<c- p=\"\">)</c-> <c- o=\"\">*</c-> RC<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Finally calculate the deltaE, term by term as root sum of squares</c->\n\t<c- a=\"\">let</c-> dE <c- o=\"\">=</c-> <c- p=\"\">(</c->ΔL <c- o=\"\">/</c-> SL<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> <c- p=\"\">(</c->ΔC <c- o=\"\">/</c-> SC<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> <c- p=\"\">(</c->ΔH <c- o=\"\">/</c-> SH<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> RT <c- o=\"\">*</c-> <c- p=\"\">(</c->ΔC <c- o=\"\">/</c-> SC<c- p=\"\">)</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->ΔH <c- o=\"\">/</c-> SH<c- p=\"\">);</c->\n\t<c- k=\"\">return</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->dE<c- p=\"\">);</c->\n\t<c- c1=\"\">// Yay!!!</c->\n<c- p=\"\">};</c-></pre>\n    <h3 class=\"heading settled\" data-level=\"19.2\" id=\"color-difference-OK\"><span class=\"secno\">19.2. </span><span class=\"content\">ΔEOK</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-OK\"></a></h3>\n    <p>\n\tBecause Oklab does not suffer from\n\tthe hue linearity, hue uniformity,\n\tand chroma non-linearities of CIE Lab,\n\tthe color difference metric does not need to correct for them\n\tand so\n\tis simply the Euclidean distance in Oklab color space.\n</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// Calculate deltaE OK</c->\n<c- c1=\"\">// simple root sum of squares</c->\n<c- d=\"\">/**</c->\n<c- d=\"\"> * @param {number[]} reference - Array of OKLab values: L as 0..1, a and b as -1..1</c->\n<c- d=\"\"> * @param {number[]} sample - Array of OKLab values: L as 0..1, a and b as -1..1</c->\n<c- d=\"\"> * @return {number} How different a color sample is from reference</c->\n<c- d=\"\"> */</c->\n<c- a=\"\">function</c-> deltaEOK <c- p=\"\">(</c->reference<c- p=\"\">,</c-> sample<c- p=\"\">)</c-> <c- p=\"\">{</c->\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L1<c- p=\"\">,</c-> a1<c- p=\"\">,</c-> b1<c- p=\"\">]</c-> <c- o=\"\">=</c-> reference<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> <c- p=\"\">[</c->L2<c- p=\"\">,</c-> a2<c- p=\"\">,</c-> b2<c- p=\"\">]</c-> <c- o=\"\">=</c-> sample<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> ΔL <c- o=\"\">=</c-> L1 <c- o=\"\">-</c-> L2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Δa <c- o=\"\">=</c-> a1 <c- o=\"\">-</c-> a2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Δb <c- o=\"\">=</c-> b1 <c- o=\"\">-</c-> b2<c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->ΔL <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> Δa <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> Δb <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n<c- p=\"\">}</c-></pre>\n    <h2 class=\"heading no-num settled\" id=\"deprecated-system-colors\"><span class=\"content\">\nAppendix A: Deprecated CSS System Colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\"></a></h2>\n    <p>Earlier versions of CSS defined several additional <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑥\">system colors</a>.\n\tThese color keywords have been <strong>deprecated</strong>, however,\n\tas they are insufficient for their original purpose\n\t(making website elements look like their native OS counterparts),\n\trepresent a security risk\n\tby making it easier for a webpage to “spoof” a native OS dialog,\n\tand increase fingerprinting surface, compromising user privacy.</p>\n    <p>User agents must support these keywords,\n\tand to mitigate fingerprinting\n\tmust map them to the (undeprecated) <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑦\">system colors</a>\n\tas listed below.\n\t<strong>Authors must not use these keywords.</strong></p>\n    <p>The deprecated system colors are represented\n\tas the <dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-type=\"type\" data-export=\"\" id=\"typedef-deprecated-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color②\">&lt;deprecated-color&gt;</a></dfn> sub-type,\n\tand are defined as:</p>\n    <dl>\n     <dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-activeborder\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ActiveBorder</dfn>\n\t\t\n     </dt><dd>Active window border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder②\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-activecaption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ActiveCaption</dfn>\n\t\t\n     </dt><dd>Active window caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑤\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-appworkspace\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">AppWorkspace</dfn>\n\t\t\n     </dt><dd>Background color of multiple document interface. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑥\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-background\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Background</dfn>\n\t\t\n     </dt><dd>Desktop background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑦\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-buttonhighlight\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ButtonHighlight</dfn>\n\t\t\n     </dt><dd>The color of the border facing the light source for 3-D elements\n\t\tthat appear 3-D due to one layer of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface②\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-buttonshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ButtonShadow</dfn>\n\t\t\n     </dt><dd>The color of the border away from the light source for 3-D elements\n\t\tthat appear 3-D due to one layer of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface③\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-captiontext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CaptionText</dfn>\n\t\t\n     </dt><dd>Text in caption, size box, and scrollbar arrow box. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext①\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactiveborder\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveBorder</dfn>\n\t\t\n     </dt><dd>Inactive window border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder③\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactivecaption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveCaption</dfn>\n\t\t\n     </dt><dd>Inactive window caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑧\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactivecaptiontext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveCaptionText</dfn>\n\t\t\n     </dt><dd>Color of text in an inactive caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-graytext\" id=\"ref-for-valdef-color-graytext①\">GrayText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-infobackground\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InfoBackground</dfn>\n\t\t\n     </dt><dd>Background color for tooltip controls. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑨\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-infotext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InfoText</dfn>\n\t\t\n     </dt><dd>Text color for tooltip controls. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext②\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-menu\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Menu</dfn>\n\t\t\n     </dt><dd>Menu background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①⓪\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-menutext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">MenuText</dfn>\n\t\t\n     </dt><dd>Text in menus. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext③\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-scrollbar\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Scrollbar</dfn>\n\t\t\n     </dt><dd>Scroll bar gray area. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①①\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threeddarkshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDDarkShadow</dfn>\n\t\t\n     </dt><dd>The color of the darker (generally outer) of the two borders away\n\t\tfrom the light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder④\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedface\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDFace</dfn>\n\t\t\n     </dt><dd>The face background color for 3-D elements that appear 3-D due to\n\t\ttwo concentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface④\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedhighlight\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDHighlight</dfn>\n\t\t\n     </dt><dd>The color of the lighter (generally outer) of the two borders facing\n\t\tthe light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑤\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedlightshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDLightShadow</dfn>\n\t\t\n     </dt><dd>The color of the darker (generally inner) of the two borders facing\n\t\tthe light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑥\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDShadow</dfn>\n\t\t\n     </dt><dd>The color of the lighter (generally inner) of the two borders away\n\t\tfrom the light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑦\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-window\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Window</dfn>\n\t\t\n     </dt><dd>Window background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①②\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-windowframe\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WindowFrame</dfn>\n\t\t\n     </dt><dd>Window frame. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑧\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-windowtext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WindowText</dfn>\n\t\t\n     </dt><dd>Text in windows. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext④\">CanvasText</a>.\n\t\n    </dd></dl>\n    \n    <h2 class=\"heading no-num settled\" id=\"quirky-color\"><span class=\"content\">\nAppendix B: Deprecated Quirky Hex Colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#quirky-color\"></a></h2>\n    <p>When CSS is being parsed in <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-quirks\" id=\"ref-for-concept-document-quirks\">quirks mode</a>,\n\t<dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-type=\"type\" data-export=\"\" id=\"typedef-quirky-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color\">&lt;quirky-color&gt;</a></dfn> is a type of <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑤\">&lt;color&gt;</a>\n\tthat is only valid in certain properties:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-background-color\" id=\"ref-for-propdef-background-color\">background-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-color\" id=\"ref-for-propdef-border-color①\">border-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-top-color\" id=\"ref-for-propdef-border-top-color\">border-top-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-right-color\" id=\"ref-for-propdef-border-right-color\">border-right-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-bottom-color\" id=\"ref-for-propdef-border-bottom-color\">border-bottom-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-left-color\" id=\"ref-for-propdef-border-left-color\">border-left-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-4/#propdef-color\" id=\"ref-for-propdef-color⑧\">color</a></p>\n    </li></ul>\n    <p>It is <em>not</em> valid in properties that include or reference these properties,\n\tsuch as the <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-background\" id=\"ref-for-propdef-background\">background</a> shorthand,\n\tor inside <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#functional-notation\" id=\"ref-for-functional-notation①\">functional notations</a>\n\t</p>\n    <p>Additionally, while <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color①\">&lt;quirky-color&gt;</a> must be valid as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑥\">&lt;color&gt;</a>\n\twhen parsing the affected properties in the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-conditional-3/#at-ruledef-supports\" id=\"ref-for-at-ruledef-supports\">@supports</a> rule,\n\tit is <em>not</em> valid for those properties\n\twhen used in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-conditional-3/#dom-css-supports-conditiontext\" id=\"ref-for-dom-css-supports-conditiontext\">CSS.supports()</a></code> method.</p>\n    <p>A <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color②\">&lt;quirky-color&gt;</a> can be represented\n\tas a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-number-token\" id=\"ref-for-typedef-number-token\">&lt;number-token&gt;</a>, <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-dimension-token\" id=\"ref-for-typedef-dimension-token\">&lt;dimension-token&gt;</a>, or <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-ident-token\" id=\"ref-for-typedef-ident-token\">&lt;ident-token&gt;</a>,\n\taccording to the following rules:</p>\n    <ul>\n     <li data-md=\"\">\n      <p>If it’s an <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-ident-token\" id=\"ref-for-typedef-ident-token①\">&lt;ident-token&gt;</a>,\nthe token’s representation must contain exactly 3 or 6 characters,\nall hexadecimal digits.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color①\">&lt;hex-color&gt;</a> with the same value.</p>\n     </li><li data-md=\"\">\n      <p>If it’s a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-number-token\" id=\"ref-for-typedef-number-token①\">&lt;number-token&gt;</a>,\nit must have its integer flag set.</p>\n      <p>Serialize the integer’s value.\nIf the serialization has less than 6 characters,\nprepend \"0\" characters to it until it is 6 characters long.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color②\">&lt;hex-color&gt;</a> with the same value.</p>\n     </li><li data-md=\"\">\n      <p>If it’s a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-dimension-token\" id=\"ref-for-typedef-dimension-token①\">&lt;dimension-token&gt;</a>,\nit must have its integer flag set.</p>\n      <p>Serialize the integer’s value,\nand append the representation of the token’s unit.\nIf the result has less than 6 characters,\nprepend \"0\" characters to it until it is 6 characters long.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color③\">&lt;hex-color&gt;</a> with the same value.</p>\n    </li></ul>\n    <p>(In other words, Quirks Mode allows hex colors to be written without the leading \"#\",\n\tbut with weird parsing rules.)</p>\n    \n    <h2 class=\"heading no-num no-ref settled\" id=\"acknowledgments\"><span class=\"content\">\nAcknowledgments</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#acknowledgments\"></a></h2>\n    <p>In addition to <a href=\"https://www.w3.org/TR/css-color-3/#acknowledgments\">those\nwho contributed to CSS Color 3</a>, the editors would like to thank\nEmilio Cobos Álvarez, Alexey Ardov, Chris Bai, Amelia Bellamy-Royds, Lars Borg, Mike Bremford, Andreu Botella, Dan Burzo, Max Derhak, fantasai, Simon Fraser, Devon Govett, Phil Green, Dean Jackson, Andreas Kraushaar, Pierre-Anthony Lemieux, Tiaan Louw, Cameron McCormack, Romain Menke, Chris Murphy, Isaac Muse, Jonathan Neal, Chris Needham, Björn Ottosson, Christoph Päper, Brad Pettit, Xidorn Quan, Craig Revie, Melanie Richards, Florian Rivoal, Jacob Rus, Joseph Salowey, Simon Sapin, Igor Snitkin, Lea Verou, Mark Watson, James Stuckey Weber, Sam Weinig, and Natalie Weizenbaum.</p>\n    <h2 class=\"heading no-num settled\" id=\"changes\"><span class=\"content\">\nChanges</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes\"></a></h2>\n    <h3 class=\"heading settled\" id=\"changes-from-20250424\"><span class=\"content\">Changes since the \n\t<a href=\"https://www.w3.org/TR/2025/CRD-css-color-4-20250424/\">Candidate Recommendation Draft of 24 April 2025</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20250424\"></a></h3>\n    <ul>\n     <li>Updated <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-accentcolor\" id=\"ref-for-valdef-color-accentcolor③\">AccentColor</a> to take its value from <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-ui-4/#propdef-accent-color\" id=\"ref-for-propdef-accent-color①\">accent-color</a>, unless in <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-adjust-1/#forced-colors-mode\" id=\"ref-for-forced-colors-mode②\">Forced Colors Mode</a>\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/5900\">Issue 5900</a>)\n\t\n     </li><li>Defined rec2020 color space to use display-referred, 2.4 gamma\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/12574\">Issue 12574</a>)\n\t\n     </li><li>Added display-p3-linear to predefined colorspaces\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/11250\">Issue 11250</a>)\n\t\n     </li><li>Clarified serializing opacity values with calc() \n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/10426\">Issue 10426</a>)\n\t\n     </li><li>Interpolation between legacy sRGB colors is (once again) in sRGB space, for compatibility\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/7949\">Issue 7949</a>)\n\t\n     </li><li>Clarified real-world CIE Lab range for a and b \n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/12208\">Issue 12208</a>)\n\t\n     </li><li>Clarified that Opacity value does not affect hit testing\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/11339\">Issue 11339</a>)\n\t\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20240213\"><span class=\"content\">Changes since the <a href=\"https://www.w3.org/TR/2024/CRD-css-color-4-20240213/\">Candidate Recommendation Draft of 13 Feb 2024</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20240213\"></a></h3>\n    <ul>\n     <li>Clarified that inside the color property, it is the resolved inherited value (not the raw inherited value) that is used\n     </li><li>Listed categories of colors, such as those that resolve to sRGB or support legacy color syntax\n     </li><li>Added hue normalization examples\n     </li><li>Corrected table of analogous components, alpha was missing, but described as analogous in prose\n     </li><li>Collected together and clarified serialization of opacity values into one section\n     </li><li>Clarified wording around color-interpolation-method and host syntax\n     </li><li>Defined epsilon for returning missing hue\n     </li><li>Used a more precise definition of achromatic colors with missing hues (sufficiently close to the central axis)\n     </li><li>Consistently use \"color component\" rather than \"color channel\" (both were being used).\n     </li><li>Correlated Color Temperature was used without being defined or explained. Added informative reference.\n     </li><li>Exported term premultiplied, linked to it consistently\n     </li><li>Equivalence of deprecated and un-deprecated system colors is no longer at-risk\n     </li><li>Clarified intended use of the \"parse a CSS <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑦\">&lt;color&gt;</a>\" algorithm\n     </li><li>Added corrected examples for HTML-compatible serialization\n     </li><li>Removed check on missing values for HTML-compatible serialization, they will already have been converted to zero\n     </li><li>Moved note about missing values becoming 0, so it applies to both HTML-compatible and CSS serializations\n     </li><li>Added an HTML-Compatible hex serialization for sRGB\n     </li><li>Added another  xyz-d65 and xyz-d50 example\n     </li><li>Clarify which component (Y) in XYZ corresponds to brightness\n     </li><li>Clarified that CSS gamut mapping applies on actual, not used, values\n     </li><li>Removed hue normalization from the hslToRgb sample code, as the input is already normalized at parse time\n     </li><li>Corrected the pseudo-code for step 4 of the gamut mapping algorithm\n     </li><li>Clarified that interpolation is the most common situation which combines two colors, but not the only one. \n     </li><li>Ensured adequate contrast for text in the deltaE table\n     </li><li>Removed remaining use of the term &lt;absolute-color-function&gt;, use &lt;absolute-color&gt; function instead for consistency\n     </li><li>Updated acknowledgements section\n     </li><li>Added gamut mesh diagram\n     </li><li>Described CSSOM serialization in terms of declared values rather than specified values\n     </li><li>Added exported definition of luminance\n     </li><li>Added production rule for &lt;opacity-value&gt; \n     </li><li>Clarified when results from hslToRgb will be in [0,1]\n     </li><li>Clarified that once linearized, RGB spaces are additive\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20221101\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/CRD-css-color-4-20221101/\">Candidate Recommendation Draft of 1 November 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20221101\"></a></h3>\n    <ul>\n     <li>Added steps for serializing a uint8_t alpha, moved from cssom-1\n     </li><li>Restored parse-time clamping of HSL negative saturation to 0, which is current interop behavior from CSS Color 3\n     </li><li>When interpolating, always convert color space, so that powerless components become missing\n     </li><li>Clarified when alpha 1 is omitted from serialization\n     </li><li>Removed redundant constraining of hue angles to [0,360] as this is already done.\n     </li><li>Corrected description of ActiveCaption, which is a background. \n     </li><li>Disambiguated opacity and alpha. Opacity property now uses opacity-value (which has different clamping behavior to alpha-value)\n     </li><li>Clarified that carrying forward happens before premultiplication\n     </li><li>Updated gamut mapping algorithm\n     </li><li>Fixed a few issues regarding hue interpolation \n     </li><li>Clarified that HWB white or black at 100% is insufficient criterion for an achromatic color; it is the sum which matters.\n     </li><li>Avoid returning negative saturation in rgb to hsl conversion; adjust the hue to point to \"the other side\" instead\n     </li><li>Use 64 bit accurate matrices for ProPhoto, which does not have a rational form\n     </li><li>Oklab matrices recalculated for 64bit precision (returns same results as before, at 32 bit precision)\n     </li><li>Consistently return output of GMA in the destination color space, even if no mapping is performed because the destination is unbounded\n     </li><li>Added explanation for why one JND for Oklab is 0.02, not 2 \n     </li><li>Clarified that resolving sRGB values does not apply to the color() function\n     </li><li>Moved alpha value definition up to the opacity property, clarified that opacity specified values are not clamped.\n     </li><li>System Colors now explicitly permit spoofing, to preserve privacy\n     </li><li>Corrected the inverse chromatic adaptation matrix for D50 to D65 \n     </li><li>Consistently distinguish linear Bradfrod from the original, more complicated, Bradford chromatic adaptation algorithm\n     </li><li>In the gamut mapping algorithm, return clipped as the gamut mapped result, avoiding un-necessary steps\n     </li><li>Updated chromatic adaptation matrices to higher precision\n     </li><li>Added Add 'parse a css color' algorithm, so non-CSS specs using colors don’t have to reinvent the machinery here.\n     </li><li>Clarified that geometric gamut mapping must not project chroma back beyond the original color\n     </li><li>Use the term \"geometric\" rather than \"analytical\" in gamut mapping discussion\n     </li><li>Aligned prose for HSL into line with the grammar (percent and number both allowed)\n     </li><li>Fixed an LCH alpha interpolation example, which was erroneously un-premultiplying the hue angle\n     </li><li>Corrected the sRGB and display-p3 transfer function. (This only affected the result if a component had the exact value 10.31475 / 255, which is not possible at 8 or 10 bits per component)\n     </li><li>Clarified that the specified values of system colors are still themselves\n     </li><li>Added mention of PNG cICP chunk for tagging images\n     </li><li>Described behaviour of hue increasing and decreasing when 0/360 is passed \n     </li><li>Aligned description of powerlessnes in HSL with the other polar color models\n     </li><li>Explicitly defined order of operations for color interpolation\n     </li><li>Added mention of degenerate numeric constants in calc()\n     </li><li>Clarified that calc() in sRGB has early resolution, and clamps the result\n     </li><li>Clarified that HWB hue has the same disadvantages as HSL hue\n     </li><li>Added luminance to lightness comparison and figure\n     </li><li>Added descriptions and examples for hue interpolation keywords\n     </li><li>Use normative prose for achromatic HWB colors\n     </li><li>Corrected hue interpolation angle range; [0,360) not [0,360]\n     </li><li>Expressed that displaying as black or white when L=0% or 100% is due to gamut mapping. Removed incorrect assertions of powerlessness\n     </li><li>Dropped the confusing \"representing black\" and \"representing white\" comments\n     </li><li>Clarified that opponent a and b are analogous\n     </li><li>Specified RGB components using reference ranges rather than prose, for consistency\n     </li><li>Explicitly referenced percent reference ranges for percentage to number conversion when serializing Lab, LCH, Oklab, OkLCh\n     </li><li>Required Oklab interpolation, remove previous \"may\", describe explicit opt-out\n     </li><li>Labelled the Lab, LCH, Oklab and OkLCh tutorial sections as non-normative. Moved some definitions out of the non-normative section.\n     </li><li>Clarified that, when interpolating, checking for analogous components happens before color space conversion\n     </li><li>Back-ported hwb() syntax changes and reference ranges from CSS Color 5\n     </li><li>Defined carry-forward operations must happen before powerless operations\n     </li><li>Clarified it is <em>color</em> components which must be all-number or all-percentage, in legacy rgb() syntax\n     </li><li>Clarified for legacy syntax that color components must be all-percentage or all-number\n     </li><li>Added examples of specified out of range alpha, with and without calc()\n     </li><li>Placed examples of serializing with trimmed trailing zeroes colorer to the relevant text\n     </li><li>clarified example, used value of text-shadow\n     </li><li>Clarified resolving currentColor\n     </li><li>Updated acknowledgments\n     </li><li>Stop claiming that achromatic colors have missing a,b, or chroma\n     </li><li>HSL and HWB changed to unbounded gamut, to promote round-tripping\n     </li><li>Defined percentage reference range for HSL\n     </li><li>Modern color syntax hsl() and hsla() allow mixed number and percentage components\n     </li><li>Modern color syntax rgb() and rgba() allow mixed number and percentage components\n     </li><li>Define the term \"modern color syntax\" (legacy color syntax already defined).\n     </li><li>Consistently use the term \"analogous components\"\n     </li><li>Changed to allow all predefined color spaces for interpolation\n     </li><li>Clarified that for color(), three parameters (RGB or XYZ) are required\n     </li><li>Clarified serialization of named colors, system colors, and transparent\n     </li><li>Define specified value for Lab, LCH, Oklab, OkLCh\n     </li><li>Define specified value for other sRGB colors\n     </li><li>Define specified values for named and system colors\n     </li><li>Clamp alpha, Lightness, Chroma and Hue at parsed-value time\n     </li><li>Remove passing mention of specular white and CIE Lightness\n     </li><li>No longer require as-specified Hue to be retained; clamp to [0, 360]\n     </li><li>Consistent serialization of Lightness and number in examples\n     </li><li>Minor typos and editorial clarifications\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220705\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/CR-css-color-4-20220705/\">Candidate Recommendation of 5 July 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220705\"></a></h3>\n    <ul>\n     <li>Removed hue interpolation \"specified\" value\n     </li><li>Defined hue interpolation angle more precisely, maintaining differences of 360deg\n     </li><li>Added example of carried forward alpha for premultiplication\n     </li><li>Clarified a,b and C,h powerless at L=100% representing white.\n     </li><li>Removed handwavy mention of L=400 which applies to hdr-CIELAB not CIE Lab\n     </li><li>Consistent capitalization of Oklab and OkLCh\n     </li><li>Moved definitions of valid color, invalid color, out of gamut and in gamut to terminology section\n     </li><li>Fixed definition of \"longer\" hue interpolation\n     </li><li>Further clarified the concept of a host syntax\n     </li><li>Accessibility improvements for color swatches\n     </li><li>Made explicit that legacy forms do not support \"none\"\n     </li><li>Remove \"none\" from the hue production, as it is not allowed in legacy syntax\n     </li><li>Removed some dangling references to CMYK and CMYKOGV, moved to CSS Color5\n     </li><li>Clarified how missing values in colors to be interpolated are carried forward\n     </li><li>Updated syntax of xyz-params so they take numbers and percentage, to align with prose\n     </li><li>Ensure all examples and figures have IDs, self-links\n     </li><li>Clarified importance to implementors of reading the gamut mapping introduction\n     </li><li>Removed left-over mention of custom color spaces (feature was moved to CSS Color 5)\n     </li><li>Refactor syntax of &lt;color&gt; and &lt;alpha-value&gt;\n     </li><li>Editorial refactoring for better reading order.\n     </li><li>Updated pseudocode for gamut mapping algorithm, remove un-needed deltaE calls\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220628\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/WD-css-color-4-20220628/\">Working Draft of 28 June 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220628\"></a></h3>\n    <ul>\n     <li>Updated status for Candidate Recommendation\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220428\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/WD-css-color-4-20220428/\">Working Draft of 28 April 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220428\"></a></h3>\n    <ul>\n     <li>Moved opacity property up to the top of the module, next to color property, before getting into details.\n     </li><li>Improved description of the color property, in particular effect on other properties\n     </li><li>Corrected longer hue adjust equation, for equal-modulo-360 colors\n     </li><li>Added two new System colors: AccentColor and AccentColorText\n\t\n     </li><li>Described overall color space conversion steps in new section\n     </li><li>Accounted for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①③\">none</a> alpha in premultiplication and un-premultiplication\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20211215\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2021/WD-css-color-4-20211215/\">Working Draft of 15 December 2021</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20211215\"></a></h3>\n    <ul>\n     <li>Made system colors fully resolve, but forbid their alteration in forced colors mode\n     </li><li>Removed forgiveness for incorrect number of parameters in color() function\n     </li><li>Changed serialization of CIE Lightness and OK Lightness to number rather than percentage.\n     </li><li>Marked deprecated system color equivalences as at-risk\n     </li><li>Added reference ranges to percentage values for CIE and OK L,a,b,C\n     </li><li>Noted that there is sample code for performing and undoing premultiplication, for both rectangular and polar color spaces.\n     </li><li>Added out of range clamping to the gamut mapping prose, as well as the pseudocode\n     </li><li>Added normative reference for ProPhoto RGB / ROMM\n     </li><li>Corrected sRGB and Display P3 black point value for reference surround\n     </li><li>Added normative reference for Display P3\n     </li><li>Avoided an infinite loop in gamut reduction, with colors whiter than white or darker than black\n     </li><li>Clarified serialization of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①④\">none</a> value\n     </li><li>Clarified the opt-in to interpolation in Oklab, for non-legacy colors\n     </li><li>Defined how premultiplication works, with the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑤\">none</a> value\n     </li><li>Clarified that missing values in rgb serialize as 0\n     </li><li>Clarified the use of calc() with the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑥\">none</a> value\n     </li><li>Typo, inconsistent casing on System Colors\n     </li><li>Added example of SelectedItem with SelectedItemText\n     </li><li>Explicitly noted the presence or absence of legacy colors\n     </li><li>Added normative reference for CIE XYZ\n     </li><li>Added normative reference for HWB and HSL\n     </li><li>Clarified that <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①②\">hwb()</a> is not a legacy syntax so does not support the older, comma-separated syntactic form\n     </li><li>Clarified that only legacy colors will gamut map, the others are unbounded\n     </li><li>Use distinct terms, spectrophotometer and spectroradiometer\n     </li><li>Assorted minor typos fixed, and grammatical improvements\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20210601\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2021/WD-css-color-4-20210601/\">Working Draft of 1 June 2021</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20210601\"></a></h3>\n    <ul>\n     <li>Added gamut mapping section and defined a CSS gamut mapping algorithm as chroma reduction in OkLCh with local MINDE.\n     </li><li>Computed value of color(xyz ...) is color(xyz-d65 ...)\n     </li><li>Added srgb-linear to interpolation color spaces\n     </li><li>Updated Changes from Colors 3 section\n     </li><li>Added Resolving Oklab and OkLCh values section\n     </li><li>Added srgb-linear color space\n     </li><li>Moved @color-profile and device-cmyk to level 5 per CSSWG resolution\n     </li><li>Defined interpolation color space\n     </li><li>Clarified that matrices are row-major and linked to the matrix multiplication library\n     </li><li>Split old Security &amp; Privacy section into separate sections\n     </li><li>Defined quirks-mode quirky hex colors\n     </li><li>Removed fallback colors from device-cmyk\n     </li><li>Host syntax that does not declare a default now uses Oklab by default\n     </li><li>Added sample code for deltaE OK\n     </li><li>Added sample conversion code for OKlab and OkLCh\n     </li><li>Added oklab() and oklch() functions\n     \n\t<i>Added description of Oklab and OkLCh</i>\n\t\n     </li><li>Added description of CIE LCH deficiencies\n     </li><li>Allowed all components of a color to be \"missing\" via the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑦\">none</a> keyword,\n\t\tdefined when components are \"powerless\" and automatically become missing in some cases,\n\t\tand fixed all references to \"NaN\" components to use the \"missing\" concept.\n     </li><li>Defined explicit x,y whitepoint values, use consistently throughout\n     </li><li>Defined the term host syntax\n     </li><li>Defined context for resolving override-color colors\n     </li><li>Added a new pair of system colors\n     </li><li>Corrected HSL and HWB sample code\n     </li><li>Replaced table of HSL values with error-free version\n     </li><li>Added Lea Verou as co-editor by WG resolution\n     </li><li>Clarified that hue angle is unbounded\n     </li><li>MarkText example corrected\n     </li><li>Added diagrams, corrected examples\n     </li><li>Some editorial clarifications\n     </li><li>Minor typos corrected, markup corrections\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20201112\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2020/WD-css-color-4-20201112/\">Working Draft of 12 November 2020</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20201112\"></a></h3>\n    <ul>\n     <li>Noted indeterminate hue ssue on near-neutral Lab values converted to LCH\n     </li><li>Clarified which steps are linear combinations in RGB Lab interconversion\n     </li><li>Added components descriptor to @color-profile, for use in CSS Color 5\n     </li><li>All predefined RGB color spaces are defined over the extended range\n     </li><li>Clarified that there is no gamut mapping or gamut clipping step prior to color interpolation\n     </li><li>Clarified interpolation of legacy sRGB syntaxes\n     </li><li>Removed the lab option from <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①③\">color()</a>\n     </li><li>List steps to interconvert between predefined color spaces\n     </li><li>Consistent use of the term color space (two words)\n     </li><li>Provided more guidance on selecting color space for mixing \n     </li><li>Recalculated an example to increase precision\n     </li><li>Added hue interpolation example\n     </li><li>Simplified <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①④\">color()</a> syntax by removing the fallback options\n     </li><li>Clarified the types of ICC profile that may be linked from @color-profile\n     </li><li>Support for the rare ICC Named Colors was removed\n     </li><li>Improved precision of standard whitepoint chromaticities\n     </li><li>Removed a trademark from description of one predefined color space\n     </li><li>Rephrased interpolation to be more generic wrt to interpolation space\n     </li><li>Corrected Accessibility Considerations section\n     </li><li>Clarified that the color space argument for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑤\">color()</a> is mandatory, even for sRGB\n     </li><li>Clarified that currentColor is not restricted to sRGB\n     </li><li>Small correction to the sRGB to XYZ to sRGB matrices, improve round-tripping\n     </li><li>Clarified the rec2020 transfer function, citing the correct ITU Rec BT.2020-2 reference\n     </li><li>Correct fallback examples to use the correct syntax\n     </li><li>Don’t force non-legacy colors to interpolate in a gamma-encoded space\n     </li><li>Define premultiplied alpha interpolation\n     </li><li>Start to address interpolation to and from currentColor\n     </li><li>Define hue interpolation with NaN\n     </li><li>Generalize color interpolation\n     </li><li>Define interpolation to be in Lab, with override to LCG\n     </li><li>Corrections to hue interpolation\n     </li><li>Defined hue angle interpolation\n     </li><li>Added interpolation section\n     </li><li>Corrected syntax in some examples\n     </li><li>Clarify exactly which components are allowed percentages, in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑥\">color()</a>\n     </li><li>Change to serialize <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑨\">lch()</a> as itself rather than as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑨\">lab()</a>\n     </li><li>Minimum 10 bits per component precision for non-legacy sRGB in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑦\">color()</a>\n     </li><li>color space no longer optional in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑧\">color()</a> \n     </li><li>Consistent minimum precision between lab() and color(lab)\n     </li><li>Clarified fallback procedure for the color() function – first valid in-gamut color, else first valid color which is then gamut mapped, else transparent black\n     </li><li>Clarified difference between opacity property and colors with opacity, notably for rendering overlapping text glyphs\n     </li><li>Added sample (but verified correct) code for ΔE2000\n     </li><li>Added definition of previously-undefined term chromaticity, with examples; define chromaticity diagram.\n     </li><li>Added explanation of color additivity, with examples\n     </li><li>Added source links to WPT tests\n     </li><li>Export definition of color, and valid color, for other specifications to reference\n     </li><li>Define minimum number of bits per component, for serialization\n     </li><li>Updated \"applies to\" definitions (CSS-wide change)\n     </li><li>Added image state (display referred or scene referred) for predefined color spaces\n     </li><li>Listed white point correlated color temperature (e.g. D65) alongside chromaticity coordinates, for clarity\n     </li><li>Clarified that rounding is towards +∞\n     </li><li>Correction of typos, markup corrections, link fixes\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20191105\"><span class=\"content\">Changes since\n<a href=\"https://www.w3.org/TR/2019/WD-css-color-4-20191105/\">Working Draft of\n5 November 2019</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20191105\"></a></h3>\n    <ul>\n     <li>Export some terms for use in other specifications\n     </li><li>Update requirement from WCAG 2.0 to 2.1\n     </li><li>Fully specify Unicode characters used for serialization\n     </li><li>Define serialization of special named colors\n     </li><li>Define serialization of device-cmyk()\n     </li><li>Define serialization of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑨\">color()</a>\n     </li><li>Fully define RGB serialization, in maximally web-compatible way\n     </li><li>Define serialization of Lab and LCH\n     </li><li>Fully define serialization of alpha values\n     </li><li>Consistency pass to avoid accidental RFC2119\n     </li><li>Add IDs to all the examples, to enable referencing\n     </li><li>Separate resolved color and serialized color sections\n     </li><li>(Security) ICC profiles have no executable code\n     </li><li>Define what out-of-range means for profiled colors\n     </li><li>Clarify out-of-range clamping\n     </li><li>Add examples of specified values\n     </li><li>Clarify computed values\n     </li><li>Resist fingerprinting, with mandatory mappings for deprecated system colors\n     </li><li>Added explanatory note on history and reason for standardizing X11 colors\n     </li><li>Correct hwb sample code\n     </li><li>Add table of DeltaE2000 values for MacBeth patches\n     </li><li>Add note on ICC profile Internet Media type\n     </li><li>Add reference to PNG sRGB chunk\n     </li><li>Clarify CMYK to Lab interconversion\n     </li><li>Clarify RGB to Lab interconversion\n     </li><li>More comparison of HSL vs. LCH\n     </li><li>More description for Rec BT.2020 color space\n     </li><li>Updated description of prophoto-rgb\n     </li><li>Removed duplicate \"keywords\" from Value Definitions section \n     </li><li>Added an example of an invalid color\n     </li><li>Added example with multiple fallbacks\n     </li><li>Assorted typos and markup fixes\n     </li><li>Clarify handling for undeclared custom color spaces\n     </li><li>Clarify some examples and explanatory notes\n     </li><li>Handling for valid and invalid ICC profiles\n     </li><li>Define handling for images with explicit tagged color space\n     </li><li>Define color space for 4k, SDR video\n     </li><li>State that user contrast settings mst take precedence\n     </li><li>Clarify meaning of system colors outside for forced-color mode\n     </li><li>Update default style rules\n     </li><li>Add CIE XYZ color space to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color②⓪\">color()</a>\n     </li><li>Greater clarity on hue angles, NaN explicitly allowed\n     </li><li>Improve section on system color pairings, require AA accessible contrast\n     </li><li>Warn of interaction between overlapping glyphs and the opacity property\n     </li><li>Correct grammar in color definition\n     </li><li>Improve description of Highlight/HighlightText\n     </li><li>Correct prophoto-rgb transfer function\n     </li><li>More precision for prophoto-rgb primaries\n     </li><li>Started to define \"can’t be displayed\"\n     </li><li>Removed paragraph about canvas surface\n     </li><li>Added the buttonborder, mark, and marktext system colors\n     </li><li>Added reverse conversion, sRGB to HWB\n     </li><li>Clarified polar spaces are cylindrical, not spherical\n     </li><li>Added an Accessibility Considerations section\n     </li><li>Started to describe chroma-reduction gamut mapping rather than per-component clipping\n     </li><li>Corrected white chromaticity for rec2020\n     </li><li>Made device-cmyk available by @color-profile; updated CMYK to color algorithm to only use naive conversion as a last resort\n     </li><li>Added print-oriented CMYK and KCMYOGV examples\n     </li><li>User-defined color spaces now dashed-ident, making predefined color spaces extensible without clashes\n     </li><li>Added lab option to the color() function\n     </li><li>Added normative reference for CIE Lab\n     </li><li>Clarified that prophoto-rgb uses <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50⑨\">D50</a> whitepoint so does not require adaptation\n     </li><li>Clarified direction of increasing angle in LCH\n     </li><li>Clarified that color names are ASCII case insensitive\n     </li><li>Initial value of the \"color\" property is now CanvasText\n     </li><li>Removed confusing gray() function per CSS WG resolution\n     </li><li>Collect scattered definitions into new\n\t\t<a href=\"https://drafts.csswg.org/css-color-4/#terminology\">Color terminology</a> section\n     </li><li>Add helpful figures and more examples\n     </li><li>Minor editorial clarifications, spell check, fixing typos, bikeshed markup fixes\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20160705\"><span class=\"content\">Changes since <a href=\"http://www.w3.org/TR/2016/WD-css-color-4-20160705/\">Working Draft of 05 July 2016</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20160705\"></a></h3>\n    <ul>\n     <li>Changed Lightness in Lab and LCH to be a percentage, for CSS compatibility\n     </li><li>Clamping of color values clarified\n     </li><li>Percentage opacity is now allowed\n     </li><li>Define terms sRGB and linear-light sRGB, for use by other specs\n     </li><li>Add new list of CSS system colors; renaming Text to CanvasText\n     </li><li>Make system color keywords compute to themselves\n     </li><li>Add computed/used entry for system colors\n     </li><li>Rewrite intro to non-deprecated system colors to center their use around forced-colors mode rather than generic use\n     </li><li>Consistent hyphenation of predefined color spaces\n     </li><li>Restore text about non-opaque elements painting at layers even when not positioned\n     </li><li>Initial value of the \"color\" property is now black\n     </li><li>Clarify hue in LCH is modulo 360deg (change now reverted)\n     </li><li>Clarify allowed range of L in LCH and Lab, and meaning of L=100\n     </li><li>Update references for color spaces used in video\n     </li><li>Add prophoto-rgb predefined color space\n     </li><li>Correct black and white luminance levels for display-p3\n     </li><li>Clarify display-p3 transfer function\n     </li><li>Add a98-rgb color space, correct table of primary chromaticities\n     </li><li>Clarify that currentColor’s computed value is not the resolved color\n     </li><li>Update syntax is examples to conform to latest specification\n     </li><li>Remove the color-mod() function\n     </li><li>Drop the \"media\" from propdef tables\n     </li><li>Export, and consistently use, \"transparent black\" and \"opaque black\"\n     </li><li>Clarify calculated values such as percents\n     </li><li>Clarify required precision and rounding behavior for color components\n     </li><li>Clarify \"color\" property has no effect on color font glyphs (unless specifically referenced, e.g. with currentColor)\n     </li><li>Clarify how color values are resolved\n     </li><li>Clarify that HSL, HWB and named colors resolve to sRGB\n     </li><li>Simplify conversion from device-cmyk to sRGB\n     </li><li>Describe previous, comma-using color syntaxes as \"legacy\"; change examples to commaless form\n     </li><li>Remove superfluous requirement that displayed colors be restricted to device gamut (like there was any other option!)\n     </li><li>Rename P3 to display-p3; avoid claiming this is DCI P3, as these are not the same\n     </li><li>Improved description of the parameters to the \"color()\" function\n     </li><li>Disallow predefined spaces from \"@color-profile\" identifier\n     </li><li>Add canonical order to \"color\", \"color-adjust\" and \"opacity\" property definitions\n     </li><li>Switch definition of alpha compositing from SVG11 to CSS Compositing\n     </li><li>Clarify sample conversion code is non-normative\n     </li><li>Add Security and Privacy Considerations\n     </li><li>Update several references to most current versions\n     </li><li>Convert inline issues to links to GitHub issues\n     </li><li>Minor editorial clarifications, formatting and markup improvements\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-3\"><span class=\"content\">\nChanges from Colors 3</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-3\"></a></h3>\n    <p>The primary change, compared to CSS Color 3,\n\tis that CSS colors are no longer restricted to the\n\tnarrow gamut of sRGB.</p>\n    <p>To support this, several brand new features have been added:</p>\n    \n    <p>Other technical changes:</p>\n    \n    <p>In addition, there have been some syntactic changes:</p>\n    \n    <h2 class=\"heading settled\" data-level=\"20\" id=\"security\"><span class=\"secno\">20. </span><span class=\"content\">Security Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#security\"></a></h2>\n    <p>The system colors,\nif they actually correspond to the user’s system colors,\npose a security risk,\nas they make it easier for a malware site\nto create user interfaces that appear to be from the system.\nHowever, as several system colors are now defined to be \"generic\",\nthis risk is believed to be mitigated.</p>\n    <h2 class=\"heading settled\" data-level=\"21\" id=\"privacy\"><span class=\"secno\">21. </span><span class=\"content\">Privacy Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#privacy\"></a></h2>\n    <p>This specification defines \"system\" colors,\nwhich theoretically can expose details of the user’s OS settings,\nwhich is a fingerprinting risk.</p>\n    <h2 class=\"heading settled\" data-level=\"22\" id=\"a11y-sec\"><span class=\"secno\">22. </span><span class=\"content\">Accessibility Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#a11y-sec\"></a></h2>\n    <p>This specification <a href=\"https://drafts.csswg.org/css-color-4/#accessibility\">encourages authors to not use\n\tcolor alone</a> as a distinguishing feature.</p>\n    <p>This specification <a href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑨\">encourages browsers to ensure\n\tadequate contrast for specific system color foreground/background pairs</a>.\n\tA harder requirement with specific AA or AAA contrast ratios was considered,\n\tbut since browsers are often just passing along color choices made by the OS,\n\tor selected by users (who may have particular requirements,\n\tincluding lower contrast for people living with migraines or epileptic seizures), the CSSWG\n\twas unable to require a specific contrast level.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "if <var>destination</var> has no gamut limits (XYZ-D65, XYZ-D50, Lab, LCH, Oklab, OkLCh) convert <var>origin</var> to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "let <var>origin_OkLCh</var> be <var>origin</var> converted\n\t\tfrom <var>origin color space</var> to the OkLCh color space"
        },
        {
          "html": "if the Lightness of <var>origin_OkLCh</var> is greater than or equal to 100%,\n\t\tconvert `oklab(1 0 0 / origin.alpha)` to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "if the Lightness of <var>origin_OkLCh</var> is less than than or equal to 0%,\n\t\tconvert `oklab(0 0 0 / origin.alpha)` to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "let inGamut(<var>color</var>) be a function which returns true if, when passed a color,\n\t\tthat color is inside the gamut of <var>destination</var>.\n\t\tFor HSL and HWB, it returns true if the color is inside the gamut of sRGB."
        },
        {
          "html": "if inGamut(<var>origin_OkLCh</var>) is true, convert <var>origin_OkLCh</var> to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "otherwise, let delta(<var>one</var>, <var>two</var>) be a function which returns the deltaEOK of color <var>one</var> compared to color <var>two</var>"
        },
        {
          "html": "let <var>JND</var> be 0.02"
        },
        {
          "html": "let <var>epsilon</var> be 0.0001"
        },
        {
          "html": "let clip(<var>color</var>) be a function which converts <var>color</var> to <var>destination</var>,\n\t\tclamps each component to the bounds of the reference range for that component\n\t\tand returns the result"
        },
        {
          "html": "set <var>current</var> to <var>origin_OkLCh</var>"
        },
        {
          "html": "set <var>clipped</var> to clip(<var>current</var>)"
        },
        {
          "html": "set <var>E</var> to delta(<var>clipped</var>, <var>current</var>)"
        },
        {
          "html": "if <var>E</var> &lt; <var>JND</var>",
          "rationale": "return",
          "steps": [
            {
              "html": "return <var>clipped</var> as the gamut mapped color"
            }
          ]
        },
        {
          "html": "set <var>min</var> to zero"
        },
        {
          "html": "set <var>max</var> to the OkLCh chroma of <var>origin_OkLCh</var>"
        },
        {
          "html": "let <var>min_inGamut</var> be a boolean that represents when <var>min</var> is still in gamut, and set it to true"
        },
        {
          "html": "while (<var>max</var> - <var>min</var> is greater than <var>epsilon</var>) repeat the following steps",
          "rationale": "set",
          "steps": [
            {
              "html": "set <var>chroma</var> to (<var>min</var> + <var>max</var>) /2"
            },
            {
              "html": "set the chroma component of <var>current</var> to <var>chroma</var>"
            },
            {
              "html": "if <var>min_inGamut</var> is true and also if inGamut(<var>current</var>) is true, set <var>min</var> to <var>chroma</var> and continue to repeat these steps"
            },
            {
              "html": "otherwise, carry out these steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "set <var>clipped</var> to clip(<var>current</var>)"
                },
                {
                  "html": "set <var>E</var> to delta(<var>clipped</var>, <var>current</var>)"
                },
                {
                  "html": "if <var>E</var> &lt; <var>JND</var>",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "if (<var>JND</var> - <var>E</var> &lt; <var>epsilon</var>) return <var>clipped</var> as the gamut mapped color"
                    },
                    {
                      "html": "otherwise,",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "set <var>min_inGamut</var> to false"
                        },
                        {
                          "html": "set <var>min</var> to <var>chroma</var>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "otherwise, set <var>max</var> to <var>chroma</var> and continue to repeat these steps"
                }
              ]
            }
          ]
        },
        {
          "html": "return <var>clipped</var> as the gamut mapped color"
        }
      ]
    },
    {
      "name": "to gamut map a color by binary search with local MINDE",
      "href": "https://drafts.csswg.org/css-color-4/#binary-search-gamut-map-with-local-minde",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"ray-trace-gamut-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Ray Trace Gamut Map</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of an RGB destination color space <var>destination</var>:\n\n\t\n     \n     <div class=\"algorithm\" data-algorithm=\"to cast a ray\">\n      \n\t\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cast-a-ray\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cast a ray</dfn> through a linear-light RGB space\n\t\tfrom <var>start</var> to <var>end</var> \n\t\t(in gamut mapping,\n\t\t<var>start</var> is an anchor within the RGB gamut \n\t\tand <var>end</var> is the gamut mapped color, on the cubical gamut surface):\n\n\t\n      \n     </div>\n     <h5 class=\"heading settled\" data-level=\"13.2.6.1\" id=\"raytrace-footnotes\"><span class=\"secno\">13.2.6.1. </span><span class=\"content\">Footnotes for Ray Trace algorithm</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnotes\"></a></h5>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "if <var>destination</var> has no gamut limits (XYZ-D65, XYZ-D50, Lab, LCH, Oklab, OkLCh) convert <var>origin</var> to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "let <var>origin_OkLCh</var> be <var>origin</var> converted from <var>origin color space</var>\n\t\t\tto the OkLCh color space"
        },
        {
          "html": "if the Lightness of <var>origin_OkLCh</var> is greater than or equal to 100%,\n\t\t\tconvert `oklab(1 0 0 / origin.alpha)` to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "if the Lightness of <var>origin_OkLCh</var> is less than than or equal to 0%,\n\t\t\tconvert `oklab(0 0 0 / origin.alpha)` to <var>destination</var> and return it as the gamut mapped color"
        },
        {
          "html": "let <var>l_origin</var> be the OkLCh lightness component of <var>origin_OkLCh</var>"
        },
        {
          "html": "let <var>h_origin</var> be the OkLCh hue component of <var>origin_OkLCh</var>"
        },
        {
          "html": "let <var>anchor</var> be an achromatic OkLCh color formed with \n\t\t\t<var>l_origin</var> as lightness, 0 as chroma and <var>h_origin</var> as hue,\n\t\t\tconverted to the <em>linear-light</em> form of <var>destination</var>"
        },
        {
          "html": "let <var>origin_rgb</var> be <var>origin_OkLCh</var>\n\t\t\tconverted to the <em>linear-light</em> form of <var>destination</var>"
        },
        {
          "html": "if <var>origin_rgb</var> is not in gamut\n\t\t\t\n       <ul>\n        <li>let <var>low</var> be 0.0 + 1E-6 <a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-1\"><sup>1</sup></a>\n        </li><li>let <var>high</var> be 1.0 - 1E-6 <a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-2\"><sup>2</sup></a>\n        </li><li>let <var>last</var> be <var>origin_rgb</var>\n        </li><li>\n         for (i=0; i&lt;4; i++)\n\t\t\t\t\t\n         <ul>\n          <li>\n           if (i &gt; 0)\n\t\t\t\t\t\t\t\n           <ul>\n            <li>let <var>current_OkLCh</var> be <var>origin_rgb</var> converted to OkLCh\n            </li><li>let the lightness of <var>current_OkLCh</var> be <var>l_origin</var>\n            </li><li>let the hue of <var>current_OkLCh</var> be <var>h_origin</var>\n\t\t\t\t\t\t\t\t\t<a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-3\"><sup>3</sup></a>\n            </li><li>let <var>origin_rgb</var> be <var>current_OkLCh</var>\n\t\t\t\t\t\t\t\t\tconverted to the <em>linear-light</em> form of <var>destination</var>\n\t\t\t\t\t\t\t\t\n           </li></ul>\n          </li><li><b>Cast a ray</b> from <var>anchor</var> to <var>origin_rgb</var>\n\t\t\t\t\t\t\tand let <var>intersection</var> be \n\t\t\t\t\t\t\tthe intersection of this ray \n\t\t\t\t\t\t\twith the gamut boundary\n\t\t\t\t\t\t\n          </li><li>if an intersection was not found,\n\t\t\t\t\t\t\tlet <var>origin_rgb</var> be <var>last</var> and exit the loop\n\t\t\t\t\t\t\t<a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-5\"><sup>5</sup></a>\n\t\t\t\t\t\t\n          </li><li>if (i &gt;0) AND (each component of <var>origin_rgb</var> is between <var>low</var> and <var>high</var>) then\n\t\t\t\t\t\t\tlet <var>anchor</var> be <var>origin_rgb</var>\n\t\t\t\t\t\t\t<a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-4\"><sup>4</sup></a>\n\t\t\t\t\t\t\n          </li><li>let <var>origin_rgb</var> be <var>intersection</var>\n          </li><li>let <var>last</var> be <var>intersection</var>\n         </li></ul>\n       </li></ul>"
        },
        {
          "html": "let clip(<var>color</var>) be a function which converts <var>color</var> to <var>destination</var>,\n\t\tclamps each component to the bounds of the reference range for that component\n\t\tand returns the result"
        },
        {
          "html": "set <var>clipped</var> to clip(<var>current</var>)"
        },
        {
          "html": "return <var>clipped</var> as the gamut mapped color"
        }
      ]
    },
    {
      "name": "to gamut map a color by binary search with local MINDE",
      "href": "https://drafts.csswg.org/css-color-4/#binary-search-gamut-map-with-local-minde",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cast-a-ray\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cast a ray</dfn> through a linear-light RGB space\n\t\tfrom <var>start</var> to <var>end</var> \n\t\t(in gamut mapping,\n\t\t<var>start</var> is an anchor within the RGB gamut \n\t\tand <var>end</var> is the gamut mapped color, on the cubical gamut surface):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "let <var>bmin</var> and <var>bmax</var> be 3-element arrays\n\t\t\twith the gamut’s lower and upper bounds, respectively\n\t\t\t<a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-6\"><sup>6</sup></a>"
        },
        {
          "html": "let <var>tfar</var> be infinity (or some very large number)"
        },
        {
          "html": "let <var>tnear</var> be -infinity (or some very large, negative number)"
        },
        {
          "html": "let <var>direction</var> be a 3-element array"
        },
        {
          "html": "for (i = 0; i &lt; 3; i++): \n\t\t\t\n        <ul>\n         <li>let <var>a</var> be <var>start</var><i>[i]</i>\n         </li><li>let <var>b</var> be <var>end</var><i>[i]</i>\n         </li><li>let <var>d</var> be <var>b</var> - <var>a</var>\n         </li><li>let <var>direction</var><i>[i]</i> be <var>d</var>\n         </li><li>\n          if abs(<var>d</var>) &lt; 1E-12\n\t\t\t\t\t\n          <ul>\n           <li>let <var>inv_d</var> be 1 / <var>d</var>\n           </li><li>let <var>t1</var> be (<var>bmin</var><i>[i]</i> - <var>a</var>) * <var>inv_d</var>\n           </li><li>let <var>t2</var> be (<var>bmax</var><i>[i]</i> - <var>a</var>) * <var>inv_d</var>\n           </li><li>let <var>tnear</var> be max(min(<var>t1</var>, <var>t2</var>), <var>tnear</var>)\n           </li><li>let <var>tfar</var> be min(max(<var>t1</var>, <var>t2</var>), <var>tfar</var>)\n          </li></ul>\n         </li><li>\n          else if (<var>a</var> &lt; <var>bmin</var><i>[i]</i> or <var>a</var> &gt; <var>bmax</var><i>[i]</i>)\n\t\t\t\t\t\n          <ul>\n           <li>return INTERSECTION NOT FOUND\n          </li></ul>\n        </li></ul>"
        },
        {
          "html": "if (<var>tnear</var> &gt; <var>tfar</var> or <var>tfar</var> &lt; 0)\n\t\t\t\n        <ul>\n         <li>return INTERSECTION NOT FOUND\n        </li></ul>"
        },
        {
          "html": "if <var>tnear</var> &lt; 0\n\t\t\t\n        <ul>\n         <li>let <var>tnear</var> be <var>tfar</var>\n\t\t\t\t\t<a href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-7\"><sup>7</sup></a>\n\t\t\t\t\n        </li></ul>"
        },
        {
          "html": "if <var>tnear</var> is infinite (or matches the initial very large value)\n\t\t\t\n        <ul>\n         <li>return INTERSECTION NOT FOUND\n        </li></ul>"
        },
        {
          "html": "for (i =0; i &lt; 3; i++):\n\t\t\t\n        <ul>\n         <li>let <var>result</var><i>[i]</i> be <var>start</var><i>[i]</i> + <var>direction</var><i>[i]</i> * <var>tnear</var>\n        </li></ul>"
        },
        {
          "html": "return <var>result</var>"
        }
      ]
    },
    {
      "name": "to gamut map a color by binary search with local MINDE",
      "href": "https://drafts.csswg.org/css-color-4/#binary-search-gamut-map-with-local-minde",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"ray-trace-gamut-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Ray Trace Gamut Map</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of an RGB destination color space <var>destination</var>:\n\n\t\n     \n     <div class=\"algorithm\" data-algorithm=\"to cast a ray\">\n      \n\t\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cast-a-ray\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cast a ray</dfn> through a linear-light RGB space\n\t\tfrom <var>start</var> to <var>end</var> \n\t\t(in gamut mapping,\n\t\t<var>start</var> is an anchor within the RGB gamut \n\t\tand <var>end</var> is the gamut mapped color, on the cubical gamut surface):\n\n\t\n      \n     </div>\n     <h5 class=\"heading settled\" data-level=\"13.2.6.1\" id=\"raytrace-footnotes\"><span class=\"secno\">13.2.6.1. </span><span class=\"content\">Footnotes for Ray Trace algorithm</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnotes\"></a></h5>",
      "rationale": "for",
      "steps": [
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-1\"></a>\n\t\t\tIt is assumed the minimum value is 0\n\t\t\tand that all channels have the same minimum. \n\t\t\tThe value should be small relative to the unit type. \n\t\t\t64 bit could easily be as small as 1e-14, but 1e-6 is fine in practice."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-2\"></a>\n\t\t\t1.0 represents the maximum in-gamut channel value,\n\t\t\tand it is assumed all channels have the same maximum."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-3\"></a>\n\t\t\tThis places the current color back on the chroma reduction curve,\n\t\t\tif it has deviated."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-4\"></a>\n\t\t\tThis means <var>origin_rgb</var> is below the gamut surface, \n\t\t\tso we use it as an anchor closer to the gamut surface."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-5\"></a>\n\t\t\tThis is provided for catastrophic failures \n\t\t\twhere a specific, perceptual mapping space \n\t\t\tcompletely breaks down \n\t\t\tdue to ridiculously wide colors (outside the visible spectrum).\n\t\t\tIt is expected that non-imaginary colors in CSS should never trigger this."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-6\"></a>\n\t\t\tFor typical RGB spaces \n\t\t\twhere the gamut bounds are 0 and 1 for each component\n\t\t\tthis simplifies to a single constant\n\t\t\trather than a 3-element array."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnote-7\"></a>\n\t\t\tfavoring the first intersection in the direction <var>start</var> -&gt; <var>end</var>."
        }
      ]
    },
    {
      "name": "to gamut map a color by binary search with local MINDE",
      "href": "https://drafts.csswg.org/css-color-4/#binary-search-gamut-map-with-local-minde",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"binary-search-gamut-map-with-local-minde\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Binary Search Gamut Map with Local MINDE</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of a destination color space <var>destination</var>:\n\n\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.3\" id=\"GMA-EdgeSeeker\"><span class=\"secno\">13.2.3. </span><span class=\"content\">\n\tThe EdgeSeeker Gamut Mapping\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#GMA-EdgeSeeker\"></a></h4>\n    <p>The EdgeSeeker algorithm is a geometric and lookup-table-based approach,\n\toriginally developed by Alexey Ardov \n\tfor the color.js library <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-colorjs-edgeseeker\" title=\"EdgeSeeker Gamut Mapping algorithm\">[colorjs-EdgeSeeker]</a>.</p>\n    <p>For any given hue, the gamut boundary slice\n\tis represented as a curved top section\n\tand a linear bottom section,\n\tjoning at the highest chroma point for that hue.</p>\n    <p>To initialize this algorithm,\n\tfor a given target RGB space,\n\ta lookup table (LUT) is constructed\n\tcontaining the highest-chroma Oklch color on each hue slice.\n\tLinear interpolation between closest LUT values\n\tis used to then estimate the highest-chroma color\n\tfor the exact hue of each color to be gamut mapped.</p>\n    <p>Intersection of the constant-lightness ray\n\twith the gamut boundary is then calculated,\n\twhich is fast for the lower (linear) part of the boundary\n\tand still fairly fast for the upper (curved) portion.</p>\n    <p>This gives good results, at the expense of memory for the LUT.</p>\n    <h4 class=\"heading settled\" data-level=\"13.2.4\" id=\"pseudo-edgeseeker\"><span class=\"secno\">13.2.4. </span><span class=\"content\">\nSample Pseudocode for the EdgeSeeker Gamut Mapping</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#pseudo-edgeseeker\"></a></h4>\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.5\" id=\"GMA-Raytrace\"><span class=\"secno\">13.2.5. </span><span class=\"content\">\n\tThe Ray Trace Gamut Mapping \n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#GMA-Raytrace\"></a></h4>\n    <p>The Ray Trace algorithm is a geometric approach\n\tto RGB gamut mapping,\n\tfor fast chroma reduction with constant lightness.\n\tIt was originally developed by Isaac Muse\n\tfor the Coloraide Python Library <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-coloraide-ray-trace\" title=\"Ray Tracing Chroma Reduction\">[Coloraide-Ray-Trace]</a>.</p>\n    <p>The color to be mapped is first converted to Oklch,\n\tand then the achromatic version of that color is generated,\n\twhich will be the neutral axis anchor.\n\tThese two colors are then converted to \n\tthe linear-light version of the target RGB space.</p>\n    <p>Because the gamut boundary is now an axis-aligned cube,\n\tfinding the intersection is faster.</p>\n    <p>A ray is cast from the inside of the RGB cube,\n\tfrom the anchor point to the current color. \n\tThe intersection along this path \n\twith the RGB gamut surface is then found;\n\tthis is the first approximation to the gamut mapped color.</p>\n    <p>As RGB spaces are not perceptually uniform,\n\ta constant hue, constant lightness ray\n\tis actually a curved path in RGB space.</p>\n    <p>The first approximation is converted back to Oklch\n\tto correct the color in the perceptual color space \n\tby projecting the point back onto the chroma reduction path, \n\tcorrecting the color’s hue and lightness. \n\tThe corrected color becomes the new current color \n\tand should be a much closer color on the reduced chroma line.</p>\n    <p>This process is repeated (a maximum of three more times),\n\teach time finding a better, closer color on the path. \n\tFinally, simple clipping is used to account for floating point math errors.</p>\n    <p>The results are comparable to binary search with local MINDE\n\tusing a low JND, \n\tbut resolves much faster \n\tand within more predictable, consistent time.</p>\n    <figure>\n     \n\t\t<img alt=\"\" height=\"800\" src=\"https://drafts.csswg.org/css-color-4/images/raytrace-gma.png\" width=\"800\">\n\t\t\n     <figcaption>Ray Trace gamut mpping to the sRGB gamut,\n\t\t\tshowing the curved path of chroma reduction\n\t\t\tas approximated over a maximum\n\t\t\tof four iterations.<br>\n\t\t\tImage copyright Isaac Muse.\n\t\t</figcaption>\n    </figure>\n    \n    <h4 class=\"heading settled\" data-level=\"13.2.6\" id=\"pseudo-raytrace\"><span class=\"secno\">13.2.6. </span><span class=\"content\">\nSample Pseudocode for the Ray Trace Gamut Mapping</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#pseudo-raytrace\"></a></h4>\n    <div class=\"algorithm\" data-algorithm=\"to gamut map a color by Ray Tracing\">\n     \n\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"ray-trace-gamut-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Ray Trace Gamut Map</dfn> a color <var>origin</var>\n\tin color space <var>origin color space</var>\n\tto be in gamut of an RGB destination color space <var>destination</var>:\n\n\t\n     \n     <div class=\"algorithm\" data-algorithm=\"to cast a ray\">\n      \n\t\tTo <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cast-a-ray\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cast a ray</dfn> through a linear-light RGB space\n\t\tfrom <var>start</var> to <var>end</var> \n\t\t(in gamut mapping,\n\t\t<var>start</var> is an anchor within the RGB gamut \n\t\tand <var>end</var> is the gamut mapped color, on the cubical gamut surface):\n\n\t\n      \n     </div>\n     <h5 class=\"heading settled\" data-level=\"13.2.6.1\" id=\"raytrace-footnotes\"><span class=\"secno\">13.2.6.1. </span><span class=\"content\">Footnotes for Ray Trace algorithm</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#raytrace-footnotes\"></a></h5>\n     \n    </div>\n    <h2 class=\"heading settled\" data-level=\"14\" id=\"resolving-color-values\"><span class=\"secno\">14. </span><span class=\"content\">\nResolving <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color①⑨\">&lt;color&gt;</a> Values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-color-values\"></a></h2>\n    <p>Unless otherwise specified for a particular property,\n\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#specified-value\" id=\"ref-for-specified-value\">specified</a> colors are resolved to\n\t<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"computed color\" id=\"computed-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①\">computed</a> colors</dfn>\n\tand then further to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"used color\" id=\"used-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value②\">used</a> colors</dfn> as described below.</p>\n    <p>The <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-1/#resolved-value\" id=\"ref-for-resolved-value\">resolved value</a> of a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⓪\">&lt;color&gt;</a> is its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value③\">used value</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.1\" id=\"resolving-sRGB-values\"><span class=\"secno\">14.1. </span><span class=\"content\">\nResolving sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-sRGB-values\"></a></h3>\n    <p>This applies to:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color③\">hex colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①④\">rgb()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba⑨\">rgba()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsl\" id=\"ref-for-funcdef-hsl①⑦\">hsl()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsla\" id=\"ref-for-funcdef-hsla①①\">hsla()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①⓪\">hwb()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color②\">named colors</a></p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors①\">system colors</a></p>\n     </li><li data-md=\"\">\n      <p><a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-colors</a></p>\n    </li></ul>\n    <p>It does <em>not</em> apply to:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color⑧\">color()</a> values using the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb\" id=\"ref-for-valdef-color-srgb⑨\">srgb</a> or <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb-linear\" id=\"ref-for-valdef-color-srgb-linear⑥\">srgb-linear</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑥\">color space</a>s.</p>\n    </li></ul>\n    <p>If the sRGB color was explicitly specified by the author as a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color③\">named color</a>,\n\tor as a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors②\">system color</a>,\n\tthe <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value\">declared value</a> is that named or system color, converted to\n\t<a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>.\n\tThe computed and used value\n\tis the corresponding sRGB color,\n\tpaired with the specified alpha component\n\t(after clamping to [0, 1])\n\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Otherwise, the declared, computed and used value\n\tis the corresponding sRGB color,\n\tpaired with the specified alpha component\n\t(after clamping to [0, 1])\n\tand defaulting to opaque if unspecified).</p>\n    <p>For historical reasons, when <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#funcdef-calc\" id=\"ref-for-funcdef-calc\">calc()</a> in sRGB colors\n\tresolves to a single value,\n\tthe declared value serialises without the \"calc(\" \")\" wrapper.</p>\n    \n    \n    <p>Also for historical reasons,\n\twhen calc() is simplified down to a single value,\n\tthe color values are clamped to [0.0, 255.0].</p>\n    \n    <p>This clamping also takes care of values such as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc-infinity\" id=\"ref-for-valdef-calc-infinity\">Infinity</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc--infinity\" id=\"ref-for-valdef-calc--infinity\">-Infinity</a>, and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#valdef-calc-nan\" id=\"ref-for-valdef-calc-nan\">NaN</a> which will clamp at 255, 0 and 0 respectively.</p>\n    \n    \n    <h3 class=\"heading settled\" data-level=\"14.2\" id=\"resolving-lab-lch-values\"><span class=\"secno\">14.2. </span><span class=\"content\">\nResolving Lab and LCH values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-lab-lch-values\"></a></h3>\n    <p>This applies to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑤\">lab()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑥\">lch()</a> values.</p>\n    <p>The declared, computed and used value\n\t\tis the corresponding CIE Lab or LCH color\n\t\t(after clamping of L, C and H)\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⓪\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③②\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Although the values of a, b and C\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.3\" id=\"resolving-oklab-oklch-values\"><span class=\"secno\">14.3. </span><span class=\"content\">\nResolving Oklab and OkLCh values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-oklab-oklch-values\"></a></h3>\n    <p>This applies to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑤\">oklab()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklch\" id=\"ref-for-funcdef-oklch⑥\">oklch()</a> values.</p>\n    <p>The declared, computed and used value\n\t\tis the corresponding Oklab or OkLCh color\n\t\t(after clamping of L, C and H)\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③①\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③③\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>Although the values of a, b and C\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity①\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.4\" id=\"resolving-color-function-values\"><span class=\"secno\">14.4. </span><span class=\"content\">\nResolving values of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color⑨\">color()</a> function</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-color-function-values\"></a></h3>\n    <p>The declared, computed and used value\n\t\tis the color in the specified <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑦\">color space</a>,\n\t\tpaired with the specified alpha component\n\t\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③②\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③④\">&lt;percentage&gt;</a>;\n\t\tand defaulting to opaque if unspecified).</p>\n    \n    <p>For colors specified in the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz\" id=\"ref-for-valdef-color-xyz⑤\">xyz</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#color-space\" id=\"ref-for-color-space⑧\">color space</a>,\n\t\twhich is an alias of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d65\" id=\"ref-for-valdef-color-xyz-d65③\">xyz-d65</a> <span id=\"ref-for-color-space⑨\">color space</span>,\n\t\tthe computed and used value\n\t\tis in the <span class=\"css\" id=\"ref-for-valdef-color-xyz-d65④\">xyz-d65</span> <span id=\"ref-for-color-space①⓪\">color space</span>.</p>\n    \n    <p>Although the values of r, g, b, x, y and z\n\t\tare theoretically unbounded,\n\t\tthere may be an\n\t\t<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#implementation-defined-limit-for-values-approaching-infinity\" id=\"ref-for-implementation-defined-limit-for-values-approaching-infinity②\">implementation-defined limit for values approaching infinity</a>.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"14.5\" id=\"resolving-other-colors\"><span class=\"secno\">14.5. </span><span class=\"content\">Resolving other colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#resolving-other-colors\"></a></h3>\n    <p>This applies to <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors③\">system colors</a>\n\t(including the <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color\">&lt;deprecated-color&gt;</a>s),\n\t<a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent③\">transparent</a>,\n\tand <span class=\"css\">currentcolor</span>.</p>\n    <p>The declared value for each <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-system-color\" id=\"ref-for-typedef-system-color①⓪\">&lt;system-color&gt;</a> keyword\n\tand <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color①\">&lt;deprecated-color&gt;</a> keyword\n\tis itself.\n\tThe computed value\n\tis the corresponding color in its color space.\n\tHowever, such colors must not be altered by\n\t'forced colors mode'.</p>\n    \n    <p>The declared value of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent④\">transparent</a> is \"transparent\"\n\twhile the computed and used value  is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#transparent-black\" id=\"ref-for-transparent-black①\">transparent black</a>.</p>\n    <p>The <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①①\">currentcolor</a> keyword computes to itself.</p>\n    <p>In the <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-4/#propdef-color\" id=\"ref-for-propdef-color④\">color</a> property,\n\tthe used value of <span class=\"css\">currentcolor</span> is the \n\tresolved <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#inherited-value\" id=\"ref-for-inherited-value\">inherited value</a>.\n\tIn any other property,\n\tits used value is the used value of the <span class=\"property\" id=\"ref-for-propdef-color⑤\">color</span> property on the same element.</p>\n    \n    \n    \n    <h2 class=\"heading settled\" data-level=\"15\" id=\"serializing-color-values\"><span class=\"secno\">15. </span><span class=\"content\">\nSerializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②①\">&lt;color&gt;</a> Values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-color-values\"></a></h2>\n    <p>This section updates and replaces that part of CSS Object Model, section\n<a href=\"https://drafts.csswg.org/cssom-1/#serializing-css-values\"> Serializing CSS Values</a>, which relates to serializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②②\">&lt;color&gt;</a> values.</p>\n    <p>In this section, the strings used in the specification and the corresponding characters are as follows.</p>\n    <div class=\"overlarge\"><table class=\"data\">\n     <tbody>\n      <tr>\n       <th>String\n       </th><th>Character(s)\n      </th></tr><tr>\n       <td>\" \"\n       </td><td>U+0020 SPACE\n      </td></tr><tr>\n       <td>\"#\"\n       </td><td>U+0023 NUMBER SIGN\n      </td></tr><tr>\n       <td>\",\"\n       </td><td>U+002C COMMA\n      </td></tr><tr>\n       <td>\"-\"\n       </td><td>U+002D HYPHEN-MINUS\n      </td></tr><tr>\n       <td>\".\"\n       </td><td>U+002E FULL STOP\n      </td></tr><tr>\n       <td>\"/\"\n       </td><td>U+002F SOLIDUS\n      </td></tr><tr>\n       <td>\"none\"\n       </td><td>U+006E LATIN SMALL LETTER N<br>\n\t\t\tU+006F LATIN SMALL LETTER O<br>\n\t\t\tU+006E LATIN SMALL LETTER N<br>\n\t\t\tU+0065 LATIN SMALL LETTER E\n\t\t\n    </td></tr></tbody></table></div>\n    <p>The string \".\" shall be used as a decimal separator,\nregardless of locale,\nand there shall be no thousands separator.</p>\n    <p>For syntactic forms which support <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component②⓪\">missing color components</a>,\nthe value <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①①\">none</a> (equivalently NONE, nOnE, etc),\nshall be serialized in all-lowercase\nas the string \"none\".</p>\n    <h3 class=\"heading settled\" data-level=\"15.1\" id=\"serializing-alpha-values\"><span class=\"secno\">15.1. </span><span class=\"content\">\nSerializing alpha values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\"></a></h3>\n    <p>This applies to any <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②③\">&lt;color&gt;</a> value which can take an optional alpha value.\n\tIt does not apply to the <span class=\"css\">opacity</span> property.</p>\n    <p>If, after clamping to the range [0, 1] the alpha is 1,\n\tit is omitted from the serialization;\n\tan implicit value of 1 (fully opaque) is the default.</p>\n    <p>If the alpha is any other value than 1,\n\tit is explicitly included in the serialization as described below.</p>\n    <p>If the value is internally represented as an integer\n\tbetween 0 and 255 inclusive (i.e. 8-bit unsigned integer),\n\tfollow these steps:</p>\n    \n    <p>Otherwise, return the result of serializing the given value\n\t(as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③④\">&lt;number&gt;</a>, not a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③⑤\">&lt;percentage&gt;</a>).</p>\n    \n    <p>The <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑤\">&lt;number&gt;</a> value is expressed in base ten,\n\twith the \".\" character as decimal separator.\n\tThe leading zero must not be omitted.\n\tTrailing zeroes must be omitted.</p>\n    \n    <p>The precision with which alpha values are retained,\n\tand thus the number of decimal places in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip integer percentage values.\n\tThus, the serialized value must contain\n\tat least two decimal places\n\t(unless trailing zeroes have been removed).\n\tValues must be\n\t<a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p>Because <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color-alpha-value\" id=\"ref-for-typedef-color-alpha-value②④\">&lt;alpha-value&gt;</a>s which were specified outside the valid range\n\tare clamped at parse time, the declared value will be clamped.\n\tHowever, per <a href=\"https://drafts.csswg.org/css-values-4/#calc-range\"><cite>CSS Values 4</cite> § 10.12 Range Checking</a>, <span class=\"production\" id=\"ref-for-typedef-color-alpha-value②⑤\">&lt;alpha-value&gt;</span>s\n\tspecified using calc() are not clamped when the specified form is serialized;\n\tbut the computed values are clamped.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.2\" id=\"serializing-sRGB-values\"><span class=\"secno\">15.2. </span><span class=\"content\">\nSerializing sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-sRGB-values\"></a></h3>\n    <p>The serialized form of the following sRGB values:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color④\">hex colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑤\">rgb()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①⓪\">rgba()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsl\" id=\"ref-for-funcdef-hsl①⑧\">hsl()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hsla\" id=\"ref-for-funcdef-hsla①②\">hsla()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①①\">hwb()</a> values</p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color④\">named colors</a></p>\n     </li><li data-md=\"\">\n      <p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors④\">system colors</a></p>\n     </li><li data-md=\"\">\n      <p><a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-colors</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑤\">transparent</a></p>\n    </li></ul>\n    <p>is derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value①\">declared value</a>.</p>\n    <p>When serializing the value of a property\n\twhich was set by the author to a CSS <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#named-color\" id=\"ref-for-named-color⑤\">named color</a>,\n\ta <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑤\">system color</a>,\n\ta <a href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\">deprecated-color</a>,\n\tor <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑥\">transparent</a>\n\ttherefore, for the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#declared-value\" id=\"ref-for-declared-value②\">declared value</a>,\n\tthe <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tkeyword value is retained.\n\tFor the computed and used value,\n\tthe corresponding sRGB value is used.</p>\n    \n    <p>Thus, the serialized declared value of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-transparent\" id=\"ref-for-valdef-color-transparent⑦\">transparent</a> is the string \"transparent\",\n\twhile the serialized computed value of <span class=\"css\" id=\"ref-for-valdef-color-transparent⑧\">transparent</span> is the string \"rgba(0, 0, 0, 0)\".</p>\n    <p>For all other sRGB values,\n\tthe declared, computed and used value\n\tis the corresponding sRGB value.</p>\n    <p>During serialization,\n\tany <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#missing-color-component\" id=\"ref-for-missing-color-component②①\">missing</a> values\n\tare converted to 0.</p>\n    <h4 class=\"heading settled\" data-level=\"15.2.1\" id=\"HTML-compatible-serialization-of-srgb\"><span class=\"secno\">15.2.1. </span><span class=\"content\">HTML-compatible serialization of sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#HTML-compatible-serialization-of-srgb\"></a></h4>\n    <p>If the following conditions are all true:</p>\n    \n    <p>Then corresponding sRGB values are serialized in 6-digit <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#hex-color\" id=\"ref-for-hex-color⑤\">hex color notation</a> as follows:</p>\n    <p>A seven-character string consisting of the character \"#\", followed immediately by the two-digit hexadecimal representations of the red component, the green component, and the blue component, in that order, using <a href=\"https://infra.spec.whatwg.org/#ascii-lower-hex-digit\">ASCII lower hex digits</a>. No spaces are permitted.</p>\n    \n    <p>Otherwise, for sRGB the <a href=\"https://drafts.csswg.org/css-color-4/#css-serialization-of-srgb\">CSS serialization of sRGB values is used</a> and for other color spaces, the relevant <a href=\"https://drafts.csswg.org/css-color-4/#serializing-color-values\">serialization</a> of the <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②④\">&lt;color&gt;</a> value.</p>\n    \n    \n    <h4 class=\"heading settled\" data-level=\"15.2.2\" id=\"css-serialization-of-srgb\"><span class=\"secno\">15.2.2. </span><span class=\"content\">CSS serialization of sRGB values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#css-serialization-of-srgb\"></a></h4>\n    <p>Corresponding sRGB values use either the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑥\">rgb()</a> or <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①①\">rgba()</a> form\n\t(depending on whether the (clamped) alpha is exactly 1, or not),\n\twith all <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>For compatibility, the sRGB component values\n\tare serialized in <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑥\">&lt;number&gt;</a> form, not <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#percentage-value\" id=\"ref-for-percentage-value③⑥\">&lt;percentage&gt;</a>.\n\tAlso for compatibility,\n\tthe component values are serialized in base 10,\n\twith a range of [0-255], regardless of\n\tthe bit depth with which they are stored.</p>\n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tAlso, for compatibility, if the alpha is exactly 1,\n\tthe <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgb\" id=\"ref-for-funcdef-rgb①⑦\">rgb()</a> form is used,\n\twith an implicit alpha;\n\totherwise, the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①②\">rgba()</a> form is used,\n\twith an explicit alpha value.</p>\n    <p>For compatibility,\n\tthe legacy form with comma separators is used;\n\texactly one ASCII space follows each comma.\n\tThis includes the comma (not slash) used\n\tto separate the blue component of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-rgba\" id=\"ref-for-funcdef-rgba①③\">rgba()</a>\n\tfrom the alpha value.</p>\n    \n    \n    \n    <p id=\"sRGB-precision\">\n\tThe precision with which sRGB component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip eight bit values.\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.\n\t</p>\n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.\n\tThis means that sRGB colors specified with integer component values\n\twill serialize with backwards-compatible integer values.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.3\" id=\"serializing-lab-lch\"><span class=\"secno\">15.3. </span><span class=\"content\">\nSerializing Lab and LCH values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-lab-lch\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑦\">lch()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑥\">lab()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value②\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-lab⑦\">lab()</span> or <span class=\"css\" id=\"ref-for-funcdef-lch⑧\">lch()</span> forms,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>The component values are serialized in base 10;\n\tthe L, a, b and C component values\n\tare serialized as <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③⑨\">&lt;number&gt;</a>,\n\tusing the <a href=\"https://drafts.csswg.org/css-color-4/#prr-lab\">Lab percentage reference ranges</a>\n\tor the <a href=\"https://drafts.csswg.org/css-color-4/#prr-lch\">LCH percentage reference ranges</a>\n\tas appropriate\n\tto perform percentage to number conversion;\n\tthus 0% L maps to 0\n\tand 100% L maps to 100.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values.</p>\n    \n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>The precision with which <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑧\">lab()</a> component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut due to the wide gamut must be sufficient\n\tto round-trip L values between 0 and 100,\n\tand a and b values between ±127,\n\twith at least sixteen bit precision;\n\tthis will result in at least three decimal places\n\tunless trailing zeroes have been omitted.\n\t(half float or float, is recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate the b component value from the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.4\" id=\"serializing-oklab-oklch\"><span class=\"secno\">15.4. </span><span class=\"content\">\nSerializing Oklab and OkLCh values</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-oklab-oklch\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklch\" id=\"ref-for-funcdef-oklch⑦\">oklch()</a> and <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑥\">oklab()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value③\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-oklab⑦\">oklab()</span> or <span class=\"css\" id=\"ref-for-funcdef-oklch⑧\">oklch()</span> forms,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name.</p>\n    <p>The component values are serialized in base 10;\n\tthe L, a, b and C component values\n\tare serialized as <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④⓪\">&lt;number&gt;</a>\n\tusing the <a href=\"https://drafts.csswg.org/css-color-4/#prr-oklab\">Oklab percentage reference ranges</a>\n\tor the <a href=\"https://drafts.csswg.org/css-color-4/#prr-oklch\">OkLCh percentage reference ranges</a>\n\tas appropriate\n\tto perform percentage to number conversion;\n\tthus 0% L maps to 0\n\tand 100% L maps to 1.0.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values.</p>\n    \n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>The precision with which <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-oklab\" id=\"ref-for-funcdef-oklab⑧\">oklab()</a> component values are retained,\n\tand thus the number of significant figures in the serialized value,\n\tis not defined in this specification,\n\tbut due to the wide gamut must be sufficient\n\tto round-trip L values between 0 and 1 (0% and 100%),\n\tand a, b and C values between ±0.5,\n\twith at least sixteen bit precision;\n\tthis will result in at least five decimal places\n\tunless trailing zeroes have been omitted.\n\t(half float or float, is recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate the final color component (b, or C) value from the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.5\" id=\"serializing-color-function-values\"><span class=\"secno\">15.5. </span><span class=\"content\">\nSerializing values of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⓪\">color()</a> function</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-color-function-values\"></a></h3>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①①\">color()</a> values\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value④\">computed value</a>\n\tand uses the <span class=\"css\" id=\"ref-for-funcdef-color①②\">color()</span> form,\n\twith <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the function name\n\tand the color space name.</p>\n    <p>The component values are serialized in base 10,\n\tas <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④①\">&lt;number&gt;</a>.\n\tA single ASCII space character \" \"\n\tmust be used as the separator\n\tbetween the component values,\n\tand also between the color space name and the first color component.</p>\n    \n    \n    <p>Trailing fractional zeroes in any component values must be omitted;\n\tif the fractional part consists of all zeroes,\n\tthe decimal point must also be omitted.</p>\n    \n    <p>If the color space is sRGB, the color space is still explicitly required in the serialized result.</p>\n    <p>For the predefined color spaces,\n\tthe <em>minimum</em> precision for round-tripping is as follows:</p>\n    <div class=\"overlarge\"><table class=\"data\" id=\"predefined-precision-table\">\n     <tbody>\n      <tr>\n       <th>color space\n       </th><th>Minimum bits\n      </th></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb\" id=\"ref-for-valdef-color-srgb①⓪\">srgb</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-srgb-linear\" id=\"ref-for-valdef-color-srgb-linear⑦\">srgb-linear</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-display-p3\" id=\"ref-for-valdef-color-display-p3①①\">display-p3</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><span class=\"css\">display-p3-linear</span>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-a98-rgb\" id=\"ref-for-valdef-color-a98-rgb⑤\">a98-rgb</a>\n       </td><td>10\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-prophoto-rgb\" id=\"ref-for-valdef-color-prophoto-rgb①④\">prophoto-rgb</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-rec2020\" id=\"ref-for-valdef-color-rec2020⑦\">rec2020</a>\n       </td><td>12\n      </td></tr><tr>\n       <td><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz\" id=\"ref-for-valdef-color-xyz⑥\">xyz</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d50\" id=\"ref-for-valdef-color-xyz-d50③\">xyz-d50</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-xyz-d65\" id=\"ref-for-valdef-color-xyz-d65⑤\">xyz-d65</a>\n       </td><td>16\n    </td></tr></tbody></table></div>\n    <p>(16bit, half-float, or float <em>per component</em>\n\tis recommended for internal storage).\n\tValues must be <a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded towards +∞</a>, not truncated.</p>\n    \n    <p><a href=\"https://drafts.csswg.org/css-color-4/#serializing-alpha-values\">As noted earlier</a>,\n\tunitary alpha values are not explicitly serialized.\n\tNon-unitary alpha values must be explicitly serialized,\n\tand the string \" / \"\n\t(an ASCII space, then forward slash, then another space)\n\tmust be used to separate\n\tthe final color component value\n\tfrom the alpha value.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"15.6\" id=\"serializing-other-colors\"><span class=\"secno\">15.6. </span><span class=\"content\">\nSerializing other colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-other-colors\"></a></h3>\n    <p>This applies to\n\t<a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①③\">currentcolor</a>.</p>\n    <p>The serialized form of this value\n\tis derived from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑤\">computed value</a>\n\tand uses <a href=\"https://infra.spec.whatwg.org/#ascii-lowercase\">ASCII lowercase</a>\n\tletters for the color name.</p>\n    <p>The serialized form of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-currentcolor\" id=\"ref-for-valdef-color-currentcolor①④\">currentColor</a> is the string \"currentcolor\".</p>\n    <h2 class=\"heading settled\" data-level=\"16\" id=\"serializing-opacity-values\"><span class=\"secno\">16. </span><span class=\"content\">\nSerializing <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-opacity-opacity-value\" id=\"ref-for-typedef-opacity-opacity-value④\">&lt;opacity-value&gt;</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#serializing-opacity-values\"></a></h2>\n    <p>This applies to the <span class=\"css\">opacity</span> property.</p>\n    <p>If the specified value for an opacity value\n\tmatches a literal <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-percentage-token\" id=\"ref-for-typedef-percentage-token\">&lt;percentage-token&gt;</a>\n\t(i.e. does not use <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-values-4/#funcdef-calc\" id=\"ref-for-funcdef-calc②\">calc()</a>)\n\tit should be serialized as the equivalent\n\t<a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④②\">&lt;number&gt;</a> (0% maps to 0, 100% maps to 1) value.\n\tvalue. \n\tOtherwise, the specified value \n\tfor an opacity value \n\tshould serialize using \n\tthe standard serialization for the grammar.</p>\n    <p>This <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value④③\">&lt;number&gt;</a> value is expressed in base ten,\n\twith the \".\" character as decimal separator.\n\tThe leading zero must not be omitted.\n\tTrailing zeroes must be omitted.</p>\n    <p>Opacity values outside the range [0,1]\n\tare preserved, without clamping, in the serialized specified value.</p>\n    <p>The precision with which opacity values are retained,\n\tand thus the number of decimal places in the serialized value,\n\tis not defined in this specification,\n\tbut must at least be sufficient\n\tto round-trip integer percentage values.\n\tThus, the serialized value must contain\n\tat least two decimal places\n\t(unless trailing zeroes have been removed).\n\tValues must be\n\t<a href=\"https://drafts.csswg.org/css-values-4/#combine-integers\">rounded \n\ttowards +∞</a>, not truncated.</p>\n    <h2 class=\"heading settled\" data-level=\"17\" id=\"sample\"><span class=\"secno\">17. </span><span class=\"content\">\nDefault Style Rules</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#sample\"></a></h2>\n    <p>The following stylesheet is informative, not normative.  This style sheet could be used by an implementation as part of its default styling of HTML documents.</p>\n<pre class=\"highlight lang-css\"><c- c=\"\">/* traditional desktop user agent colors for hyperlinks */</c->\n:link <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> LinkText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n:visited <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> VisitedText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n:active <c- p=\"\">{</c-> <c- k=\"\">color</c-><c- p=\"\">:</c-> ActiveText<c- p=\"\">;</c-> <c- p=\"\">}</c->\n</pre>\n    <h2 class=\"heading settled\" data-level=\"18\" id=\"color-conversion-code\"><span class=\"secno\">18. </span><span class=\"content\">\nSample code for Color Conversions</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-conversion-code\"></a></h2>\n    <p><em>This section is not normative.</em></p>\n    \n    <p>For clarity, <a href=\"https://drafts.csswg.org/css-color-4/multiply-matrices.js\">a library</a> is used for matrix multiplication.\n(This is more readable than inlining all the multiplies and adds).\nThe matrices are in <a href=\"https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry/row-major-vs-column-major-vector\">column-major order</a>.</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// Sample code for color conversions</c->\n<c- c1=\"\">// Conversion can also be done using ICC profiles and a Color Management System</c->\n<c- c1=\"\">// For clarity, a library is used for matrix multiplication (multiply-matrices.js)</c->\n\n<c- c1=\"\">// standard white points, defined by 4-figure CIE x,y chromaticities</c->\n<c- a=\"\">const</c-> D50 <c- o=\"\">=</c-> <c- p=\"\">[</c-><c- mf=\"\">0.3457</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">,</c-> <c- mf=\"\">1.00000</c-><c- p=\"\">,</c-> <c- p=\"\">(</c-><c- mf=\"\">1.0</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3457</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3585</c-><c- p=\"\">];</c->\n<c- a=\"\">const</c-> D65 <c- o=\"\">=</c-> <c- p=\"\">[</c-><c- mf=\"\">0.3127</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">,</c-> <c- mf=\"\">1.00000</c-><c- p=\"\">,</c-> <c- p=\"\">(</c-><c- mf=\"\">1.0</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3127</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">0.3290</c-><c- p=\"\">];</c->\n\n<c- c1=\"\">// sRGB-related functions</c->\n\n<c- a=\"\">function</c-> lin_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of sRGB values</c->\n\t<c- c1=\"\">// where in-gamut values are in the range [0 - 1]</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// https://en.wikipedia.org/wiki/SRGB</c->\n\t<c- c1=\"\">// Extended transfer function:</c->\n\t<c- c1=\"\">// for negative values,  linear portion is extended on reflection of axis,</c->\n\t<c- c1=\"\">// then reflected power function is used.</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&lt;=</c-> <c- mf=\"\">0.04045</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> val <c- o=\"\">/</c-> <c- mf=\"\">12.92</c-><c- p=\"\">;</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> <c- p=\"\">(</c->Math<c- p=\"\">.</c->pow<c- p=\"\">((</c->abs <c- o=\"\">+</c-> <c- mf=\"\">0.055</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">1.055</c-><c- p=\"\">,</c-> <c- mf=\"\">2.4</c-><c- p=\"\">));</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light sRGB values in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// https://en.wikipedia.org/wiki/SRGB</c->\n\t<c- c1=\"\">// Extended transfer function:</c->\n\t<c- c1=\"\">// For negative values, linear portion extends on reflection</c->\n\t<c- c1=\"\">// of axis, then uses reflected pow below that</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&gt;</c-> <c- mf=\"\">0.0031308</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> <c- p=\"\">(</c-><c- mf=\"\">1.055</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">2.4</c-><c- p=\"\">)</c-> <c- o=\"\">-</c-> <c- mf=\"\">0.055</c-><c- p=\"\">);</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> <c- mf=\"\">12.92</c-> <c- o=\"\">*</c-> val<c- p=\"\">;</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_sRGB_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light sRGB values to CIE XYZ</c->\n\t<c- c1=\"\">// using sRGB's own white, D65 (no chromatic adaptation)</c->\n\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">506752</c-> <c- o=\"\">/</c-> <c- mf=\"\">1228815</c-><c- p=\"\">,</c->  <c- mf=\"\">87881</c-> <c- o=\"\">/</c-> <c- mf=\"\">245763</c-><c- p=\"\">,</c->   <c- mf=\"\">12673</c-> <c- o=\"\">/</c->   <c- mf=\"\">70218</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">87098</c-> <c- o=\"\">/</c->  <c- mf=\"\">409605</c-><c- p=\"\">,</c-> <c- mf=\"\">175762</c-> <c- o=\"\">/</c-> <c- mf=\"\">245763</c-><c- p=\"\">,</c->   <c- mf=\"\">12673</c-> <c- o=\"\">/</c->  <c- mf=\"\">175545</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">7918</c-> <c- o=\"\">/</c->  <c- mf=\"\">409605</c-><c- p=\"\">,</c->  <c- mf=\"\">87881</c-> <c- o=\"\">/</c-> <c- mf=\"\">737289</c-><c- p=\"\">,</c-> <c- mf=\"\">1001167</c-> <c- o=\"\">/</c-> <c- mf=\"\">1053270</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_sRGB<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light sRGB</c->\n\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">12831</c-> <c- o=\"\">/</c->   <c- mf=\"\">3959</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">329</c-> <c- o=\"\">/</c->    <c- mf=\"\">214</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1974</c-> <c- o=\"\">/</c->   <c- mf=\"\">3959</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">851781</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">1648619</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">36519</c-> <c- o=\"\">/</c-> <c- mf=\"\">878810</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->     <c- mf=\"\">705</c-> <c- o=\"\">/</c->  <c- mf=\"\">12673</c-><c- p=\"\">,</c->   <c- o=\"\">-</c-><c- mf=\"\">2585</c-> <c- o=\"\">/</c->  <c- mf=\"\">12673</c-><c- p=\"\">,</c->   <c- mf=\"\">705</c-> <c- o=\"\">/</c->    <c- mf=\"\">667</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">//  display-p3-related functions</c->\n\n\n<c- a=\"\">function</c-> lin_P3<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of display-p3 RGB values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\n\t<c- k=\"\">return</c-> lin_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">);</c->\t<c- c1=\"\">// same as sRGB</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_P3<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light display-p3 RGB  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\n\t<c- k=\"\">return</c-> gam_sRGB<c- p=\"\">(</c->RGB<c- p=\"\">);</c->\t<c- c1=\"\">// same as sRGB</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_P3_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light display-p3 values to CIE XYZ</c->\n\t<c- c1=\"\">// using  D65 (no chromatic adaptation)</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">608311</c-> <c- o=\"\">/</c-> <c- mf=\"\">1250200</c-><c- p=\"\">,</c-> <c- mf=\"\">189793</c-> <c- o=\"\">/</c-> <c- mf=\"\">714400</c-><c- p=\"\">,</c->  <c- mf=\"\">198249</c-> <c- o=\"\">/</c-> <c- mf=\"\">1000160</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">35783</c-> <c- o=\"\">/</c->  <c- mf=\"\">156275</c-><c- p=\"\">,</c-> <c- mf=\"\">247089</c-> <c- o=\"\">/</c-> <c- mf=\"\">357200</c-><c- p=\"\">,</c->  <c- mf=\"\">198249</c-> <c- o=\"\">/</c-> <c- mf=\"\">2500400</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->      <c- mf=\"\">0</c-> <c- o=\"\">/</c->       <c- mf=\"\">1</c-><c- p=\"\">,</c->  <c- mf=\"\">32229</c-> <c- o=\"\">/</c-> <c- mf=\"\">714400</c-><c- p=\"\">,</c-> <c- mf=\"\">5220557</c-> <c- o=\"\">/</c-> <c- mf=\"\">5000800</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_P3<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light P3</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">446124</c-> <c- o=\"\">/</c-> <c- mf=\"\">178915</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">333277</c-> <c- o=\"\">/</c-> <c- mf=\"\">357830</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">72051</c-> <c- o=\"\">/</c-> <c- mf=\"\">178915</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">14852</c-> <c- o=\"\">/</c->  <c- mf=\"\">17905</c-><c- p=\"\">,</c->   <c- mf=\"\">63121</c-> <c- o=\"\">/</c->  <c- mf=\"\">35810</c-><c- p=\"\">,</c->    <c- mf=\"\">423</c-> <c- o=\"\">/</c->  <c- mf=\"\">17905</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">11844</c-> <c- o=\"\">/</c-> <c- mf=\"\">330415</c-><c- p=\"\">,</c->  <c- o=\"\">-</c-><c- mf=\"\">50337</c-> <c- o=\"\">/</c-> <c- mf=\"\">660830</c-><c- p=\"\">,</c-> <c- mf=\"\">316169</c-> <c- o=\"\">/</c-> <c- mf=\"\">330415</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// prophoto-rgb functions</c->\n\n<c- a=\"\">function</c-> lin_ProPhoto<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of prophoto-rgb values</c->\n\t<c- c1=\"\">// where in-gamut colors are in the range [0.0 - 1.0]</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// Transfer curve is gamma 1.8 with a small linear portion</c->\n\t<c- c1=\"\">// Extended transfer function</c->\n\t<c- a=\"\">const</c-> Et2 <c- o=\"\">=</c-> <c- mf=\"\">16</c-><c- o=\"\">/</c-><c- mf=\"\">512</c-><c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&lt;=</c-> Et2<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> val <c- o=\"\">/</c-> <c- mf=\"\">16</c-><c- p=\"\">;</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1.8</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_ProPhoto<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light prophoto-rgb  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// Transfer curve is gamma 1.8 with a small linear portion</c->\n\t<c- c1=\"\">// TODO for negative values, extend linear portion on reflection of axis, then add pow below that</c->\n\t<c- a=\"\">const</c-> Et <c- o=\"\">=</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">512</c-><c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">if</c-> <c- p=\"\">(</c->abs <c- o=\"\">&gt;=</c-> Et<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-><c- o=\"\">/</c-><c- mf=\"\">1.8</c-><c- p=\"\">);</c->\n\t\t<c- p=\"\">}</c->\n\n\t\t<c- k=\"\">return</c-> <c- mf=\"\">16</c-> <c- o=\"\">*</c-> val<c- p=\"\">;</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_ProPhoto_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light prophoto-rgb values to CIE D50 XYZ</c->\n\t<c- c1=\"\">// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy</c->\n\t<c- c1=\"\">// see https://github.com/w3c/csswg-drafts/issues/7675</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.79776664490064230</c-><c- p=\"\">,</c->  <c- mf=\"\">0.13518129740053308</c-><c- p=\"\">,</c->  <c- mf=\"\">0.03134773412839220</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.28807482881940130</c-><c- p=\"\">,</c->  <c- mf=\"\">0.71183523424187300</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00008993693872564</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.82510460251046020</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_ProPhoto<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert D50 XYZ to linear-light prophoto-rgb</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.34578688164715830</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.25557208737979464</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.05110186497554526</c-> <c- p=\"\">],</c->\n        <c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.54463070512490190</c-><c- p=\"\">,</c->  <c- mf=\"\">1.50824774284514680</c-><c- p=\"\">,</c->  <c- mf=\"\">0.02052744743642139</c-> <c- p=\"\">],</c->\n        <c- p=\"\">[</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.00000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">1.21196754563894520</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// a98-rgb functions</c->\n\n<c- a=\"\">function</c-> lin_a98rgb<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of a98-rgb values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">// negative values are also now accepted</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t  \t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">563</c-><c- o=\"\">/</c-><c- mf=\"\">256</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_a98rgb<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light a98-rgb  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">// negative values are also now accepted</c->\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">256</c-><c- o=\"\">/</c-><c- mf=\"\">563</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_a98rgb_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light a98-rgb values to CIE XYZ</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html</c->\n\t<c- c1=\"\">// has greater numerical precision than section 4.3.5.3 of</c->\n\t<c- c1=\"\">// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf</c->\n\t<c- c1=\"\">// but the values below were calculated from first principles</c->\n\t<c- c1=\"\">// from the chromaticity coordinates of R G B W</c->\n\t<c- c1=\"\">// see matrixmaker.html</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">573536</c-> <c- o=\"\">/</c->  <c- mf=\"\">994567</c-><c- p=\"\">,</c->  <c- mf=\"\">263643</c-> <c- o=\"\">/</c-> <c- mf=\"\">1420810</c-><c- p=\"\">,</c->  <c- mf=\"\">187206</c-> <c- o=\"\">/</c->  <c- mf=\"\">994567</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">591459</c-> <c- o=\"\">/</c-> <c- mf=\"\">1989134</c-><c- p=\"\">,</c-> <c- mf=\"\">6239551</c-> <c- o=\"\">/</c-> <c- mf=\"\">9945670</c-><c- p=\"\">,</c->  <c- mf=\"\">374412</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">53769</c-> <c- o=\"\">/</c-> <c- mf=\"\">1989134</c-><c- p=\"\">,</c->  <c- mf=\"\">351524</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-><c- p=\"\">,</c-> <c- mf=\"\">4929758</c-> <c- o=\"\">/</c-> <c- mf=\"\">4972835</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_a98rgb<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light a98-rgb</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1829569</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">506331</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">308931</c-> <c- o=\"\">/</c->  <c- mf=\"\">896150</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">851781</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-><c- p=\"\">,</c-> <c- mf=\"\">1648619</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-><c- p=\"\">,</c->   <c- mf=\"\">36519</c-> <c- o=\"\">/</c->  <c- mf=\"\">878810</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->   <c- mf=\"\">16779</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">147721</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-><c- p=\"\">,</c-> <c- mf=\"\">1266979</c-> <c- o=\"\">/</c-> <c- mf=\"\">1248040</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">//Rec. 2020-related functions</c->\n\n<c- a=\"\">function</c-> lin_2020<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of rec2020 RGB values in the range 0.0 - 1.0</c->\n\t<c- c1=\"\">// to linear light (un-companded) form.</c->\n\t<c- c1=\"\">//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1</c->\n\t<c- c1=\"\">//  with b (black lift) = 0 and a (user gain) = 1</c->\n\t<c- c1=\"\">//  defined over the extended range, not clamped</c->\n\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">2.4</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> gam_2020<c- p=\"\">(</c->RGB<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light rec2020 RGB  in the range 0.0-1.0</c->\n\t<c- c1=\"\">// to gamma corrected form</c->\n\t<c- c1=\"\">//  Reference electro-optical transfer function from Rec. ITU-R BT.1886 Annex 1</c->\n\t<c- c1=\"\">//  with b (black lift) = 0 and a (user gain) = 1</c->\n\t<c- c1=\"\">//  defined over the extended range, not clamped</c->\n\n\t<c- k=\"\">return</c-> RGB<c- p=\"\">.</c->map<c- p=\"\">(</c-><c- a=\"\">function</c-> <c- p=\"\">(</c->val<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- a=\"\">let</c-> sign <c- o=\"\">=</c-> val <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- o=\"\">?</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">:</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\t\t<c- a=\"\">let</c-> abs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->val<c- p=\"\">);</c->\n\t\t<c- k=\"\">return</c-> sign <c- o=\"\">*</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->abs<c- p=\"\">,</c-> <c- mf=\"\">1</c-> <c- o=\"\">/</c-> <c- mf=\"\">2.4</c-><c- p=\"\">);</c->\n\t<c- p=\"\">});</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> lin_2020_to_XYZ<c- p=\"\">(</c->rgb<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert an array of linear-light rec2020 values to CIE XYZ</c->\n\t<c- c1=\"\">// using  D65 (no chromatic adaptation)</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">63426534</c-> <c- o=\"\">/</c-> <c- mf=\"\">99577255</c-><c- p=\"\">,</c->  <c- mf=\"\">20160776</c-> <c- o=\"\">/</c-> <c- mf=\"\">139408157</c-><c- p=\"\">,</c->  <c- mf=\"\">47086771</c-> <c- o=\"\">/</c-> <c- mf=\"\">278816314</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">26158966</c-> <c- o=\"\">/</c-> <c- mf=\"\">99577255</c-><c- p=\"\">,</c-> <c- mf=\"\">472592308</c-> <c- o=\"\">/</c-> <c- mf=\"\">697040785</c-><c- p=\"\">,</c->   <c- mf=\"\">8267143</c-> <c- o=\"\">/</c-> <c- mf=\"\">139408157</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->        <c- mf=\"\">0</c-> <c- o=\"\">/</c->        <c- mf=\"\">1</c-><c- p=\"\">,</c->  <c- mf=\"\">19567812</c-> <c- o=\"\">/</c-> <c- mf=\"\">697040785</c-><c- p=\"\">,</c-> <c- mf=\"\">295819943</c-> <c- o=\"\">/</c-> <c- mf=\"\">278816314</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\t<c- c1=\"\">// 0 is actually calculated as  4.994106574466076e-17</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> rgb<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> XYZ_to_lin_2020<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// convert XYZ to linear-light rec2020</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">30757411</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">6372589</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">4539589</c-> <c- o=\"\">/</c-> <c- mf=\"\">17917100</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">19765991</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-><c- p=\"\">,</c-> <c- mf=\"\">47925759</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-><c- p=\"\">,</c->   <c- mf=\"\">467509</c-> <c- o=\"\">/</c-> <c- mf=\"\">29648200</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->    <c- mf=\"\">792561</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1921689</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-><c- p=\"\">,</c-> <c- mf=\"\">42328811</c-> <c- o=\"\">/</c-> <c- mf=\"\">44930125</c-> <c- p=\"\">],</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Chromatic adaptation</c->\n\n<c- a=\"\">function</c-> D65_to_D50<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Bradford chromatic adaptation from D65 to D50</c->\n\t<c- c1=\"\">// The matrix below is the result of three operations:</c->\n\t<c- c1=\"\">// - convert from XYZ to retinal cone domain</c->\n\t<c- c1=\"\">// - scale components from one reference white to another</c->\n\t<c- c1=\"\">// - convert back to XYZ</c->\n\t<c- c1=\"\">// see https://github.com/LeaVerou/color.js/pull/354/files</c->\n\t\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c->  <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.0479297925449969</c-><c- p=\"\">,</c->    <c- mf=\"\">0.022946870601609652</c-><c- p=\"\">,</c->  <c- o=\"\">-</c-><c- mf=\"\">0.05019226628920524</c->  <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.02962780877005599</c-><c- p=\"\">,</c->   <c- mf=\"\">0.9904344267538799</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">0.017073799063418826</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.009243040646204504</c-><c- p=\"\">,</c->  <c- mf=\"\">0.015055191490298152</c-><c- p=\"\">,</c->   <c- mf=\"\">0.7518742814281371</c->   <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> D50_to_D65<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Bradford chromatic adaptation from D50 to D65</c->\n\t<c- c1=\"\">// See https://github.com/LeaVerou/color.js/pull/360/files</c->\n\t<c- a=\"\">var</c-> M <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.955473421488075</c-><c- p=\"\">,</c->    <c- o=\"\">-</c-><c- mf=\"\">0.02309845494876471</c-><c- p=\"\">,</c->   <c- mf=\"\">0.06325924320057072</c->  <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0283697093338637</c-><c- p=\"\">,</c->    <c- mf=\"\">1.0099953980813041</c-><c- p=\"\">,</c->    <c- mf=\"\">0.021041441191917323</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">0.012314014864481998</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.020507649298898964</c-><c- p=\"\">,</c->  <c- mf=\"\">1.330365926242124</c->    <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->M<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// CIE Lab and LCH</c->\n\n<c- a=\"\">function</c-> XYZ_to_Lab<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Assuming XYZ is relative to D50, convert to CIE Lab</c->\n\t<c- c1=\"\">// from CIE standard, which now defines these as a rational fraction</c->\n\t<c- a=\"\">var</c-> ε <c- o=\"\">=</c-> <c- mf=\"\">216</c-><c- o=\"\">/</c-><c- mf=\"\">24389</c-><c- p=\"\">;</c->  <c- c1=\"\">// 6^3/29^3</c->\n\t<c- a=\"\">var</c-> κ <c- o=\"\">=</c-> <c- mf=\"\">24389</c-><c- o=\"\">/</c-><c- mf=\"\">27</c-><c- p=\"\">;</c->   <c- c1=\"\">// 29^3/3^3</c->\n\n\t<c- c1=\"\">// compute xyz, which is XYZ scaled relative to reference white</c->\n\t<c- a=\"\">var</c-> xyz <c- o=\"\">=</c-> XYZ<c- p=\"\">.</c->map<c- p=\"\">((</c->value<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> value <c- o=\"\">/</c-> D50<c- p=\"\">[</c->i<c- p=\"\">]);</c->\n\n\t<c- c1=\"\">// now compute f</c->\n\t<c- a=\"\">var</c-> f <c- o=\"\">=</c-> xyz<c- p=\"\">.</c->map<c- p=\"\">(</c->value <c- p=\"\">=&gt;</c-> value <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c-> Math<c- p=\"\">.</c->cbrt<c- p=\"\">(</c->value<c- p=\"\">)</c-> <c- o=\"\">:</c-> <c- p=\"\">(</c->κ <c- o=\"\">*</c-> value <c- o=\"\">+</c-> <c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">);</c->\n\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">(</c-><c- mf=\"\">116</c-> <c- o=\"\">*</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">-</c-> <c- mf=\"\">16</c-><c- p=\"\">,</c-> \t <c- c1=\"\">// L</c->\n\t\t<c- mf=\"\">500</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]),</c-> <c- c1=\"\">// a</c->\n\t\t<c- mf=\"\">200</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">])</c->  <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n\t<c- c1=\"\">// L in range [0,100]. For use in CSS, add a percent</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> Lab_to_XYZ<c- p=\"\">(</c->Lab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Convert Lab to D50-adapted XYZ</c->\n\t<c- c1=\"\">// http://www.brucelindbloom.com/index.html?Eqn_Lab_to_XYZ.html</c->\n\t<c- a=\"\">var</c-> κ <c- o=\"\">=</c-> <c- mf=\"\">24389</c-><c- o=\"\">/</c-><c- mf=\"\">27</c-><c- p=\"\">;</c->   <c- c1=\"\">// 29^3/3^3</c->\n\t<c- a=\"\">var</c-> ε <c- o=\"\">=</c-> <c- mf=\"\">216</c-><c- o=\"\">/</c-><c- mf=\"\">24389</c-><c- p=\"\">;</c->  <c- c1=\"\">// 6^3/29^3</c->\n\t<c- a=\"\">var</c-> f <c- o=\"\">=</c-> <c- p=\"\">[];</c->\n\n\t<c- c1=\"\">// compute f, starting with the luminance-related term</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> <c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">+</c-> <c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">;</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-><c- o=\"\">/</c-><c- mf=\"\">500</c-> <c- o=\"\">+</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">];</c->\n\tf<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">=</c-> f<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">-</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-><c- o=\"\">/</c-><c- mf=\"\">200</c-><c- p=\"\">;</c->\n\n\t<c- c1=\"\">// compute xyz</c->\n\t<c- a=\"\">var</c-> xyz <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\tMath<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c-> <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c->   Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->            <c- o=\"\">:</c-> <c- p=\"\">(</c-><c- mf=\"\">116</c-><c- o=\"\">*</c->f<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">-</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c->κ<c- p=\"\">,</c->\n\t\tLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-> <c- o=\"\">&gt;</c-> κ <c- o=\"\">*</c-> ε <c- o=\"\">?</c->         Math<c- p=\"\">.</c->pow<c- p=\"\">((</c->Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">+</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">116</c-><c- p=\"\">,</c-><c- mf=\"\">3</c-><c- p=\"\">)</c-> <c- o=\"\">:</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">]</c-><c- o=\"\">/</c->κ<c- p=\"\">,</c->\n\t\tMath<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->  <c- o=\"\">&gt;</c-> ε <c- o=\"\">?</c->  Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-><c- mf=\"\">3</c-><c- p=\"\">)</c->            <c- o=\"\">:</c-> <c- p=\"\">(</c-><c- mf=\"\">116</c-><c- o=\"\">*</c->f<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-><c- o=\"\">-</c-><c- mf=\"\">16</c-><c- p=\"\">)</c-><c- o=\"\">/</c->κ\n\t<c- p=\"\">];</c->\n\n\t<c- c1=\"\">// Compute XYZ by scaling xyz by reference white</c->\n\t<c- k=\"\">return</c-> xyz<c- p=\"\">.</c->map<c- p=\"\">((</c->value<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> value <c- o=\"\">*</c-> D50<c- p=\"\">[</c->i<c- p=\"\">]);</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> Lab_to_LCH<c- p=\"\">(</c->Lab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- a=\"\">var</c-> epsilon <c- o=\"\">=</c-> <c- mf=\"\">0.0015</c-><c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> chroma <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">],</c-> <c- mf=\"\">2</c-><c- p=\"\">)</c-> <c- o=\"\">+</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> <c- mf=\"\">2</c-><c- p=\"\">));</c-> <c- c1=\"\">// Chroma</c->\n\t<c- a=\"\">var</c-> hue <c- o=\"\">=</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->Lab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> Lab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">*</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->hue <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> hue <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->chroma <c- o=\"\">&lt;=</c-> epsilon<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> <c- kc=\"\">NaN</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tchroma<c- p=\"\">,</c-> <c- c1=\"\">// Chroma</c->\n\t\thue <c- c1=\"\">// Hue, in degrees [0 to 360)</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> LCH_to_Lab<c- p=\"\">(</c->LCH<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Convert from polar form</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->LCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">),</c-> <c- c1=\"\">// a</c->\n\t\tLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->LCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// OKLab and OKLCH</c->\n<c- c1=\"\">// https://bottosson.github.io/posts/oklab/</c->\n\n<c- c1=\"\">// XYZ &lt;-&gt; LMS matrices recalculated for consistent reference white</c->\n<c- c1=\"\">// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484</c->\n<c- c1=\"\">// recalculated for 64bit precision</c->\n<c- c1=\"\">// see https://github.com/color-js/color.js/pull/357</c->\n\n<c- a=\"\">function</c-> XYZ_to_OKLab<c- p=\"\">(</c->XYZ<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Given XYZ relative to D65, convert to OKLab</c->\n\t<c- a=\"\">var</c-> XYZtoLMS <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.8190224379967030</c-><c- p=\"\">,</c-> <c- mf=\"\">0.3619062600528904</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.1288737815209879</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0329836539323885</c-><c- p=\"\">,</c-> <c- mf=\"\">0.9292868615863434</c-><c- p=\"\">,</c->  <c- mf=\"\">0.0361446663506424</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0481771893596242</c-><c- p=\"\">,</c-> <c- mf=\"\">0.2642395317527308</c-><c- p=\"\">,</c->  <c- mf=\"\">0.6335478284694309</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\t<c- a=\"\">var</c-> LMStoOKLab <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.2104542683093140</c-><c- p=\"\">,</c->  <c- mf=\"\">0.7936177747023054</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0040720430116193</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.9779985324311684</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">2.4285922420485799</c-><c- p=\"\">,</c->  <c- mf=\"\">0.4505937096174110</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">0.0259040424655478</c-><c- p=\"\">,</c->  <c- mf=\"\">0.7827717124575296</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.8086757549230774</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\n\t<c- a=\"\">var</c-> LMS <c- o=\"\">=</c-> multiplyMatrices<c- p=\"\">(</c->XYZtoLMS<c- p=\"\">,</c-> XYZ<c- p=\"\">);</c->\n\t<c- c1=\"\">// JavaScript Math.cbrt returns a sign-matched cube root</c->\n\t<c- c1=\"\">// beware if porting to other languages</c->\n\t<c- c1=\"\">// especially if tempted to use a general power function</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->LMStoOKLab<c- p=\"\">,</c-> LMS<c- p=\"\">.</c->map<c- p=\"\">(</c->c <c- p=\"\">=&gt;</c-> Math<c- p=\"\">.</c->cbrt<c- p=\"\">(</c->c<c- p=\"\">)));</c->\n\t<c- c1=\"\">// L in range [0,1]. For use in CSS, multiply by 100 and add a percent</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLab_to_XYZ<c- p=\"\">(</c->OKLab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// Given OKLab, convert to XYZ relative to D65</c->\n\t<c- a=\"\">var</c-> LMStoXYZ <c- o=\"\">=</c->  <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c->  <c- mf=\"\">1.2268798758459243</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.5578149944602171</c-><c- p=\"\">,</c->  <c- mf=\"\">0.2813910456659647</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0405757452148008</c-><c- p=\"\">,</c->  <c- mf=\"\">1.1122868032803170</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0717110580655164</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0763729366746601</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.4214933324022432</c-><c- p=\"\">,</c->  <c- mf=\"\">1.5869240198367816</c-> <c- p=\"\">]</c->\n\t<c- p=\"\">];</c->\n\t<c- a=\"\">var</c-> OKLabtoLMS <c- o=\"\">=</c-> <c- p=\"\">[</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c->  <c- mf=\"\">0.3963377773761749</c-><c- p=\"\">,</c->  <c- mf=\"\">0.2158037573099136</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.1055613458156586</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0638541728258133</c-> <c- p=\"\">],</c->\n\t\t<c- p=\"\">[</c-> <c- mf=\"\">1.0000000000000000</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">0.0894841775298119</c-><c- p=\"\">,</c-> <c- o=\"\">-</c-><c- mf=\"\">1.2914855480194092</c-> <c- p=\"\">]</c->\n    <c- p=\"\">];</c->\n\n\t<c- a=\"\">var</c-> LMSnl <c- o=\"\">=</c-> multiplyMatrices<c- p=\"\">(</c->OKLabtoLMS<c- p=\"\">,</c-> OKLab<c- p=\"\">);</c->\n\t<c- k=\"\">return</c-> multiplyMatrices<c- p=\"\">(</c->LMStoXYZ<c- p=\"\">,</c-> LMSnl<c- p=\"\">.</c->map<c- p=\"\">(</c->c <c- p=\"\">=&gt;</c-> c <c- o=\"\">**</c-> <c- mf=\"\">3</c-><c- p=\"\">));</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLab_to_OKLCH<c- p=\"\">(</c->OKLab<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- a=\"\">var</c-> epsilon <c- o=\"\">=</c-> <c- mf=\"\">0.000004</c-><c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> hue <c- o=\"\">=</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->OKLab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">],</c-> OKLab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">])</c-> <c- o=\"\">*</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- a=\"\">var</c-> chroma <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->OKLab<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> OKLab<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->hue <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> hue <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->chroma <c- o=\"\">&lt;=</c-> epsilon<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thue <c- o=\"\">=</c-> <c- kc=\"\">NaN</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tOKLab<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tchroma<c- p=\"\">,</c->\n\t\thue\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> OKLCH_to_OKLab<c- p=\"\">(</c->OKLCH<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- k=\"\">return</c-> <c- p=\"\">[</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">0</c-><c- p=\"\">],</c-> <c- c1=\"\">// L is still L</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->OKLCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">),</c-> <c- c1=\"\">// a</c->\n\t\tOKLCH<c- p=\"\">[</c-><c- mf=\"\">1</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->OKLCH<c- p=\"\">[</c-><c- mf=\"\">2</c-><c- p=\"\">]</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->PI <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c->  <c- c1=\"\">// b</c->\n\t<c- p=\"\">];</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Premultiplied alpha conversions</c->\n\n<c- a=\"\">function</c-> rectangular_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n<c- c1=\"\">// given a color in a rectangular orthogonal colorspace</c->\n<c- c1=\"\">// and an alpha value</c->\n<c- c1=\"\">// return the premultiplied form</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">*</c-> alpha<c- p=\"\">)</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> rectangular_un_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n<c- c1=\"\">// given a premultiplied color in a rectangular orthogonal colorspace</c->\n<c- c1=\"\">// and an alpha value</c->\n<c- c1=\"\">// return the actual color</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->alpha <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- k=\"\">return</c-> color<c- p=\"\">;</c-> <c- c1=\"\">// avoid divide by zero</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">/</c-> alpha<c- p=\"\">)</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> polar_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> hueIndex<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// given a color in a cylindicalpolar colorspace</c->\n\t<c- c1=\"\">// and an alpha value</c->\n\t<c- c1=\"\">// return the premultiplied form.</c->\n\t<c- c1=\"\">// the index says which entry in the color array corresponds to hue angle</c->\n\t<c- c1=\"\">// for example, in OKLCH it would be 2</c->\n\t<c- c1=\"\">// while in HSL it would be 0</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">*</c-> <c- p=\"\">(</c->hueIndex <c- o=\"\">===</c-> i<c- o=\"\">?</c-> <c- mf=\"\">1</c-> <c- o=\"\">:</c-> alpha<c- p=\"\">))</c->\n<c- p=\"\">}</c->\n\n<c- a=\"\">function</c-> polar_un_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> hueIndex<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- c1=\"\">// given a color in a cylindicalpolar colorspace</c->\n\t<c- c1=\"\">// and an alpha value</c->\n\t<c- c1=\"\">// return the actual color.</c->\n\t<c- c1=\"\">// the hueIndex says which entry in the color array corresponds to hue angle</c->\n\t<c- c1=\"\">// for example, in OKLCH it would be 2</c->\n\t<c- c1=\"\">// while in HSL it would be 0</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->alpha <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\t<c- k=\"\">return</c-> color<c- p=\"\">;</c-> <c- c1=\"\">// avoid divide by zero</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">return</c-> color<c- p=\"\">.</c->map<c- p=\"\">((</c->c<c- p=\"\">,</c-> i<c- p=\"\">)</c-> <c- p=\"\">=&gt;</c-> c <c- o=\"\">/</c-> <c- p=\"\">(</c->hueIndex <c- o=\"\">===</c-> i<c- o=\"\">?</c-> <c- mf=\"\">1</c-> <c- o=\"\">:</c-> alpha<c- p=\"\">))</c->\n<c- p=\"\">}</c->\n\n<c- c1=\"\">// Convenience functions can easily be defined, such as</c->\n<c- a=\"\">function</c-> hsl_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t<c- k=\"\">return</c-> polar_premultiply<c- p=\"\">(</c->color<c- p=\"\">,</c-> alpha<c- p=\"\">,</c-> <c- mf=\"\">0</c-><c- p=\"\">);</c->\n<c- p=\"\">}</c->\n</pre>\n    <h2 class=\"heading settled\" data-level=\"19\" id=\"color-difference-code\"><span class=\"secno\">19. </span><span class=\"content\">\nSample Code for ΔE2000 and ΔEOK Color Differences</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-code\"></a></h2>\n    <p><em>This section is not normative.</em></p>\n    \n    <h3 class=\"heading settled\" data-level=\"19.1\" id=\"color-difference-2000\"><span class=\"secno\">19.1. </span><span class=\"content\">ΔE2000</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-2000\"></a></h3>\n    <p>\n\tThe simplest color difference metric, ΔE76,\n\tis simply the Euclidean distance in Lab color space.\n\tWhile this is a good first approximation,\n\tcolor-critical industries such as printing and fabric dyeing\n\tsoon developed improved formulae.\n\tCurrently, the most widely used formula\n\tis ΔE2000.\n\tIt corrects a number of known asymmetries and non-linearities\n\tcompared to ΔE76.\n\tBecause the formula is complex,\n\tand critically dependent on the sign\n\tof various intermediate calculations,\n\timplementations are often incorrect <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-sharma\" title=\"The CIEDE2000 Color-Difference Formula: Implementation Notes, Supplementary Test Data, and Mathematical Observations\">[Sharma]</a>.\n</p>\n    <p>\n\tThe sample code below has been\n\t<a href=\"https://colorjs.io/test/?test=delta\">validated</a>\n\tto five significant figures\n\tagainst the test suite of paired Lab values and expected ΔE2000\n\tpublished by <a data-link-type=\"biblio\" href=\"https://drafts.csswg.org/css-color-4/#biblio-sharma\" title=\"The CIEDE2000 Color-Difference Formula: Implementation Notes, Supplementary Test Data, and Mathematical Observations\">[Sharma]</a> and is correct.\n</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// deltaE2000 is a statistically significant improvement</c->\n<c- c1=\"\">// over deltaE76 and deltaE94,</c->\n<c- c1=\"\">// and is recommended by the CIE and Idealliance</c->\n<c- c1=\"\">// especially for color differences less than 10 deltaE76</c->\n<c- c1=\"\">// but is wicked complicated</c->\n<c- c1=\"\">// and many implementations have small errors!</c->\n\n<c- d=\"\">/**</c->\n<c- d=\"\"> * @param {number[]} reference - Array of CIE Lab values: L as 0..100, a and b as around -150..150</c->\n<c- d=\"\"> * @param {number[]} sample - Array of CIE Lab values: L as 0..100, a and b as around -150..150</c->\n<c- d=\"\"> * @return {number} How different a color sample is from reference</c->\n<c- d=\"\"> */</c->\n\n<c- a=\"\">function</c-> deltaE2000 <c- p=\"\">(</c->reference<c- p=\"\">,</c-> sample<c- p=\"\">)</c-> <c- p=\"\">{</c->\n\n    <c- c1=\"\">// Given a reference and a sample color,</c->\n    <c- c1=\"\">// both in CIE Lab,</c->\n    <c- c1=\"\">// calculate deltaE 2000.</c->\n\n    <c- c1=\"\">// This implementation assumes the parametric</c->\n    <c- c1=\"\">// weighting factors kL, kC and kH</c->\n    <c- c1=\"\">// (for the influence of viewing conditions)</c->\n    <c- c1=\"\">// are all 1, as seems typical.</c->\n\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L1<c- p=\"\">,</c-> a1<c- p=\"\">,</c-> b1<c- p=\"\">]</c-> <c- o=\"\">=</c-> reference<c- p=\"\">;</c->\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L2<c- p=\"\">,</c-> a2<c- p=\"\">,</c-> b2<c- p=\"\">]</c-> <c- o=\"\">=</c-> sample<c- p=\"\">;</c->\n    <c- a=\"\">let</c-> C1 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->a1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n    <c- a=\"\">let</c-> C2 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->a2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- a=\"\">let</c-> Cbar <c- o=\"\">=</c-> <c- p=\"\">(</c->C1 <c- o=\"\">+</c-> C2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c-> <c- c1=\"\">// mean Chroma</c->\n\n\t<c- c1=\"\">// calculate a-axis asymmetry factor from mean Chroma</c->\n\t<c- c1=\"\">// this turns JND ellipses for near-neutral colors back into circles</c->\n\t<c- a=\"\">let</c-> C7 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Cbar<c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\t<c- a=\"\">const</c-> Gfactor <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c-><c- mf=\"\">25</c-><c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> G <c- o=\"\">=</c-> <c- mf=\"\">0.5</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">-</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->C7<c- o=\"\">/</c-><c- p=\"\">(</c->C7<c- o=\"\">+</c->Gfactor<c- p=\"\">)));</c->\n\n\t<c- c1=\"\">// scale a axes by asymmetry factor</c->\n\t<c- c1=\"\">// this by the way is why there is no Lab2000 color space</c->\n\t<c- a=\"\">let</c-> adash1 <c- o=\"\">=</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">+</c-> G<c- p=\"\">)</c-> <c- o=\"\">*</c-> a1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> adash2 <c- o=\"\">=</c-> <c- p=\"\">(</c-><c- mf=\"\">1</c-> <c- o=\"\">+</c-> G<c- p=\"\">)</c-> <c- o=\"\">*</c-> a2<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// calculate new Chroma from scaled a and original b axes</c->\n\t<c- a=\"\">let</c-> Cdash1 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->adash1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b1 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> Cdash2 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->adash2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> b2 <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// calculate new hues, with zero hue for true neutrals</c->\n\t<c- c1=\"\">// and in degrees, not radians</c->\n\t<c- a=\"\">const</c-> π <c- o=\"\">=</c-> Math<c- p=\"\">.</c->PI<c- p=\"\">;</c->\n\t<c- a=\"\">const</c-> r2d <c- o=\"\">=</c-> <c- mf=\"\">180</c-> <c- o=\"\">/</c-> π<c- p=\"\">;</c->\n\t<c- a=\"\">const</c-> d2r <c- o=\"\">=</c-> π <c- o=\"\">/</c-> <c- mf=\"\">180</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> h1 <c- o=\"\">=</c-> <c- p=\"\">(</c->adash1 <c- o=\"\">===</c-> <c- mf=\"\">0</c-> <c- o=\"\">&amp;&amp;</c-> b1 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-><c- o=\"\">?</c-> <c- mf=\"\">0</c-><c- o=\"\">:</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->b1<c- p=\"\">,</c-> adash1<c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> h2 <c- o=\"\">=</c-> <c- p=\"\">(</c->adash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-> <c- o=\"\">&amp;&amp;</c-> b2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-><c- o=\"\">?</c-> <c- mf=\"\">0</c-><c- o=\"\">:</c-> Math<c- p=\"\">.</c->atan2<c- p=\"\">(</c->b2<c- p=\"\">,</c-> adash2<c- p=\"\">);</c->\n\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->h1 <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\th1 <c- o=\"\">+=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> π<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->h2 <c- o=\"\">&lt;</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\th2 <c- o=\"\">+=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> π<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\n\th1 <c- o=\"\">*=</c-> r2d<c- p=\"\">;</c->\n\th2 <c- o=\"\">*=</c-> r2d<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Lightness and Chroma differences; sign matters</c->\n\t<c- a=\"\">let</c-> ΔL <c- o=\"\">=</c-> L2 <c- o=\"\">-</c-> L1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> ΔC <c- o=\"\">=</c-> Cdash2 <c- o=\"\">-</c-> Cdash1<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Hue difference, taking care to get the sign correct</c->\n\t<c- a=\"\">let</c-> hdiff <c- o=\"\">=</c-> h2 <c- o=\"\">-</c-> h1<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> hsum <c- o=\"\">=</c-> h1 <c- o=\"\">+</c-> h2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> habs <c- o=\"\">=</c-> Math<c- p=\"\">.</c->abs<c- p=\"\">(</c->hdiff<c- p=\"\">);</c->\n\t<c- a=\"\">let</c-> Δh<c- p=\"\">;</c->\n\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">*</c-> Cdash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> <c- mf=\"\">0</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->habs <c- o=\"\">&lt;=</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hdiff <c- o=\"\">&gt;</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff <c- o=\"\">-</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hdiff <c- o=\"\">&lt;</c-> <c- o=\"\">-</c-><c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\tΔh <c- o=\"\">=</c-> hdiff <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- p=\"\">{</c->\n\t\tconsole<c- p=\"\">.</c->log<c- p=\"\">(</c-><c- u=\"\">\"the unthinkable has happened\"</c-><c- p=\"\">);</c->\n\t<c- p=\"\">}</c->\n\n\t<c- c1=\"\">// weighted Hue difference, more for larger Chroma</c->\n\t<c- a=\"\">let</c-> ΔH <c- o=\"\">=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Cdash2 <c- o=\"\">*</c-> Cdash1<c- p=\"\">)</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c->Δh <c- o=\"\">*</c-> d2r <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// calculate mean Lightness and Chroma</c->\n\t<c- a=\"\">let</c-> Ldash <c- o=\"\">=</c-> <c- p=\"\">(</c->L1 <c- o=\"\">+</c-> L2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Cdash <c- o=\"\">=</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">+</c-> Cdash2<c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Cdash7 <c- o=\"\">=</c-> Math<c- p=\"\">.</c->pow<c- p=\"\">(</c->Cdash<c- p=\"\">,</c-> <c- mf=\"\">7</c-><c- p=\"\">);</c->\n\n\t<c- c1=\"\">// Compensate for non-linearity in the blue region of Lab.</c->\n\t<c- c1=\"\">// Four possibilities for hue weighting factor,</c->\n\t<c- c1=\"\">// depending on the angles, to get the correct sign</c->\n\t<c- a=\"\">let</c-> hdash<c- p=\"\">;</c->\n\t<c- k=\"\">if</c-> <c- p=\"\">(</c->Cdash1 <c- o=\"\">*</c-> Cdash2 <c- o=\"\">===</c-> <c- mf=\"\">0</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> hsum<c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->habs <c- o=\"\">&lt;=</c-> <c- mf=\"\">180</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> hsum <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- k=\"\">if</c-> <c- p=\"\">(</c->hsum <c- o=\"\">&lt;</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> <c- p=\"\">(</c->hsum <c- o=\"\">+</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\t<c- k=\"\">else</c-> <c- p=\"\">{</c->\n\t\thdash <c- o=\"\">=</c-> <c- p=\"\">(</c->hsum <c- o=\"\">-</c-> <c- mf=\"\">360</c-><c- p=\"\">)</c-> <c- o=\"\">/</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- p=\"\">}</c->\n\n\t<c- c1=\"\">// positional corrections to the lack of uniformity of CIELAB</c->\n\t<c- c1=\"\">// These are all trying to make JND ellipsoids more like spheres</c->\n\n\t<c- c1=\"\">// SL Lightness crispening factor</c->\n\t<c- c1=\"\">// a background with L=50 is assumed</c->\n\t<c- a=\"\">let</c-> lsq <c- o=\"\">=</c-> <c- p=\"\">(</c->Ldash <c- o=\"\">-</c-> <c- mf=\"\">50</c-><c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> SL <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- p=\"\">((</c-><c- mf=\"\">0.015</c-> <c- o=\"\">*</c-> lsq<c- p=\"\">)</c-> <c- o=\"\">/</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c-><c- mf=\"\">20</c-> <c- o=\"\">+</c-> lsq<c- p=\"\">));</c->\n\n\t<c- c1=\"\">// SC Chroma factor, similar to those in CMC and deltaE 94 formulae</c->\n\t<c- a=\"\">let</c-> SC <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- mf=\"\">0.045</c-> <c- o=\"\">*</c-> Cdash<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Cross term T for blue non-linearity</c->\n\t<c- a=\"\">let</c-> T <c- o=\"\">=</c-> <c- mf=\"\">1</c-><c- p=\"\">;</c->\n\tT <c- o=\"\">-=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.17</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">((</c->     hdash <c- o=\"\">-</c-> <c- mf=\"\">30</c-><c- p=\"\">)</c->  <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">+=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.24</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(</c->  <c- mf=\"\">2</c-> <c- o=\"\">*</c-> hdash        <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">+=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.32</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(((</c-><c- mf=\"\">3</c-> <c- o=\"\">*</c-> hdash<c- p=\"\">)</c-> <c- o=\"\">+</c-> <c- mf=\"\">6</c-><c- p=\"\">)</c->  <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\tT <c- o=\"\">-=</c-> <c- p=\"\">(</c-><c- mf=\"\">0.20</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->cos<c- p=\"\">(((</c-><c- mf=\"\">4</c-> <c- o=\"\">*</c-> hdash<c- p=\"\">)</c-> <c- o=\"\">-</c-> <c- mf=\"\">63</c-><c- p=\"\">)</c-> <c- o=\"\">*</c-> d2r<c- p=\"\">));</c->\n\n\t<c- c1=\"\">// SH Hue factor depends on Chroma,</c->\n\t<c- c1=\"\">// as well as adjusted hue angle like deltaE94.</c->\n\t<c- a=\"\">let</c-> SH <c- o=\"\">=</c-> <c- mf=\"\">1</c-> <c- o=\"\">+</c-> <c- mf=\"\">0.015</c-> <c- o=\"\">*</c-> Cdash <c- o=\"\">*</c-> T<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// RT Hue rotation term compensates for rotation of JND ellipses</c->\n\t<c- c1=\"\">// and Munsell constant hue lines</c->\n\t<c- c1=\"\">// in the medium-high Chroma blue region</c->\n\t<c- c1=\"\">// (Hue 225 to 315)</c->\n\t<c- a=\"\">let</c-> Δθ <c- o=\"\">=</c-> <c- mf=\"\">30</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->exp<c- p=\"\">(</c-><c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">*</c-> <c- p=\"\">(((</c->hdash <c- o=\"\">-</c-> <c- mf=\"\">275</c-><c- p=\"\">)</c-><c- o=\"\">/</c-><c- mf=\"\">25</c-><c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">));</c->\n\t<c- a=\"\">let</c-> RC <c- o=\"\">=</c-> <c- mf=\"\">2</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->Cdash7<c- o=\"\">/</c-><c- p=\"\">(</c->Cdash7 <c- o=\"\">+</c-> Gfactor<c- p=\"\">));</c->\n\t<c- a=\"\">let</c-> RT <c- o=\"\">=</c-> <c- o=\"\">-</c-><c- mf=\"\">1</c-> <c- o=\"\">*</c-> Math<c- p=\"\">.</c->sin<c- p=\"\">(</c-><c- mf=\"\">2</c-> <c- o=\"\">*</c-> Δθ <c- o=\"\">*</c-> d2r<c- p=\"\">)</c-> <c- o=\"\">*</c-> RC<c- p=\"\">;</c->\n\n\t<c- c1=\"\">// Finally calculate the deltaE, term by term as root sum of squares</c->\n\t<c- a=\"\">let</c-> dE <c- o=\"\">=</c-> <c- p=\"\">(</c->ΔL <c- o=\"\">/</c-> SL<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> <c- p=\"\">(</c->ΔC <c- o=\"\">/</c-> SC<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> <c- p=\"\">(</c->ΔH <c- o=\"\">/</c-> SH<c- p=\"\">)</c-> <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">;</c->\n\tdE <c- o=\"\">+=</c-> RT <c- o=\"\">*</c-> <c- p=\"\">(</c->ΔC <c- o=\"\">/</c-> SC<c- p=\"\">)</c-> <c- o=\"\">*</c-> <c- p=\"\">(</c->ΔH <c- o=\"\">/</c-> SH<c- p=\"\">);</c->\n\t<c- k=\"\">return</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->dE<c- p=\"\">);</c->\n\t<c- c1=\"\">// Yay!!!</c->\n<c- p=\"\">};</c-></pre>\n    <h3 class=\"heading settled\" data-level=\"19.2\" id=\"color-difference-OK\"><span class=\"secno\">19.2. </span><span class=\"content\">ΔEOK</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#color-difference-OK\"></a></h3>\n    <p>\n\tBecause Oklab does not suffer from\n\tthe hue linearity, hue uniformity,\n\tand chroma non-linearities of CIE Lab,\n\tthe color difference metric does not need to correct for them\n\tand so\n\tis simply the Euclidean distance in Oklab color space.\n</p>\n<pre class=\"highlight include-code lang-javascript\"><c- c1=\"\">// Calculate deltaE OK</c->\n<c- c1=\"\">// simple root sum of squares</c->\n<c- d=\"\">/**</c->\n<c- d=\"\"> * @param {number[]} reference - Array of OKLab values: L as 0..1, a and b as -1..1</c->\n<c- d=\"\"> * @param {number[]} sample - Array of OKLab values: L as 0..1, a and b as -1..1</c->\n<c- d=\"\"> * @return {number} How different a color sample is from reference</c->\n<c- d=\"\"> */</c->\n<c- a=\"\">function</c-> deltaEOK <c- p=\"\">(</c->reference<c- p=\"\">,</c-> sample<c- p=\"\">)</c-> <c- p=\"\">{</c->\n    <c- a=\"\">let</c-> <c- p=\"\">[</c->L1<c- p=\"\">,</c-> a1<c- p=\"\">,</c-> b1<c- p=\"\">]</c-> <c- o=\"\">=</c-> reference<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> <c- p=\"\">[</c->L2<c- p=\"\">,</c-> a2<c- p=\"\">,</c-> b2<c- p=\"\">]</c-> <c- o=\"\">=</c-> sample<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> ΔL <c- o=\"\">=</c-> L1 <c- o=\"\">-</c-> L2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Δa <c- o=\"\">=</c-> a1 <c- o=\"\">-</c-> a2<c- p=\"\">;</c->\n\t<c- a=\"\">let</c-> Δb <c- o=\"\">=</c-> b1 <c- o=\"\">-</c-> b2<c- p=\"\">;</c->\n\t<c- k=\"\">return</c-> Math<c- p=\"\">.</c->sqrt<c- p=\"\">(</c->ΔL <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> Δa <c- o=\"\">**</c-> <c- mf=\"\">2</c-> <c- o=\"\">+</c-> Δb <c- o=\"\">**</c-> <c- mf=\"\">2</c-><c- p=\"\">);</c->\n<c- p=\"\">}</c-></pre>\n    <h2 class=\"heading no-num settled\" id=\"deprecated-system-colors\"><span class=\"content\">\nAppendix A: Deprecated CSS System Colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#deprecated-system-colors\"></a></h2>\n    <p>Earlier versions of CSS defined several additional <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑥\">system colors</a>.\n\tThese color keywords have been <strong>deprecated</strong>, however,\n\tas they are insufficient for their original purpose\n\t(making website elements look like their native OS counterparts),\n\trepresent a security risk\n\tby making it easier for a webpage to “spoof” a native OS dialog,\n\tand increase fingerprinting surface, compromising user privacy.</p>\n    <p>User agents must support these keywords,\n\tand to mitigate fingerprinting\n\tmust map them to the (undeprecated) <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑦\">system colors</a>\n\tas listed below.\n\t<strong>Authors must not use these keywords.</strong></p>\n    <p>The deprecated system colors are represented\n\tas the <dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-type=\"type\" data-export=\"\" id=\"typedef-deprecated-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-deprecated-color\" id=\"ref-for-typedef-deprecated-color②\">&lt;deprecated-color&gt;</a></dfn> sub-type,\n\tand are defined as:</p>\n    <dl>\n     <dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-activeborder\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ActiveBorder</dfn>\n\t\t\n     </dt><dd>Active window border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder②\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-activecaption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ActiveCaption</dfn>\n\t\t\n     </dt><dd>Active window caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑤\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-appworkspace\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">AppWorkspace</dfn>\n\t\t\n     </dt><dd>Background color of multiple document interface. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑥\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-background\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Background</dfn>\n\t\t\n     </dt><dd>Desktop background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑦\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-buttonhighlight\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ButtonHighlight</dfn>\n\t\t\n     </dt><dd>The color of the border facing the light source for 3-D elements\n\t\tthat appear 3-D due to one layer of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface②\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-buttonshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ButtonShadow</dfn>\n\t\t\n     </dt><dd>The color of the border away from the light source for 3-D elements\n\t\tthat appear 3-D due to one layer of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface③\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-captiontext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CaptionText</dfn>\n\t\t\n     </dt><dd>Text in caption, size box, and scrollbar arrow box. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext①\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactiveborder\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveBorder</dfn>\n\t\t\n     </dt><dd>Inactive window border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder③\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactivecaption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveCaption</dfn>\n\t\t\n     </dt><dd>Inactive window caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑧\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-inactivecaptiontext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InactiveCaptionText</dfn>\n\t\t\n     </dt><dd>Color of text in an inactive caption. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-graytext\" id=\"ref-for-valdef-color-graytext①\">GrayText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-infobackground\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InfoBackground</dfn>\n\t\t\n     </dt><dd>Background color for tooltip controls. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas⑨\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-infotext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">InfoText</dfn>\n\t\t\n     </dt><dd>Text color for tooltip controls. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext②\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-menu\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Menu</dfn>\n\t\t\n     </dt><dd>Menu background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①⓪\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-menutext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">MenuText</dfn>\n\t\t\n     </dt><dd>Text in menus. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext③\">CanvasText</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-scrollbar\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Scrollbar</dfn>\n\t\t\n     </dt><dd>Scroll bar gray area. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①①\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threeddarkshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDDarkShadow</dfn>\n\t\t\n     </dt><dd>The color of the darker (generally outer) of the two borders away\n\t\tfrom the light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder④\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedface\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDFace</dfn>\n\t\t\n     </dt><dd>The face background color for 3-D elements that appear 3-D due to\n\t\ttwo concentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonface\" id=\"ref-for-valdef-color-buttonface④\">ButtonFace</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedhighlight\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDHighlight</dfn>\n\t\t\n     </dt><dd>The color of the lighter (generally outer) of the two borders facing\n\t\tthe light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑤\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedlightshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDLightShadow</dfn>\n\t\t\n     </dt><dd>The color of the darker (generally inner) of the two borders facing\n\t\tthe light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑥\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-threedshadow\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ThreeDShadow</dfn>\n\t\t\n     </dt><dd>The color of the lighter (generally inner) of the two borders away\n\t\tfrom the light source for 3-D elements that appear 3-D due to two\n\t\tconcentric layers of surrounding border. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑦\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-window\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Window</dfn>\n\t\t\n     </dt><dd>Window background. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvas\" id=\"ref-for-valdef-color-canvas①②\">Canvas</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-windowframe\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WindowFrame</dfn>\n\t\t\n     </dt><dd>Window frame. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-buttonborder\" id=\"ref-for-valdef-color-buttonborder⑧\">ButtonBorder</a>.\n\n\t\t\n     </dd><dt><dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-for=\"&lt;color&gt;, &lt;deprecated-color&gt;\" data-dfn-type=\"value\" data-export=\"\" id=\"valdef-color-windowtext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WindowText</dfn>\n\t\t\n     </dt><dd>Text in windows. Same as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-canvastext\" id=\"ref-for-valdef-color-canvastext④\">CanvasText</a>.\n\t\n    </dd></dl>\n    \n    <h2 class=\"heading no-num settled\" id=\"quirky-color\"><span class=\"content\">\nAppendix B: Deprecated Quirky Hex Colors</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#quirky-color\"></a></h2>\n    <p>When CSS is being parsed in <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-quirks\" id=\"ref-for-concept-document-quirks\">quirks mode</a>,\n\t<dfn class=\"css dfn-paneled has-dfn-panel\" data-dfn-type=\"type\" data-export=\"\" id=\"typedef-quirky-color\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color\">&lt;quirky-color&gt;</a></dfn> is a type of <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑤\">&lt;color&gt;</a>\n\tthat is only valid in certain properties:</p>\n    <ul>\n     <li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-background-color\" id=\"ref-for-propdef-background-color\">background-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-color\" id=\"ref-for-propdef-border-color①\">border-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-top-color\" id=\"ref-for-propdef-border-top-color\">border-top-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-right-color\" id=\"ref-for-propdef-border-right-color\">border-right-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-bottom-color\" id=\"ref-for-propdef-border-bottom-color\">border-bottom-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-border-left-color\" id=\"ref-for-propdef-border-left-color\">border-left-color</a></p>\n     </li><li data-md=\"\">\n      <p><a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-4/#propdef-color\" id=\"ref-for-propdef-color⑧\">color</a></p>\n    </li></ul>\n    <p>It is <em>not</em> valid in properties that include or reference these properties,\n\tsuch as the <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-backgrounds-3/#propdef-background\" id=\"ref-for-propdef-background\">background</a> shorthand,\n\tor inside <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#functional-notation\" id=\"ref-for-functional-notation①\">functional notations</a>\n\t</p>\n    <p>Additionally, while <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color①\">&lt;quirky-color&gt;</a> must be valid as a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑥\">&lt;color&gt;</a>\n\twhen parsing the affected properties in the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-conditional-3/#at-ruledef-supports\" id=\"ref-for-at-ruledef-supports\">@supports</a> rule,\n\tit is <em>not</em> valid for those properties\n\twhen used in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-conditional-3/#dom-css-supports-conditiontext\" id=\"ref-for-dom-css-supports-conditiontext\">CSS.supports()</a></code> method.</p>\n    <p>A <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-quirky-color\" id=\"ref-for-typedef-quirky-color②\">&lt;quirky-color&gt;</a> can be represented\n\tas a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-number-token\" id=\"ref-for-typedef-number-token\">&lt;number-token&gt;</a>, <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-dimension-token\" id=\"ref-for-typedef-dimension-token\">&lt;dimension-token&gt;</a>, or <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-ident-token\" id=\"ref-for-typedef-ident-token\">&lt;ident-token&gt;</a>,\n\taccording to the following rules:</p>\n    <ul>\n     <li data-md=\"\">\n      <p>If it’s an <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-ident-token\" id=\"ref-for-typedef-ident-token①\">&lt;ident-token&gt;</a>,\nthe token’s representation must contain exactly 3 or 6 characters,\nall hexadecimal digits.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color①\">&lt;hex-color&gt;</a> with the same value.</p>\n     </li><li data-md=\"\">\n      <p>If it’s a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-number-token\" id=\"ref-for-typedef-number-token①\">&lt;number-token&gt;</a>,\nit must have its integer flag set.</p>\n      <p>Serialize the integer’s value.\nIf the serialization has less than 6 characters,\nprepend \"0\" characters to it until it is 6 characters long.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color②\">&lt;hex-color&gt;</a> with the same value.</p>\n     </li><li data-md=\"\">\n      <p>If it’s a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-syntax-3/#typedef-dimension-token\" id=\"ref-for-typedef-dimension-token①\">&lt;dimension-token&gt;</a>,\nit must have its integer flag set.</p>\n      <p>Serialize the integer’s value,\nand append the representation of the token’s unit.\nIf the result has less than 6 characters,\nprepend \"0\" characters to it until it is 6 characters long.\nIt represents a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-hex-color\" id=\"ref-for-typedef-hex-color③\">&lt;hex-color&gt;</a> with the same value.</p>\n    </li></ul>\n    <p>(In other words, Quirks Mode allows hex colors to be written without the leading \"#\",\n\tbut with weird parsing rules.)</p>\n    \n    <h2 class=\"heading no-num no-ref settled\" id=\"acknowledgments\"><span class=\"content\">\nAcknowledgments</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#acknowledgments\"></a></h2>\n    <p>In addition to <a href=\"https://www.w3.org/TR/css-color-3/#acknowledgments\">those\nwho contributed to CSS Color 3</a>, the editors would like to thank\nEmilio Cobos Álvarez, Alexey Ardov, Chris Bai, Amelia Bellamy-Royds, Lars Borg, Mike Bremford, Andreu Botella, Dan Burzo, Max Derhak, fantasai, Simon Fraser, Devon Govett, Phil Green, Dean Jackson, Andreas Kraushaar, Pierre-Anthony Lemieux, Tiaan Louw, Cameron McCormack, Romain Menke, Chris Murphy, Isaac Muse, Jonathan Neal, Chris Needham, Björn Ottosson, Christoph Päper, Brad Pettit, Xidorn Quan, Craig Revie, Melanie Richards, Florian Rivoal, Jacob Rus, Joseph Salowey, Simon Sapin, Igor Snitkin, Lea Verou, Mark Watson, James Stuckey Weber, Sam Weinig, and Natalie Weizenbaum.</p>\n    <h2 class=\"heading no-num settled\" id=\"changes\"><span class=\"content\">\nChanges</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes\"></a></h2>\n    <h3 class=\"heading settled\" id=\"changes-from-20250424\"><span class=\"content\">Changes since the \n\t<a href=\"https://www.w3.org/TR/2025/CRD-css-color-4-20250424/\">Candidate Recommendation Draft of 24 April 2025</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20250424\"></a></h3>\n    <ul>\n     <li>Updated <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-accentcolor\" id=\"ref-for-valdef-color-accentcolor③\">AccentColor</a> to take its value from <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-ui-4/#propdef-accent-color\" id=\"ref-for-propdef-accent-color①\">accent-color</a>, unless in <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-adjust-1/#forced-colors-mode\" id=\"ref-for-forced-colors-mode②\">Forced Colors Mode</a>\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/5900\">Issue 5900</a>)\n\t\n     </li><li>Defined rec2020 color space to use display-referred, 2.4 gamma\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/12574\">Issue 12574</a>)\n\t\n     </li><li>Added display-p3-linear to predefined colorspaces\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/11250\">Issue 11250</a>)\n\t\n     </li><li>Clarified serializing opacity values with calc() \n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/10426\">Issue 10426</a>)\n\t\n     </li><li>Interpolation between legacy sRGB colors is (once again) in sRGB space, for compatibility\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/7949\">Issue 7949</a>)\n\t\n     </li><li>Clarified real-world CIE Lab range for a and b \n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/12208\">Issue 12208</a>)\n\t\n     </li><li>Clarified that Opacity value does not affect hit testing\n\t\t(<a href=\"https://github.com/w3c/csswg-drafts/issues/11339\">Issue 11339</a>)\n\t\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20240213\"><span class=\"content\">Changes since the <a href=\"https://www.w3.org/TR/2024/CRD-css-color-4-20240213/\">Candidate Recommendation Draft of 13 Feb 2024</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20240213\"></a></h3>\n    <ul>\n     <li>Clarified that inside the color property, it is the resolved inherited value (not the raw inherited value) that is used\n     </li><li>Listed categories of colors, such as those that resolve to sRGB or support legacy color syntax\n     </li><li>Added hue normalization examples\n     </li><li>Corrected table of analogous components, alpha was missing, but described as analogous in prose\n     </li><li>Collected together and clarified serialization of opacity values into one section\n     </li><li>Clarified wording around color-interpolation-method and host syntax\n     </li><li>Defined epsilon for returning missing hue\n     </li><li>Used a more precise definition of achromatic colors with missing hues (sufficiently close to the central axis)\n     </li><li>Consistently use \"color component\" rather than \"color channel\" (both were being used).\n     </li><li>Correlated Color Temperature was used without being defined or explained. Added informative reference.\n     </li><li>Exported term premultiplied, linked to it consistently\n     </li><li>Equivalence of deprecated and un-deprecated system colors is no longer at-risk\n     </li><li>Clarified intended use of the \"parse a CSS <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-color-4/#typedef-color\" id=\"ref-for-typedef-color②⑦\">&lt;color&gt;</a>\" algorithm\n     </li><li>Added corrected examples for HTML-compatible serialization\n     </li><li>Removed check on missing values for HTML-compatible serialization, they will already have been converted to zero\n     </li><li>Moved note about missing values becoming 0, so it applies to both HTML-compatible and CSS serializations\n     </li><li>Added an HTML-Compatible hex serialization for sRGB\n     </li><li>Added another  xyz-d65 and xyz-d50 example\n     </li><li>Clarify which component (Y) in XYZ corresponds to brightness\n     </li><li>Clarified that CSS gamut mapping applies on actual, not used, values\n     </li><li>Removed hue normalization from the hslToRgb sample code, as the input is already normalized at parse time\n     </li><li>Corrected the pseudo-code for step 4 of the gamut mapping algorithm\n     </li><li>Clarified that interpolation is the most common situation which combines two colors, but not the only one. \n     </li><li>Ensured adequate contrast for text in the deltaE table\n     </li><li>Removed remaining use of the term &lt;absolute-color-function&gt;, use &lt;absolute-color&gt; function instead for consistency\n     </li><li>Updated acknowledgements section\n     </li><li>Added gamut mesh diagram\n     </li><li>Described CSSOM serialization in terms of declared values rather than specified values\n     </li><li>Added exported definition of luminance\n     </li><li>Added production rule for &lt;opacity-value&gt; \n     </li><li>Clarified when results from hslToRgb will be in [0,1]\n     </li><li>Clarified that once linearized, RGB spaces are additive\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20221101\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/CRD-css-color-4-20221101/\">Candidate Recommendation Draft of 1 November 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20221101\"></a></h3>\n    <ul>\n     <li>Added steps for serializing a uint8_t alpha, moved from cssom-1\n     </li><li>Restored parse-time clamping of HSL negative saturation to 0, which is current interop behavior from CSS Color 3\n     </li><li>When interpolating, always convert color space, so that powerless components become missing\n     </li><li>Clarified when alpha 1 is omitted from serialization\n     </li><li>Removed redundant constraining of hue angles to [0,360] as this is already done.\n     </li><li>Corrected description of ActiveCaption, which is a background. \n     </li><li>Disambiguated opacity and alpha. Opacity property now uses opacity-value (which has different clamping behavior to alpha-value)\n     </li><li>Clarified that carrying forward happens before premultiplication\n     </li><li>Updated gamut mapping algorithm\n     </li><li>Fixed a few issues regarding hue interpolation \n     </li><li>Clarified that HWB white or black at 100% is insufficient criterion for an achromatic color; it is the sum which matters.\n     </li><li>Avoid returning negative saturation in rgb to hsl conversion; adjust the hue to point to \"the other side\" instead\n     </li><li>Use 64 bit accurate matrices for ProPhoto, which does not have a rational form\n     </li><li>Oklab matrices recalculated for 64bit precision (returns same results as before, at 32 bit precision)\n     </li><li>Consistently return output of GMA in the destination color space, even if no mapping is performed because the destination is unbounded\n     </li><li>Added explanation for why one JND for Oklab is 0.02, not 2 \n     </li><li>Clarified that resolving sRGB values does not apply to the color() function\n     </li><li>Moved alpha value definition up to the opacity property, clarified that opacity specified values are not clamped.\n     </li><li>System Colors now explicitly permit spoofing, to preserve privacy\n     </li><li>Corrected the inverse chromatic adaptation matrix for D50 to D65 \n     </li><li>Consistently distinguish linear Bradfrod from the original, more complicated, Bradford chromatic adaptation algorithm\n     </li><li>In the gamut mapping algorithm, return clipped as the gamut mapped result, avoiding un-necessary steps\n     </li><li>Updated chromatic adaptation matrices to higher precision\n     </li><li>Added Add 'parse a css color' algorithm, so non-CSS specs using colors don’t have to reinvent the machinery here.\n     </li><li>Clarified that geometric gamut mapping must not project chroma back beyond the original color\n     </li><li>Use the term \"geometric\" rather than \"analytical\" in gamut mapping discussion\n     </li><li>Aligned prose for HSL into line with the grammar (percent and number both allowed)\n     </li><li>Fixed an LCH alpha interpolation example, which was erroneously un-premultiplying the hue angle\n     </li><li>Corrected the sRGB and display-p3 transfer function. (This only affected the result if a component had the exact value 10.31475 / 255, which is not possible at 8 or 10 bits per component)\n     </li><li>Clarified that the specified values of system colors are still themselves\n     </li><li>Added mention of PNG cICP chunk for tagging images\n     </li><li>Described behaviour of hue increasing and decreasing when 0/360 is passed \n     </li><li>Aligned description of powerlessnes in HSL with the other polar color models\n     </li><li>Explicitly defined order of operations for color interpolation\n     </li><li>Added mention of degenerate numeric constants in calc()\n     </li><li>Clarified that calc() in sRGB has early resolution, and clamps the result\n     </li><li>Clarified that HWB hue has the same disadvantages as HSL hue\n     </li><li>Added luminance to lightness comparison and figure\n     </li><li>Added descriptions and examples for hue interpolation keywords\n     </li><li>Use normative prose for achromatic HWB colors\n     </li><li>Corrected hue interpolation angle range; [0,360) not [0,360]\n     </li><li>Expressed that displaying as black or white when L=0% or 100% is due to gamut mapping. Removed incorrect assertions of powerlessness\n     </li><li>Dropped the confusing \"representing black\" and \"representing white\" comments\n     </li><li>Clarified that opponent a and b are analogous\n     </li><li>Specified RGB components using reference ranges rather than prose, for consistency\n     </li><li>Explicitly referenced percent reference ranges for percentage to number conversion when serializing Lab, LCH, Oklab, OkLCh\n     </li><li>Required Oklab interpolation, remove previous \"may\", describe explicit opt-out\n     </li><li>Labelled the Lab, LCH, Oklab and OkLCh tutorial sections as non-normative. Moved some definitions out of the non-normative section.\n     </li><li>Clarified that, when interpolating, checking for analogous components happens before color space conversion\n     </li><li>Back-ported hwb() syntax changes and reference ranges from CSS Color 5\n     </li><li>Defined carry-forward operations must happen before powerless operations\n     </li><li>Clarified it is <em>color</em> components which must be all-number or all-percentage, in legacy rgb() syntax\n     </li><li>Clarified for legacy syntax that color components must be all-percentage or all-number\n     </li><li>Added examples of specified out of range alpha, with and without calc()\n     </li><li>Placed examples of serializing with trimmed trailing zeroes colorer to the relevant text\n     </li><li>clarified example, used value of text-shadow\n     </li><li>Clarified resolving currentColor\n     </li><li>Updated acknowledgments\n     </li><li>Stop claiming that achromatic colors have missing a,b, or chroma\n     </li><li>HSL and HWB changed to unbounded gamut, to promote round-tripping\n     </li><li>Defined percentage reference range for HSL\n     </li><li>Modern color syntax hsl() and hsla() allow mixed number and percentage components\n     </li><li>Modern color syntax rgb() and rgba() allow mixed number and percentage components\n     </li><li>Define the term \"modern color syntax\" (legacy color syntax already defined).\n     </li><li>Consistently use the term \"analogous components\"\n     </li><li>Changed to allow all predefined color spaces for interpolation\n     </li><li>Clarified that for color(), three parameters (RGB or XYZ) are required\n     </li><li>Clarified serialization of named colors, system colors, and transparent\n     </li><li>Define specified value for Lab, LCH, Oklab, OkLCh\n     </li><li>Define specified value for other sRGB colors\n     </li><li>Define specified values for named and system colors\n     </li><li>Clamp alpha, Lightness, Chroma and Hue at parsed-value time\n     </li><li>Remove passing mention of specular white and CIE Lightness\n     </li><li>No longer require as-specified Hue to be retained; clamp to [0, 360]\n     </li><li>Consistent serialization of Lightness and number in examples\n     </li><li>Minor typos and editorial clarifications\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220705\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/CR-css-color-4-20220705/\">Candidate Recommendation of 5 July 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220705\"></a></h3>\n    <ul>\n     <li>Removed hue interpolation \"specified\" value\n     </li><li>Defined hue interpolation angle more precisely, maintaining differences of 360deg\n     </li><li>Added example of carried forward alpha for premultiplication\n     </li><li>Clarified a,b and C,h powerless at L=100% representing white.\n     </li><li>Removed handwavy mention of L=400 which applies to hdr-CIELAB not CIE Lab\n     </li><li>Consistent capitalization of Oklab and OkLCh\n     </li><li>Moved definitions of valid color, invalid color, out of gamut and in gamut to terminology section\n     </li><li>Fixed definition of \"longer\" hue interpolation\n     </li><li>Further clarified the concept of a host syntax\n     </li><li>Accessibility improvements for color swatches\n     </li><li>Made explicit that legacy forms do not support \"none\"\n     </li><li>Remove \"none\" from the hue production, as it is not allowed in legacy syntax\n     </li><li>Removed some dangling references to CMYK and CMYKOGV, moved to CSS Color5\n     </li><li>Clarified how missing values in colors to be interpolated are carried forward\n     </li><li>Updated syntax of xyz-params so they take numbers and percentage, to align with prose\n     </li><li>Ensure all examples and figures have IDs, self-links\n     </li><li>Clarified importance to implementors of reading the gamut mapping introduction\n     </li><li>Removed left-over mention of custom color spaces (feature was moved to CSS Color 5)\n     </li><li>Refactor syntax of &lt;color&gt; and &lt;alpha-value&gt;\n     </li><li>Editorial refactoring for better reading order.\n     </li><li>Updated pseudocode for gamut mapping algorithm, remove un-needed deltaE calls\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220628\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/WD-css-color-4-20220628/\">Working Draft of 28 June 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220628\"></a></h3>\n    <ul>\n     <li>Updated status for Candidate Recommendation\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20220428\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2022/WD-css-color-4-20220428/\">Working Draft of 28 April 2022</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20220428\"></a></h3>\n    <ul>\n     <li>Moved opacity property up to the top of the module, next to color property, before getting into details.\n     </li><li>Improved description of the color property, in particular effect on other properties\n     </li><li>Corrected longer hue adjust equation, for equal-modulo-360 colors\n     </li><li>Added two new System colors: AccentColor and AccentColorText\n\t\n     </li><li>Described overall color space conversion steps in new section\n     </li><li>Accounted for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①③\">none</a> alpha in premultiplication and un-premultiplication\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-20211215\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2021/WD-css-color-4-20211215/\">Working Draft of 15 December 2021</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20211215\"></a></h3>\n    <ul>\n     <li>Made system colors fully resolve, but forbid their alteration in forced colors mode\n     </li><li>Removed forgiveness for incorrect number of parameters in color() function\n     </li><li>Changed serialization of CIE Lightness and OK Lightness to number rather than percentage.\n     </li><li>Marked deprecated system color equivalences as at-risk\n     </li><li>Added reference ranges to percentage values for CIE and OK L,a,b,C\n     </li><li>Noted that there is sample code for performing and undoing premultiplication, for both rectangular and polar color spaces.\n     </li><li>Added out of range clamping to the gamut mapping prose, as well as the pseudocode\n     </li><li>Added normative reference for ProPhoto RGB / ROMM\n     </li><li>Corrected sRGB and Display P3 black point value for reference surround\n     </li><li>Added normative reference for Display P3\n     </li><li>Avoided an infinite loop in gamut reduction, with colors whiter than white or darker than black\n     </li><li>Clarified serialization of the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①④\">none</a> value\n     </li><li>Clarified the opt-in to interpolation in Oklab, for non-legacy colors\n     </li><li>Defined how premultiplication works, with the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑤\">none</a> value\n     </li><li>Clarified that missing values in rgb serialize as 0\n     </li><li>Clarified the use of calc() with the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑥\">none</a> value\n     </li><li>Typo, inconsistent casing on System Colors\n     </li><li>Added example of SelectedItem with SelectedItemText\n     </li><li>Explicitly noted the presence or absence of legacy colors\n     </li><li>Added normative reference for CIE XYZ\n     </li><li>Added normative reference for HWB and HSL\n     </li><li>Clarified that <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-hwb\" id=\"ref-for-funcdef-hwb①②\">hwb()</a> is not a legacy syntax so does not support the older, comma-separated syntactic form\n     </li><li>Clarified that only legacy colors will gamut map, the others are unbounded\n     </li><li>Use distinct terms, spectrophotometer and spectroradiometer\n     </li><li>Assorted minor typos fixed, and grammatical improvements\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20210601\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2021/WD-css-color-4-20210601/\">Working Draft of 1 June 2021</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20210601\"></a></h3>\n    <ul>\n     <li>Added gamut mapping section and defined a CSS gamut mapping algorithm as chroma reduction in OkLCh with local MINDE.\n     </li><li>Computed value of color(xyz ...) is color(xyz-d65 ...)\n     </li><li>Added srgb-linear to interpolation color spaces\n     </li><li>Updated Changes from Colors 3 section\n     </li><li>Added Resolving Oklab and OkLCh values section\n     </li><li>Added srgb-linear color space\n     </li><li>Moved @color-profile and device-cmyk to level 5 per CSSWG resolution\n     </li><li>Defined interpolation color space\n     </li><li>Clarified that matrices are row-major and linked to the matrix multiplication library\n     </li><li>Split old Security &amp; Privacy section into separate sections\n     </li><li>Defined quirks-mode quirky hex colors\n     </li><li>Removed fallback colors from device-cmyk\n     </li><li>Host syntax that does not declare a default now uses Oklab by default\n     </li><li>Added sample code for deltaE OK\n     </li><li>Added sample conversion code for OKlab and OkLCh\n     </li><li>Added oklab() and oklch() functions\n     \n\t<i>Added description of Oklab and OkLCh</i>\n\t\n     </li><li>Added description of CIE LCH deficiencies\n     </li><li>Allowed all components of a color to be \"missing\" via the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#valdef-color-none\" id=\"ref-for-valdef-color-none①⑦\">none</a> keyword,\n\t\tdefined when components are \"powerless\" and automatically become missing in some cases,\n\t\tand fixed all references to \"NaN\" components to use the \"missing\" concept.\n     </li><li>Defined explicit x,y whitepoint values, use consistently throughout\n     </li><li>Defined the term host syntax\n     </li><li>Defined context for resolving override-color colors\n     </li><li>Added a new pair of system colors\n     </li><li>Corrected HSL and HWB sample code\n     </li><li>Replaced table of HSL values with error-free version\n     </li><li>Added Lea Verou as co-editor by WG resolution\n     </li><li>Clarified that hue angle is unbounded\n     </li><li>MarkText example corrected\n     </li><li>Added diagrams, corrected examples\n     </li><li>Some editorial clarifications\n     </li><li>Minor typos corrected, markup corrections\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20201112\"><span class=\"content\">Changes since the\n\t<a href=\"https://www.w3.org/TR/2020/WD-css-color-4-20201112/\">Working Draft of 12 November 2020</a>\n</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20201112\"></a></h3>\n    <ul>\n     <li>Noted indeterminate hue ssue on near-neutral Lab values converted to LCH\n     </li><li>Clarified which steps are linear combinations in RGB Lab interconversion\n     </li><li>Added components descriptor to @color-profile, for use in CSS Color 5\n     </li><li>All predefined RGB color spaces are defined over the extended range\n     </li><li>Clarified that there is no gamut mapping or gamut clipping step prior to color interpolation\n     </li><li>Clarified interpolation of legacy sRGB syntaxes\n     </li><li>Removed the lab option from <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①③\">color()</a>\n     </li><li>List steps to interconvert between predefined color spaces\n     </li><li>Consistent use of the term color space (two words)\n     </li><li>Provided more guidance on selecting color space for mixing \n     </li><li>Recalculated an example to increase precision\n     </li><li>Added hue interpolation example\n     </li><li>Simplified <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①④\">color()</a> syntax by removing the fallback options\n     </li><li>Clarified the types of ICC profile that may be linked from @color-profile\n     </li><li>Support for the rare ICC Named Colors was removed\n     </li><li>Improved precision of standard whitepoint chromaticities\n     </li><li>Removed a trademark from description of one predefined color space\n     </li><li>Rephrased interpolation to be more generic wrt to interpolation space\n     </li><li>Corrected Accessibility Considerations section\n     </li><li>Clarified that the color space argument for <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑤\">color()</a> is mandatory, even for sRGB\n     </li><li>Clarified that currentColor is not restricted to sRGB\n     </li><li>Small correction to the sRGB to XYZ to sRGB matrices, improve round-tripping\n     </li><li>Clarified the rec2020 transfer function, citing the correct ITU Rec BT.2020-2 reference\n     </li><li>Correct fallback examples to use the correct syntax\n     </li><li>Don’t force non-legacy colors to interpolate in a gamma-encoded space\n     </li><li>Define premultiplied alpha interpolation\n     </li><li>Start to address interpolation to and from currentColor\n     </li><li>Define hue interpolation with NaN\n     </li><li>Generalize color interpolation\n     </li><li>Define interpolation to be in Lab, with override to LCG\n     </li><li>Corrections to hue interpolation\n     </li><li>Defined hue angle interpolation\n     </li><li>Added interpolation section\n     </li><li>Corrected syntax in some examples\n     </li><li>Clarify exactly which components are allowed percentages, in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑥\">color()</a>\n     </li><li>Change to serialize <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lch\" id=\"ref-for-funcdef-lch⑨\">lch()</a> as itself rather than as <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-lab\" id=\"ref-for-funcdef-lab⑨\">lab()</a>\n     </li><li>Minimum 10 bits per component precision for non-legacy sRGB in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑦\">color()</a>\n     </li><li>color space no longer optional in <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑧\">color()</a> \n     </li><li>Consistent minimum precision between lab() and color(lab)\n     </li><li>Clarified fallback procedure for the color() function – first valid in-gamut color, else first valid color which is then gamut mapped, else transparent black\n     </li><li>Clarified difference between opacity property and colors with opacity, notably for rendering overlapping text glyphs\n     </li><li>Added sample (but verified correct) code for ΔE2000\n     </li><li>Added definition of previously-undefined term chromaticity, with examples; define chromaticity diagram.\n     </li><li>Added explanation of color additivity, with examples\n     </li><li>Added source links to WPT tests\n     </li><li>Export definition of color, and valid color, for other specifications to reference\n     </li><li>Define minimum number of bits per component, for serialization\n     </li><li>Updated \"applies to\" definitions (CSS-wide change)\n     </li><li>Added image state (display referred or scene referred) for predefined color spaces\n     </li><li>Listed white point correlated color temperature (e.g. D65) alongside chromaticity coordinates, for clarity\n     </li><li>Clarified that rounding is towards +∞\n     </li><li>Correction of typos, markup corrections, link fixes\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20191105\"><span class=\"content\">Changes since\n<a href=\"https://www.w3.org/TR/2019/WD-css-color-4-20191105/\">Working Draft of\n5 November 2019</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20191105\"></a></h3>\n    <ul>\n     <li>Export some terms for use in other specifications\n     </li><li>Update requirement from WCAG 2.0 to 2.1\n     </li><li>Fully specify Unicode characters used for serialization\n     </li><li>Define serialization of special named colors\n     </li><li>Define serialization of device-cmyk()\n     </li><li>Define serialization of <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color①⑨\">color()</a>\n     </li><li>Fully define RGB serialization, in maximally web-compatible way\n     </li><li>Define serialization of Lab and LCH\n     </li><li>Fully define serialization of alpha values\n     </li><li>Consistency pass to avoid accidental RFC2119\n     </li><li>Add IDs to all the examples, to enable referencing\n     </li><li>Separate resolved color and serialized color sections\n     </li><li>(Security) ICC profiles have no executable code\n     </li><li>Define what out-of-range means for profiled colors\n     </li><li>Clarify out-of-range clamping\n     </li><li>Add examples of specified values\n     </li><li>Clarify computed values\n     </li><li>Resist fingerprinting, with mandatory mappings for deprecated system colors\n     </li><li>Added explanatory note on history and reason for standardizing X11 colors\n     </li><li>Correct hwb sample code\n     </li><li>Add table of DeltaE2000 values for MacBeth patches\n     </li><li>Add note on ICC profile Internet Media type\n     </li><li>Add reference to PNG sRGB chunk\n     </li><li>Clarify CMYK to Lab interconversion\n     </li><li>Clarify RGB to Lab interconversion\n     </li><li>More comparison of HSL vs. LCH\n     </li><li>More description for Rec BT.2020 color space\n     </li><li>Updated description of prophoto-rgb\n     </li><li>Removed duplicate \"keywords\" from Value Definitions section \n     </li><li>Added an example of an invalid color\n     </li><li>Added example with multiple fallbacks\n     </li><li>Assorted typos and markup fixes\n     </li><li>Clarify handling for undeclared custom color spaces\n     </li><li>Clarify some examples and explanatory notes\n     </li><li>Handling for valid and invalid ICC profiles\n     </li><li>Define handling for images with explicit tagged color space\n     </li><li>Define color space for 4k, SDR video\n     </li><li>State that user contrast settings mst take precedence\n     </li><li>Clarify meaning of system colors outside for forced-color mode\n     </li><li>Update default style rules\n     </li><li>Add CIE XYZ color space to <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-color-4/#funcdef-color\" id=\"ref-for-funcdef-color②⓪\">color()</a>\n     </li><li>Greater clarity on hue angles, NaN explicitly allowed\n     </li><li>Improve section on system color pairings, require AA accessible contrast\n     </li><li>Warn of interaction between overlapping glyphs and the opacity property\n     </li><li>Correct grammar in color definition\n     </li><li>Improve description of Highlight/HighlightText\n     </li><li>Correct prophoto-rgb transfer function\n     </li><li>More precision for prophoto-rgb primaries\n     </li><li>Started to define \"can’t be displayed\"\n     </li><li>Removed paragraph about canvas surface\n     </li><li>Added the buttonborder, mark, and marktext system colors\n     </li><li>Added reverse conversion, sRGB to HWB\n     </li><li>Clarified polar spaces are cylindrical, not spherical\n     </li><li>Added an Accessibility Considerations section\n     </li><li>Started to describe chroma-reduction gamut mapping rather than per-component clipping\n     </li><li>Corrected white chromaticity for rec2020\n     </li><li>Made device-cmyk available by @color-profile; updated CMYK to color algorithm to only use naive conversion as a last resort\n     </li><li>Added print-oriented CMYK and KCMYOGV examples\n     </li><li>User-defined color spaces now dashed-ident, making predefined color spaces extensible without clashes\n     </li><li>Added lab option to the color() function\n     </li><li>Added normative reference for CIE Lab\n     </li><li>Clarified that prophoto-rgb uses <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-4/#d50\" id=\"ref-for-d50⑨\">D50</a> whitepoint so does not require adaptation\n     </li><li>Clarified direction of increasing angle in LCH\n     </li><li>Clarified that color names are ASCII case insensitive\n     </li><li>Initial value of the \"color\" property is now CanvasText\n     </li><li>Removed confusing gray() function per CSS WG resolution\n     </li><li>Collect scattered definitions into new\n\t\t<a href=\"https://drafts.csswg.org/css-color-4/#terminology\">Color terminology</a> section\n     </li><li>Add helpful figures and more examples\n     </li><li>Minor editorial clarifications, spell check, fixing typos, bikeshed markup fixes\n    </li></ul>\n    <h3 class=\"heading no-num settled\" id=\"changes-from-20160705\"><span class=\"content\">Changes since <a href=\"http://www.w3.org/TR/2016/WD-css-color-4-20160705/\">Working Draft of 05 July 2016</a></span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-20160705\"></a></h3>\n    <ul>\n     <li>Changed Lightness in Lab and LCH to be a percentage, for CSS compatibility\n     </li><li>Clamping of color values clarified\n     </li><li>Percentage opacity is now allowed\n     </li><li>Define terms sRGB and linear-light sRGB, for use by other specs\n     </li><li>Add new list of CSS system colors; renaming Text to CanvasText\n     </li><li>Make system color keywords compute to themselves\n     </li><li>Add computed/used entry for system colors\n     </li><li>Rewrite intro to non-deprecated system colors to center their use around forced-colors mode rather than generic use\n     </li><li>Consistent hyphenation of predefined color spaces\n     </li><li>Restore text about non-opaque elements painting at layers even when not positioned\n     </li><li>Initial value of the \"color\" property is now black\n     </li><li>Clarify hue in LCH is modulo 360deg (change now reverted)\n     </li><li>Clarify allowed range of L in LCH and Lab, and meaning of L=100\n     </li><li>Update references for color spaces used in video\n     </li><li>Add prophoto-rgb predefined color space\n     </li><li>Correct black and white luminance levels for display-p3\n     </li><li>Clarify display-p3 transfer function\n     </li><li>Add a98-rgb color space, correct table of primary chromaticities\n     </li><li>Clarify that currentColor’s computed value is not the resolved color\n     </li><li>Update syntax is examples to conform to latest specification\n     </li><li>Remove the color-mod() function\n     </li><li>Drop the \"media\" from propdef tables\n     </li><li>Export, and consistently use, \"transparent black\" and \"opaque black\"\n     </li><li>Clarify calculated values such as percents\n     </li><li>Clarify required precision and rounding behavior for color components\n     </li><li>Clarify \"color\" property has no effect on color font glyphs (unless specifically referenced, e.g. with currentColor)\n     </li><li>Clarify how color values are resolved\n     </li><li>Clarify that HSL, HWB and named colors resolve to sRGB\n     </li><li>Simplify conversion from device-cmyk to sRGB\n     </li><li>Describe previous, comma-using color syntaxes as \"legacy\"; change examples to commaless form\n     </li><li>Remove superfluous requirement that displayed colors be restricted to device gamut (like there was any other option!)\n     </li><li>Rename P3 to display-p3; avoid claiming this is DCI P3, as these are not the same\n     </li><li>Improved description of the parameters to the \"color()\" function\n     </li><li>Disallow predefined spaces from \"@color-profile\" identifier\n     </li><li>Add canonical order to \"color\", \"color-adjust\" and \"opacity\" property definitions\n     </li><li>Switch definition of alpha compositing from SVG11 to CSS Compositing\n     </li><li>Clarify sample conversion code is non-normative\n     </li><li>Add Security and Privacy Considerations\n     </li><li>Update several references to most current versions\n     </li><li>Convert inline issues to links to GitHub issues\n     </li><li>Minor editorial clarifications, formatting and markup improvements\n    </li></ul>\n    <h3 class=\"heading settled\" id=\"changes-from-3\"><span class=\"content\">\nChanges from Colors 3</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#changes-from-3\"></a></h3>\n    <p>The primary change, compared to CSS Color 3,\n\tis that CSS colors are no longer restricted to the\n\tnarrow gamut of sRGB.</p>\n    <p>To support this, several brand new features have been added:</p>\n    \n    <p>Other technical changes:</p>\n    \n    <p>In addition, there have been some syntactic changes:</p>\n    \n    <h2 class=\"heading settled\" data-level=\"20\" id=\"security\"><span class=\"secno\">20. </span><span class=\"content\">Security Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#security\"></a></h2>\n    <p>The system colors,\nif they actually correspond to the user’s system colors,\npose a security risk,\nas they make it easier for a malware site\nto create user interfaces that appear to be from the system.\nHowever, as several system colors are now defined to be \"generic\",\nthis risk is believed to be mitigated.</p>\n    <h2 class=\"heading settled\" data-level=\"21\" id=\"privacy\"><span class=\"secno\">21. </span><span class=\"content\">Privacy Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#privacy\"></a></h2>\n    <p>This specification defines \"system\" colors,\nwhich theoretically can expose details of the user’s OS settings,\nwhich is a fingerprinting risk.</p>\n    <h2 class=\"heading settled\" data-level=\"22\" id=\"a11y-sec\"><span class=\"secno\">22. </span><span class=\"content\">Accessibility Considerations</span><a class=\"self-link\" href=\"https://drafts.csswg.org/css-color-4/#a11y-sec\"></a></h2>\n    <p>This specification <a href=\"https://drafts.csswg.org/css-color-4/#accessibility\">encourages authors to not use\n\tcolor alone</a> as a distinguishing feature.</p>\n    <p>This specification <a href=\"https://drafts.csswg.org/css-color-4/#css-system-colors\" id=\"ref-for-css-system-colors⑨\">encourages browsers to ensure\n\tadequate contrast for specific system color foreground/background pairs</a>.\n\tA harder requirement with specific AA or AAA contrast ratios was considered,\n\tbut since browsers are often just passing along color choices made by the OS,\n\tor selected by users (who may have particular requirements,\n\tincluding lower contrast for people living with migraines or epileptic seizures), the CSSWG\n\twas unable to require a specific contrast level.</p>",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var>alpha</var> be the given integer."
        },
        {
          "html": "If there exists an integer between 0 and 100 inclusive that,\n\t\twhen multiplied with 2.55 and rounded to the closest integer\n\t\t(rounding up if two values are equally close), equals <var>alpha</var>,\n\t\tlet <var>rounded</var> be that integer divided by 100."
        },
        {
          "html": "Otherwise, let <var>rounded</var> be <var>alpha</var>\n\t\tdivided by 0.255 and rounded to the closest integer\n\t\t(rounding up if two values are equally close),\n\t\tdivided by 1000."
        },
        {
          "html": "Return the result of serializing <var>rounded</var>\n\t\tas a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#number-value\" id=\"ref-for-number-value③③\">&lt;number&gt;</a>."
        }
      ]
    }
  ]
}