{
  "spec": {
    "title": "Web Bluetooth",
    "url": "https://webbluetoothcg.github.io/web-bluetooth/"
  },
  "algorithms": [
    {
      "name": "initializing referringDevice",
      "html": "If this happens, then as part of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object\" id=\"ref-for-initialise-the-document-object①\">initializing the <code>Document</code> object</a>,\n    the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>referringDevice</var> be the device that caused the navigation.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing\">Get the <code>BluetoothDevice</code> representing</a> <var>referringDevice</var> inside <code>navigator.bluetooth</code>, and let <var>referringDeviceObj</var> be the result.</p>"
        },
        {
          "html": "<p>If the previous step threw an exception, abort these steps.</p>"
        },
        {
          "html": "<p>Set <code>navigator.bluetooth.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-referringdevice-slot\" id=\"ref-for-dom-bluetooth-referringdevice-slot①\">[[referringDevice]]</a></code></code> to <var>referringDeviceObj</var>.</p>"
        }
      ]
    },
    {
      "name": "matching Bluetooth device with a filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#matches-a-filter",
      "html": "A <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device③\">Bluetooth device</a> <var>device</var> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-local-lt=\"match a\nfilter|matches any filter\" data-noexport=\"\" id=\"matches-a-filter\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">matches a filter</dfn> <var>filter</var> if the\nfollowing steps return <code>match</code>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-name\" id=\"ref-for-dom-bluetoothlescanfilterinit-name①\">name</a></code></code> is\npresent then, if <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device-name\" id=\"ref-for-bluetooth-device-name①\">Bluetooth Device Name</a> isn’t\ncomplete and equal to <code><var>filter</var>.name</code>, return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-nameprefix\" id=\"ref-for-dom-bluetoothlescanfilterinit-nameprefix①\">namePrefix</a></code></code> is\npresent then if <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device-name\" id=\"ref-for-bluetooth-device-name②\">Bluetooth Device Name</a> isn’t\npresent or doesn’t start with <code><var>filter</var>.namePrefix</code>,\nreturn <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>For each <var>uuid</var> in <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-services\" id=\"ref-for-dom-bluetoothlescanfilterinit-services②\">services</a></code></code>, if\nthe UA has not received advertising data, an <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#extended-inquiry-response\" id=\"ref-for-extended-inquiry-response\">extended inquiry\nresponse</a>, or a service discovery response indicating that the device\nsupports a primary (vs included) service with UUID <var>uuid</var>, return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>For each <var>manufacturerData</var> in <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-manufacturerdata\" id=\"ref-for-dom-bluetoothlescanfilterinit-manufacturerdata②\">manufacturerData</a></code>\"]</code>, if <var>device</var> hasn’t advertised <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-specific-data\" id=\"ref-for-manufacturer-specific-data②\">manufacturer specific data</a> with a\ncompany identifier code equal to <code><var>manufacturerData</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothmanufacturerdatafilterinit-companyidentifier\" id=\"ref-for-dom-bluetoothmanufacturerdatafilterinit-companyidentifier\">companyIdentifier</a></code>\"]</code> and with data that <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-matches\" id=\"ref-for-bluetoothdatafilterinit-matches\">matches</a> <code><var>manufacturerData</var></code> return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>For each <var>serviceData</var> in <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-servicedata\" id=\"ref-for-dom-bluetoothlescanfilterinit-servicedata②\">serviceData</a></code>\"]</code>,\nif <var>device</var> hasn’t advertised <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service-data\" id=\"ref-for-service-data②\">service data</a> with a UUID whose\n128-bit form is <code><var>serviceData</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothservicedatafilterinit-service\" id=\"ref-for-dom-bluetoothservicedatafilterinit-service\">service</a></code>\"]</code> and\nwith data that <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-matches\" id=\"ref-for-bluetoothdatafilterinit-matches①\">matches</a> <code><var>serviceData</var></code> return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>Return <code>match</code>.</p>"
        }
      ]
    },
    {
      "name": "matching Bluetooth device data with a filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-matches",
      "html": "An array of bytes <var>data</var> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BluetoothDataFilterInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"bluetoothdatafilterinit-matches\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">matches</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit③\">BluetoothDataFilterInit</a></code> <var>filter</var> if the following steps return <code>match</code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>expectedPrefix</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy\">a copy of the bytes held</a> by <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-dataprefix\" id=\"ref-for-dom-bluetoothdatafilterinit-dataprefix①\">dataPrefix</a></code></code>.</p>"
        },
        {
          "html": "<p>Let <var>mask</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy①\">a copy of the bytes held</a> by <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask②\">mask</a></code></code>.</p>"
        },
        {
          "html": "<p>If <var>data</var> has fewer bytes than <var>expectedPrefix</var>, return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>For each <code>1</code> bit in <var>mask</var>, if the corresponding bit in <var>data</var> is not equal\nto the corresponding bit in <var>expectedPrefix</var>, return <code>mismatch</code>.</p>"
        },
        {
          "html": "<p>Return <code>match</code>.</p>"
        }
      ]
    },
    {
      "name": "a data filter is a strict subset of another data filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-strict-subset",
      "html": "A <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit④\">BluetoothDataFilterInit</a></code> <var>filter1</var> is a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BluetoothDataFilterInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"bluetoothdatafilterinit-strict-subset\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">strict subset</dfn> of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit⑤\">BluetoothDataFilterInit</a></code> <var>filter2</var> if the following steps return <code>true</code>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the length of <var>filter1</var> is less than the length of <var>filter2</var>, return <code>false</code>.</p>"
        },
        {
          "html": "<p>Let <var>byteIndex</var> be <code>0</code>.</p>"
        },
        {
          "html": "While <var>byteIndex</var> is less than the length of <var>filter2</var>, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>filter1</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask③\">mask</a></code>[<var>byteIndex</var>] &amp; <var>filter2</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask④\">mask</a></code>[<var>byteIndex</var>]</code> is not equal to <var>filter2</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask⑤\">mask</a></code>[<var>byteIndex</var>], return <code>false</code>.</p>"
            },
            {
              "html": "<p>If <code><var>filter1</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-dataprefix\" id=\"ref-for-dom-bluetoothdatafilterinit-dataprefix②\">dataPrefix</a></code>[<var>byteIndex</var>] &amp; <var>filter2</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask⑥\">mask</a></code>[<var>byteIndex</var>]</code> it not equal to <code><var>filter2</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-dataprefix\" id=\"ref-for-dom-bluetoothdatafilterinit-dataprefix③\">dataPrefix</a></code>[<var>byteIndex</var>] &amp; <var>filter2</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask⑦\">mask</a></code>[<var>byteIndex</var>]</code>, return <code>false</code>.</p>"
            },
            {
              "html": "<p>Set <var>byteIndex</var> to <code><var>byteIndex</var> + 1</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "getDevice invocation",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-getdevices",
      "html": "To <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Bluetooth\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetooth-getdevices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getDevices()</code></dfn></code> method, when\ninvoked and given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage\">BluetoothPermissionStorage</a></code> <var>storage</var>, MUST run the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature\">policy-controlled feature</a> named\n\"<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#policy-controlled-feature-bluetooth\" id=\"ref-for-policy-controlled-feature-bluetooth\">bluetooth</a>\", return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror\">SecurityError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>devices</var> be a new empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array-objects\" id=\"ref-for-sec-array-objects\">Array</a></code>.</p>"
            },
            {
              "html": "<p>For each <var>allowedDevice</var> in <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices\">allowedDevices</a></code></code>,\nadd the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice⑦\">BluetoothDevice</a></code> object representing <var>allowedDevice</var>@<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot\">[[device]]</a></code> to <var>devices</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">resolve</a> <var>promise</var> with <var>devices</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "requestDevice invocation",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-requestdevice",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Bluetooth\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"requestDevice(options)|requestDevice()\" id=\"dom-bluetooth-requestdevice\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>requestDevice(<var>options</var>) </code></dfn></code> method, when invoked, MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-exclusionfilters\" id=\"ref-for-dom-requestdeviceoptions-exclusionfilters⑤\">exclusionFilters</a></code></code> is\npresent and <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-filters\" id=\"ref-for-dom-requestdeviceoptions-filters④\">filters</a></code></code> is not present,\nreturn <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-filters\" id=\"ref-for-dom-requestdeviceoptions-filters⑤\">filters</a></code></code> is present and <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-acceptalldevices\" id=\"ref-for-dom-requestdeviceoptions-acceptalldevices⑥\">acceptAllDevices</a></code></code> is <code>true</code>,\nor if <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-filters\" id=\"ref-for-dom-requestdeviceoptions-filters⑥\">filters</a></code></code> is not present\nand <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-acceptalldevices\" id=\"ref-for-dom-requestdeviceoptions-acceptalldevices⑦\">acceptAllDevices</a></code></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror②\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>:",
          "rationale": "queue",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#request-bluetooth-devices\" id=\"ref-for-request-bluetooth-devices\">Request Bluetooth devices</a>, passing <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-filters\" id=\"ref-for-dom-requestdeviceoptions-filters⑧\">filters</a></code></code> if <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-acceptalldevices\" id=\"ref-for-dom-requestdeviceoptions-acceptalldevices⑨\">acceptAllDevices</a></code></code> is <code>false</code> or <code>null</code> otherwise, passing <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-exclusionfilters\" id=\"ref-for-dom-requestdeviceoptions-exclusionfilters⑥\">exclusionFilters</a></code></code> if it\nexists or <code>null</code> otherwise, passing <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-optionalservices\" id=\"ref-for-dom-requestdeviceoptions-optionalservices③\">optionalServices</a></code></code>, and\npassing <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-requestdeviceoptions-optionalmanufacturerdata\" id=\"ref-for-dom-requestdeviceoptions-optionalmanufacturerdata①\">optionalManufacturerData</a></code></code>,\nand let <var>devices</var> be the result.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①\">Bluetooth task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> to run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If the previous step threw an exception, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with that\nexception and abort these steps.</p>"
                },
                {
                  "html": "<p>If <var>devices</var> is an empty sequence, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>promise</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror\">NotFoundError</a></code> and abort these steps.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">Resolve</a> <var>promise</var> with <code><var>devices</var>[0]</code>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "requesting a Bluetooth device",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#request-bluetooth-devices",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-bluetooth-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">request Bluetooth devices</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage①\">BluetoothPermissionStorage</a></code> <var>storage</var> and a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit②\">BluetoothLEScanFilterInit</a></code>s <var>filters</var>, which can be <code>null</code> to represent that\nall devices can match, a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit③\">BluetoothLEScanFilterInit</a></code>s <var>exclusionFilters</var>, which can be <code>null</code> if no exclusion filters have been set,\na sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-bluetoothserviceuuid\" id=\"ref-for-typedefdef-bluetoothserviceuuid③\">BluetoothServiceUUID</a></code>s <var>optionalServices</var>, and a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short②\">unsigned short</a></code>s <var>optionalManufacturerData</var>, the UA MUST run the following\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a> for <var>storage</var>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use①\">allowed to use</a> the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature①\">policy-controlled feature</a> named \"<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#policy-controlled-feature-bluetooth\" id=\"ref-for-policy-controlled-feature-bluetooth①\">bluetooth</a>\", throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p id=\"requestDevice-user-gesture\">Check that the algorithm is triggered\nwhile its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a> has a <a href=\"https://html.spec.whatwg.org/#tracking-user-activation\"> transient\nactivation</a>, otherwise throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror②\">SecurityError</a></code> and abort these\nsteps.</p>"
        },
        {
          "html": "In order to convert the arguments from service names and aliases to just <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#uuid\" id=\"ref-for-uuid\">UUID</a>s, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>filters</var> !== null &amp;&amp; <var>filters</var>.length === 0</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror③\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If <code><var>exclusionFilters</var> !== null &amp;&amp; <var>exclusionFilters</var>.length === 0</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror④\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>uuidFilters</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array-objects\" id=\"ref-for-sec-array-objects①\">Array</a></code>, <var>uuidExclusionFilters</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array-objects\" id=\"ref-for-sec-array-objects②\">Array</a></code>, and <var>requiredServiceUUIDs</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-set-objects\" id=\"ref-for-sec-set-objects\">Set</a></code>.</p>"
            },
            {
              "html": "<p>If <var>filters</var> is <code>null</code>, then set <var>requiredServiceUUIDs</var> to the set of all\nUUIDs.</p>"
            },
            {
              "html": "If <var>filters</var> isn’t <code>null</code>, then for each <var>filter</var> in <var>filters</var>, do the\nfollowing steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>canonicalFilter</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothlescanfilterinit-canonicalizing\" id=\"ref-for-bluetoothlescanfilterinit-canonicalizing\">canonicalizing</a> <var>filter</var>.</p>"
                },
                {
                  "html": "<p>Append <var>canonicalFilter</var> to <var>uuidFilters</var>.</p>"
                },
                {
                  "html": "<p>Add the contents of <code><var>canonicalFilter</var>.services</code> to <var>requiredServiceUUIDs</var>.</p>"
                }
              ]
            },
            {
              "html": "If <var>exclusionFilters</var> isn’t <code>null</code>, then for each <var>exclusionFilter</var> in <var>exclusionFilters</var>, do the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>canonicalExclusionFilter</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothlescanfilterinit-canonicalizing\" id=\"ref-for-bluetoothlescanfilterinit-canonicalizing①\">canonicalizing</a> <var>exclusionFilter</var>.</p>"
                },
                {
                  "html": "<p>Append <var>canonicalExclusionFilter</var> to <var>uuidExclusionFilters</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>optionalServiceUUIDs</var> be <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array.prototype.map\" id=\"ref-for-sec-array.prototype.map\">Array.prototype.map</a></code>.call(<var>optionalServices</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice\">BluetoothUUID.getService</a></code>)</code>.</p>"
            },
            {
              "html": "<p>If any of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice①\">BluetoothUUID.getService()</a></code> calls threw an exception, throw that exception and abort these steps.</p>"
            },
            {
              "html": "<p>Remove from <var>optionalServiceUUIDs</var> any UUIDs that are <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted\" id=\"ref-for-blocklisted\">blocklisted</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>descriptor</var> be</p>\n<pre class=\"highlight\"><c- p=\"\">{</c->\n  name<c- o=\"\">:</c-> <c- u=\"\">\"bluetooth\"</c-><c- p=\"\">,</c->\n  filters<c- o=\"\">:</c-> <var>uuidFilters</var>\n  optionalServices<c- o=\"\">:</c-> <var>optionalServiceUUIDs</var><c- p=\"\">,</c->\n  optionalManufacturerData<c- o=\"\">:</c-> <var>optionalManufacturerData</var>\n  acceptAllDevices<c- o=\"\">:</c-> <var>filters</var> <c- o=\"\">!==</c-> <c- kc=\"\">null</c-><c- p=\"\">,</c->\n<c- p=\"\">}</c->\n</pre>"
        },
        {
          "html": "<p>Let <var>state</var> be <var>descriptor</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-state\" id=\"ref-for-dfn-permission-state\">permission state</a>.</p>"
        },
        {
          "html": "<p>If <var>state</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied①\">denied</a></code>\", return <code>[]</code> and abort these steps.</p>"
        },
        {
          "html": "<p>If the UA can prove that no devices could possibly be found in the next step,\nfor example because there is no Bluetooth adapter with which to scan, or\nbecause the filters can’t be matched by any possible advertising packet, the\nUA MAY return <code>[]</code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>scanResult</var> be the result of invoking <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#scan-for-devices\" id=\"ref-for-scan-for-devices\">scan for devices</a> with <var>global</var> and <var>requiredServiceUUIDs</var>.</p>"
        },
        {
          "html": "If <var>filters</var> isn’t <code>null</code>, do the following sub-steps:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p>Remove devices from <var>scanResult</var> if they do\nnot <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#matches-a-filter\" id=\"ref-for-matches-a-filter③\">match a filter</a> in <var>uuidFilters</var>.</p>"
            },
            {
              "html": "<p>If <var>exclusionFilters</var> isn’t <code>null</code>, remove devices from <var>scanResult</var> if they <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#matches-a-filter\" id=\"ref-for-matches-a-filter④\">match a filter</a> in <var>uuidExclusionFilters</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>promptId</var> be a new unique opaque string.</p>"
        }
      ]
    },
    {
      "name": "requesting a Bluetooth device",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#request-bluetooth-devices",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-bluetooth-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">request Bluetooth devices</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage①\">BluetoothPermissionStorage</a></code> <var>storage</var> and a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit②\">BluetoothLEScanFilterInit</a></code>s <var>filters</var>, which can be <code>null</code> to represent that\nall devices can match, a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit③\">BluetoothLEScanFilterInit</a></code>s <var>exclusionFilters</var>, which can be <code>null</code> if no exclusion filters have been set,\na sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-bluetoothserviceuuid\" id=\"ref-for-typedefdef-bluetoothserviceuuid③\">BluetoothServiceUUID</a></code>s <var>optionalServices</var>, and a sequence of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short②\">unsigned short</a></code>s <var>optionalManufacturerData</var>, the UA MUST run the following\nsteps:",
      "rationale": "remove",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#trigger-a-prompt-updated-event\" id=\"ref-for-trigger-a-prompt-updated-event\">Trigger a prompt updated event</a> given <var>navigable</var>, <var>promptId</var>, and <var>scanResult</var>.</p>"
        },
        {
          "html": "<p id=\"requestDevice-prompt\">Even if <var>scanResult</var> is empty, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-prompt-the-user-to-choose\" id=\"ref-for-dfn-prompt-the-user-to-choose\">prompt the user to choose</a> one of the devices in <var>scanResult</var>,\nassociated with <var>descriptor</var>, and let <var>device</var> be the result. </p>\n      <p>The UA MAY allow the user to select a nearby device that does not match <var>uuidFilters</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#map-of-navigables-to-device-prompts\" id=\"ref-for-map-of-navigables-to-device-prompts\">map of navigables to device prompts</a>[<var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id\">navigable id</a>].</p>"
        },
        {
          "html": "<p>The UA MAY <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#add-device-to-storage\" id=\"ref-for-add-device-to-storage\">add <var>device</var> to <var>storage</var></a>.</p>"
        },
        {
          "html": "<p>If <var>device</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied②\">denied</a></code>\", return <code>[]</code> and abort these steps.</p>"
        },
        {
          "html": "<p>The UA MAY <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#populate-the-bluetooth-cache\" id=\"ref-for-populate-the-bluetooth-cache\">populate the Bluetooth cache</a> with all Services inside <var>device</var>. Ignore any errors from this step.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing①\">Get the <code>BluetoothDevice</code> representing</a> <var>device</var> inside <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>, propagating any exception, and let <var>deviceObj</var> be the result.</p>"
        },
        {
          "html": "<p>Return <code>[<var>deviceObj</var>]</code>.</p>"
        }
      ]
    },
    {
      "name": "canonicalizing an LE scan filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#bluetoothlescanfilterinit-canonicalizing",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BluetoothLEScanFilterInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"bluetoothlescanfilterinit-canonicalizing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">canonicalizing</dfn> the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit④\">BluetoothLEScanFilterInit</a></code> <var>filter</var>, is the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit⑤\">BluetoothLEScanFilterInit</a></code> returned from the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If none of <var>filter</var>’s members is present, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑤\">TypeError</a></code> and\nabort these steps.</p>"
        },
        {
          "html": "<p>Let <var>canonicalizedFilter</var> be <code>{}</code>.</p>"
        },
        {
          "html": "If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-services\" id=\"ref-for-dom-bluetoothlescanfilterinit-services③\">services</a></code></code> is\npresent, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>filter</var>.services.length === 0</code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑥\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>services</var> be <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array.prototype.map\" id=\"ref-for-sec-array.prototype.map①\">Array.prototype.map</a></code>.call(<var>filter</var>.services, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice②\">BluetoothUUID.getService</a></code>)</code>.</p>"
            },
            {
              "html": "<p>If any of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice③\">BluetoothUUID.getService()</a></code> calls threw an exception, throw that exception and abort these steps.</p>"
            },
            {
              "html": "<p>If any service in <var>services</var> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted\" id=\"ref-for-blocklisted①\">blocklisted</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror③\">SecurityError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Set <code><var>canonicalizedFilter</var>.services</code> to <var>services</var>.</p>"
            }
          ]
        },
        {
          "html": "If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-name\" id=\"ref-for-dom-bluetoothlescanfilterinit-name②\">name</a></code></code> is\npresent, do the following sub-steps.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">UTF-8 encoding</a> of <code><var>filter</var>.name</code> is more than 248 bytes long, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑦\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Set <code><var>canonicalizedFilter</var>.name</code> to <code><var>filter</var>.name</code>.</p>"
            }
          ]
        },
        {
          "html": "If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-nameprefix\" id=\"ref-for-dom-bluetoothlescanfilterinit-nameprefix②\">namePrefix</a></code></code> is\npresent, do the following sub-steps.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>filter</var>.namePrefix.length === 0</code> or if the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode①\">UTF-8 encoding</a> of <code><var>filter</var>.namePrefix</code> is more than 248 bytes long,\nthrow a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑧\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Set <code><var>canonicalizedFilter</var>.namePrefix</code> to <code><var>filter</var>.namePrefix</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <code><var>canonicalizedFilter</var>[\"manufacturerData\"]</code> to <code>[]</code>.</p>"
        },
        {
          "html": "<p>If <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-manufacturerdata\" id=\"ref-for-dom-bluetoothlescanfilterinit-manufacturerdata③\">manufacturerData</a></code>\"]</code> is\npresent and <code><var>filter</var>[\"manufacturerData\"].length === 0</code>,\nthrow a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror⑨\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "For each <var>manufacturerData</var> in <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-manufacturerdata\" id=\"ref-for-dom-bluetoothlescanfilterinit-manufacturerdata④\">manufacturerData</a></code>\"]</code>,\ndo the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>manufacturerData</var> is a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-manufacturer-data-filter\" id=\"ref-for-blocklisted-manufacturer-data-filter\">blocklisted manufacturer data filter</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror④\">SecurityError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>If there exists an object <var>existing</var> in <code><var>canonicalizedFilter</var>[\"manufacturerData\"]</code> where <code><var>existing</var>[\"companyIdentifier\"] === <var>manufacturerData</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothmanufacturerdatafilterinit-companyidentifier\" id=\"ref-for-dom-bluetoothmanufacturerdatafilterinit-companyidentifier①\">companyIdentifier</a></code>\"]</code>,\nthrow a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①⓪\">TypeError</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>canonicalizedManufacturerDataFilter</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-canonicalizing\" id=\"ref-for-bluetoothdatafilterinit-canonicalizing①\">canonicalizing</a> <var>manufacturerData</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value\">converted to an ECMAScript value</a>. If this throws an exception,\npropagate that exception and abort these steps.</p>"
            },
            {
              "html": "<p>Set <code><var>canonicalizedManufacturerDataFilter</var>[\"companyIdentifier\"]</code> to <code><var>manufacturerData</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothmanufacturerdatafilterinit-companyidentifier\" id=\"ref-for-dom-bluetoothmanufacturerdatafilterinit-companyidentifier②\">companyIdentifier</a></code>\"]</code>.</p>"
            },
            {
              "html": "<p>Append <var>canonicalizedManufacturerDataFilter</var> to <code><var>canonicalizedFilter</var>[\"manufacturerData\"]</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <code><var>canonicalizedFilter</var>.serviceData</code> to <code>[]</code>.</p>"
        },
        {
          "html": "<p>If <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-servicedata\" id=\"ref-for-dom-bluetoothlescanfilterinit-servicedata③\">serviceData</a></code>\"]</code> is\npresent and <code><var>filter</var>[\"serviceData\"].length === 0</code>,\nthrow a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①①\">TypeError</a></code> and abort these steps.</p>"
        },
        {
          "html": "For each <var>serviceData</var> in <code><var>filter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothlescanfilterinit-servicedata\" id=\"ref-for-dom-bluetoothlescanfilterinit-servicedata④\">serviceData</a></code>\"]</code>,\ndo the following sub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>service</var> be <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice④\">BluetoothUUID.getService</a></code>(<var>serviceData</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothservicedatafilterinit-service\" id=\"ref-for-dom-bluetoothservicedatafilterinit-service①\">service</a></code>\"])</code>.\nIf this throws an exception, propagate that exception and abort these\nsteps.</p>"
            },
            {
              "html": "<p>If <var>service</var> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted\" id=\"ref-for-blocklisted②\">blocklisted</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑤\">SecurityError</a></code> and abort\nthese steps.</p>"
            },
            {
              "html": "<p>Let <var>canonicalizedServiceDataFilter</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-canonicalizing\" id=\"ref-for-bluetoothdatafilterinit-canonicalizing②\">canonicalizing</a> <var>serviceData</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①\">converted to an ECMAScript value</a>. If this throws an exception,\npropagate that exception and abort these steps.</p>"
            },
            {
              "html": "<p>Set <code><var>canonicalizedServiceDataFilter</var>[\"service\"]</code> to <var>service</var>.</p>"
            },
            {
              "html": "<p>Append <var>canonicalizedServiceDataFilter</var> to <code><var>canonicalizedFilter</var>[\"serviceData\"]</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>canonicalizedFilter</var>.</p>"
        }
      ]
    },
    {
      "name": "canonicalizing a data filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-canonicalizing",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BluetoothDataFilterInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"bluetoothdatafilterinit-canonicalizing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">canonicalizing</dfn> the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit⑥\">BluetoothDataFilterInit</a></code> <var>filter</var>, is the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit⑦\">BluetoothDataFilterInit</a></code> returned from the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-dataprefix\" id=\"ref-for-dom-bluetoothdatafilterinit-dataprefix④\">dataPrefix</a></code></code> is not\npresent, let <var>dataPrefix</var> be an empty sequence of bytes. Otherwise,\ndo the following sub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>dataPrefix</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy②\">a copy of the bytes held</a> by <code><var>filter</var>.dataPrefix</code>.</p>"
            },
            {
              "html": "<p>If the length of <var>dataPrefix</var> is zero, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①②\">TypeError</a></code> and abort\nthese steps.</p>"
            }
          ]
        },
        {
          "html": "<p>If <code><var>filter</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask⑧\">mask</a></code></code> is present, let <var>mask</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy③\">a copy of the bytes held</a> by <code><var>filter</var>.mask</code>.\nOtherwise, let <var>mask</var> be a sequence of <code>0xFF</code> bytes the same length as <var>dataPrefix</var>.</p>"
        },
        {
          "html": "<p>If <var>mask</var> is not the same length as <var>dataPrefix</var>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①③\">TypeError</a></code> and\nabort these steps.</p>"
        },
        {
          "html": "<p>Return <code>{dataPrefix: new Uint8Array(|dataPrefix|), mask: new     Uint8Array(|mask|)}</code>.</p>"
        }
      ]
    },
    {
      "name": "scanning for Bluetooth devices",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#scan-for-devices",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"scan-for-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">scan for devices</dfn> with parameters <var>global</var> and an optional <var>set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①\">Service</a> UUIDs</var>, defaulting to the set of all UUIDs, the UA MUST perform the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the UA has scanned for devices recently with a set of UUIDs that was a\nsuperset of the UUIDs for the current scan, then the UA MAY return the\nresult of that scan and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>nearbyDevices</var> be a set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device④\">Bluetooth device</a>s, initially\nequal to the set of devices that are connected (have an <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer\">ATT Bearer</a>)\nto the UA.</p>"
        },
        {
          "html": "<p>Let <var>topLevelTraversable</var> be the <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable\">navigable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothDevices</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>topLevelTraversable</var> has a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter\">simulated Bluetooth adapter</a>, let <var>simulatedBluetoothDevices</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">getting the values</a> of its <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If the UA supports the LE transport, perform the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#general-discovery-procedure\" id=\"ref-for-general-discovery-procedure\">General Discovery\nProcedure</a>, except that the UA may include devices that have no <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#discoverable-mode\" id=\"ref-for-discoverable-mode\">Discoverable Mode</a> flag set, and add the discovered <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device⑤\">Bluetooth\ndevice</a>s to <var>nearbyDevices</var>. The UA SHOULD enable the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#privacy-feature\" id=\"ref-for-privacy-feature③\">Privacy\nFeature</a>.</p>"
        },
        {
          "html": "<p>If the UA supports the BR/EDR transport, perform the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#device-discovery-procedure\" id=\"ref-for-device-discovery-procedure\">Device Discovery\nProcedure</a> and add the discovered <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device⑥\">Bluetooth device</a>s to <var>nearbyDevices</var>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device⑦\">Bluetooth device</a>s, initially empty.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device⑧\">Bluetooth device</a> <var>device</var> in <var>nearbyDevices</var> and <var>simulatedBluetoothDevices</var>, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#supported-physical-transports\" id=\"ref-for-supported-physical-transports\">supported physical transports</a> include LE\nand its <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device-name\" id=\"ref-for-bluetooth-device-name⑤\">Bluetooth Device Name</a> is partial or absent, the UA SHOULD\nperform the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#name-discovery-procedure\" id=\"ref-for-name-discovery-procedure\">Name Discovery Procedure</a> to acquire a complete name.</p>"
            },
            {
              "html": "<p>If <var>device</var>’s advertised <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service-uuid-data-type\" id=\"ref-for-service-uuid-data-type\">Service UUIDs</a> have a non-empty\nintersection with the <var>set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service②\">Service</a> UUIDs</var>, add <var>device</var> to <var>result</var> and abort these sub-steps.</p>"
            },
            {
              "html": "<p>The UA MAY connect to <var>device</var> and <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#populate-the-bluetooth-cache\" id=\"ref-for-populate-the-bluetooth-cache①\">populate the Bluetooth\ncache</a> with all Services whose UUIDs are in the <var>set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service③\">Service</a> UUIDs</var>. If <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#supported-physical-transports\" id=\"ref-for-supported-physical-transports①\">supported physical\ntransports</a> include BR/EDR, then in addition to the standard GATT\nprocedures, the UA MAY use the Service Discovery Protocol (<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#searching-for-services\" id=\"ref-for-searching-for-services\">Searching\nfor Services</a>) when populating the cache.</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-cache-bluetooth-cache\" id=\"ref-for-bluetooth-cache-bluetooth-cache①\">Bluetooth cache</a> contains known-present Services inside <var>device</var> with UUIDs in the <var>set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service④\">Service</a> UUIDs</var>, the UA MAY add <var>device</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var> from the scan.</p>"
        }
      ]
    },
    {
      "name": "add Bluetooth device to storage",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#add-device-to-storage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"add device to storage\" data-noexport=\"\" id=\"add-device-to-storage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add an allowed <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device⑨\">Bluetooth device</a></dfn> <var>device</var> to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage②\">BluetoothPermissionStorage</a></code> <var>storage</var> given a set of <var>requiredServiceUUIDs</var> and a set of <var>optionalServiceUUIDs</var>, the\nUA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>grantedServiceUUIDs</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-set-objects\" id=\"ref-for-sec-set-objects①\">Set</a></code>.</p>"
        },
        {
          "html": "<p>Add the contents of <var>requiredServiceUUIDs</var> to <var>grantedServiceUUIDs</var>.</p>"
        },
        {
          "html": "<p>Add the contents of <var>optionalServiceUUIDs</var> to <var>grantedServiceUUIDs</var>.</p>"
        },
        {
          "html": "Search for an element <var>allowedDevice</var> in <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices②\">allowedDevices</a></code></code> where <var>device</var> is equal to <code><var>allowedDevice</var>@<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot①\">[[device]]</a></code></code>. If one is\nfound, perform the following sub-steps:",
          "rationale": "add",
          "steps": [
            {
              "html": "<p>Add the contents of <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices①\">allowedServices</a></code></code> to <var>grantedServiceUUIDs</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "If one is not found, perform the following sub-steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-deviceid\" id=\"ref-for-dom-allowedbluetoothdevice-deviceid\">deviceId</a></code> be a unique ID to\nthe extent that the UA can determine that two Bluetooth connections are\nthe same device and to the extent that the <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#note-device-id-tracking\">user wants to expose that fact to\nscript</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices②\">allowedServices</a></code> to <var>grantedServiceUUIDs</var>.</p>"
        },
        {
          "html": "<p>Set <var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-mayusegatt\" id=\"ref-for-dom-allowedbluetoothdevice-mayusegatt①\">mayUseGATT</a></code> to <code>true</code>.</p>"
        }
      ]
    },
    {
      "name": "remove device from storage",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#remove-device-from-storage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"remove device from storage\" data-noexport=\"\" id=\"remove-device-from-storage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove an allowed <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①⓪\">Bluetooth\ndevice</a></dfn> <var>device</var>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage③\">BluetoothPermissionStorage</a></code> <var>storage</var>,\nthe UA MUST run the following steps:",
      "rationale": "abort these steps",
      "steps": [
        {
          "html": "<p>Search for an element <var>allowedDevice</var> in <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices③\">allowedDevices</a></code></code> where <var>device</var> is equal to <code><var>allowedDevice</var>@<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot②\">[[device]]</a></code></code>. If no such\nelement exists, abort these steps.</p>"
        },
        {
          "html": "<p>Remove <var>allowedDevice</var> from <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices④\">allowedDevices</a></code></code>.</p>"
        }
      ]
    },
    {
      "name": "permission query",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#query-the-bluetooth-permission",
      "html": "<h3 class=\"heading settled\" data-level=\"4.1\" id=\"permission-api-integration\"><span class=\"secno\">4.1. </span><span class=\"content\">Permission API Integration</span><a class=\"self-link\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permission-api-integration\"></a></h3>\n    <p>The <a data-link-type=\"biblio\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#biblio-permissions\" title=\"Permissions\">[permissions]</a> API provides a uniform way for websites to query which\npermissions they have.</p>\n    \n    <p>The Web Bluetooth API is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-powerful-feature\" id=\"ref-for-dfn-powerful-feature\">powerful feature</a> that is identified by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-name\" id=\"ref-for-dfn-name\">name</a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"permission\" data-export=\"\" id=\"permissiondef-bluetooth\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>\"bluetooth\"</code></dfn>. Its\npermission-related algorithms and types are defined as follows:</p>\n    <dl>\n     <dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-descriptor-type\" id=\"ref-for-dfn-permission-descriptor-type\">permission descriptor type</a>\n     </dt><dd>\n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-bluetoothpermissiondescriptor\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionDescriptor</c-></code></dfn> : <a data-link-type=\"idl-name\" href=\"https://w3c.github.io/permissions/#dom-permissiondescriptor\" id=\"ref-for-dom-permissiondescriptor\"><c- n=\"\">PermissionDescriptor</c-></a> {\n  <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString②\"><c- b=\"\">DOMString</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString\" id=\"dom-bluetoothpermissiondescriptor-deviceid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">deviceId</c-></code></dfn>;\n  // These match RequestDeviceOptions.\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑧\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit⑥\"><c- n=\"\">BluetoothLEScanFilterInit</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;BluetoothLEScanFilterInit&gt;\" id=\"dom-bluetoothpermissiondescriptor-filters\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">filters</c-></code></dfn>;\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑨\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-bluetoothserviceuuid\" id=\"ref-for-typedefdef-bluetoothserviceuuid④\"><c- n=\"\">BluetoothServiceUUID</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"[]\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;BluetoothServiceUUID&gt;\" id=\"dom-bluetoothpermissiondescriptor-optionalservices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">optionalServices</c-></code></dfn> = [];\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①⓪\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short③\"><c- b=\"\">unsigned</c-> <c- b=\"\">short</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"[]\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;unsigned short&gt;\" id=\"dom-bluetoothpermissiondescriptor-optionalmanufacturerdata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">optionalManufacturerData</c-></code></dfn> = [];\n  <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean②\"><c- b=\"\">boolean</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"false\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"boolean\" id=\"dom-bluetoothpermissiondescriptor-acceptalldevices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">acceptAllDevices</c-></code></dfn> = <c- b=\"\">false</c->;\n};\n</pre>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data-type\" id=\"ref-for-dfn-extra-permission-data-type\">extra permission data type</a>\n     </dt><dd>\n       <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage④\">BluetoothPermissionStorage</a></code>, defined as: \n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-allowedbluetoothdevice\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">AllowedBluetoothDevice</c-></code></dfn> {\n  <c- b=\"\">required</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString③\"><c- b=\"\">DOMString</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString\" id=\"dom-allowedbluetoothdevice-deviceid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">deviceId</c-></code></dfn>;\n  <c- b=\"\">required</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean③\"><c- b=\"\">boolean</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"boolean\" id=\"dom-allowedbluetoothdevice-mayusegatt\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">mayUseGATT</c-></code></dfn>;\n  // An allowedServices of \"all\" means all services are allowed.\n  <c- b=\"\">required</c-> (<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString④\"><c- b=\"\">DOMString</c-></a> <c- b=\"\">or</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①①\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-uuid\" id=\"ref-for-typedefdef-uuid\"><c- n=\"\">UUID</c-></a>&gt;) <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"(DOMString or sequence&lt;UUID&gt;)\" id=\"dom-allowedbluetoothdevice-allowedservices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedServices</c-></code></dfn>;\n  <c- b=\"\">required</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①②\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short④\"><c- b=\"\">unsigned</c-> <c- b=\"\">short</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;unsigned short&gt;\" id=\"dom-allowedbluetoothdevice-allowedmanufacturerdata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedManufacturerData</c-></code></dfn>;\n};\n<c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-bluetoothpermissionstorage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionStorage</c-></code></dfn> {\n  <c- b=\"\">required</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①③\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice\"><c- n=\"\">AllowedBluetoothDevice</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionStorage\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;AllowedBluetoothDevice&gt;\" id=\"dom-bluetoothpermissionstorage-alloweddevices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedDevices</c-></code></dfn>;\n};\n</pre>\n      <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice①\">AllowedBluetoothDevice</a></code> instances have an <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots②\">internal slot</a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-allowedbluetoothdevice-device-slot\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>[[device]]</code></dfn> that holds a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①①\">Bluetooth device</a>.</p>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data-constraints\" id=\"ref-for-dfn-extra-permission-data-constraints\">extra permission data constraints</a>\n     </dt><dd>\n       Distinct elements of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices⑤\">allowedDevices</a></code> must have\n    different <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot③\">[[device]]</a></code>s and different <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-deviceid\" id=\"ref-for-dom-allowedbluetoothdevice-deviceid①\">deviceId</a></code>s. \n      <p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-mayusegatt\" id=\"ref-for-dom-allowedbluetoothdevice-mayusegatt②\">mayUseGATT</a></code> is <code>false</code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices③\">allowedServices</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedmanufacturerdata\" id=\"ref-for-dom-allowedbluetoothdevice-allowedmanufacturerdata①\">allowedManufacturerData</a></code> must both be <code>[]</code>.</p>\n      \n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-result-type\" id=\"ref-for-dfn-permission-result-type\">permission result type</a>\n     </dt><dd>\n<pre class=\"idl highlight def\">[<a class=\"idl-code\" data-link-type=\"extended-attribute\" href=\"https://webidl.spec.whatwg.org/#Exposed\" id=\"ref-for-Exposed①\"><c- g=\"\">Exposed</c-></a>=<c- n=\"\">Window</c->]\n<c- b=\"\">interface</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"interface\" data-export=\"\" id=\"bluetoothpermissionresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionResult</c-></code></dfn> : <a data-link-type=\"idl-name\" href=\"https://w3c.github.io/permissions/#dom-permissionstatus\" id=\"ref-for-dom-permissionstatus\"><c- n=\"\">PermissionStatus</c-></a> {\n  <c- b=\"\">attribute</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array\"><c- b=\"\">FrozenArray</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice①①\"><c- n=\"\">BluetoothDevice</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionResult\" data-dfn-type=\"attribute\" data-export=\"\" data-type=\"FrozenArray&lt;BluetoothDevice&gt;\" id=\"dom-bluetoothpermissionresult-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">devices</c-></code></dfn>;\n};\n</pre>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-query-algorithm\" id=\"ref-for-dfn-permission-query-algorithm\">permission query algorithm</a>\n     </dt><dd class=\"algorithm\" data-algorithm=\"permission query\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"query-the-bluetooth-permission\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query the \"bluetooth\" permission</dfn> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissiondescriptor\" id=\"ref-for-dictdef-bluetoothpermissiondescriptor\">BluetoothPermissionDescriptor</a></code> <var>desc</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothpermissionresult\" id=\"ref-for-bluetoothpermissionresult\">BluetoothPermissionResult</a></code> <var>status</var>, the UA must: \n      \n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm\" id=\"ref-for-dfn-permission-revocation-algorithm\">permission revocation algorithm</a>\n     </dt><dd class=\"algorithm\" data-algorithm=\"permission revocation\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"revoke-bluetooth-access\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">revoke Bluetooth access</dfn> to devices the user no longer intends to expose,\n    the UA MUST run the following steps: \n      \n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a> for <var>status</var>.</p>"
        },
        {
          "html": "<p>Set <code><var>status</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state\">state</a></code></code> to <var>desc</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-state\" id=\"ref-for-dfn-permission-state①\">permission state</a>.</p>"
        },
        {
          "html": "<p>If <code><var>status</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstatus-state\" id=\"ref-for-dom-permissionstatus-state①\">state</a></code></code> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied③\">denied</a></code>\", set <code><var>status</var>.devices</code> to an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array①\">FrozenArray</a></code> and abort\nthese steps.</p>"
        },
        {
          "html": "<p>Let <var>matchingDevices</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-array-objects\" id=\"ref-for-sec-array-objects③\">Array</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>storage</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage⑤\">BluetoothPermissionStorage</a></code>, be <a class=\"idl-code\" data-link-type=\"permission\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permissiondef-bluetooth\" id=\"ref-for-permissiondef-bluetooth②\">\"bluetooth\"</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data\" id=\"ref-for-dfn-extra-permission-data②\">extra permission data</a> for the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-current-settings-object①\">current settings object</a>.</p>"
        },
        {
          "html": "For each <var>allowedDevice</var> in <code><var>storage</var>.allowedDevices</code>, run the\nfollowing sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>desc</var>.deviceId</code> is set and <code><var>allowedDevice</var>.deviceId != <var>desc</var>.deviceId</code>, continue to the next <var>allowedDevice</var>.</p>"
            },
            {
              "html": "If <code><var>desc</var>.filters</code> is set, do the following sub-steps:",
              "rationale": "replace",
              "steps": [
                {
                  "html": "<p>Replace each filter in <code><var>desc</var>.filters</code> with the\nresult of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothlescanfilterinit-canonicalizing\" id=\"ref-for-bluetoothlescanfilterinit-canonicalizing②\">canonicalizing</a> it. If any of these canonicalizations throws an error, return\nthat error and abort these steps.</p>"
                },
                {
                  "html": "<p>If <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot④\">[[device]]</a></code></code> does not <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#matches-a-filter\" id=\"ref-for-matches-a-filter⑤\">match a filter</a> in <code><var>desc</var>.filters</code>, continue\nto the next <var>allowedDevice</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing②\">Get the <code>BluetoothDevice</code> representing</a> <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot⑤\">[[device]]</a></code></code> within <code><var>global</var>.navigator.bluetooth</code>, and add the\nresult to <var>matchingDevices</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <code><var>status</var>.devices</code> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array②\">FrozenArray</a></code> whose\ncontents are <var>matchingDevices</var>.</p>"
        }
      ]
    },
    {
      "name": "permission revocation",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#revoke-bluetooth-access",
      "html": "<h3 class=\"heading settled\" data-level=\"4.1\" id=\"permission-api-integration\"><span class=\"secno\">4.1. </span><span class=\"content\">Permission API Integration</span><a class=\"self-link\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permission-api-integration\"></a></h3>\n    <p>The <a data-link-type=\"biblio\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#biblio-permissions\" title=\"Permissions\">[permissions]</a> API provides a uniform way for websites to query which\npermissions they have.</p>\n    \n    <p>The Web Bluetooth API is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-powerful-feature\" id=\"ref-for-dfn-powerful-feature\">powerful feature</a> that is identified by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-name\" id=\"ref-for-dfn-name\">name</a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"permission\" data-export=\"\" id=\"permissiondef-bluetooth\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>\"bluetooth\"</code></dfn>. Its\npermission-related algorithms and types are defined as follows:</p>\n    <dl>\n     <dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-descriptor-type\" id=\"ref-for-dfn-permission-descriptor-type\">permission descriptor type</a>\n     </dt><dd>\n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-bluetoothpermissiondescriptor\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionDescriptor</c-></code></dfn> : <a data-link-type=\"idl-name\" href=\"https://w3c.github.io/permissions/#dom-permissiondescriptor\" id=\"ref-for-dom-permissiondescriptor\"><c- n=\"\">PermissionDescriptor</c-></a> {\n  <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString②\"><c- b=\"\">DOMString</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString\" id=\"dom-bluetoothpermissiondescriptor-deviceid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">deviceId</c-></code></dfn>;\n  // These match RequestDeviceOptions.\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑧\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothlescanfilterinit\" id=\"ref-for-dictdef-bluetoothlescanfilterinit⑥\"><c- n=\"\">BluetoothLEScanFilterInit</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;BluetoothLEScanFilterInit&gt;\" id=\"dom-bluetoothpermissiondescriptor-filters\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">filters</c-></code></dfn>;\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑨\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-bluetoothserviceuuid\" id=\"ref-for-typedefdef-bluetoothserviceuuid④\"><c- n=\"\">BluetoothServiceUUID</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"[]\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;BluetoothServiceUUID&gt;\" id=\"dom-bluetoothpermissiondescriptor-optionalservices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">optionalServices</c-></code></dfn> = [];\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①⓪\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short③\"><c- b=\"\">unsigned</c-> <c- b=\"\">short</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"[]\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;unsigned short&gt;\" id=\"dom-bluetoothpermissiondescriptor-optionalmanufacturerdata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">optionalManufacturerData</c-></code></dfn> = [];\n  <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean②\"><c- b=\"\">boolean</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-default=\"false\" data-dfn-for=\"BluetoothPermissionDescriptor\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"boolean\" id=\"dom-bluetoothpermissiondescriptor-acceptalldevices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">acceptAllDevices</c-></code></dfn> = <c- b=\"\">false</c->;\n};\n</pre>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data-type\" id=\"ref-for-dfn-extra-permission-data-type\">extra permission data type</a>\n     </dt><dd>\n       <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage④\">BluetoothPermissionStorage</a></code>, defined as: \n<pre class=\"idl highlight def\"><c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-allowedbluetoothdevice\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">AllowedBluetoothDevice</c-></code></dfn> {\n  <c- b=\"\">required</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString③\"><c- b=\"\">DOMString</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"DOMString\" id=\"dom-allowedbluetoothdevice-deviceid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">deviceId</c-></code></dfn>;\n  <c- b=\"\">required</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean③\"><c- b=\"\">boolean</c-></a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"boolean\" id=\"dom-allowedbluetoothdevice-mayusegatt\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">mayUseGATT</c-></code></dfn>;\n  // An allowedServices of \"all\" means all services are allowed.\n  <c- b=\"\">required</c-> (<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString④\"><c- b=\"\">DOMString</c-></a> <c- b=\"\">or</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①①\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#typedefdef-uuid\" id=\"ref-for-typedefdef-uuid\"><c- n=\"\">UUID</c-></a>&gt;) <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"(DOMString or sequence&lt;UUID&gt;)\" id=\"dom-allowedbluetoothdevice-allowedservices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedServices</c-></code></dfn>;\n  <c- b=\"\">required</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①②\"><c- b=\"\">sequence</c-></a>&lt;<a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short④\"><c- b=\"\">unsigned</c-> <c- b=\"\">short</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;unsigned short&gt;\" id=\"dom-allowedbluetoothdevice-allowedmanufacturerdata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedManufacturerData</c-></code></dfn>;\n};\n<c- b=\"\">dictionary</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"dictionary\" data-export=\"\" id=\"dictdef-bluetoothpermissionstorage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionStorage</c-></code></dfn> {\n  <c- b=\"\">required</c-> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①③\"><c- b=\"\">sequence</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice\"><c- n=\"\">AllowedBluetoothDevice</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionStorage\" data-dfn-type=\"dict-member\" data-export=\"\" data-type=\"sequence&lt;AllowedBluetoothDevice&gt;\" id=\"dom-bluetoothpermissionstorage-alloweddevices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">allowedDevices</c-></code></dfn>;\n};\n</pre>\n      <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice①\">AllowedBluetoothDevice</a></code> instances have an <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots②\">internal slot</a> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AllowedBluetoothDevice\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-allowedbluetoothdevice-device-slot\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>[[device]]</code></dfn> that holds a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①①\">Bluetooth device</a>.</p>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data-constraints\" id=\"ref-for-dfn-extra-permission-data-constraints\">extra permission data constraints</a>\n     </dt><dd>\n       Distinct elements of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices⑤\">allowedDevices</a></code> must have\n    different <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot③\">[[device]]</a></code>s and different <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-deviceid\" id=\"ref-for-dom-allowedbluetoothdevice-deviceid①\">deviceId</a></code>s. \n      <p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-mayusegatt\" id=\"ref-for-dom-allowedbluetoothdevice-mayusegatt②\">mayUseGATT</a></code> is <code>false</code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices③\">allowedServices</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedmanufacturerdata\" id=\"ref-for-dom-allowedbluetoothdevice-allowedmanufacturerdata①\">allowedManufacturerData</a></code> must both be <code>[]</code>.</p>\n      \n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-result-type\" id=\"ref-for-dfn-permission-result-type\">permission result type</a>\n     </dt><dd>\n<pre class=\"idl highlight def\">[<a class=\"idl-code\" data-link-type=\"extended-attribute\" href=\"https://webidl.spec.whatwg.org/#Exposed\" id=\"ref-for-Exposed①\"><c- g=\"\">Exposed</c-></a>=<c- n=\"\">Window</c->]\n<c- b=\"\">interface</c-> <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-type=\"interface\" data-export=\"\" id=\"bluetoothpermissionresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">BluetoothPermissionResult</c-></code></dfn> : <a data-link-type=\"idl-name\" href=\"https://w3c.github.io/permissions/#dom-permissionstatus\" id=\"ref-for-dom-permissionstatus\"><c- n=\"\">PermissionStatus</c-></a> {\n  <c- b=\"\">attribute</c-> <a class=\"idl-code\" data-link-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array\"><c- b=\"\">FrozenArray</c-></a>&lt;<a data-link-type=\"idl-name\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice①①\"><c- n=\"\">BluetoothDevice</c-></a>&gt; <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothPermissionResult\" data-dfn-type=\"attribute\" data-export=\"\" data-type=\"FrozenArray&lt;BluetoothDevice&gt;\" id=\"dom-bluetoothpermissionresult-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code><c- g=\"\">devices</c-></code></dfn>;\n};\n</pre>\n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-query-algorithm\" id=\"ref-for-dfn-permission-query-algorithm\">permission query algorithm</a>\n     </dt><dd class=\"algorithm\" data-algorithm=\"permission query\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"query-the-bluetooth-permission\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query the \"bluetooth\" permission</dfn> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissiondescriptor\" id=\"ref-for-dictdef-bluetoothpermissiondescriptor\">BluetoothPermissionDescriptor</a></code> <var>desc</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothpermissionresult\" id=\"ref-for-bluetoothpermissionresult\">BluetoothPermissionResult</a></code> <var>status</var>, the UA must: \n      \n     </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-permission-revocation-algorithm\" id=\"ref-for-dfn-permission-revocation-algorithm\">permission revocation algorithm</a>\n     </dt><dd class=\"algorithm\" data-algorithm=\"permission revocation\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"revoke-bluetooth-access\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">revoke Bluetooth access</dfn> to devices the user no longer intends to expose,\n    the UA MUST run the following steps: \n      \n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>storage</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage⑥\">BluetoothPermissionStorage</a></code>, be <a class=\"idl-code\" data-link-type=\"permission\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permissiondef-bluetooth\" id=\"ref-for-permissiondef-bluetooth③\">\"bluetooth\"</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data\" id=\"ref-for-dfn-extra-permission-data③\">extra permission data</a> for the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-current-settings-object②\">current settings object</a>.</p>"
        },
        {
          "html": "For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice①②\">BluetoothDevice</a></code> instance <var>deviceObj</var> in the <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#current-realm\" id=\"ref-for-current-realm\">current\nrealm</a>, run the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If there is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice②\">AllowedBluetoothDevice</a></code> <var>allowedDevice</var> in <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices⑥\">allowedDevices</a></code></code> such that:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot⑥\">[[device]]</a></code></code> is the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device\">same\ndevice</a> as <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot\">[[representedDevice]]</a></code></code>, and</p>\n           </li><li data-md=\"\">\n            <p><code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-deviceid\" id=\"ref-for-dom-allowedbluetoothdevice-deviceid③\">deviceId</a></code> === <var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-id\" id=\"ref-for-dom-bluetoothdevice-id\">id</a></code></code>,</p>\n          </li></ul>\n          <p>then update <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot\">[[allowedServices]]</a></code></code> to be <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices④\">allowedServices</a></code></code>, and continue to\nthe next <var>deviceObj</var>.</p>"
            },
            {
              "html": "<p>Otherwise, detach <var>deviceObj</var> from its device by running the\nremaining steps.</p>"
            },
            {
              "html": "<p>Call <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-disconnect\" id=\"ref-for-dom-bluetoothremotegattserver-disconnect\">disconnect()</a></code></code>.</p>"
            },
            {
              "html": "<p>Set <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①\">[[representedDevice]]</a></code></code> to <code>null</code>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Bluetooth/getAvailability()",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-getavailability",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Bluetooth\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetooth-getavailability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getAvailability()</code></dfn></code> method,\nwhen invoked, MUST return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> <var>promise</var> and run the following\nsteps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use②\">allowed to use</a> the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature②\">policy-controlled feature</a> named\n\"<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#policy-controlled-feature-bluetooth\" id=\"ref-for-policy-controlled-feature-bluetooth②\">bluetooth</a>\", <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">queue a global task</a> on\nthe <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">resolve</a> <var>promise</var> with <code>false</code>, and abort these steps.</p>"
        },
        {
          "html": "<p id=\"override-availability\">If the user has configured the UA to return a\nparticular answer from this function for the current origin, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">queue a\ntask</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolve</a> <var>promise</var> with the configured answer, and abort\nthese steps.</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①\">navigable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "If <var>simulatedBluetoothAdapter</var> is not empty,",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#adapter-state\" id=\"ref-for-adapter-state\">adapter state</a> is \"absent\", <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑤\">resolve</a> <var>promise</var> with <code>false</code>.</p>"
            },
            {
              "html": "<p>If <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#le-supported-state\" id=\"ref-for-le-supported-state\">LE supported state</a> is <code>false</code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source④\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑥\">resolve</a> <var>promise</var> with <code>false</code>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source⑤\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑦\">resolve</a> <var>promise</var> with <code>true</code>.</p>"
            },
            {
              "html": "<p>Abort these steps.</p>"
            }
          ]
        },
        {
          "html": "<p>If the UA is running on a system that has a Bluetooth radio <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source⑥\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑧\">resolve</a> <var>promise</var> with <code>true</code> regardless of the powered state of the Bluetooth\nradio.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source⑦\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑨\">resolve</a> <var>promise</var> with <code>false</code>.</p>"
        }
      ]
    },
    {
      "name": "availabilitychanged",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#availability-changed-algorithm",
      "html": "If the UA becomes able or unable to use Bluetooth, for example because a radio\nwas physically attached or detached, or the user has changed their <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#override-availability\">configuration</a> for the answer returned from <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-getavailability\" id=\"ref-for-dom-bluetooth-getavailability⑥\">getAvailability()</a></code>, the UA must <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑧\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source⑧\">Bluetooth task source</a> given each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object\">global object</a> <var>global</var> to run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>oldAvailability</var> be the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-getavailability\" id=\"ref-for-dom-bluetooth-getavailability⑦\">getAvailability()</a></code> would have returned\nbefore the change.</p>"
        },
        {
          "html": "<p>Let <var>newAvailability</var> be the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-getavailability\" id=\"ref-for-dom-bluetooth-getavailability⑧\">getAvailability()</a></code> would return after\nthe change.</p>"
        },
        {
          "html": "If <var>oldAvailability</var> is not the same as <var>newAvailability</var>,",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigator</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator\">associated <code>Navigator</code></a>.</p>"
            },
            {
              "html": "<p>Let <var>bluetooth</var> be <var>navigator</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth\">associated <code>Bluetooth</code></a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetooth-availabilitychanged\" id=\"ref-for-eventdef-bluetooth-availabilitychanged②\">availabilitychanged</a></code> using the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valueevent\" id=\"ref-for-valueevent\">ValueEvent</a></code> interface at <var>bluetooth</var> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-valueevent-value\" id=\"ref-for-dom-valueevent-value\">value</a></code> attribute\ninitialized to <var>newAvailability</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get or create BluetoothDevice",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-the-bluetoothdevice-representing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the <code>BluetoothDevice</code> representing</dfn> a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①⑤\">Bluetooth device</a> <var>device</var> inside a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth\" id=\"ref-for-bluetooth⑦\">Bluetooth</a></code> instance <var>context</var>, the UA MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>storage</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage⑦\">BluetoothPermissionStorage</a></code>, be <a class=\"idl-code\" data-link-type=\"permission\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permissiondef-bluetooth\" id=\"ref-for-permissiondef-bluetooth④\">\"bluetooth\"</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data\" id=\"ref-for-dfn-extra-permission-data④\">extra permission data</a> for the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-current-settings-object③\">current settings object</a>.</p>"
        },
        {
          "html": "<p>Find the <var>allowedDevice</var> in <code><var>storage</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices⑦\">allowedDevices</a></code></code> with <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot⑦\">[[device]]</a></code></code> the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device①\">same device</a> as <var>device</var>. If there is no such object, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑥\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "If there is no key in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-deviceinstancemap-slot\" id=\"ref-for-dom-bluetooth-deviceinstancemap-slot\">[[deviceInstanceMap]]</a></code> that is the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device②\">same device</a> as <var>device</var>, run the following\nsub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be a new instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②⓪\">BluetoothDevice</a></code>.</p>"
            },
            {
              "html": "<p>Initialize all of <var>result</var>’s optional fields to <code>null</code>.</p>"
            },
            {
              "html": "<p>Initialize <code><var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-context-slot\" id=\"ref-for-dom-bluetoothdevice-context-slot\">[[context]]</a></code></code> to <var>context</var>.</p>"
            },
            {
              "html": "<p>Initialize <code><var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot②\">[[representedDevice]]</a></code></code> to <var>device</var>.</p>"
            },
            {
              "html": "<p>Initialize <code><var>result</var>.id</code> to <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-deviceid\" id=\"ref-for-dom-allowedbluetoothdevice-deviceid④\">deviceId</a></code></code>,\nand initialize <code><var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot①\">[[allowedServices]]</a></code></code> to <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-allowedservices\" id=\"ref-for-dom-allowedbluetoothdevice-allowedservices⑥\">allowedServices</a></code></code>.</p>"
            },
            {
              "html": "<p>If <var>device</var> has a partial or complete <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device-name\" id=\"ref-for-bluetooth-device-name⑧\">Bluetooth Device\nName</a>, set <code><var>result</var>.name</code> to that string.</p>"
            },
            {
              "html": "<p>Initialize <code><var>result</var>.watchingAdvertisements</code> to <code>false</code>.</p>"
            },
            {
              "html": "<p>Add a mapping from <var>device</var> to <var>result</var> in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-deviceinstancemap-slot\" id=\"ref-for-dom-bluetooth-deviceinstancemap-slot①\">[[deviceInstanceMap]]</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the value in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-deviceinstancemap-slot\" id=\"ref-for-dom-bluetooth-deviceinstancemap-slot②\">[[deviceInstanceMap]]</a></code> whose key is the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device③\">same device</a> as <var>device</var>.</p>"
        }
      ]
    },
    {
      "name": "get gatt attribute",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt",
      "html": "Getting the <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothDevice\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-bluetoothdevice-gatt\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>gatt</code></dfn></code> attribute MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a class=\"idl-code\" data-link-type=\"permission\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#permissiondef-bluetooth\" id=\"ref-for-permissiondef-bluetooth⑤\">\"bluetooth\"</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-extra-permission-data\" id=\"ref-for-dfn-extra-permission-data⑤\">extra permission data</a> for <code>this</code>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant\nsettings object</a> has an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-allowedbluetoothdevice\" id=\"ref-for-dictdef-allowedbluetoothdevice③\">AllowedBluetoothDevice</a></code> <var>allowedDevice</var> in its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothpermissionstorage-alloweddevices\" id=\"ref-for-dom-bluetoothpermissionstorage-alloweddevices⑧\">allowedDevices</a></code> list with <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-device-slot\" id=\"ref-for-dom-allowedbluetoothdevice-device-slot⑧\">[[device]]</a></code></code> the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device④\">same device</a> as <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot③\">[[representedDevice]]</a></code></code> and <code><var>allowedDevice</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-allowedbluetoothdevice-mayusegatt\" id=\"ref-for-dom-allowedbluetoothdevice-mayusegatt③\">mayUseGATT</a></code></code> equal to <code>true</code>, return <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt-slot\" id=\"ref-for-dom-bluetoothdevice-gatt-slot\">[[gatt]]</a></code></code>.</p>"
        },
        {
          "html": "<p>Otherwise, return <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "forget invocation",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-forget",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothDevice\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetoothdevice-forget\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>forget()</code></dfn></code> method, when\ninvoked, MUST return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a> <var>promise</var> and run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>device</var> be the target <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②①\">BluetoothDevice</a></code> object.</p>"
        },
        {
          "html": "<p>Let <var>storage</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothpermissionstorage\" id=\"ref-for-dictdef-bluetoothpermissionstorage⑧\">BluetoothPermissionStorage</a></code> object in the current\nscript execution environment.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#remove-device-from-storage\" id=\"ref-for-remove-device-from-storage\">Remove <var>device</var> from storage</a> with <var>storage</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⓪\">Resolve</a> <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "watchAdvertisements",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisements",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothDevice\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"watchAdvertisements(options)|watchAdvertisements()\" id=\"dom-bluetoothdevice-watchadvertisements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>watchAdvertisements(<var>options</var>)</code></dfn> </code> method, when invoked, MUST return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise④\">a new promise</a> <var>promise</var> and\nrun the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>.</p>"
        },
        {
          "html": "If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①\">signal</a></code></code> is present, then perform\nthe following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal②\">signal</a></code></code> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#abort-watchadvertisements\" id=\"ref-for-abort-watchadvertisements\">abort watchAdvertisements</a> with <code>this</code> and abort these steps.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">Add the following abort steps</a> to <code> <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal③\">signal</a></code></code>:",
              "rationale": "abort",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#abort-watchadvertisements\" id=\"ref-for-abort-watchadvertisements①\">Abort watchAdvertisements</a> with <code>this</code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">Reject</a> <var>promise</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror\">AbortError</a></code></p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot\">[[watchAdvertisementsState]]</a></code></code> is:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "'not-watching'",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot①\">[[watchAdvertisementsState]]</a></code></code> to <code>'pending-watch'</code>.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps\">Enqueue the following steps</a> to the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#watch-advertisements-manager\" id=\"ref-for-watch-advertisements-manager\">watch advertisements manager</a>, but abort when <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot②\">[[watchAdvertisementsState]]</a></code></code> becomes <code>not-watching</code>:",
                      "rationale": "ensure",
                      "steps": [
                        {
                          "html": "<p>Ensure that the UA is scanning for this device’s\n  advertisements. The UA SHOULD NOT filter out \"duplicate\"\n  advertisements for the same device.</p>"
                        },
                        {
                          "html": "If the UA fails to enable scanning, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑨\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source⑨\">Bluetooth task source</a> given <var>global</var> to perform\n  the following steps, and abort these steps:",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "<p>Set <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot③\">[[watchAdvertisementsState]]</a></code></code> to <code>'not-watching'</code>.</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">Reject</a> <var>promise</var> with one of the following errors:",
                              "rationale": ".switch",
                              "steps": [
                                {
                                  "operation": "switch",
                                  "steps": [
                                    {
                                      "case": "The UA doesn’t support scanning for advertisements",
                                      "html": "<p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code></p>"
                                    },
                                    {
                                      "case": "Bluetooth is turned off",
                                      "html": "<p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code></p>"
                                    },
                                    {
                                      "case": "Other reasons",
                                      "html": "<p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror\">UnknownError</a></code></p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⓪\">Bluetooth task source</a> given <var>global</var> to perform the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot④\">[[watchAdvertisementsState]]</a></code></code> becomes <code>not-watching</code>:",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "<p>Set <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot⑤\">[[watchAdvertisementsState]]</a></code></code> to <code>watching</code>.</p>"
                            },
                            {
                              "html": "<p>Set <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchingadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchingadvertisements①\">watchingAdvertisements</a></code></code> to <code>true</code>.</p>"
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①①\">Resolve</a> <var>promise</var> with <code>undefined</code>.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "'pending-watch'",
                  "html": "",
                  "rationale": "reject",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">Reject</a> <var>promise</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>.</p>"
                    }
                  ]
                },
                {
                  "case": "'watching'",
                  "html": "",
                  "rationale": "resolve",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①②\">Resolve</a> <var>promise</var> with <code>undefined</code>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">reject</a> <var>promise</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror①\">AbortError</a></code>.</p>"
        }
      ]
    },
    {
      "name": "abort watchAdvertisements",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#abort-watchadvertisements",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"abort-watchadvertisements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">abort <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchadvertisements③\">watchAdvertisements</a></code></dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②②\">BluetoothDevice</a></code> <var>device</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot⑥\">[[watchAdvertisementsState]]</a></code></code> to <code>'not-watching'</code>.</p>"
        },
        {
          "html": "<p>Set <code><var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchingadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchingadvertisements②\">watchingAdvertisements</a></code></code> to <code>false</code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps①\">Enqueue the following steps</a> to <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#watch-advertisements-manager\" id=\"ref-for-watch-advertisements-manager①\">watch advertisements manager</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If no more <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②③\">BluetoothDevice</a></code>s in the whole UA have <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchingadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchingadvertisements③\">watchingAdvertisements</a></code> set to <code>true</code>, the UA SHOULD stop scanning\nfor advertisements. Otherwise, if no more <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②④\">BluetoothDevice</a></code>s\nrepresenting the same device as <code>this</code> have <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchingadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchingadvertisements④\">watchingAdvertisements</a></code> set to <code>true</code>, the UA SHOULD reconfigure the scan to avoid receiving\nreports for this device.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "abort all active watchAdvertisments",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#abort-all-active-watchadvertisements",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"abort-all-active-watchadvertisements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">abort all active <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchadvertisements④\">watchAdvertisements</a></code></dfn> operations given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth\" id=\"ref-for-bluetooth⑧\">Bluetooth</a></code> <var>bluetooth</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>device</var> in <var>bluetooth</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-deviceinstancemap-slot\" id=\"ref-for-dom-bluetooth-deviceinstancemap-slot③\">[[deviceInstanceMap]]</a></code>, perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot⑦\">[[watchAdvertisementsState]]</a></code> is <code>pending-watch</code> or <code>watching</code>, run <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#abort-watchadvertisements\" id=\"ref-for-abort-watchadvertisements②\">abort watchAdvertisements</a> with <var>device</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "handle visibility change",
      "html": "This specification defines the following <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#page-visibility-change-steps\" id=\"ref-for-page-visibility-change-steps\">page visibility change steps</a> given <var>visibilityState</var> and <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①①\">Bluetooth task source</a> given <var>global</var> to\nperform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigator</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator①\">associated <code>Navigator</code></a>.</p>"
            },
            {
              "html": "<p>Let <var>bluetooth</var> be <var>navigator</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth①\">associated <code>Bluetooth</code></a>.</p>"
            },
            {
              "html": "<p>If <var>visibilityState</var> is not <code>\"visible\"</code>, then <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#abort-all-active-watchadvertisements\" id=\"ref-for-abort-all-active-watchadvertisements\">abort all active watchAdvertisements</a> operations on <var>bluetooth</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "handle full activity loss",
      "html": "When the user agent determines that a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document\">Document</a></code> is no longer <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active②\">fully active</a>, it must run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①\">Document</a></code> that is no longer <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active③\">fully active</a>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①②\">Bluetooth task source</a> given <var>global</var> to\nperform the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigator</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator②\">associated <code>Navigator</code></a>.</p>"
            },
            {
              "html": "<p>Let <var>bluetooth</var> be <var>navigator</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth②\">associated <code>Bluetooth</code></a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#abort-all-active-watchadvertisements\" id=\"ref-for-abort-all-active-watchadvertisements①\">abort all active watchAdvertisements</a> operations on <var>bluetooth</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "received advertising event",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#advertising-event-algorithm",
      "html": "When the UA receives an <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#advertising-event\" id=\"ref-for-advertising-event①\">advertising event</a> (consisting of an advertising\npacket and an optional scan response), it MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>device</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①⑥\">Bluetooth device</a> that sent the\nadvertising event.</p>"
        },
        {
          "html": "For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice②⑨\">BluetoothDevice</a></code> <var>deviceObj</var> in the UA such that <var>device</var> is the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device⑤\">same device</a> as <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot④\">[[representedDevice]]</a></code></code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task①\">queue a\ntask</a> on <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop\">responsible event loop</a> to do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchingadvertisements\" id=\"ref-for-dom-bluetoothdevice-watchingadvertisements⑥\">watchingAdvertisements</a></code></code> is <code>false</code>, abort these sub-steps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#fire-an-advertisementreceived-event\" id=\"ref-for-fire-an-advertisementreceived-event\">Fire an <code>advertisementreceived</code> event</a> for the advertising event at <var>deviceObj</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fire advertisementreceived event",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#fire-an-advertisementreceived-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fire-an-advertisementreceived-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fire an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothdeviceeventhandlers-advertisementreceived\" id=\"ref-for-eventdef-bluetoothdeviceeventhandlers-advertisementreceived②\">advertisementreceived</a></code> event</dfn> for an advertising event <var>adv</var> at a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice③⓪\">BluetoothDevice</a></code> <var>deviceObj</var>,\nthe UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>event</var> be</p>\n<pre class=\"highlight\"><c- p=\"\">{</c->\n  bubbles<c- o=\"\">:</c-> <c- kc=\"\">true</c-><c- p=\"\">,</c->\n  device<c- o=\"\">:</c-> <var>deviceObj</var><c- p=\"\">,</c->\n  uuids<c- o=\"\">:</c-> <c- p=\"\">[],</c->\n  manufacturerData<c- o=\"\">:</c-> <c- ow=\"\">new</c-> Map<c- p=\"\">(),</c->\n  serviceData<c- o=\"\">:</c-> <c- ow=\"\">new</c-> Map<c- p=\"\">()</c->\n<c- p=\"\">}</c->\n</pre>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#rssi\" id=\"ref-for-rssi\">received signal strength</a> is available for any packet in <var>adv</var>,\nset <code><var>event</var>.rssi</code> to this signal strength in dBm.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#ad-structure\" id=\"ref-for-ad-structure\">AD structure</a> in <var>adv</var>’s advertising packet and scan response,\nselect from the following steps depending on the AD type:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "Incomplete List of 16-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Complete List of 16-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Incomplete List of 32-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Complete List of 32-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Incomplete List of 128-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Complete List of 128-bit Service UUIDs",
                  "html": "For each <code><var>uuid</var></code> in the listed UUIDs, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot②\">[[allowedServices]]</a></code></code>, then\n    append <code><var>uuid</var></code> to <code><var>event</var>.uuids</code>."
                },
                {
                  "case": "Shortened Local Name",
                  "html": "<a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode-without-bom\" id=\"ref-for-utf-8-decode-without-bom①\">UTF-8 decode without BOM</a> the AD data and set <code><var>event</var>.name</code> to the result."
                },
                {
                  "case": "Complete Local Name",
                  "html": "<a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode-without-bom\" id=\"ref-for-utf-8-decode-without-bom①\">UTF-8 decode without BOM</a> the AD data and set <code><var>event</var>.name</code> to the result."
                },
                {
                  "case": "Manufacturer Specific Data",
                  "html": "For each 16-bit Company Identifier Code <code><var>manufacturerCode</var></code>, if it is in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedmanufacturerdata-slot\" id=\"ref-for-dom-bluetoothdevice-allowedmanufacturerdata-slot\">[[allowedManufacturerData]]</a></code></code>,\n    and the manufacturer data is not a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-manufacturer-data\" id=\"ref-for-blocklisted-manufacturer-data\">blocklisted manufacturer data</a> then add a mapping of <code><var>manufacturerCode</var></code> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor\">ArrayBuffer</a></code> containing the manufacturer-specific data to <code><var>event</var>.manufacturerData</code>."
                },
                {
                  "case": "TX Power Level",
                  "html": "Set <code><var>event</var>.txPower</code> to the AD data."
                },
                {
                  "case": "Service Data - 16 bit UUID",
                  "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#uuid\" id=\"ref-for-uuid①\">UUID</a> <code><var>uuid</var></code> in the service data, if it is\n    in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot③\">[[allowedServices]]</a></code></code>,\n    then add a mapping of <var>uuid</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor①\">ArrayBuffer</a></code> containing the\n    service data to <code><var>event</var>.serviceData</code>."
                },
                {
                  "case": "Service Data - 32 bit UUID",
                  "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#uuid\" id=\"ref-for-uuid①\">UUID</a> <code><var>uuid</var></code> in the service data, if it is\n    in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot③\">[[allowedServices]]</a></code></code>,\n    then add a mapping of <var>uuid</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor①\">ArrayBuffer</a></code> containing the\n    service data to <code><var>event</var>.serviceData</code>."
                },
                {
                  "case": "Service Data - 128 bit UUID",
                  "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#uuid\" id=\"ref-for-uuid①\">UUID</a> <code><var>uuid</var></code> in the service data, if it is\n    in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot③\">[[allowedServices]]</a></code></code>,\n    then add a mapping of <var>uuid</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor①\">ArrayBuffer</a></code> containing the\n    service data to <code><var>event</var>.serviceData</code>."
                },
                {
                  "case": "Appearance",
                  "html": "Set <code><var>event</var>.appearance</code> to the AD data."
                },
                {
                  "case": "Otherwise",
                  "html": "Skip to the next AD structure."
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire①\">Fire an event</a> named \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothdeviceeventhandlers-advertisementreceived\" id=\"ref-for-eventdef-bluetoothdeviceeventhandlers-advertisementreceived③\">advertisementreceived</a></code>\" using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothadvertisingevent\" id=\"ref-for-bluetoothadvertisingevent①\">BluetoothAdvertisingEvent</a></code> initialized with <var>event</var>, with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-istrusted\" id=\"ref-for-dom-event-istrusted\">isTrusted</a></code> attribute initialized\nto <code>true</code>, at <var>deviceObj</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothAdvertisingEvent contructor",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothadvertisingevent-bluetoothadvertisingevent",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothAdvertisingEvent\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"BluetoothAdvertisingEvent(type, init)|constructor(type, init)\" id=\"dom-bluetoothadvertisingevent-bluetoothadvertisingevent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>BluetoothAdvertisingEvent(type, init)</code></dfn> constructor MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>event</var> be the result of running the steps from <a href=\"https://dom.spec.whatwg.org/#constructing-events\"><cite>DOM</cite> § 2.5 Constructing events</a> except for the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothadvertisingeventinit-uuids\" id=\"ref-for-dom-bluetoothadvertisingeventinit-uuids\">uuids</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothadvertisingeventinit-manufacturerdata\" id=\"ref-for-dom-bluetoothadvertisingeventinit-manufacturerdata\">manufacturerData</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothadvertisingeventinit-servicedata\" id=\"ref-for-dom-bluetoothadvertisingeventinit-servicedata\">serviceData</a></code> members.</p>"
        },
        {
          "html": "<p>If <code><var>init</var>.uuids</code> is set, initialize <code><var>event</var>.uuids</code> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array④\">FrozenArray</a></code> containing the\nelements of <code><var>init</var>.uuids.map( <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice⑤\">BluetoothUUID.getService</a></code>)</code>.\nOtherwise initialize <code><var>event</var>.uuids</code> to an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-frozen-array\" id=\"ref-for-idl-frozen-array⑤\">FrozenArray</a></code>.</p>"
        },
        {
          "html": "For each mapping in <code><var>init</var>.manufacturerData</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>code</var> be the key converted to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short⑧\">unsigned short</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>value</var> be the value.</p>"
            },
            {
              "html": "<p>If <var>value</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#BufferSource\" id=\"ref-for-BufferSource②\">BufferSource</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①④\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>bytes</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#read-only-arraybuffer\" id=\"ref-for-read-only-arraybuffer\">read only ArrayBuffer</a> containing <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy④\">a copy of the bytes held</a> by <var>value</var>.</p>"
            },
            {
              "html": "<p>Add a mapping from <var>code</var> to <code>new\nDataView(<var>bytes</var>)</code> in <code><var>event</var>.manufacturerData.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothmanufacturerdatamap-backingmap-slot\" id=\"ref-for-dom-bluetoothmanufacturerdatamap-backingmap-slot\">[[BackingMap]]</a></code></code>.</p>"
            }
          ]
        },
        {
          "html": "For each mapping in <code><var>init</var>.serviceData</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>key</var> be the key.</p>"
            },
            {
              "html": "<p>Let <var>service</var> be the result of calling <code>BluetoothUUID.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice⑥\">getService</a></code>(<var>key</var>).</code></p>"
            },
            {
              "html": "<p>Let <var>value</var> be the value.</p>"
            },
            {
              "html": "<p>If <var>value</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#BufferSource\" id=\"ref-for-BufferSource③\">BufferSource</a></code>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①⑤\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>bytes</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#read-only-arraybuffer\" id=\"ref-for-read-only-arraybuffer①\">read only ArrayBuffer</a> containing <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy⑤\">a copy of the bytes held</a> by <var>value</var>.</p>"
            },
            {
              "html": "<p>Add a mapping from <var>service</var> to <code>new\nDataView(<var>bytes</var>)</code> in <code><var>event</var>.serviceData.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothservicedatamap-backingmap-slot\" id=\"ref-for-dom-bluetoothservicedatamap-backingmap-slot\">[[BackingMap]]</a></code></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>event</var>.</p>"
        }
      ]
    },
    {
      "name": "populate Bluetooth cache",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#populate-the-bluetooth-cache",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"populate-the-bluetooth-cache\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">populate the Bluetooth cache</dfn> with entries matching some\ndescription, the UA MUST run the following steps.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Attempt to make all matching entries in the cache either known-present or\nknown-absent, using any sequence of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#gatt-procedure\" id=\"ref-for-gatt-procedure①\">GATT procedures</a> that <a data-link-type=\"biblio\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#biblio-bluetooth42\" title=\"BLUETOOTH SPECIFICATION Version 4.2\">[BLUETOOTH42]</a> specifies will return enough information. Handle errors as\ndescribed in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
        },
        {
          "html": "<p>If the previous step returns an error, return that error from this algorithm.</p>"
        }
      ]
    },
    {
      "name": "query Bluetooth cache",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#query-the-bluetooth-cache",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"query-the-bluetooth-cache\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query the Bluetooth cache</dfn> in a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice③①\">BluetoothDevice</a></code> instance <var>deviceObj</var> for entries matching some description, the UA MUST return a <var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt②\">gatt</a></code>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑤\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#populate-the-bluetooth-cache\" id=\"ref-for-populate-the-bluetooth-cache②\">Populate the Bluetooth cache</a> with entries matching the description.</p>"
        },
        {
          "html": "<p>If the previous step returns an error, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①③\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①③\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">reject</a> <var>promise</var> with that\nerror and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>entries</var> be the sequence of known-present cache entries matching the\ndescription.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-context-slot\" id=\"ref-for-dom-bluetoothdevice-context-slot①\">[[context]]</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new sequence.</p>"
        },
        {
          "html": "For each <var>entry</var> in <var>entries</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>entry</var> has no associated <code>Promise&lt;BluetoothGATT*&gt;</code> instance in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot\">[[attributeInstanceMap]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattservice-representing\" id=\"ref-for-create-a-bluetoothremotegattservice-representing\">create a <code>BluetoothRemoteGATTService</code> representing</a> <var>entry</var>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattcharacteristic-representing\" id=\"ref-for-create-a-bluetoothremotegattcharacteristic-representing\">create a <code>BluetoothRemoteGATTCharacteristic</code> representing</a> <var>entry</var>, or <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattdescriptor-representing\" id=\"ref-for-create-a-bluetoothremotegattdescriptor-representing\">create a <code>BluetoothRemoteGATTDescriptor</code> representing</a> <var>entry</var>,\ndepending on whether <var>entry</var> is a Service, Characteristic, or\nDescriptor, and add a mapping from <var>entry</var> to the resulting <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-promise-objects\" id=\"ref-for-sec-promise-objects⑥\">Promise</a></code> in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot①\">[[attributeInstanceMap]]</a></code>.</p>"
            },
            {
              "html": "<p>Append to <var>result</var> the <code>Promise&lt;BluetoothGATT*&gt;</code> instance associated with <var>entry</var> in <var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot②\">[[attributeInstanceMap]]</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①④\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①③\">resolve</a> <var>promise</var> with the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#wait-for-all\" id=\"ref-for-wait-for-all\">waiting for all</a> elements of <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "represented properties",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#represented",
      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"represented\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Represented</dfn>(<var>obj</var>: Device or GATT Attribute) returns, depending on\nthe type of <var>obj</var>: \n    <dl class=\"switch\">\n     <dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice③②\">BluetoothDevice</a></code>\n     </dt><dd><code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑤\">[[representedDevice]]</a></code></code>\n     </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice④\">BluetoothRemoteGATTService</a></code>\n     </dt><dd><code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot\">[[representedService]]</a></code></code>\n     </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic⑤\">BluetoothRemoteGATTCharacteristic</a></code>\n     </dt><dd><code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\">[[representedCharacteristic]]</a></code></code>\n     </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattdescriptor\" id=\"ref-for-bluetoothremotegattdescriptor④\">BluetoothRemoteGATTDescriptor</a></code>\n     </dt><dd><code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot\">[[representedDescriptor]]</a></code></code>\n    </dd></dl>",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "BluetoothDevice",
              "html": "<code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑤\">[[representedDevice]]</a></code></code>"
            },
            {
              "case": "BluetoothRemoteGATTService",
              "html": "<code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot\">[[representedService]]</a></code></code>"
            },
            {
              "case": "BluetoothRemoteGATTCharacteristic",
              "html": "<code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\">[[representedCharacteristic]]</a></code></code>"
            },
            {
              "case": "BluetoothRemoteGATTDescriptor",
              "html": "<code><var>obj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot\">[[representedDescriptor]]</a></code></code>"
            }
          ]
        }
      ]
    },
    {
      "name": "get GATT children",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#getgattchildren",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"getgattchildren\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">GetGATTChildren</dfn>(<span class=\"argument-list\"> <var>attribute</var>: GATT Attribute,<br> <var>single</var>: boolean,<br> <var>uuidCanonicalizer</var>: function,<br> <var>uuid</var>: optional <code>(DOMString or unsigned int)</code>,<br> <var>allowedUuids</var>: optional <code>(\"all\" or Array&lt;DOMString&gt;)</code>,<br> <var>child type</var>: GATT declaration type),</span><br> the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>uuid</var> is present, set it to <var>uuidCanonicalizer</var>(<var>uuid</var>). If <var>uuidCanonicalizer</var> threw an exception, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with③\">a promise\nrejected with</a> that exception and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>uuid</var> is present and is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted\" id=\"ref-for-blocklisted③\">blocklisted</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with④\">a promise\nrejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑦\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "Let <var>deviceObj</var> be, depending on the type of <var>attribute</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "BluetoothDevice",
                  "html": "<code><var>attribute</var></code>"
                },
                {
                  "case": "BluetoothRemoteGATTService",
                  "html": "<code><var>attribute</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device\">device</a></code></code>"
                },
                {
                  "case": "BluetoothRemoteGATTCharacteristic",
                  "html": "<code> <var>attribute</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device①\">device</a></code> </code>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①\">connected</a></code></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑤\">a promise rejected with</a> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#represented\" id=\"ref-for-represented\">Represented</a>(<var>attribute</var>) is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑥\">a promise rejected\nwith</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#query-the-bluetooth-cache\" id=\"ref-for-query-the-bluetooth-cache\">Query the Bluetooth cache</a> in <code><var>deviceObj</var></code> for\nentries that:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>are within <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#represented\" id=\"ref-for-represented①\">Represented</a>(<var>attribute</var>),</p>\n       </li><li data-md=\"\">\n        <p>have a type described by <var>child type</var>,</p>\n       </li><li data-md=\"\">\n        <p>have a UUID that is not <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted\" id=\"ref-for-blocklisted④\">blocklisted</a>,</p>\n       </li><li data-md=\"\">\n        <p>if <var>uuid</var> is present, have a UUID of <var>uuid</var>,</p>\n       </li><li data-md=\"\">\n        <p>if <var>allowedUuids</var> is present and not <code>\"all\"</code>, have a UUID in <var>allowedUuids</var>, and</p>\n       </li><li data-md=\"\">\n        <p>if the <var>single</var> flag is set, are the first of these.</p>\n      </li></ul>\n      <p>Let <var>promise</var> be the result.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-fulfillment\" id=\"ref-for-upon-fulfillment\">Upon fulfillment</a> of <var>promise</var> with <var>result</var>, run the\nfollowing steps:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>If <var>result</var> is empty, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror②\">NotFoundError</a></code>.</p>\n       </li><li data-md=\"\">\n        <p>Otherwise, if the <var>single</var> flag is set, returns the first (only)\nelement of <var>result</var>.</p>\n       </li><li data-md=\"\">\n        <p>Otherwise, return <var>result</var>.</p>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTServer connect",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connect",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTServer\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetoothremotegattserver-connect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>connect()</code></dfn></code> method, when invoked, MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device②\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑥\">[[representedDevice]]</a></code> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑦\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If the UA is currently using the Bluetooth system, it MAY return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑧\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑥\">a new promise</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected③\">connected</a></code> is <code>true</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①④\">resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>Add <var>promise</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot\">[[activeAlgorithms]]</a></code>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable②\">navigable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top②\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter②\">simulated Bluetooth adapter</a> is not empty, run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#trigger-a-gatt-connection-attempted-event\" id=\"ref-for-trigger-a-gatt-connection-attempted-event\">Trigger a gatt connection attempted event</a> given <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable③\">navigable</a> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device③\">device</a></code>.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\">[[automatedGATTConnectionResponse]]</a></code> is <code>\"not-expected\"</code>,\nset it to <code>\"expected\"</code>.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot①\">[[automatedGATTConnectionResponse]]</a></code> is <code>\"expected\"</code>,\nwait for it to change.</p>"
                },
                {
                  "html": "<p>Let <var>response</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot②\">[[automatedGATTConnectionResponse]]</a></code>.</p>"
                },
                {
                  "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot③\">[[automatedGATTConnectionResponse]]</a></code> to <code>\"not-expected\"</code>.</p>"
                },
                {
                  "html": "If <var>response</var> is not <code>0</code>, do the\nfollowing sub-steps:",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p>Remove <var>promise</var> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①\">[[activeAlgorithms]]</a></code>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⑤\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror④\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code> and abort these steps.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise, run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device④\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑦\">[[representedDevice]]</a></code> has no <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer③\">ATT Bearer</a>, do the following sub-steps:",
                  "rationale": "attempt",
                  "steps": [
                    {
                      "html": "<p id=\"create-an-att-bearer\">Attempt to create an <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer④\">ATT Bearer</a> using the procedures described in \"Connection Establishment\" under <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#gap-interoperability-requirements\" id=\"ref-for-gap-interoperability-requirements①\">GAP Interoperability Requirements</a>. Abort this attempt if <var>promise</var> is removed from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot②\">[[activeAlgorithms]]</a></code>.</p>"
                    },
                    {
                      "html": "<p>If this attempt was aborted because <var>promise</var> was removed from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot③\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑥\">queue a global task</a> on\nthe <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⑥\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror②\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code> and abort these\nsteps.</p>"
                    },
                    {
                      "html": "<p>If this attempt failed for another reason, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑦\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⑦\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑤\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code> and abort\nthese steps.</p>"
                    },
                    {
                      "html": "<p>Use the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#exchange-mtu\" id=\"ref-for-exchange-mtu\">Exchange MTU</a> procedure to negotiate the largest\nsupported MTU. Ignore any errors from this step.</p>"
                    },
                    {
                      "html": "<p>The UA MAY attempt to bond with the remote device using the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#br-edr-bonding-procedure\" id=\"ref-for-br-edr-bonding-procedure\">BR/EDR\nBonding Procedure</a> or the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#le-bonding-procedure\" id=\"ref-for-le-bonding-procedure\">LE Bonding Procedure</a>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑧\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⑧\">Bluetooth task source</a> given <var>global</var> to perform the following sub-steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot④\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror③\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#garbage-collect-the-connection\" id=\"ref-for-garbage-collect-the-connection\">garbage-collect the connection</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device⑤\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑧\">[[representedDevice]]</a></code>,\nand abort these steps.</p>"
                },
                {
                  "html": "<p>Remove <var>promise</var> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot⑤\">[[activeAlgorithms]]</a></code>.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device⑥\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot⑨\">[[representedDevice]]</a></code> is <code>null</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①①\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑥\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#garbage-collect-the-connection\" id=\"ref-for-garbage-collect-the-connection①\">garbage-collect the connection</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-device\" id=\"ref-for-dom-bluetoothremotegattserver-device⑦\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①⓪\">[[representedDevice]]</a></code>,\nand abort these steps.</p>"
                },
                {
                  "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected④\">connected</a></code> to <code>true</code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⑤\">Resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑥\">this</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTServer disconnect",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-disconnect",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTServer\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetoothremotegattserver-disconnect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>disconnect()</code></dfn></code> method, when invoked, MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Clear <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot⑥\">[[activeAlgorithms]]</a></code></code> to abort any <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-an-att-bearer\">active <code>connect()</code> calls</a>.</p>"
        },
        {
          "html": "<p>If <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected⑤\">connected</a></code></code> is <code>false</code>, abort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#clean-up-the-disconnected-device\" id=\"ref-for-clean-up-the-disconnected-device\">Clean up the disconnected device</a> <code>this.device</code>.</p>"
        },
        {
          "html": "<p>Let <var>device</var> be <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①①\">[[representedDevice]]</a></code></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#garbage-collect-the-connection\" id=\"ref-for-garbage-collect-the-connection②\">Garbage-collect the connection</a> of <var>device</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTServer connection garbage collection",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#garbage-collect-the-connection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"garbage-collect-the-connection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">garbage-collect the connection</dfn> of a <var>device</var>, the UA must, do the\nfollowing steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If systems that aren’t using this API, either inside or outside of the UA,\nare using the <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer⑤\">ATT Bearer</a>, abort this algorithm.</p>"
        },
        {
          "html": "For all <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice③⑥\">BluetoothDevice</a></code>s <code><var>deviceObj</var></code> in the whole UA:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①②\">[[representedDevice]]</a></code></code> is not the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device⑧\">same device</a> as <var>device</var>, continue to the next <var>deviceObj</var>.</p>"
            },
            {
              "html": "<p>If <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected⑥\">connected</a></code></code> is <code>true</code>, abort this algorithm.</p>"
            },
            {
              "html": "<p>If <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot⑦\">[[activeAlgorithms]]</a></code></code> contains the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-promise-objects\" id=\"ref-for-sec-promise-objects⑧\">Promise</a></code> of a call to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connect\" id=\"ref-for-dom-bluetoothremotegattserver-connect③\">connect()</a></code>, abort this\nalgorithm.</p>"
            }
          ]
        },
        {
          "html": "<p>Destroy <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer⑥\">ATT Bearer</a>.</p>"
        }
      ]
    },
    {
      "name": "GATT connection watcher",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper",
      "html": "To create a <var>gattServer</var>-<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"connection-checking-wrapper\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">connection-checking wrapper</dfn> around a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-promise-objects\" id=\"ref-for-sec-promise-objects①⓪\">Promise</a></code> <var>promise</var>, the UA MUST:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code><var>gattServer</var>.connected</code> is <code>true</code>, add <var>promise</var> to <code><var>gattServer</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot⑧\">[[activeAlgorithms]]</a></code></code>.</p>"
        },
        {
          "html": "If <var>promise</var> was fulfilled with value <var>result</var>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>promise</var> is in <code><var>gattServer</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot⑨\">[[activeAlgorithms]]</a></code></code>,\n  remove it and return <var>result</var>.</p>"
            },
            {
              "html": "<p>Otherwise, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑦\">NetworkError</a></code>.</p>"
            }
          ],
          "additional": [
            {
              "html": "If <var>promise</var> was rejected with reason <var>error</var>, then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is in <code><var>gattServer</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①⓪\">[[activeAlgorithms]]</a></code></code>,\n  remove it and throw <var>error</var>.</p>"
                },
                {
                  "html": "<p>Otherwise, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑧\">NetworkError</a></code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTServer getPrimaryService",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-getprimaryservice",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTServer\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetoothremotegattserver-getprimaryservice\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getPrimaryService(<var>service</var>)</code></dfn></code> method, when invoked, MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot④\">[[allowedServices]]</a></code></code> is not <code>\"all\"</code> and <var>service</var> is not in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot⑤\">[[allowedServices]]</a></code></code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑨\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑧\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#getgattchildren\" id=\"ref-for-getgattchildren\">GetGATTChildren</a>(<span class=\"argument-list\"><i>attribute</i>=<code>this.device</code>,<br> <i>single</i>=true,<br> <i>uuidCanonicalizer</i>=<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice⑦\">BluetoothUUID.getService</a></code>,<br> <i>uuid</i>=<code><var>service</var></code>,<br> <i>allowedUuids</i>=<code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot⑥\">[[allowedServices]]</a></code></code>,<br> <i>child type</i>=\"GATT Primary Service\")</span></p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTServer getPrimaryServices",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-getprimaryservices",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTServer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"getPrimaryServices(service)|getPrimaryServices()\" id=\"dom-bluetoothremotegattserver-getprimaryservices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getPrimaryServices(<var>service</var>)</code></dfn></code> method, when invoked, MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot⑦\">[[allowedServices]]</a></code></code> is not <code>\"all\"</code>, and <var>service</var> is present and not in <code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot⑧\">[[allowedServices]]</a></code></code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⓪\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑨\">SecurityError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#getgattchildren\" id=\"ref-for-getgattchildren①\">GetGATTChildren</a>(<span class=\"argument-list\"><i>attribute</i>=<code>this.device</code>,<br> <i>single</i>=false,<br> <i>uuidCanonicalizer</i>=<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-getservice\" id=\"ref-for-dom-bluetoothuuid-getservice⑧\">BluetoothUUID.getService</a></code>,<br> <i>uuid</i>=<code><var>service</var></code>,<br> <i>allowedUuids</i>=<code>this.device.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot⑨\">[[allowedServices]]</a></code></code>,<br> <i>child type</i>=\"GATT Primary Service\")</span></p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTService construction",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattservice-representing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-bluetoothremotegattservice-representing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a <code>BluetoothRemoteGATTService</code> representing</dfn> a\nService <var>service</var>, the UA must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑦\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be a new instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice①⑤\">BluetoothRemoteGATTService</a></code> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot①\">[[representedService]]</a></code> slot initialized to <var>service</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing③\">Get the <code>BluetoothDevice</code> representing</a> the device in\nwhich <var>service</var> appears, and let <var>device</var> be the result.</p>"
            },
            {
              "html": "<p>If the previous step threw an error, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑨\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source①⑨\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①②\">reject</a> <var>promise</var> with\nthat error and abort these steps.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device③\">device</a></code> from <var>device</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-uuid\" id=\"ref-for-dom-bluetoothremotegattservice-uuid①\">uuid</a></code> from the UUID of <var>service</var>.</p>"
            },
            {
              "html": "<p>If <var>service</var> is a Primary Service, initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-isprimary\" id=\"ref-for-dom-bluetoothremotegattservice-isprimary②\">isPrimary</a></code> to <code>true</code>. Otherwise,\ninitialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-isprimary\" id=\"ref-for-dom-bluetoothremotegattservice-isprimary③\">isPrimary</a></code> to <code>false</code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⓪\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⑥\">resolve</a> <var>promise</var> with <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTCharacteristic constructor",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattcharacteristic-representing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"create a BluetoothRemoteGATTCharacteristic representing\" data-noexport=\"\" id=\"create-a-bluetoothremotegattcharacteristic-representing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a <code>BluetoothRemoteGATTCharacteristic</code> representing</dfn> a Characteristic <var>characteristic</var>, the UA must\nrun the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑧\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be a new instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic①⑤\">BluetoothRemoteGATTCharacteristic</a></code> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot①\">[[representedCharacteristic]]</a></code> slot initialized to <var>characteristic</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service②\">service</a></code>&lt; from the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice①⑦\">BluetoothRemoteGATTService</a></code> instance representing the Service in which <var>characteristic</var> appears.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-uuid\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-uuid①\">uuid</a></code> from the UUID of <var>characteristic</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothcharacteristicproperties-instance-from-the-characteristic\" id=\"ref-for-create-a-bluetoothcharacteristicproperties-instance-from-the-characteristic\">Create a <code>BluetoothCharacteristicProperties</code> instance from the\nCharacteristic</a> <var>characteristic</var>, and let <var>properties</var> be the result.</p>"
            },
            {
              "html": "<p>If the previous step returned an error, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②①\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②①\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①③\">reject</a> <var>promise</var> with\nthat error and abort these steps.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-properties\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-properties①\">properties</a></code> to <var>properties</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-value\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-value③\">value</a></code> to <code>null</code>. The UA MAY initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-value\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-value④\">value</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor⑨\">DataView</a></code> wrapping a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor②\">ArrayBuffer</a></code> containing the most\nrecently read value from <var>characteristic</var> if this value is available.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②②\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⑦\">resolve</a> <var>promise</var> with <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTCharacteristic readValue()",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-readvalue",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTCharacteristic\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-bluetoothremotegattcharacteristic-readvalue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>readValue()</code></dfn> </code> method, when invoked, MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>gatt</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service③\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device④\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt③\">gatt</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③①\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-uuid\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-uuid②\">uuid</a></code> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-for-reads\" id=\"ref-for-blocklisted-for-reads\">blocklisted for reads</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①①\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①⓪\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected⑦\">connected</a></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①②\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑨\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>characteristic</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③②\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot②\">[[representedCharacteristic]]</a></code>.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①③\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "Return a <var>gatt</var>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper①\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑨\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">in parallel</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <code>Read</code> bit is not set in <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-properties\" id=\"ref-for-characteristic-properties\">properties</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②③\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②③\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①④\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code> and abort\nthese steps.</p>"
            },
            {
              "html": "<p>If the UA is currently using the Bluetooth system, it MAY <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②④\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②④\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑤\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⓪\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code> and\nabort these steps.</p>"
            },
            {
              "html": "<p>Use any combination of the sub-procedures in the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-value-read\" id=\"ref-for-characteristic-value-read\">Characteristic Value Read</a> procedure to retrieve the value of <var>characteristic</var>.\nHandle errors as described in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⑤\">Bluetooth task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①①\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑥\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①②\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>If the sub-procedures above returned an error, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑦\">reject</a> <var>promise</var> with that error and abort these steps.</p>"
                },
                {
                  "html": "<p>Let <var>buffer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor③\">ArrayBuffer</a></code> holding the retrieved\nvalue, and assign a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①⓪\">DataView</a></code> created with <var>buffer</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-value\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-value⑤\">value</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire②\">Fire an event</a> named \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothremotegattcharacteristic-characteristicvaluechanged\" id=\"ref-for-eventdef-bluetoothremotegattcharacteristic-characteristicvaluechanged①\">characteristicvaluechanged</a></code>\" with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-bubbles\" id=\"ref-for-dom-event-bubbles\">bubbles</a></code> attribute initialized to <code>true</code> at <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③④\">this</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⑧\">Resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑤\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-value\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-value⑥\">value</a></code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Write Characteristic value",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#writecharacteristicvalue",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"writecharacteristicvalue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WriteCharacteristicValue</dfn>(<span class=\"argument-list\"> <var>this</var>: BluetoothRemoteGATTCharacteristic,<br> <var>value</var>: BufferSource,<br> <var>response</var>: string), </span><br> the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>this</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>gatt</var> be <var>this</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service④\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device⑤\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt④\">gatt</a></code>.</p>"
        },
        {
          "html": "<p>If <var>this</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-uuid\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-uuid③\">uuid</a></code> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-for-writes\" id=\"ref-for-blocklisted-for-writes\">blocklisted for writes</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①④\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①①\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①④\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>bytes</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy⑥\">a copy of the bytes held</a> by <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>bytes</var> is more than 512 bytes long (the maximum length of an attribute\nvalue, per <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#long-attribute-values\" id=\"ref-for-long-attribute-values\">Long Attribute Values</a>) return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⑤\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror\">InvalidModificationError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑤\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected⑧\">connected</a></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⑥\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①③\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑥\">DOMException</a></code> and abort\nthese steps.</p>"
        },
        {
          "html": "<p>Let <var>characteristic</var> be <var>this</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot③\">[[representedCharacteristic]]</a></code>.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⑦\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑦\">DOMException</a></code> and abort these steps.</p>"
        },
        {
          "html": "Return a <var>gatt</var>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper②\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①⓪\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①②\">in parallel</a>.",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <var>response</var> is one of \"required\", \"never\", or \"optional\".</p>"
            },
            {
              "html": "<p>If the UA is currently using the Bluetooth system, it MAY <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⑥\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⑥\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑧\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①④\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑧\">DOMException</a></code> and\nabort these steps.</p>"
            },
            {
              "html": "Write <var>bytes</var> to <var>characteristic</var> by performing the\nfollowing steps:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If response is \"required\"",
                      "html": "Use the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#write-characteristic-value\" id=\"ref-for-write-characteristic-value\">Write Characteristic Value</a> procedure."
                    },
                    {
                      "case": "If response is \"never\"",
                      "html": "Use the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#write-without-response\" id=\"ref-for-write-without-response\">Write Without Response</a> procedure."
                    },
                    {
                      "case": "Otherwise",
                      "html": "Use any combination of the sub-procedures in the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-value-write\" id=\"ref-for-characteristic-value-write\">Characteristic Value Write</a> procedure."
                    }
                  ]
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⑦\">Queue a global task</a> on <var>global</var> using the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⑦\">Bluetooth task source</a> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①②\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑨\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑥\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑨\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>If the procedure above returned an error, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⓪\">reject</a> <var>promise</var> with that error and abort these steps.</p>"
                },
                {
                  "html": "<p>Set <var>this</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-value\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-value⑦\">value</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①①\">DataView</a></code> wrapping a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor④\">ArrayBuffer</a></code> containing <var>bytes</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①⑨\">Resolve</a> <var>promise</var> with <code>undefined</code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTCharacteristic startNotifications",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-startnotifications",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTCharacteristic\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"startNotifications()\" id=\"dom-bluetoothremotegattcharacteristic-startnotifications\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code> startNotifications()</code></dfn></code> method, when invoked, MUST run the following\nsteps. See <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#notification-events\">§ 6.6.4 Responding to Notifications and Indications</a> for details of receiving\nnotifications.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑤\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>gatt</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑦\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service⑤\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device⑥\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt⑤\">gatt</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑧\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-uuid\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-uuid④\">uuid</a></code> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-for-reads\" id=\"ref-for-blocklisted-for-reads①\">blocklisted for reads</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⑧\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①②\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⓪\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected⑨\">connected</a></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⑨\">a promise rejected with</a> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑦\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>characteristic</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑨\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot④\">[[representedCharacteristic]]</a></code>.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②⓪\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②②\">DOMException</a></code>.</p>"
        },
        {
          "html": "Return a <var>gatt</var>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper③\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①①\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①③\">in parallel</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If neither of the <code>Notify</code> or <code>Indicate</code> bits are set\nin <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-properties\" id=\"ref-for-characteristic-properties①\">properties</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⑧\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⑧\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②①\">reject</a> <var>promise</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror②\">NotSupportedError</a></code> and abort these\nsteps.</p>"
            },
            {
              "html": "<p>If <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set\">active notification context set</a> contains <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-navigator-bluetooth\" id=\"ref-for-dom-navigator-bluetooth①\">navigator.bluetooth</a></code>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②⑨\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source②⑨\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②⓪\">resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⓪\">this</a> and abort these steps.</p>"
            },
            {
              "html": "<p>If the UA is currently using the Bluetooth system, it MAY <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⓪\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⓪\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②②\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑧\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②③\">DOMException</a></code> and\nabort these steps.</p>"
            },
            {
              "html": "<p>If the characteristic has a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration\">Client Characteristic Configuration</a> descriptor, use any of the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-descriptors\" id=\"ref-for-characteristic-descriptors\">Characteristic Descriptors</a> procedures to\nensure that one of the <code>Notification</code> or <code>Indication</code> bits in <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration①\">Client Characteristic Configuration</a> descriptor is set, matching the constraints in <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-properties\" id=\"ref-for-characteristic-properties②\">properties</a>. The UA SHOULD avoid\nsetting both bits, and MUST deduplicate <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#notification-events\">value-change events</a> if both bits are\nset. Handle errors as described in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
            },
            {
              "html": "<p>If the procedures were successful, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-navigator-bluetooth\" id=\"ref-for-dom-navigator-bluetooth②\">navigator.bluetooth</a></code> to <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set①\">active notification context set</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③①\">Bluetooth task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①③\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②⓪\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②④\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>If the procedures above returned an error, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②④\">reject</a> <var>promise</var> with\nthat error and abort these steps.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②①\">Resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④①\">this</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTCharacteristic stopNotifications",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-stopnotifications",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTCharacteristic\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"stopNotifications()\" id=\"dom-bluetoothremotegattcharacteristic-stopnotifications\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code> stopNotifications()</code></dfn></code> method, when invoked, MUST return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①②\">a new\npromise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①④\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>characteristic</var> be <code>this.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot⑤\">[[representedCharacteristic]]</a></code></code>.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②①\">a promise rejected with</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑥\">InvalidStateError</a></code> and abort these steps.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set②\">active notification context set</a> contains <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-navigator-bluetooth\" id=\"ref-for-dom-navigator-bluetooth③\">navigator.bluetooth</a></code>, remove it.</p>"
        },
        {
          "html": "<p>If <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set③\">active notification context set</a> became\nempty and the characteristic has a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration③\">Client Characteristic\nConfiguration</a> descriptor, the UA SHOULD use any of the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-descriptors\" id=\"ref-for-characteristic-descriptors①\">Characteristic\nDescriptors</a> procedures to clear the <code>Notification</code> and <code>Indication</code> bits in <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration④\">Client\nCharacteristic Configuration</a> descriptor.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③②\">Bluetooth task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑥\">relevant global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②②\">resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④③\">this</a>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothCharacteristicProperties constructor",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothcharacteristicproperties-instance-from-the-characteristic",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"create a BluetoothCharacteristicProperties instance from the Characteristic\" data-noexport=\"\" id=\"create-a-bluetoothcharacteristicproperties-instance-from-the-characteristic\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a <code>BluetoothCharacteristicProperties</code> instance from\nthe Characteristic</dfn> <var>characteristic</var>, the UA MUST run the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>propertiesObj</var> be a new instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothcharacteristicproperties\" id=\"ref-for-bluetoothcharacteristicproperties③\">BluetoothCharacteristicProperties</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>properties</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-properties\" id=\"ref-for-characteristic-properties④\">characteristic properties</a> of <var>characteristic</var>.</p>"
        },
        {
          "html": "<p>Initialize the attributes of <var>propertiesObj</var> from the corresponding\nbits in <var>properties</var>:</p>\n      <table>\n       <tbody>\n        <tr>\n         <th>Attribute\n         </th><th>Bit\n        </th></tr><tr>\n         <td><code>broadcast</code>\n         </td><td>Broadcast\n        </td></tr><tr>\n         <td><code>read</code>\n         </td><td>Read\n        </td></tr><tr>\n         <td><code>writeWithoutResponse</code>\n         </td><td>Write Without Response\n        </td></tr><tr>\n         <td><code>write</code>\n         </td><td>Write\n        </td></tr><tr>\n         <td><code>notify</code>\n         </td><td>Notify\n        </td></tr><tr>\n         <td><code>indicate</code>\n         </td><td>Indicate\n        </td></tr><tr>\n         <td><code>authenticatedSignedWrites</code>\n         </td><td>Authenticated Signed Writes\n      </td></tr></tbody></table>"
        },
        {
          "html": "If the Extended Properties bit of the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-properties\" id=\"ref-for-characteristic-properties⑤\">characteristic properties</a> is not\nset, initialize <var>propertiesObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothcharacteristicproperties-reliablewrite\" id=\"ref-for-dom-bluetoothcharacteristicproperties-reliablewrite\">reliableWrite</a></code> and <var>propertiesObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothcharacteristicproperties-writableauxiliaries\" id=\"ref-for-dom-bluetoothcharacteristicproperties-writableauxiliaries\">writableAuxiliaries</a></code> to <code>false</code>. Otherwise, run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-descriptor-discovery\" id=\"ref-for-characteristic-descriptor-discovery\">Discover</a> the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-extended-properties\" id=\"ref-for-characteristic-extended-properties\">Characteristic Extended Properties</a> descriptor for <var>characteristic</var> and <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#read-characteristic-descriptors\" id=\"ref-for-read-characteristic-descriptors\">read its\nvalue</a> into <var>extendedProperties</var>.\nHandle errors as described in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
            },
            {
              "html": "<p>If the previous step returned an error, return that error.</p>"
            },
            {
              "html": "<p>Initialize <var>propertiesObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothcharacteristicproperties-reliablewrite\" id=\"ref-for-dom-bluetoothcharacteristicproperties-reliablewrite①\">reliableWrite</a></code> from the Reliable Write bit of <var>extendedProperties</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>propertiesObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothcharacteristicproperties-writableauxiliaries\" id=\"ref-for-dom-bluetoothcharacteristicproperties-writableauxiliaries①\">writableAuxiliaries</a></code> from the Writable Auxiliaries bit of <var>extendedProperties</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>propertiesObj</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTDescriptor constructor",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattdescriptor-representing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-bluetoothremotegattdescriptor-representing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a <code>BluetoothRemoteGATTDescriptor</code> representing</dfn> a Descriptor <var>descriptor</var>,\nthe UA MUST run the following steps.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①③\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑤\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be a new instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattdescriptor\" id=\"ref-for-bluetoothremotegattdescriptor①⓪\">BluetoothRemoteGATTDescriptor</a></code> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot①\">[[representedDescriptor]]</a></code> slot initialized to <var>descriptor</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-characteristic\" id=\"ref-for-dom-bluetoothremotegattdescriptor-characteristic①\">characteristic</a></code> from the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic①⑧\">BluetoothRemoteGATTCharacteristic</a></code> instance representing\nthe Characteristic in which <var>descriptor</var> appears.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-uuid\" id=\"ref-for-dom-bluetoothremotegattdescriptor-uuid①\">uuid</a></code> from the UUID\nof <var>descriptor</var>.</p>"
            },
            {
              "html": "<p>Initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-value\" id=\"ref-for-dom-bluetoothremotegattdescriptor-value①\">value</a></code> to <code>null</code>.\nThe UA MAY initialize <var>result</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-value\" id=\"ref-for-dom-bluetoothremotegattdescriptor-value②\">value</a></code> a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①④\">DataView</a></code> wrapping a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑤\">ArrayBuffer</a></code> containing\nthe most recently read value from <var>descriptor</var> if this value is\navailable.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③③\">Bluetooth task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑦\">relevant global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②③\">resolve</a> <var>promise</var> with <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTDescriptor readValue",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-readvalue",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTDescriptor\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"readValue()\" id=\"dom-bluetoothremotegattdescriptor-readvalue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code> readValue()</code></dfn></code> method, when invoked, MUST run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑧\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>gatt</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑥\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-characteristic\" id=\"ref-for-dom-bluetoothremotegattdescriptor-characteristic②\">characteristic</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service⑥\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device⑦\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt⑥\">gatt</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑦\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-uuid\" id=\"ref-for-dom-bluetoothremotegattdescriptor-uuid②\">uuid</a></code> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-for-reads\" id=\"ref-for-blocklisted-for-reads②\">blocklisted for reads</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②②\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①③\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①⓪\">connected</a></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②③\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑥\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>descriptor</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑧\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot②\">[[representedDescriptor]]</a></code>.</p>"
        },
        {
          "html": "<p>If <var>descriptor</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②④\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑦\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "Return a <var>gatt</var>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper④\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①④\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑥\">in parallel</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the UA is currently using the Bluetooth system, it MAY <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③④\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③④\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⑤\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②②\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑧\">DOMException</a></code> and\nabort these steps.</p>"
            },
            {
              "html": "<p>Use either the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#read-characteristic-descriptors\" id=\"ref-for-read-characteristic-descriptors①\">Read Characteristic Descriptors</a> or the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#read-long-characteristic-descriptors\" id=\"ref-for-read-long-characteristic-descriptors\">Read Long Characteristic Descriptors</a> sub-procedure to retrieve the value of <var>descriptor</var>. Handle errors as described in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⑤\">Bluetooth task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①④\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⑥\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②④\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑨\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>If the sub-procedure above returned an error, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⑦\">reject</a> <var>promise</var> with that error and abort these steps.</p>"
                },
                {
                  "html": "<p>Let <var>buffer</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑧\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑥\">ArrayBuffer</a></code> holding the retrieved\nvalue, and assign a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑨\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①⑤\">DataView</a></code> created with <var>buffer</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑨\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-value\" id=\"ref-for-dom-bluetoothremotegattdescriptor-value③\">value</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②④\">Resolve</a> <var>promise</var> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⓪\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-value\" id=\"ref-for-dom-bluetoothremotegattdescriptor-value④\">value</a></code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "BluetoothRemoteGATTDescriptor writeValue",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-writevalue",
      "html": "The <code><dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"BluetoothRemoteGATTDescriptor\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"writeValue(value)\" id=\"dom-bluetoothremotegattdescriptor-writevalue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code> writeValue(<var>value</var>)</code></dfn></code> method, when invoked, MUST  run the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑨\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>gatt</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤②\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-characteristic\" id=\"ref-for-dom-bluetoothremotegattdescriptor-characteristic③\">characteristic</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-service\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-service⑦\">service</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-device\" id=\"ref-for-dom-bluetoothremotegattservice-device⑧\">device</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt\" id=\"ref-for-dom-bluetoothdevice-gatt⑦\">gatt</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤③\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-uuid\" id=\"ref-for-dom-bluetoothremotegattdescriptor-uuid③\">uuid</a></code> is <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-for-writes\" id=\"ref-for-blocklisted-for-writes①\">blocklisted for writes</a>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②⑤\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①④\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③⓪\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>bytes</var> be <a data-link-type=\"dfn\" href=\"https://heycam.github.io/webidl/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy⑦\">a copy of the bytes held</a> by <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>bytes</var> is more than 512 bytes long (the maximum length of an attribute\nvalue, per <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#long-attribute-values\" id=\"ref-for-long-attribute-values①\">Long Attribute Values</a>) return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②⑥\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror①\">InvalidModificationError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①①\">connected</a></code> is <code>false</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②⑦\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②⑤\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>descriptor</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤④\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot③\">[[representedDescriptor]]</a></code>.</p>"
        },
        {
          "html": "<p>If <var>descriptor</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②⑧\">a promise rejected with</a> an\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑧\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③③\">DOMException</a></code>.</p>"
        },
        {
          "html": "Return a <var>gatt</var>-<a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#connection-checking-wrapper\" id=\"ref-for-connection-checking-wrapper⑤\">connection-checking wrapper</a> around <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①⑤\">a new promise</a> <var>promise</var> and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑦\">in parallel</a>.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the UA is currently using the Bluetooth system, it MAY <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⑥\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⑥\">Bluetooth task source</a> given <var>global</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⑧\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②⑥\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③④\">DOMException</a></code> and\nabort these steps.</p>"
            },
            {
              "html": "<p>Use either the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#write-characteristic-descriptors\" id=\"ref-for-write-characteristic-descriptors\">Write Characteristic Descriptors</a> or the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#write-long-characteristic-descriptors\" id=\"ref-for-write-long-characteristic-descriptors\">Write Long Characteristic Descriptors</a> sub-procedure to write <var>bytes</var> to <var>descriptor</var>. Handle errors as described in <a href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-handling\">§ 6.7 Error handling</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⑦\">Bluetooth task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>promise</var> is not in <var>gatt</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①⑤\">[[activeAlgorithms]]</a></code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②⑨\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②⑧\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③⑤\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p>If the sub-procedure above returned an error, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③⓪\">reject</a> <var>promise</var> with that error and abort these steps.</p>"
                },
                {
                  "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⑤\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-value\" id=\"ref-for-dom-bluetoothremotegattdescriptor-value⑤\">value</a></code> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①⓪\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①⑥\">DataView</a></code> wrapping a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑦\">ArrayBuffer</a></code> containing <var>bytes</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②⑤\">Resolve</a> <var>promise</var> with <code>undefined</code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "disconnection",
      "html": "When a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①⑦\">Bluetooth device</a> <var>device</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer⑦\">ATT Bearer</a> is lost\n(e.g. because the remote device moved out of range or the user used a platform\nfeature to disconnect it), for each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice④④\">BluetoothDevice</a></code> <var>deviceObj</var> the\nUA MUST <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⑧\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⑧\">Bluetooth task source</a> given <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②⓪\">relevant global object</a> to perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①③\">[[representedDevice]]</a></code></code> is not the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-bluetooth-device\" id=\"ref-for-same-bluetooth-device⑨\">same device</a> as <var>device</var>, abort these steps.</p>"
        },
        {
          "html": "<p>If <code>!<var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①②\">connected</a></code></code>,\nabort these steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#clean-up-the-disconnected-device\" id=\"ref-for-clean-up-the-disconnected-device①\">Clean up the disconnected device</a> <var>deviceObj</var>.</p>"
        }
      ]
    },
    {
      "name": "clean up disconnected Bluetooth device",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#clean-up-the-disconnected-device",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clean-up-the-disconnected-device\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clean up the disconnected device</dfn> <var>deviceObj</var>, the UA must:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①③\">connected</a></code></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>Clear <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-activealgorithms-slot\" id=\"ref-for-dom-bluetoothremotegattserver-activealgorithms-slot①⑥\">[[activeAlgorithms]]</a></code></code>.</p>"
        },
        {
          "html": "<p>Set <code><var>deviceObj</var>.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot④\">[[automatedGATTConnectionResponse]]</a></code></code> to <code>\"not-expected\"</code>.</p>"
        },
        {
          "html": "<p>Let <var>context</var> be <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-context-slot\" id=\"ref-for-dom-bluetoothdevice-context-slot②\">[[context]]</a></code></code>.</p>"
        },
        {
          "html": "<p>Remove all entries from <code><var>context</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot③\">[[attributeInstanceMap]]</a></code></code> whose keys are inside <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①④\">[[representedDevice]]</a></code></code>.</p>"
        },
        {
          "html": "<p>For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②④\">BluetoothRemoteGATTService</a></code> <var>service</var> in <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-code-realms\" id=\"ref-for-sec-code-realms⑤\">realm</a>, set <code><var>service</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot②\">[[representedService]]</a></code></code> to <code>null</code>.</p>"
        },
        {
          "html": "For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic②③\">BluetoothRemoteGATTCharacteristic</a></code> <var>characteristic</var> in <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-code-realms\" id=\"ref-for-sec-code-realms⑥\">realm</a>, do the following sub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>notificationContexts</var> be <code><var>characteristic</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot⑥\">[[representedCharacteristic]]</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set④\">active notification context set</a>.</p>"
            },
            {
              "html": "<p>Remove <var>context</var> from <var>notificationContexts</var>.</p>"
            },
            {
              "html": "<p>If <var>notificationContexts</var> became empty and there is still an <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#att-bearer\" id=\"ref-for-att-bearer⑧\">ATT\nBearer</a> to <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①⑤\">[[representedDevice]]</a></code></code> and <var>characteristic</var> has a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration⑤\">Client Characteristic\nConfiguration</a> descriptor, the UA SHOULD use any of the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-descriptors\" id=\"ref-for-characteristic-descriptors②\">Characteristic Descriptors</a> procedures to clear the <code>Notification</code> and <code>Indication</code> bits in <var>characteristic</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#client-characteristic-configuration\" id=\"ref-for-client-characteristic-configuration⑥\">Client Characteristic Configuration</a> descriptor.</p>"
            },
            {
              "html": "<p>Set <code><var>characteristic</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot⑦\">[[representedCharacteristic]]</a></code></code> to <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattdescriptor\" id=\"ref-for-bluetoothremotegattdescriptor①③\">BluetoothRemoteGATTDescriptor</a></code> <var>descriptor</var> in <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-code-realms\" id=\"ref-for-sec-code-realms⑦\">realm</a>, set <code><var>descriptor</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot④\">[[representedDescriptor]]</a></code></code> to <code>null</code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire③\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothdeviceeventhandlers-gattserverdisconnected\" id=\"ref-for-eventdef-bluetoothdeviceeventhandlers-gattserverdisconnected①\">gattserverdisconnected</a></code> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-bubbles\" id=\"ref-for-dom-event-bubbles①\">bubbles</a></code> attribute initialized to <code>true</code> at <code><var>deviceObj</var></code>.</p>"
        }
      ]
    },
    {
      "name": "notifications",
      "html": "When the UA receives a Bluetooth <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-value-notification\" id=\"ref-for-characteristic-value-notification\">Characteristic Value Notification</a> or <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-value-indications\" id=\"ref-for-characteristic-value-indications\">Indication</a>,\nit must perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>bluetoothGlobal</var> in the Characteristic’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#active-notification-context-set\" id=\"ref-for-active-notification-context-set⑤\">active notification context set</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③⑨\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source③⑨\">Bluetooth task source</a> given <var>bluetoothGlobal</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②①\">relevant global object</a> to do the following\nsub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>characteristicObject</var> be the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic②④\">BluetoothRemoteGATTCharacteristic</a></code> in the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-tree-bluetooth-tree\" id=\"ref-for-bluetooth-tree-bluetooth-tree②\">Bluetooth tree</a> rooted at <var>bluetoothGlobal</var> that represents the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic\" id=\"ref-for-characteristic①⓪\">Characteristic</a>.</p>"
            },
            {
              "html": "<p>If <code><var>characteristicObject</var> .service.device.gatt.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-connected\" id=\"ref-for-dom-bluetoothremotegattserver-connected①④\">connected</a></code></code> is <code>false</code>, abort these sub-steps.</p>"
            },
            {
              "html": "<p>Set <code><var>characteristicObject</var>.value</code> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-dataview-constructor\" id=\"ref-for-sec-dataview-constructor①⑦\">DataView</a></code> wrapping a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑧\">ArrayBuffer</a></code> holding the new value of the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic\" id=\"ref-for-characteristic①①\">Characteristic</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire④\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothremotegattcharacteristic-characteristicvaluechanged\" id=\"ref-for-eventdef-bluetoothremotegattcharacteristic-characteristicvaluechanged②\">characteristicvaluechanged</a></code> with its <code>bubbles</code> attribute initialized to <code>true</code> at <var>characteristicObject</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "service changes",
      "html": "The Bluetooth <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#attribute-caching\" id=\"ref-for-attribute-caching①\">Attribute Caching</a> system allows clients to track changes to <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service⑨\">Service</a>s, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic\" id=\"ref-for-characteristic①②\">Characteristic</a>s, and <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#descriptor\" id=\"ref-for-descriptor⑦\">Descriptor</a>s. Before\ndiscovering any of these attributes for the purpose of exposing them to a web\npage the UA MUST subscribe to Indications from the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service-changed\" id=\"ref-for-service-changed①\">Service Changed</a> characteristic, if it exists. When the UA receives an Indication on the Service\nChanged characteristic, it MUST perform the following steps.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>removedAttributes</var> be the list of attributes in the range\nindicated by the Service Changed characteristic that the UA had discovered\nbefore the Indication.</p>"
        },
        {
          "html": "<p>Use the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#primary-service-discovery\" id=\"ref-for-primary-service-discovery\">Primary Service Discovery</a>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#relationship-discovery\" id=\"ref-for-relationship-discovery\">Relationship Discovery</a>, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-discovery\" id=\"ref-for-characteristic-discovery\">Characteristic Discovery</a>, and <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic-descriptor-discovery\" id=\"ref-for-characteristic-descriptor-discovery①\">Characteristic Descriptor\nDiscovery</a> procedures to re-discover attributes in the range indicated by\nthe Service Changed characteristic. The UA MAY skip discovering all or part\nof the indicated range if it can prove that the results of that discovery\ncould not affect the events fired below.</p>"
        },
        {
          "html": "<p>Let <var>addedAttributes</var> be the list of attributes discovered in the\nprevious step.</p>"
        },
        {
          "html": "<p>If an attribute with the same definition (see the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service-interoperability-requirements\" id=\"ref-for-service-interoperability-requirements\">Service Interoperability\nRequirements</a>), ignoring Characteristic and Descriptor values, appears in\nboth <var>removedAttributes</var> and <var>addedAttributes</var>, remove it\nfrom both.</p>"
        },
        {
          "html": "<p>Let <var>invalidatedAttributes</var> be the attributes in <var>removedAttributes</var> but not <var>addedAttributes</var>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object\">environment settings object</a> <var>settings</var> in the UA, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task②\">queue a\ntask</a> on its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop①\">responsible event loop</a> to do the following sub-steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②⑤\">BluetoothRemoteGATTService</a></code> <var>service</var> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object③\">relevant\nsettings object</a> is <var>settings</var>, if <code><var>service</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot③\">[[representedService]]</a></code></code> is in <var>invalidatedAttributes</var>, set <code><var>service</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattservice-representedservice-slot\" id=\"ref-for-dom-bluetoothremotegattservice-representedservice-slot④\">[[representedService]]</a></code></code> to <code>null</code>.</p>"
            },
            {
              "html": "<p>For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattcharacteristic\" id=\"ref-for-bluetoothremotegattcharacteristic②⑤\">BluetoothRemoteGATTCharacteristic</a></code> <var>characteristic</var> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object④\">relevant settings object</a> is <var>settings</var>, if <code><var>characteristic</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot⑧\">[[representedCharacteristic]]</a></code></code> is in <var>invalidatedAttributes</var>, set <code><var>characteristic</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot\" id=\"ref-for-dom-bluetoothremotegattcharacteristic-representedcharacteristic-slot⑨\">[[representedCharacteristic]]</a></code></code> to <code>null</code>.</p>"
            },
            {
              "html": "<p>For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattdescriptor\" id=\"ref-for-bluetoothremotegattdescriptor①④\">BluetoothRemoteGATTDescriptor</a></code> <var>descriptor</var> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑤\">relevant\nsettings object</a> is <var>settings</var>, if <code><var>descriptor</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot⑤\">[[representedDescriptor]]</a></code></code> is in <var>invalidatedAttributes</var>, set <code><var>descriptor</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattdescriptor-representeddescriptor-slot\" id=\"ref-for-dom-bluetoothremotegattdescriptor-representeddescriptor-slot⑥\">[[representedDescriptor]]</a></code></code> to <code>null</code>.</p>"
            },
            {
              "html": "<p>Let <var>global</var> be <var>settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a>.</p>"
            },
            {
              "html": "<p>Remove every entry from <code> <var>global</var>.navigator.bluetooth.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot④\">[[attributeInstanceMap]]</a></code></code> that\nrepresents an attribute that is in <var>invalidatedAttributes</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>changedServices</var> be a set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⓪\">Service</a>s, initially empty.</p>"
        },
        {
          "html": "<p id=\"same-service-removed-and-added\">If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#same-attribute\" id=\"ref-for-same-attribute④\">same</a> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①①\">Service</a> appears in both <var>removedAttributes</var> and <var>addedAttributes</var>, remove it from both, and add it to <var>changedServices</var>.</p>"
        },
        {
          "html": "<p id=\"characteristic-descriptor-change-adds-changed-service\">For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#characteristic\" id=\"ref-for-characteristic①③\">Characteristic</a> and <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#descriptor\" id=\"ref-for-descriptor⑧\">Descriptor</a> in <var>removedAttributes</var> or <var>addedAttributes</var>, remove it from its original list, and add its\nparent <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①②\">Service</a> to <var>changedServices</var>.</p>"
        },
        {
          "html": "<p id=\"only-notify-for-requested-services\">If a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①④\">Service</a> in <var>addedAttributes</var> would not have been returned from any previous\ncall to <code>getPrimaryService</code>, <code>getPrimaryServices</code>, <code>getIncludedService</code>, or <code>getIncludedServices</code> if it\nhad existed at the time of the call, the UA MAY remove the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⑤\">Service</a> from <var>addedAttributes</var>.</p>"
        },
        {
          "html": "<p>Let <var>changedDevices</var> be the set of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device①⑧\">Bluetooth device</a>s that\ncontain any <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⑥\">Service</a> in <var>removedAttributes</var>, <var>addedAttributes</var>, and <var>changedServices</var>.</p>"
        },
        {
          "html": "For each <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice④⑤\">BluetoothDevice</a></code> <var>deviceObj</var> that is connected to a device in <var>changedDevices</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④⓪\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-task-source\" id=\"ref-for-bluetooth-task-source④⓪\">Bluetooth task source</a> given <var>deviceObj</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②②\">relevant global object</a> to do the following steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⑦\">Service</a> <var>service</var> in <var>removedAttributes</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <code><var>deviceObj</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot①⓪\">[[allowedServices]]</a></code></code> is <code>\"all\"</code> or contains the Service’s UUID, <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire⑤\">fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothremotegattservice-serviceremoved\" id=\"ref-for-eventdef-bluetoothremotegattservice-serviceremoved①\">serviceremoved</a></code> with its <code>bubbles</code> attribute\ninitialized to <code>true</code> at the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②⑥\">BluetoothRemoteGATTService</a></code> representing the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⑧\">Service</a>.</p>"
                },
                {
                  "html": "<p>Remove this <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②⑦\">BluetoothRemoteGATTService</a></code> from the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-tree-bluetooth-tree\" id=\"ref-for-bluetooth-tree-bluetooth-tree③\">Bluetooth\ntree</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service①⑨\">Service</a> in <var>addedAttributes</var>, if <code>deviceObj.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot①①\">[[allowedServices]]</a></code></code> is <code>\"all\"</code> or contains the Service’s UUID, add the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②⑧\">BluetoothRemoteGATTService</a></code> representing this <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service②⓪\">Service</a> to the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-tree-bluetooth-tree\" id=\"ref-for-bluetooth-tree-bluetooth-tree④\">Bluetooth tree</a> and then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire⑥\">fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothremotegattservice-serviceadded\" id=\"ref-for-eventdef-bluetoothremotegattservice-serviceadded②\">serviceadded</a></code> with its <code>bubbles</code> attribute initialized to <code>true</code> at the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice②⑨\">BluetoothRemoteGATTService</a></code>.</p>"
            },
            {
              "html": "<p>For each <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service②①\">Service</a> in <var>changedServices</var>, if <code>deviceObj.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-allowedservices-slot\" id=\"ref-for-dom-bluetoothdevice-allowedservices-slot①②\">[[allowedServices]]</a></code></code> is <code>\"all\"</code> or contains the Service’s UUID, <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire⑦\">fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#eventdef-bluetoothremotegattservice-servicechanged\" id=\"ref-for-eventdef-bluetoothremotegattservice-servicechanged②\">servicechanged</a></code> with its <code>bubbles</code> attribute initialized\nto <code>true</code> at the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothremotegattservice\" id=\"ref-for-bluetoothremotegattservice③⓪\">BluetoothRemoteGATTService</a></code> representing\nthe <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service\" id=\"ref-for-service②②\">Service</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "error handling",
      "html": "When the UA is using a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#gatt-procedure\" id=\"ref-for-gatt-procedure②\">GATT procedure</a> to execute a step in an algorithm\nor to handle a query to the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-cache-bluetooth-cache\" id=\"ref-for-bluetooth-cache-bluetooth-cache④\">Bluetooth cache</a> (both referred to as a\n\"step\", here), and the GATT procedure returns an <code><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#error-response\" id=\"ref-for-error-response\">Error\nResponse</a></code>, the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#procedure-timeouts\" id=\"ref-for-procedure-timeouts\">procedure times out</a> or the ATT Bearer (described in <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#profile-fundamentals\" id=\"ref-for-profile-fundamentals\">Profile\nFundamentals</a>) is absent or terminated for any reason, return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②⑨\">NetworkError</a></code> from the step and abort these steps.</p>"
        },
        {
          "html": "Take the following actions depending on the <code>Error Code</code>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "Invalid PDU",
                  "html": "These error codes indicate that something unexpected happened at the\n    protocol layer, likely either due to a UA or device bug. Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Invalid Offset",
                  "html": "These error codes indicate that something unexpected happened at the\n    protocol layer, likely either due to a UA or device bug. Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Attribute Not Found",
                  "html": "These error codes indicate that something unexpected happened at the\n    protocol layer, likely either due to a UA or device bug. Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Unsupported Group Type",
                  "html": "These error codes indicate that something unexpected happened at the\n    protocol layer, likely either due to a UA or device bug. Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Invalid Handle",
                  "html": "Return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑨\">InvalidStateError</a></code> from the step."
                },
                {
                  "case": "Invalid Attribute Value Length",
                  "html": "Return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror②\">InvalidModificationError</a></code> from the step."
                },
                {
                  "case": "Attribute Not Long",
                  "html": "<p> If this error code is received without having used a \"Long\"\n      sub-procedure, this may indicate a device bug. Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror④\">NotSupportedError</a></code> from the step. </p>\n        <p> Otherwise, retry the step without using a \"Long\" sub-procedure.\n      If this is impossible due to the length of the value being written,\n      return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror③\">InvalidModificationError</a></code> from the step. </p>"
                },
                {
                  "case": "Insufficient Authentication",
                  "html": "The UA SHOULD attempt to increase the security level of the connection.\n    If this attempt fails or the UA doesn’t support any higher security,\n    Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①⑤\">SecurityError</a></code> from the step.\n    Otherwise, retry the step at the new higher security level."
                },
                {
                  "case": "Insufficient Encryption",
                  "html": "The UA SHOULD attempt to increase the security level of the connection.\n    If this attempt fails or the UA doesn’t support any higher security,\n    Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①⑤\">SecurityError</a></code> from the step.\n    Otherwise, retry the step at the new higher security level."
                },
                {
                  "case": "Insufficient Encryption Key Size",
                  "html": "The UA SHOULD attempt to increase the security level of the connection.\n    If this attempt fails or the UA doesn’t support any higher security,\n    Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①⑤\">SecurityError</a></code> from the step.\n    Otherwise, retry the step at the new higher security level."
                },
                {
                  "case": "Insufficient Authorization",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①⑥\">SecurityError</a></code> from the step."
                },
                {
                  "case": "Application Error",
                  "html": "If the GATT procedure was a Write,\n    return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidmodificationerror\" id=\"ref-for-invalidmodificationerror④\">InvalidModificationError</a></code> from the step.\n    Otherwise, return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑤\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Read Not Permitted",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Write Not Permitted",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Request Not Supported",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Prepare Queue Full",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Insufficient Resources",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Unlikely Error",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                },
                {
                  "case": "Anything else",
                  "html": "Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code> from the step."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "resolve UUID name",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#resolveuuidname",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"resolveuuidname\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">ResolveUUIDName</dfn>(<var>name</var>, <var>GATT assigned\nnumbers</var>), the UA MUST perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is an <code>unsigned long</code>, return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-canonicaluuid\" id=\"ref-for-dom-bluetoothuuid-canonicaluuid②\">BluetoothUUID.canonicalUUID</a></code>(name)\nand abort these steps.</p>"
        },
        {
          "html": "<p>If <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid⑥\">valid UUID</a>, return <var>name</var> and abort\nthese steps.</p>"
        },
        {
          "html": "<p>If <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-name\" id=\"ref-for-valid-name③\">valid name</a> and maps to a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid⑦\">valid UUID</a> in <var>GATT assigned numbers</var>, let <var>alias</var> be its assigned\nnumber, and return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothuuid-canonicaluuid\" id=\"ref-for-dom-bluetoothuuid-canonicaluuid③\">BluetoothUUID.canonicalUUID</a></code>(<var>alias</var>).</p>"
        },
        {
          "html": "<p>Otherwise, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror\" id=\"ref-for-sec-native-error-types-used-in-this-standard-typeerror①⑥\">TypeError</a></code>.</p>"
        }
      ]
    },
    {
      "name": "parsing the GATT assigned numbers",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#parsing-the-gatt-assigned-numbers",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parsing-the-gatt-assigned-numbers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parsing the GATT assigned numbers</dfn> at a URL <var>url</var> is a map from <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-name\" id=\"ref-for-valid-name④\">valid name</a>s to <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid⑧\">valid UUID</a>s, or an\nerror, produced by the following algorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Fetch <var>url</var>, and let <var>contents</var> be its body, decoded as\nUTF-8.</p>"
        },
        {
          "html": "<p>Let <var>lines</var> be <var>contents</var> split on <code>'\\n'</code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be an empty map.</p>"
        },
        {
          "html": "For each <var>line</var> in <var>lines</var>, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>line</var> is empty or its first character is <code>'#'</code>,\ncontinue to the next line.</p>"
            },
            {
              "html": "<p>If <var>line</var> consists of a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-name\" id=\"ref-for-valid-name⑤\">valid name</a>, a space (U+0020), and\na <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid⑨\">valid UUID</a>, let <var>name</var> be that name and let <var>uuid</var> be that UUID.</p>"
            },
            {
              "html": "<p>Otherwise, return an error and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>name</var> is already in <var>result</var>, return an error and\nabort these steps.</p>"
            },
            {
              "html": "<p>Add a mapping in <var>result</var> from <var>name</var> to <var>uuid</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an advertising data filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#parse-an-advertising-data-filter",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-advertising-data-filter\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an advertising data filter</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string\">string</a> <var>input</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>words</var> be <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#strictly-split\" id=\"ref-for-strictly-split\">strictly split</a> on <code>/</code>.</p>"
        },
        {
          "html": "<p>If the length of <var>words</var> is not equal to <code>2</code>, return an error and\nabort these steps.</p>"
        },
        {
          "html": "<p>If the length of <var>words</var>[0] is not equal to the length of <var>words</var>[1], return an error and\nabort these steps.</p>"
        },
        {
          "html": "<p>Let <var>prefixData</var> be <var>words</var>[0].</p>"
        },
        {
          "html": "<p>Let <var>prefixMask</var> be <var>words</var>[1].</p>"
        },
        {
          "html": "<p>If <var>prefixData</var> or <var>prefixMask</var> is not a sequence of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lower-hex-digit\" id=\"ref-for-ascii-lower-hex-digit\">ascii lower hex digit</a>, return an error.</p>"
        },
        {
          "html": "<p>Let <var>prefixIndex</var> be <code>0</code>.</p>"
        },
        {
          "html": "<p>let <var>dataList</var> be an empty list.</p>"
        },
        {
          "html": "<p>let <var>maskList</var> be an empty list.</p>"
        },
        {
          "html": "While <var>prefixIndex</var> is less than the length of <var>prefixData</var>, do the following sub-steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>data</var> be the result of interpreting the characters at index <var>prefixIndex</var> and <code><var>prefixIndex</var> + 1</code> of <var>prefixData</var> as a hexadecimal number.</p>"
            },
            {
              "html": "<p>Let <var>mask</var> be the result of interpreting the characters at index <var>prefixIndex</var> and <code><var>prefixIndex</var> + 1</code> of <var>prefixMask</var> as a hexadecimal number.</p>"
            },
            {
              "html": "<p>Append <var>data</var> to <var>dataList</var>.</p>"
            },
            {
              "html": "<p>Append <var>mask</var> to <var>maskList</var>.</p>"
            },
            {
              "html": "<p>Set <var>prefixIndex</var> to <code>|prefixIndex| + 2</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>result</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit⑧\">BluetoothDataFilterInit</a></code> dictionary.</p>"
        },
        {
          "html": "<p>Set <var>result</var>[<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-dataprefix\" id=\"ref-for-dom-bluetoothdatafilterinit-dataprefix⑤\">dataPrefix</a></code>] to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\" id=\"ref-for-idl-Uint8Array\">Uint8Array</a></code> constructed with <var>dataList</var>.</p>"
        },
        {
          "html": "<p>Set <var>result</var>[<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdatafilterinit-mask\" id=\"ref-for-dom-bluetoothdatafilterinit-mask⑨\">mask</a></code>] to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\" id=\"ref-for-idl-Uint8Array①\">Uint8Array</a></code> constructed with <var>maskList</var>.</p>"
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parsing the manufacturer data blocklist",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#parsing-the-manufacturer-data-blocklist",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parsing-the-manufacturer-data-blocklist\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parsing the manufacturer data blocklist</dfn> at a URL <var>url</var> is a map\nfrom Company Identifier Code to a list of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dictdef-bluetoothdatafilterinit\" id=\"ref-for-dictdef-bluetoothdatafilterinit⑨\">BluetoothDataFilterInit</a></code>, or an error,\nproduced by the following algorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Fetch <var>url</var>, and let <var>contents</var> be its body, decoded as UTF-8.</p>"
        },
        {
          "html": "<p>Let <var>lines</var> be the result of invoking <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.es/ecma262/multipage/text-processing.html#sec-string.prototype.split\" id=\"ref-for-sec-string.prototype.split\">split(separator, limit)</a></code> on <var>contents</var> with separator <code>'\\n'</code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be an empty map.</p>"
        },
        {
          "html": "For each <var>line</var> in <var>lines</var>, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>line</var> is empty or its first character is <code>'#'</code>, continue to the next line.</p>"
            },
            {
              "html": "<p>Let <var>regExp</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.es/ecma262/multipage/text-processing.html#sec-regexp-regular-expression-objects\" id=\"ref-for-sec-regexp-regular-expression-objects\">RegExp</a></code> constructed with 'manufacturer\\ ([0-9a-f]+)\\ ([0-9a-f]+\\/[0-9a-f]+)'.</p>"
            },
            {
              "html": "<p>Let <var>matchResult</var> be the result of invoking <var>regExp</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.es/ecma262/multipage/text-processing.html#sec-regexp.prototype.exec\" id=\"ref-for-sec-regexp.prototype.exec\">exec(string)</a></code> on <var>line</var>, or return an error\nif <var>matchResult</var> is <code>null</code> or the length of <var>matchResult</var> is not equal to <code>3</code>.</p>"
            },
            {
              "html": "<p>Let <var>companyIdentifierStr</var> be <var>matchResult</var>[1] if <var>matchResult</var>[1] is a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-company-identifier-string\" id=\"ref-for-valid-company-identifier-string\">valid company identifier string</a>, otherwise return an error.</p>"
            },
            {
              "html": "<p>Let <var>companyIdentifier</var> be the result of interpreting <var>companyIdentifierStr</var> as a hexadecimal number.</p>"
            },
            {
              "html": "<p>Let <var>dataPrefixStr</var> be <var>matchResult</var>[2].</p>"
            },
            {
              "html": "<p>If <var>companyIdentifier</var> is not in <var>result</var>, set <var>result</var>[<var>companyIdentifier</var>] to be an empty list.</p>"
            },
            {
              "html": "<p>Let <var>dataFilter</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#parse-an-advertising-data-filter\" id=\"ref-for-parse-an-advertising-data-filter\">parsing an advertising data filter</a> at <var>dataPrefixStr</var> if the result is not an error, otherwise return an error.</p>"
            },
            {
              "html": "<p>Append <var>dataFilter</var> to <var>result</var>[<var>companyIdentifier</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parsing the GATT blocklist",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#parsing-the-gatt-blocklist",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parsing-the-gatt-blocklist\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parsing the gatt blocklist</dfn> at a URL <var>url</var> is a map\nfrom <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid①⓪\">valid UUID</a>s to tokens, or an error, produced by the following\nalgorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Fetch <var>url</var>, and let <var>contents</var> be its body, decoded as\nUTF-8.</p>"
        },
        {
          "html": "<p>Let <var>lines</var> be <var>contents</var> split on <code>'\\n'</code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be an empty map.</p>"
        },
        {
          "html": "For each <var>line</var> in <var>lines</var>, do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>line</var> is empty or its first character is <code>'#'</code>,\ncontinue to the next line.</p>"
            },
            {
              "html": "<p>If <var>line</var> consists of just a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid①①\">valid UUID</a>, let <var>uuid</var> be that UUID and let <var>token</var> be\n\"<code>exclude</code>\".</p>"
            },
            {
              "html": "<p>If <var>line</var> consists of a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#valid-uuid\" id=\"ref-for-valid-uuid①②\">valid UUID</a>, a space (U+0020), and\none of the tokens \"<code>exclude-reads</code>\" or\n\"<code>exclude-writes</code>\", let <var>uuid</var> be that UUID and let <var>token</var> be that token.</p>"
            },
            {
              "html": "<p>Otherwise, return an error and abort these steps.</p>"
            },
            {
              "html": "<p>If <var>uuid</var> is already in <var>result</var>, return an error and\nabort these steps.</p>"
            },
            {
              "html": "<p>Add a mapping in <var>result</var> from <var>uuid</var> to <var>token</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "blocklisted manufacturer data",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-manufacturer-data",
      "html": "A manufacturer data <var>manufacturerData</var> is a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"blocklisted-manufacturer-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">blocklisted manufacturer data</dfn> if the following steps\nreturn <code>blocked</code>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-data-blocklist\" id=\"ref-for-manufacturer-data-blocklist\">Manufacturer Data blocklist</a>’s value is an error, return <code>blocked</code>.</p>"
        },
        {
          "html": "<p>Let <var>manufacturerBlocklist</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-data-blocklist\" id=\"ref-for-manufacturer-data-blocklist①\">Manufacturer Data blocklist</a>’s value.</p>"
        },
        {
          "html": "<p>Let <var>companyIdentifier</var> be the company identifier of <var>manufacturerData</var>.</p>"
        },
        {
          "html": "<p>If <var>companyIdentifier</var> is not in <var>manufacturerBlocklist</var>, return <code>unblocked</code>.</p>"
        },
        {
          "html": "For each <var>dataFilter</var> in <var>manufacturerBlocklist</var>[<var>companyIdentifier</var>], do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the advertising data of <var>manufacturerData</var> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-matches\" id=\"ref-for-bluetoothdatafilterinit-matches②\">matches</a> <var>dataFilter</var>,\nreturn <code>blocked</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <code>unblocked</code>.</p>"
        }
      ]
    },
    {
      "name": "blocklisted manufacturer data filter",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#blocklisted-manufacturer-data-filter",
      "html": "A manufacturer data filter <var>manufacturerDataFilter</var> is a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"blocklisted-manufacturer-data-filter\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">blocklisted manufacturer data filter</dfn> if the following steps return <code>blocked</code>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-data-blocklist\" id=\"ref-for-manufacturer-data-blocklist②\">Manufacturer Data blocklist</a>’s value is an error, return <code>blocked</code>.</p>"
        },
        {
          "html": "<p>Let <var>manufacturerBlocklist</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-data-blocklist\" id=\"ref-for-manufacturer-data-blocklist③\">Manufacturer Data blocklist</a>’s value.</p>"
        },
        {
          "html": "<p>Let <var>companyIdentifier</var> be <var>manufacturerDataFilter</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothmanufacturerdatafilterinit-companyidentifier\" id=\"ref-for-dom-bluetoothmanufacturerdatafilterinit-companyidentifier③\">companyIdentifier</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>companyIdentifier</var> is not in <var>manufacturerBlocklist</var>, return <code>unblocked</code>.</p>"
        },
        {
          "html": "For each <var>dataFilter</var> in <var>manufacturerBlocklist</var>[<var>companyIdentifier</var>], do the following sub-steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>manufacturerDataFilter</var> is a <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdatafilterinit-strict-subset\" id=\"ref-for-bluetoothdatafilterinit-strict-subset\">strict subset</a> of <var>dataFilter</var>,\nreturn <code>blocked</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <code>unblocked</code>.</p>"
        }
      ]
    },
    {
      "name": "serialize device",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#serialize-a-device",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-a-device\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize a device</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice④⑦\">BluetoothDevice</a></code> <var>device</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>id</var> be <var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-id\" id=\"ref-for-dom-bluetoothdevice-id②\">id</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>name</var> be <var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-name\" id=\"ref-for-dom-bluetoothdevice-name①\">name</a></code>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">map</a> matching the <code>bluetooth.RequestDeviceInfo</code> production, with <code>\"id\"</code> set to <var>id</var> and <code>\"name\"</code> set to <var>name</var>.</p>"
        }
      ]
    },
    {
      "name": "get a prompt",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#get-a-prompt",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-prompt\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a prompt</dfn> given <var>navigableId</var> and <var>promptId</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promptMap</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#map-of-navigables-to-device-prompts\" id=\"ref-for-map-of-navigables-to-device-prompts①\">map of navigables to device prompts</a>.</p>"
        },
        {
          "html": "If <var>promptMap</var>[<var>navigableId</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code\">error code</a> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#no-such-prompt\" id=\"ref-for-no-such-prompt\">no such prompt</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>prompt</var> be <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#map-of-navigables-to-device-prompts\" id=\"ref-for-map-of-navigables-to-device-prompts②\">map of navigables to device prompts</a>[<var>navigableId</var>].</p>"
        },
        {
          "html": "If <var>prompt</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#device-prompt-id\" id=\"ref-for-device-prompt-id\">device prompt id</a> is not <var>promptId</var>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">error code</a> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#no-such-prompt\" id=\"ref-for-no-such-prompt①\">no such prompt</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <var>prompt</var>.</p>"
        }
      ]
    },
    {
      "name": "match a device in prompt",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#match-a-device-in-prompt",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-a-device-in-prompt\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match a device in prompt</dfn> given <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#device-prompt\" id=\"ref-for-device-prompt①\">device prompt</a> <var>prompt</var> and <var>deviceId</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>device</var> in <var>prompt</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#set-of-devices\" id=\"ref-for-set-of-devices\">set of devices</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-id\" id=\"ref-for-dom-bluetoothdevice-id③\">id</a></code> is <var>deviceId</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①\">success</a> with data <var>device</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②\">error code</a> <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#no-such-device\" id=\"ref-for-no-such-device\">no such device</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "serialize prompt devices",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#serialize-prompt-devices",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-prompt-devices\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize prompt devices</dfn> given <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#device-prompt\" id=\"ref-for-device-prompt②\">device prompt</a> <var>prompt</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>devices</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a>.</p>"
        },
        {
          "html": "For each <var>device</var> in <var>prompt</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#set-of-devices\" id=\"ref-for-set-of-devices①\">set of devices</a>.",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#serialize-a-device\" id=\"ref-for-serialize-a-device\">serializing</a> <var>device</var> to <var>devices</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>devices</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.handleRequestDevicePrompt",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>promptId</var> be <var>params</var>[<code>\"prompt\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>prompt</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try\">trying</a> to <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-a-prompt\" id=\"ref-for-get-a-prompt\">get a prompt</a> with <var>contextId</var> and <var>promptId</var>.</p>"
        },
        {
          "html": "<p>Let <var>accept</var> be the value of the <code>accept</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "If <var>accept</var> is true:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deviceId</var> be the value of the <code>device</code> field of <var>command parameters</var>.</p>"
            },
            {
              "html": "<p>Let <var>device</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#match-a-device-in-prompt\" id=\"ref-for-match-a-device-in-prompt\">match a device in prompt</a> given <var>prompt</var> and <var>deviceId</var>.</p>"
            },
            {
              "html": "<p>Acknowledge <var>prompt</var> with <var>device</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "dismiss",
          "steps": [
            {
              "html": "<p>Dismiss <var>prompt</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulateAdapter",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top④\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter⑦\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "If <var>simulatedBluetoothAdapter</var> is empty, run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>params</var>[<code>\"leSupported\"</code>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exist</a>, set <var>params</var>[<code>\"leSupported\"</code>] to <code>true</code>.</p>"
            },
            {
              "html": "<p>Let <var>simulatedBluetoothAdapter</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter⑧\">simulated Bluetooth adapter</a>.</p>"
            },
            {
              "html": "<p>Set <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#le-supported-state\" id=\"ref-for-le-supported-state①\">LE supported state</a> to <var>params</var>[<code>\"leSupported\"</code>].</p>"
            },
            {
              "html": "<p>Set <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#adapter-state\" id=\"ref-for-adapter-state①\">adapter state</a> to <var>params</var>[<code>\"state\"</code>].</p>"
            },
            {
              "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter⑨\">simulated Bluetooth adapter</a> to <var>simulatedBluetoothAdapter</var>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③\">success</a> with data <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>simulatedBluetoothAdapter</var> is not empty, run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>params</var>[<code>\"leSupported\"</code>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>Set <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#adapter-state\" id=\"ref-for-adapter-state②\">adapter state</a> to <var>params</var>[<code>\"state\"</code>].</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④\">success</a> with data <code>null</code>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.disableSimulation",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑤\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①⓪\">simulated Bluetooth adapter</a> to empty.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulatePreconnectedPeripheral",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be params[\"context\"].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑥\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①①\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedBluetoothAdapter</var> is empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceAddress</var> be <var>params</var>[<code>\"address\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>deviceMapping</var> be <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping①\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>deviceMapping</var>[<var>deviceAddress</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothDevice</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device\" id=\"ref-for-simulated-bluetooth-device③\">simulated Bluetooth device</a>.</p>"
        },
        {
          "html": "<p>Set <var>simulatedBluetoothDevice</var>’s name to <var>params</var>[<code>\"name\"</code>].</p>"
        },
        {
          "html": "<p>Set <var>simulatedBluetoothDevice</var>’s address to <var>params</var>[<code>\"address\"</code>].</p>"
        },
        {
          "html": "<p>Set <var>simulatedBluetoothDevice</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#manufacturer-specific-data\" id=\"ref-for-manufacturer-specific-data⑤\">manufacturer specific data</a> to the output of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode\">forgiving-base64 decode</a> performed on <var>params</var>[<code>\"manufacturerData\"</code>].</p>"
        },
        {
          "html": "<p>Set <var>simulatedBluetoothDevice</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#service-uuid-data-type\" id=\"ref-for-service-uuid-data-type⑨\">service UUIDs</a> to <var>params</var>[<code>\"knownServiceUuids\"</code>].</p>"
        },
        {
          "html": "<p>Set <var>deviceMapping</var>[<var>deviceAddress</var>] to <var>simulatedBluetoothDevice</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulateAdvertisement",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>topLevelNavigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable③\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>If <var>topLevelNavigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑦\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>scanEntry</var> be <var>params</var>[<code>\"scanEntry\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>deviceAddress</var> be <var>scanEntry</var>[<code>\"deviceAddress\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>topLevelNavigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①②\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedBluetoothAdapter</var> is empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceMapping</var> be <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping②\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>deviceMapping</var>[<var>deviceAddress</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>, let <var>simulatedDevice</var> be <var>deviceMapping</var>[<var>deviceAddress</var>]. Otherwise, let <var>simulatedDevice</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device\" id=\"ref-for-simulated-bluetooth-device④\">simulated Bluetooth device</a> with <var>deviceAddress</var> and set <var>deviceMapping</var>[<var>deviceAddress</var>] to <var>simulatedDevice</var>.</p>"
        },
        {
          "html": "<p>If <var>topLevelNavigable</var> is currently executing the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#scan-for-devices\" id=\"ref-for-scan-for-devices①\">scan for devices</a> algorithm,\ninsert <var>simulatedDevice</var> into\nthe <em>simulatedBluetoothDevices</em> variable within that algorithm.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables\">inclusive descendant navigables</a> of <var>topLevelNavigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document\">active document</a>.</p>"
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①\">active document</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task③\">Queue a task</a> on <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑥\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop②\">responsible event loop</a> to do the following sub-steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>simulatedDeviceInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing④\">get the <code>BluetoothDevice</code> representing</a> <var>simulatedDevice</var> inside <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window\">active window</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator③\">associated <code>Navigator</code></a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth⑤\">associated Bluetooth</a>.</p>"
                },
                {
                  "html": "<p>If <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-watchadvertisementsstate-slot\" id=\"ref-for-dom-bluetoothdevice-watchadvertisementsstate-slot⑧\">[[watchAdvertisementsState]]</a></code> is <code>not-watching</code>, abort these sub-steps.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#fire-an-advertisementreceived-event\" id=\"ref-for-fire-an-advertisementreceived-event①\">Fire an <code>advertisementreceived</code> event</a> for the advertising event represented by <var>scanEntry</var>[<code>\"scanRecord\"</code>], at <var>simulatedDeviceInstance</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulateGattConnectionResponse",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable④\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>Let <var>deviceAddress</var> be <var>params</var>[<code>\"address\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①③\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedBluetoothAdapter</var> is empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceMapping</var> be <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping③\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>deviceMapping</var>[<var>deviceAddress</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>, let <var>simulatedDevice</var> be <var>deviceMapping</var>[<var>deviceAddress</var>].\nOtherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedDeviceInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing⑤\">get the <code>BluetoothDevice</code> representing</a> <var>simulatedDevice</var> inside <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window①\">active window</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator④\">associated <code>Navigator</code></a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth⑥\">associated Bluetooth</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt-slot\" id=\"ref-for-dom-bluetoothdevice-gatt-slot①\">[[gatt]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot⑤\">[[automatedGATTConnectionResponse]]</a></code> is <code>\"expected\"</code>,\nset <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt-slot\" id=\"ref-for-dom-bluetoothdevice-gatt-slot②\">[[gatt]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot⑥\">[[automatedGATTConnectionResponse]]</a></code> to <var>params</var>[<code>\"code\"</code>].</p>"
        },
        {
          "html": "<p>Otherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-element-state\" id=\"ref-for-dfn-invalid-element-state\">invalid element state</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulateGattDisconnection",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑥\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑤\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>Let <var>deviceAddress</var> be <var>params</var>[<code>\"address\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①④\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedBluetoothAdapter</var> is empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceMapping</var> be <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping④\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>deviceMapping</var>[<var>deviceAddress</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>, let <var>simulatedDevice</var> be <var>deviceMapping</var>[<var>deviceAddress</var>].\nOtherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedDeviceInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing⑥\">get the <code>BluetoothDevice</code> representing</a> <var>simulatedDevice</var> inside <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window②\">active window</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator⑤\">associated <code>Navigator</code></a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth⑦\">associated Bluetooth</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt-slot\" id=\"ref-for-dom-bluetoothdevice-gatt-slot③\">[[gatt]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot⑦\">[[automatedGATTConnectionResponse]]</a></code> is <code>\"expected\"</code>,\nset <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-gatt-slot\" id=\"ref-for-dom-bluetoothdevice-gatt-slot④\">[[gatt]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot\" id=\"ref-for-dom-bluetoothremotegattserver-automatedgattconnectionresponse-slot⑧\">[[automatedGATTConnectionResponse]]</a></code> to <code>0x15</code>.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#clean-up-the-disconnected-device\" id=\"ref-for-clean-up-the-disconnected-device②\">clean up the disconnected device</a> <var>simulatedDeviceInstance</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for bluetooth.simulateService",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑦\">remote end steps</a> with command parameters <var>params</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contextId</var> be <var>params</var>[<code>\"context\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑥\">get a navigable</a> with <var>contextId</var>.</p>"
        },
        {
          "html": "<p>Let <var>deviceAddress</var> be <var>params</var>[<code>\"address\"</code>].</p>"
        },
        {
          "html": "<p>Let <var>simulatedBluetoothAdapter</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-adapter\" id=\"ref-for-simulated-bluetooth-adapter①⑤\">simulated Bluetooth adapter</a>.</p>"
        },
        {
          "html": "<p>If <var>simulatedBluetoothAdapter</var> is empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>deviceMapping</var> be <var>simulatedBluetoothAdapter</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-bluetooth-device-mapping\" id=\"ref-for-simulated-bluetooth-device-mapping⑤\">simulated Bluetooth device mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>deviceMapping</var>[<var>deviceAddress</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>, let <var>simulatedDevice</var> be <var>deviceMapping</var>[<var>deviceAddress</var>].</p>"
        },
        {
          "html": "<p>Otherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>simulatedDeviceInstance</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#get-the-bluetoothdevice-representing\" id=\"ref-for-get-the-bluetoothdevice-representing⑦\">get the <code>BluetoothDevice</code> representing</a> <var>simulatedDevice</var> inside <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window③\">active window</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#associated-navigator\" id=\"ref-for-associated-navigator⑥\">associated <code>Navigator</code></a>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#associated-bluetooth\" id=\"ref-for-associated-bluetooth⑧\">associated Bluetooth</a>.</p>"
        },
        {
          "html": "<p>Let <var>serviceMapping</var> be <var>simulatedDevice</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-gatt-service-mapping\" id=\"ref-for-simulated-gatt-service-mapping\">simulated GATT service mapping</a>.</p>"
        },
        {
          "html": "<p>Let <var>uuid</var> be <var>params</var>[<code>\"uuid\"</code>].</p>"
        },
        {
          "html": "If <var>params</var>[<code>\"type\"</code>] is <code>\"add\"</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>serviceMapping</var>[<var>uuid</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-element-state\" id=\"ref-for-dfn-invalid-element-state①\">invalid element state</a>.</p>"
            },
            {
              "html": "<p>Let <var>simulatedGattService</var> be a new <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#simulated-gatt-service\" id=\"ref-for-simulated-gatt-service①\">simulated GATT service</a>.</p>"
            },
            {
              "html": "<p>Set <var>simulatedGattService</var>’s <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#uuid\" id=\"ref-for-uuid①②\">UUID</a> to <var>uuid</var>.</p>"
            },
            {
              "html": "<p>Set <var>serviceMapping</var>[<var>uuid</var>] to <var>simulatedGattService</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#create-a-bluetoothremotegattservice-representing\" id=\"ref-for-create-a-bluetoothremotegattservice-representing①\">Create a <code>BluetoothRemoteGATTService</code> representing</a> <var>simulatedGattService</var> and add a mapping from <var>simulatedGattService</var> to the resulting <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://tc39.github.io/ecma262/#sec-promise-objects\" id=\"ref-for-sec-promise-objects①①\">Promise</a></code> in <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-context-slot\" id=\"ref-for-dom-bluetoothdevice-context-slot③\">[[context]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot⑤\">[[attributeInstanceMap]]</a></code>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧\">success</a> with data <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "Else if <var>params</var>[<code>\"type\"</code>] is <code>\"remove\"</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>serviceMapping</var>[<var>uuid</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>, let <var>simulatedGattService</var> be <var>serviceMapping</var>[<var>uuid</var>].</p>"
            },
            {
              "html": "<p>Otherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-element-state\" id=\"ref-for-dfn-invalid-element-state②\">invalid element state</a>.</p>"
            },
            {
              "html": "<p>Remove <var>simulatedGattService</var> from <var>simulatedDeviceInstance</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-context-slot\" id=\"ref-for-dom-bluetoothdevice-context-slot④\">[[context]]</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-attributeinstancemap-slot\" id=\"ref-for-dom-bluetooth-attributeinstancemap-slot⑥\">[[attributeInstanceMap]]</a></code>.</p>"
            },
            {
              "html": "<p>Remove <var>uuid</var> from <var>serviceMapping</var>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨\">success</a> with data <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①④\">invalid argument</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end event trigger for bluetooth.requestDevicePromptUpdated",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#trigger-a-prompt-updated-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"trigger-a-prompt-updated-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">trigger a prompt updated event</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable①\">navigable</a> <var>navigable</var>, a string <var>promptId</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">set</a> of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetooth-device\" id=\"ref-for-bluetooth-device②④\">Bluetooth devices</a> <var>devices</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigableId</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②\">navigable id</a>.</p>"
        },
        {
          "html": "<p>Let <var>prompt</var> be the <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#device-prompt\" id=\"ref-for-device-prompt④\">device prompt</a> (<var>promptId</var>, <var>devices</var>).</p>"
        },
        {
          "html": "<p>Let <var>serialized devices</var> be the result of <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#serialize-prompt-devices\" id=\"ref-for-serialize-prompt-devices\">serialize prompt devices</a> with <var>prompt</var>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#map-of-navigables-to-device-prompts\" id=\"ref-for-map-of-navigables-to-device-prompts③\">map of navigables to device prompts</a>[<var>navigableId</var>] to <var>prompt</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">map</a> matching the <code>bluetooth.RequestDevicePromptUpdatedParameters</code> production with the <code>context</code> field set to <var>navigableId</var>, the <code>prompt</code> field set to <var>promptId</var>, and the <code>devices</code> field set to <var>serialized devices</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">map</a> matching the <code>bluetooth.RequestDevicePromptUpdated</code> production, with the <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>relatedNavigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled\">set of sessions for which an event is enabled</a> given \"<code>bluetooth.requestDevicePromptUpdated</code>\" and <var>relatedNavigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for bluetooth.GattConnectionAttempted",
      "href": "https://webbluetoothcg.github.io/web-bluetooth/#trigger-a-gatt-connection-attempted-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"trigger-a-gatt-connection-attempted-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">trigger a gatt connection attempted event</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable②\">navigable</a> <var>navigable</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#bluetoothdevice\" id=\"ref-for-bluetoothdevice④⑨\">BluetoothDevice</a></code> <var>device</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigableId</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id③\">navigable id</a>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">map</a> matching the <code>bluetooth.GattConnectionAttemptedParameters</code> production with the <code>context</code> field set to <var>navigableId</var> and the <code>address</code> field set to <var>device</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetoothdevice-representeddevice-slot\" id=\"ref-for-dom-bluetoothdevice-representeddevice-slot①⑥\">[[representedDevice]]</a></code>’s address.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦\">map</a> matching the <code>bluetooth.GattConnectionAttempted</code> production, with the <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>relatedNavigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①\">set of sessions for which an event is enabled</a> given\n\"<code>bluetooth.gattEventGenerated</code>\" and <var>relatedNavigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "",
      "rationale": "error",
      "steps": [
        {
          "html": "Architecture &amp; Terminology Overview",
          "ignored": [
            "General Description Overview of Bluetooth Low Energy Operation (defines advertising events) Communication Topology and Operation Operational Procedures and Modes BR/EDR Procedures Inquiry (Discovering) Procedure Extended Inquiry Response"
          ]
        },
        {
          "html": "Core System Package [BR/EDR Controller volume]",
          "rationale": "error",
          "steps": [
            {
              "html": "Error Codes",
              "ignored": [
                "Overview of Error Codes List of Error Codes"
              ]
            },
            {
              "html": "Host Controller Interface Functional Specification",
              "ignored": [
                "HCI Commands and Events Informational Parameters Read BD_ADDR Command Status Parameters Read RSSI Command"
              ]
            }
          ]
        },
        {
          "html": "Core System Package [Host volume]",
          "rationale": "error",
          "steps": [
            {
              "html": "Service Discovery Protocol (SDP) Specification",
              "ignored": [
                "Overview Searching for Services UUID (defines UUID aliases and the algorithm to compute the 128-bit UUID represented by a UUID alias)"
              ]
            },
            {
              "html": "Generic Access Profile",
              "ignored": [
                "Profile Overview Profile Roles Roles when Operating over an LE Physical Transport Broadcaster Role Observer Role Peripheral Role Central Role User Interface Aspects Representation of Bluetooth Parameters Bluetooth Device Name (the user-friendly name) Idle Mode Procedures — BR/EDR Physical Transport Device Discovery Procedure BR/EDR Bonding Procedure Operational Modes and Procedures — LE Physical Transport Broadcast Mode and Observation Procedure Observation Procedure Discovery Modes and Procedures General Discovery Procedure Name Discovery Procedure Connection Modes and Procedures Bonding Modes and Procedures LE Bonding Procedure Security Aspects — LE Physical Transport Privacy Feature Random Device Address Static Address Private address Resolvable Private Address Resolution Procedure Advertising Data and Scan Response Data Format (defines AD structure) Bluetooth Device Requirements Bluetooth Device Address (defines BD_ADDR) Bluetooth Device Address Types Public Bluetooth Address Definitions (defines bond)"
              ]
            },
            {
              "html": "Attribute Protocol (ATT)",
              "rationale": "error",
              "steps": [
                {
                  "html": "Protocol Requirements",
                  "rationale": "error",
                  "steps": [
                    {
                      "html": "Basic Concepts",
                      "ignored": [
                        "Attribute Type Attribute Handle Long Attribute Values"
                      ]
                    },
                    {
                      "html": "Attribute Protocol Pdus",
                      "rationale": "error",
                      "steps": [
                        {
                          "html": "Error Handling",
                          "rationale": "error",
                          "steps": [
                            {
                              "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"error-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Error Response</dfn>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"Generic Attribute Profile|GATT\" data-noexport=\"\" id=\"generic-attribute-profile\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Generic Attribute Profile</dfn> (GATT)",
              "rationale": "find",
              "steps": [
                {
                  "html": "Profile Overview",
                  "ignored": [
                    "Configurations and Roles (defines GATT Client and GATT Server) Profile Fundamentals, defines the ATT Bearer Attribute Protocol Attribute Caching GATT Profile Hierarchy Service Included Services Characteristic"
                  ]
                },
                {
                  "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"service-interoperability-requirements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Service Interoperability Requirements</dfn>",
                  "ignored": [
                    "Service Definition Characteristic Definition Characteristic Declaration Characteristic Properties Characteristic Descriptor Declarations Characteristic Extended Properties Client Characteristic Configuration"
                  ]
                },
                {
                  "html": "GATT Feature Requirements — defines the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"GATT procedure|GATT procedures\" data-noexport=\"\" id=\"gatt-procedure\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">GATT procedures</dfn>.",
                  "rationale": "find",
                  "steps": [
                    {
                      "html": "Server Configuration",
                      "ignored": [
                        "Exchange MTU"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"primary-service-discovery\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Primary Service Discovery</dfn>",
                      "ignored": [
                        "Discover All Primary Services Discover Primary Service by Service UUID"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"relationship-discovery\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Relationship Discovery</dfn>",
                      "rationale": "find",
                      "steps": [
                        {
                          "html": "Find Included Services"
                        }
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-discovery\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Discovery</dfn>",
                      "ignored": [
                        "Discover All Characteristics of a Service Discover Characteristics by UUID"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-descriptor-discovery\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Descriptor Discovery</dfn>",
                      "ignored": [
                        "Discover All Characteristic Descriptors"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-value-read\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Value Read</dfn>"
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-value-write\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Value Write</dfn>",
                      "ignored": [
                        "Write Without Response Write Characteristic Value"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-value-notification\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Value Notification</dfn>"
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-value-indications\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Value Indications</dfn>"
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"characteristic-descriptors\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Characteristic Descriptors</dfn>",
                      "ignored": [
                        "Read Characteristic Descriptors Read Long Characteristic Descriptors Write Characteristic Descriptors Write Long Characteristic Descriptors"
                      ]
                    },
                    {
                      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-local-lt=\"procedure times out\" data-noexport=\"\" id=\"procedure-timeouts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Procedure Timeouts</dfn>"
                    }
                  ]
                },
                {
                  "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"gap-interoperability-requirements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">GAP Interoperability Requirements</dfn>",
                  "ignored": [
                    "BR/EDR GAP Interoperability Requirements Connection Establishment LE GAP Interoperability Requirements Connection Establishment"
                  ]
                },
                {
                  "html": "Defined Generic Attribute Profile Service",
                  "ignored": [
                    "Service Changed"
                  ]
                }
              ]
            },
            {
              "html": "Security Manager Specification",
              "ignored": [
                "Security Manager Security in Bluetooth Low Energy Definition of Keys and Values, defines the Identity Resolving Key (IRK)"
              ]
            }
          ]
        },
        {
          "html": "Core System Package [Low Energy Controller volume]",
          "ignored": [
            "Link Layer Specification General Description Device Address Public Device Address Random Device Address Static Device Address Air Interface Protocol Non-Connected States Scanning State Passive Scanning"
          ]
        }
      ]
    }
  ]
}