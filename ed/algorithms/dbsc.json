{
  "spec": {
    "title": "Device Bound Session Credentials",
    "url": "https://w3c.github.io/webappsec-dbsc/"
  },
  "algorithms": [
    {
      "name": "identify-session",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-identify-a-session",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-identify-a-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">identify a session</dfn> out of all the\n  sessions that exist on a user agent. The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier①\">session identifier</a> is unique within a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑤\">registrable domain</a>. \n    <p>Given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URL</a> (<var>url</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier②\">session identifier</a> (<var>session identifier</var>), this algorithm returns a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session①\">device bound session</a> or\n  null if no such session exists.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>domain</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑥\">registrable domain</a> of <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a>.</p>"
        },
        {
          "html": "<p>Let <var>domain sessions</var> be the user agent’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-store\" id=\"ref-for-session-store\">session store</a>[<var>domain</var>] as a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-by-id\" id=\"ref-for-session-by-id①\">session by id</a></p>"
        },
        {
          "html": "<p>Return <var>domain sessions</var>[<var>session identifier</var>]</p>"
        }
      ]
    },
    {
      "name": "url-in-scope",
      "html": "This algorithm describes how to determine if a URL is in scope of a\n  device bound session. Given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url③\">URL</a> (<var>URL</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#modules-session\" id=\"ref-for-modules-session\">session</a> (<var>session</var>), returns\n  \"include\" if <var>URL</var> is in scope, and \"exclude\" otherwise.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>scope</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope\">session scope</a>.</p>"
        },
        {
          "html": "<p>If <var>scope</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site\">include site</a> is true, return \"exclude\" if <var>URL</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site\">same site</a> with <var>scope</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>scope</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site①\">include site</a> is false, return \"exclude\" if <var>URL</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a> with <var>scope</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin①\">origin</a>.</p>"
        },
        {
          "html": "<p>If the <var>URL</var> matches the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-refresh-url\" id=\"ref-for-device-bound-session-refresh-url\">refresh URL</a>, return \"exclude\".</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>scope specification</var> in <var>scope</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-scope-specifications\" id=\"ref-for-session-scope-scope-specifications\">scope specifications</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>host pattern</var> be <var>scope specification</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-host\" id=\"ref-for-scope-specification-host\">host</a>, and <var>path pattern</var> be <var>scope\n specification</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-path\" id=\"ref-for-scope-specification-path\">path</a>.</p>"
            },
            {
              "html": "<p>If running <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-host-pattern-matches\">§ 7.4 Identify if a host matches a pattern</a> on <var>URL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a> and <var>host pattern</var> returns false, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If any of the following hold, return <var>scope specification</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-type\" id=\"ref-for-scope-specification-type\">type</a>:</p>",
              "ignored": [
                "URL’s path is exactly path pattern. path pattern ends in '/' and URL’s path starts with path pattern. URL’s path starts with path pattern followed by a '/'."
              ]
            }
          ]
        },
        {
          "html": "<p>Return \"include\".</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n     <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> (<var>response</var>), this algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope①\">session scope</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site②\">include site</a> is true, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site①\">same site</a> with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope②\">session scope</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin②\">origin</a>, return \"allowed\".</p>"
        },
        {
          "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope③\">session scope</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site③\">include site</a> is false, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope④\">session scope</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin③\">origin</a>, return \"allowed\".</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>initiator pattern</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-allowed-refresh-initiators\" id=\"ref-for-device-bound-session-allowed-refresh-initiators\">allowed refresh initiators</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If running <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-host-pattern-matches\">§ 7.4 Identify if a host matches a pattern</a> on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②\">origin</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host\">host</a> and <var>initiator pattern</var> returns true, return \"allowed\".</p>"
            }
          ]
        },
        {
          "html": "<p>Return \"disallowed\".</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n     <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> (<var>response</var>), this algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>pattern</var> equals '*', return true.</p>"
        },
        {
          "html": "If <var>pattern</var> starts with '*':",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>pattern</var> does not start with '*.', return false.</p>"
            },
            {
              "html": "<p>Return true if <var>host</var> ends with all but the first character\n of <var>pattern</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true if <var>host</var> is equal to <var>pattern</var>.</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n     <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> (<var>response</var>), this algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>domain</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑦\">registrable domain</a> of the <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">url</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host③\">host</a>.</p>"
        },
        {
          "html": "<p>Let <var>domain sessions</var> be the user agent’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-store\" id=\"ref-for-session-store①\">session store</a>[<var>domain</var>] as <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-by-id\" id=\"ref-for-session-by-id②\">session by id</a></p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>session</var> of <var>domain sessions</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-expiration-timestamp\" id=\"ref-for-device-bound-session-expiration-timestamp\">expiration timestamp</a> is before the present, remove <var>session</var> from <var>domain sessions</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>id</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier③\">session identifier</a>.</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple\">tuple</a> (<var>domain</var>, <var>id</var>) is in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#request-deferred-device-bound-session-ids\" id=\"ref-for-request-deferred-device-bound-session-ids\">deferred device bound session ids</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>Run the steps in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a> on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">URL</a> and <var>session</var>.</p>"
            },
            {
              "html": "<p>If the result does not indicate the request is in scope, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "<p>Run the steps in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-request-allows-refresh\">§ 7.3 Identify if a request is allowed to refresh</a> on <var>request</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>If the result is not \"allowed\", <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>If the result of running <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-missing-session-credential\">§ 7.6 Identify missing session credential</a> on <var>request</var> and <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-credentials\" id=\"ref-for-device-bound-session-session-credentials\">session credentials</a> is false, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>Add (<var>domain</var>, <var>id</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#request-deferred-device-bound-session-ids\" id=\"ref-for-request-deferred-device-bound-session-ids①\">deferred device bound session ids</a>.</p>"
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-expiration-timestamp\" id=\"ref-for-device-bound-session-expiration-timestamp①\">expiration timestamp</a> set to a future timestamp. The\n exact choice of expiration timestamp is left up to the user agent. It is\n recommended to align with the maximum cookie lifetime.</p>"
            },
            {
              "html": "<p>Return <var>session</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If no session has been identified, return null.</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n     <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> (<var>response</var>), this algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>credential</var> in <var>credentials</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If a cookie with <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential-attributes\" id=\"ref-for-session-credential-attributes\">attributes</a> would\n not be attached to <var>request</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#cookie\">section 5.4</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a> contains a <var>cookie</var> that\n satisfies all of the following conditions, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>:</p>",
              "ignored": [
                "cookie’s name matches credential’s name All of the following attributes of cookie match those in credential’s attributes: Domain, Path, Secure, HttpOnly, SameSite. cookie’s partition key matches that of credential."
              ]
            },
            {
              "html": "<p>Return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n     <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> (<var>response</var>), this algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>header name</var> be \"<code>Secure-Session-Challenge</code>\".</p>"
        },
        {
          "html": "<p>Let <var>challenge list</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">get a structured\nfield value</a> given <var>header name</var> and \"list\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>challenge list</var> is null, return.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> (<var>challenge</var>, <var>params</var>) of <var>challenge list</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the type of <var>challenge</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string⑨\">sf-string</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>session id</var> be null.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"id\"] exists and is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⓪\">sf-string</a>, set <var>session id</var> to <var>params</var>[\"id\"].</p>"
            },
            {
              "html": "<p>If <var>session id</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑨\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>session</var> be the result of running <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session\">§ 7.1 Identify session</a> given <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url\">URL</a> and <var>session id</var>.</p>"
            },
            {
              "html": "<p>If <var>session</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⓪\">continue</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>credential</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-credentials\" id=\"ref-for-device-bound-session-session-credentials①\">session credentials</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If a cookie with <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential-attributes\" id=\"ref-for-session-credential-attributes②\">attributes</a> could\n  not be set by <var>response</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#storage-model\">section 5.3</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①①\">continue</a>.</p>"
                },
                {
                  "html": "<p>Store <var>challenge</var> as <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge①\">cached challenge</a> to be used next\n time a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof\">DBSC proof</a> is to be sent from this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session③\">device bound session</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"send a request\" id=\"algorithms-send-a-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send\n  a request</dfn> for a device bound session registration or refresh. It\n  takes as input an <var>originating request</var>, <var>key pair</var>, <var>destination</var>,\n  and optional <var>session id</var>, <var>challenge</var>, and <var>authorization</var>. \n     \n     <h3 class=\"heading settled\" data-level=\"7.9\" id=\"algo-create-session\"><span class=\"secno\">7.9. </span><span class=\"content\">Create session</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"process-registration\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new session</dfn> due to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> (<var>response</var>) to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> (<var>request</var>), do the following steps: \n      \n     </div>\n     <h3 class=\"heading settled\" data-level=\"7.10\" id=\"algo-create-session-key\"><span class=\"secno\">7.10. </span><span class=\"content\">Create session key</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session-key\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"create-session-key\">\n      <p>This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create a session key\" id=\"create-session-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a\nsession key</dfn>, including key sharing between a Relying Party and Session\nProvider. It takes as input the <var>registration entry</var> and <var>params</var> of a\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>` header, and the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a> (<var>registration URL</var>) of\nthe registration endpoint. It returns a key pair for use in the session or null\nif no key is possible.</p>\n      \n     </div>\n     <h3 class=\"heading settled\" data-level=\"7.11\" id=\"algo-add-debug-header\"><span class=\"secno\">7.11. </span><span class=\"content\">Add debug header</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-add-debug-header\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"add-debug-header\">\n       In order for sites to understand when the user agent chooses not to\napply a session, user agents should <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"add-debug-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add the debug header</dfn> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">request</a> (<var>request</var>) with an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token①\">sf-token</a> (<var>token</var>) and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①③\">string</a> (<var>session id</var>). \n      \n     </div>\n     <h2 class=\"heading settled\" data-level=\"8\" id=\"format\"><span class=\"secno\">8. </span><span class=\"content\">DBSC Formats</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format\"></a></h2>\n     <h3 class=\"heading settled\" data-level=\"8.1\" id=\"header-secure-session-registration\"><span class=\"secno\">8.1. </span><span class=\"content\">`<code>Secure-Session-Registration</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-registration\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Registration`\" id=\"secure-session-registration-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Registration`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> by the server to start a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session④\">device bound session</a> on the\nclient. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Secure-Session-Registration = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list⑥\">sf-list</a></pre>\n     <p>Each item in the list must be an inner list, and each item in the inner list\nMUST be an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token③\">sf-token</a> representing a supported algorithm (ES256, RS256).\nOnly these two values are currently supported.</p>\n     <p>The following <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①\">sf-parameter</a>s are defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters②\">sf-parameter</a> whose key is \"path\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①④\">sf-string</a>, conveying the path to the registration endpoint. This may be\nrelative to the current <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a>, or a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a>. Entries without this\nparameter will be ignored in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\">§ 7.9 Create session</a>.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters③\">sf-parameter</a> whose key is \"challenge\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑤\">sf-string</a>, conveying the challenge to be used in the session\nregistration.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters④\">sf-parameter</a> whose key is \"authorization\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑥\">sf-string</a>. This <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑤\">sf-parameter</a> will be copied into the\nregistration JWT.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑥\">sf-parameter</a> whose key is \"provider_key\", and whose value is\nan <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑦\">sf-string</a>, conveying that this session should share keys\nwith a session with the given public key.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑦\">sf-parameter</a> whose key is \"provider_id\", and whose value is\nan <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑧\">sf-string</a>, conveying that this session should share keys\nwith a session with the given session identifier.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑧\">sf-parameter</a> whose key is \"provider_url\", and whose value\nis an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑨\">sf-string</a>, conveying that this session should share keys\nwith a session on that site.</p>\n     </li></ul>\n     \n     <h3 class=\"heading settled\" data-level=\"8.2\" id=\"header-secure-session-challenge\"><span class=\"secno\">8.2. </span><span class=\"content\">`<code>Secure-Session-Challenge</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-challenge\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Challenge`\" id=\"secure-session-challenge-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Challenge`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> by the server to send a challenge to the client that it expects to\nbe used in future Secure-Session-Response headers inside the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof②\">DBSC proof</a>, or to\nrequest a newly signed <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof③\">DBSC proof</a> right away if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑧\">status</a> is 403. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` is a structured header. Its value must be a string.\nIts ABNF is: </p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②⓪\">sf-string</a></pre>\n      The semantics of the item are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\">§ 8.2.1 `Secure-Session-Challenge` structured header serialization</a>.\n     <p></p>\n     <p>The processing steps are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-process-challenge\">§ 7.7 Cache challenge</a>.</p>\n     <h4 class=\"heading settled\" data-level=\"8.2.1\" id=\"challenge-structured-header-serialization\"><span class=\"secno\">8.2.1. </span><span class=\"content\">`<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` structured header serialization</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\"></a></h4>\n      The `<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` is represented as a Structured Field.<a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a> \n     <p>In this representation, a challenge is represented by a string.</p>\n     <p>Challenges MAY have an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑨\">sf-parameter</a> named <code>\"id\"</code>, whose value MUST be a String\nrepresenting a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑤\">session identifier</a>. Any other <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①⓪\">sf-parameter</a>s SHOULD be ignored.</p>\n     \n     \n     <h3 class=\"heading settled\" data-level=\"8.3\" id=\"header-secure-session-response\"><span class=\"secno\">8.3. </span><span class=\"content\">`<code>Secure-Session-Response</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-response\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Response`\" id=\"secure-session-response-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Response`</code></dfn> header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑤\">request</a> by the user agent to send a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑤\">DBSC proof</a> to the server to prove\nthat the client is still in possession of the private key of the session key. \n     <p><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#secure-session-response-header\" id=\"ref-for-secure-session-response-header\"><code>`Secure-Session-Response`</code></a> is a structured\nheader. Its value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②①\">sf-string</a></pre>\n     <p>This string MUST only contain the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑥\">DBSC proof</a> JWT. Any <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①①\">sf-parameter</a>s SHOULD be\nignored.</p>\n     \n     <h3 class=\"heading settled\" data-level=\"8.4\" id=\"header-sec-secure-session-id\"><span class=\"secno\">8.4. </span><span class=\"content\">`<code>Sec-Secure-Session-Id</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-secure-session-id\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Sec-Secure-Session-Id`\" id=\"sec-secure-session-id-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Sec-Secure-Session-Id`</code></dfn> header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑥\">request</a> by the user agent to request the current session is refreshed, \nwith the current session identifier as a string argument. \n     <p>`<code><a data-link-type=\"http-header\">Sec-Secure-Session-Id</a></code>` is a structured header.\nIts value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionIdentifier = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②②\">sf-string</a></pre>\n     <p>This string MUST only contain the session identifier. Any parameters SHOULD be\nignored.</p>\n     \n     <h3 class=\"heading settled\" data-level=\"8.5\" id=\"header-secure-session-skipped\"><span class=\"secno\">8.5. </span><span class=\"content\">`<code>Secure-Session-Skipped</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-skipped\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Skipped`\" id=\"secure-session-skipped-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Skipped`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦\">request</a> to indicate that the request is intentionally missing bound\ncredentials due to user agent policy. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Skipped</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Secure-Session-Skipped = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list⑦\">sf-list</a></pre>\n     <p>Each item in the list must be MUST be an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token④\">sf-token</a> representing a\ncoarse-grained reason for skipping cookie refresh. The only supported values\nare: \"unreachable\", \"server_error\", and \"quota_exceeded\".</p>\n     <p>One <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①②\">sf-parameter</a> is defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①③\">sf-parameter</a> whose key is \"session_identifier\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②③\">sf-string</a>, conveying the identifier of the skipped session.</p>\n     </li></ul>\n     \n     <h3 class=\"heading settled\" data-level=\"8.6\" id=\"format-session-instructions\"><span class=\"secno\">8.6. </span><span class=\"content\">JSON Session Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-instructions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session instructions</dfn> during session\nregistration and optionally during session refresh. If the response\ncontains session instructions, it MUST be in JSON format. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">session identifier\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a> representing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑥\">session identifier</a>.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions\">JSON session instructions</a> is sent during a refresh request this MUST be\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑦\">session identifier</a> for the current session. If\nnot these instructions SHOULD be ignored.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions①\">JSON session instructions</a> is sent during a registration it MUST either\nbe a unique identifier for this <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①①\">registrable domain</a>, or it will\noverwrite the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session⑤\">device bound session</a> with this identifier for the\ncurrent <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①②\">registrable domain</a>.\nThis key MUST be present.</p>\n      </dd><dt data-md=\"\">refresh_url\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑤\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a> used for future refresh requests.\nThis can be a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑨\">URL</a>, or relative to the current <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑧\">request</a>.\nThis key is OPTIONAL; if not present the registration URL will be used for\nfuture refresh requests.</p>\n      </dd><dt data-md=\"\">continue\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②\">boolean</a> indicating if the session should continue to apply.\nRegistration and refresh endpoints can set this to false to terminate a session.\nThis key is OPTIONAL, and if not present, the default value will be true.</p>\n      </dd><dt data-md=\"\">scope\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope\" id=\"ref-for-json-session-scope\">JSON session scope</a> describing the request destinations covered by\nthe session. This field MUST be present.</p>\n      </dd><dt data-md=\"\">credentials\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-credentials\" id=\"ref-for-json-session-credentials①\">JSON session credentials</a> describing the cookies protected by\nthis session. This field MUST be present.</p>\n      </dd><dt data-md=\"\">allowed_refresh_initiators\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑥\">strings</a> describing which hosts are allowed to initiate\nDBSC refreshes due to non-CORS requests. See <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-request-allows-refresh\">§ 7.3 Identify if a request is allowed to refresh</a> for details.</p>\n     </dd></dl>\n     \n     <h3 class=\"heading settled\" data-level=\"8.7\" id=\"format-session-scope-instructions\"><span class=\"secno\">8.7. </span><span class=\"content\">JSON Session Scope Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-scope-instructions\"></a></h3>\n      The server sends a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-scope\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session scope</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions②\">JSON session instructions</a> during registration and optionally during session refresh. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">origin\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑦\">string</a> indicating the origin or site that the session applies to.\nThis key is OPTIONAL; if not present, the origin of the URL serving the\ninstructions will be used. This is the registration URL during registration\nand the refresh URL during refresh.</p>\n      </dd><dt data-md=\"\">include_site\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③\">boolean</a> indicating if the session is origin-scoped (false) or\nsite-scoped (true). This key is MANDATORY. Note that this takes precedence\nover any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules\">JSON session scope rules</a> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification\" id=\"ref-for-scope-specification①\">scope specification</a> (see <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a>).</p>\n      </dd><dt data-md=\"\">scope_specification\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules①\">JSON session scope rules</a> describing modifications to the\ndefault scope (the entire origin or site). This key is OPTIONAL; if not\npresent, an empty list will be used.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.8\" id=\"format-session-scope-rule\"><span class=\"secno\">8.8. </span><span class=\"content\">JSON Session Scope Rule Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-scope-rule\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-scope-rules\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session scope rules</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope\" id=\"ref-for-json-session-scope①\">JSON session scope</a> during registration and optionally during session refresh. \n     <p>At the root of each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules②\">JSON session scope rule</a>, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">type\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑧\">string</a> indicating whether the rule includes or excludes destinations.\nThis key MUST be present, and the value MUST be \"include\" or \"exclude\".</p>\n      </dd><dt data-md=\"\">domain\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑨\">string</a> indicating the domains that should match the rule. This key\nis OPTIONAL; if not present, it will be '*', matching all domains. This can\ninclude wildcards (see <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a>).</p>\n      </dd><dt data-md=\"\">path\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⓪\">string</a> indicating the path-prefixes that should match the rule. This\nkey is OPTIONAL; if not present, it will be '/', matching all paths. See <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a> for the detailed semantics.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.9\" id=\"format-session-credentials\"><span class=\"secno\">8.9. </span><span class=\"content\">JSON Session Credentials Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-credentials\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-credentials\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session credentials</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions③\">JSON session instructions</a> during registration and optionally during session refresh. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">type\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③①\">string</a> indicating the kind of credential protected by this session.\nThis key MUST be present, and the value MUST be \"cookie\".</p>\n      </dd><dt data-md=\"\">name\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③②\">string</a> indicating the name of the bound cookie.</p>\n      </dd><dt data-md=\"\">attributes\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③③\">string</a> containing the expected attributes of the protected cookie.\nSee <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-missing-session-credential\">§ 7.6 Identify missing session credential</a> for details on how this\nis used.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.10\" id=\"format-jwt\"><span class=\"secno\">8.10. </span><span class=\"content\">DBSC Proof JWT Syntax</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-jwt\"></a></h3>\n      A <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DBSC proof</dfn> proof is a JWT that is signed (using JSON Web Signature\n(JWS)), with a private key chosen by the client. The header of a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑦\">DBSC proof</a> MUST contain at least the following <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①④\">sf-parameter</a>s: \n     <dl>\n      <dt data-md=\"\">typ\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③④\">string</a> MUST be \"dbsc+jwt\"</p>\n      </dd><dt data-md=\"\">alg\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑤\">string</a> defining the algorithm used to sign this JWT. It MUST be\neither \"RS256\" or \"ES256\" from [IANA.JOSE.ALGS].</p>\n     </dd></dl>\n     <p>The payload of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑧\">DBSC proof</a> MUST contain at least the following claims:</p>\n     <dl>\n      <dt data-md=\"\">aud\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑥\">string</a>, MUST be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⓪\">URL</a> this JWT was originally sent to.\nExample: \"https://example.com/refresh.html\"</p>\n      </dd><dt data-md=\"\">jti\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑦\">string</a>, a copy of the challenge value sent in the registration\nheader.</p>\n      </dd><dt data-md=\"\">iat\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑧\">string</a>, this claim identifies the time at which the JWT was\nissued.  This claim can be used to determine the age of the JWT.  Its\nvalue MUST be a number containing a NumericDate value.</p>\n      </dd><dt data-md=\"\">key\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑨\">string</a> defining a JWK as specified in [rfc7517].</p>\n     </dd></dl>\n     <p>In addition the following claims MUST be present if present in\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>`:</p>\n     <dl>\n      <dt data-md=\"\">authorization\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⓪\">string</a>, direct copy of the string from\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>`, if set there. Note that this string is\nOPTIONAL to include in the header, but if it is present it is\nMANDATORY for clients to add the claim in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑨\">DBSC proof</a>.</p>\n     </dd></dl>\n     <p>If the DBSC proof is for a refresh request, the following claim MUST be\npresent:</p>\n     <dl>\n      <dt data-md=\"\">sub\n      </dt><dd data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑧\">session identifier</a>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④①\">string</a>.</p>\n     </dd></dl>\n     \n     <h2 class=\"heading settled\" data-level=\"9\" id=\"changes-to-other-specifications\"><span class=\"secno\">9. </span><span class=\"content\">Changes to other specifications</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-other-specifications\"></a></h2>\n     <h3 class=\"heading settled\" data-level=\"9.1\" id=\"changes-to-fetch\"><span class=\"secno\">9.1. </span><span class=\"content\">Changes to the Fetch specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-fetch\"></a></h3>\n     <p>This specification requires an update to the <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\nfetch</a> algorithm. A <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑨\">request</a> has a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-lt=\"deferred device bound session ids\" data-noexport=\"\" id=\"request-deferred-device-bound-session-ids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deferred device\nbound session ids</dfn>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①\">tuples</a> consisting of:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>a domain (a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①③\">registrable domain</a>).</p>\n      </li><li data-md=\"\">\n       <p>a session id (a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④②\">string</a>).</p>\n     </li></ul>\n     This list is initially empty. After computing cookies in step 8.21, run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session-needing-refresh\">§ 7.5 Identify session needing refresh</a>. If the resulting <var>session</var> is non-null: \n     \n     <h3 class=\"heading settled\" data-level=\"9.2\" id=\"changes-to-clear-site-data\"><span class=\"secno\">9.2. </span><span class=\"content\">Changes to the Clear Site Data specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-clear-site-data\"></a></h3>\n     <p>This specification requires that the Clear Site Data specification\nsections 4.2.5 \"Clear DOM-accessible storage for origin\" clear all\ndevice bound sessions whose scope matches origin. It also requires an\nupdate to 4.2.4 to clear device bound sessions for the site matching the\nregistered domain.</p>\n     <h2 class=\"heading settled\" data-level=\"10\" id=\"iana-considerations\"><span class=\"secno\">10. </span><span class=\"content\">IANA Considerations</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-considerations\"></a></h2>\n     <p>The permanent message header field registry should be updated with the following\nregistrations: <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc3864\" title=\"Registration Procedures for Message Header Fields\">[RFC3864]</a></p>\n     <h3 class=\"heading settled\" data-level=\"10.1\" id=\"iana-ses-session-challenge\"><span class=\"secno\">10.1. </span><span class=\"content\">Secure-Session-Challenge</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-challenge\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Challenge\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-challenge\">§ 8.2 `Secure-Session-Challenge` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.2\" id=\"iana-sec-secure-session-id\"><span class=\"secno\">10.2. </span><span class=\"content\">Sec-Secure-Session-Id</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-sec-secure-session-id\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Sec-Secure-Session-Id\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-secure-session-id\">§ 8.4 `Sec-Secure-Session-Id` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.3\" id=\"iana-secure-session-registration\"><span class=\"secno\">10.3. </span><span class=\"content\">Secure-Session-Registration</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-registration\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Registration\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-registration\">§ 8.1 `Secure-Session-Registration` HTTP header field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.4\" id=\"iana-secure-session-response\"><span class=\"secno\">10.4. </span><span class=\"content\">Secure-Session-Response</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-response\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Response\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-response\">§ 8.3 `Secure-Session-Response` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.5\" id=\"iana-secure-session-skipped\"><span class=\"secno\">10.5. </span><span class=\"content\">Secure-Session-Skipped</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-skipped\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Skipped\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-skipped\">§ 8.5 `Secure-Session-Skipped` HTTP header field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.6\" id=\"well-known\"><span class=\"secno\">10.6. </span><span class=\"content\">device-bound-sessions Well Known</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#well-known\"></a></h3>\n     <p>The Well-Known URI registry should be updated to include\n/.well-known/device-bound-sessions.</p>\n     <p>This endpoint must serve a JSON-encoded dictionary. Two keys are defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>\"registering_origins\" is a list of strings. It contains origins that\nare allowed to register sessions for an entire site.</p>\n      </li><li data-md=\"\">\n       <p>\"relying_origins\" is a list of strings. It contains origins that are\nallowed to be the Relying Party (RP) when sharing keys with this\nsite’s sessions.</p>\n      </li><li data-md=\"\">\n       <p>\"provider_origin\" is an optional string. It contains the origin of the Session\nProvider when this origin is being used as a Relying Party.</p>\n     </li></ul>\n     \n     <h2 class=\"heading settled\" data-level=\"11\" id=\"changelog\"><span class=\"secno\">11. </span><span class=\"content\">Changelog</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changelog\"></a></h2>\n      This is an early draft of the spec. \n     <h2 class=\"heading settled\" data-level=\"12\" id=\"acknowledgements\"><span class=\"secno\">12. </span><span class=\"content\">Acknowledgements</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#acknowledgements\"></a></h2>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The user agent MAY skip this request in order to prevent denial of service for\n the user or site. For example, this might happen if this session is\n requesting excessive TPM operations (harming the user) or the refresh\n endpoint has recently been unreachable (denial of service risk for the\n site). If the user agent chooses to do this, it should perform the steps of <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-add-debug-header\">§ 7.11 Add debug header</a> with <var>originating request</var>, an appropriate token (see\n options in <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-skipped\">§ 8.5 `Secure-Session-Skipped` HTTP header field</a>), and <var>session id</var> to indicate this to the site.</p>"
        },
        {
          "html": "Let <var>terminate the session</var> be an algorithm with the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session id</var> is null, return.</p>"
            },
            {
              "html": "<p>Remove the session with domain <var>destination</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host④\">host</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑧\">registrable domain</a> and identifier <var>session id</var> from the\n user agent’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-store\" id=\"ref-for-session-store②\">session store</a>, if such a session if found.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>originating request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url②\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site②\">same site</a> with <var>destination</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④\">origin</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>signed challenge</var> be null. If <var>challenge</var> is non-null, create\n a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof①\">DBSC proof</a>, sign it with <var>key pair</var>, and store the result\n in <var>signed challenge</var>.</p>"
        },
        {
          "html": "<p>Create a <var>request</var> for use in <a href=\"https://fetch.spec.whatwg.org/#http-fetch\">HTTP fetch</a>.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a> to \"POST\".</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url③\">URL</a> to <var>destination</var>.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode\">redirect mode</a> to \"follow\".</p>"
        },
        {
          "html": "<p>If <var>signed challenge</var> is non-null, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append\">append</a> the header\n (\"Secure-Session-Response\", <var>signed challenge</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>authorization</var> is non-null, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①\">append</a> the header\n (\"Authorization\", <var>authorization</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator\">initiator</a> to <var>originating request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator①\">initiator</a>.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of running <a href=\"https://fetch.spec.whatwg.org/#http-fetch\">HTTP fetch</a> for <var>request</var>.</p>"
        },
        {
          "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a>, or <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status\">status</a> is 407 or 429, return.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①\">status</a> is at least 300 and below 400, then\n return.</p>"
        },
        {
          "html": "If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②\">status</a> is 403:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session id</var> is null, return.</p>"
            },
            {
              "html": "<p>Let <var>session</var> be the result of running the steps of <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session\">§ 7.1 Identify session</a> on <var>destination</var> and <var>session id</var>.</p>"
            },
            {
              "html": "<p>If <var>session</var> is null, return.</p>"
            },
            {
              "html": "<p>Otherwise, restart this algorithm with the original inputs, except\n replacing <var>challenge</var> with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge②\">cached challenge</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status③\">status</a> is at least 400 and below 500,\n then <var>terminate the session</var> and return.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status④\">status</a> is at least 500, then\n return. User agents may choose to trigger a backoff mechanism on\n subsequent refresh requests on this session, to limit the harm of a\n temporary outage on the refresh endpoint.</p>"
        },
        {
          "html": "<p>If <var>session id</var> is non-null, and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body\">body</a> is\n empty, return.</p>"
        },
        {
          "html": "<p>Parse <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①\">body</a> according to <a href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\">§ 8.6 JSON Session Instruction Format</a>. If parsing fails, <var>terminate the\n session</var> and return.</p>"
        },
        {
          "html": "<p>Let <var>session identifier</var> be the value of key \"session_identifier\".</p>"
        },
        {
          "html": "<p>If the <var>response</var> JSON contains the key \"continue\", with value \"false\", <var>terminate the session</var> and return.</p>"
        },
        {
          "html": "Otherwise, perform the following validations. If any fail, <var>terminate the session</var> and return.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p><var>session identifier</var> must be non-empty.</p>"
            },
            {
              "html": "<p>If <var>session id</var> is non-null, it must match <var>session identifier</var>.</p>"
            },
            {
              "html": "<p>The value of the key \"refresh_url\" must be non-empty.</p>"
            },
            {
              "html": "<p>Let <var>origin</var> be an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑤\">origin</a> constructed from the value of the key\n \"scope.origin\", if present, or the origin of <var>destination</var> if\n not.</p>"
            },
            {
              "html": "<p><var>origin</var> must be a valid non-opaque origin.</p>"
            },
            {
              "html": "<p><var>origin</var> must be <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site③\">same site</a> with <var>destination</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥\">origin</a>.</p>"
            },
            {
              "html": "<p>Let <var>refresh URL</var> be the result of resolving <var>destination</var> with the value\n of the key \"refresh_url\".</p>"
            },
            {
              "html": "<p><var>refresh URL</var> must have scheme HTTPS or be localhost.</p>"
            },
            {
              "html": "<p><var>refresh URL</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦\">origin</a> must be <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site④\">same site</a> with <var>destination</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑧\">origin</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>destination domain</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑨\">registrable domain</a> of <var>destination</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host⑤\">host</a>.</p>"
        },
        {
          "html": "If the value of the key \"scope.include_site\" in <var>response</var> is true,\n perform the following validations. If any fail, <var>terminate the\n session</var> and return.",
          "rationale": "if",
          "steps": [
            {
              "html": "<p><var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-domain\" id=\"ref-for-concept-origin-domain\">domain</a> must be equal to <var>destination domain</var>.</p>"
            },
            {
              "html": "<p>If <var>destination domain</var> is equal to the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host⑥\">host</a> of <var>destination</var>, skip all remaining validations.</p>"
            },
            {
              "html": "<p>Otherwise, let <var>well known URL</var> be a copy of <var>destination</var>, with the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host⑦\">host</a> replaced with <var>destination domain</var>, and the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path③\">path</a> replaced with \"/.well-known/device-bound-sessions\".</p>"
            },
            {
              "html": "<p>Let <var>well known response</var> be the result of fetching <var>well known URL</var>.</p>"
            },
            {
              "html": "<p><var>well known response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑤\">status</a> must be 200.</p>"
            },
            {
              "html": "<p><var>well known response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②\">body</a> must be a JSON-encoded\n dictionary.</p>"
            },
            {
              "html": "<p><var>well known response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body③\">body</a> must include the key \"registering_origins\".</p>"
            },
            {
              "html": "<p>The value of the key \"registering_origins\" must include the origin of <var>destination</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>session</var> be a new session with:</p>",
          "ignored": [
            "session identifier set to session identifier. refresh URL set to refresh URL. session scope a new scope with origin origin, include site the value of the key \"scope.include_site\", and scope specifications the value of the key \"scope.scope_specification\". session credentials the value of the key \"credentials\". session key set to key pair. allowed refresh initiators the value of the key \"allowed_refresh_initiators\". expiration timestamp set to a future timestamp. The exact choice of expiration timestamp is left up to the user agent. It is recommended to align with the maximum cookie lifetime."
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>credential</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-credentials\" id=\"ref-for-device-bound-session-session-credentials③\">session credentials</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If a cookie with <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential-attributes\" id=\"ref-for-session-credential-attributes③\">attributes</a> could\n not be set by <var>response</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#cookie\">section 5.3</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①②\">continue</a>.</p>"
            },
            {
              "html": "<p>Call <var>terminate the session</var> to remove the existing session.</p>"
            },
            {
              "html": "<p>Set the user agent’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-store\" id=\"ref-for-session-store③\">session store</a>[<var>destination\n domain</var>][<var>session identifier</var>] to <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">Break</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new session</dfn> due to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> (<var>response</var>) to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> (<var>request</var>), do the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>header name</var> be \"<code>Secure-Session-Registration</code>\".</p>"
        },
        {
          "html": "<p>Let <var>registration list</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header①\">get a structured\nfield value</a> given <var>header name</var> and \"list\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>registration list</var> is null, return.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>registration entry</var>, <var>params</var> → <var>registration list</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>registration entry</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#inner-list\" id=\"ref-for-inner-list\">sf-inner-list</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①③\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"path\"] does not exist, or is not of type <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①①\">sf-string</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①④\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>path</var> be <var>params</var>[\"path\"].</p>"
            },
            {
              "html": "<p>Let <var>challenge</var> be null, and Let <var>authorization</var> be null.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"challenge\"] exists and is of type <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①②\">sf-string</a> Set <var>challenge</var> to <var>params</var>[\"challenge\"].</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"authorization\"] exists and is a string Set <var>authorization</var> to <var>params</var>[\"authorization\"].</p>"
            },
            {
              "html": "<p>Let <var>endpoint</var> be the result of resolving <var>path</var> relative to the <var>response</var>’s URL.</p>"
            },
            {
              "html": "<p>Let <var>key pair</var> be the result of running <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session-key\">§ 7.10 Create session key</a> on <var>registration entry</var>, <var>params</var>, and <var>endpoint</var>.</p>"
            },
            {
              "html": "<p>If <var>key pair</var> is null, return.</p>"
            },
            {
              "html": "<p>Call <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-session-request\">§ 7.8 Send request</a> with <var>request</var>, <var>key pair</var>, <var>endpoint</var>, null\n session identifier, <var>challenge</var> and <var>authorization</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create a session key\" id=\"create-session-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a\nsession key</dfn>, including key sharing between a Relying Party and Session\nProvider. It takes as input the <var>registration entry</var> and <var>params</var> of a\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>` header, and the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a> (<var>registration URL</var>) of\nthe registration endpoint. It returns a key pair for use in the session or null\nif no key is possible.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>algorithm list</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>algorithm</var> → <var>registration entry</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>algorithm</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token\">sf-token</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>algorithm</var> represents a crypto algorithm supported in\n `<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>`, and is supported on this client,\n add <var>algorithm</var> to <var>algorithm list</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>algorithm list</var> is empty, return null.</p>"
        },
        {
          "html": "If any of <var>params</var>[\"provider_key\"], <var>params</var>[\"provider_id\"], or <var>params</var>[\"provider_url\"] exists:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If any of the three keys is missing, return null.</p>"
            },
            {
              "html": "<p>Let <var>permission</var> be the result of performing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dfn-request-permission-to-use\" id=\"ref-for-dfn-request-permission-to-use\">request permission to use</a> for \"device-bound-session-key-sharing\".</p>"
            },
            {
              "html": "<p>If <var>permission</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/permissions/#dom-permissionstate-denied\" id=\"ref-for-dom-permissionstate-denied\">\"denied\"</a></code>, return null.</p>"
            },
            {
              "html": "<p>Let <var>provider URL</var> be a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑤\">URL</a> constructed from <var>params</var>[\"provider_url\"].</p>"
            },
            {
              "html": "<p>Let <var>provider origin</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a> of <var>provider URL</var>.</p>"
            },
            {
              "html": "<p>If <var>provider origin</var> is opaque, return null.</p>"
            },
            {
              "html": "<p>Let <var>provider domain</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①⓪\">registrable domain</a> of <var>provider URL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host⑧\">host</a>.</p>"
            },
            {
              "html": "<p>Let <var>provider identifier</var> be <var>params</var>[\"provider_id\"].</p>"
            },
            {
              "html": "<p>Let <var>provider session</var> be the session in the user agent’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-store\" id=\"ref-for-session-store④\">session store</a>[<var>provider domain</var>][<var>provider identifier</var>].</p>"
            },
            {
              "html": "<p>If <var>provider session</var> is null, return null.</p>"
            },
            {
              "html": "<p>If <var>provider session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-scope\" id=\"ref-for-device-bound-session-session-scope⑥\">session scope</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin⑤\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> with <var>provider\n origin</var>, return null.</p>"
            },
            {
              "html": "<p>If <var>provider session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-key\" id=\"ref-for-device-bound-session-session-key①\">session key</a> does not match <var>params</var>[\"provider_key\"], return null.</p>"
            },
            {
              "html": "<p>Let <var>provider well known URL</var> be a copy of <var>provider URL</var>, with the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path④\">path</a> replaced with \"/.well-known/device-bound-sessions\".</p>"
            },
            {
              "html": "<p>Let <var>provider well known response</var> be the result of fetching <var>provider\n well known URL</var>. If any of the following hold, return null:</p>",
              "ignored": [
                "provider well known response’s status is not 200. provider well known response’s body is not a JSON-encoded dictionary. provider well known response’s body contains the key \"provider_origin\". provider well known response’s body does not include the key \"relying_origins\". The value of the key \"relying_origins\" does not include the origin of registration URL."
              ]
            },
            {
              "html": "<p>User agents SHOULD place an upper limit on the number of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#registrable-origin-label\" id=\"ref-for-registrable-origin-label①\">registrable origin labels</a> in \"relying_origins\" to prevent\n abuse.</p>"
            },
            {
              "html": "<p>Let <var>relying well known URL</var> be a copy of <var>registration URL</var>, with the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path⑤\">path</a> replaced with \"/.well-known/device-bound-sessions\".</p>"
            },
            {
              "html": "<p>Let <var>relying well known response</var> be the result of fetching <var>relying well\n known URL</var>. If any of the following hold, return null:</p>",
              "ignored": [
                "relying well known response’s status is not 200. relying well known response’s body is not a JSON-encoded dictionary. relying well known response’s body contains the key \"relying_origins\". relying well known response’s body does not include the key \"provider_origin\". The value of the key \"provider origin\" is not the origin of provider URL."
              ]
            },
            {
              "html": "<p>Return <var>provider session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-key\" id=\"ref-for-device-bound-session-session-key②\">session key</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return a new key pair created for <var>algorithm list</var>.</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "In order for sites to understand when the user agent chooses not to\napply a session, user agents should <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"add-debug-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add the debug header</dfn> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">request</a> (<var>request</var>) with an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token①\">sf-token</a> (<var>token</var>) and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①③\">string</a> (<var>session id</var>).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token②\">sf-token</a> with value <var>token</var>.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters\">sf-parameter</a> \"session_identifier\" on <var>value</var> to <var>session id</var>.</p>"
        },
        {
          "html": "<p>Let <var>skipped header value</var> be the result of running the steps of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header②\">get a structured field value</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name\">header name</a> \"Secure-Session-Skipped\", type \"list\", and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>skipped header value</var> is null, set it to an empty <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list⑤\">sf-list</a>.</p>"
        },
        {
          "html": "<p>Append <var>value</var> to <var>skipped header value</var>.</p>"
        },
        {
          "html": "<p>Run the steps of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header\" id=\"ref-for-concept-header-list-set-structured-header\">set a structured field value</a> given\n(\"Secure-Session-Skipped\", <var>skipped header value</var>) on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④\">header list</a>.</p>"
        }
      ]
    },
    {
      "name": "request-allows-refresh",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"send a request\" id=\"algorithms-send-a-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send\n  a request</dfn> for a device bound session registration or refresh. It\n  takes as input an <var>originating request</var>, <var>key pair</var>, <var>destination</var>,\n  and optional <var>session id</var>, <var>challenge</var>, and <var>authorization</var>. \n     \n     <h3 class=\"heading settled\" data-level=\"7.9\" id=\"algo-create-session\"><span class=\"secno\">7.9. </span><span class=\"content\">Create session</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"process-registration\">\n       To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new session</dfn> due to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> (<var>response</var>) to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> (<var>request</var>), do the following steps: \n      \n     </div>\n     <h3 class=\"heading settled\" data-level=\"7.10\" id=\"algo-create-session-key\"><span class=\"secno\">7.10. </span><span class=\"content\">Create session key</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session-key\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"create-session-key\">\n      <p>This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create a session key\" id=\"create-session-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a\nsession key</dfn>, including key sharing between a Relying Party and Session\nProvider. It takes as input the <var>registration entry</var> and <var>params</var> of a\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>` header, and the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a> (<var>registration URL</var>) of\nthe registration endpoint. It returns a key pair for use in the session or null\nif no key is possible.</p>\n      \n     </div>\n     <h3 class=\"heading settled\" data-level=\"7.11\" id=\"algo-add-debug-header\"><span class=\"secno\">7.11. </span><span class=\"content\">Add debug header</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-add-debug-header\"></a></h3>\n     <div class=\"algorithm\" data-algorithm=\"add-debug-header\">\n       In order for sites to understand when the user agent chooses not to\napply a session, user agents should <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"add-debug-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add the debug header</dfn> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">request</a> (<var>request</var>) with an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token①\">sf-token</a> (<var>token</var>) and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①③\">string</a> (<var>session id</var>). \n      \n     </div>\n     <h2 class=\"heading settled\" data-level=\"8\" id=\"format\"><span class=\"secno\">8. </span><span class=\"content\">DBSC Formats</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format\"></a></h2>\n     <h3 class=\"heading settled\" data-level=\"8.1\" id=\"header-secure-session-registration\"><span class=\"secno\">8.1. </span><span class=\"content\">`<code>Secure-Session-Registration</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-registration\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Registration`\" id=\"secure-session-registration-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Registration`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> by the server to start a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session④\">device bound session</a> on the\nclient. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Secure-Session-Registration = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list⑥\">sf-list</a></pre>\n     <p>Each item in the list must be an inner list, and each item in the inner list\nMUST be an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token③\">sf-token</a> representing a supported algorithm (ES256, RS256).\nOnly these two values are currently supported.</p>\n     <p>The following <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①\">sf-parameter</a>s are defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters②\">sf-parameter</a> whose key is \"path\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①④\">sf-string</a>, conveying the path to the registration endpoint. This may be\nrelative to the current <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a>, or a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a>. Entries without this\nparameter will be ignored in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\">§ 7.9 Create session</a>.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters③\">sf-parameter</a> whose key is \"challenge\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑤\">sf-string</a>, conveying the challenge to be used in the session\nregistration.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters④\">sf-parameter</a> whose key is \"authorization\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑥\">sf-string</a>. This <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑤\">sf-parameter</a> will be copied into the\nregistration JWT.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑥\">sf-parameter</a> whose key is \"provider_key\", and whose value is\nan <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑦\">sf-string</a>, conveying that this session should share keys\nwith a session with the given public key.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑦\">sf-parameter</a> whose key is \"provider_id\", and whose value is\nan <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑧\">sf-string</a>, conveying that this session should share keys\nwith a session with the given session identifier.</p>\n      </li><li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑧\">sf-parameter</a> whose key is \"provider_url\", and whose value\nis an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⑨\">sf-string</a>, conveying that this session should share keys\nwith a session on that site.</p>\n     </li></ul>\n     \n     <h3 class=\"heading settled\" data-level=\"8.2\" id=\"header-secure-session-challenge\"><span class=\"secno\">8.2. </span><span class=\"content\">`<code>Secure-Session-Challenge</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-challenge\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Challenge`\" id=\"secure-session-challenge-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Challenge`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> by the server to send a challenge to the client that it expects to\nbe used in future Secure-Session-Response headers inside the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof②\">DBSC proof</a>, or to\nrequest a newly signed <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof③\">DBSC proof</a> right away if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑧\">status</a> is 403. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` is a structured header. Its value must be a string.\nIts ABNF is: </p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②⓪\">sf-string</a></pre>\n      The semantics of the item are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\">§ 8.2.1 `Secure-Session-Challenge` structured header serialization</a>.\n     <p></p>\n     <p>The processing steps are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-process-challenge\">§ 7.7 Cache challenge</a>.</p>\n     <h4 class=\"heading settled\" data-level=\"8.2.1\" id=\"challenge-structured-header-serialization\"><span class=\"secno\">8.2.1. </span><span class=\"content\">`<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` structured header serialization</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\"></a></h4>\n      The `<code><a data-link-type=\"http-header\">Secure-Session-Challenge</a></code>` is represented as a Structured Field.<a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a> \n     <p>In this representation, a challenge is represented by a string.</p>\n     <p>Challenges MAY have an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters⑨\">sf-parameter</a> named <code>\"id\"</code>, whose value MUST be a String\nrepresenting a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑤\">session identifier</a>. Any other <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①⓪\">sf-parameter</a>s SHOULD be ignored.</p>\n     \n     \n     <h3 class=\"heading settled\" data-level=\"8.3\" id=\"header-secure-session-response\"><span class=\"secno\">8.3. </span><span class=\"content\">`<code>Secure-Session-Response</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-response\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Response`\" id=\"secure-session-response-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Response`</code></dfn> header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑤\">request</a> by the user agent to send a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑤\">DBSC proof</a> to the server to prove\nthat the client is still in possession of the private key of the session key. \n     <p><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#secure-session-response-header\" id=\"ref-for-secure-session-response-header\"><code>`Secure-Session-Response`</code></a> is a structured\nheader. Its value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②①\">sf-string</a></pre>\n     <p>This string MUST only contain the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑥\">DBSC proof</a> JWT. Any <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①①\">sf-parameter</a>s SHOULD be\nignored.</p>\n     \n     <h3 class=\"heading settled\" data-level=\"8.4\" id=\"header-sec-secure-session-id\"><span class=\"secno\">8.4. </span><span class=\"content\">`<code>Sec-Secure-Session-Id</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-secure-session-id\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Sec-Secure-Session-Id`\" id=\"sec-secure-session-id-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Sec-Secure-Session-Id`</code></dfn> header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑥\">request</a> by the user agent to request the current session is refreshed, \nwith the current session identifier as a string argument. \n     <p>`<code><a data-link-type=\"http-header\">Sec-Secure-Session-Id</a></code>` is a structured header.\nIts value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionIdentifier = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②②\">sf-string</a></pre>\n     <p>This string MUST only contain the session identifier. Any parameters SHOULD be\nignored.</p>\n     \n     <h3 class=\"heading settled\" data-level=\"8.5\" id=\"header-secure-session-skipped\"><span class=\"secno\">8.5. </span><span class=\"content\">`<code>Secure-Session-Skipped</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-skipped\"></a></h3>\n      The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"`Secure-Session-Skipped`\" id=\"secure-session-skipped-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>`Secure-Session-Skipped`</code></dfn> header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦\">request</a> to indicate that the request is intentionally missing bound\ncredentials due to user agent policy. \n     <p>`<code><a data-link-type=\"http-header\">Secure-Session-Skipped</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Secure-Session-Skipped = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list⑦\">sf-list</a></pre>\n     <p>Each item in the list must be MUST be an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token④\">sf-token</a> representing a\ncoarse-grained reason for skipping cookie refresh. The only supported values\nare: \"unreachable\", \"server_error\", and \"quota_exceeded\".</p>\n     <p>One <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①②\">sf-parameter</a> is defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>An <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①③\">sf-parameter</a> whose key is \"session_identifier\", and whose value is an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string②③\">sf-string</a>, conveying the identifier of the skipped session.</p>\n     </li></ul>\n     \n     <h3 class=\"heading settled\" data-level=\"8.6\" id=\"format-session-instructions\"><span class=\"secno\">8.6. </span><span class=\"content\">JSON Session Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-instructions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session instructions</dfn> during session\nregistration and optionally during session refresh. If the response\ncontains session instructions, it MUST be in JSON format. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">session identifier\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a> representing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑥\">session identifier</a>.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions\">JSON session instructions</a> is sent during a refresh request this MUST be\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑦\">session identifier</a> for the current session. If\nnot these instructions SHOULD be ignored.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions①\">JSON session instructions</a> is sent during a registration it MUST either\nbe a unique identifier for this <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①①\">registrable domain</a>, or it will\noverwrite the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session⑤\">device bound session</a> with this identifier for the\ncurrent <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①②\">registrable domain</a>.\nThis key MUST be present.</p>\n      </dd><dt data-md=\"\">refresh_url\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑤\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a> used for future refresh requests.\nThis can be a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑨\">URL</a>, or relative to the current <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑧\">request</a>.\nThis key is OPTIONAL; if not present the registration URL will be used for\nfuture refresh requests.</p>\n      </dd><dt data-md=\"\">continue\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②\">boolean</a> indicating if the session should continue to apply.\nRegistration and refresh endpoints can set this to false to terminate a session.\nThis key is OPTIONAL, and if not present, the default value will be true.</p>\n      </dd><dt data-md=\"\">scope\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope\" id=\"ref-for-json-session-scope\">JSON session scope</a> describing the request destinations covered by\nthe session. This field MUST be present.</p>\n      </dd><dt data-md=\"\">credentials\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-credentials\" id=\"ref-for-json-session-credentials①\">JSON session credentials</a> describing the cookies protected by\nthis session. This field MUST be present.</p>\n      </dd><dt data-md=\"\">allowed_refresh_initiators\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑥\">strings</a> describing which hosts are allowed to initiate\nDBSC refreshes due to non-CORS requests. See <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-request-allows-refresh\">§ 7.3 Identify if a request is allowed to refresh</a> for details.</p>\n     </dd></dl>\n     \n     <h3 class=\"heading settled\" data-level=\"8.7\" id=\"format-session-scope-instructions\"><span class=\"secno\">8.7. </span><span class=\"content\">JSON Session Scope Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-scope-instructions\"></a></h3>\n      The server sends a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-scope\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session scope</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions②\">JSON session instructions</a> during registration and optionally during session refresh. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">origin\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑦\">string</a> indicating the origin or site that the session applies to.\nThis key is OPTIONAL; if not present, the origin of the URL serving the\ninstructions will be used. This is the registration URL during registration\nand the refresh URL during refresh.</p>\n      </dd><dt data-md=\"\">include_site\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③\">boolean</a> indicating if the session is origin-scoped (false) or\nsite-scoped (true). This key is MANDATORY. Note that this takes precedence\nover any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules\">JSON session scope rules</a> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification\" id=\"ref-for-scope-specification①\">scope specification</a> (see <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a>).</p>\n      </dd><dt data-md=\"\">scope_specification\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules①\">JSON session scope rules</a> describing modifications to the\ndefault scope (the entire origin or site). This key is OPTIONAL; if not\npresent, an empty list will be used.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.8\" id=\"format-session-scope-rule\"><span class=\"secno\">8.8. </span><span class=\"content\">JSON Session Scope Rule Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-scope-rule\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-scope-rules\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session scope rules</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope\" id=\"ref-for-json-session-scope①\">JSON session scope</a> during registration and optionally during session refresh. \n     <p>At the root of each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-scope-rules\" id=\"ref-for-json-session-scope-rules②\">JSON session scope rule</a>, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">type\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑧\">string</a> indicating whether the rule includes or excludes destinations.\nThis key MUST be present, and the value MUST be \"include\" or \"exclude\".</p>\n      </dd><dt data-md=\"\">domain\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑨\">string</a> indicating the domains that should match the rule. This key\nis OPTIONAL; if not present, it will be '*', matching all domains. This can\ninclude wildcards (see <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a>).</p>\n      </dd><dt data-md=\"\">path\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⓪\">string</a> indicating the path-prefixes that should match the rule. This\nkey is OPTIONAL; if not present, it will be '/', matching all paths. See <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 7.2 Identify if a URL is in scope of a session</a> for the detailed semantics.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.9\" id=\"format-session-credentials\"><span class=\"secno\">8.9. </span><span class=\"content\">JSON Session Credentials Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-credentials\"></a></h3>\n      The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"json-session-credentials\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">JSON session credentials</dfn> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#json-session-instructions\" id=\"ref-for-json-session-instructions③\">JSON session instructions</a> during registration and optionally during session refresh. \n     <p>At the root of the JSON object, the following keys can exist:</p>\n     <dl>\n      <dt data-md=\"\">type\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③①\">string</a> indicating the kind of credential protected by this session.\nThis key MUST be present, and the value MUST be \"cookie\".</p>\n      </dd><dt data-md=\"\">name\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③②\">string</a> indicating the name of the bound cookie.</p>\n      </dd><dt data-md=\"\">attributes\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③③\">string</a> containing the expected attributes of the protected cookie.\nSee <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-missing-session-credential\">§ 7.6 Identify missing session credential</a> for details on how this\nis used.</p>\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"8.10\" id=\"format-jwt\"><span class=\"secno\">8.10. </span><span class=\"content\">DBSC Proof JWT Syntax</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-jwt\"></a></h3>\n      A <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DBSC proof</dfn> proof is a JWT that is signed (using JSON Web Signature\n(JWS)), with a private key chosen by the client. The header of a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑦\">DBSC proof</a> MUST contain at least the following <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters\" id=\"ref-for-name-parameters①④\">sf-parameter</a>s: \n     <dl>\n      <dt data-md=\"\">typ\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③④\">string</a> MUST be \"dbsc+jwt\"</p>\n      </dd><dt data-md=\"\">alg\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑤\">string</a> defining the algorithm used to sign this JWT. It MUST be\neither \"RS256\" or \"ES256\" from [IANA.JOSE.ALGS].</p>\n     </dd></dl>\n     <p>The payload of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑧\">DBSC proof</a> MUST contain at least the following claims:</p>\n     <dl>\n      <dt data-md=\"\">aud\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑥\">string</a>, MUST be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⓪\">URL</a> this JWT was originally sent to.\nExample: \"https://example.com/refresh.html\"</p>\n      </dd><dt data-md=\"\">jti\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑦\">string</a>, a copy of the challenge value sent in the registration\nheader.</p>\n      </dd><dt data-md=\"\">iat\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑧\">string</a>, this claim identifies the time at which the JWT was\nissued.  This claim can be used to determine the age of the JWT.  Its\nvalue MUST be a number containing a NumericDate value.</p>\n      </dd><dt data-md=\"\">key\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑨\">string</a> defining a JWK as specified in [rfc7517].</p>\n     </dd></dl>\n     <p>In addition the following claims MUST be present if present in\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>`:</p>\n     <dl>\n      <dt data-md=\"\">authorization\n      </dt><dd data-md=\"\">\n       <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⓪\">string</a>, direct copy of the string from\n`<code><a data-link-type=\"http-header\">Secure-Session-Registration</a></code>`, if set there. Note that this string is\nOPTIONAL to include in the header, but if it is present it is\nMANDATORY for clients to add the claim in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑨\">DBSC proof</a>.</p>\n     </dd></dl>\n     <p>If the DBSC proof is for a refresh request, the following claim MUST be\npresent:</p>\n     <dl>\n      <dt data-md=\"\">sub\n      </dt><dd data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑧\">session identifier</a>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④①\">string</a>.</p>\n     </dd></dl>\n     \n     <h2 class=\"heading settled\" data-level=\"9\" id=\"changes-to-other-specifications\"><span class=\"secno\">9. </span><span class=\"content\">Changes to other specifications</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-other-specifications\"></a></h2>\n     <h3 class=\"heading settled\" data-level=\"9.1\" id=\"changes-to-fetch\"><span class=\"secno\">9.1. </span><span class=\"content\">Changes to the Fetch specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-fetch\"></a></h3>\n     <p>This specification requires an update to the <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\nfetch</a> algorithm. A <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑨\">request</a> has a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-lt=\"deferred device bound session ids\" data-noexport=\"\" id=\"request-deferred-device-bound-session-ids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deferred device\nbound session ids</dfn>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①\">tuples</a> consisting of:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>a domain (a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①③\">registrable domain</a>).</p>\n      </li><li data-md=\"\">\n       <p>a session id (a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④②\">string</a>).</p>\n     </li></ul>\n     This list is initially empty. After computing cookies in step 8.21, run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session-needing-refresh\">§ 7.5 Identify session needing refresh</a>. If the resulting <var>session</var> is non-null: \n     \n     <h3 class=\"heading settled\" data-level=\"9.2\" id=\"changes-to-clear-site-data\"><span class=\"secno\">9.2. </span><span class=\"content\">Changes to the Clear Site Data specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-clear-site-data\"></a></h3>\n     <p>This specification requires that the Clear Site Data specification\nsections 4.2.5 \"Clear DOM-accessible storage for origin\" clear all\ndevice bound sessions whose scope matches origin. It also requires an\nupdate to 4.2.4 to clear device bound sessions for the site matching the\nregistered domain.</p>\n     <h2 class=\"heading settled\" data-level=\"10\" id=\"iana-considerations\"><span class=\"secno\">10. </span><span class=\"content\">IANA Considerations</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-considerations\"></a></h2>\n     <p>The permanent message header field registry should be updated with the following\nregistrations: <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc3864\" title=\"Registration Procedures for Message Header Fields\">[RFC3864]</a></p>\n     <h3 class=\"heading settled\" data-level=\"10.1\" id=\"iana-ses-session-challenge\"><span class=\"secno\">10.1. </span><span class=\"content\">Secure-Session-Challenge</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-challenge\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Challenge\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-challenge\">§ 8.2 `Secure-Session-Challenge` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.2\" id=\"iana-sec-secure-session-id\"><span class=\"secno\">10.2. </span><span class=\"content\">Sec-Secure-Session-Id</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-sec-secure-session-id\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Sec-Secure-Session-Id\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-secure-session-id\">§ 8.4 `Sec-Secure-Session-Id` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.3\" id=\"iana-secure-session-registration\"><span class=\"secno\">10.3. </span><span class=\"content\">Secure-Session-Registration</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-registration\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Registration\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-registration\">§ 8.1 `Secure-Session-Registration` HTTP header field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.4\" id=\"iana-secure-session-response\"><span class=\"secno\">10.4. </span><span class=\"content\">Secure-Session-Response</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-response\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Response\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-response\">§ 8.3 `Secure-Session-Response` HTTP Header Field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.5\" id=\"iana-secure-session-skipped\"><span class=\"secno\">10.5. </span><span class=\"content\">Secure-Session-Skipped</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-secure-session-skipped\"></a></h3>\n     <dl>\n      <dt>Header field name\n      </dt><dd>Secure-Session-Skipped\n      </dd><dt>Applicable protocol\n      </dt><dd>http\n      </dd><dt>Status\n      </dt><dd>draft\n      </dd><dt>Author/Change controller\n      </dt><dd>W3C\n      </dd><dt>Specification document\n      </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-secure-session-skipped\">§ 8.5 `Secure-Session-Skipped` HTTP header field</a>)\n     </dd></dl>\n     <h3 class=\"heading settled\" data-level=\"10.6\" id=\"well-known\"><span class=\"secno\">10.6. </span><span class=\"content\">device-bound-sessions Well Known</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#well-known\"></a></h3>\n     <p>The Well-Known URI registry should be updated to include\n/.well-known/device-bound-sessions.</p>\n     <p>This endpoint must serve a JSON-encoded dictionary. Two keys are defined:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>\"registering_origins\" is a list of strings. It contains origins that\nare allowed to register sessions for an entire site.</p>\n      </li><li data-md=\"\">\n       <p>\"relying_origins\" is a list of strings. It contains origins that are\nallowed to be the Relying Party (RP) when sharing keys with this\nsite’s sessions.</p>\n      </li><li data-md=\"\">\n       <p>\"provider_origin\" is an optional string. It contains the origin of the Session\nProvider when this origin is being used as a Relying Party.</p>\n     </li></ul>\n     \n     <h2 class=\"heading settled\" data-level=\"11\" id=\"changelog\"><span class=\"secno\">11. </span><span class=\"content\">Changelog</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changelog\"></a></h2>\n      This is an early draft of the spec. \n     <h2 class=\"heading settled\" data-level=\"12\" id=\"acknowledgements\"><span class=\"secno\">12. </span><span class=\"content\">Acknowledgements</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#acknowledgements\"></a></h2>",
      "rationale": "run",
      "steps": [
        {
          "html": "<p>Run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-session-request\">§ 7.8 Send request</a> with the returned <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-key\" id=\"ref-for-device-bound-session-session-key③\">session key</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-refresh-url\" id=\"ref-for-device-bound-session-refresh-url②\">refresh URL</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑨\">session identifier</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge③\">cached challenge</a>, and an empty authorization.</p>"
        },
        {
          "html": "<p>Restart <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\nfetch</a> with the original inputs.</p>"
        }
      ]
    }
  ]
}