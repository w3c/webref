{
  "spec": {
    "title": "Device Bound Session Credentials",
    "url": "https://w3c.github.io/webappsec-dbsc/"
  },
  "algorithms": [
    {
      "name": "identify-session",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-identify-a-session",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-identify-a-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">identify a session</dfn> out of all the\n  sessions that exist on a user agent. The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier①\">session identifier</a> is unique within a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain③\">registrable domain</a>. \n    <p>Given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URL</a> (<var>url</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier②\">session identifier</a> (<var>session identifier</var>), this algorithm returns a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session①\">device bound session</a> or\n  null if no such session exists.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>site</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain④\">registrable domain</a> of <var>url</var>.</p>"
        },
        {
          "html": "<p>Let <var>domain sessions</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#sessions-by-registrable-domain\" id=\"ref-for-sessions-by-registrable-domain\">sessions by registrable domain</a>[<var>site</var>] as a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-by-id\" id=\"ref-for-session-by-id①\">session by id</a></p>"
        },
        {
          "html": "<p>Return <var>domain sessions</var>[<var>session identifier</var>]</p>"
        }
      ]
    },
    {
      "name": "url-in-scope",
      "html": "This algorithm describes how to determine if a URL is in scope of a\n  device bound session. Given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url③\">URL</a> (<var>URL</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#modules-session\" id=\"ref-for-modules-session\">session</a> (<var>session</var>), returns\n  \"include\" if <var>URL</var> is in scope, and \"exclude\" otherwise.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>scope</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification\" id=\"ref-for-scope-specification①\">scope specification</a>.</p>"
        },
        {
          "html": "<p>If <var>scope</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site\">include site</a> is true, return \"exclude\" if any of the\n following hold:</p>",
          "ignored": [
            "URL is not same site with scope origin. scope origin is not the eTLD+1 and URL is not same origin with scope origin."
          ]
        },
        {
          "html": "<p>If <var>scope</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-include-site\" id=\"ref-for-session-scope-include-site①\">include site</a> is false, return \"exclude\" if <var>URL</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>scope</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-scope-origin\" id=\"ref-for-session-scope-origin③\">origin</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">for each</a> <var>scope specification</var> in <var>scope</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-host\" id=\"ref-for-scope-specification-host\">host</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-path\" id=\"ref-for-scope-specification-path\">path</a> of <var>URL</var> match the <var>scope specification</var>, return the <var>scope specification</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#scope-specification-type\" id=\"ref-for-scope-specification-type\">type</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If the <var>URL</var> matches the <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-refresh-url\" id=\"ref-for-device-bound-session-refresh-url\">refresh URL</a>, return \"exclude\".</p>"
        },
        {
          "html": "<p>Return \"include\".</p>"
        }
      ]
    },
    {
      "name": "identify-session-needing-refresh",
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request\">request</a> (<var>request</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#sessions-by-registrable-domain\" id=\"ref-for-sessions-by-registrable-domain①\">sessions by registrable domain</a>, this algorithm describes how to identify which session, if\n  any, should block <var>request</var> from proceeding.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>site</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑤\">registrable domain</a> of the <var>request</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>domain sessions</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#sessions-by-registrable-domain\" id=\"ref-for-sessions-by-registrable-domain②\">sessions by registrable domain</a>[<var>site</var>] as <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-by-id\" id=\"ref-for-session-by-id②\">session by id</a></p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>session</var> of <var>domain sessions</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>The browser MAY skip <var>session</var> in order to prevent denial of\n service for the user or site. For example if <var>session</var> is\n requesting excessive TPM operations (harming the user) or the\n refresh endpoint has recently been unreachable (denial of service\n risk for the site).</p>"
            },
            {
              "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-expiration-timestamp\" id=\"ref-for-device-bound-session-expiration-timestamp\">expiration timestamp</a> is before the present, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>Run the steps in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-url-in-scope\">§ 8.2 Identify if a URL is in scope of a session</a> on the <var>request</var>’s URL\n and <var>session</var>’s scope.</p>"
            },
            {
              "html": "<p>If the result does not indicate the request is in scope, skip <var>session</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p>Run the steps of <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-misssing-session-credential\">§ 8.4 Identify missing session credential</a> on <var>request</var> and <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential\" id=\"ref-for-session-credential②\">session credentials</a>. If the result is\n true, return <var>session</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If no session has been identified, return null.</p>"
        }
      ]
    },
    {
      "name": "identify-missing-session-credential",
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request①\">request</a> (<var>request</var>) and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential\" id=\"ref-for-session-credential③\">session credentials</a> (<var>credentials</var>), returns a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean②\">boolean</a> indicating whether any <var>credential</var> in <var>credentials</var> is missing on <var>request</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">for each</a> <var>credential</var> in <var>credentials</var>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If a cookie with <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-credential-attributes\" id=\"ref-for-session-credential-attributes\">attributes</a> would\n not be attached to <var>request</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#cookie\">section 5.4</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a> contains a <var>cookie</var> that\n satisfies all of the following conditions, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>:</p>",
              "ignored": [
                "cookie’s name matches credential’s name All of the following attributes of cookie match those in credential’s attributes: Domain, Path, Secure, HttpOnly, SameSite. cookie’s partition key matches that of credential."
              ]
            },
            {
              "html": "<p>Return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "process-challenge",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-process-a-challenge",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" id=\"algorithms-process-a-challenge\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a challenge</dfn> received in an HTTP\n  header. \n    <p>Given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response\">response</a> (<var>response</var>) and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#sessions-by-registrable-domain\" id=\"ref-for-sessions-by-registrable-domain③\">sessions by registrable domain</a>, this\n  algorithm updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge\">cached challenge</a> for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session②\">device bound session</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>header name</var> be \"<code>Sec-Session-Challenge</code>\".</p>"
        },
        {
          "html": "<p>Let <var>challenge list</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">get a structured\nfield value</a> given <var>header name</var> and \"list\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>challenge entry</var> of <var>challenge list</var>:",
          "rationale": "parse",
          "steps": [
            {
              "html": "<p>Parse <var>challenge entry</var> according to <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#text-parse\" id=\"ref-for-text-parse\">parsing structured fields</a>.</p>"
            },
            {
              "html": "<p>If the type of <var>challenge entry</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string⑧\">sf-string</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>challenge</var> be the parsed item.</p>"
            },
            {
              "html": "<p>Let <var>session id</var> be null.</p>"
            },
            {
              "html": "<p>If params[\"id\"] exists and is a <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string⑨\">sf-string</a>, Set <var>session id</var> to\nparams[\"id\"].</p>"
            },
            {
              "html": "<p>If <var>session id</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>Identify session as described in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#algorithms-identify-a-session\" id=\"ref-for-algorithms-identify-a-session\">identify a session</a> given <var>response</var> and <var>session id</var> and store as <var>session object</var>.</p>"
            },
            {
              "html": "<p>If <var>session object</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
            },
            {
              "html": "<p>Store <var>challenge</var> in <var>session object</var> to be used next time a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof\">DBSC proof</a> is to be sent from this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session③\">device bound session</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "session-request",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-send-a-request",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"send a request\" id=\"algorithms-send-a-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send\n  a request</dfn> for a device bound session registration or refresh. It\n  takes as input an <var>originating request</var>, <var>key pair</var>, <var>destination</var>, and\n  optional <var>session id</var>, <var>challenge</var>, and <var>authorization</var>. \n    \n    <h3 class=\"heading settled\" data-level=\"8.7\" id=\"algo-create-session\"><span class=\"secno\">8.7. </span><span class=\"content\">Create session</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\"></a></h3>\n     To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Create a new session</dfn>, start with\nparsing the registration structured header defined in\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header\">Sec-Session-Registration</a></code>`: \n    <div class=\"algorithm\" data-algorithm=\"process-registration\">\n     \n    </div>\n    <h2 class=\"heading settled\" data-level=\"9\" id=\"format\"><span class=\"secno\">9. </span><span class=\"content\">DBSC Formats</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format\"></a></h2>\n    <h3 class=\"heading settled\" data-level=\"9.1\" id=\"header-sec-session-registration\"><span class=\"secno\">9.1. </span><span class=\"content\">`<code>Sec-Session-Registration</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-registration\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Registration\" id=\"sec-session-registration-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Registration</code></dfn>` header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response①\">response</a> by the server to start a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session④\">device bound session</a> on the\nclient. \n    <p>`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header②\">Sec-Session-Registration</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Sec-Session-Registration = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list④\">sf-list</a></pre>\n    <p>Each item in the list must be an inner list, and each item in the inner list\nMUST be a <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token①\">sf-token</a> representing a supported algorithm (ES256, RS256).\nOnly these two values are currently supported.</p>\n    <p>The following parameters are defined:</p>\n    <ul>\n     <li data-md=\"\">\n      <p>A parameter whose key is \"path\", and whose value is a String (Section 3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), conveying the path to the registration endpoint. This may be\nrelative to the current <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑤\">URL</a>, or a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a>. Entries without this\nparameter will be ignored in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#create-session\" id=\"ref-for-create-session\">Create a new session</a>.</p>\n     </li><li data-md=\"\">\n      <p>A parameter whose key is \"challenge\", and whose value is a String (Section\n3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), conveying the challenge to be used in the session\nregistration.</p>\n     </li><li data-md=\"\">\n      <p>A parameter whose key is \"authorization\", and whose value is a String (Section\n3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), this parameter will be copied into the registration\nJWT.</p>\n    </li></ul>\n    \n    <h3 class=\"heading settled\" data-level=\"9.2\" id=\"header-sec-session-challenge\"><span class=\"secno\">9.2. </span><span class=\"content\">`<code>Sec-Session-Challenge</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-challenge\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Challenge\" id=\"sec-session-challenge-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Challenge</code></dfn>` header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response②\">response</a> by the server to send a challenge to the client that it expects to\nbe used in future Sec-Session-Response headers inside the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof①\">DBSC proof</a>, or to\nrequest a newly signed <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof②\">DBSC proof</a> right away if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑤\">status</a> is \n    \n    <p>`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-challenge-header\" id=\"ref-for-sec-session-challenge-header\">Sec-Session-Challenge</a></code>` is a structured header. Its value must be a string.\nIts ABNF is: </p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①②\">sf-string</a></pre>\n     The semantics of the item are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\">§ 9.2.1 Sec-Session-Challenge structured header serialization</a>.\n    <p></p>\n    <p>The processing steps are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-process-challenge\">§ 8.5 Cache challenge</a>.</p>\n    <h4 class=\"heading settled\" data-level=\"9.2.1\" id=\"challenge-structured-header-serialization\"><span class=\"secno\">9.2.1. </span><span class=\"content\">Sec-Session-Challenge structured header serialization</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\"></a></h4>\n     The `<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-challenge-header\" id=\"ref-for-sec-session-challenge-header①\">Sec-Session-Challenge</a></code>` is represented as a Structured Field.<a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a> \n    <p>In this representation, a challenge is represented by a string.</p>\n    <p>Challenges MAY have a Parameter named <code>\"id\"</code>, whose value MUST be a String\nrepresenting a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier④\">session identifier</a>. Any other\nparameters SHOULD be ignored.</p>\n    \n    \n    <h3 class=\"heading settled\" data-level=\"9.3\" id=\"header-sec-session-response\"><span class=\"secno\">9.3. </span><span class=\"content\"><code>Sec-Session-Response</code> HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-response\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Response\" id=\"sec-session-response-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Response</code></dfn>` header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request②\">request</a> by the user agent to send a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof④\">DBSC proof</a> to the server to prove\nthat the client is still in possesion of the private key of the session key. \n    <p>`<a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-response-header\" id=\"ref-for-sec-session-response-header\"><code>Sec-Session-Response</code></a>` is a structured\nheader. Its value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①③\">sf-string</a></pre>\n    <p>This string MUST only contain the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑤\">DBSC proof</a> JWT. Any parameters SHOULD be\nignored.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"9.4\" id=\"header-sec-session-id\"><span class=\"secno\">9.4. </span><span class=\"content\"><code>Sec-Session-Id</code> HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-id\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Id\" id=\"sec-session-id-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Id</code></dfn>` header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request③\">request</a> by the user agent to request the current session is refreshed, \nwith the current session identifier as a string argument. \n    <p>`<a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-id-header\" id=\"ref-for-sec-session-id-header\"><code>Sec-Session-Id</code></a>` is a structured header.\nIts value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①④\">sf-string</a></pre>\n    <p>This string MUST only contain the session identifier. Any paramters SHOULD be\nignored.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"9.5\" id=\"format-session-instructions\"><span class=\"secno\">9.5. </span><span class=\"content\">DBSC Session Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\"></a></h3>\n     The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">session instructions</dfn> during session registration and\noptionally during session refresh. If the response contains session instructions\nit MUST be in JSON format. \n    <p>At the root of the JSON object the following keys can exist:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-session-identifier\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">session identifier</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a> representing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑤\">session identifier</a>.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-instructions\" id=\"ref-for-session-instructions\">session instructions</a> is sent during a refresh request this MUST be\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑥\">session identifier</a> for the current session. If\nnot these instructions SHOULD be ignored.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-instructions\" id=\"ref-for-session-instructions①\">session instructions</a> is sent during a registration it MUST either\nbe a unique iditifier for this <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑥\">registrable domain</a>, or it will\noverwrite the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session⑤\">device bound session</a> with this identifier for the\ncurrent <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑦\">registrable domain</a>.\nThis key MUST be present.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-refresh_url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">refresh_url</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a> used for future refresh requests.\nThis can be a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a>, or relative to the current <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request④\">request</a>.\nThis key is OPTIONAL; if not present the registration URL will be used for\nfuture refresh requests.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-continue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">continue</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③\">boolean</a> representing if the current session should continue, or be\nclosed on the client. This key is OPTIONAL, and if not present the default\nvalue will be true.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-defer_requests\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">defer_requests</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean④\">boolean</a> describing the wanted session behavior during a session\nrefresh. If this value is true all requests related to this session will be\ndeferred while the session is refreshed. If instead the value is false every\nrequest will instead be sent as normal, but with a `<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-response-header\" id=\"ref-for-sec-session-response-header①\">Sec-Session-Response</a></code>`\nheader containing the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑥\">DBSC proof</a>.\nThis key is OPTIONAL, and if not present a value of true is default.</p>\n    </dd></dl>\n    \n    <h3 class=\"heading settled\" data-level=\"9.6\" id=\"format-jwt\"><span class=\"secno\">9.6. </span><span class=\"content\">DBSC Proof JWT Syntax</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-jwt\"></a></h3>\n     A <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DBSC proof</dfn> proof is a JWT that is signed (using JSON Web Signature\n(JWS)), with a private key chosen by the client. The header of a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑦\">DBSC proof</a> MUST contain at least the following parameters: \n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-typ\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">typ</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">string</a> MUST be \"dbsc+jwt\"</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-alg\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">alg</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑧\">string</a> defining the algorithm used to sign this JWT. It MUST be\neither \"RS256\" or \"ES256\" from [IANA.JOSE.ALGS].</p>\n    </dd></dl>\n    <p>The payload of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑧\">DBSC proof</a> MUST contain at least the following claims:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-aud\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">aud</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑨\">string</a>, MUST be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑨\">URL</a> this JWT was originally sent to.\nExample: \"https://example.com/refresh.html\"</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-jti\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">jti</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⓪\">string</a>, a copy of the challenge value sent in the registration\nheader.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-iat\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">iat</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②①\">string</a>, this claim identifies the time at which the JWT was\nissued.  This claim can be used to determine the age of the JWT.  Its\nvalue MUST be a number containing a NumericDate value.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">key</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②②\">string</a> defining a JWK as specified in [rfc7517].</p>\n    </dd></dl>\n    <p>In addition the following claims MUST be present if present in\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header④\">Sec-Session-Registration</a></code>`:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-authorization\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">authorization</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②③\">string</a>, direct copy of the string from\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header⑤\">Sec-Session-Registration</a></code>`, if set there. Note that this string is\nOPTIONAL to include in the header, but if it is present it is\nMANDATORY for clients to add the claim in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑨\">DBSC proof</a>.</p>\n    </dd></dl>\n    <p>If the DBSC proof is for a refresh request, the following claim MUST be\npresent:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-sub\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">sub</dfn>\n     </dt><dd data-md=\"\">\n      <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑦\">session identifier</a>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a>.</p>\n    </dd></dl>\n    \n    <h2 class=\"heading settled\" data-level=\"10\" id=\"changes-to-other-specifications\"><span class=\"secno\">10. </span><span class=\"content\">Changes to other specifications</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-other-specifications\"></a></h2>\n    <h3 class=\"heading settled\" data-level=\"10.1\" id=\"changes-to-fetch\"><span class=\"secno\">10.1. </span><span class=\"content\">Changes to the Fetch specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-fetch\"></a></h3>\n    <p>This specification requires an update the <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\nfetch</a> algorithm. Between steps 10.1 and 10.2 run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session-needing-refresh\">§ 8.3 Identify session needing refresh</a>. If the resulting <var>session</var> is\nnon-null, run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-session-request\">§ 8.6 Send request</a> with the returned <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-key\" id=\"ref-for-device-bound-session-session-key①\">session key</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-refresh-url\" id=\"ref-for-device-bound-session-refresh-url②\">refresh URL</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑧\">session identifier</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge①\">cached challenge</a>, and an empty authorization.</p>\n    <h3 class=\"heading settled\" data-level=\"10.2\" id=\"changes-to-clear-site-data\"><span class=\"secno\">10.2. </span><span class=\"content\">Changes to the Clear Site Data specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-clear-site-data\"></a></h3>\n    <p>This specification requires that the Clear Site Data specification\nsections 4.2.5 \"Clear DOM-accessible storage for origin\" clear all\ndevice bound sessions whose scope matches origin. It also requires an\nupdate to 4.2.4 to clear device bound sessions for the site matching the\nregistered domain.</p>\n    <h2 class=\"heading settled\" data-level=\"11\" id=\"iana-considerations\"><span class=\"secno\">11. </span><span class=\"content\">IANA Considerations</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-considerations\"></a></h2>\n    <p>The permanent message header field registry should be updated with the following\nregistrations: <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc3864\" title=\"Registration Procedures for Message Header Fields\">[RFC3864]</a></p>\n    <h3 class=\"heading settled\" data-level=\"11.1\" id=\"iana-ses-session-challenge\"><span class=\"secno\">11.1. </span><span class=\"content\">Sec-Session-Challenge</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-challenge\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Challenge\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-challenge\">§ 9.2 `Sec-Session-Challenge` HTTP Header Field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.2\" id=\"iana-ses-session-id\"><span class=\"secno\">11.2. </span><span class=\"content\">Sec-Session-Id</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-id\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Id\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-id\">§ 9.4 Sec-Session-Id HTTP Header Field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.3\" id=\"iana-sec-session-registration\"><span class=\"secno\">11.3. </span><span class=\"content\">Sec-Session-Registration</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-sec-session-registration\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Registration\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-registration\">§ 9.1 `Sec-Session-Registration` HTTP header field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.4\" id=\"iana-ses-session-response\"><span class=\"secno\">11.4. </span><span class=\"content\">Sec-Session-Response</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-response\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Response\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-response\">§ 9.3 Sec-Session-Response HTTP Header Field</a>)\n    </dd></dl>\n    <h2 class=\"heading settled\" data-level=\"12\" id=\"changelog\"><span class=\"secno\">12. </span><span class=\"content\">Changelog</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changelog\"></a></h2>\n     This is an early draft of the spec. \n    <h2 class=\"heading settled\" data-level=\"13\" id=\"acknowledgements\"><span class=\"secno\">13. </span><span class=\"content\">Acknowledgements</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#acknowledgements\"></a></h2>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>signed challenge</var> be null. If <var>challenge</var> is non-null, sign it\n with <var>key pair</var> and store the result in <var>signed challenge</var>.</p>"
        },
        {
          "html": "<p>Create a <var>request</var> for use in <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\n fetch</a>.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a> to \"POST\".</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">URL</a> to <var>destination</var>.</p>"
        },
        {
          "html": "<p>If <var>signed challenge</var> is non-null, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append\">append</a> the header\n (\"Sec-Session-Response\", <var>signed challenge</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>authorization</var> is non-null, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①\">append</a> the header\n (\"Authorization\", <var>authorization</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>.</p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator\">initiator</a> to <var>originating request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator①\">initiator</a>.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of running <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\n fetch</a> for <var>request</var>.</p>"
        },
        {
          "html": "<p>If the result is a redirect, and the destination does not have the\n HTTPS scheme and is not localhost, cancel the request.</p>"
        },
        {
          "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a>, or <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status\">status</a> is 407, return.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①\">status</a> is a redirect status, and the\n destination does not have the HTTPS scheme and is not localhost, cancel the\n request.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②\">status</a> is 401 and has a\n \"Sec-Session-Challenge\" header, start this algorithm over with a new\n challenge value.</p>"
        },
        {
          "html": "<p>If response|'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status③\">status</a> is below 500, then terminate the\n session and return.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status④\">status</a> is at least 500, then\n return. Browsers may choose to trigger a backoff mechanism on\n subsequent refresh requests on this session, to limit the harm of a\n temporary outage on the refresh endpoint.</p>"
        },
        {
          "html": "<p>Parse <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body\">body</a> according to <a href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\">§ 9.5 DBSC Session Instruction Format</a>.</p>"
        },
        {
          "html": "<p>Let <var>session identifier</var> be the value of key \"session_identifier\".</p>"
        },
        {
          "html": "If the <var>response</var> JSON contains the key \"continue\", with value \"false\":",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run the steps of <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session\">§ 8.1 Identify session</a> on <var>destination</var> and <var>session\n identifier</var>.</p>"
            },
            {
              "html": "<p>If the result is non-null, delete the returned session.</p>"
            },
            {
              "html": "<p>Return from this algorithm.</p>"
            }
          ]
        },
        {
          "html": "Otherwise, perform the following validations, returning if any fail:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p><var>session identifier</var> must be nonempty.</p>"
            },
            {
              "html": "<p>The value of the key \"refresh_url\" must be non-empty.</p>"
            },
            {
              "html": "<p>Let <var>origin</var> be the value of the key \"scope.origin\", if present, or the\n origin of <var>destination</var> if not.</p>"
            },
            {
              "html": "<p><var>origin</var> must be a valid non-opaque origin.</p>"
            },
            {
              "html": "<p><var>origin</var> must be same-site with <var>destination</var>.</p>"
            },
            {
              "html": "<p>Let <var>refresh URL</var> be the result of resolving <var>destination</var> with the value\n of the key \"refresh_url\".</p>"
            },
            {
              "html": "<p><var>refresh URL</var> must have scheme HTTPS or be localhost.</p>"
            },
            {
              "html": "<p><var>refresh URL</var> must be same-site with <var>destination</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If the input <var>session id</var> is present, delete the session with site <var>destination</var>’s site and identifier <var>session id</var>.</p>"
        },
        {
          "html": "<p>Create a new session with:</p>",
          "ignored": [
            "session identifier set to session identifier. refresh URL set to refresh URL. defer requests set to true. session scope a new scope with origin origin, include site the value of the key \"scope.include_site\", and scope specifications the value of the key \"scope.scope_specification\". session credentials the value of the key \"credentials\". session key a newly-generated key pair."
          ]
        }
      ]
    },
    {
      "name": "session-request",
      "href": "https://w3c.github.io/webappsec-dbsc/#algorithms-send-a-request",
      "html": "This algorithm describes how to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"algorithms\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"send a request\" id=\"algorithms-send-a-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send\n  a request</dfn> for a device bound session registration or refresh. It\n  takes as input an <var>originating request</var>, <var>key pair</var>, <var>destination</var>, and\n  optional <var>session id</var>, <var>challenge</var>, and <var>authorization</var>. \n    \n    <h3 class=\"heading settled\" data-level=\"8.7\" id=\"algo-create-session\"><span class=\"secno\">8.7. </span><span class=\"content\">Create session</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#algo-create-session\"></a></h3>\n     To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Create a new session</dfn>, start with\nparsing the registration structured header defined in\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header\">Sec-Session-Registration</a></code>`: \n    <div class=\"algorithm\" data-algorithm=\"process-registration\">\n     \n    </div>\n    <h2 class=\"heading settled\" data-level=\"9\" id=\"format\"><span class=\"secno\">9. </span><span class=\"content\">DBSC Formats</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format\"></a></h2>\n    <h3 class=\"heading settled\" data-level=\"9.1\" id=\"header-sec-session-registration\"><span class=\"secno\">9.1. </span><span class=\"content\">`<code>Sec-Session-Registration</code>` HTTP header field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-registration\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Registration\" id=\"sec-session-registration-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Registration</code></dfn>` header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response①\">response</a> by the server to start a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session④\">device bound session</a> on the\nclient. \n    <p>`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header②\">Sec-Session-Registration</a></code>` is a List Structured Header <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>. Its ABNF\nis:</p>\n<pre class=\"abnf\">Sec-Session-Registration = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#list\" id=\"ref-for-list④\">sf-list</a></pre>\n    <p>Each item in the list must be an inner list, and each item in the inner list\nMUST be a <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token①\">sf-token</a> representing a supported algorithm (ES256, RS256).\nOnly these two values are currently supported.</p>\n    <p>The following parameters are defined:</p>\n    <ul>\n     <li data-md=\"\">\n      <p>A parameter whose key is \"path\", and whose value is a String (Section 3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), conveying the path to the registration endpoint. This may be\nrelative to the current <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑤\">URL</a>, or a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a>. Entries without this\nparameter will be ignored in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#create-session\" id=\"ref-for-create-session\">Create a new session</a>.</p>\n     </li><li data-md=\"\">\n      <p>A parameter whose key is \"challenge\", and whose value is a String (Section\n3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), conveying the challenge to be used in the session\nregistration.</p>\n     </li><li data-md=\"\">\n      <p>A parameter whose key is \"authorization\", and whose value is a String (Section\n3.3.3 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a>), this parameter will be copied into the registration\nJWT.</p>\n    </li></ul>\n    \n    <h3 class=\"heading settled\" data-level=\"9.2\" id=\"header-sec-session-challenge\"><span class=\"secno\">9.2. </span><span class=\"content\">`<code>Sec-Session-Challenge</code>` HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-challenge\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Challenge\" id=\"sec-session-challenge-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Challenge</code></dfn>` header field can be used in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response②\">response</a> by the server to send a challenge to the client that it expects to\nbe used in future Sec-Session-Response headers inside the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof①\">DBSC proof</a>, or to\nrequest a newly signed <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof②\">DBSC proof</a> right away if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑤\">status</a> is \n    \n    <p>`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-challenge-header\" id=\"ref-for-sec-session-challenge-header\">Sec-Session-Challenge</a></code>` is a structured header. Its value must be a string.\nIts ABNF is: </p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①②\">sf-string</a></pre>\n     The semantics of the item are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\">§ 9.2.1 Sec-Session-Challenge structured header serialization</a>.\n    <p></p>\n    <p>The processing steps are defined in <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-process-challenge\">§ 8.5 Cache challenge</a>.</p>\n    <h4 class=\"heading settled\" data-level=\"9.2.1\" id=\"challenge-structured-header-serialization\"><span class=\"secno\">9.2.1. </span><span class=\"content\">Sec-Session-Challenge structured header serialization</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#challenge-structured-header-serialization\"></a></h4>\n     The `<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-challenge-header\" id=\"ref-for-sec-session-challenge-header①\">Sec-Session-Challenge</a></code>` is represented as a Structured Field.<a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc9651\" title=\"Structured Field Values for HTTP\">[RFC9651]</a> \n    <p>In this representation, a challenge is represented by a string.</p>\n    <p>Challenges MAY have a Parameter named <code>\"id\"</code>, whose value MUST be a String\nrepresenting a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier④\">session identifier</a>. Any other\nparameters SHOULD be ignored.</p>\n    \n    \n    <h3 class=\"heading settled\" data-level=\"9.3\" id=\"header-sec-session-response\"><span class=\"secno\">9.3. </span><span class=\"content\"><code>Sec-Session-Response</code> HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-response\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Response\" id=\"sec-session-response-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Response</code></dfn>` header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request②\">request</a> by the user agent to send a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof④\">DBSC proof</a> to the server to prove\nthat the client is still in possesion of the private key of the session key. \n    <p>`<a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-response-header\" id=\"ref-for-sec-session-response-header\"><code>Sec-Session-Response</code></a>` is a structured\nheader. Its value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①③\">sf-string</a></pre>\n    <p>This string MUST only contain the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑤\">DBSC proof</a> JWT. Any parameters SHOULD be\nignored.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"9.4\" id=\"header-sec-session-id\"><span class=\"secno\">9.4. </span><span class=\"content\"><code>Sec-Session-Id</code> HTTP Header Field</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-id\"></a></h3>\n     The `<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"http-header\" data-export=\"\" data-lt=\"Sec-Session-Id\" id=\"sec-session-id-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"> <code>Sec-Session-Id</code></dfn>` header field can be used in the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request③\">request</a> by the user agent to request the current session is refreshed, \nwith the current session identifier as a string argument. \n    <p>`<a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-id-header\" id=\"ref-for-sec-session-id-header\"><code>Sec-Session-Id</code></a>` is a structured header.\nIts value must be a string. It’s ABNF is:</p>\n<pre class=\"abnf\">SecSessionChallenge = <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①④\">sf-string</a></pre>\n    <p>This string MUST only contain the session identifier. Any paramters SHOULD be\nignored.</p>\n    \n    <h3 class=\"heading settled\" data-level=\"9.5\" id=\"format-session-instructions\"><span class=\"secno\">9.5. </span><span class=\"content\">DBSC Session Instruction Format</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-session-instructions\"></a></h3>\n     The server sends <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">session instructions</dfn> during session registration and\noptionally during session refresh. If the response contains session instructions\nit MUST be in JSON format. \n    <p>At the root of the JSON object the following keys can exist:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-session-identifier\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">session identifier</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a> representing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑤\">session identifier</a>.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-instructions\" id=\"ref-for-session-instructions\">session instructions</a> is sent during a refresh request this MUST be\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑥\">session identifier</a> for the current session. If\nnot these instructions SHOULD be ignored.\nIf this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#session-instructions\" id=\"ref-for-session-instructions①\">session instructions</a> is sent during a registration it MUST either\nbe a unique iditifier for this <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑥\">registrable domain</a>, or it will\noverwrite the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session\" id=\"ref-for-device-bound-session⑤\">device bound session</a> with this identifier for the\ncurrent <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain⑦\">registrable domain</a>.\nThis key MUST be present.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-refresh_url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">refresh_url</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">string</a> representing the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a> used for future refresh requests.\nThis can be a full <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a>, or relative to the current <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request④\">request</a>.\nThis key is OPTIONAL; if not present the registration URL will be used for\nfuture refresh requests.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-continue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">continue</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③\">boolean</a> representing if the current session should continue, or be\nclosed on the client. This key is OPTIONAL, and if not present the default\nvalue will be true.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"session instructions\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"session-instructions-defer_requests\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">defer_requests</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean④\">boolean</a> describing the wanted session behavior during a session\nrefresh. If this value is true all requests related to this session will be\ndeferred while the session is refreshed. If instead the value is false every\nrequest will instead be sent as normal, but with a `<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-response-header\" id=\"ref-for-sec-session-response-header①\">Sec-Session-Response</a></code>`\nheader containing the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑥\">DBSC proof</a>.\nThis key is OPTIONAL, and if not present a value of true is default.</p>\n    </dd></dl>\n    \n    <h3 class=\"heading settled\" data-level=\"9.6\" id=\"format-jwt\"><span class=\"secno\">9.6. </span><span class=\"content\">DBSC Proof JWT Syntax</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#format-jwt\"></a></h3>\n     A <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DBSC proof</dfn> proof is a JWT that is signed (using JSON Web Signature\n(JWS)), with a private key chosen by the client. The header of a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑦\">DBSC proof</a> MUST contain at least the following parameters: \n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-typ\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">typ</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">string</a> MUST be \"dbsc+jwt\"</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-alg\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">alg</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑧\">string</a> defining the algorithm used to sign this JWT. It MUST be\neither \"RS256\" or \"ES256\" from [IANA.JOSE.ALGS].</p>\n    </dd></dl>\n    <p>The payload of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑧\">DBSC proof</a> MUST contain at least the following claims:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-aud\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">aud</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑨\">string</a>, MUST be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑨\">URL</a> this JWT was originally sent to.\nExample: \"https://example.com/refresh.html\"</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-jti\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">jti</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⓪\">string</a>, a copy of the challenge value sent in the registration\nheader.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-iat\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">iat</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②①\">string</a>, this claim identifies the time at which the JWT was\nissued.  This claim can be used to determine the age of the JWT.  Its\nvalue MUST be a number containing a NumericDate value.</p>\n     </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">key</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②②\">string</a> defining a JWK as specified in [rfc7517].</p>\n    </dd></dl>\n    <p>In addition the following claims MUST be present if present in\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header④\">Sec-Session-Registration</a></code>`:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-authorization\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">authorization</dfn>\n     </dt><dd data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②③\">string</a>, direct copy of the string from\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header⑤\">Sec-Session-Registration</a></code>`, if set there. Note that this string is\nOPTIONAL to include in the header, but if it is present it is\nMANDATORY for clients to add the claim in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#dbsc-proof\" id=\"ref-for-dbsc-proof⑨\">DBSC proof</a>.</p>\n    </dd></dl>\n    <p>If the DBSC proof is for a refresh request, the following claim MUST be\npresent:</p>\n    <dl>\n     <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DBSC proof\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dbsc-proof-sub\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">sub</dfn>\n     </dt><dd data-md=\"\">\n      <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑦\">session identifier</a>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a>.</p>\n    </dd></dl>\n    \n    <h2 class=\"heading settled\" data-level=\"10\" id=\"changes-to-other-specifications\"><span class=\"secno\">10. </span><span class=\"content\">Changes to other specifications</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-other-specifications\"></a></h2>\n    <h3 class=\"heading settled\" data-level=\"10.1\" id=\"changes-to-fetch\"><span class=\"secno\">10.1. </span><span class=\"content\">Changes to the Fetch specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-fetch\"></a></h3>\n    <p>This specification requires an update the <a href=\"https://fetch.spec.whatwg.org/#http-network-or-cache-fetch\">HTTP-network-or-cache\nfetch</a> algorithm. Between steps 10.1 and 10.2 run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-identify-session-needing-refresh\">§ 8.3 Identify session needing refresh</a>. If the resulting <var>session</var> is\nnon-null, run <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-session-request\">§ 8.6 Send request</a> with the returned <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-key\" id=\"ref-for-device-bound-session-session-key①\">session key</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-refresh-url\" id=\"ref-for-device-bound-session-refresh-url②\">refresh URL</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-session-identifier\" id=\"ref-for-device-bound-session-session-identifier⑧\">session identifier</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-dbsc/#device-bound-session-cached-challenge\" id=\"ref-for-device-bound-session-cached-challenge①\">cached challenge</a>, and an empty authorization.</p>\n    <h3 class=\"heading settled\" data-level=\"10.2\" id=\"changes-to-clear-site-data\"><span class=\"secno\">10.2. </span><span class=\"content\">Changes to the Clear Site Data specification</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changes-to-clear-site-data\"></a></h3>\n    <p>This specification requires that the Clear Site Data specification\nsections 4.2.5 \"Clear DOM-accessible storage for origin\" clear all\ndevice bound sessions whose scope matches origin. It also requires an\nupdate to 4.2.4 to clear device bound sessions for the site matching the\nregistered domain.</p>\n    <h2 class=\"heading settled\" data-level=\"11\" id=\"iana-considerations\"><span class=\"secno\">11. </span><span class=\"content\">IANA Considerations</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-considerations\"></a></h2>\n    <p>The permanent message header field registry should be updated with the following\nregistrations: <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-dbsc/#biblio-rfc3864\" title=\"Registration Procedures for Message Header Fields\">[RFC3864]</a></p>\n    <h3 class=\"heading settled\" data-level=\"11.1\" id=\"iana-ses-session-challenge\"><span class=\"secno\">11.1. </span><span class=\"content\">Sec-Session-Challenge</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-challenge\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Challenge\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-challenge\">§ 9.2 `Sec-Session-Challenge` HTTP Header Field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.2\" id=\"iana-ses-session-id\"><span class=\"secno\">11.2. </span><span class=\"content\">Sec-Session-Id</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-id\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Id\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-id\">§ 9.4 Sec-Session-Id HTTP Header Field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.3\" id=\"iana-sec-session-registration\"><span class=\"secno\">11.3. </span><span class=\"content\">Sec-Session-Registration</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-sec-session-registration\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Registration\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-registration\">§ 9.1 `Sec-Session-Registration` HTTP header field</a>)\n    </dd></dl>\n    <h3 class=\"heading settled\" data-level=\"11.4\" id=\"iana-ses-session-response\"><span class=\"secno\">11.4. </span><span class=\"content\">Sec-Session-Response</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#iana-ses-session-response\"></a></h3>\n    <dl>\n     <dt>Header field name\n     </dt><dd>Sec-Session-Response\n     </dd><dt>Applicable protocol\n     </dt><dd>http\n     </dd><dt>Status\n     </dt><dd>draft\n     </dd><dt>Author/Change controller\n     </dt><dd>W3C\n     </dd><dt>Specification document\n     </dt><dd>This specification (See <a href=\"https://w3c.github.io/webappsec-dbsc/#header-sec-session-response\">§ 9.3 Sec-Session-Response HTTP Header Field</a>)\n    </dd></dl>\n    <h2 class=\"heading settled\" data-level=\"12\" id=\"changelog\"><span class=\"secno\">12. </span><span class=\"content\">Changelog</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#changelog\"></a></h2>\n     This is an early draft of the spec. \n    <h2 class=\"heading settled\" data-level=\"13\" id=\"acknowledgements\"><span class=\"secno\">13. </span><span class=\"content\">Acknowledgements</span><a class=\"self-link\" href=\"https://w3c.github.io/webappsec-dbsc/#acknowledgements\"></a></h2>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>header name</var> be \"<code>Sec-Session-Registration</code>\".</p>"
        },
        {
          "html": "<p>Let <var>registration list</var> be the result of executing <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header①\">get a structured\nfield value</a> given <var>header name</var> and \"list\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>registration entry</var>, <var>params</var> → <var>registration list</var>:",
          "rationale": "parse",
          "steps": [
            {
              "html": "<p>Parse <var>registration entry</var> according to <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#text-parse\" id=\"ref-for-text-parse①\">parsing structured fields</a>.</p>"
            },
            {
              "html": "<p>If <var>registration entry</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#inner-list\" id=\"ref-for-inner-list\">sf-inner-list</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>algorithm list</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>algorithm</var> → <var>registration entry</var>",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>algorithm</var> is not a <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#token\" id=\"ref-for-token\">sf-token</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a>.</p>"
                },
                {
                  "html": "<p>If <var>algorithm</var> represents a crypto algorithm supported in\n`<code><a data-link-type=\"http-header\" href=\"https://w3c.github.io/webappsec-dbsc/#sec-session-registration-header\" id=\"ref-for-sec-session-registration-header①\">Sec-Session-Registration</a></code>`, and is supported on this client, add <var>algorithm</var> to <var>algorithm list</var></p>"
                }
              ]
            },
            {
              "html": "<p>If <var>algorithm list</var> is empty, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑨\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"path\"] does not exist, or is not of type <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①⓪\">sf-string</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⓪\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>path</var> be <var>params</var>[\"path\"].</p>"
            },
            {
              "html": "<p>Let <var>challenge</var> be null, and Let <var>authorization</var> be null.</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"challenge\"] exists and is of type <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc9651#string\" id=\"ref-for-string①①\">sf-string</a> Set <var>challenge</var> to <var>params</var>[\"challenge\"].</p>"
            },
            {
              "html": "<p>If <var>params</var>[\"authorization\"] exists and is a string Set <var>authorization</var> to <var>params</var>[\"authorization\"].</p>"
            },
            {
              "html": "<p>Create a <var>key pair</var> for <var>algorithm list</var>.</p>"
            },
            {
              "html": "<p>Let <var>endpoint</var> be the result of resolving <var>path</var> relative to the <var>response</var>’s URL.</p>"
            },
            {
              "html": "<p>Call <a href=\"https://w3c.github.io/webappsec-dbsc/#algo-session-request\">§ 8.6 Send request</a> with <var>key pair</var>, <var>endpoint</var>, null\n session identifier, <var>challenge</var> and <var>authorization</var>.</p>"
            }
          ]
        }
      ]
    }
  ]
}