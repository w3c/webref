{
  "spec": {
    "title": "Prerendering Revamped",
    "url": "https://wicg.github.io/nav-speculation/prerendering.html"
  },
  "algorithms": [
    {
      "name": "Document/post-prerendering activation steps list",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list",
      "html": "Every <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document④\">Document</a></code> has a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Document\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"document-post-prerendering-activation-steps-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">post-prerendering activation steps list</dfn>, which is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> where each <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item\">item</a> is a series of algorithm steps. For convenience, we define the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"platform object\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"platform-object-post-prerendering-activation-steps-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">post-prerendering activation steps list</dfn> for any platform object <var>platformObject</var> as:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If platformObject is a node",
              "html": "",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>platformObject</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list\">post-prerendering activation steps list</a>.</p>"
                }
              ]
            },
            {
              "case": "Otherwise",
              "html": "",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p class=\"assertion\">Assert: <var>platformObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code> object.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "User-agent initiated prerendering",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#start-user-agent-initiated-prerendering",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"start-user-agent-initiated-prerendering\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">start user-agent initiated prerendering</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url\">URL</a> <var>startingURL</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>startingURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> is an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme\">HTTP(S) scheme</a>.</p>"
        },
        {
          "html": "<p>Let <var>prerenderingTraversable</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#creating-a-new-top-level-traversable\" id=\"ref-for-creating-a-new-top-level-traversable\">creating a new top-level traversable</a> given null and the empty string.</p>"
        },
        {
          "html": "<p>Set <var>prerenderingTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode③\">loading mode</a> to \"<code>prerender</code>\".</p>"
        },
        {
          "html": "<p>Let <var>prefetchRecord</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record\" id=\"ref-for-prefetch-record\">prefetch record</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url\">URL</a> is <var>startingURL</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-anonymization-policy\" id=\"ref-for-prefetch-record-anonymization-policy\">anonymization policy</a> is null, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-referrer-policy\" id=\"ref-for-prefetch-record-referrer-policy\">referrer policy</a> is the empty string, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-no-vary-search-hint\" id=\"ref-for-prefetch-record-no-vary-search-hint\">No-Vary-Search hint</a> is the <a data-link-type=\"dfn\" href=\"https://httpwg.org/http-extensions/draft-ietf-httpbis-no-vary-search.html#iref-default-url-search-variance\" id=\"ref-for-iref-default-url-search-variance\">default URL search variance</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-label\" id=\"ref-for-prefetch-record-label\">label</a> is \"<code>browser UI</code>\", and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①\">prerendering traversable</a> is <var>prerenderingTraversable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch\" id=\"ref-for-prefetch\">Prefetch</a> given <var>prerenderingTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document\">active document</a> and <var>prefetchRecord</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate\">Navigate</a> <var>prerenderingTraversable</var> to <var>startingURL</var> using <var>prerenderingTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①\">active document</a>.</p>"
        },
        {
          "html": "When the user indicates they wish to commit a navigation to an <var>activationURL</var> which is a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①\">URL</a> such that <var>prefetchRecord</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-matches-a-url\" id=\"ref-for-prefetch-record-matches-a-url\">matches a URL</a> given <var>activationURL</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the user indicates they wish to create a new user-visible <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①\">top-level traversable</a> while doing so (e.g., by pressing <kbd><kbd>Shift</kbd>+<kbd>Enter</kbd></kbd> after typing in the address bar):",
              "rationale": "update",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-update-the-successor-for-activation\" id=\"ref-for-prerendering-traversable-update-the-successor-for-activation\">Update the successor for activation</a> given <var>prerenderingTraversable</var>, <var>startingURL</var>, and <var>activationURL</var>.</p>"
                },
                {
                  "html": "<p>Update the user agent’s user interface to present <var>prerenderingTraversable</var>, e.g., by creating a new tab/window.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-finalize-activation\" id=\"ref-for-prerendering-traversable-finalize-activation\">Finalize activation</a> for <var>prerenderingTraversable</var> given <var>startingURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a>.</p>"
                }
              ]
            },
            {
              "html": "Alternately, if the user indicates they wish to commit the navigation into an existing <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②\">top-level traversable</a> <var>predecessorTraversable</var> (e.g., by pressing <kbd>Enter</kbd> after typing in the address bar):",
              "rationale": "activate",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-activate\" id=\"ref-for-prerendering-traversable-activate\">Activate</a> <var>prerenderingTraversable</var> in place of <var>predecessorTraversable</var> given \"<code>push</code>\", <var>startingURL</var>, and <var>activationURL</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "start referrer-initiated prerendering",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#start-referrer-initiated-prerendering",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"start-referrer-initiated-prerendering\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">start referrer-initiated prerendering</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑥\">Document</a></code> <var>referrerDoc</var> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record\" id=\"ref-for-prefetch-record①\">prefetch record</a> <var>prefetchRecord</var>:",
      "rationale": "assert",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url①\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a> is an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme①\">HTTP(S) scheme</a>.</p>"
        },
        {
          "html": "<p>If <var>referrerDoc</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable</a> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③\">top-level traversable</a>, then return.</p>"
        },
        {
          "html": "<p>If <var>referrerDoc</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc\" id=\"ref-for-concept-document-bc\">browsing context</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#auxiliary-browsing-context\" id=\"ref-for-auxiliary-browsing-context①\">auxiliary browsing context</a>, then return.</p>"
        },
        {
          "html": "<p>If <var>referrerDoc</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site\">same site</a> with <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url②\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a>, then return.</p>"
        },
        {
          "html": "<p>If <var>referrerDoc</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#has-a-matching-prefetch-record\" id=\"ref-for-has-a-matching-prefetch-record\">has a matching prefetch record</a> given <var>prefetchRecord</var> with <i><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#checkprerender\" id=\"ref-for-checkprerender\">checkPrerender</a></i> set to true, then return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable②\">prerendering traversable</a> is \"<code>to be created</code>\".</p>"
        },
        {
          "html": "<p>Let <var>prerenderingTraversable</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#creating-a-new-top-level-traversable\" id=\"ref-for-creating-a-new-top-level-traversable①\">creating a new top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Set <var>prerenderingTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode④\">loading mode</a> to \"<code>prerender</code>\".</p>"
        },
        {
          "html": "<p>Set <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable③\">prerendering traversable</a> to <var>prerenderingTraversable</var>.</p>"
        },
        {
          "html": "<p>Set <var>prerenderingTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-remove-from-referrer\" id=\"ref-for-prerendering-traversable-remove-from-referrer\">remove from referrer</a> to be an algorithm which sets <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable④\">prerendering traversable</a> to null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch\" id=\"ref-for-prefetch①\">Prefetch</a> given <var>referrerDoc</var> and <var>prefetchRecord</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate①\">Navigate</a> <var>prerenderingTraversable</var> to <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url③\">URL</a> using <var>referrerDoc</var>, with <i><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-referrer-policy\" id=\"ref-for-navigation-referrer-policy\">referrerPolicy</a></i> set to <var>prefetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-referrer-policy\" id=\"ref-for-prefetch-record-referrer-policy①\">referrer policy</a>.</p>"
        }
      ]
    },
    {
      "name": "prerendering traversable/update the successor for activation",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-update-the-successor-for-activation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"prerendering traversable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"prerendering-traversable-update-the-successor-for-activation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the successor for activation</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable⑦\">prerendering traversable</a> <var>successorTraversable</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URL</a> <var>startingURL</var>, and a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url③\">URL</a> <var>activationURL</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>successorDocument</var> be <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②\">active document</a>.</p>"
        },
        {
          "html": "If <var>startingURL</var> equals <var>successorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-url\" id=\"ref-for-concept-document-url\">URL</a> and <var>startingURL</var> does not equal <var>activationURL</var>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: <var>successorDocument</var> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#can-have-its-url-rewritten\" id=\"ref-for-can-have-its-url-rewritten\">can have its URL rewritten</a> to <var>activationURL</var>.</p>"
            },
            {
              "html": "<p>Let <var>navigation</var> be <var>successorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigation-api\" id=\"ref-for-window-navigation-api\">navigation API</a>.</p>"
            },
            {
              "html": "<p>Let <var>continue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#fire-a-push/replace/reload-navigate-event\" id=\"ref-for-fire-a-push/replace/reload-navigate-event\">firing a push/replace/reload <code>navigate</code> event</a> at <var>navigation</var> given \"<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-navigationtype-replace\" id=\"ref-for-dom-navigationtype-replace\">replace</a>\", <var>activationURL</var>, and true.</p>"
            },
            {
              "html": "<p>If <var>continue</var> is true, run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#url-and-history-update-steps\" id=\"ref-for-url-and-history-update-steps\">URL and history update steps</a> given <var>successorDocument</var> and <var>activationURL</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "prerendering traversable/activate",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-activate",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"prerendering traversable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"prerendering-traversable-activate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">activate</dfn> a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable⑧\">prerendering traversable</a> <var>successorTraversable</var> in place of a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑤\">top-level traversable</a> <var>predecessorTraversable</var> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior\" id=\"ref-for-history-handling-behavior\">history handling behavior</a> <var>historyHandling</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a> <var>startingURL</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑤\">URL</a> <var>activationURL</var>, an optional <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-id\" id=\"ref-for-navigation-id\">navigation ID</a> <var>navigationId</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document③\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#is-initial-about%3Ablank\" id=\"ref-for-is-initial-about%3Ablank\">is initial about:blank</a> is false.</p>"
        },
        {
          "html": "<p>If <var>navigationId</var> is not given, then let <var>navigationId</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webcrypto/#dfn-generate-a-random-uuid\" id=\"ref-for-dfn-generate-a-random-uuid\">generating a random UUID</a>.</p>"
        },
        {
          "html": "<p>Let <var>referrerOrigin</var> be <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document④\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①\">origin</a>.</p>"
        },
        {
          "html": "<p>Set <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#ongoing-navigation\" id=\"ref-for-ongoing-navigation\">ongoing navigation</a> to <var>navigationId</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">In parallel</a>, run these steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>unloadPromptCanceled</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#checking-if-unloading-is-user-canceled\" id=\"ref-for-checking-if-unloading-is-user-canceled\">checking if unloading is user-canceled</a> for <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑤\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables\">inclusive descendant navigables</a>.</p>"
            },
            {
              "html": "<p>If <var>unloadPromptCanceled</var> is true, or <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#ongoing-navigation\" id=\"ref-for-ongoing-navigation①\">ongoing navigation</a> is no longer <var>navigationId</var>, then abort these steps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#navigation-and-traversal-task-source\" id=\"ref-for-navigation-and-traversal-task-source\">navigation and traversal task source</a> given <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window\">active window</a> to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-lifecycle.html#abort-a-document\" id=\"ref-for-abort-a-document\">abort</a> <var>predecessorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑥\">active document</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-update-the-successor-for-activation\" id=\"ref-for-prerendering-traversable-update-the-successor-for-activation①\">Update the successor for activation</a> given <var>successorTraversable</var>, <var>startingURL</var>, and <var>activationURL</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#tn-append-session-history-traversal-steps\" id=\"ref-for-tn-append-session-history-traversal-steps\">Append session history traversal steps</a> to <var>predecessorTraversable</var> to perform the following steps:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-current-session-history-step\" id=\"ref-for-tn-current-session-history-step\">current session history step</a> is 0.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-session-history-entries\" id=\"ref-for-tn-session-history-entries\">session history entries</a>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> is 1.</p>"
                },
                {
                  "html": "<p>Let <var>successorEntry</var> be <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-session-history-entries\" id=\"ref-for-tn-session-history-entries①\">session history entries</a>[0].</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">Remove</a> <var>successorEntry</var> from <var>successorTraversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-session-history-entries\" id=\"ref-for-tn-session-history-entries②\">session history entries</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#finalize-a-cross-document-navigation\" id=\"ref-for-finalize-a-cross-document-navigation\">Finalize a cross-document navigation</a> given <var>predecessorTraversable</var>, <var>historyHandling</var>, and <var>successorEntry</var>.</p>"
                },
                {
                  "html": "<p>Update the user agent’s user interface to reflect this change, e.g., by updating the tab/window contents and the browser chrome.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-finalize-activation\" id=\"ref-for-prerendering-traversable-finalize-activation①\">Finalize activation</a> for <var>successorTraversable</var> given <var>referrerOrigin</var>.</p>"
                },
                {
                  "html": "<p class=\"XXX\">Perhaps we should do something with WebDriver BiDi here? See <a href=\"https://github.com/w3c/webdriver-bidi/issues/321\">w3c/webdriver-bidi#321</a>. Right now the pre-<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a> part of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate②\">navigate</a> algorithm will send <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-started\" id=\"ref-for-webdriver-bidi-navigation-started\">WebDriver BiDi navigation started</a> as if it were a normal navigation, but then nothing will happen to indicate the navigation finishes. </p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "prerendering traversable/finalize activation",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-finalize-activation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"prerendering traversable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"prerendering-traversable-finalize-activation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">finalize activation</dfn> of a top-level traversable <var>traversable</var> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>navigable</var> of <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑦\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables①\">inclusive descendant navigables</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#navigation-and-traversal-task-source\" id=\"ref-for-navigation-and-traversal-task-source①\">navigation and traversal task source</a>, given <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window①\">active window</a>, to perform the following steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>origin</var> → <var>hintSet</var> in <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable-prerender-scoped-accept-ch-cache\" id=\"ref-for-prerendering-navigable-prerender-scoped-accept-ch-cache\">prerender-scoped Accept-CH cache</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">Set</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#accept-ch-cache\" id=\"ref-for-accept-ch-cache\">Accept-CH cache</a>[<var>origin</var>] to <var>hintSet</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>doc</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑧\">active document</a>.</p>"
            },
            {
              "html": "<p class=\"XXX\">We should really propagate the loading mode change here, in the posted task. This is where implementations would update what is returned by <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#dom-document-prerendering\" id=\"ref-for-dom-document-prerendering③\">document.prerendering</a></code>. However, right now it lives on the traversable, so it gets magically updated when we move over the session history entry. Probably we need to move it to the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑧\">Document</a></code>. </p>"
            },
            {
              "html": "<p>If <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin②\">origin</a> is the same as <var>origin</var>, then set <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-activation-start-time\" id=\"ref-for-document-activation-start-time\">activation start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-high-resolution-time\" id=\"ref-for-dfn-current-high-resolution-time\">current high resolution time</a> for <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#eventdef-document-prerenderingchange\" id=\"ref-for-eventdef-document-prerenderingchange①\">prerenderingchange</a></code> at <var>doc</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>steps</var> in <var>doc</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list②\">post-prerendering activation steps list</a>:",
              "rationale": "run",
              "steps": [
                {
                  "html": "<p>Run <var>steps</var>.</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: running <var>steps</var> did not throw an exception.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "prerendering traversable/remove from referrer",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-remove-from-referrer",
      "html": "A <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable⑨\">prerendering traversable</a> has an associated <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"prerendering traversable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"prerendering-traversable-remove-from-referrer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove from referrer</dfn>, which is null or an algorithm with no arguments, initially set to null. \n    <p>To ensure that the references for a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⓪\">prerendering traversable</a> are cleared once it is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#destroy-a-top-level-traversable\" id=\"ref-for-destroy-a-top-level-traversable②\">destroyed</a>, modify <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#destroy-a-top-level-traversable\" id=\"ref-for-destroy-a-top-level-traversable③\">destroy a top-level traversable</a> by appending the following step:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>traversable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①①\">prerendering traversable</a> and <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-remove-from-referrer\" id=\"ref-for-prerendering-traversable-remove-from-referrer①\">remove from referrer</a> is not null, then call <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-remove-from-referrer\" id=\"ref-for-prerendering-traversable-remove-from-referrer②\">remove from referrer</a>.</p>"
        }
      ]
    },
    {
      "name": "create a new child navigable patch",
      "html": "To ensure that any <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable\" id=\"ref-for-child-navigable①\">child navigables</a> inherit their <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent\">parent</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode⑤\">loading mode</a>, modify <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#create-a-new-child-navigable\" id=\"ref-for-create-a-new-child-navigable\">create a new child navigable</a> by appending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode⑥\">loading mode</a> to <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable②\">node navigable</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode⑦\">loading mode</a>.</p>"
        }
      ]
    },
    {
      "name": "find a matching prerendered prefetch record",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#find-a-matching-prerendered-prefetch-record",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-a-matching-prerendered-prefetch-record\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find a matching prerendered prefetch record</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⓪\">Document</a></code> <var>predecessorDocument</var> and <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a> <var>url</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>recordToUse</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>record</var> of <var>predecessorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#document-prefetch-records\" id=\"ref-for-document-prefetch-records\">prefetch records</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①②\">prerendering traversable</a> is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①③\">prerendering traversable</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①④\">prerendering traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑨\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#is-initial-about%3Ablank\" id=\"ref-for-is-initial-about%3Ablank①\">is initial about:blank</a> is true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "If <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url④\">URL</a> is equal to <var>url</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>recordToUse</var> to <var>record</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "If <var>recordToUse</var> is null and <var>record</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-matches-a-url\" id=\"ref-for-prefetch-record-matches-a-url①\">matches a URL</a> given <var>url</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>recordToUse</var> to <var>record</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>recordToUse</var> is not null:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">Remove</a> <var>recordToUse</var> from <var>predecessorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#document-prefetch-records\" id=\"ref-for-document-prefetch-records①\">prefetch records</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>recordToUse</var>.</p>"
        }
      ]
    },
    {
      "name": "wait for a matching prerendered prefetch record",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#wait-for-a-matching-prerendered-prefetch-record",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"wait-for-a-matching-prerendered-prefetch-record\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">wait for a matching prerendered prefetch record</dfn> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable②\">navigable</a> <var>navigable</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a> <var>url</var>, a string <var>cspNavigationType</var>, and a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#post-resource\" id=\"ref-for-post-resource\">POST resource</a>, string, or null <var>documentResource</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: this is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑥\">top-level traversable</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⑤\">prerendering traversable</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>navigable</var> is a <a href=\"https://github.com/shivanigithub/fenced-frame\">fenced frame</a>;</p>\n        \n       </li><li data-md=\"\">\n        <p><var>cspNavigationType</var> is not \"<code>other</code>\"; or</p>\n       </li><li data-md=\"\">\n        <p><var>documentResource</var> is not null</p>\n      </li></ul>\n      <p>then return null.</p>"
        },
        {
          "html": "<p>Let <var>predecessorDocument</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⓪\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>cutoffTime</var> be null.</p>"
        },
        {
          "html": "While true:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>completeRecord</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#find-a-matching-prerendered-prefetch-record\" id=\"ref-for-find-a-matching-prerendered-prefetch-record\">finding a matching prerendered prefetch record</a> given <var>predecessorDocument</var> and <var>url</var>.</p>"
            },
            {
              "html": "<p>If <var>completeRecord</var> is not null, return <var>completeRecord</var>.</p>"
            },
            {
              "html": "<p>Let <var>potentialRecords</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>record</var> of <var>predecessorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#document-prefetch-records\" id=\"ref-for-document-prefetch-records②\">prefetch records</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If all of the following are true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">append</a> <var>record</var> to <var>potentialRecords</var>:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⑥\">prerendering traversable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⑦\">prerendering traversable</a>;</p>\n           </li><li data-md=\"\">\n            <p><var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⑧\">prerendering traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①①\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#is-initial-about%3Ablank\" id=\"ref-for-is-initial-about%3Ablank②\">is initial about:blank</a> is true;</p>\n           </li><li data-md=\"\">\n            <p><var>record</var> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-is-expected-to-match-a-url\" id=\"ref-for-prefetch-record-is-expected-to-match-a-url\">is expected to match a URL</a> given <var>url</var>; and</p>\n           </li><li data-md=\"\">\n            <p><var>cutoffTime</var> is null or <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-start-time\" id=\"ref-for-prefetch-record-start-time\">start time</a> is less than <var>cutoffTime</var>.</p>\n          </li></ul>"
                }
              ]
            },
            {
              "html": "<p>If <var>potentialRecords</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is empty</a>, return null.</p>"
            },
            {
              "html": "<p>Wait until the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#ongoing-navigation\" id=\"ref-for-ongoing-navigation②\">ongoing navigation</a> of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable①⑨\">prerendering traversable</a> of any element of <var>predecessorDocument</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#document-prefetch-records\" id=\"ref-for-document-prefetch-records③\">prefetch records</a> changes.</p>"
            },
            {
              "html": "<p>If <var>cutoffTime</var> is null and any element of <var>potentialRecords</var> has a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable②⓪\">prerendering traversable</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①②\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#is-initial-about%3Ablank\" id=\"ref-for-is-initial-about%3Ablank③\">is initial about:blank</a> is false, set <var>cutoffTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-high-resolution-time\" id=\"ref-for-dfn-current-high-resolution-time①\">current high resolution time</a> for the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a> of <var>predecessorDocument</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "navigate activate patch",
      "html": "In <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate④\">navigate</a>, insert the following steps as the first ones after we go <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>record</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#wait-for-a-matching-prerendered-prefetch-record\" id=\"ref-for-wait-for-a-matching-prerendered-prefetch-record\">waiting for a matching prerendered prefetch record</a> given <var>navigable</var>, <var>url</var>, <var>cspNavigationType</var>, and <var>documentResource</var>.</p>"
        },
        {
          "html": "If <var>record</var> is not null, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>matchingPrerenderedNavigable</var> be <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable②②\">prerendering traversable</a>.</p>"
            },
            {
              "html": "<p>Let <var>startingURL</var> be <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prefetch.html#prefetch-record-url\" id=\"ref-for-prefetch-record-url⑤\">URL</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-activate\" id=\"ref-for-prerendering-traversable-activate②\">Activate</a> <var>matchingPrerenderedNavigable</var> in place of <var>navigable</var> given <var>historyHandling</var>, <var>startingURL</var>, <var>url</var>, and <var>navigationId</var>.</p>"
            },
            {
              "html": "<p>Abort these steps.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create navigation params by fetching patch",
      "html": "In <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\" id=\"ref-for-create-navigation-params-by-fetching\">create navigation params by fetching</a>, add the following step near the top of the algorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>initiatorOrigin</var> be <var>entry</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state\">document state</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-initiator-origin\" id=\"ref-for-document-state-initiator-origin\">initiator origin</a>.</p>"
        }
      ]
    },
    {
      "name": "create navigation params by fetching patch",
      "html": "Append the following steps after the first sub-step under \"While true:\":",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③\">prerendering navigable</a> and <var>currentURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-site\" id=\"ref-for-same-site①\">same site</a> with <var>initiatorOrigin</var>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑦\">top-level traversable</a>, then return null.</p>"
            },
            {
              "html": "<p>Otherwise, the user agent must wait to continue this algorithm until <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode⑧\">loading mode</a> becomes \"<code>normal</code>\". At any point during this wait (including immediately), it may instead choose to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#destroy-a-top-level-traversable\" id=\"ref-for-destroy-a-top-level-traversable④\">destroy</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable⑧\">top-level traversable</a> and return null from this algorithm.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create navigation params by fetching patch",
      "html": "Append the following steps toward the end of the algorithm, after the steps which check <var>locationURL</var>:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable④\">prerendering navigable</a>, and <var>responseOrigin</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a> with <var>initiatorOrigin</var>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>loadingModes</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#get-the-supported-loading-modes\" id=\"ref-for-get-the-supported-loading-modes\">getting the supported loading modes</a> for <var>response</var>.</p>"
            },
            {
              "html": "<p>If <var>loadingModes</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contain</a> `<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#supports-loading-mode-credentialed-prerender\" id=\"ref-for-supports-loading-mode-credentialed-prerender\">credentialed-prerender</a></code>`, then return null.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "attempt to populate the history entry's document patch",
      "html": "In <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#attempt-to-populate-the-history-entry's-document\" id=\"ref-for-attempt-to-populate-the-history-entry's-document\">attempt to populate the history entry’s document</a>, append the following after the steps which establish the value of <var>failure</var>, but before the other steps which act on it:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "then:",
          "rationale": "destroy",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#destroy-a-top-level-traversable\" id=\"ref-for-destroy-a-top-level-traversable⑤\">Destroy</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable②③\">prerendering traversable</a> and <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-prerender-initial-response-search-variance\" id=\"ref-for-prerendering-traversable-prerender-initial-response-search-variance\">prerender initial response search variance</a> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable-prerender-initial-response-search-variance\" id=\"ref-for-prerendering-traversable-prerender-initial-response-search-variance①\">prerender initial response search variance</a> to the result of <a data-link-type=\"dfn\" href=\"https://httpwg.org/http-extensions/draft-ietf-httpbis-no-vary-search.html#name-obtain-a-url-search-varianc\" id=\"ref-for-name-obtain-a-url-search-varianc\">obtaining a URL search variance</a> given <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-response\" id=\"ref-for-navigation-params-response③\">response</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "hand-off to external software patch",
      "html": "In <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#hand-off-to-external-software\" id=\"ref-for-hand-off-to-external-software\">hand-off to external software</a>, prepend the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable⑥\">prerendering navigable</a>, then return without invoking the external software package.</p>"
        }
      ]
    },
    {
      "name": "navigate historyHandling patch",
      "html": "Patch the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate⑤\">navigate</a> algorithm to ensure the session history of a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable⑦\">prerendering navigable</a> stays trivial by prepending the following step before all others:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable⑧\">prerendering navigable</a>, then set <var>historyHandling</var> to \"<code>replace</code>\".</p>"
        }
      ]
    },
    {
      "name": "URL and history update steps patch",
      "html": "Patch the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#url-and-history-update-steps\" id=\"ref-for-url-and-history-update-steps①\">URL and history update steps</a> by adding the following step after step 1:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable⑨\">prerendering navigable</a>, then set <var>historyHandling</var> to \"<code>replace</code>\".</p>"
        }
      ]
    },
    {
      "name": "discard a Document patch",
      "html": "",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">Empty</a> <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list③\">post-prerendering activation steps list</a>.</p>"
        }
      ]
    },
    {
      "name": "PerformanceNavigationTiming/activationStart",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#dom-performancenavigationtiming-activationstart",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"PerformanceNavigationTiming\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-performancenavigationtiming-activationstart\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>activationStart</code></dfn> getter steps are:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-activation-start-time\" id=\"ref-for-document-activation-start-time①\">activation start time</a>.</p>"
        }
      ]
    },
    {
      "name": "update the client hints set from cache patch",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#update-the-client-hints-set-from-cache\" id=\"ref-for-update-the-client-hints-set-from-cache\">update the client hints set from cache</a> algorithm, by replacing the second step with the following steps.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>originMatchingEntries</var> be the entries in the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#accept-ch-cache\" id=\"ref-for-accept-ch-cache③\">Accept-CH cache</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#accept-ch-cache-origin\" id=\"ref-for-accept-ch-cache-origin\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin\">origin</a>.</p>"
        },
        {
          "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable①④\">prerendering navigable</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>prerenderAcceptClientHintsCache</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable-prerender-scoped-accept-ch-cache\" id=\"ref-for-prerendering-navigable-prerender-scoped-accept-ch-cache①\">prerender-scoped Accept-CH cache</a>.</p>"
            },
            {
              "html": "<p>Let <var>origin</var> be <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin①\">origin</a>.</p>"
            },
            {
              "html": "<p>If <var>prerenderAcceptClientHintsCache</var>[<var>origin</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exists</a>, then let <var>originMatchingEntries</var> be the entries in the <var>prerenderAcceptClientHintsCache</var> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> with <var>origin</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create or override the cached client hints set patch",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#abstract-opdef-create-or-override-the-cached-client-hints-set\" id=\"ref-for-abstract-opdef-create-or-override-the-cached-client-hints-set\">create or override the cached client hints set</a> algorithm, by updating the last step.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global①\">global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①\">navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable①⑤\">prerendering navigable</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">set</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable-prerender-scoped-accept-ch-cache\" id=\"ref-for-prerendering-navigable-prerender-scoped-accept-ch-cache②\">prerender-scoped Accept-CH cache</a>[<var>origin</var>] to <var>hintSet</var>.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">set</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/client-hints-infrastructure#accept-ch-cache\" id=\"ref-for-accept-ch-cache④\">Accept-CH cache</a>[<var>origin</var>] to <var>hintSet</var>.</p>"
        }
      ]
    },
    {
      "name": "clear cache for origin patch",
      "html": "Modify <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-clear-site-data/#abstract-opdef-clear-cache-for-origin\" id=\"ref-for-abstract-opdef-clear-cache-for-origin\">clear cache for origin</a> to add the following step at the end.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①\">top-level traversable</a> <var>traversable</var> in the user agent’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable-set\" id=\"ref-for-top-level-traversable-set\">top-level traversable set</a>:</p>"
        },
        {
          "html": "<p>If <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①③\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin③\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same origin</a> with <var>origin</var>, and <var>traversable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-traversable\" id=\"ref-for-prerendering-traversable②⑤\">prerendering traversable</a>, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#destroy-a-top-level-traversable\" id=\"ref-for-destroy-a-top-level-traversable⑥\">destroy</a> <var>traversable</var>.</p>"
        }
      ]
    },
    {
      "name": "get the supported loading modes",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#get-the-supported-loading-modes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-the-supported-loading-modes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the supported loading modes</dfn> for a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> <var>response</var>:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a>, then return an empty list.</p>"
        },
        {
          "html": "<p>Let <var>slmHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">getting a structured field value</a> given `<a data-link-type=\"http-header\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#http-headerdef-supports-loading-mode\" id=\"ref-for-http-headerdef-supports-loading-mode①\"><code>Supports-Loading-Mode</code></a>` and \"<code>list</code>\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a> containing all elements of <var>slmHeader</var> that are <a data-link-type=\"dfn\" href=\"https://www.rfc-editor.org/rfc/rfc8941.html#name-tokens\" id=\"ref-for-name-tokens②\">tokens</a>.</p>"
        }
      ]
    },
    {
      "name": "download the hyperlink patch",
      "html": "",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>subject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable④\">node navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable①⑨\">prerendering navigable</a>, then append the following step to <var>subject</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list\">post-prerendering activation steps list</a> and return.</p>"
        }
      ]
    },
    {
      "name": "cannot show simple dialogs patch",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#cannot-show-simple-dialogs\" id=\"ref-for-cannot-show-simple-dialogs\">cannot show simple dialogs</a> algorithm, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> <var>window</var>, by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable②\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⓪\">prerendering navigable</a>, then return true.</p>"
        }
      ]
    },
    {
      "name": "window print() patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-print\" id=\"ref-for-dom-print\">print()</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable③\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②①\">prerendering navigable</a>, then return.</p>"
        }
      ]
    },
    {
      "name": "DelayWhilePrerendering method steps",
      "html": "The method steps for any operation annotated with the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#extendedattrdef-delaywhileprerendering\" id=\"ref-for-extendedattrdef-delaywhileprerendering②\">[DelayWhilePrerendering]</a></code> extended attribute are replaced with the following:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm\">current realm</a>.</p>"
        },
        {
          "html": "<p>If the operation in question is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-regular-operation\" id=\"ref-for-dfn-regular-operation①\">regular operation</a>, then set <var>realm</var> to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>.</p>"
        },
        {
          "html": "If <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable④\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②④\">prerendering navigable</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>, created in <var>realm</var>.</p>"
            },
            {
              "html": "Append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list①\">post-prerendering activation steps list</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>result</var> be the result of running the originally-specified steps for this operation, with the same <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a> and arguments.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>promise</var> with <var>result</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If this operation’s <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-return-type\" id=\"ref-for-dfn-return-type①\">return type</a> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-promise-type\" id=\"ref-for-dfn-promise-type①\">promise type</a>, then return <var>promise</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, return the result of running the originally-specified steps for this operation, with the same <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a> and arguments.</p>"
        }
      ]
    },
    {
      "name": "Geolocation getCurrentPosition patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/geolocation/#dom-geolocation-getcurrentposition\" id=\"ref-for-dom-geolocation-getcurrentposition\">getCurrentPosition()</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑤\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⑤\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list②\">post-prerendering activation steps list</a> and return.</p>"
        }
      ]
    },
    {
      "name": "Geolocation watchPosition patch",
      "href": "https://wicg.github.io/nav-speculation/prerendering.html#post-prerendering-activation-geolocation-watch-process-id",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/geolocation/#dom-geolocation-watchposition\" id=\"ref-for-dom-geolocation-watchposition\">watchPosition()</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑥\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⑥\">prerendering navigable</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>watchId</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-long\" id=\"ref-for-idl-unsigned-long\">unsigned long</a></code>, and note it as a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"post-prerendering-activation-geolocation-watch-process-id\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">post-prerendering activation geolocation watch process ID</dfn>.</p>"
            },
            {
              "html": "<p>Append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list③\">post-prerendering activation steps list</a>, with the modification that the <var>watchId</var> generated must use <var>watchId</var> as its ID, and return <var>watchId</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Geolocation clearWatch patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/geolocation/#dom-geolocation-clearwatch\" id=\"ref-for-dom-geolocation-clearwatch\">clearWatch(watchId)</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑦\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⑦\">prerendering navigable</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>watchId</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#post-prerendering-activation-geolocation-watch-process-id\" id=\"ref-for-post-prerendering-activation-geolocation-watch-process-id\">post-prerendering activation geolocation watch process ID</a>, then remove its corresponding steps from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list④\">post-prerendering activation steps list</a>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Serial getPorts patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/serial/#dom-serial-getports\" id=\"ref-for-dom-serial-getports\">getPorts()</a></code> method steps by inserting the following steps after the initial creation of <var>promise</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a>, if <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window③\">Window</a></code>, or <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a>’s owner document, if <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\" id=\"ref-for-dedicatedworkerglobalscope\">DedicatedWorkerGlobalScope</a></code>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is null, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑤\">node navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⑧\">prerendering navigable</a>, then append the following steps to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list④\">post-prerendering activation steps list</a> and return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "Notification constructor patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://notifications.spec.whatwg.org/#dom-notification-notification\" id=\"ref-for-dom-notification-notification\">Notification()</a></code> constructor steps by replacing the step which goes <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a> with the following:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑧\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable②⑨\">prerendering navigable</a>, then append these steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list⑤\">post-prerendering activation steps list</a>. Otherwise, run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>.</p>"
        }
      ]
    },
    {
      "name": "Notification permission patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://notifications.spec.whatwg.org/#dom-notification-permission\" id=\"ref-for-dom-notification-permission\">permission</a></code> static getter steps by replacing them with the following:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object\">current global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑨\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③⓪\">prerendering navigable</a>, then return \"<code>default</code>\".</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://notifications.spec.whatwg.org/#get-the-notifications-permission-state\" id=\"ref-for-get-the-notifications-permission-state\">get the notifications permission state</a> and return it.</p>"
        }
      ]
    },
    {
      "name": "Sensor start patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/sensors/#dom-sensor-start\" id=\"ref-for-dom-sensor-start\">start()</a></code> method steps by inserting the following steps after the state is set to \"<code>activating</code>\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①⓪\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③②\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list⑥\">post-prerendering activation steps list</a> and return.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/sensors/#dom-sensor-state-slot\" id=\"ref-for-dom-sensor-state-slot\">[[state]]</a></code> is \"<code>idle</code>\", then return.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/sensors/#dom-sensor-state-slot\" id=\"ref-for-dom-sensor-state-slot①\">[[state]]</a></code> is \"<code>activating</code>\".</p>"
        }
      ]
    },
    {
      "name": "Navigator getBattery patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/battery/#dom-navigator-getbattery\" id=\"ref-for-dom-navigator-getbattery\">getBattery()</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑤\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①①\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③③\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list⑦\">post-prerendering activation steps list</a> and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/battery/#dfn-batterypromise\" id=\"ref-for-dfn-batterypromise\">[[BatteryPromise]]</a>.</p>"
        }
      ]
    },
    {
      "name": "apply orientation lock patch",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/screen-orientation/#dfn-apply-orientation-lock\" id=\"ref-for-dfn-apply-orientation-lock\">apply orientation lock</a> algorithm steps by overwriting the first few steps, before it goes <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>, as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be a new promise.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑥\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①②\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③④\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list⑧\">post-prerendering activation steps list</a> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①\">user agent</a> does not support locking the screen orientation, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document\">document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set\" id=\"ref-for-active-sandboxing-flag-set\">active sandboxing flag set</a> has the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#sandboxed-orientation-lock-browsing-context-flag\" id=\"ref-for-sandboxed-orientation-lock-browsing-context-flag\">sandboxed orientation lock browsing context flag</a> set, or the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②\">user agent</a> doesn’t meet the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/screen-orientation/#dfn-pre-lock-conditions\" id=\"ref-for-dfn-pre-lock-conditions\">pre-lock conditions</a> to perform an orientation change, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> and return <var>promise</var>.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document①\">document</a>’s [[orientationPendingPromise]] to <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "getGamepads patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dom-navigator-getgamepads\" id=\"ref-for-dom-navigator-getgamepads\">getGamepads()</a></code> method steps by prepending the following step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑦\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①③\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③⑤\">prerendering navigable</a>, then return an empty sequence.</p>"
        }
      ]
    },
    {
      "name": "gamepadconnected post-prerendering",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dfn-gamepadconnected\" id=\"ref-for-dfn-gamepadconnected①\">gamepadconnected</a></code> section to indicate that every <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①④\">Document</a></code> <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list⑤\">post-prerendering activation steps list</a> should gain the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>document</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the \"<code>gamepad</code>\" feature, and <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context\" id=\"ref-for-secure-context\">secure context</a>, and any gamepads are connected, then for each connected gamepad, <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire①\">fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dfn-gamepadconnected\" id=\"ref-for-dfn-gamepadconnected②\">gamepadconnected</a></code> at <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑧\">relevant global object</a> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dom-gamepadevent\" id=\"ref-for-dom-gamepadevent\">GamepadEvent</a></code>, with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dom-gamepadevent-gamepad\" id=\"ref-for-dom-gamepadevent-gamepad\">gamepad</a></code> attribute initialized to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/gamepad/#dom-gamepad\" id=\"ref-for-dom-gamepad\">Gamepad</a></code> object representing the connected gamepad.</p>"
        }
      ]
    },
    {
      "name": "mediacapture device-change path",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/mediacapture-main/#dom-mediadevices\" id=\"ref-for-dom-mediadevices\">MediaDevices</a></code> section by prepending the following step to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/mediacapture-main/#dfn-device-change-notification-steps\" id=\"ref-for-dfn-device-change-notification-steps\">device change notification steps</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑨\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①⑤\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③⑦\">prerendering navigable</a>, then return.</p>"
        }
      ]
    },
    {
      "html": "Also modify <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webaudio.github.io/web-audio-api/#dom-audiocontext-audiocontext\" id=\"ref-for-dom-audiocontext-audiocontext\">AudioContext()</a></code> constructor steps to have the following step before returning the constructed object.",
      "rationale": "set",
      "steps": [
        {
          "html": "Else if <var>context</var> is not <a data-link-type=\"dfn\" href=\"https://webaudio.github.io/web-audio-api/#allowed-to-start\" id=\"ref-for-allowed-to-start②\">allow to start</a> only due to the prerendering, then append the following steps to <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#document-post-prerendering-activation-steps-list\" id=\"ref-for-document-post-prerendering-activation-steps-list⑥\">post-prerendering activation steps list</a>.",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-control-thread-state-slot\" id=\"ref-for-dom-baseaudiocontext-control-thread-state-slot\">[[control thread state]]</a> on <var>context</var> to <a data-link-type=\"dfn\" href=\"https://webaudio.github.io/web-audio-api/#dom-audiocontextstate-running\" id=\"ref-for-dom-audiocontextstate-running\">running</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webaudio.github.io/web-audio-api/#queuing\" id=\"ref-for-queuing\">Queue a control message</a> to resume <var>context</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "dom-navigator-registerProtocolHandler patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#dom-navigator-registerprotocolhandler\" id=\"ref-for-dom-navigator-registerprotocolhandler\">registerProtocolHandler(scheme, url)</a></code> method steps by overwriting the first few steps, before it goes <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>, as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let (<var>normalizedScheme</var>, <var>normalizedURLString</var>) be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#normalize-protocol-handler-parameters\" id=\"ref-for-normalize-protocol-handler-parameters\">normalize protocol handler parameters</a> with scheme, url, and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②⓪\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①⑥\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③⑧\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list⑨\">post-prerendering activation steps list</a> and return.</p>"
        }
      ]
    },
    {
      "name": "dom-navigator-unregisterprotocolhandler patch",
      "html": "Modify the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#dom-navigator-unregisterprotocolhandler\" id=\"ref-for-dom-navigator-unregisterprotocolhandler\">unregisterProtocolHandler(scheme, url)</a></code> method steps by overwriting the first few steps, before it goes <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>, as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let (<var>normalizedScheme</var>, <var>normalizedURLString</var>) be the result of running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/system-state.html#normalize-protocol-handler-parameters\" id=\"ref-for-normalize-protocol-handler-parameters①\">normalize protocol handler parameters</a> with scheme, url, and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②①\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①⑦\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#prerendering-navigable\" id=\"ref-for-prerendering-navigable③⑨\">prerendering navigable</a>, then append the following steps to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#platform-object-post-prerendering-activation-steps-list\" id=\"ref-for-platform-object-post-prerendering-activation-steps-list①⓪\">post-prerendering activation steps list</a> and return.</p>"
        }
      ]
    }
  ]
}