{
  "spec": {
    "title": "Fenced Frame",
    "url": "https://wicg.github.io/fenced-frame/"
  },
  "algorithms": [
    {
      "name": "insertion",
      "html": "When a <code><a data-link-type=\"element\" href=\"https://wicg.github.io/fenced-frame/#elementdef-fencedframe\" id=\"ref-for-elementdef-fencedframe⑨\">fencedframe</a></code> element <var>element</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#insert-an-element-into-a-document\" id=\"ref-for-insert-an-element-into-a-document\">inserted into a\n  document</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc\" id=\"ref-for-concept-document-bc\">browsing context</a> is non-null, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>nested traversable</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#create-a-new-nested-traversable\" id=\"ref-for-create-a-new-nested-traversable\">creating a new\n nested traversable</a> for <var>element</var>.</p>"
        },
        {
          "html": "<p>Set <var>nested traversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#navigable-loading-mode\" id=\"ref-for-navigable-loading-mode\">loading mode</a> to \"<code>fencedframe</code>\".</p>"
        },
        {
          "html": "<p>If <var>element</var> has a <code><a data-link-type=\"element-sub\" href=\"https://wicg.github.io/fenced-frame/#element-attrdef-fencedframe-sandbox\" id=\"ref-for-element-attrdef-fencedframe-sandbox①\">sandbox</a></code> attribute, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive\" id=\"ref-for-parse-a-sandboxing-directive\">parse a sandboxing directive</a> given the attribute’s value and <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframe-fencedframe-sandboxing-flag-set\" id=\"ref-for-fencedframe-fencedframe-sandboxing-flag-set②\">fencedframe sandboxing flag set</a>.</p>"
        }
      ]
    },
    {
      "name": "config-setter",
      "html": "The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-htmlfencedframeelement-config\" id=\"ref-for-dom-htmlfencedframeelement-config①\">config</a></code> IDL attribute setter steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a> is not <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#connected\" id=\"ref-for-connected\">connected</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable①\">fenced navigable</a> is null.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>navigation url or urn</var> be the given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig③\">FencedFrameConfig</a></code>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-url\" id=\"ref-for-fencedframeconfig-url\">url</a> if\n the given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig④\">FencedFrameConfig</a></code>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-url\" id=\"ref-for-fencedframeconfig-url①\">url</a> is not null, and the given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig⑤\">FencedFrameConfig</a></code>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn\">urn</a> otherwise.</p>"
        },
        {
          "html": "<p>If <var>navigation url or urn</var> is failure, then return.</p>"
        },
        {
          "html": "<p>Let <var>shared storage context</var> be the given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig⑥\">FencedFrameConfig</a></code>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-sharedstoragecontext\" id=\"ref-for-fencedframeconfig-sharedstoragecontext\"> sharedStorageContext</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate\">Navigate</a> <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③\">fenced navigable</a> to <var>navigation url or urn</var> using <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a>, with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-hh\" id=\"ref-for-navigation-hh\">historyHandling</a> set\n to \"<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#hh-replace\" id=\"ref-for-hh-replace\"><code>replace</code></a>\", <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-referrer-policy\" id=\"ref-for-navigation-referrer-policy\">referrerPolicy</a> set to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-referrer-policy/#referrer-policy-no-referrer\" id=\"ref-for-referrer-policy-no-referrer\">\"<code>no-referrer</code>\"</a>, and <var>shared storage context</var>.</p>"
        }
      ]
    },
    {
      "name": "fencedframe-attribute-change",
      "html": "The following <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-attributes-change-ext\" id=\"ref-for-concept-element-attributes-change-ext\">attribute change steps</a>, given <var>element</var>, <var>localName</var>, <var>oldValue</var>, <var>value</var>, and <var>namespace</var> are used for all <code><a data-link-type=\"element\" href=\"https://wicg.github.io/fenced-frame/#elementdef-fencedframe\" id=\"ref-for-elementdef-fencedframe①④\">fencedframe</a></code> elements:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>namespace</var> is the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#html-namespace\" id=\"ref-for-html-namespace\">HTML namespace</a>.</p>"
        },
        {
          "html": "If <var>localName</var> is <code><a data-link-type=\"element-sub\" href=\"https://wicg.github.io/fenced-frame/#element-attrdef-fencedframe-sandbox\" id=\"ref-for-element-attrdef-fencedframe-sandbox③\">sandbox</a></code>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">empty</a> <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframe-fencedframe-sandboxing-flag-set\" id=\"ref-for-fencedframe-fencedframe-sandboxing-flag-set③\">fencedframe sandboxing flag\n  set</a>.</p>"
            },
            {
              "html": "<p>Otherwise, run <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#parse-a-sandboxing-directive\" id=\"ref-for-parse-a-sandboxing-directive①\">parse a sandboxing directive</a> given the <var>value</var> and <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframe-fencedframe-sandboxing-flag-set\" id=\"ref-for-fencedframe-fencedframe-sandboxing-flag-set④\">fencedframe sandboxing flag set</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fenced frame config mapping/store a pending config",
      "href": "https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-store-a-pending-config",
      "html": "To <dfn data-dfn-for=\"fenced frame config mapping\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fenced-frame-config-mapping-store-a-pending-config\">store a pending config<a class=\"self-link\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-store-a-pending-config\"></a></dfn> in a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping\" id=\"ref-for-fenced-frame-config-mapping②\">fenced frame\n  config mapping</a> <var>mapping</var> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config⑥\">fenced frame config</a> <var>config</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pendingMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-pending-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-pending-config-mapping\">pending config mapping</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size\">size</a> of <var>pendingMapping</var> + the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size①\">size</a> of <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalized-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-finalized-config-mapping\">finalized config mapping</a> ≥ <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-maximum-number-of-configs\" id=\"ref-for-fenced-frame-config-mapping-maximum-number-of-configs②\">maximum number\n of configs</a>, return failure.</p>"
        },
        {
          "html": "<p>Let <var>urn</var> be a randomly generated <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid④\">urn uuid</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>urn</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a> in <var>pendingMapping</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">Set</a> <var>pendingMapping</var>[<var>urn</var>] to <var>config</var>.</p>"
        },
        {
          "html": "<p>Return <var>urn</var>.</p>"
        }
      ]
    },
    {
      "name": "fenced frame config mapping/finalize a pending config",
      "href": "https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalize-a-pending-config",
      "html": "To <dfn data-dfn-for=\"fenced frame config mapping\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fenced-frame-config-mapping-finalize-a-pending-config\">finalize a pending config<a class=\"self-link\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalize-a-pending-config\"></a></dfn> in a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping\" id=\"ref-for-fenced-frame-config-mapping③\">fenced\n  frame config mapping</a> <var>mapping</var> given a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid⑤\">urn uuid</a> <var>urn</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config⑦\">fenced frame config</a> <var>config</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pendingMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-pending-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-pending-config-mapping①\">pending config mapping</a>.</p>"
        },
        {
          "html": "<p>Let <var>finalizedMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalized-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-finalized-config-mapping①\">finalized config mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>pendingMapping</var>[<var>urn</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exist</a>, return failure.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <var>pendingMapping</var>[<var>urn</var>].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">Set</a> <var>finalizedMapping</var>[<var>urn</var>] to <var>config</var>.</p>"
        }
      ]
    },
    {
      "name": "fenced frame config mapping/store nested configs",
      "href": "https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-store-nested-configs",
      "html": "To <dfn data-dfn-for=\"fenced frame config mapping\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fenced-frame-config-mapping-store-nested-configs\">store nested configs<a class=\"self-link\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-store-nested-configs\"></a></dfn> in a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping\" id=\"ref-for-fenced-frame-config-mapping④\">fenced frame\n  config mapping</a> <var>mapping</var> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs\">nested configs</a> <var>nestedConfigs</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>nestedMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-nested-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-nested-config-mapping\">nested config mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>nestedConfigs</var> is null, return.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>urn</var> → <var>config</var> of <var>nestedConfigs</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">Set</a> <var>nestedMapping</var>[<var>urn</var>] to <var>config</var>.</p>"
            },
            {
              "html": "<p>Set <var>nestedMapping</var>[<var>urn</var>]'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-is-ad-component\" id=\"ref-for-fenced-frame-config-is-ad-component\">is ad component</a> to true.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fenced frame config mapping/find a config",
      "href": "https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-find-a-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fenced frame config mapping\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fenced-frame-config-mapping-find-a-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find a config</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> in a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping\" id=\"ref-for-fenced-frame-config-mapping⑤\">fenced frame config\n  mapping</a> <var>mapping</var> given a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid⑥\">urn uuid</a> <var>urn</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>nestedMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-nested-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-nested-config-mapping①\">nested config mapping</a>.</p>"
        },
        {
          "html": "<p>Let <var>pendingMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-pending-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-pending-config-mapping②\">pending config mapping</a>.</p>"
        },
        {
          "html": "<p>Let <var>finalizedMapping</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalized-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-finalized-config-mapping②\">finalized config mapping</a>.</p>"
        },
        {
          "html": "<p>If <var>nestedMapping</var>[<var>urn</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>, return its value.</p>"
        },
        {
          "html": "<p>If <var>pendingMapping</var>[<var>urn</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>, wait until it does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exist</a>.</p>"
        },
        {
          "html": "<p>If <var>finalizedMapping</var>[<var>urn</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>, return its value.</p>"
        },
        {
          "html": "<p>Return failure.</p>"
        }
      ]
    },
    {
      "name": "finalize a reporting destination",
      "href": "https://wicg.github.io/fenced-frame/#finalize-a-reporting-destination",
      "html": "In order to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"finalize-a-reporting-destination\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">finalize a reporting destination</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span>, given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporting-map\" id=\"ref-for-fencedframetype-fenced-frame-reporting-map①\">fenced\n  frame reporting map</a> <var>reporting map</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#enumdef-fencereportingdestination\" id=\"ref-for-enumdef-fencereportingdestination②\">FenceReportingDestination</a></code> <var>destination</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">map</a> <var>destination map</var> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑥\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑥\">values</a> are <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">urls</a>, and <var>macro map</var>, which is either null or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑦\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑦\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥\">strings</a>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a> that <var>reporting map</var>[<var>destination</var>] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a> (i.e., that <var>destination</var>’s\n metadata has not yet been finalized).</p>"
        },
        {
          "html": "<p>Let <var>pending event list</var> be <var>reporting map</var>[<var>destination</var>].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">Set</a> <var>reporting map</var>[<var>destination</var>] to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑤\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item④\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#reporting-destination-info-reporting-url-map\" id=\"ref-for-reporting-destination-info-reporting-url-map\">reporting url map</a>\n       </dt><dd data-md=\"\">\n        <p><var>destination map</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#reporting-destination-info-reporting-macro-map\" id=\"ref-for-reporting-destination-info-reporting-macro-map\">reporting macro map</a>\n       </dt><dd data-md=\"\">\n        <p><var>macro map</var></p>\n      </dd></dl>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>pending event</var> of <var>pending event list</var>:",
          "rationale": "send",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#send-a-beacon\" id=\"ref-for-send-a-beacon\">Send a beacon</a> with <var>destination map</var> and <var>pending event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#pending-event-event\" id=\"ref-for-pending-event-event\">event</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "send a beacon",
      "href": "https://wicg.github.io/fenced-frame/#send-a-beacon",
      "html": "In order to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-a-beacon\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send a beacon</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> with a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-reporting-destination-info\" id=\"ref-for-fencedframetype-reporting-destination-info①\">reporting destination info</a> <var>destination info</var> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-event\" id=\"ref-for-fencedframetype-destination-event①\">destination event</a> <var>event</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>destination url</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⓪\">string</a>.</p>"
        },
        {
          "html": "<p>Let <var>attributionReportingEligibility</var> be \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-unset\" id=\"ref-for-eligibility-unset\">unset</a></code>\".</p>"
        },
        {
          "html": "<p>Let <var>processResponse</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>useParallelQueue</var> be false.</p>"
        },
        {
          "html": "If <var>event</var> is either a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-enum-event\" id=\"ref-for-fencedframetype-destination-enum-event①\">destination enum event</a> or an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event\" id=\"ref-for-fencedframetype-automatic-beacon-event①\">automatic beacon event</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>destination map</var> be <var>destination info</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#reporting-destination-info-reporting-url-map\" id=\"ref-for-reporting-destination-info-reporting-url-map①\">reporting url map</a>.</p>"
            },
            {
              "html": "<p>Let <var>eventType</var> be either <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-type\" id=\"ref-for-destination-enum-event-type\">destination type</a>, or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-type\" id=\"ref-for-automatic-beacon-event-type\">automatic type</a>, depending on which variant <var>event</var> is.</p>"
            },
            {
              "html": "<p>If <var>destination map</var>[<var>eventType</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exist</a>, return.</p>"
            },
            {
              "html": "<p>Set <var>destination url</var> to <var>destination map</var>[<var>eventType</var>].</p>"
            },
            {
              "html": "If <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-attributionreportingenabled\" id=\"ref-for-destination-enum-event-attributionreportingenabled\">attributionReportingEnabled</a> is true\n  and <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-attributionreportingcontextorigin\" id=\"ref-for-destination-enum-event-attributionreportingcontextorigin\">attributionReportingContextOrigin</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#check-if-an-origin-is-suitable\" id=\"ref-for-check-if-an-origin-is-suitable\">is suitable</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype\">eventType</a></code> matches one of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event-type\" id=\"ref-for-fencedframetype-automatic-beacon-event-type①\">automatic\n beacon event type</a> values, set <var>attributionReportingEligibility</var> to\n \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-navigation-source\" id=\"ref-for-eligibility-navigation-source\">navigation-source</a></code>\".</p>"
                },
                {
                  "html": "<p>Otherwise, set <var>attributionReportingEligibility</var> to \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#eligibility-event-source\" id=\"ref-for-eligibility-event-source\">event-source</a></code>\".</p>"
                },
                {
                  "html": "Set <var>processResponse</var> to these steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> <var>response</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>fenced</var> be true.</p>"
                    },
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#process-an-attribution-eligible-response\" id=\"ref-for-process-an-attribution-eligible-response\">process an attribution eligible response</a> with <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-attributionreportingcontextorigin\" id=\"ref-for-destination-enum-event-attributionreportingcontextorigin①\">attributionReportingContextOrigin</a>, <var>attributionReportingEligibility</var>, <var>fenced</var>, and <var>response</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>useParallelQueue</var> to true.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>event</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-url-event\" id=\"ref-for-fencedframetype-destination-url-event②\">destination URL event</a>.</p>"
            },
            {
              "html": "<p>Let <var>macro map</var> be <var>destination info</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#reporting-destination-info-reporting-macro-map\" id=\"ref-for-reporting-destination-info-reporting-macro-map①\">reporting macro map</a>.</p>"
            },
            {
              "html": "<p>If <var>macro map</var> is null, return.</p>"
            },
            {
              "html": "<p>Set <var>destination url</var> to <var>event</var>.</p>"
            },
            {
              "html": "<p>Let <var>destination url</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros\">substituting macros</a> with <var>macro map</var> into <var>destination url</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Optionally, return.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a>\n       </dt><dd data-md=\"\">\n        <p><code><code>POST</code></code> if <var>event</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-enum-event\" id=\"ref-for-fencedframetype-destination-enum-event②\">destination enum event</a>, otherwise <code><code>GET</code></code>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>destination url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>A new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list\">header list</a> containing a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header\">header</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name\">name</a> is <code>\"Content-Type\"</code> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value\">value</a> is <code>\"text/plain\"</code>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a>\n       </dt><dd data-md=\"\">\n        <p>If <var>event</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-enum-event\" id=\"ref-for-fencedframetype-destination-enum-event③\">destination enum event</a>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body\">body</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source\">source</a> is <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-data\" id=\"ref-for-destination-enum-event-data\">data</a>, otherwise null.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p><code>\"all\"</code></p>\n        \n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><span class=\"XXX\">Get the origin from somewhere, like the <a href=\"https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:content/browser/fenced_frame/fenced_frame_reporter.cc;l=384;drc=183dd920ea5d6aed92e007c40e226f1f840c0567\">implementation\n does</a></span>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p><code>\"no-referrer\"</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode\">mode</a>\n       </dt><dd data-md=\"\">\n        <p><code>\"cors\"</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p><code>\"omit\"</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#request-attribution-reporting-eligibility\" id=\"ref-for-request-attribution-reporting-eligibility\">Attribution Reporting eligibility</a>\n       </dt><dd data-md=\"\">\n        <p><var>attributionReportingEligibility</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response\" id=\"ref-for-process-response\">processResponse</a> being <var>processResponse</var> if it is not null\n and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue\">useParallelQueue</a> being <var>useParallelQueue</var>.</p>"
        }
      ]
    },
    {
      "name": "report an event",
      "href": "https://wicg.github.io/fenced-frame/#report-an-event",
      "html": "In order to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"report-an-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">report an event</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> using a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporter\" id=\"ref-for-fencedframetype-fenced-frame-reporter\">fenced frame reporter</a> <var>reporter</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#enumdef-fencereportingdestination\" id=\"ref-for-enumdef-fencereportingdestination③\">FenceReportingDestination</a></code> <var>destination</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-event\" id=\"ref-for-fencedframetype-destination-event②\">destination event</a> <var>event</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>metadata</var> be <var>reporter</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporter-fenced-frame-reporting-metadata-reference\" id=\"ref-for-fenced-frame-reporter-fenced-frame-reporting-metadata-reference\">fenced frame reporting metadata reference</a>.</p>"
        },
        {
          "html": "If <var>destination</var> is <code>\"direct-seller\"</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>metadata</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-direct-seller-is-seller\" id=\"ref-for-fenced-frame-reporting-metadata-direct-seller-is-seller\">direct seller is seller</a> is true, set <var>destination</var> to <code>\"seller\"</code>.</p>"
            },
            {
              "html": "<p>Otherwise, set <var>destination</var> to <code>\"component-seller\"</code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>event</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-url-event\" id=\"ref-for-fencedframetype-destination-url-event③\">destination URL event</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>event</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a> with any of the entries in <var>metadata</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-allowed-reporting-origins\" id=\"ref-for-fenced-frame-reporting-metadata-allowed-reporting-origins\">allowed reporting origins</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>metadata</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-attempted-custom-url-report-to-disallowed-origin\" id=\"ref-for-fenced-frame-reporting-metadata-attempted-custom-url-report-to-disallowed-origin\">attempted custom url report to disallowed origin</a> to\n true.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>metadata</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-attempted-custom-url-report-to-disallowed-origin\" id=\"ref-for-fenced-frame-reporting-metadata-attempted-custom-url-report-to-disallowed-origin①\">attempted custom url report to disallowed origin</a> is\n  true, return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>reporting map</var> be a reference to <var>metadata</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-fenced-frame-reporting-map\" id=\"ref-for-fenced-frame-reporting-metadata-fenced-frame-reporting-map\">fenced frame reporting map</a>.</p>"
        },
        {
          "html": "<p>If <var>reporting map</var>[<var>destination</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exist</a>, return.</p>"
        },
        {
          "html": "If <var>reporting map</var>[<var>destination</var>] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>newEvent</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-pending-event\" id=\"ref-for-fencedframetype-pending-event①\">pending event</a> with the following:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#pending-event-destination\" id=\"ref-for-pending-event-destination\">destination</a>\n         </dt><dd data-md=\"\">\n          <p><var>destination</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#pending-event-event\" id=\"ref-for-pending-event-event①\">event</a>\n         </dt><dd data-md=\"\">\n          <p><var>event</var></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>newEvent</var> to <var>reporting map</var>[<var>destination</var>].</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a> that <var>reporting map</var>[<var>destination</var>] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧\">map</a> (i.e., that <var>destination</var>’s\n metadata has been finalized).</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#send-a-beacon\" id=\"ref-for-send-a-beacon①\">Send a beacon</a> with <var>reporting map</var>[<var>destination</var>] and <var>event</var>.</p>"
        }
      ]
    },
    {
      "name": "report a private aggregation event",
      "href": "https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event",
      "html": "In order to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"report-a-private-aggregation-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">report a private aggregation event</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> using a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporter\" id=\"ref-for-fencedframetype-fenced-frame-reporter①\">fenced frame\n  reporter</a> <var>reporter</var> with a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①\">string</a> <var>event</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype①\">eventType</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with\">starts with</a> \"<code>reserved.</code>\", then return.</p>"
        },
        {
          "html": "<p><var>reporter</var> <var>event</var> <span class=\"XXX\">TODO: Fill this in</span></p>"
        }
      ]
    },
    {
      "name": "instantiate a config",
      "href": "https://wicg.github.io/fenced-frame/#instantiate-a-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"instantiate-a-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">instantiate a config</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config①⑨\">fenced frame config</a> <var>config</var>, return a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance\" id=\"ref-for-fenced-frame-config-instance②\">fenced frame config instance</a> with the following members: \n    <dl>\n     <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url\">mapped url</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url①\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-container-size\" id=\"ref-for-fenced-frame-config-instance-container-size\">container size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-container-size\" id=\"ref-for-fenced-frame-config-container-size①\">container size</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-content-size\" id=\"ref-for-fenced-frame-config-instance-content-size\">content size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size①\">content size</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size②\">content size</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-value\" id=\"ref-for-content-size-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-instance-interest-group-descriptor\">interest group descriptor</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor\">interest group descriptor</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor①\">interest group descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-value\" id=\"ref-for-interest-group-descriptor-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-on-navigate-callback\" id=\"ref-for-fenced-frame-config-instance-on-navigate-callback\">on navigate callback</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback\">on navigate callback</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-instance-effective-sandboxing-flags\">effective sandboxing flags</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags\">effective sandboxing flags</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags①\">effective sandboxing flags</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-instance-effective-enabled-permissions\">effective enabled permissions</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①\">effective enabled permissions</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions②\">effective enabled permissions</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-value\" id=\"ref-for-effective-enabled-permissions-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter\">fenced frame reporter</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-exfiltration-budget-metadata-reference\" id=\"ref-for-fenced-frame-config-instance-exfiltration-budget-metadata-reference\">exfiltration budget metadata reference</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs①\">nested configs</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-partition-nonce\" id=\"ref-for-fenced-frame-config-instance-partition-nonce\">partition nonce</a>\n     </dt><dd data-md=\"\">\n      <p>a random, unique <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#partition-nonce\" id=\"ref-for-partition-nonce①\">partition nonce</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-instance-embedder-shared-storage-context\">embedder shared storage context</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context\">embedder shared storage context</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component\">is ad component</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-is-ad-component\" id=\"ref-for-fenced-frame-config-is-ad-component①\">is ad component</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-instance-cross-origin-reporting-allowed\">cross-origin reporting allowed</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-cross-origin-reporting-allowed\">cross-origin reporting allowed</a></p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-fenced-frame-reporting-metadata\" id=\"ref-for-fenced-frame-config-fenced-frame-reporting-metadata\">fenced frame reporting metadata</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-value\" id=\"ref-for-fenced-frame-reporting-metadata-value\">value</a> is null, set to null.</p>"
        },
        {
          "html": "<p>Otherwise, set to a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporter\" id=\"ref-for-fencedframetype-fenced-frame-reporter③\">fenced frame reporter</a> with the following\n members:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporter-fenced-frame-reporting-metadata-reference\" id=\"ref-for-fenced-frame-reporter-fenced-frame-reporting-metadata-reference①\">fenced frame reporting metadata reference</a>\n         </dt><dd data-md=\"\">\n          <p>a reference to <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-fenced-frame-reporting-metadata\" id=\"ref-for-fenced-frame-config-fenced-frame-reporting-metadata①\">fenced frame reporting metadata</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-value\" id=\"ref-for-fenced-frame-reporting-metadata-value①\">value</a></p>\n        </dd></dl>"
        }
      ]
    },
    {
      "name": "instantiate a config",
      "href": "https://wicg.github.io/fenced-frame/#instantiate-a-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"instantiate-a-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">instantiate a config</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config①⑨\">fenced frame config</a> <var>config</var>, return a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance\" id=\"ref-for-fenced-frame-config-instance②\">fenced frame config instance</a> with the following members: \n    <dl>\n     <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url\">mapped url</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url①\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-container-size\" id=\"ref-for-fenced-frame-config-instance-container-size\">container size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-container-size\" id=\"ref-for-fenced-frame-config-container-size①\">container size</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-content-size\" id=\"ref-for-fenced-frame-config-instance-content-size\">content size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size①\">content size</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size②\">content size</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-value\" id=\"ref-for-content-size-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-instance-interest-group-descriptor\">interest group descriptor</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor\">interest group descriptor</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor①\">interest group descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-value\" id=\"ref-for-interest-group-descriptor-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-on-navigate-callback\" id=\"ref-for-fenced-frame-config-instance-on-navigate-callback\">on navigate callback</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback\">on navigate callback</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-instance-effective-sandboxing-flags\">effective sandboxing flags</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags\">effective sandboxing flags</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags①\">effective sandboxing flags</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-instance-effective-enabled-permissions\">effective enabled permissions</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①\">effective enabled permissions</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions②\">effective enabled permissions</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-value\" id=\"ref-for-effective-enabled-permissions-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter\">fenced frame reporter</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-exfiltration-budget-metadata-reference\" id=\"ref-for-fenced-frame-config-instance-exfiltration-budget-metadata-reference\">exfiltration budget metadata reference</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs①\">nested configs</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-partition-nonce\" id=\"ref-for-fenced-frame-config-instance-partition-nonce\">partition nonce</a>\n     </dt><dd data-md=\"\">\n      <p>a random, unique <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#partition-nonce\" id=\"ref-for-partition-nonce①\">partition nonce</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-instance-embedder-shared-storage-context\">embedder shared storage context</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context\">embedder shared storage context</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component\">is ad component</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-is-ad-component\" id=\"ref-for-fenced-frame-config-is-ad-component①\">is ad component</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-instance-cross-origin-reporting-allowed\">cross-origin reporting allowed</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-cross-origin-reporting-allowed\">cross-origin reporting allowed</a></p>\n    </dd></dl>",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-exfiltration-budget-metadata\" id=\"ref-for-fenced-frame-config-exfiltration-budget-metadata\">exfiltration budget metadata</a> is null, set to null.</p>"
        },
        {
          "html": "<p>Otherwise, set to a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-exfiltration-budget-metadata-reference\" id=\"ref-for-fencedframetype-exfiltration-budget-metadata-reference①\">exfiltration budget metadata reference</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-reference-origin\" id=\"ref-for-exfiltration-budget-metadata-reference-origin\">origin</a>\n         </dt><dd data-md=\"\">\n          <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-exfiltration-budget-metadata\" id=\"ref-for-fenced-frame-config-exfiltration-budget-metadata①\">exfiltration budget metadata</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-value\" id=\"ref-for-exfiltration-budget-metadata-value\">value</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-origin\" id=\"ref-for-exfiltration-budget-metadata-origin\">origin</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-reference-amount-to-debit-reference\" id=\"ref-for-exfiltration-budget-metadata-reference-amount-to-debit-reference\">amount to debit reference</a>\n         </dt><dd data-md=\"\">\n          <p>a reference to <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-exfiltration-budget-metadata\" id=\"ref-for-fenced-frame-config-exfiltration-budget-metadata②\">exfiltration budget metadata</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-value\" id=\"ref-for-exfiltration-budget-metadata-value①\">value</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#exfiltration-budget-metadata-amount-to-debit\" id=\"ref-for-exfiltration-budget-metadata-amount-to-debit\">amount to\n debit</a></p>\n        </dd></dl>"
        }
      ]
    },
    {
      "name": "instantiate a config",
      "href": "https://wicg.github.io/fenced-frame/#instantiate-a-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"instantiate-a-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">instantiate a config</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config①⑨\">fenced frame config</a> <var>config</var>, return a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance\" id=\"ref-for-fenced-frame-config-instance②\">fenced frame config instance</a> with the following members: \n    <dl>\n     <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url\">mapped url</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url①\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-container-size\" id=\"ref-for-fenced-frame-config-instance-container-size\">container size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-container-size\" id=\"ref-for-fenced-frame-config-container-size①\">container size</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-content-size\" id=\"ref-for-fenced-frame-config-instance-content-size\">content size</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size①\">content size</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size②\">content size</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-value\" id=\"ref-for-content-size-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-instance-interest-group-descriptor\">interest group descriptor</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor\">interest group descriptor</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor①\">interest group descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-value\" id=\"ref-for-interest-group-descriptor-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-on-navigate-callback\" id=\"ref-for-fenced-frame-config-instance-on-navigate-callback\">on navigate callback</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback\">on navigate callback</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-instance-effective-sandboxing-flags\">effective sandboxing flags</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags\">effective sandboxing flags</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags①\">effective sandboxing flags</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-instance-effective-enabled-permissions\">effective enabled permissions</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①\">effective enabled permissions</a> if null, otherwise <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions②\">effective enabled permissions</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-value\" id=\"ref-for-effective-enabled-permissions-value\">value</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter\">fenced frame reporter</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-exfiltration-budget-metadata-reference\" id=\"ref-for-fenced-frame-config-instance-exfiltration-budget-metadata-reference\">exfiltration budget metadata reference</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs①\">nested configs</a>\n     </dt><dd data-md=\"\">\n      \n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-partition-nonce\" id=\"ref-for-fenced-frame-config-instance-partition-nonce\">partition nonce</a>\n     </dt><dd data-md=\"\">\n      <p>a random, unique <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#partition-nonce\" id=\"ref-for-partition-nonce①\">partition nonce</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-instance-embedder-shared-storage-context\">embedder shared storage context</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context\">embedder shared storage context</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component\">is ad component</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-is-ad-component\" id=\"ref-for-fenced-frame-config-is-ad-component①\">is ad component</a></p>\n     </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-instance-cross-origin-reporting-allowed\">cross-origin reporting allowed</a>\n     </dt><dd data-md=\"\">\n      <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-cross-origin-reporting-allowed\">cross-origin reporting allowed</a></p>\n    </dd></dl>",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-nested-configs\" id=\"ref-for-fenced-frame-config-nested-configs\">nested configs</a> is null, set to null.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>results</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪\">map</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>nested config</var> of <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-nested-configs\" id=\"ref-for-fenced-frame-config-nested-configs①\">nested\n configs</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-value\" id=\"ref-for-nested-configs-value\">value</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>urn</var> be a randomly generated <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid⑧\">urn uuid</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">Set</a> <var>results</var>[<var>urn</var>] to <var>nested config</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs②\">nested configs</a> to <var>results</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "FencedFrameConfig/FencedFrameConfig(url)",
      "href": "https://wicg.github.io/fenced-frame/#dom-fencedframeconfig-fencedframeconfig",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"FencedFrameConfig\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"FencedFrameConfig(url)|constructor(url)\" id=\"dom-fencedframeconfig-fencedframeconfig\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>FencedFrameConfig(<var>url</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> constructor method steps\n  are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>config</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig①④\">FencedFrameConfig</a></code> object.</p>"
        },
        {
          "html": "<p>Set <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-url\" id=\"ref-for-fencedframeconfig-url③\">url</a> to the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">URL parser</a> on <var>url</var>.</p>"
        },
        {
          "html": "<p>Return <var>config</var>.</p>"
        }
      ]
    },
    {
      "name": "FencedFrameConfig serializer",
      "html": "<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig①⑤\">FencedFrameConfig</a></code> objects are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#serializable-objects\" id=\"ref-for-serializable-objects\">serializable objects</a>. Their <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#serialization-steps\" id=\"ref-for-serialization-steps\">serialization steps</a>, given <var>value</var>, <var>serialized</var>, and <var>forStorage</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>forStorage</var> is true, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#datacloneerror\" id=\"ref-for-datacloneerror\">DataCloneError</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>serialized</var>.[[Url]] to <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-url\" id=\"ref-for-fencedframeconfig-url④\">url</a>.</p>"
        },
        {
          "html": "<p>Set <var>serialized</var>.[[Urn]] to <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn③\">urn</a>.</p>"
        },
        {
          "html": "<p>Set <var>serialized</var>.[[SharedStorageContext]] to <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-sharedstoragecontext\" id=\"ref-for-fencedframeconfig-sharedstoragecontext②\"> sharedStorageContext</a>.</p>"
        }
      ]
    },
    {
      "name": "FencedFrameConfig deserializer",
      "html": "Their <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#deserialization-steps\" id=\"ref-for-deserialization-steps\">deserialization steps</a>, given <var>serialized</var>, <var>value</var>, and <var> targetRealm</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Initialize <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-url\" id=\"ref-for-fencedframeconfig-url⑤\">url</a> to <var>serialized</var>.[[Url]].</p>"
        },
        {
          "html": "<p>Initialize <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn④\">urn</a> to <var>serialized</var>.[[Urn]].</p>"
        },
        {
          "html": "<p>Initialize <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-sharedstoragecontext\" id=\"ref-for-fencedframeconfig-sharedstoragecontext③\">sharedStorageContext</a> to <var>serialized</var>.[[SharedStorageContext]].</p>"
        }
      ]
    },
    {
      "name": "fencedframeutil/substitute macros",
      "href": "https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fencedframeutil\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fencedframeutil-substitute-macros\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">substitute macros</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> with an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①\">ordered map</a> with <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑨\">keys</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">string</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑨\">values</a> <var>macros</var> into a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">string</a> <var>string</var>, run\n  these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><span class=\"XXX\">TODO:</span> <a href=\"https://github.com/WICG/fenced-frame/issues/116\">Spec this</a>.\n Substitute the keys from <var>macros</var> with the corresponding values into <var>string</var>, and return the\n new string. There is no recursive substitution.</p>"
        }
      ]
    },
    {
      "name": "Navigator/deprecatedReplaceInURN(urnOrConfig, replacements)",
      "href": "https://wicg.github.io/fenced-frame/#dom-navigator-deprecatedreplaceinurn",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-deprecatedreplaceinurn\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>deprecatedReplaceInURN(<var>urnOrConfig</var>, <var>replacements</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>urn</var> be null.</p>"
        },
        {
          "html": "<p>If <var>urnOrConfig</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString⑥\">USVString</a></code>, set <var>urn</var> to <var>urnOrConfig</var>.</p>"
        },
        {
          "html": "<p>Otherwise, set <var>urn</var> to <var>urnOrConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn⑤\">urn</a>.</p>"
        },
        {
          "html": "<p>If <var>urn</var> is not a valid <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid①②\">urn uuid</a> (i.e., won’t pass the ABNF in Section 3 of <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid①③\">urn uuid</a>), <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">For each</a> <var>key</var> → _ of <var>replacements</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>key</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with①\">start with</a> <code>${</code> or <code>%%</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>If <var>key</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-ends-with\" id=\"ref-for-string-ends-with\">end with</a> <code>}</code> or <code>%%</code>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>mapping</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable\">navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable\">traversable navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-fenced-frame-config-mapping\" id=\"ref-for-traversable-navigable-fenced-frame-config-mapping①\">fenced frame config mapping</a>.</p>"
            },
            {
              "html": "<p>Let <var>config</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-find-a-config\" id=\"ref-for-fenced-frame-config-mapping-find-a-config\">finding a config</a> in <var>mapping</var> with <var>urn</var>.</p>"
            },
            {
              "html": "<p>If <var>config</var> is failure, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source\">DOM manipulation task source</a> given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">resolve</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined②\">undefined</a></code>, and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>substitutedUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros①\">substituting macros</a> with <var>replacements</var> into <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url④\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value①\">value</a>.</p>"
            },
            {
              "html": "<p>Set <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url⑤\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value②\">value</a> to <var>substitutedUrl</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①\">DOM manipulation task source</a> given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined③\">undefined</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "Navigator/deprecatedURNtoURL(urnOrConfig, send_reports)",
      "href": "https://wicg.github.io/fenced-frame/#dom-navigator-deprecatedurntourl",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"deprecatedURNtoURL(urnOrConfig, send_reports)|deprecatedURNtoURL(urnOrConfig)\" id=\"dom-navigator-deprecatedurntourl\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>deprecatedURNtoURL(<var>urnOrConfig</var>, <var>send_reports</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> method\n  steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>urn</var> be null.</p>"
        },
        {
          "html": "<p>If <var>urnOrConfig</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString⑦\">USVString</a></code>, set <var>urn</var> to <var>urnOrConfig</var>.</p>"
        },
        {
          "html": "<p>Otherwise, set <var>urn</var> to <var>urnOrConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn⑥\">urn</a>.</p>"
        },
        {
          "html": "<p>If <var>urn</var> is not a valid <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid①④\">urn uuid</a> (i.e., won’t pass the ABNF in Section 3 of <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid①⑤\">urn uuid</a>), <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>mapping</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①\">navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable①\">traversable navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-fenced-frame-config-mapping\" id=\"ref-for-traversable-navigable-fenced-frame-config-mapping②\">fenced frame config mapping</a>.</p>"
            },
            {
              "html": "<p>If <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalized-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-finalized-config-mapping③\">finalized config mapping</a>[<var>urn</var>], does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exist</a>, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source②\">DOM manipulation task source</a> given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">resolve</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined④\">undefined</a></code>, and abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>config</var> be <var>mapping</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalized-config-mapping\" id=\"ref-for-fenced-frame-config-mapping-finalized-config-mapping④\">finalized config mapping</a>[<var>urn</var>].</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source③\">DOM manipulation task source</a> given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolve</a> <var>p</var> with <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url⑥\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value③\">value</a>.</p>"
            },
            {
              "html": "<p>If <var>send_reports</var> is true, then run the steps in <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback①\">on navigate callback</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "Navigator/adAuctionComponents(numAdComponents)",
      "href": "https://wicg.github.io/fenced-frame/#dom-navigator-adauctioncomponents",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-adauctioncomponents\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>adAuctionComponents(<var>numAdComponents</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>instance</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①\">fenced frame config instance</a>.</p>"
        },
        {
          "html": "<p>If <var>instance</var> is null, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin\">origin</a> and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url①\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same\norigin</a>, then then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>maxAdComponents</var> be 40.</p>"
        },
        {
          "html": "<p>If <var>numAdComponents</var> &gt; <var>maxAdComponents</var>, then set <var>numAdComponents</var> to <var>maxAdComponents</var>.</p>"
        },
        {
          "html": "<p>Let <var>adComponentsURNs</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn⑦\">urn</a>s.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②\">For each</a> <var>urn</var> → <var>config</var> of <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs③\">nested configs</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>numAdComponents</var> equals 0, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">break</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>urn</var> to <var>adComponentsURNs</var>.</p>"
            },
            {
              "html": "<p>Set <var>numAdComponents</var> to <var>numAdComponents</var> − 1.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>adComponentsURNs</var>.</p>"
        }
      ]
    },
    {
      "name": "Fence/reportEvent(event)",
      "href": "https://wicg.github.io/fenced-frame/#dom-fence-reportevent",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Fence\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"reportEvent(event)|reportEvent()\" id=\"dom-fence-reportevent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>reportEvent(<var>event</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>instance</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc①\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance②\">fenced frame config instance</a>.</p>"
        },
        {
          "html": "<p>If <var>instance</var> is null, then return.</p>"
        },
        {
          "html": "<p>If <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component①\">is ad component</a> is true, then return.</p>"
        },
        {
          "html": "<p>If <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter①\">fenced frame reporter</a> is null, then return.</p>"
        },
        {
          "html": "If <var>event</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑦\">DOMString</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin①\">origin</a> and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url②\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same\n  origin</a>, then return.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#report-a-private-aggregation-event\" id=\"ref-for-report-a-private-aggregation-event\">report a private aggregation event</a> using <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter②\">fenced frame reporter</a> with <var>event</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>event</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dictdef-fenceevent\" id=\"ref-for-dictdef-fenceevent②\">FenceEvent</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype②\">eventType</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with②\">starts with</a> \"<code>reserved.</code>\", then return.</p>"
            },
            {
              "html": "<p>If all of the following conditions are true:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin②\">origin</a> and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url③\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin③\">origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same\norigin</a>;</p>\n         </li><li data-md=\"\">\n          <p>either <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-crossoriginexposed\" id=\"ref-for-dom-fenceevent-crossoriginexposed\">crossOriginExposed</a></code> is false or <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-instance-cross-origin-reporting-allowed①\">cross-origin reporting allowed</a> is false;</p>\n        </li></ul>\n        <p>then return.</p>"
            },
            {
              "html": "If <var>event</var> has a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destinationurl\" id=\"ref-for-dom-fenceevent-destinationurl\">destinationURL</a></code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>event</var> has a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destination\" id=\"ref-for-dom-fenceevent-destination\">destination</a></code> or a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype③\">eventType</a></code> or a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventdata\" id=\"ref-for-dom-fenceevent-eventdata\">eventData</a></code>:",
                  "rationale": "throw",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④\">TypeError</a></code>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>destinationURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①\">URL parser</a> on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destinationurl\" id=\"ref-for-dom-fenceevent-destinationurl①\">destinationURL</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑤\">TypeError</a></code> if any of the following conditions hold:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>destinationURL</var> is failure;</p>\n           </li><li data-md=\"\">\n            <p><var>destinationURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> is not \"<code>https</code>\";</p>\n          </li></ul>"
                },
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#report-an-event\" id=\"ref-for-report-an-event①\">report an event</a> using <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter③\">fenced frame\n reporter</a> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fencereportingdestination-buyer\" id=\"ref-for-dom-fencereportingdestination-buyer\">buyer</a></code> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-url-event\" id=\"ref-for-fencedframetype-destination-url-event④\">destination URL event</a> that is <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destinationurl\" id=\"ref-for-dom-fenceevent-destinationurl②\">destinationURL</a></code>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>event</var> does not have a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destination\" id=\"ref-for-dom-fenceevent-destination①\">destination</a></code> or <var>event</var> does not have a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype④\">eventType</a></code>:",
                  "rationale": "throw",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑥\">TypeError</a></code>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>document</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a>.</p>"
                },
                {
                  "html": "<p>Let <var>attributionReportingEnabled</var> be the result of determining whether <var>document</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the \"<code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-permissionpolicy-attribution-reporting\" id=\"ref-for-dom-permissionpolicy-attribution-reporting\">attribution-reporting</a></code></code>\" feature.</p>"
                },
                {
                  "html": "<p>Let <var>attributionReportingContextOrigin</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/attribution-reporting-api/#node-context-origin\" id=\"ref-for-node-context-origin\">context origin</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>destination</var> of <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destination\" id=\"ref-for-dom-fenceevent-destination②\">destination</a></code>:",
                  "rationale": "run",
                  "steps": [
                    {
                      "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#report-an-event\" id=\"ref-for-report-an-event②\">report an event</a> using <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter④\">fenced frame\n reporter</a> with <var>destination</var> and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-destination-enum-event\" id=\"ref-for-fencedframetype-destination-enum-event④\">destination enum event</a> with the\n following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②①\">items</a>:</p>\n            <dl>\n             <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-type\" id=\"ref-for-destination-enum-event-type①\">type</a>\n             </dt><dd data-md=\"\">\n              <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype⑤\">eventType</a></code></p>\n             </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#destination-enum-event-data\" id=\"ref-for-destination-enum-event-data①\">data</a>\n             </dt><dd data-md=\"\">\n              <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventdata\" id=\"ref-for-dom-fenceevent-eventdata①\">eventData</a></code> (or the empty string if it is not defined).</p>\n            </dd></dl>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Fence/setReportEventDataForAutomaticBeacons(event)",
      "href": "https://wicg.github.io/fenced-frame/#dom-fence-setreporteventdataforautomaticbeacons",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Fence\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"setReportEventDataForAutomaticBeacons(event)|setReportEventDataForAutomaticBeacons()\" id=\"dom-fence-setreporteventdataforautomaticbeacons\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>setReportEventDataForAutomaticBeacons(<var>event</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>event</var> does not have a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destination\" id=\"ref-for-dom-fenceevent-destination③\">destination</a></code> or <var>event</var> does not have a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype⑥\">eventType</a></code>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑦\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑦\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype⑦\">eventType</a></code> does not match one of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event-type\" id=\"ref-for-fencedframetype-automatic-beacon-event-type②\">automatic\n beacon event type</a> values, return.</p>"
        },
        {
          "html": "<p>Let <var>instance</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc②\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance③\">fenced frame config instance</a>.</p>"
        },
        {
          "html": "<p>If <var>instance</var> is null, then return.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object③\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin③\">origin</a> and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url④\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin④\">origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin④\">same\n origin</a>, then return.</p>"
        },
        {
          "html": "<p>If <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter⑤\">fenced frame reporter</a> is null, then return.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#document-automatic-beacon-data-map\" id=\"ref-for-document-automatic-beacon-data-map\">automatic\n beacon data map</a>[<var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventtype\" id=\"ref-for-dom-fenceevent-eventtype⑧\">eventType</a></code>] to an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-data\" id=\"ref-for-fencedframetype-automatic-beacon-data\">automatic beacon\n data</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②②\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-eventdata\" id=\"ref-for-automatic-beacon-data-eventdata\">eventData</a>\n       </dt><dd data-md=\"\">\n        <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-eventdata\" id=\"ref-for-dom-fenceevent-eventdata②\">eventData</a></code> if defined and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component②\">is ad component</a> is false, otherwise empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑧\">string</a>.</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-destination\" id=\"ref-for-automatic-beacon-data-destination\">destination</a>\n       </dt><dd data-md=\"\">\n        <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-destination\" id=\"ref-for-dom-fenceevent-destination④\">destination</a></code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-once\" id=\"ref-for-automatic-beacon-data-once\">once</a>\n       </dt><dd data-md=\"\">\n        <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-once\" id=\"ref-for-dom-fenceevent-once\">once</a></code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-crossoriginexposed\" id=\"ref-for-automatic-beacon-data-crossoriginexposed\">crossOriginExposed</a>\n       </dt><dd data-md=\"\">\n        <p><var>event</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fenceevent-crossoriginexposed\" id=\"ref-for-dom-fenceevent-crossoriginexposed①\">crossOriginExposed</a></code></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Fence/getNestedConfigs()",
      "href": "https://wicg.github.io/fenced-frame/#dom-fence-getnestedconfigs",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Fence\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-fence-getnestedconfigs\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getNestedConfigs()</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>instance</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc③\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance④\">fenced frame config instance</a>.</p>"
        },
        {
          "html": "<p>If <var>instance</var> is null, then return.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object④\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin④\">origin</a> and <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url⑤\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑤\">origin</a> are not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑤\">same\n origin</a>, then return.</p>"
        },
        {
          "html": "<p>If <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs④\">nested configs</a> is null, then return.</p>"
        },
        {
          "html": "<p>Let <var>results</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①②\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig②⓪\">FencedFrameConfig</a></code>s.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③\">For each</a> <var>urn</var> → <var>config</var> of <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-nested-configs\" id=\"ref-for-fenced-frame-config-instance-nested-configs⑤\">nested\n configs</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>newConfig</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig\" id=\"ref-for-fencedframeconfig②①\">FencedFrameConfig</a></code> object created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant\n  realm</a>, with the following:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-urn\" id=\"ref-for-fencedframeconfig-urn⑧\">urn</a>\n         </dt><dd data-md=\"\">\n          <p><var>urn</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeconfig-sharedstoragecontext\" id=\"ref-for-fencedframeconfig-sharedstoragecontext④\">sharedStorageContext</a>\n         </dt><dd data-md=\"\">\n          <p><var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context①\">embedder shared storage context</a></p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">Append</a> <var>newConfig</var> to <var>results</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>results</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to send an automatic beacon",
      "href": "https://wicg.github.io/fenced-frame/#attempt-to-send-an-automatic-beacon",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-send-an-automatic-beacon\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to send an automatic beacon</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params\" id=\"ref-for-source-snapshot-params\">source snapshot params</a> <var>sourceSnapshotParams</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥\">origin</a> <var>sourceOrigin</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑦\">Document</a></code> <var>targetDocument</var>, and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event-type\" id=\"ref-for-fencedframetype-automatic-beacon-event-type③\">automatic beacon event type</a> <var>eventType</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>targetDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable①\">traversable navigable</a> is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#top-level-traversable\" id=\"ref-for-top-level-traversable①\">top-level\n traversable</a>, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-activation\" id=\"ref-for-source-snapshot-params-activation\">has transient activation</a> is set to\n false, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-initiator-fenced-frame-config-instance\" id=\"ref-for-source-snapshot-params-initiator-fenced-frame-config-instance\">initiator fenced frame config\n instance</a>.</p>"
        },
        {
          "html": "<p>If <var>config</var> is null, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>beacon data</var> be <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-automatic-beacon-data-map\" id=\"ref-for-source-snapshot-params-automatic-beacon-data-map\">automatic beacon data\n map</a>[<var>eventType</var>].</p>"
        },
        {
          "html": "<p>Let <var>has header opt in</var> be <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-automatic-beacons-allowed\" id=\"ref-for-source-snapshot-params-automatic-beacons-allowed\">automatic beacons\n allowed</a>.</p>"
        },
        {
          "html": "<p>If <var>beacon data</var> is null and <var>has header opt in</var> is false, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>is cross origin</var> be true if <var>sourceOrigin</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑥\">same origin</a> with <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url⑥\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑥\">origin</a>, false otherwise.</p>"
        },
        {
          "html": "<p>If <var>is cross origin</var> is true and <var>has header opt in</var> is false, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>should send beacon with data</var> be true if <var>beacon data</var> is not null and either <var>is cross origin</var> is false or <var>beacon data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-crossoriginexposed\" id=\"ref-for-automatic-beacon-data-crossoriginexposed①\">crossOriginExposed</a> is\n true, false otherwise.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>destination</var> of <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter⑥\">fenced frame\n reporter</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporter-fenced-frame-reporting-metadata-reference\" id=\"ref-for-fenced-frame-reporter-fenced-frame-reporting-metadata-reference②\">fenced frame reporting metadata reference</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporting-map\" id=\"ref-for-fencedframetype-fenced-frame-reporting-map③\">fenced frame reporting map</a>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①⓪\">keys</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#report-an-event\" id=\"ref-for-report-an-event④\">report an event</a> using <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-fenced-frame-reporter\" id=\"ref-for-fenced-frame-config-instance-fenced-frame-reporter⑦\">fenced frame\n reporter</a> with <var>destination</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event\" id=\"ref-for-fencedframetype-automatic-beacon-event②\">automatic beacon event</a> with the\n following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②③\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-type\" id=\"ref-for-automatic-beacon-event-type②\">type</a>\n         </dt><dd data-md=\"\">\n          <p><var>eventType</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-data\" id=\"ref-for-automatic-beacon-event-data\">data</a>\n         </dt><dd data-md=\"\">\n          <p><var>beacon data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-eventdata\" id=\"ref-for-automatic-beacon-data-eventdata①\">eventData</a> if <var>should send beacon with data</var> is\n  true, <var>beacon data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-destination\" id=\"ref-for-automatic-beacon-data-destination①\">destinations</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> <var>destination</var>, and <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-is-ad-component\" id=\"ref-for-fenced-frame-config-instance-is-ad-component③\">is ad component</a> is false,\n  the empty string otherwise.</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-attributionreportingenabled\" id=\"ref-for-automatic-beacon-event-attributionreportingenabled\">attributionReportingEnabled</a>\n         </dt><dd data-md=\"\">\n          <p><var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-attribution-reporting-enabled\" id=\"ref-for-source-snapshot-params-attribution-reporting-enabled\">attribution reporting enabled</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-attributionreportingcontextorigin\" id=\"ref-for-automatic-beacon-event-attributionreportingcontextorigin\">attributionReportingContextOrigin</a>\n         </dt><dd data-md=\"\">\n          <p><var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-attribution-reporting-context-origin\" id=\"ref-for-source-snapshot-params-attribution-reporting-context-origin\">attribution reporting context origin</a></p>\n        </dd></dl>"
            }
          ]
        },
        {
          "html": "<p>If <var>beacon data</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-data-once\" id=\"ref-for-automatic-beacon-data-once①\">once</a> is true, set <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-automatic-beacon-data-map\" id=\"ref-for-source-snapshot-params-automatic-beacon-data-map①\">automatic beacon data map</a>[<var>eventType</var>] to null.</p>"
        }
      ]
    },
    {
      "name": "top_navigation_start beacon patch",
      "html": "Modify <a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate⑤\">navigate</a> algorithm. Add a new step after step 4 that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#attempt-to-send-an-automatic-beacon\" id=\"ref-for-attempt-to-send-an-automatic-beacon\">Attempt to send an automatic beacon</a> given <var>sourceSnapshotParams</var>, <var>initiatorOriginSnapshot</var>, <var>navigable</var>’s associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑧\">Document</a></code>,\n and <code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-type-reservedtop_navigation_start\" id=\"ref-for-automatic-beacon-event-type-reservedtop_navigation_start①\">reserved.top_navigation_start</a></code>.</p>"
        }
      ]
    },
    {
      "name": "top_navigation_commit beacon patch",
      "html": "Modify <a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#attempt-to-populate-the-history-entry's-document\" id=\"ref-for-attempt-to-populate-the-history-entry's-document\">attempt to populate the history entry’s document</a> algorithm. In step 6,\n  substep 11, add a new step after step 5 that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>failure</var> is false, then:",
          "rationale": "attempt",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#attempt-to-send-an-automatic-beacon\" id=\"ref-for-attempt-to-send-an-automatic-beacon①\">Attempt to send an automatic beacon</a> given <var>sourceSnapshotParams</var>, <var>entry</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state\">document state</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-initiator-origin\" id=\"ref-for-document-state-initiator-origin\">initiator origin</a>, <var>document</var>, and <code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-type-reservedtop_navigation_commit\" id=\"ref-for-automatic-beacon-event-type-reservedtop_navigation_commit②\">reserved.top_navigation_commit</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#attempt-to-send-an-automatic-beacon\" id=\"ref-for-attempt-to-send-an-automatic-beacon②\">Attempt to send an automatic beacon</a> given <var>sourceSnapshotParams</var>, <var>entry</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state①\">document state</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-initiator-origin\" id=\"ref-for-document-state-initiator-origin①\">initiator origin</a>, <var>document</var>, and <code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#automatic-beacon-event-type-reservedtop_navigation\" id=\"ref-for-automatic-beacon-event-type-reservedtop_navigation②\">reserved.top_navigation</a></code>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Window/fence",
      "href": "https://wicg.github.io/fenced-frame/#dom-window-fence",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Window\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-window-fence\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>fence</code></dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> getter steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc④\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance⑤\">fenced frame config instance</a> is not null, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#window-fence\" id=\"ref-for-window-fence\">fence</a>.</p>"
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "creating a new browsing context and document patch",
      "html": "Add a substep to step 4 of this algorithm (that was modified above) that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>browsingContext</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance⑥\">fenced frame config instance</a> to <var>creator</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc\" id=\"ref-for-concept-document-bc①\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance⑦\">fenced frame config\n instance</a>.</p>"
        }
      ]
    },
    {
      "name": "local-policy-inheritance-determine-params",
      "html": "Rewrite step 3 to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>responseURL</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#is-local\" id=\"ref-for-is-local①\">is local</a>, <var>initiatorPolicyContainer</var> is not null, and <var>fenced</var> false,\n then return a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container\" id=\"ref-for-clone-a-policy-container\">clone</a> of <var>initiatorPolicyContainer</var>.</p>"
        }
      ]
    },
    {
      "name": "local-policy-inheritance-populate-session-history-entry",
      "html": "Add a step before step 23 of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\" id=\"ref-for-create-navigation-params-by-fetching\">create navigation params by fetching</a> that says:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>fenced</var> be true if <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑦\">fenced navigable</a>,\n  false otherwise.</p>"
        }
      ]
    },
    {
      "name": "local-policy-inheritance-populate-session-history-entry",
      "html": "Rewrite step 23 (now step 24) to read:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>resultPolicyContainer</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#determining-navigation-params-policy-container\" id=\"ref-for-determining-navigation-params-policy-container①\">determining navigation params\n  policy container</a> given <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url\">URL</a>, <var> entry</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state②\">document state</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-history-policy-container\" id=\"ref-for-document-state-history-policy-container\">history policy container</a>, <var> sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-policy-container\" id=\"ref-for-source-snapshot-params-policy-container\">source policy container</a>, null, <var>responsePolicyContainer</var>, and <var>fenced</var>.</p>"
        }
      ]
    },
    {
      "name": "navigable/unfenced parent",
      "href": "https://wicg.github.io/fenced-frame/#navigable-unfenced-parent",
      "html": "To get the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"navigable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"navigable-unfenced-parent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced parent</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> of a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable③\">navigable</a> <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable\" id=\"ref-for-child-navigable④\">child navigable</a>, return <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①\">parent</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable①⑤\">fenced navigable</a>.</p>"
        },
        {
          "html": "<p>Return <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent③\">unfenced parent</a>.</p>"
        }
      ]
    },
    {
      "name": "navigable/unfenced container document",
      "href": "https://wicg.github.io/fenced-frame/#navigable-unfenced-container-document",
      "html": "To get the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"navigable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"navigable-unfenced-container-document\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced container document</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> of a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable⑤\">navigable</a> <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parentNavigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigable-unfenced-parent\" id=\"ref-for-navigable-unfenced-parent①\">unfenced parent</a>.</p>"
        },
        {
          "html": "<p>Return <var>parentNavigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①\">active document</a>.</p>"
        }
      ]
    },
    {
      "name": "initialize the nested traversable",
      "href": "https://wicg.github.io/fenced-frame/#initialize-the-nested-traversable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-nested-traversable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the nested traversable</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> <var>traversable</var> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state③\">document state</a> <var>documentState</var> and a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable⑦\">navigable</a> <var>parent</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#initialize-the-navigable\" id=\"ref-for-initialize-the-navigable\">Initialize the navigable</a> <var>traversable</var> given <var>documentState</var>.</p>"
        },
        {
          "html": "<p>Set <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent⑥\">unfenced parent</a> to <var>parent</var>.</p>"
        }
      ]
    },
    {
      "name": "create a new nested traversable",
      "href": "https://wicg.github.io/fenced-frame/#create-a-new-nested-traversable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-new-nested-traversable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new nested traversable</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given an element <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>group</var> be a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context-group\" id=\"ref-for-browsing-context-group⑤\">browsing context group</a>.</p>"
        }
      ]
    },
    {
      "name": "create a new nested traversable",
      "href": "https://wicg.github.io/fenced-frame/#create-a-new-nested-traversable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-new-nested-traversable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new nested traversable</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given an element <var>element</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be the second return value of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#creating-a-new-browsing-context\" id=\"ref-for-creating-a-new-browsing-context①\">creating a new browsing context and document</a> given <var>element</var> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document①\">node document</a>, <var>element</var>, and <var>group</var>.</p>"
        },
        {
          "html": "<p>Let <var>documentState</var> be a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-document-state\" id=\"ref-for-she-document-state④\">document state</a>, whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#document-state-document\" id=\"ref-for-document-state-document\">document</a> is <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>traversable</var> be a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable⑨\">traversable navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>parentNavigable</var> be <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#initialize-the-nested-traversable\" id=\"ref-for-initialize-the-nested-traversable\">Initialize the nested traversable</a> <var>traversable</var> given <var>documentState</var> and <var>parentNavigable</var>.</p>"
        },
        {
          "html": "<p>Set <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable①⑥\">fenced navigable</a> to <var>traversable</var>.</p>"
        },
        {
          "html": "<p>Let <var>initialHistoryEntry</var> be <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-active-history-entry\" id=\"ref-for-nav-active-history-entry\">active session history entry</a>.</p>"
        },
        {
          "html": "<p>Set <var>initialHistoryEntry</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#she-step\" id=\"ref-for-she-step\">step</a> to 0.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-append\" id=\"ref-for-concept-node-append\">Append</a> <var>initialHistoryEntry</var> to <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-session-history-entries\" id=\"ref-for-tn-session-history-entries\">session history\n entries</a>.</p>"
        },
        {
          "html": "<p>Return <var>traversable</var>.</p>"
        }
      ]
    },
    {
      "name": "navigable/top-level traversable",
      "href": "https://wicg.github.io/fenced-frame/#navigable-top-level-traversable",
      "html": "To get the <dfn data-dfn-for=\"navigable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"navigable-top-level-traversable\">top-level traversable<a class=\"self-link\" href=\"https://wicg.github.io/fenced-frame/#navigable-top-level-traversable\"></a></dfn> of a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable⑧\">navigable</a> <var>inputNavigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>inputNavigable</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while\">While</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent⑨\">parent</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent⑨\">unfenced parent</a> are\n both null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">break</a>.</p>"
            },
            {
              "html": "<p>Set <var>navigable</var> to <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①⓪\">parent</a> or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent①⓪\">unfenced\n parent</a>, whichever is non-null.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>navigable</var>.</p>"
        }
      ]
    },
    {
      "name": "inclusive-descendant-navigables-patch",
      "href": "https://wicg.github.io/fenced-frame/#inclusive-dn-unfenced",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables\">inclusive descendant navigables</a> algorithm to take a new optional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①②\">boolean</a> argument <var><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"inclusive-dn-unfenced\" data-noexport=\"\" id=\"inclusive-dn-unfenced\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span></var> that defaults to\n  false. \n    <p>Further rewrite step 2 of this algorithm to:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend\">Extend</a> <var>navigables</var> with <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables\" id=\"ref-for-descendant-navigables②\">descendant navigables</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#dn-unfenced\" id=\"ref-for-dn-unfenced\">unfenced</a> set to <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#inclusive-dn-unfenced\" id=\"ref-for-inclusive-dn-unfenced\">unfenced</a></var>.</p>"
        }
      ]
    },
    {
      "name": "descendant-navigables-patch",
      "href": "https://wicg.github.io/fenced-frame/#dn-unfenced",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables\" id=\"ref-for-descendant-navigables③\">descendant navigables</a> algorithm to take a new optional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①③\">boolean</a> argument <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"dn-unfenced\" data-noexport=\"\" id=\"dn-unfenced\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> that defaults to false, and rewrite the algorithm\n  like so:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigables</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①④\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigableContainers</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑤\">list</a> of all <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-descendant\" id=\"ref-for-concept-shadow-including-descendant\">shadow-including descendants</a> of <var>document</var> that are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable-container\" id=\"ref-for-navigable-container②\">navigable containers</a> (or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers①\">fenced navigable containers</a>, if <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#dn-unfenced\" id=\"ref-for-dn-unfenced①\">unfenced</a></var> is true), in <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-shadow-including-tree-order\" id=\"ref-for-concept-shadow-including-tree-order\">shadow-including tree order</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>navigableContainer</var> of <var>navigableContainers</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>navigableContainer</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable②\">content navigable</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②①\">fenced navigable</a> are both null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>descendantNavigable</var> be either <var>navigableContainer</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable③\">content\n navigable</a> or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②②\">fenced navigable</a>, whichever is non-null.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend①\">Extend</a> <var>navigables</var> with <var>descendantNavigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②\">active document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables①\">inclusive descendant navigables</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#inclusive-dn-unfenced\" id=\"ref-for-inclusive-dn-unfenced①\">unfenced</a> set to <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#dn-unfenced\" id=\"ref-for-dn-unfenced②\">unfenced</a></var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>navigables</var>.</p>"
        }
      ]
    },
    {
      "name": "focusing-steps-patch",
      "href": "https://wicg.github.io/fenced-frame/#focus-unfenced",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps②\">focusing steps</a> to take a new optional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①④\">boolean</a> argument <var><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"focus-unfenced\" data-noexport=\"\" id=\"focus-unfenced\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span></var> that defaults to false. \n    <p>Add a new step after step 3 of the algorithm (that changes new focus target) that reads:</p>\n    \n    <p>Add a new step after the step that defines the <var>new chain</var> variable, that reads:</p>\n    \n    <p>Modify the user agent sentence after the algorithm steps in <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps③\">focusing steps</a> to read:</p>\n    <p>User agents must <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/#immediately\" id=\"ref-for-immediately\">immediately</a> run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps④\">focusing steps</a> for a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusable-area\" id=\"ref-for-focusable-area\">focusable area</a> or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable⑨\">navigable</a> <var>candidate</var> with <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced①\">unfenced</a></var> set to true whenever the\n  user attempts to move the focus to <var>candidate</var>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>new focus target</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers③\">fenced navigable container</a> with non-null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②④\">fenced navigable</a>, then set <var>new focus target</var> to the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②⑤\">fenced navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document③\">active document</a>.</p>"
        }
      ]
    },
    {
      "name": "focusing-steps-patch",
      "href": "https://wicg.github.io/fenced-frame/#focus-unfenced",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps②\">focusing steps</a> to take a new optional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①④\">boolean</a> argument <var><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"focus-unfenced\" data-noexport=\"\" id=\"focus-unfenced\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unfenced</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span></var> that defaults to false. \n    <p>Add a new step after step 3 of the algorithm (that changes new focus target) that reads:</p>\n    \n    <p>Add a new step after the step that defines the <var>new chain</var> variable, that reads:</p>\n    \n    <p>Modify the user agent sentence after the algorithm steps in <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps③\">focusing steps</a> to read:</p>\n    <p>User agents must <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/#immediately\" id=\"ref-for-immediately\">immediately</a> run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps④\">focusing steps</a> for a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusable-area\" id=\"ref-for-focusable-area\">focusable area</a> or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable\" id=\"ref-for-navigable⑨\">navigable</a> <var>candidate</var> with <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced①\">unfenced</a></var> set to true whenever the\n  user attempts to move the focus to <var>candidate</var>.</p>",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced\">unfenced</a></var> is false, <var>new chain</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⑧\">Document</a></code> <var>document</var> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable②\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable②\">traversable navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②⑥\">fenced navigable</a>, and <var>old chain</var> does not also <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contain</a> <var>document</var>, then return.</p>"
        }
      ]
    },
    {
      "name": "access-key-patch",
      "html": "Modify the action of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interactive-elements.html#using-the-accesskey-attribute-to-define-a-command-on-other-elements\" id=\"ref-for-using-the-accesskey-attribute-to-define-a-command-on-other-elements\">accesskey attribute command</a> algorithm to be:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps⑤\">focusing steps</a> for the element with <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced②\">unfenced</a></var> set to true.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#fire-a-click-event\" id=\"ref-for-fire-a-click-event\">Fire a <code>click</code> event</a> at the element.</p>"
        }
      ]
    },
    {
      "name": "hide-popover-patch",
      "html": "Modify step 10 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/popover.html#hide-popover-algorithm\" id=\"ref-for-hide-popover-algorithm\">hide popover algorithm</a> to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>previouslyFocusedElement</var> is not null, then:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interactive-elements.html#previously-focused-element\" id=\"ref-for-previously-focused-element\">previously focused element</a> to null.</p>"
            },
            {
              "html": "<p>If <var>focusPreviousElement</var> is true, then run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps⑦\">focusing steps</a> for <var>previouslyFocusedElement</var> with <var><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced④\">unfenced</a></var> set to true; the\nviewport should not be scrolled by doing this step.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "has-focus-steps",
      "html": "Add a step after step 2 of the while loop in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#has-focus-steps\" id=\"ref-for-has-focus-steps\">has focus steps</a> algorithm that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focused-area-of-the-document\" id=\"ref-for-focused-area-of-the-document\">focused area</a> of <var>candidate</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers④\">fenced navigable container</a> with a non-null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②⑦\">fenced navigable</a>, then set <var>candidate</var> to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document④\">active\ndocument</a> of that <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers⑤\">fenced navigable container</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable②⑧\">fenced\nnavigable</a>.</p>"
        }
      ]
    },
    {
      "name": "focus-chain",
      "html": "Modify step 3 of the while loop in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focus-chain\" id=\"ref-for-focus-chain\">focus chain</a> algorithm to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>currentObject</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusable-area\" id=\"ref-for-focusable-area④\">focusable area</a>, then set <var>currentObject</var> to <var>currentObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#dom-anchor\" id=\"ref-for-dom-anchor\">DOM\n anchor</a>'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document②\">node document</a>.</p>\n      <p>Otherwise, if <var>currentObject</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⑨\">Document</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable③\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①②\">parent</a> is non-null, then set <var>currentObject</var> to <var>currentObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable④\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①③\">parent</a>.</p>\n      <p>Otherwise, if <var>currentObject</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⓪\">Document</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑤\">node navigable</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable①⑦\">traversable\n navigable</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent①②\">unfenced parent</a> is non-null, then set <var>currentObject</var> to <var>currentObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑥\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-unfenced-parent\" id=\"ref-for-traversable-navigable-unfenced-parent①③\">unfenced\n parent</a>.</p>\n      <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">break</a>.</p>"
        }
      ]
    },
    {
      "name": "get-the-focusable-area",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#get-the-focusable-area\" id=\"ref-for-get-the-focusable-area\">get the focusable area</a> algorithm. Add a new case to the switch statement:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If focus target is a fenced navigable container with a non-null fenced navigable",
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers⑦\">fenced navigable container</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③⓪\">fenced\n    navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑤\">active document</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "currently-focused-area-of-a-top-level-traversable",
      "html": "Modify step 3 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#currently-focused-area-of-a-top-level-traversable\" id=\"ref-for-currently-focused-area-of-a-top-level-traversable\">currently focused area of a top-level traversable</a> algorithm to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>While <var>candidate</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focused-area-of-the-document\" id=\"ref-for-focused-area-of-the-document①\">focused area</a> is either a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable-container\" id=\"ref-for-navigable-container③\">navigable container</a> with a non-null <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable④\">content navigable</a> or a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers⑧\">fenced navigable container</a> with a non-null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③①\">fenced navigable</a>: set <var>candidate</var> to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑥\">active\n document</a> of either that <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable-container\" id=\"ref-for-navigable-container④\">navigable container</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable⑤\">content navigable</a> or that <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers⑨\">fenced navigable container</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③②\">fenced navigable</a>,\n whichever is non-null.</p>"
        }
      ]
    },
    {
      "name": "sequential-focus-navigation-patch",
      "html": "Modify step 6 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation\" id=\"ref-for-sequential-focus-navigation\">sequential focus navigation</a> algorithm to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>candidate</var> is not null, then run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusing-steps\" id=\"ref-for-focusing-steps①①\">focusing steps</a> for <var>candidate</var> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#focus-unfenced\" id=\"ref-for-focus-unfenced⑦\">unfenced</a> set to true and return.</p>"
        }
      ]
    },
    {
      "name": "sequential-focus-navigation-patch",
      "html": "Modify step 9 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#sequential-focus-navigation\" id=\"ref-for-sequential-focus-navigation①\">sequential focus navigation</a> algorithm to read:",
      "rationale": "/^otherwise(\\,| )/i",
      "steps": [
        {
          "html": "<p>Otherwise, <var>starting point</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#focusable-area\" id=\"ref-for-focusable-area⑤\">focusable area</a> whose <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document③\">node document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑦\">node\n navigable</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable\" id=\"ref-for-child-navigable⑥\">child navigable</a> or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③③\">fenced navigable</a>. Set <var>starting point</var> to that <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑧\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigable-unfenced-parent\" id=\"ref-for-navigable-unfenced-parent②\">unfenced parent</a> and return to the\n step labeled <i>loop</i>.</p>"
        }
      ]
    },
    {
      "name": "sequential-navigation-search-patch",
      "html": "Modify step 2 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#sequential-navigation-search-algorithm\" id=\"ref-for-sequential-navigation-search-algorithm\">sequential navigation search algorithm</a> to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>candidate</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable-container\" id=\"ref-for-navigable-container⑤\">navigable container</a> with a non-null <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable⑥\">content navigable</a>, then let <var>new candidate</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#sequential-navigation-search-algorithm\" id=\"ref-for-sequential-navigation-search-algorithm①\">sequential navigation search algorithm</a> with <var>candidate</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#content-navigable\" id=\"ref-for-content-navigable⑦\">content navigable</a> as the first argument, <var>direction</var> as\nthe second, and <i>sequential</i> as the third.</p>\n      <p>If <var>candidate</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers①⓪\">fenced navigable container</a> with a non-null <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③④\">fenced navigable</a>, then let <var>new candidate</var> be the result of\nrunning the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#sequential-navigation-search-algorithm\" id=\"ref-for-sequential-navigation-search-algorithm②\">sequential navigation search algorithm</a> with <var>candidate</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③⑤\">fenced navigable</a> as the first argument, <var>direction</var> as the second, and <i>sequential</i> as the third.</p>\n      <p>If <var>new candidate</var> is null, then let <var>starting point</var> be <var>candidate</var>, and return to the top of this algorithm. Otherwise, let <var>candidate</var> be <var>new candidate</var>.</p>"
        }
      ]
    },
    {
      "name": "navigation-patch",
      "html": "<a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#attempt-to-populate-the-history-entry's-document\" id=\"ref-for-attempt-to-populate-the-history-entry's-document①\">attempt to populate the history entry’s document</a> algorithm is modified such that\n  just before the step inside the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">queued task</a> starting with \"If <var>failure</var> is true, then:\", insert a new step:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Otherwise, if all of the following conditions are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-navigable\" id=\"ref-for-navigation-params-navigable\">navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable③\">traversable navigable</a> is\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable③⑧\">fenced navigable</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-response\" id=\"ref-for-navigation-params-response\">response</a>'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url①\">URL</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a> is\n\"<code>https</code>\"; and</p>\n       </li><li data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/nav-speculation/prerendering.html#get-the-supported-loading-modes\" id=\"ref-for-get-the-supported-loading-modes\">getting the supported loading modes</a> for <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-response\" id=\"ref-for-navigation-params-response①\">response</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contain</a> `<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#supports-loading-mode-fenced-frame\" id=\"ref-for-supports-loading-mode-fenced-frame\">fenced-frame</a></code>`</p>\n      </li></ul>\n      <p>then set <var>failure</var> to true.</p>"
        }
      ]
    },
    {
      "name": "corp-patch",
      "html": "Next, we modify how the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check\" id=\"ref-for-cross-origin-resource-policy-check\">cross-origin resource policy check</a> <a href=\"https://html.spec.whatwg.org/C#populating-a-session-history-entry:cross-origin-resource-policy-check\">applies\n  to navigation requests</a>. Rewrite step 19, substep 13 of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\" id=\"ref-for-create-navigation-params-by-fetching①\">create navigation params by\n  fetching</a> algorithm like so:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a>, <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable\" id=\"ref-for-child-navigable⑧\">child navigable</a> or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable④②\">fenced navigable</a>, and the result of performing a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check\" id=\"ref-for-cross-origin-resource-policy-check①\">cross-origin\n resource policy check</a> with <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigable-unfenced-container-document\" id=\"ref-for-navigable-unfenced-container-document①\">unfenced container document</a>'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①\">origin</a>, <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigable-unfenced-container-document\" id=\"ref-for-navigable-unfenced-container-document②\">unfenced container document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑤\">relevant\n settings object</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑤\">destination</a>, <var>response</var>, and\n true is <strong>blocked</strong>, then set <var>response</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①\">network error</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">break</a>.</p>"
        }
      ]
    },
    {
      "name": "get the automatic beacon data mapping to use",
      "href": "https://wicg.github.io/fenced-frame/#get-the-automatic-beacon-data-mapping-to-use",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-automatic-beacon-data-mapping-to-use\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the automatic beacon data mapping to use</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑤\">Document</a></code> <var>sourceDocument</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a> these steps are running on <var>sourceDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#event-loop\" id=\"ref-for-event-loop\">event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>automatic beacon data map</var> be a new empty <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#document-automatic-beacon-data-map\" id=\"ref-for-document-automatic-beacon-data-map①\">automatic beacon data map</a>.</p>"
        },
        {
          "html": "<p>Let <var>current navigable</var> be <var>sourceDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑨\">node navigable</a>.</p>"
        },
        {
          "html": "While <var>current navigable</var> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate④\">For each</a> <var>type</var> → <var>data</var> of <var>current navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑦\">active\n document</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#document-automatic-beacon-data-map\" id=\"ref-for-document-automatic-beacon-data-map②\">automatic beacon data map</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>automatic beacon data map</var>[<var>type</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exist</a>, set <var>automatic beacon data map</var>[<var>type</var>] to <var>data</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>current navigable</var> to <var>current navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①④\">parent</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>automatic beacon data map</var>.</p>"
        }
      ]
    },
    {
      "name": "navigate",
      "html": "Insert these steps immediately after step 20, the step that goes <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a>, so that what\n  follows are the first steps that run <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a> in the patched algorithm:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>url</var> is a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#urn-uuid\" id=\"ref-for-urn-uuid①⑥\">urn uuid</a> and <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable④⑤\">fenced\n navigable</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>config</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-find-a-config\" id=\"ref-for-fenced-frame-config-mapping-find-a-config①\">finding a\n config</a> in <var>sourceDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①①\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable④\">traversable\n navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-fenced-frame-config-mapping\" id=\"ref-for-traversable-navigable-fenced-frame-config-mapping③\">fenced frame config mapping</a>.</p>"
            },
            {
              "html": "<p>Set <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context②\">embedder shared storage context</a> to <var>sharedStorageContext</var>.</p>"
            },
            {
              "html": "<p>Set <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-target-fenced-frame-config\" id=\"ref-for-source-snapshot-params-target-fenced-frame-config①\">target fenced frame\n config</a> to <var>config</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a> <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url⑦\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value④\">value</a> is a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a> whose <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme②\">scheme</a> is \"<code>https</code>\".</p>"
            },
            {
              "html": "<p>Set <var>url</var> to <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url⑧\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value⑤\">value</a>.</p>"
            },
            {
              "html": "<p>Run steps in <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback②\">on navigate callback</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "navigate",
      "html": "Rewrite the step starting with \"Let <var>unloadPromptCanceled</var> be the result of\" to:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>unloadPromptCanceled</var> be false if <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable④⑥\">fenced\n navigable</a>, or the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#checking-if-unloading-is-user-canceled\" id=\"ref-for-checking-if-unloading-is-user-canceled\">checking if unloading is user-canceled</a> for <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑧\">active document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#inclusive-descendant-navigables\" id=\"ref-for-inclusive-descendant-navigables②\">inclusive descendant navigables</a> otherwise.</p>"
        }
      ]
    },
    {
      "name": "navigate",
      "html": "Add a step after step 22.8.2 (Let <var>finalSandboxFlags</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">union</a>...) that reads:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-target-fenced-frame-config\" id=\"ref-for-source-snapshot-params-target-fenced-frame-config②\">target fenced frame config</a> is not null,\n and if <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-target-fenced-frame-config\" id=\"ref-for-source-snapshot-params-target-fenced-frame-config③\">target fenced frame config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags②\">effective sandboxing flags</a> is not null, then set <var>finalSandboxFlags</var> to\n the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union①\">union</a> of <var>finalSandboxFlags</var> and <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-target-fenced-frame-config\" id=\"ref-for-source-snapshot-params-target-fenced-frame-config④\">target fenced frame config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags③\">effective sandboxing flags</a>' <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value①\">value</a>.</p>"
        }
      ]
    },
    {
      "name": "create-and-initialize-document-patch",
      "html": "Modify <a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#initialise-the-document-object\" id=\"ref-for-initialise-the-document-object\">create and initialize a Document object</a> algorithm to insert one step after\n  step 2 that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigation-params-fenced-frame-config-instance\" id=\"ref-for-navigation-params-fenced-frame-config-instance③\">fenced frame config instance</a> is not null:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: <var>browsingContext</var> does not equal <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-navigable\" id=\"ref-for-navigation-params-navigable①\">navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc\" id=\"ref-for-nav-bc②\">active browsing context</a>.</p>"
            },
            {
              "html": "<p>Set <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigation-params-fenced-frame-config-instance\" id=\"ref-for-navigation-params-fenced-frame-config-instance⑤\">fenced frame config instance</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-cross-origin-reporting-allowed\" id=\"ref-for-fenced-frame-config-cross-origin-reporting-allowed①\">cross-origin reporting allowed</a> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">get a\n structured field value</a> on <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-response\" id=\"ref-for-navigation-params-response②\">response</a>'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a> given <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/fenced-frame/#http-headerdef-allow-cross-origin-event-reporting\" id=\"ref-for-http-headerdef-allow-cross-origin-event-reporting①\">Allow-Cross-Origin-Event-Reporting</a></code>`</span> and \"<code>item</code>\".</p>"
            },
            {
              "html": "<p>Set <var>browsingContext</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①③\">fenced frame config instance</a> to <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#navigation-params-fenced-frame-config-instance\" id=\"ref-for-navigation-params-fenced-frame-config-instance⑥\">fenced frame config instance</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create-and-initialize-document-patch",
      "html": "Add a new step after step 9 that reads:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>automaticBeaconsAllowed</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header①\">get a structured field\n  value</a> on <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-response\" id=\"ref-for-navigation-params-response③\">response</a>'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①\">header list</a> given <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/fenced-frame/#http-headerdef-allow-fenced-frame-automatic-beacons\" id=\"ref-for-http-headerdef-allow-fenced-frame-automatic-beacons①\">Allow-Fenced-Frame-Automatic-Beacons</a></code>`</span> and \"<code>item</code>\".</p>"
        }
      ]
    },
    {
      "name": "attempt-populate-history-bcg-swap",
      "html": "Modify <a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#attempt-to-populate-the-history-entry's-document\" id=\"ref-for-attempt-to-populate-the-history-entry's-document②\">attempt to populate the history entry’s document</a> algorithm. Add a step\n  before the step that reads \"6. <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#navigation-and-traversal-task-source\" id=\"ref-for-navigation-and-traversal-task-source\">navigation and traversal task\n  source</a>\", that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If all of the following conditions are true:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑤⓪\">fenced navigable</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params-client\" id=\"ref-for-source-snapshot-params-client\">fetch client</a> is <strong>not</strong> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑨\">active document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑥\">relevant settings object</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>navigationParams</var> is non-null</p>\n      </li></ul>\n      <p>then set <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-coop-enforcement-result\" id=\"ref-for-navigation-params-coop-enforcement-result\">COOP enforcement result</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#coop-enforcement-bcg-switch\" id=\"ref-for-coop-enforcement-bcg-switch\">needs a browsing context group switch</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⑨\">boolean</a> to true.</p>"
        }
      ]
    },
    {
      "name": "pre-request-check-csp",
      "html": "Add a step after step 2 of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#frame-src-pre-request\" id=\"ref-for-frame-src-pre-request\">frame-src pre-request check</a> that says:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑥\">destination</a> is \"<code>fencedframe</code>\", and this directive’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#directive-value\" id=\"ref-for-directive-value\">value</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contain</a> either \"<code>https:</code>\", \"<code>https://*:*</code>\", or\n \"<code>*</code>\", return \"<code>Blocked</code>\".</p>"
        }
      ]
    },
    {
      "name": "post-request-check-csp",
      "html": "Add a step after step 2 of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#frame-src-post-request\" id=\"ref-for-frame-src-post-request\">frame-src post-request check</a> that says:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>request</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑦\">destination</a> is \"<code>fencedframe</code>\", and this directive’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#directive-value\" id=\"ref-for-directive-value①\">value</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contain</a> either \"<code>https:</code>\", \"<code>https://*:*</code>\", or \"<code>*</code>\",\nreturn \"<code>Blocked</code>\".</p>"
        }
      ]
    },
    {
      "name": "cspee-changes",
      "html": "Add a step after step 1 in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-cspee/#process-response\" id=\"ref-for-process-response①\">Is response to request blocked by context’s required CSP?</a> algorithm that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-cspee/#browsing-context-required-csp\" id=\"ref-for-browsing-context-required-csp①\">required csp</a> is not <code>null</code>, and <var>request</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑧\">destination</a> is \"<code>fencedframe</code>\", return \"<code>Blocked</code>\".</p>"
        }
      ]
    },
    {
      "name": "directive-fallback-list",
      "html": "",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <code>&lt;&lt; \"fenced-frame-src\", \"frame-src\", \"child-src\", \"default-src\" &gt;&gt;</code>.</p>"
        }
      ]
    },
    {
      "name": "effective-directive-switch-patch",
      "html": "",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <code>fenced-frame-src</code>.</p>"
        }
      ]
    },
    {
      "name": "Derive a permissions policy directly from a fenced frame config instance",
      "href": "https://wicg.github.io/fenced-frame/#derive-a-permissions-policy-directly-from-a-fenced-frame-config-instance",
      "html": "Create a new algorithm, called <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"Derive a permissions policy directly from a fenced frame config instance\" data-noexport=\"\" id=\"derive-a-permissions-policy-directly-from-a-fenced-frame-config-instance\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Derive a permissions policy directly from a fenced frame\n  config instance</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span>. \n    <p>Given null or an <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element\" id=\"ref-for-concept-element\">element</a> (<var>container</var>), this algorithm returns a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy\" id=\"ref-for-permissions-policy①\">permissions policy</a>.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>inherited policy</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④\">ordered map</a>.</p>"
        },
        {
          "html": "<p>Let <var>effective permissions</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑥\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>fenced frame config</var> be <var>container</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document④\">node document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc\" id=\"ref-for-nav-bc③\">active browsing\n context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①⑥\">fenced frame config instance</a>.</p>"
        },
        {
          "html": "<p>If <var>fenced frame config</var> is not null, and <var>fenced frame config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①⓪\"> effective enabled permissions</a> are not null, set <var>effective permissions</var> to <var>fenced frame config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①①\">effective enabled permissions</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>feature</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#supported-features\" id=\"ref-for-supported-features①\">supported</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>effective permissions</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⓪\">contains</a> <var>feature</var>, then set <var>inherited policy</var>[feature]\n to \"<code>Enabled</code>\".</p>\n        <p>Otherwise, set <var>inherited policy</var>[feature] to \"<code>Disabled</code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>policy</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy\" id=\"ref-for-permissions-policy②\">permissions policy</a>, with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-inherited-policy\" id=\"ref-for-permissions-policy-inherited-policy④\">inherited policy</a> <var>inherited policy</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-declared-policy\" id=\"ref-for-permissions-policy-declared-policy\">declared policy</a> a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤\">ordered map</a>.</p>"
        },
        {
          "html": "<p>Return <var>policy</var>.</p>"
        }
      ]
    },
    {
      "name": "create-permissions-policy",
      "html": "Rewrite step 1 to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: if not null, <var>container</var> is either a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigable-container\" id=\"ref-for-navigable-container⑦\">navigable container</a> or a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers①③\">fenced navigable container</a>.</p>"
        }
      ]
    },
    {
      "name": "create-permissions-policy",
      "html": "Rewrite step 3 to read:",
      "rationale": "for",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>feature</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#supported-features\" id=\"ref-for-supported-features②\">supported</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>isInherited</var> be the result of running <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-permissions-policy/#define-inherited-policy-in-container\" id=\"ref-for-define-inherited-policy-in-container\">Define an inherited policy for feature in\n  container at origin</a> on <var>feature</var>, <var>container</var>, <var>origin</var>, and <var>fenced</var>.</p>"
            },
            {
              "html": "<p>Set <var>inherited policy</var>[<var>feature</var>] to <var>isInherited</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create-permissions-policy-response",
      "html": "Rewrite step 1 to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>container</var> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers①⑤\">fenced navigable container</a>, then let <var>policy</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#derive-a-permissions-policy-directly-from-a-fenced-frame-config-instance\" id=\"ref-for-derive-a-permissions-policy-directly-from-a-fenced-frame-config-instance\">derive a permissions policy directly from a fenced frame config instance</a> given <var>container</var>.</p>\n      <p>Otherwise, Let <var>policy</var> be the result of running <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-permissions-policy/#create-for-navigable\" id=\"ref-for-create-for-navigable①\">Create a Permissions Policy for a\n navigable</a> given <var>container</var> and <var>origin</var>.</p>"
        }
      ]
    },
    {
      "name": "process-permissions-policy-attribute-patch",
      "html": "Modify step 1 of the <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-permissions-policy/#process-policy-attributes\" id=\"ref-for-process-policy-attributes\">Process permissions policy attributes</a> algorithm to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>element</var> is not an <code><a data-link-type=\"element\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element\" id=\"ref-for-the-iframe-element①④\">iframe</a></code> element or a <code><a data-link-type=\"element\" href=\"https://wicg.github.io/fenced-frame/#elementdef-fencedframe\" id=\"ref-for-elementdef-fencedframe⑨③\">fencedframe</a></code> element, then\n return an empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#policy-directive\" id=\"ref-for-policy-directive\">policy directive</a>.</p>"
        }
      ]
    },
    {
      "name": "permissions-policy-block-request",
      "href": "https://wicg.github.io/fenced-frame/#should-navigation-response-to-navigation-request-be-blocked-by-permissions-policy",
      "html": "Create a new algorithm called <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"should navigation response to navigation request be blocked by Permissions Policy?\" data-noexport=\"\" id=\"should-navigation-response-to-navigation-request-be-blocked-by-permissions-policy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">should navigation response to navigation request be blocked by\n  Permissions Policy?</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> in <a data-link-type=\"biblio\" href=\"https://wicg.github.io/fenced-frame/#biblio-html\" title=\"HTML Standard\">[HTML]</a>. \n    <p>Given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params\" id=\"ref-for-navigation-params④\">navigation params</a> (<var>navigationParams</var>), this algorithm returns \"<code>Blocked</code>\" or\n  \"<code>Allowed</code>\":</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-navigable\" id=\"ref-for-navigation-params-navigable②\">navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑤③\">fenced navigable</a>, then return\n \"<code>Allowed</code>\".</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-origin\" id=\"ref-for-navigation-params-origin②\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>effective permissions</var> be the <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc\" id=\"ref-for-nav-bc④\">active browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①⑦\">fenced frame config instance</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-instance-effective-enabled-permissions②\">effective\n enabled permissions</a>.</p>"
        },
        {
          "html": "<p>Let <var>permissions policy</var> be the result of <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-permissions-policy/#create-for-navigable\" id=\"ref-for-create-for-navigable②\"> creating a permissions policy</a> given <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-containers\" id=\"ref-for-fenced-navigable-containers①⑥\">fenced navigable container</a>, <var>origin</var>,\n and <var>fenced</var> set to true.</p>"
        },
        {
          "html": "<p>Let <var>inherited policy</var> be <var>permissions policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-inherited-policy\" id=\"ref-for-permissions-policy-inherited-policy⑤\">inherited policy</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>effective permission</var> of <var>effective permissions</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>inherited policy</var>[<var>effective permission</var>] is \"Disabled\", return \"<code>Blocked</code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Return \"<code>Allowed</code>.\"</p>"
        }
      ]
    },
    {
      "name": "Should navigation response to navigation request be blocked by sandboxing flags?",
      "href": "https://wicg.github.io/fenced-frame/#should-navigation-response-to-navigation-request-be-blocked-by-sandboxing-flags",
      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"should-navigation-response-to-navigation-request-be-blocked-by-sandboxing-flags\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Should navigation response to navigation request be blocked by sandboxing flags?</dfn><span style=\"position: relative; height: 0px;\"></span><span style=\"position: relative; height: 0px;\"></span> \n    <p>Given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params\" id=\"ref-for-navigation-params⑤\">navigation params</a> (<var>navigationParams</var>) and a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#source-snapshot-params\" id=\"ref-for-source-snapshot-params③\">source snapshot params</a> (<var>sourceSnapshotParams</var>), this algorithm returns \"<code>Blocked</code>\" or \"<code>Allowed</code>\":</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-navigable\" id=\"ref-for-navigation-params-navigable③\">navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑤④\">fenced navigable</a>, then return\n \"<code>Allowed</code>\".</p>"
        },
        {
          "html": "<p>Let <var>effectiveSandboxingFlags</var> be the <var>sourceSnapshotParams</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#source-snapshot-params-target-fenced-frame-config\" id=\"ref-for-source-snapshot-params-target-fenced-frame-config⑨\">target\n fenced frame config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags⑥\">effective sandboxing flags</a>.</p>"
        },
        {
          "html": "<p>If <var>navigationParams</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-params-sandboxing\" id=\"ref-for-navigation-params-sandboxing\">final sandboxing flag set</a> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-subset\" id=\"ref-for-set-subset\">subset</a> of <var>effectiveSandboxingFlags</var>, then return \"<code>Blocked</code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code>Allowed</code>\".</p>"
        }
      ]
    },
    {
      "name": "define-inherited-policy-in-container-patches",
      "html": "Rewrite step 3 to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the result of executing <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-permissions-policy/#is-feature-enabled\" id=\"ref-for-is-feature-enabled\">Is feature enabled in document for origin?</a> on <var>feature</var>, <var>container</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑤\">node document</a>, <var>origin</var>, and <var>fenced</var> is \"Disabled\", return\n \"Disabled\".</p>"
        }
      ]
    },
    {
      "name": "define-inherited-policy-in-container-patches",
      "html": "Rewrite step 7 to read:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>fenced</var> is false, <var>feature</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist\" id=\"ref-for-policy-controlled-feature-default-allowlist④\">default allowlist</a> is <code>'self'</code>, and <var>origin</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①①\">same origin</a> with <var>container</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑦\">node document</a>'s\n origin, return <code>\"Enabled\"</code>.</p>"
        }
      ]
    },
    {
      "name": "is-feature-enabled-patches",
      "html": "Rewrite step 3 to read:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>feature</var> is present in <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-declared-policy\" id=\"ref-for-permissions-policy-declared-policy①\">declared policy</a>,",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>fenced</var> is false, and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#allowlist\" id=\"ref-for-allowlist⑦\">allowlist</a> for <var>feature</var> in <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-declared-policy\" id=\"ref-for-permissions-policy-declared-policy②\"> declared policy</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#matches\" id=\"ref-for-matches\">matches</a> <var>origin</var>, then return \"<code>Enabled</code>\".</p>"
            },
            {
              "html": "<p>Otherwise, if <var>fenced</var> is true, and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#allowlist\" id=\"ref-for-allowlist⑧\">allowlist</a> for <var>feature</var> in <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#permissions-policy-declared-policy\" id=\"ref-for-permissions-policy-declared-policy③\">declared policy</a> is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#the-special-value\" id=\"ref-for-the-special-value③\">the special value *</a>, then return \"<code>Enabled</code>\".</p>"
            },
            {
              "html": "<p>Otherwise, return \"<code>Disabled</code>\".</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "is-feature-enabled-patches",
      "html": "Rewrite step 5 to read:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>fenced</var> is false, <var>feature</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature-default-allowlist\" id=\"ref-for-policy-controlled-feature-default-allowlist⑤\">default allowlist</a> is <code>'self'</code>,\n and <var>origin</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①②\">same origin</a> with <var>document</var>’s origin, return \"Enabled\".</p>"
        }
      ]
    },
    {
      "name": "declared-origin-patch",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy#declared-origin\" id=\"ref-for-declared-origin\">declared origin</a> algorithm. Add a new step after step 3 that reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>node</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑧\">node document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc\" id=\"ref-for-concept-document-bc③\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①⑧\">fenced\n frame config instance</a> is not null, then return <var>node</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑨\">node document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#concept-document-bc\" id=\"ref-for-concept-document-bc④\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance①⑨\">fenced frame config instance</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-mapped-url\" id=\"ref-for-fenced-frame-config-instance-mapped-url⑧\">mapped url</a>.</p>"
        }
      ]
    },
    {
      "name": "scroll-target-into-view",
      "html": "Modify the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#scroll-a-target-into-view\" id=\"ref-for-scroll-a-target-into-view②\">scroll a target into view</a> algorithm to add a step at the end of the algorithm that\n  reads:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>scrolling box</var>’s associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element①\">Element</a></code>'s associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document④⑧\">Document</a></code>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①②\">node\n navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable⑥\">traversable navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑤⑥\">fenced\n navigable</a>, or if <var>scrolling box</var>’s associated <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/CSS21/visuren.html#viewport\" id=\"ref-for-viewport①\">viewport</a>'s associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document④⑨\">Document</a></code>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①③\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable⑦\">traversable navigable</a> is a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-navigable-container-fenced-navigable\" id=\"ref-for-fenced-navigable-container-fenced-navigable⑤⑦\">fenced navigable</a>, then let this be the last instance of this algorithm that stops\n any further recursive instances that would otherwise follow.</p>"
        }
      ]
    }
  ]
}