{
  "spec": {
    "title": "EPUB Reading Systems 3.4",
    "url": "https://w3c.github.io/epub-specs/epub34/rs/"
  },
  "algorithms": [
    {
      "name": "obtain an expanded URL",
      "href": "https://w3c.github.io/epub-specs/epub34/rs/#dfn-obtain-an-expanded-url",
      "html": "To <dfn id=\"dfn-obtain-an-expanded-url\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">obtain an expanded URL</dfn>, apply the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>baseURL</var>, <var>expandedURL</var>, <var>prefix</var>, and <var>reference</var> be\n\t\t\t\t\t\tempty <a data-link-type=\"dfn\" data-cite=\"infra\" data-cite-path=\"\" data-cite-frag=\"string\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;infra&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-infra-2\">strings</a>.</p>\n\t\t\t\t\t<details class=\"explanation\">\n\t\t\t\t\t\t<summary>Explanation</summary>\n\t\t\t\t\t\t<p>In this algorithm:</p>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><var>baseURL</var> will hold the base URL associated with the value, whether this URL is\n\t\t\t\t\t\t\t\tassigned in a <code>prefix</code> attribute, corresponds to a default vocabulary, or\n\t\t\t\t\t\t\t\tcomes from a reserved prefix.</li>\n\t\t\t\t\t\t\t<li><var>expandedURL</var> will hold the final URL that results from the concatenation of\n\t\t\t\t\t\t\t\tthe base URL and reference.</li>\n\t\t\t\t\t\t\t<li><var>prefix</var> will hold the compact URL's <a data-cite=\"epub-34#compact-url.ebnf.prefix\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34#compact-url.ebnf.prefix&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-compact-url-ebnf-prefix\">prefix</a> [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-96\">epub-34</a></cite>] (i.e., the value\n\t\t\t\t\t\t\t\tbefore the colon). Properties from a default vocabulary will not have a prefix, but all\n\t\t\t\t\t\t\t\tothers will.</li>\n\t\t\t\t\t\t\t<li><var>reference</var> will hold the compact URL's <a data-cite=\"epub-34#compact-url.ebnf.reference\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34#compact-url.ebnf.reference&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-compact-url-ebnf-reference\">reference</a> [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-97\">epub-34</a></cite>] (i.e., the\n\t\t\t\t\t\t\t\tvalue after the prefix). All valid properties require a reference.</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</details>"
        },
        {
          "html": "Obtain the values of <var>prefix</var> and <var>reference</var> as follows:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> does not contain a colon (U+003A), set <var>reference</var> to\n\t\t\t\t\t\t\t\t\t<var>value</var>.</p>\n\t\t\t\t\t\t\t<details class=\"explanation\">\n\t\t\t\t\t\t\t\t<summary>Explanation</summary>\n\t\t\t\t\t\t\t\t<p>If a compact URL value does not have a colon, it does not have a prefix. In this\n\t\t\t\t\t\t\t\t\tcase, the value is drawn from the default vocabulary as described in the next step\n\t\t\t\t\t\t\t\t\tof the algorithm.</p>\n\t\t\t\t\t\t\t</details>"
            },
            {
              "html": "<p>Otherwise, if <var>value</var> begins with a colon, the value is invalid. Return <a data-cite=\"infra#nulls\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;infra#nulls&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-infra-nulls-0\">null</a>.</p>\n\t\t\t\t\t\t\t<details class=\"explanation\">\n\t\t\t\t\t\t\t\t<summary>Explanation</summary>\n\t\t\t\t\t\t\t\t<p>A colon at the beginning of the value is invalid as it indicates the prefix is not\n\t\t\t\t\t\t\t\t\tset.</p>\n\t\t\t\t\t\t\t</details>"
            },
            {
              "html": "<p>Otherwise, split <var>value</var> on the first colon and set <var>prefix</var> to the\n\t\t\t\t\t\t\t\tstring before the colon and set <var>reference</var> to the string after the colon.</p>"
            }
          ]
        },
        {
          "html": "Obtain the value of <var>baseURL</var> as follows:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>prefix</var> is an empty string:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>attr</var> is <code><a data-xref-type=\"element-attr\" data-link-type=\"element-attr\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-epub-type\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-157\">epub:type</a></code> [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-99\">epub-34</a></cite>], set <var>baseURL</var> to\n\t\t\t\t\t\t\t\t\t\t<br><code>http://idpf.org/epub/vocab/structure/#</code>"
                },
                {
                  "html": "Otherwise, if <var>elem</var> is the package document <code><a data-xref-type=\"element\" data-link-type=\"element\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-meta\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-158\">meta</a></code> element [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-100\">epub-34</a></cite>]\n\t\t\t\t\t\t\t\t\tand <var>attr</var> is <code>scheme</code>, the property value is invalid. Return <a data-cite=\"infra#nulls\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;infra#nulls&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-infra-nulls-2\">null</a>."
                },
                {
                  "html": "Otherwise, if <var>elem</var> is the package document <code><a data-xref-type=\"element\" data-link-type=\"element\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-meta\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-159\">meta</a></code> element [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-101\">epub-34</a></cite>],\n\t\t\t\t\t\t\t\t\tset <var>baseURL</var> to\n\t\t\t\t\t\t\t\t\t\t<br><code>http://idpf.org/epub/vocab/package/meta/#</code>"
                },
                {
                  "html": "Otherwise, if <var>elem</var> is the package document <code><a data-xref-type=\"element\" data-link-type=\"element\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-link\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-160\">link</a></code> element [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-102\">epub-34</a></cite>],\n\t\t\t\t\t\t\t\t\tset <var>baseURL</var> to\n\t\t\t\t\t\t\t\t\t\t<br><code>http://idpf.org/epub/vocab/package/link/#</code>"
                },
                {
                  "html": "Otherwise, if <var>elem</var> is the package document <code><a data-xref-type=\"element\" data-link-type=\"element\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-item\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-161\">item</a></code> element [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-103\">epub-34</a></cite>],\n\t\t\t\t\t\t\t\t\tset <var>baseURL</var> to\n\t\t\t\t\t\t\t\t\t\t<br><code>http://idpf.org/epub/vocab/package/item/#</code>"
                },
                {
                  "html": "Otherwise, if <var>elem</var> is the package document <code><a data-xref-type=\"element\" data-link-type=\"element\" data-cite=\"epub-34\" data-cite-path=\"\" data-cite-frag=\"dfn-itemref\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-162\">itemref</a></code> element\n\t\t\t\t\t\t\t\t\t[<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-104\">epub-34</a></cite>], set <var>baseURL</var> to\n\t\t\t\t\t\t\t\t\t\t<br><code>http://idpf.org/epub/vocab/package/itemref/#</code>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If a <code>prefix</code> attribute is declared on the document element of\n\t\t\t\t\t\t\t\t\t\t\t<var>doc</var>, and the attribute contains a prefix that matches\n\t\t\t\t\t\t\t\t\t\t\t<var>prefix</var>, set <var>baseURL</var> to the URL associated with the\n\t\t\t\t\t\t\t\t\t\tprefix declaration.</p>"
                },
                {
                  "html": "<p>Otherwise, if <var>prefix</var> matches a <a data-cite=\"epub-34#sec-reserved-prefixes\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;epub-34#sec-reserved-prefixes&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-epub-34-sec-reserved-prefixes\">reserved prefix</a> [<cite><a class=\"bibref respec-offending-element\" data-link-type=\"biblio\" href=\"https://w3c.github.io/epub-specs/epub34/rs/#bib-epub-34\" title=\"Reference &quot;[epub-34]&quot; not found.\" id=\"respec-offender-reference-epub-34-not-found-106\">epub-34</a></cite>]\n\t\t\t\t\t\t\t\t\t\tfor <var>doc</var>, set <var>baseURL</var> to the URL associated with the\n\t\t\t\t\t\t\t\t\t\treserved prefix.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Set <var>expandedURL</var> to the concatenated values of <var>baseURL</var> and\n\t\t\t\t\t<var>reference</var>. Do not add a separator when concatenating the values."
        },
        {
          "html": "<p>If <var>expandedURL</var> is not a <a data-link-type=\"dfn\" data-cite=\"url\" data-cite-path=\"\" data-cite-frag=\"valid-url-string\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;url&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-url-4\">valid URL string</a>, the value is invalid. Return <a data-cite=\"infra#nulls\" class=\"respec-offending-element\" title=\"Couldn't find a match for &quot;infra#nulls&quot;\" id=\"respec-offender-couldn-t-find-a-match-for-infra-nulls-4\">null</a>.</p>\n\t\t\t\t\t<p>Otherwise, return <var>expandedURL</var>.</p>\n\t\t\t\t\t<details class=\"explanation\">\n\t\t\t\t\t\t<summary>Explanation</summary>\n\t\t\t\t\t\t<p>Although an expanded value might be obtained, it is not necessarily the case that it is a\n\t\t\t\t\t\t\tvalid URL. This is only likely to occur when an invalid base URL is assigned to a\n\t\t\t\t\t\t\tprefix.</p>\n\t\t\t\t\t</details>"
        }
      ]
    }
  ]
}