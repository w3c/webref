{
  "spec": {
    "title": "Media Source Extensions™",
    "url": "https://w3c.github.io/media-source/"
  },
  "algorithms": [
    {
      "html": "On getting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the handle for this <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-23\"><code>MediaSource</code></a> object has not yet been created, then run the\n        following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"MediaSourceHandle\">created handle</var> be the result of creating a new\n            <a data-link-type=\"idl\" data-lt=\"MediaSourceHandle\" href=\"https://w3c.github.io/media-source/#dom-mediasourcehandle\" class=\"internalDFN\" id=\"ref-for-dom-mediasourcehandle-3\"><code>MediaSourceHandle</code></a> object and associated resources, linked internally to this\n            <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-24\"><code>MediaSource</code></a>."
            },
            {
              "html": "Update the attribute to be <var data-type=\"MediaSourceHandle\">created handle</var>."
            }
          ]
        },
        {
          "html": "Return the <a data-link-type=\"idl\" data-lt=\"MediaSourceHandle\" href=\"https://w3c.github.io/media-source/#dom-mediasourcehandle\" class=\"internalDFN\" id=\"ref-for-dom-mediasourcehandle-4\"><code>MediaSourceHandle</code></a> object that is this attribute's value."
        }
      ]
    },
    {
      "html": "On getting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-7\"><code>readyState</code></a> attribute is \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-closed\" class=\"internalDFN\" id=\"ref-for-dom-readystate-closed-4\"><code>closed</code></a>\" then return\n        NaN and abort these steps."
        },
        {
          "html": "Return the current value of the attribute."
        }
      ]
    },
    {
      "html": "On setting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the value being set is negative or NaN then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and\n        abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-8\"><code>readyState</code></a> attribute is not \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-3\"><code>open</code></a>\" then throw\n        an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-1\"><code>updating</code></a> attribute equals true on any <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-18\"><code>SourceBuffer</code></a> in\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-6\"><code>sourceBuffers</code></a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort\n        these steps."
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-duration-change\" class=\"internalDFN\" id=\"ref-for-dfn-duration-change-1\">duration change</a> algorithm with <var data-type=\"unrestricted double\">new duration</var> set to\n        the value being assigned to this attribute."
        }
      ]
    },
    {
      "html": "Adds a new <a href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" data-link-type=\"idl\" id=\"ref-for-dom-sourcebuffer-19\"><code>SourceBuffer</code></a> to <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-7\"><code>sourceBuffers</code></a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var data-type=\"DOMString\">type</var> is an empty string then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort\n        these steps."
        },
        {
          "html": "If <var data-type=\"DOMString\">type</var> contains a MIME type that is not supported or contains a MIME type that is\n        not supported with the types specified for the other <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-20\"><code>SourceBuffer</code></a> objects in\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-8\"><code>sourceBuffers</code></a>, then throw a <a data-link-type=\"idl\" data-lt=\"NotSupportedError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\"><code>NotSupportedError</code></a> exception and abort these\n        steps."
        },
        {
          "html": "If the user agent can't handle any more SourceBuffer objects or if creating a\n        SourceBuffer based on <var data-type=\"DOMString\">type</var> would result in an unsupported <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-sourcebuffer-configuration\" class=\"internalDFN\" id=\"ref-for-dfn-sourcebuffer-configuration-1\">SourceBuffer configuration</a>,\n        then throw a <a data-link-type=\"idl\" data-lt=\"QuotaExceededError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#quotaexceedederror\"><code>QuotaExceededError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-9\"><code>readyState</code></a> attribute is not in the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-4\"><code>open</code></a>\" state\n        then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "Let <var>buffer</var> be a new instance of a <a data-link-type=\"idl\" data-lt=\"ManagedSourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-managedsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-managedsourcebuffer-2\"><code>ManagedSourceBuffer</code></a> if <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is a\n        <a data-link-type=\"idl\" data-lt=\"ManagedMediaSource\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-2\"><code>ManagedMediaSource</code></a>, or a <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-21\"><code>SourceBuffer</code></a> otherwise, with their respective associated\n        resources."
        },
        {
          "html": "Set <var>buffer</var>'s <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-1\"><code>[[generate timestamps flag]]</code></a> to the value in the\n        \"Generate Timestamps Flag\" column of the <cite><a data-matched-text=\"[[[MSE-REGISTRY]]]\" href=\"https://w3c.github.io/mse-byte-stream-format-registry/\">Media Source Extensions™ Byte Stream Format Registry</a></cite> entry that is associated with\n        <var data-type=\"DOMString\">type</var>."
        },
        {
          "html": "If <var>buffer</var>'s <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-2\"><code>[[generate timestamps flag]]</code></a> is true, set <var>buffer</var>'s\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-1\"><code>mode</code></a> to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-1\"><code>sequence</code></a>\". Otherwise, set <var>buffer</var>'s\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-2\"><code>mode</code></a> to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-segments\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-segments-1\"><code>segments</code></a>\"."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\">Append</a> <var>buffer</var> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-9\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"addsourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-addsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-addsourcebuffer-1\"><code>addsourcebuffer</code></a> at <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-10\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "Return <var>buffer</var>."
        }
      ]
    },
    {
      "html": "Removes a <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-22\"><code>SourceBuffer</code></a> from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-11\"><code>sourceBuffers</code></a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var data-type=\"SourceBuffer\">sourceBuffer</var> specifies an object that is not in\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-12\"><code>sourceBuffers</code></a> then throw a <a data-link-type=\"idl\" data-lt=\"NotFoundError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notfounderror\"><code>NotFoundError</code></a> exception and abort these\n        steps."
        },
        {
          "html": "If the <var data-type=\"SourceBuffer\">sourceBuffer</var>.<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-2\"><code>updating</code></a> attribute equals true, then run the\n        following steps:",
          "rationale": "abort",
          "steps": [
            {
              "html": "Abort the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-buffer-append\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-append-1\">buffer append</a> algorithm if it is running."
            },
            {
              "html": "Set the <var data-type=\"SourceBuffer\">sourceBuffer</var>.<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-3\"><code>updating</code></a> attribute to false."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"abort\" href=\"https://w3c.github.io/media-source/#dfn-abort\" class=\"internalDFN\" id=\"ref-for-dfn-abort-1\"><code>abort</code></a> at <var data-type=\"SourceBuffer\">sourceBuffer</var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updateend\" href=\"https://w3c.github.io/media-source/#dfn-updateend\" class=\"internalDFN\" id=\"ref-for-dfn-updateend-1\"><code>updateend</code></a> at <var data-type=\"SourceBuffer\">sourceBuffer</var>."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"AudioTrackList\">SourceBuffer audioTracks list</var> equal the <a data-link-type=\"idl\" data-lt=\"AudioTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotracklist\"><code>AudioTrackList</code></a> object\n        returned by <var data-type=\"SourceBuffer\">sourceBuffer</var>.<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-audiotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-audiotracks-1\"><code>audioTracks</code></a>."
        },
        {
          "html": "If the <var data-type=\"AudioTrackList\">SourceBuffer audioTracks list</var> is not empty, then run the following steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object in the <var data-type=\"AudioTrackList\">SourceBuffer audioTracks list</var>, run the\n            following steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-audiotrack-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-audiotrack-sourcebuffer-1\"><code>sourceBuffer</code></a> attribute on the <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object to\n                null."
                },
                {
                  "html": "Remove the <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object from the <var data-type=\"AudioTrackList\">SourceBuffer audioTracks list</var>."
                },
                {
                  "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-1\">mirror if necessary</a> algorithm to run the following steps in\n                <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>, to remove the <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object (or instead, the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> mirror\n                of it if the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-32\"><code>MediaSource</code></a> object was constructed in a\n                <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>) from the media element:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"AudioTrackList\">HTMLMediaElement audioTracks list</var> equal the\n                    <a data-link-type=\"idl\" data-lt=\"AudioTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotracklist\"><code>AudioTrackList</code></a> object returned by the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks\"><code>audioTracks</code></a>\n                    attribute on the HTMLMediaElement."
                    },
                    {
                      "html": "Remove the <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object from the <var>HTMLMediaElement audioTracks\n                    list</var>."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Let <var data-type=\"VideoTrackList\">SourceBuffer videoTracks list</var> equal the <a data-link-type=\"idl\" data-lt=\"VideoTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotracklist\"><code>VideoTrackList</code></a> object\n        returned by <var data-type=\"SourceBuffer\">sourceBuffer</var>.<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-videotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-videotracks-1\"><code>videoTracks</code></a>."
        },
        {
          "html": "If the <var data-type=\"VideoTrackList\">SourceBuffer videoTracks list</var> is not empty, then run the following steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object in the <var data-type=\"VideoTrackList\">SourceBuffer videoTracks list</var>, run the\n            following steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-videotrack-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-videotrack-sourcebuffer-1\"><code>sourceBuffer</code></a> attribute on the <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object to\n                null."
                },
                {
                  "html": "Remove the <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object from the <var data-type=\"VideoTrackList\">SourceBuffer videoTracks list</var>."
                },
                {
                  "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-2\">mirror if necessary</a> algorithm to run the following steps in\n                <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>, to remove the <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object (or instead, the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> mirror\n                of it if the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-33\"><code>MediaSource</code></a> object was constructed in a\n                <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>) from the media element:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"VideoTrackList\">HTMLMediaElement videoTracks list</var> equal the\n                    <a data-link-type=\"idl\" data-lt=\"VideoTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotracklist\"><code>VideoTrackList</code></a> object returned by the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks\"><code>videoTracks</code></a>\n                    attribute on the HTMLMediaElement."
                    },
                    {
                      "html": "Remove the <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object from the <var>HTMLMediaElement videoTracks\n                    list</var>."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Let <var data-type=\"TextTrackList\">SourceBuffer textTracks list</var> equal the <a data-link-type=\"idl\" data-lt=\"TextTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttracklist\"><code>TextTrackList</code></a> object\n        returned by <var data-type=\"SourceBuffer\">sourceBuffer</var>.<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-texttracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-texttracks-1\"><code>textTracks</code></a>."
        },
        {
          "html": "If the <var data-type=\"TextTrackList\">SourceBuffer textTracks list</var> is not empty, then run the following steps:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object in the <var data-type=\"TextTrackList\">SourceBuffer textTracks list</var>, run the\n            following steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-texttrack-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-texttrack-sourcebuffer-1\"><code>sourceBuffer</code></a> attribute on the <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object to\n                null."
                },
                {
                  "html": "Remove the <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object from the <var data-type=\"TextTrackList\">SourceBuffer textTracks list</var>."
                },
                {
                  "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-3\">mirror if necessary</a> algorithm to run the following steps in\n                <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>, to remove the <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object (or instead, the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> mirror\n                of it if the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-34\"><code>MediaSource</code></a> object was constructed in a\n                <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>) from the media element:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"TextTrackList\">HTMLMediaElement textTracks list</var> equal the\n                    <a data-link-type=\"idl\" data-lt=\"TextTrackList\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttracklist\"><code>TextTrackList</code></a> object returned by the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks\"><code>textTracks</code></a>\n                    attribute on the HTMLMediaElement."
                    },
                    {
                      "html": "Remove the <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object from the <var>HTMLMediaElement textTracks\n                    list</var>."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var data-type=\"SourceBuffer\">sourceBuffer</var> is in <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-4\"><code>activeSourceBuffers</code></a>, then remove <var data-type=\"SourceBuffer\">sourceBuffer</var>\n        from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-5\"><code>activeSourceBuffers</code></a> and <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named\n        <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-1\"><code>removesourcebuffer</code></a> at the <a href=\"https://w3c.github.io/media-source/#dom-sourcebufferlist\" class=\"internalDFN\" data-link-type=\"idl\" id=\"ref-for-dom-sourcebufferlist-3\"><code>SourceBufferList</code></a> returned by\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-6\"><code>activeSourceBuffers</code></a>."
        },
        {
          "html": "Remove <var data-type=\"SourceBuffer\">sourceBuffer</var> from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-13\"><code>sourceBuffers</code></a> and <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-2\"><code>removesourcebuffer</code></a> at the <a href=\"https://w3c.github.io/media-source/#dom-sourcebufferlist\" class=\"internalDFN\" data-link-type=\"idl\" id=\"ref-for-dom-sourcebufferlist-4\"><code>SourceBufferList</code></a> returned by\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-14\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "Destroy all resources for <var data-type=\"SourceBuffer\">sourceBuffer</var>."
        }
      ]
    },
    {
      "html": "Signals the end of the stream.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-10\"><code>readyState</code></a> attribute is not in the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-5\"><code>open</code></a>\" state\n        then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-4\"><code>updating</code></a> attribute equals true on any <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-23\"><code>SourceBuffer</code></a> in\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-15\"><code>sourceBuffers</code></a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort\n        these steps."
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-end-of-stream\" class=\"internalDFN\" id=\"ref-for-dfn-end-of-stream-1\">end of stream</a> algorithm with the error parameter set to\n        <var data-type=\"EndOfStreamError\">error</var>."
        }
      ]
    },
    {
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-11\"><code>readyState</code></a> attribute is not \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-6\"><code>open</code></a>\" then throw\n        an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If <var data-type=\"double\">start</var> is negative or greater than <var data-type=\"double\">end</var>, then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a>\n        exception and abort these steps."
        },
        {
          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-2\"><code>[[live seekable range]]</code></a> to be a new <a href=\"https://html.spec.whatwg.org/multipage/media.html#normalised-timeranges-object\">normalized TimeRanges object</a> containing a single range whose start position is\n        <var data-type=\"double\">start</var> and end position is <var data-type=\"double\">end</var>."
        }
      ]
    },
    {
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-12\"><code>readyState</code></a> attribute is not \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-7\"><code>open</code></a>\" then throw\n        an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-4\"><code>[[live seekable range]]</code></a> contains a range, then set\n        <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-5\"><code>[[live seekable range]]</code></a> to be a new empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object."
        }
      ]
    },
    {
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var data-type=\"DOMString\">type</var> is an empty string, then return false."
        },
        {
          "html": "If <var data-type=\"DOMString\">type</var> does not contain a valid MIME type string, then return false."
        },
        {
          "html": "If <var data-type=\"DOMString\">type</var> contains a media type or media subtype that the MediaSource does not support,\n        then return false."
        },
        {
          "html": "If <var data-type=\"DOMString\">type</var> contains a codec that the MediaSource does not support, then return false."
        },
        {
          "html": "If the MediaSource does not support the specified combination of media type, media\n        subtype, and codecs then return false."
        },
        {
          "html": "Return true."
        }
      ]
    },
    {
      "html": "At the beginning of the \"Otherwise (mode is local)\" section of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>, execute the additional steps, below.",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a> was invoked with a media provider object that\n            is a <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-62\"><code>MediaSource</code></a> object, a <a data-link-type=\"idl\" data-lt=\"MediaSourceHandle\" href=\"https://w3c.github.io/media-source/#dom-mediasourcehandle\" class=\"internalDFN\" id=\"ref-for-dom-mediasourcehandle-9\"><code>MediaSourceHandle</code></a> object or a URL record whose\n            object is a <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-63\"><code>MediaSource</code></a> object, then:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the media provider object is a URL record whose object is a MediaSource that was constructed in a DedicatedWorkerGlobalScope, such as would occur if attempting to use a MediaSource object URL from a DedicatedWorkerGlobalScope MediaSource",
                  "html": "Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                },
                {
                  "case": "If the media provider object is a MediaSourceHandle whose [[Detached]] internal slot is true",
                  "html": "Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                },
                {
                  "case": "If the media provider object is a MediaSourceHandle whose underlying MediaSource's [[has ever been attached]] internal slot is true",
                  "html": "Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                },
                {
                  "case": "If readyState is NOT set to \"closed\"",
                  "html": "Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                },
                {
                  "case": "Otherwise",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-71\"><code>MediaSource</code></a>'s <a data-link-type=\"attribute\" data-lt=\"[[has ever been attached]]\" href=\"https://w3c.github.io/media-source/#dfn-has-ever-been-attached\" class=\"internalDFN\" id=\"ref-for-dfn-has-ever-been-attached-2\"><code>[[has ever been attached]]</code></a>\n                    internal slot to true."
                    },
                    {
                      "html": "Set the media element's <a href=\"https://html.spec.whatwg.org/multipage/media.html#delaying-the-load-event-flag\">delaying-the-load-event-flag</a> to\n                    false."
                    },
                    {
                      "html": "<dl class=\"switch\">\n                        <dt>\n                          If the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-72\"><code>MediaSource</code></a> was constructed in a\n                          <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>, then setup worker attachment\n                          communication and open the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-73\"><code>MediaSource</code></a>:\n                        </dt>\n                        <dd>\n                          \n                        </dd>\n                        <dt>\n                          Otherwise, the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-76\"><code>MediaSource</code></a> was constructed in a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:\n                        </dt>\n                        <dd>\n                          \n                        </dd>\n                      </dl>",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "If the MediaSource was constructed in a DedicatedWorkerGlobalScope, then setup worker attachment communication and open the MediaSource:",
                              "html": "",
                              "rationale": "set",
                              "steps": [
                                {
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-2\"><code>[[channel with worker]]</code></a> to be a new\n                            <a data-link-type=\"idl\" data-lt=\"MessageChannel\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/web-messaging.html#messagechannel\"><code>MessageChannel</code></a>."
                                },
                                {
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-2\"><code>[[port to worker]]</code></a> to the\n                            <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-messagechannel-port1\"><code>port1</code></a> value of <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-3\"><code>[[channel with worker]]</code></a>."
                                },
                                {
                                  "html": "Execute <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializewithtransfer\">StructuredSerializeWithTransfer</a> with the\n                            <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-messagechannel-port2\"><code>port2</code></a> of <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-4\"><code>[[channel with worker]]</code></a> as both the value and the sole member of the <var>transferList</var>,\n                            and let the result be <var data-type=\"MessagePort\">serialized port2</var>."
                                },
                                {
                                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-74\"><code>MediaSource</code></a>'s\n                            <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> that will",
                                  "rationale": "execute",
                                  "steps": [
                                    {
                                      "html": "Execute <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserializewithtransfer\">StructuredDeserializeWithTransfer</a> with <var>serialized\n                                port2</var> and <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>'s <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm\">realm</a>, and set <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-2\"><code>[[port to main]]</code></a> to be the\n                                resulting deserialized clone of the transferred\n                                <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/web-messaging.html#dom-messagechannel-port2\"><code>port2</code></a> value of <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-5\"><code>[[channel with worker]]</code></a>."
                                    },
                                    {
                                      "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-17\"><code>readyState</code></a> attribute to\n                                \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-12\"><code>open</code></a>\"."
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-1\"><code>sourceopen</code></a> at\n                                the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-75\"><code>MediaSource</code></a>."
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "Otherwise, the MediaSource was constructed in a Window:",
                              "html": "",
                              "rationale": "set",
                              "steps": [
                                {
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-6\"><code>[[channel with worker]]</code></a> null."
                                },
                                {
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-3\"><code>[[port to worker]]</code></a> null."
                                },
                                {
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-3\"><code>[[port to main]]</code></a> null."
                                },
                                {
                                  "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-18\"><code>readyState</code></a> attribute to\n                            \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-13\"><code>open</code></a>\"."
                                },
                                {
                                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-2\"><code>sourceopen</code></a> at the\n                            <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-77\"><code>MediaSource</code></a>."
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "html": "Continue the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a> by running the remaining\n                    <span>\"<i>Otherwise (mode is local)</i>\"</span> steps, with these requirements:",
                      "ignored": [
                        "Text in the resource fetch algorithm or the media data processing steps list that refers to \"the download\", \"bytes received\", or \"whenever new data for the current media resource becomes available\" refers to data passed in via appendBuffer(). References to HTTP in the resource fetch algorithm and the media data processing steps list shall not apply because the HTMLMediaElement does not fetch media data via HTTP when a MediaSource is attached."
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "The following steps are run in any case where the media element is going to transition\n            to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-network_empty\"><code>NETWORK_EMPTY</code></a> and <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named\n            <a data-link-type=\"dfn|abstract-op\" data-type=\"event\" href=\"https://html.spec.whatwg.org/multipage/media.html#event-media-emptied\">emptied</a> at the media element. These steps <em class=\"rfc2119\">SHOULD</em> be run right\n            before the transition.",
      "rationale": "if",
      "steps": [
        {
          "html": "<dl class=\"switch\">\n                <dt>\n                  If the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-79\"><code>MediaSource</code></a> was constructed in a <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>:\n                </dt>\n                <dd>\n                  \n                </dd>\n                <dt>\n                  Otherwise, the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-82\"><code>MediaSource</code></a> was constructed in a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:\n                </dt>\n                <dd>\n                  Continue the remainder of these steps on the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-83\"><code>MediaSource</code></a>.\n                </dd>\n              </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the MediaSource was constructed in a DedicatedWorkerGlobalScope:",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Notify the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-80\"><code>MediaSource</code></a> using an internal <code>detach</code> message posted to\n                    <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-4\"><code>[[port to worker]]</code></a>."
                    },
                    {
                      "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-5\"><code>[[port to worker]]</code></a> null."
                    },
                    {
                      "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[channel with worker]]\" href=\"https://w3c.github.io/media-source/#dfn-channel-with-worker\" class=\"internalDFN\" id=\"ref-for-dfn-channel-with-worker-7\"><code>[[channel with worker]]</code></a> null."
                    },
                    {
                      "html": "The implicit message handler for this <code>detach</code> notification runs the\n                    remainder of these steps in the <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-81\"><code>MediaSource</code></a>."
                    }
                  ]
                },
                {
                  "case": "Otherwise, the MediaSource was constructed in a Window:",
                  "html": "Continue the remainder of these steps on the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-83\"><code>MediaSource</code></a>."
                }
              ]
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-4\"><code>[[port to main]]</code></a> null."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-19\"><code>readyState</code></a> attribute to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-closed\" class=\"internalDFN\" id=\"ref-for-dom-readystate-closed-9\"><code>closed</code></a>\"."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is a <a data-link-type=\"idl\" data-lt=\"ManagedMediaSource\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-3\"><code>ManagedMediaSource</code></a>, then set <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource-streaming\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-streaming-1\"><code>streaming</code></a>\n            attribute to <code>false</code>."
        },
        {
          "html": "Update <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-2\"><code>duration</code></a> to NaN."
        },
        {
          "html": "Remove all the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-27\"><code>SourceBuffer</code></a> objects from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-7\"><code>activeSourceBuffers</code></a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-3\"><code>removesourcebuffer</code></a> at\n            <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-8\"><code>activeSourceBuffers</code></a>."
        },
        {
          "html": "Remove all the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-28\"><code>SourceBuffer</code></a> objects from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-16\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-4\"><code>removesourcebuffer</code></a> at\n            <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-17\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceclose\" href=\"https://w3c.github.io/media-source/#dfn-sourceclose\" class=\"internalDFN\" id=\"ref-for-dfn-sourceclose-1\"><code>sourceclose</code></a> at the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-84\"><code>MediaSource</code></a>."
        }
      ]
    },
    {
      "html": "Run the following steps as part of the \"<i>Wait until the user agent has established\n            whether or not the media data for the new playback position is available, and, if it\n            is, until it has decoded enough data to play back that position\"</i> step of the\n            <a href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-seek\">seek algorithm</a>:",
      "rationale": "if",
      "steps": [
        {
          "html": "<dl class=\"switch\">\n                <dt>\n                  If <var>new playback position</var> is not in any <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> of <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                  <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a>\n                </dt>\n                <dd>\n                  \n                </dd>\n                <dt>\n                  Otherwise\n                </dt>\n                <dd>\n                  Continue\n                  \n                </dd>\n              </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If new playback position is not in any TimeRanges of HTMLMediaElement's buffered",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-2\"><code>readyState</code></a> attribute is\n                    greater than <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>, then set the\n                    <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-3\"><code>readyState</code></a> attribute to\n                    <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>."
                    },
                    {
                      "html": "The media element waits until an <a data-link-type=\"idl\" data-lt=\"appendBuffer()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendbuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendbuffer-3\"><code>appendBuffer</code></a><code>()</code> call\n                    causes the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-processing\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-processing-2\">coded frame processing</a> algorithm to set the\n                    <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-5\"><code>readyState</code></a> attribute to a value\n                    greater than <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>."
                    }
                  ]
                },
                {
                  "case": "Otherwise",
                  "html": "Continue"
                }
              ]
            }
          ]
        },
        {
          "html": "The media element resets all decoders and initializes each one with data from the\n            appropriate <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-4\">initialization segment</a>."
        },
        {
          "html": "The media element feeds <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-10\">coded frames</a> from the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-active-track-buffers\" class=\"internalDFN\" id=\"ref-for-dfn-active-track-buffers-1\">active track buffers</a> into the\n            decoders starting with the closest <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#random-access-point\" class=\"internalDFN\" id=\"ref-for-random-access-point-1\">random access point</a> before the <var>new playback\n            position</var>."
        },
        {
          "html": "Resume the <a href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-seek\">seek algorithm</a> at the \"<i>Await a stable state</i>\"\n            step."
        }
      ]
    },
    {
      "name": "enough data to ensure uninterrupted playback",
      "href": "https://w3c.github.io/media-source/#enough-data",
      "html": "Having <dfn id=\"enough-data\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">enough data to ensure uninterrupted playback</dfn> is an\n            implementation specific condition where the user agent determines that it currently has\n            enough data to play the presentation without stalling for a meaningful period of time.\n            This condition is constantly evaluated to determine when to transition the media\n            element into and out of the <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_enough_data\"><code>HAVE_ENOUGH_DATA</code></a> ready state. These\n            transitions indicate when the user agent believes it has enough data buffered or it\n            needs more data respectively.",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If the HTMLMediaElement's readyState attribute equals HAVE_NOTHING:",
              "html": "",
              "rationale": "abort",
              "steps": [
                {
                  "html": "Abort these steps."
                }
              ]
            },
            {
              "case": "If HTMLMediaElement's buffered does not contain a TimeRanges for the current playback position:",
              "html": "",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-8\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>."
                },
                {
                  "html": "Abort these steps."
                }
              ]
            },
            {
              "case": "If HTMLMediaElement's buffered contains a TimeRanges that includes the current playback position and enough data to ensure uninterrupted playback:",
              "html": "",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-10\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_enough_data\"><code>HAVE_ENOUGH_DATA</code></a>."
                },
                {
                  "html": "Playback may resume at this point if it was previously suspended by a\n                transition to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a>."
                },
                {
                  "html": "Abort these steps."
                }
              ]
            },
            {
              "case": "If HTMLMediaElement's buffered contains a TimeRanges that includes the current playback position and some time beyond the current playback position, then run the following steps:",
              "html": "",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-12\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_future_data\"><code>HAVE_FUTURE_DATA</code></a>."
                },
                {
                  "html": "Playback may resume at this point if it was previously suspended by a\n                transition to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a>."
                },
                {
                  "html": "Abort these steps."
                }
              ]
            },
            {
              "case": "If HTMLMediaElement's buffered contains a TimeRanges that ends at the current playback position and does not have a range covering the time immediately after the current position:",
              "html": "",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-14\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a>."
                },
                {
                  "html": "Playback is suspended at this point since the media element doesn't have enough\n                data to advance the <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-timeline\">media timeline</a>."
                },
                {
                  "html": "Abort these steps."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "During playback <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-12\"><code>activeSourceBuffers</code></a> needs to be updated if the\n            <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-selected\"><code>selected</code></a> video track, the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-enabled\"><code>enabled</code></a> audio track(s), or a\n            text track <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-mode\"><code>mode</code></a> changes. When one or more of these changes occur the\n            following steps need to be followed. Also, when <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-86\"><code>MediaSource</code></a> was constructed in a\n            <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>, then each change that occurs to a <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> mirror of\n            a track created previously by the implicit handler for the internal <code>create track\n            mirror</code> message <em class=\"rfc2119\">MUST</em> also be made to the corresponding <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>\n            track using an internal <code>update track state</code> message posted to\n            <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-6\"><code>[[port to worker]]</code></a> whose implicit handler makes the change and\n            runs the following steps. Likewise, each change that occurs to a\n            <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> track <em class=\"rfc2119\">MUST</em> also be made to the corresponding <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n            mirror of the track using an internal <code>update track state</code> message posted to\n            <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-5\"><code>[[port to main]]</code></a> whose implicit handler makes the change to the mirror.",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If the selected video track changes, then run the following steps:",
              "html": "",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-31\"><code>SourceBuffer</code></a> associated with the previously selected video track is\n                not associated with any other enabled tracks, run the following steps:",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "Remove the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-32\"><code>SourceBuffer</code></a> from <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-13\"><code>activeSourceBuffers</code></a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-5\"><code>removesourcebuffer</code></a> at\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-14\"><code>activeSourceBuffers</code></a>"
                    }
                  ]
                },
                {
                  "html": "If the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-33\"><code>SourceBuffer</code></a> associated with the newly selected video track is not\n                already in <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-15\"><code>activeSourceBuffers</code></a>, run the following steps:",
                  "rationale": "add",
                  "steps": [
                    {
                      "html": "Add the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-34\"><code>SourceBuffer</code></a> to <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-16\"><code>activeSourceBuffers</code></a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"addsourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-addsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-addsourcebuffer-2\"><code>addsourcebuffer</code></a> at\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-17\"><code>activeSourceBuffers</code></a>"
                    }
                  ]
                }
              ]
            },
            {
              "case": "If an audio track becomes disabled and the SourceBuffer associated with this track is not associated with any other enabled or selected track, then run the following steps:",
              "html": "",
              "rationale": "remove",
              "steps": [
                {
                  "html": "Remove the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-36\"><code>SourceBuffer</code></a> associated with the audio track from\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-18\"><code>activeSourceBuffers</code></a>"
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-6\"><code>removesourcebuffer</code></a> at\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-19\"><code>activeSourceBuffers</code></a>"
                }
              ]
            },
            {
              "case": "If an audio track becomes enabled and the SourceBuffer associated with this track is not already in activeSourceBuffers, then run the following steps:",
              "html": "",
              "rationale": "add",
              "steps": [
                {
                  "html": "Add the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-38\"><code>SourceBuffer</code></a> associated with the audio track to\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-21\"><code>activeSourceBuffers</code></a>"
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"addsourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-addsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-addsourcebuffer-3\"><code>addsourcebuffer</code></a> at\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-22\"><code>activeSourceBuffers</code></a>"
                }
              ]
            },
            {
              "case": "If a text track mode becomes \"disabled\" and the SourceBuffer associated with this track is not associated with any other enabled or selected track, then run the following steps:",
              "html": "",
              "rationale": "remove",
              "steps": [
                {
                  "html": "Remove the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-40\"><code>SourceBuffer</code></a> associated with the text track from\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-23\"><code>activeSourceBuffers</code></a>"
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"removesourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-removesourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-removesourcebuffer-7\"><code>removesourcebuffer</code></a> at\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-24\"><code>activeSourceBuffers</code></a>"
                }
              ]
            },
            {
              "case": "If a text track mode becomes \"showing\" or \"hidden\" and the SourceBuffer associated with this track is not already in activeSourceBuffers, then run the following steps:",
              "html": "",
              "rationale": "add",
              "steps": [
                {
                  "html": "Add the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-42\"><code>SourceBuffer</code></a> associated with the text track to\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-26\"><code>activeSourceBuffers</code></a>"
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"addsourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-addsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-addsourcebuffer-4\"><code>addsourcebuffer</code></a> at\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-27\"><code>activeSourceBuffers</code></a>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "Follow these steps when <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-3\"><code>duration</code></a> needs to change to a <var data-type=\"unrestricted double\">new\n            duration</var>.",
      "rationale": "if",
      "steps": [
        {
          "html": "If the current value of <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-4\"><code>duration</code></a> is equal to <var>new duration</var>, then\n            return."
        },
        {
          "html": "If <var>new duration</var> is less than the highest <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-11\">presentation timestamp</a> of any\n            buffered <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-11\">coded frames</a> for all <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-43\"><code>SourceBuffer</code></a> objects in\n            <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-18\"><code>sourceBuffers</code></a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort\n            these steps."
        },
        {
          "html": "Let <var data-type=\"unrestricted double\">highest end time</var> be the largest <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer-ranges\" class=\"internalDFN\" id=\"ref-for-track-buffer-ranges-1\">track buffer ranges</a>\n            end time across all the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-2\">track buffers</a> across all <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-44\"><code>SourceBuffer</code></a> objects in\n            <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-19\"><code>sourceBuffers</code></a>."
        },
        {
          "html": "If <var>new duration</var> is less than <var data-type=\"unrestricted double\">highest end time</var>, then",
          "rationale": "update",
          "steps": [
            {
              "html": "Update <var>new duration</var> to equal <var data-type=\"unrestricted double\">highest end time</var>."
            }
          ]
        },
        {
          "html": "Update <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-6\"><code>duration</code></a> to <var>new duration</var>."
        },
        {
          "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-4\">mirror if necessary</a> algorithm to run the following steps in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n            to update the media element's duration:",
          "rationale": "update",
          "steps": [
            {
              "html": "Update the media element's <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-duration\"><code>duration</code></a> to <var>new duration</var>."
            },
            {
              "html": "Run the <a href=\"https://html.spec.whatwg.org/multipage/media.html#durationChange\">HTMLMediaElement duration change algorithm</a>."
            }
          ]
        }
      ]
    },
    {
      "html": "This algorithm gets called when the application signals the end of stream via an\n            <a data-link-type=\"idl\" data-lt=\"endOfStream()\" href=\"https://w3c.github.io/media-source/#dom-mediasource-endofstream\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-endofstream-4\"><code>endOfStream</code></a><code>()</code> call or an algorithm needs to signal a decode error. This\n            algorithm takes an <var data-type=\"EndOfStreamError\">error</var> parameter that indicates whether an error\n            will be signalled.",
      "rationale": "change",
      "steps": [
        {
          "html": "Change the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-22\"><code>readyState</code></a> attribute value to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-7\"><code>ended</code></a>\"."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceended\" href=\"https://w3c.github.io/media-source/#dfn-sourceended\" class=\"internalDFN\" id=\"ref-for-dfn-sourceended-1\"><code>sourceended</code></a> at the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-87\"><code>MediaSource</code></a>."
        },
        {
          "html": "<dl class=\"switch\">\n                <dt>\n                  If <var data-type=\"EndOfStreamError\">error</var> is not set\n                </dt>\n                <dd>\n                  \n                </dd>\n                <dt>\n                  If <var data-type=\"EndOfStreamError\">error</var> is set to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-endofstreamerror-network\" class=\"internalDFN\" id=\"ref-for-dom-endofstreamerror-network-2\"><code>network</code></a>\"\n                </dt>\n                <dd>\n                  Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-5\">mirror if necessary</a> algorithm to run the following steps in\n                  <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:\n                  <dl class=\"switch\">\n                    <dt>\n                      If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-16\"><code>readyState</code></a> attribute\n                      equals <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing\"><code>HAVE_NOTHING</code></a>\n                    </dt>\n                    <dd>\n                      Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>.\n                    </dd>\n                    <dt>\n                      If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-17\"><code>readyState</code></a> attribute is\n                      greater than <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing\"><code>HAVE_NOTHING</code></a>\n                    </dt>\n                    <dd>\n                      Run the \"<i>If the connection is interrupted after some media data has been\n                      received, causing the user agent to give up trying to fetch the resource</i>\"\n                      steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>.\n                    </dd>\n                  </dl>\n                </dd>\n                <dt>\n                  If <var data-type=\"EndOfStreamError\">error</var> is set to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-endofstreamerror-decode\" class=\"internalDFN\" id=\"ref-for-dom-endofstreamerror-decode-2\"><code>decode</code></a>\"\n                </dt>\n                <dd>\n                  Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-6\">mirror if necessary</a> algorithm to run the following steps in\n                  <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:\n                  <dl class=\"switch\">\n                    <dt>\n                      If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-18\"><code>readyState</code></a> attribute\n                      equals <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing\"><code>HAVE_NOTHING</code></a>\n                    </dt>\n                    <dd>\n                      Run the \"<i>If the media data can be fetched but is found by inspection to be\n                      in an unsupported format, or can otherwise not be rendered at all</i>\" steps\n                      of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>.\n                    </dd>\n                    <dt>\n                      If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-19\"><code>readyState</code></a> attribute is\n                      greater than <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing\"><code>HAVE_NOTHING</code></a>\n                    </dt>\n                    <dd>\n                      Run the <a href=\"https://html.spec.whatwg.org/multipage/media.html#fatal-decode-error\">media data is corrupted</a> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>.\n                    </dd>\n                  </dl>\n                </dd>\n              </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If error is not set",
                  "html": "",
                  "rationale": "run",
                  "steps": [
                    {
                      "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-duration-change\" class=\"internalDFN\" id=\"ref-for-dfn-duration-change-3\">duration change</a> algorithm with <var data-type=\"unrestricted\n                    double\">new duration</var> set to the largest <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer-ranges\" class=\"internalDFN\" id=\"ref-for-track-buffer-ranges-2\">track buffer ranges</a> end time across all the\n                    <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-3\">track buffers</a> across all <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-45\"><code>SourceBuffer</code></a> objects in\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-20\"><code>sourceBuffers</code></a>."
                    },
                    {
                      "html": "Notify the media element that it now has all of the media data."
                    }
                  ]
                },
                {
                  "case": "If error is set to \"network\"",
                  "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-5\">mirror if necessary</a> algorithm to run the following steps in\n                  <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "If the HTMLMediaElement's readyState attribute equals HAVE_NOTHING",
                          "html": "Run the <span>\"<i>If the media data cannot be fetched at all, due to network errors, causing the user agent to give up trying to fetch the resource</i>\"</span> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                        },
                        {
                          "case": "If the HTMLMediaElement's readyState attribute is greater than HAVE_NOTHING",
                          "html": "Run the \"<i>If the connection is interrupted after some media data has been\n                      received, causing the user agent to give up trying to fetch the resource</i>\"\n                      steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If error is set to \"decode\"",
                  "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-6\">mirror if necessary</a> algorithm to run the following steps in\n                  <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "If the HTMLMediaElement's readyState attribute equals HAVE_NOTHING",
                          "html": "Run the \"<i>If the media data can be fetched but is found by inspection to be\n                      in an unsupported format, or can otherwise not be rendered at all</i>\" steps\n                      of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                        },
                        {
                          "case": "If the HTMLMediaElement's readyState attribute is greater than HAVE_NOTHING",
                          "html": "Run the <a href=\"https://html.spec.whatwg.org/multipage/media.html#fatal-decode-error\">media data is corrupted</a> steps of the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/media.html#concept-media-load-resource\">resource fetch algorithm</a>'s <a href=\"https://html.spec.whatwg.org/multipage/media.html#media-data-processing-steps-list\">media data processing steps list</a>."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "This algorithm is used to run steps on <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> from a <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-88\"><code>MediaSource</code></a> attached from\n            either the same <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> or from a <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>, usually to update\n            the state of the attached <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>. This algorithm takes a <var>steps</var>\n            parameter that lists the steps to run on <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>.",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If the MediaSource was constructed in a DedicatedWorkerGlobalScope:",
              "html": "Post an internal <code>mirror on window</code> message to <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-6\"><code>[[port to main]]</code></a> whose\n              implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> will run <var>steps</var>. Return control to the caller without\n              awaiting that handler's receipt of the message."
            },
            {
              "case": "Otherwise:",
              "html": "Run <var>steps</var>."
            }
          ]
        }
      ]
    },
    {
      "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#transfer-steps\">Transfer steps</a> for a <a data-link-type=\"idl\" data-lt=\"MediaSourceHandle\" href=\"https://w3c.github.io/media-source/#dom-mediasourcehandle\" class=\"internalDFN\" id=\"ref-for-dom-mediasourcehandle-27\"><code>MediaSourceHandle</code></a> object <em class=\"rfc2119\">MUST</em> include the following step:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" data-lt=\"MediaSourceHandle\" href=\"https://w3c.github.io/media-source/#dom-mediasourcehandle\" class=\"internalDFN\" id=\"ref-for-dom-mediasourcehandle-28\"><code>MediaSourceHandle</code></a>'s <a data-link-type=\"attribute\" data-lt=\"[[has ever been assigned as srcobject]]\" href=\"https://w3c.github.io/media-source/#dfn-has-ever-been-assigned-as-srcobject\" class=\"internalDFN\" id=\"ref-for-dfn-has-ever-been-assigned-as-srcobject-1\"><code>[[has ever been assigned as srcobject]]</code></a> internal slot is true, then the <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#transfer-steps\">transfer steps</a> must fail by throwing a\n          <a data-link-type=\"idl\" data-lt=\"DataCloneError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#datacloneerror\"><code>DataCloneError</code></a> exception."
        }
      ]
    },
    {
      "name": "SourceBuffer/mode",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-mode",
      "html": "On setting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-21\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-1\">parent media source</a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-6\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "Let <var data-type=\"AppendMode\">new mode</var> equal the new value being assigned to this attribute."
        },
        {
          "html": "If <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-3\"><code>[[generate timestamps flag]]</code></a> equals true and <var data-type=\"AppendMode\">new mode</var>\n              equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-segments\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-segments-3\"><code>segments</code></a>\", then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort\n              these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-23\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-2\">parent media source</a> is in\n                  the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-8\"><code>ended</code></a>\" state then run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-24\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-3\">parent media source</a>\n                  to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-14\"><code>open</code></a>\""
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-3\"><code>sourceopen</code></a> at the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-4\">parent media source</a>."
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-1\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-media-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-media-segment-1\">PARSING_MEDIA_SEGMENT</a>, then\n              throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> and abort these steps."
        },
        {
          "html": "If the <var data-type=\"AppendMode\">new mode</var> equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-4\"><code>sequence</code></a>\", then set the\n              <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-1\"><code>[[group start timestamp]]</code></a> to the <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-1\"><code>[[group end timestamp]]</code></a>."
        },
        {
          "html": "Update the attribute to <var data-type=\"AppendMode\">new mode</var>."
        }
      ]
    },
    {
      "name": "SourceBuffer/buffered",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-buffered",
      "html": "When the attribute is read the following steps <em class=\"rfc2119\">MUST</em> occur:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-22\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-5\">parent media source</a> then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "Let <var data-type=\"double\">highest end time</var> be the largest <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer-ranges\" class=\"internalDFN\" id=\"ref-for-track-buffer-ranges-3\">track buffer ranges</a> end time\n              across all the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-4\">track buffers</a> managed by this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-48\"><code>SourceBuffer</code></a> object."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">intersection ranges</var> equal a <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object\n              containing a single range from 0 to <var data-type=\"double\">highest end time</var>."
        },
        {
          "html": "For each audio and video <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-5\">track buffer</a> managed by this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-49\"><code>SourceBuffer</code></a>, run\n              the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"normalized TimeRanges\">track ranges</var> equal the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer-ranges\" class=\"internalDFN\" id=\"ref-for-track-buffer-ranges-4\">track buffer ranges</a>\n                  for the current <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-7\">track buffer</a>."
            },
            {
              "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-25\"><code>readyState</code></a> is \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-9\"><code>ended</code></a>\", then set the end\n                  time on the last range in <var data-type=\"normalized TimeRanges\">track ranges</var> to <var data-type=\"double\">highest end time</var>."
            },
            {
              "html": "Let <var data-type=\"normalized TimeRanges\">new intersection ranges</var> equal the intersection\n                  between the <var data-type=\"normalized TimeRanges\">intersection ranges</var> and the <var data-type=\"normalized TimeRanges\">track ranges</var>."
            },
            {
              "html": "Replace the ranges in <var data-type=\"normalized TimeRanges\">intersection ranges</var> with the <var>new intersection\n                  ranges</var>."
            }
          ]
        },
        {
          "html": "If <var data-type=\"normalized TimeRanges\">intersection ranges</var> does not contain the exact same range information as the\n              current value of this attribute, then update the current value of this attribute to\n              <var data-type=\"normalized TimeRanges\">intersection ranges</var>."
        },
        {
          "html": "Return the current value of this attribute."
        }
      ]
    },
    {
      "name": "SourceBuffer/timestampOffset",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset",
      "html": "On setting, run the following steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"double\">new timestamp offset</var> equal the new value being assigned to this\n              attribute."
        },
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-23\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-6\">parent media source</a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-7\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-26\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-7\">parent media source</a> is in\n                  the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-10\"><code>ended</code></a>\" state then run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-27\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-8\">parent media source</a>\n                  to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-15\"><code>open</code></a>\""
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-4\"><code>sourceopen</code></a> at the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-9\">parent media source</a>."
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-2\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-media-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-media-segment-2\">PARSING_MEDIA_SEGMENT</a>, then\n              throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-4\"><code>mode</code></a> attribute equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-5\"><code>sequence</code></a>\", then\n              set the <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-2\"><code>[[group start timestamp]]</code></a> to <var data-type=\"double\">new timestamp offset</var>."
        },
        {
          "html": "Update the attribute to <var data-type=\"double\">new timestamp offset</var>."
        }
      ]
    },
    {
      "name": "SourceBuffer/appendWindowStart",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowstart",
      "html": "On setting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-24\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-10\">parent media source</a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-8\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the new value is less than 0 or greater than or equal to\n              <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowend\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowend-3\"><code>appendWindowEnd</code></a> then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort these\n              steps."
        },
        {
          "html": "Update the attribute to the new value."
        }
      ]
    },
    {
      "name": "SourceBuffer/appendWindowEnd",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowend",
      "html": "On setting, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-25\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-11\">parent media source</a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-9\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the new value equals NaN, then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> and abort these steps."
        },
        {
          "html": "If the new value is less than or equal to <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowstart\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowstart-3\"><code>appendWindowStart</code></a> then\n              throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort these steps."
        },
        {
          "html": "Update the attribute to the new value."
        }
      ]
    },
    {
      "name": "SourceBuffer/appendBuffer()",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-appendbuffer",
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "run",
      "steps": [
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-prepare-append\" class=\"internalDFN\" id=\"ref-for-dfn-prepare-append-1\">prepare append</a> algorithm."
        },
        {
          "html": "Add <var data-type=\"BufferSource\">data</var> to the end of the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-1\"><code>[[input buffer]]</code></a>."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-10\"><code>updating</code></a> attribute to true."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updatestart\" href=\"https://w3c.github.io/media-source/#dfn-updatestart\" class=\"internalDFN\" id=\"ref-for-dfn-updatestart-2\"><code>updatestart</code></a> at this\n              <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-52\"><code>SourceBuffer</code></a> object."
        },
        {
          "html": "Asynchronously run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-buffer-append\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-append-2\">buffer append</a> algorithm."
        }
      ]
    },
    {
      "name": "SourceBuffer/abort()",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-abort",
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-26\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-12\">parent media source</a> then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-28\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-13\">parent media source</a> is not\n              in the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-16\"><code>open</code></a>\" state then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception\n              and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-range-removal\" class=\"internalDFN\" id=\"ref-for-dfn-range-removal-1\">range removal</a> algorithm is running, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-11\"><code>updating</code></a> attribute equals true, then run the following\n              steps:",
          "rationale": "abort",
          "steps": [
            {
              "html": "Abort the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-buffer-append\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-append-3\">buffer append</a> algorithm if it is running."
            },
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-12\"><code>updating</code></a> attribute to false."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"abort\" href=\"https://w3c.github.io/media-source/#dfn-abort\" class=\"internalDFN\" id=\"ref-for-dfn-abort-3\"><code>abort</code></a> at this\n                  <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-53\"><code>SourceBuffer</code></a> object."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updateend\" href=\"https://w3c.github.io/media-source/#dfn-updateend\" class=\"internalDFN\" id=\"ref-for-dfn-updateend-3\"><code>updateend</code></a> at this\n                  <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-54\"><code>SourceBuffer</code></a> object."
            }
          ]
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-reset-parser-state\" class=\"internalDFN\" id=\"ref-for-dfn-reset-parser-state-1\">reset parser state</a> algorithm."
        },
        {
          "html": "Set <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowstart\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowstart-4\"><code>appendWindowStart</code></a> to the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-start-time\" class=\"internalDFN\" id=\"ref-for-presentation-start-time-5\">presentation start time</a>."
        },
        {
          "html": "Set <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowend\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowend-4\"><code>appendWindowEnd</code></a> to positive Infinity."
        }
      ]
    },
    {
      "name": "SourceBuffer/changeType()",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-changetype",
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var data-type=\"DOMString\">type</var> is an empty string then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-27\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-14\">parent media source</a>, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-13\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If <var data-type=\"DOMString\">type</var> contains a MIME type that is not supported or contains a MIME type that\n              is not supported with the types specified (currently or previously) of\n              <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-55\"><code>SourceBuffer</code></a> objects in the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-28\"><code>sourceBuffers</code></a> attribute of the\n              <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-15\">parent media source</a>, then throw a <a data-link-type=\"idl\" data-lt=\"NotSupportedError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\"><code>NotSupportedError</code></a> exception and abort these\n              steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-29\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-16\">parent media source</a> is in\n                  the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-11\"><code>ended</code></a>\" state then run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-30\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-17\">parent media source</a>\n                  to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-17\"><code>open</code></a>\"."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-5\"><code>sourceopen</code></a> at the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-18\">parent media source</a>."
            }
          ]
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-reset-parser-state\" class=\"internalDFN\" id=\"ref-for-dfn-reset-parser-state-2\">reset parser state</a> algorithm."
        },
        {
          "html": "Update the <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-4\"><code>[[generate timestamps flag]]</code></a> on this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-56\"><code>SourceBuffer</code></a>\n              object to the value in the \"Generate Timestamps Flag\" column of the byte stream\n              format registry [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://w3c.github.io/media-source/#bib-mse-registry\" title=\"Media Source Extensions™ Byte Stream Format Registry\">MSE-REGISTRY</a></cite>] entry that is associated with <var data-type=\"DOMString\">type</var>."
        },
        {
          "html": "<dl class=\"switch\">\n                  <dt>\n                    If the <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-5\"><code>[[generate timestamps flag]]</code></a> equals true:\n                  </dt>\n                  <dd>\n                    Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-5\"><code>mode</code></a> attribute on this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-57\"><code>SourceBuffer</code></a> object to\n                    \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-6\"><code>sequence</code></a>\", including running the associated steps for that\n                    attribute being set.\n                  </dd>\n                  <dt>\n                    Otherwise:\n                  </dt>\n                  <dd>\n                    Keep the previous value of the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-6\"><code>mode</code></a> attribute on this\n                    <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-58\"><code>SourceBuffer</code></a> object, without running any associated steps for that\n                    attribute being set.\n                  </dd>\n                </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the [[generate timestamps flag]] equals true:",
                  "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-5\"><code>mode</code></a> attribute on this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-57\"><code>SourceBuffer</code></a> object to\n                    \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-6\"><code>sequence</code></a>\", including running the associated steps for that\n                    attribute being set."
                },
                {
                  "case": "Otherwise:",
                  "html": "Keep the previous value of the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-6\"><code>mode</code></a> attribute on this\n                    <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-58\"><code>SourceBuffer</code></a> object, without running any associated steps for that\n                    attribute being set."
                }
              ]
            }
          ]
        },
        {
          "html": "Set the <a data-link-type=\"attribute\" data-lt=\"[[pending initialization segment for changeType flag]]\" href=\"https://w3c.github.io/media-source/#dfn-pending-initialization-segment-for-changetype-flag\" class=\"internalDFN\" id=\"ref-for-dfn-pending-initialization-segment-for-changetype-flag-1\"><code>[[pending initialization segment for changeType flag]]</code></a>\n              on this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-59\"><code>SourceBuffer</code></a> object to true."
        }
      ]
    },
    {
      "name": "SourceBuffer/remove()",
      "href": "https://w3c.github.io/media-source/#dom-sourcebuffer-remove",
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If this object has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-29\"><code>sourceBuffers</code></a> attribute\n              of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-19\">parent media source</a> then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-14\"><code>updating</code></a> attribute equals true, then throw an\n              <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-7\"><code>duration</code></a> equals NaN, then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and\n              abort these steps."
        },
        {
          "html": "If <var data-type=\"double\">start</var> is negative or greater than <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-8\"><code>duration</code></a>, then\n              throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort these steps."
        },
        {
          "html": "If <var data-type=\"unrestricted double\">end</var> is less than or equal to <var data-type=\"double\">start</var> or <var data-type=\"unrestricted double\">end</var> equals\n              NaN, then throw a <a data-link-type=\"idl\" data-lt=\"TypeError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError</code></a> exception and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-31\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-20\">parent media source</a> is in\n                  the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-12\"><code>ended</code></a>\" state then run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-32\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-21\">parent media source</a>\n                  to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-18\"><code>open</code></a>\""
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-6\"><code>sourceopen</code></a> at the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-22\">parent media source</a>."
            }
          ]
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-range-removal\" class=\"internalDFN\" id=\"ref-for-dfn-range-removal-2\">range removal</a> algorithm with <var data-type=\"double\">start</var> and <var data-type=\"unrestricted double\">end</var> as the start and end\n              of the removal range."
        }
      ]
    },
    {
      "html": "When the segment parser loop algorithm is invoked, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "<i>Loop Top:</i> If the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-2\"><code>[[input buffer]]</code></a> is empty, then jump to the\n              <i>need more data</i> step below."
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-3\"><code>[[input buffer]]</code></a> contains bytes that violate the\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-sourcebuffer-byte-stream-format-specification\" class=\"internalDFN\" id=\"ref-for-dfn-sourcebuffer-byte-stream-format-specification-1\">SourceBuffer byte stream format specification</a>, then run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-append-error\" class=\"internalDFN\" id=\"ref-for-dfn-append-error-3\">append error</a>\n            algorithm and abort this algorithm."
        },
        {
          "html": "Remove any bytes that the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#byte-stream-format-specs\" class=\"internalDFN\" id=\"ref-for-byte-stream-format-specs-5\">byte stream format specifications</a> say <em class=\"rfc2119\">MUST</em> be ignored\n            from the start of the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-4\"><code>[[input buffer]]</code></a>."
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-3\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-waiting-for-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-waiting-for-segment-2\">WAITING_FOR_SEGMENT</a>, then run\n                the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the beginning of the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-5\"><code>[[input buffer]]</code></a> indicates the start\n                of an <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-8\">initialization segment</a>, set the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-4\"><code>[[append state]]</code></a> to\n                <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-init-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-init-segment-1\">PARSING_INIT_SEGMENT</a>."
            },
            {
              "html": "If the beginning of the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-6\"><code>[[input buffer]]</code></a> indicates the start\n                of a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-media-segment\" class=\"internalDFN\" id=\"ref-for-dfn-media-segment-10\">media segment</a>, set <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-5\"><code>[[append state]]</code></a> to\n                <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-media-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-media-segment-3\">PARSING_MEDIA_SEGMENT</a>."
            },
            {
              "html": "Jump to the <i>loop top</i> step above."
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-6\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-init-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-init-segment-2\">PARSING_INIT_SEGMENT</a>, then run\n                the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-7\"><code>[[input buffer]]</code></a> does not contain a complete\n                <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-9\">initialization segment</a> yet, then jump to the <i>need more data</i> step below."
            },
            {
              "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment-received\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-received-1\">initialization segment received</a> algorithm."
            },
            {
              "html": "Remove the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-10\">initialization segment</a> bytes from the beginning of the\n                <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-8\"><code>[[input buffer]]</code></a>."
            },
            {
              "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-7\"><code>[[append state]]</code></a> to <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-waiting-for-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-waiting-for-segment-3\">WAITING_FOR_SEGMENT</a>."
            },
            {
              "html": "Jump to the <i>loop top</i> step above."
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-8\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-media-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-media-segment-4\">PARSING_MEDIA_SEGMENT</a>, then run\n                the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[first initialization segment received flag]]\" href=\"https://w3c.github.io/media-source/#dfn-first-initialization-segment-received-flag\" class=\"internalDFN\" id=\"ref-for-dfn-first-initialization-segment-received-flag-1\"><code>[[first initialization segment received flag]]</code></a> is false\n                or the <a data-link-type=\"attribute\" data-lt=\"[[pending initialization segment for changeType flag]]\" href=\"https://w3c.github.io/media-source/#dfn-pending-initialization-segment-for-changetype-flag\" class=\"internalDFN\" id=\"ref-for-dfn-pending-initialization-segment-for-changetype-flag-2\"><code>[[pending initialization segment for changeType flag]]</code></a> is\n                true, then run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-append-error\" class=\"internalDFN\" id=\"ref-for-dfn-append-error-4\">append error</a> algorithm and abort this algorithm."
            },
            {
              "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-9\"><code>[[input buffer]]</code></a> contains one or more complete <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-25\">coded frames</a>, then run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-processing\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-processing-9\">coded frame processing</a> algorithm."
            },
            {
              "html": "If this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-79\"><code>SourceBuffer</code></a> is full and cannot accept more media data, then set\n                the <a data-link-type=\"attribute\" data-lt=\"[[buffer full flag]]\" href=\"https://w3c.github.io/media-source/#dfn-buffer-full-flag\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-full-flag-1\"><code>[[buffer full flag]]</code></a> to true."
            },
            {
              "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-10\"><code>[[input buffer]]</code></a> does not contain a complete <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-media-segment\" class=\"internalDFN\" id=\"ref-for-dfn-media-segment-11\">media segment</a>, then jump to the <i>need more data</i> step below."
            },
            {
              "html": "Remove the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-media-segment\" class=\"internalDFN\" id=\"ref-for-dfn-media-segment-12\">media segment</a> bytes from the beginning of the\n                <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-11\"><code>[[input buffer]]</code></a>."
            },
            {
              "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-9\"><code>[[append state]]</code></a> to <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-waiting-for-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-waiting-for-segment-4\">WAITING_FOR_SEGMENT</a>."
            },
            {
              "html": "Jump to the <i>loop top</i> step above."
            }
          ]
        },
        {
          "html": "<i>Need more data:</i> Return control to the calling algorithm."
        }
      ]
    },
    {
      "html": "When the parser state needs to be reset, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-10\"><code>[[append state]]</code></a> equals <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-parsing-media-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-parsing-media-segment-5\">PARSING_MEDIA_SEGMENT</a> and the\n            <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-12\"><code>[[input buffer]]</code></a> contains some complete <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-26\">coded frames</a>, then run the\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-processing\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-processing-10\">coded frame processing</a> algorithm until all of these complete <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-27\">coded frames</a> have\n            been processed."
        },
        {
          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-1\">last decode timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-17\">track buffers</a>."
        },
        {
          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-frame-duration\" class=\"internalDFN\" id=\"ref-for-last-frame-duration-1\">last frame duration</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-18\">track buffers</a>."
        },
        {
          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-1\">highest end timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-19\">track buffers</a>."
        },
        {
          "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-1\">need random access point flag</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-20\">track buffers</a> to true."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-10\"><code>mode</code></a> attribute equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-9\"><code>sequence</code></a>\", then set\n            the <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-3\"><code>[[group start timestamp]]</code></a> to the <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-3\"><code>[[group end timestamp]]</code></a>"
        },
        {
          "html": "Remove all bytes from the <a data-link-type=\"attribute\" data-lt=\"[[input buffer]]\" href=\"https://w3c.github.io/media-source/#dfn-input-buffer\" class=\"internalDFN\" id=\"ref-for-dfn-input-buffer-13\"><code>[[input buffer]]</code></a>."
        },
        {
          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[append state]]\" href=\"https://w3c.github.io/media-source/#dfn-append-state\" class=\"internalDFN\" id=\"ref-for-dfn-append-state-11\"><code>[[append state]]</code></a> to <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#sourcebuffer-waiting-for-segment\" class=\"internalDFN\" id=\"ref-for-sourcebuffer-waiting-for-segment-5\">WAITING_FOR_SEGMENT</a>."
        }
      ]
    },
    {
      "html": "This algorithm is called when an error occurs during an append.",
      "rationale": "run",
      "steps": [
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-reset-parser-state\" class=\"internalDFN\" id=\"ref-for-dfn-reset-parser-state-3\">reset parser state</a> algorithm."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-19\"><code>updating</code></a> attribute to false."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"error\" href=\"https://w3c.github.io/media-source/#dfn-error\" class=\"internalDFN\" id=\"ref-for-dfn-error-2\"><code>error</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-80\"><code>SourceBuffer</code></a>\n            object."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updateend\" href=\"https://w3c.github.io/media-source/#dfn-updateend\" class=\"internalDFN\" id=\"ref-for-dfn-updateend-4\"><code>updateend</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-81\"><code>SourceBuffer</code></a>\n            object."
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-end-of-stream\" class=\"internalDFN\" id=\"ref-for-dfn-end-of-stream-2\">end of stream</a> algorithm with the <var data-type=\"EndOfStreamError\">error</var> parameter set\n            to \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-endofstreamerror-decode\" class=\"internalDFN\" id=\"ref-for-dom-endofstreamerror-decode-3\"><code>decode</code></a>\"."
        }
      ]
    },
    {
      "html": "When an append operation begins, the following steps are run to validate and prepare\n            the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-82\"><code>SourceBuffer</code></a>.",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-83\"><code>SourceBuffer</code></a> has been removed from the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-30\"><code>sourceBuffers</code></a>\n            attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-23\">parent media source</a> then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception\n            and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-20\"><code>updating</code></a> attribute equals true, then throw an\n            <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception and abort these steps."
        },
        {
          "html": "Let <var data-type=\"boolean\">recent element error</var> be determined as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the MediaSource was constructed in a Window",
                  "html": "Let <var data-type=\"boolean\">recent element error</var> be true if the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                  <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dfn-error\" class=\"internalDFN\" id=\"ref-for-dfn-error-3\"><code>error</code></a> attribute is not null. If that attribute is null, then\n                  let <var data-type=\"boolean\">recent element error</var> be false."
                },
                {
                  "case": "Otherwise",
                  "html": "Let <var data-type=\"boolean\">recent element error</var> be the value resulting from the steps for the\n                  <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> case, but run on the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a> on any change to\n                  its <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dfn-error\" class=\"internalDFN\" id=\"ref-for-dfn-error-4\"><code>error</code></a> attribute and communicated by using\n                  <a data-link-type=\"attribute\" data-lt=\"[[port to worker]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-worker\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-worker-7\"><code>[[port to worker]]</code></a> implicit messages. If such a message has\n                  not yet been received, then let <var data-type=\"boolean\">recent element error</var> be false."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var data-type=\"boolean\">recent element error</var> is true, then throw an <a data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError</code></a> exception\n            and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-33\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-24\">parent media source</a> is in\n                the \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-13\"><code>ended</code></a>\" state then run the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-34\"><code>readyState</code></a> attribute of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-25\">parent media source</a> to\n                \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-open\" class=\"internalDFN\" id=\"ref-for-dom-readystate-open-19\"><code>open</code></a>\""
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"sourceopen\" href=\"https://w3c.github.io/media-source/#dfn-sourceopen\" class=\"internalDFN\" id=\"ref-for-dfn-sourceopen-7\"><code>sourceopen</code></a> at the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-26\">parent media source</a>."
            }
          ]
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-eviction\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-eviction-1\">coded frame eviction</a> algorithm."
        },
        {
          "html": "<p>\n                If the <a data-link-type=\"attribute\" data-lt=\"[[buffer full flag]]\" href=\"https://w3c.github.io/media-source/#dfn-buffer-full-flag\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-full-flag-2\"><code>[[buffer full flag]]</code></a> equals true, then throw a\n                <a data-link-type=\"idl\" data-lt=\"QuotaExceededError\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#quotaexceedederror\"><code>QuotaExceededError</code></a> exception and abort these steps.\n              </p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"idl\" data-lt=\"appendBuffer()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendbuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendbuffer-9\"><code>appendBuffer</code></a><code>()</code> is called, the following steps are run to process\n            the appended data.",
      "rationale": "run",
      "steps": [
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-segment-parser-loop\" class=\"internalDFN\" id=\"ref-for-dfn-segment-parser-loop-1\">segment parser loop</a> algorithm."
        },
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-segment-parser-loop\" class=\"internalDFN\" id=\"ref-for-dfn-segment-parser-loop-2\">segment parser loop</a> algorithm in the previous step was aborted, then\n            abort this algorithm."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-21\"><code>updating</code></a> attribute to false."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"update\" href=\"https://w3c.github.io/media-source/#dfn-update\" class=\"internalDFN\" id=\"ref-for-dfn-update-2\"><code>update</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-84\"><code>SourceBuffer</code></a>\n            object."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updateend\" href=\"https://w3c.github.io/media-source/#dfn-updateend\" class=\"internalDFN\" id=\"ref-for-dfn-updateend-5\"><code>updateend</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-85\"><code>SourceBuffer</code></a>\n            object."
        }
      ]
    },
    {
      "html": "Follow these steps when a caller needs to initiate a JavaScript visible range removal\n            operation that blocks other SourceBuffer updates:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"double\">start</var> equal the starting <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-16\">presentation timestamp</a> for the removal\n            range, in seconds measured from <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-start-time\" class=\"internalDFN\" id=\"ref-for-presentation-start-time-8\">presentation start time</a>."
        },
        {
          "html": "Let <var data-type=\"unrestricted double\">end</var> equal the end <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-17\">presentation timestamp</a> for the\n            removal range, in seconds measured from <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-start-time\" class=\"internalDFN\" id=\"ref-for-presentation-start-time-9\">presentation start time</a>."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-22\"><code>updating</code></a> attribute to true."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updatestart\" href=\"https://w3c.github.io/media-source/#dfn-updatestart\" class=\"internalDFN\" id=\"ref-for-dfn-updatestart-3\"><code>updatestart</code></a> at this\n            <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-86\"><code>SourceBuffer</code></a> object."
        },
        {
          "html": "Return control to the caller and run the rest of the steps asynchronously."
        },
        {
          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-removal\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-removal-3\">coded frame removal</a> algorithm with <var data-type=\"double\">start</var> and <var data-type=\"unrestricted double\">end</var> as the start and\n            end of the removal range."
        },
        {
          "html": "Set the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-updating\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-updating-23\"><code>updating</code></a> attribute to false."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"update\" href=\"https://w3c.github.io/media-source/#dfn-update\" class=\"internalDFN\" id=\"ref-for-dfn-update-3\"><code>update</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-87\"><code>SourceBuffer</code></a>\n            object."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"updateend\" href=\"https://w3c.github.io/media-source/#dfn-updateend\" class=\"internalDFN\" id=\"ref-for-dfn-updateend-6\"><code>updateend</code></a> at this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-88\"><code>SourceBuffer</code></a>\n            object."
        }
      ]
    },
    {
      "name": "SourceBuffer/[[pending initialization segment for changeType flag]]",
      "href": "https://w3c.github.io/media-source/#dfn-pending-initialization-segment-for-changetype-flag",
      "html": "Each SourceBuffer object has a <dfn data-dfn-for=\"SourceBuffer\" data-idl=\"\" data-noexport=\"\" data-dfn-type=\"attribute\" id=\"dfn-pending-initialization-segment-for-changetype-flag\" tabindex=\"0\" aria-haspopup=\"dialog\">[[pending\n            initialization segment for changeType flag]]</dfn> internal slot that tracks whether an\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-13\">initialization segment</a> is needed since the most recent\n            <a data-link-type=\"idl\" data-lt=\"changeType()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-changetype\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-changetype-6\"><code>changeType</code></a><code>()</code>. This flag is set to false when the SourceBuffer is\n            created, set to true by <a data-link-type=\"idl\" data-lt=\"changeType()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-changetype\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-changetype-7\"><code>changeType</code></a><code>()</code> and reset to false by the\n            algorithm below.",
      "rationale": "update",
      "steps": [
        {
          "html": "Update the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-9\"><code>duration</code></a> attribute if it currently equals NaN:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the initialization segment contains a duration:",
                  "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-duration-change\" class=\"internalDFN\" id=\"ref-for-dfn-duration-change-4\">duration change</a> algorithm with <var data-type=\"unrestricted double\">new duration</var> set\n                  to the duration in the initialization segment."
                },
                {
                  "case": "Otherwise:",
                  "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-duration-change\" class=\"internalDFN\" id=\"ref-for-dfn-duration-change-5\">duration change</a> algorithm with <var data-type=\"unrestricted double\">new duration</var> set to positive\n                  Infinity."
                }
              ]
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-14\">initialization segment</a> has no audio, video, or text tracks, then run the\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-append-error\" class=\"internalDFN\" id=\"ref-for-dfn-append-error-5\">append error</a> algorithm and abort these steps."
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[first initialization segment received flag]]\" href=\"https://w3c.github.io/media-source/#dfn-first-initialization-segment-received-flag\" class=\"internalDFN\" id=\"ref-for-dfn-first-initialization-segment-received-flag-2\"><code>[[first initialization segment received flag]]</code></a> is true,\n            then run the following steps:",
          "rationale": "verify",
          "steps": [
            {
              "html": "Verify the following properties. If any of the checks fail then run the\n                <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-append-error\" class=\"internalDFN\" id=\"ref-for-dfn-append-error-6\">append error</a> algorithm and abort these steps.\n                  <ul>\n                    <li>The number of audio, video, and text tracks match what was in the first\n                    <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-15\">initialization segment</a>.\n                    </li>\n                    <li>If more than one track for a single type are present (e.g., 2 audio\n                    tracks), then the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-id\" class=\"internalDFN\" id=\"ref-for-dfn-track-id-5\">Track IDs</a> match the ones in the first <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-16\">initialization segment</a>.\n                    </li>\n                    <li>The codecs for each track are supported by the user agent.\n                      \n                    </li>\n                  </ul>"
            },
            {
              "html": "Add the appropriate <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-description\" class=\"internalDFN\" id=\"ref-for-dfn-track-description-3\">track descriptions</a> from this <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-17\">initialization segment</a>\n                to each of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-21\">track buffers</a>."
            },
            {
              "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-2\">need random access point flag</a> on all track buffers to true."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"boolean\">active track flag</var> equal false."
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[first initialization segment received flag]]\" href=\"https://w3c.github.io/media-source/#dfn-first-initialization-segment-received-flag\" class=\"internalDFN\" id=\"ref-for-dfn-first-initialization-segment-received-flag-3\"><code>[[first initialization segment received flag]]</code></a> is false,\n                then run the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-18\">initialization segment</a> contains tracks with codecs the user agent\n                does not support, then run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-append-error\" class=\"internalDFN\" id=\"ref-for-dfn-append-error-7\">append error</a> algorithm and abort these steps."
            },
            {
              "html": "For each audio track in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-20\">initialization segment</a>, run following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>audio byte stream track ID</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-id\" class=\"internalDFN\" id=\"ref-for-dfn-track-id-6\">Track ID</a> for the current track\n                    being processed."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">audio language</var> be a BCP 47 language tag for the language\n                    specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-21\">initialization segment</a> for this track or an empty string\n                    if no language info is present."
                },
                {
                  "html": "If <var data-type=\"DOMString\">audio language</var> equals the 'und' BCP 47 value, then assign an empty\n                    string to <var data-type=\"DOMString\">audio language</var>."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">audio label</var> be a label specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-22\">initialization segment</a> for this track or an empty string if no label info is present."
                },
                {
                  "html": "Let <var data-type=\"DOMString sequence\">audio kinds</var> be a sequence of kind strings\n                    specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-23\">initialization segment</a> for this track or a sequence with a\n                    single empty string element in it if no kind information is provided."
                },
                {
                  "html": "For each value in <var data-type=\"DOMString sequence\">audio kinds</var>, run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"DOMString\">current audio kind</var> equal the value from <var data-type=\"DOMString sequence\">audio kinds</var>\n                        for this iteration of the loop."
                    },
                    {
                      "html": "Let <var data-type=\"AudioTrack\">new audio track</var> be a new <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a> object."
                    },
                    {
                      "html": "Generate a unique ID and assign it to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-id\"><code>id</code></a> property on\n                        <var data-type=\"AudioTrack\">new audio track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">audio language</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-language\"><code>language</code></a> property on <var>new\n                        audio track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">audio label</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-label\"><code>label</code></a> property on <var>new audio\n                        track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">current audio kind</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-kind\"><code>kind</code></a> property on <var>new\n                        audio track</var>."
                    },
                    {
                      "html": "If this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-95\"><code>SourceBuffer</code></a> object's <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-audiotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-audiotracks-3\"><code>audioTracks</code></a>'s\n                            <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotracklist-length\"><code>length</code></a> equals 0, then run the following steps:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-audiotrack-enabled\"><code>enabled</code></a> property on <var data-type=\"AudioTrack\">new audio track</var> to\n                            true."
                        },
                        {
                          "html": "Set <var data-type=\"boolean\">active track flag</var> to true."
                        }
                      ]
                    },
                    {
                      "html": "Add <var data-type=\"AudioTrack\">new audio track</var> to the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-audiotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-audiotracks-4\"><code>audioTracks</code></a> attribute on\n                        this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-96\"><code>SourceBuffer</code></a> object."
                    },
                    {
                      "html": "<dl class=\"switch\">\n                            <dt>\n                              If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-27\">parent media source</a> was constructed in a\n                              <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>:\n                            </dt>\n                            <dd>\n                              Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-7\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:\n                              \n                            </dd>\n                            <dt>\n                              Otherwise:\n                            </dt>\n                            <dd>\n                              Add <var data-type=\"AudioTrack\">new audio track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks\"><code>audioTracks</code></a>\n                              attribute on the HTMLMediaElement.\n                            </dd>\n                          </dl>",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "If the parent media source was constructed in a DedicatedWorkerGlobalScope:",
                              "html": "Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-7\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "Let <var data-type=\"AudioTrack\">mirrored audio track</var> be a new <a data-link-type=\"idl\" data-lt=\"AudioTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#audiotrack\"><code>AudioTrack</code></a>\n                                object."
                                },
                                {
                                  "html": "Assign the same property values to <var data-type=\"AudioTrack\">mirrored audio track</var> as\n                                were determined for <var data-type=\"AudioTrack\">new audio track</var>."
                                },
                                {
                                  "html": "Add <var data-type=\"AudioTrack\">mirrored audio track</var> to the\n                                <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks\"><code>audioTracks</code></a> attribute on the HTMLMediaElement."
                                }
                              ]
                            },
                            {
                              "case": "Otherwise:",
                              "html": "Add <var data-type=\"AudioTrack\">new audio track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-audiotracks\"><code>audioTracks</code></a>\n                              attribute on the HTMLMediaElement."
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Create a new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-22\">track buffer</a> to store <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-28\">coded frames</a> for this track."
                },
                {
                  "html": "Add the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-description\" class=\"internalDFN\" id=\"ref-for-dfn-track-description-4\">track description</a> for this track to the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-23\">track buffer</a>."
                }
              ]
            },
            {
              "html": "For each video track in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-24\">initialization segment</a>, run following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>video byte stream track ID</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-id\" class=\"internalDFN\" id=\"ref-for-dfn-track-id-7\">Track ID</a> for the current track\n                    being processed."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">video language</var> be a BCP 47 language tag for the language\n                    specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-25\">initialization segment</a> for this track or an empty string\n                    if no language info is present."
                },
                {
                  "html": "If <var data-type=\"DOMString\">video language</var> equals the 'und' BCP 47 value, then assign an empty\n                    string to <var data-type=\"DOMString\">video language</var>."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">video label</var> be a label specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-26\">initialization segment</a> for this track or an empty string if no label info is present."
                },
                {
                  "html": "Let <var data-type=\"DOMString sequence\">video kinds</var> be a sequence of kind strings\n                    specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-27\">initialization segment</a> for this track or a sequence with a\n                    single empty string element in it if no kind information is provided."
                },
                {
                  "html": "For each value in <var data-type=\"DOMString sequence\">video kinds</var>, run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"DOMString\">current video kind</var> equal the value from <var data-type=\"DOMString sequence\">video kinds</var>\n                        for this iteration of the loop."
                    },
                    {
                      "html": "Let <var data-type=\"VideoTrack\">new video track</var> be a new <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a> object."
                    },
                    {
                      "html": "Generate a unique ID and assign it to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-id\"><code>id</code></a> property on\n                        <var data-type=\"VideoTrack\">new video track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">video language</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-language\"><code>language</code></a> property on <var>new\n                        video track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">video label</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-label\"><code>label</code></a> property on <var>new video\n                        track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">current video kind</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-kind\"><code>kind</code></a> property on <var>new\n                        video track</var>."
                    },
                    {
                      "html": "If this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-98\"><code>SourceBuffer</code></a> object's <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-videotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-videotracks-3\"><code>videoTracks</code></a>'s\n                            <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotracklist-length\"><code>length</code></a> equals 0, then run the following steps:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "Set the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-videotrack-selected\"><code>selected</code></a> property on <var data-type=\"VideoTrack\">new video track</var> to\n                            true."
                        },
                        {
                          "html": "Set <var data-type=\"boolean\">active track flag</var> to true."
                        }
                      ]
                    },
                    {
                      "html": "Add <var data-type=\"VideoTrack\">new video track</var> to the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-videotracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-videotracks-4\"><code>videoTracks</code></a> attribute on\n                        this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-99\"><code>SourceBuffer</code></a> object."
                    },
                    {
                      "html": "<dl class=\"switch\">\n                            <dt>\n                              If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-28\">parent media source</a> was constructed in a\n                              <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>:\n                            </dt>\n                            <dd>\n                              Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-8\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:\n                              \n                            </dd>\n                            <dt>\n                              Otherwise:\n                            </dt>\n                            <dd>\n                              Add <var data-type=\"VideoTrack\">new video track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks\"><code>videoTracks</code></a>\n                              attribute on the HTMLMediaElement.\n                            </dd>\n                          </dl>",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "If the parent media source was constructed in a DedicatedWorkerGlobalScope:",
                              "html": "Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-8\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "Let <var data-type=\"VideoTrack\">mirrored video track</var> be a new <a data-link-type=\"idl\" data-lt=\"VideoTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#videotrack\"><code>VideoTrack</code></a>\n                                object."
                                },
                                {
                                  "html": "Assign the same property values to <var data-type=\"VideoTrack\">mirrored video track</var> as\n                                were determined for <var data-type=\"VideoTrack\">new video track</var>."
                                },
                                {
                                  "html": "Add <var data-type=\"VideoTrack\">mirrored video track</var> to the\n                                <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks\"><code>videoTracks</code></a> attribute on the HTMLMediaElement."
                                }
                              ]
                            },
                            {
                              "case": "Otherwise:",
                              "html": "Add <var data-type=\"VideoTrack\">new video track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-videotracks\"><code>videoTracks</code></a>\n                              attribute on the HTMLMediaElement."
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Create a new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-24\">track buffer</a> to store <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-29\">coded frames</a> for this track."
                },
                {
                  "html": "Add the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-description\" class=\"internalDFN\" id=\"ref-for-dfn-track-description-5\">track description</a> for this track to the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-25\">track buffer</a>."
                }
              ]
            },
            {
              "html": "For each text track in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-28\">initialization segment</a>, run following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>text byte stream track ID</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-id\" class=\"internalDFN\" id=\"ref-for-dfn-track-id-8\">Track ID</a> for the current track\n                    being processed."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">text language</var> be a BCP 47 language tag for the language\n                    specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-29\">initialization segment</a> for this track or an empty string\n                    if no language info is present."
                },
                {
                  "html": "If <var data-type=\"DOMString\">text language</var> equals the 'und' BCP 47 value, then assign an empty\n                    string to <var data-type=\"DOMString\">text language</var>."
                },
                {
                  "html": "Let <var data-type=\"DOMString\">text label</var> be a label specified in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-30\">initialization segment</a> for this track or an empty string if no label info is present."
                },
                {
                  "html": "Let <var data-type=\"DOMString sequence\">text kinds</var> be a sequence of kind strings specified\n                    in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-31\">initialization segment</a> for this track or a sequence with a single\n                    empty string element in it if no kind information is provided."
                },
                {
                  "html": "For each value in <var data-type=\"DOMString sequence\">text kinds</var>, run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"DOMString\">current text kind</var> equal the value from <var data-type=\"DOMString sequence\">text kinds</var> for\n                        this iteration of the loop."
                    },
                    {
                      "html": "Let <var data-type=\"TextTrack\">new text track</var> be a new <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a> object."
                    },
                    {
                      "html": "Generate a unique ID and assign it to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-id\"><code>id</code></a> property on\n                        <var data-type=\"TextTrack\">new text track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">text language</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-language\"><code>language</code></a> property on <var>new\n                        text track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">text label</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-label\"><code>label</code></a> property on <var>new text\n                        track</var>."
                    },
                    {
                      "html": "Assign <var data-type=\"DOMString\">current text kind</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-kind\"><code>kind</code></a> property on <var>new\n                        text track</var>."
                    },
                    {
                      "html": "Populate the remaining properties on <var data-type=\"TextTrack\">new text track</var> with the\n                        appropriate information from the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-initialization-segment\" class=\"internalDFN\" id=\"ref-for-dfn-initialization-segment-32\">initialization segment</a>."
                    },
                    {
                      "html": "If the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-mode\"><code>mode</code></a> property on <var data-type=\"TextTrack\">new text track</var> equals\n                          <code><a href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-showing\">\"showing\"</a></code> or <code><a href=\"https://html.spec.whatwg.org/multipage/media.html#dom-texttrack-hidden\">\"hidden\"</a></code>, then set <var data-type=\"boolean\">active track flag</var> to true."
                    },
                    {
                      "html": "Add <var data-type=\"TextTrack\">new text track</var> to the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-texttracks\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-texttracks-3\"><code>textTracks</code></a> attribute on\n                        this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-101\"><code>SourceBuffer</code></a> object."
                    },
                    {
                      "html": "<dl class=\"switch\">\n                            <dt>\n                              If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-29\">parent media source</a> was constructed in a\n                              <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a>:\n                            </dt>\n                            <dd>\n                              Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-9\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:\n                              \n                            </dd>\n                            <dt>\n                              Otherwise:\n                            </dt>\n                            <dd>\n                              Add <var data-type=\"TextTrack\">new text track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks\"><code>textTracks</code></a> attribute\n                              on the HTMLMediaElement.\n                            </dd>\n                          </dl>",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "If the parent media source was constructed in a DedicatedWorkerGlobalScope:",
                              "html": "Post an internal <code>create track mirror</code> message to\n                              <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-9\"><code>[[port to main]]</code></a> whose implicit handler in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>\n                              runs the following steps:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "Let <var data-type=\"TextTrack\">mirrored text track</var> be a new <a data-link-type=\"idl\" data-lt=\"TextTrack\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#texttrack\"><code>TextTrack</code></a>\n                                object."
                                },
                                {
                                  "html": "Assign the same property values to <var data-type=\"TextTrack\">mirrored text track</var> as\n                                were determined for <var data-type=\"TextTrack\">new text track</var>."
                                },
                                {
                                  "html": "Add <var data-type=\"TextTrack\">mirrored text track</var> to the\n                                <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks\"><code>textTracks</code></a> attribute on the HTMLMediaElement."
                                }
                              ]
                            },
                            {
                              "case": "Otherwise:",
                              "html": "Add <var data-type=\"TextTrack\">new text track</var> to the <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-texttracks\"><code>textTracks</code></a> attribute\n                              on the HTMLMediaElement."
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Create a new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-26\">track buffer</a> to store <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-30\">coded frames</a> for this track."
                },
                {
                  "html": "Add the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-track-description\" class=\"internalDFN\" id=\"ref-for-dfn-track-description-6\">track description</a> for this track to the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-27\">track buffer</a>."
                }
              ]
            },
            {
              "html": "If <var data-type=\"boolean\">active track flag</var> equals true, then run the following steps:",
              "rationale": "add",
              "steps": [
                {
                  "html": "Add this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-103\"><code>SourceBuffer</code></a> to <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-28\"><code>activeSourceBuffers</code></a>."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"addsourcebuffer\" href=\"https://w3c.github.io/media-source/#dfn-addsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dfn-addsourcebuffer-5\"><code>addsourcebuffer</code></a> at\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-29\"><code>activeSourceBuffers</code></a>"
                }
              ]
            },
            {
              "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[first initialization segment received flag]]\" href=\"https://w3c.github.io/media-source/#dfn-first-initialization-segment-received-flag\" class=\"internalDFN\" id=\"ref-for-dfn-first-initialization-segment-received-flag-4\"><code>[[first initialization segment received flag]]</code></a> to true."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[pending initialization segment for changeType flag]]\" href=\"https://w3c.github.io/media-source/#dfn-pending-initialization-segment-for-changetype-flag\" class=\"internalDFN\" id=\"ref-for-dfn-pending-initialization-segment-for-changetype-flag-3\"><code>[[pending initialization segment for changeType flag]]</code></a> to\n            false."
        },
        {
          "html": "If the <var data-type=\"boolean\">active track flag</var> equals true, then run the following steps:"
        },
        {
          "html": "Use the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-30\">parent media source</a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-7\">mirror if necessary</a> algorithm to run the\n            following step in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-20\"><code>readyState</code></a> attribute is\n                greater than <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a>, then set the\n                <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-21\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>."
            }
          ]
        },
        {
          "html": "If each object in <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-31\"><code>sourceBuffers</code></a> of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-31\">parent media source</a> has\n            <a data-link-type=\"attribute\" data-lt=\"[[first initialization segment received flag]]\" href=\"https://w3c.github.io/media-source/#dfn-first-initialization-segment-received-flag\" class=\"internalDFN\" id=\"ref-for-dfn-first-initialization-segment-received-flag-5\"><code>[[first initialization segment received flag]]</code></a> equal to true, then use\n            the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#parent-media-source\" class=\"internalDFN\" id=\"ref-for-parent-media-source-32\">parent media source</a>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-mirror-if-necessary\" class=\"internalDFN\" id=\"ref-for-dfn-mirror-if-necessary-8\">mirror if necessary</a> algorithm to run the following\n            step in <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-23\"><code>readyState</code></a> attribute is\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_nothing\"><code>HAVE_NOTHING</code></a>, then set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-24\"><code>readyState</code></a> attribute to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>."
            }
          ]
        }
      ]
    },
    {
      "html": "When complete <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-31\">coded frames</a> have been parsed by the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-segment-parser-loop\" class=\"internalDFN\" id=\"ref-for-dfn-segment-parser-loop-4\">segment parser loop</a> then the\n            following steps are run:",
      "rationale": "for",
      "steps": [
        {
          "html": "For each <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-32\">coded frame</a> in the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-media-segment\" class=\"internalDFN\" id=\"ref-for-dfn-media-segment-13\">media segment</a> run the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<i>Loop Top:</i>",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If [[generate timestamps flag]] equals true:",
                      "html": "",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var data-type=\"double\">presentation timestamp</var> equal 0."
                        },
                        {
                          "html": "Let <var data-type=\"double\">decode timestamp</var> equal 0."
                        }
                      ]
                    },
                    {
                      "case": "Otherwise:",
                      "html": "",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var data-type=\"double\">presentation timestamp</var> be a double precision floating point\n                        representation of the coded frame's <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-18\">presentation timestamp</a> in seconds."
                        },
                        {
                          "html": "Let <var data-type=\"double\">decode timestamp</var> be a double precision floating point\n                        representation of the coded frame's decode timestamp in seconds."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var data-type=\"double\">frame duration</var> be a double precision floating point representation\n                of the <a data-link-type=\"dfn|abstract-op\" data-lt=\"coded frame duration\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-6\">coded frame's duration</a> in seconds."
            },
            {
              "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-11\"><code>mode</code></a> equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-10\"><code>sequence</code></a>\" and\n                <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-4\"><code>[[group start timestamp]]</code></a> is set, then run the following steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-timestampoffset-6\"><code>timestampOffset</code></a> equal to <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-5\"><code>[[group start timestamp]]</code></a> minus <var data-type=\"double\">presentation timestamp</var>."
                },
                {
                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-4\"><code>[[group end timestamp]]</code></a> equal to\n                    <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-6\"><code>[[group start timestamp]]</code></a>."
                },
                {
                  "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-3\">need random access point flag</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-28\">track buffers</a> to true."
                },
                {
                  "html": "Unset <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-7\"><code>[[group start timestamp]]</code></a>."
                }
              ]
            },
            {
              "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-timestampoffset-7\"><code>timestampOffset</code></a> is not 0, then run the following steps:",
              "rationale": "add",
              "steps": [
                {
                  "html": "Add <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-timestampoffset-8\"><code>timestampOffset</code></a> to the <var data-type=\"double\">presentation timestamp</var>."
                },
                {
                  "html": "Add <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-timestampoffset-9\"><code>timestampOffset</code></a> to the <var data-type=\"double\">decode timestamp</var>."
                }
              ]
            },
            {
              "html": "Let <var>track buffer</var> equal the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-29\">track buffer</a> that the coded frame will be\n                added to."
            },
            {
              "html": "<dl class=\"switch\">\n                    <dt>\n                      If <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-2\">last decode timestamp</a> for <var>track buffer</var> is set and <var data-type=\"double\">decode timestamp</var>\n                      is less than <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-3\">last decode timestamp</a>:\n                    </dt>\n                    <dd>\n                      OR\n                    </dd>\n                    <dt>\n                      If <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-4\">last decode timestamp</a> for <var>track buffer</var> is set and the difference\n                      between <var data-type=\"double\">decode timestamp</var> and <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-5\">last decode timestamp</a> is greater than 2\n                      times <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-frame-duration\" class=\"internalDFN\" id=\"ref-for-last-frame-duration-2\">last frame duration</a>:\n                    </dt>\n                    <dd>\n                      \n                    </dd>\n                    <dt>\n                      Otherwise:\n                    </dt>\n                    <dd>\n                      Continue.\n                    </dd>\n                  </dl>",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If last decode timestamp for track buffer is set and decode timestamp is less than last decode timestamp:",
                      "html": "OR"
                    },
                    {
                      "case": "If last decode timestamp for track buffer is set and the difference between decode timestamp and last decode timestamp is greater than 2 times last frame duration:",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<dl class=\"switch\">\n                            <dt>\n                              If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-12\"><code>mode</code></a> equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-segments\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-segments-4\"><code>segments</code></a>\":\n                            </dt>\n                            <dd>\n                              Set <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-5\"><code>[[group end timestamp]]</code></a> to <var>presentation\n                              timestamp</var>.\n                            </dd>\n                            <dt>\n                              If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-mode\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-mode-13\"><code>mode</code></a> equals \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-appendmode-sequence\" class=\"internalDFN\" id=\"ref-for-dom-appendmode-sequence-11\"><code>sequence</code></a>\":\n                            </dt>\n                            <dd>\n                              Set <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-8\"><code>[[group start timestamp]]</code></a> equal to the\n                              <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-6\"><code>[[group end timestamp]]</code></a>.\n                            </dd>\n                          </dl>",
                          "rationale": ".switch",
                          "steps": [
                            {
                              "operation": "switch",
                              "steps": [
                                {
                                  "case": "If mode equals \"segments\":",
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-5\"><code>[[group end timestamp]]</code></a> to <var>presentation\n                              timestamp</var>."
                                },
                                {
                                  "case": "If mode equals \"sequence\":",
                                  "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-8\"><code>[[group start timestamp]]</code></a> equal to the\n                              <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-6\"><code>[[group end timestamp]]</code></a>."
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-6\">last decode timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-30\">track buffers</a>."
                        },
                        {
                          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-frame-duration\" class=\"internalDFN\" id=\"ref-for-last-frame-duration-3\">last frame duration</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-31\">track buffers</a>."
                        },
                        {
                          "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-2\">highest end timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-32\">track buffers</a>."
                        },
                        {
                          "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-4\">need random access point flag</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-33\">track buffers</a> to\n                        true."
                        },
                        {
                          "html": "Jump to the <i>Loop Top</i> step above to restart processing of the\n                        current <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-33\">coded frame</a>."
                        }
                      ]
                    },
                    {
                      "case": "Otherwise:",
                      "html": "Continue."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var data-type=\"double\">frame end timestamp</var> equal the sum of <var data-type=\"double\">presentation timestamp</var> and\n                <var data-type=\"double\">frame duration</var>."
            },
            {
              "html": "If <var data-type=\"double\">presentation timestamp</var> is less than <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowstart\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowstart-5\"><code>appendWindowStart</code></a>,\n                then set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-5\">need random access point flag</a> to true, drop the coded frame, and\n                jump to the top of the loop to start processing the next coded frame."
            },
            {
              "html": "If <var data-type=\"double\">frame end timestamp</var> is greater than <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendwindowend\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendwindowend-5\"><code>appendWindowEnd</code></a>, then\n                set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-6\">need random access point flag</a> to true, drop the coded frame, and jump\n                to the top of the loop to start processing the next coded frame."
            },
            {
              "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-7\">need random access point flag</a> on <var>track buffer</var> equals true, then\n                run the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the coded frame is not a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#random-access-point\" class=\"internalDFN\" id=\"ref-for-random-access-point-5\">random access point</a>, then drop the coded\n                    frame and jump to the top of the loop to start processing the next coded frame."
                },
                {
                  "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-8\">need random access point flag</a> on <var>track buffer</var> to false."
                }
              ]
            },
            {
              "html": "Let <var>spliced audio frame</var> be an unset variable for holding audio splice\n                information"
            },
            {
              "html": "Let <var>spliced timed text frame</var> be an unset variable for holding timed text\n                splice information"
            },
            {
              "html": "If <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-7\">last decode timestamp</a> for <var>track buffer</var> is unset and <var>presentation\n                timestamp</var> falls within the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-interval\" class=\"internalDFN\" id=\"ref-for-presentation-interval-1\">presentation interval</a> of a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-34\">coded frame</a> in\n                <var>track buffer</var>, then run the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>overlapped frame</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-35\">coded frame</a> in <var>track buffer</var> that\n                    matches the condition above."
                },
                {
                  "html": "<dl class=\"switch\">\n                        <dt>\n                          If <var>track buffer</var> contains audio <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-36\">coded frames</a>:\n                        </dt>\n                        <dd>\n                          Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-audio-splice-frame\" class=\"internalDFN\" id=\"ref-for-dfn-audio-splice-frame-1\">audio splice frame</a> algorithm and if a splice frame is\n                          returned, assign it to <var>spliced audio frame</var>.\n                        </dd>\n                        <dt>\n                          If <var>track buffer</var> contains video <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-37\">coded frames</a>:\n                        </dt>\n                        <dd>\n                          \n                        </dd>\n                        <dt>\n                          If <var>track buffer</var> contains timed text <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-38\">coded frames</a>:\n                        </dt>\n                        <dd>\n                          Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-text-splice-frame\" class=\"internalDFN\" id=\"ref-for-dfn-text-splice-frame-1\">text splice frame</a> algorithm and if a splice frame is\n                          returned, assign it to <var>spliced timed text frame</var>.\n                        </dd>\n                      </dl>",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "If track buffer contains audio coded frames:",
                          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-audio-splice-frame\" class=\"internalDFN\" id=\"ref-for-dfn-audio-splice-frame-1\">audio splice frame</a> algorithm and if a splice frame is\n                          returned, assign it to <var>spliced audio frame</var>."
                        },
                        {
                          "case": "If track buffer contains video coded frames:",
                          "html": "",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "Let <var data-type=\"double\">remove window timestamp</var> equal the <var>overlapped frame</var>\n                            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-20\">presentation timestamp</a> plus 1 microsecond."
                            },
                            {
                              "html": "If the <var data-type=\"double\">presentation timestamp</var> is less than the <var>remove window\n                            timestamp</var>, then remove <var>overlapped frame</var> from <var>track buffer</var>."
                            }
                          ]
                        },
                        {
                          "case": "If track buffer contains timed text coded frames:",
                          "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-text-splice-frame\" class=\"internalDFN\" id=\"ref-for-dfn-text-splice-frame-1\">text splice frame</a> algorithm and if a splice frame is\n                          returned, assign it to <var>spliced timed text frame</var>."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "Remove existing coded frames in <var>track buffer</var>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If highest end timestamp for track buffer is not set:",
                      "html": "Remove all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-39\">coded frames</a> from <var>track buffer</var> that have a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-21\">presentation timestamp</a> greater than or equal to <var data-type=\"double\">presentation timestamp</var> and less than\n                      <var data-type=\"double\">frame end timestamp</var>."
                    },
                    {
                      "case": "If highest end timestamp for track buffer is set and less than or equal to presentation timestamp:",
                      "html": "Remove all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-40\">coded frames</a> from <var>track buffer</var> that have a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-22\">presentation timestamp</a> greater than or equal to <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-5\">highest end timestamp</a> and less than\n                      <var data-type=\"double\">frame end timestamp</var>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Remove all possible decoding dependencies on the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-41\">coded frames</a> removed in\n                the previous two steps by removing all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-42\">coded frames</a> from <var>track buffer</var> between\n                those frames removed in the previous two steps and the next <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#random-access-point\" class=\"internalDFN\" id=\"ref-for-random-access-point-6\">random access point</a>\n                after those removed frames."
            },
            {
              "html": "<dl class=\"switch\">\n                    <dt>\n                      If <var>spliced audio frame</var> is set:\n                    </dt>\n                    <dd>\n                      Add <var>spliced audio frame</var> to the <var>track buffer</var>.\n                    </dd>\n                    <dt>\n                      If <var>spliced timed text frame</var> is set:\n                    </dt>\n                    <dd>\n                      Add <var>spliced timed text frame</var> to the <var>track buffer</var>.\n                    </dd>\n                    <dt>\n                      Otherwise:\n                    </dt>\n                    <dd>\n                      Add the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-44\">coded frame</a> with the <var data-type=\"double\">presentation timestamp</var>, <var>decode\n                      timestamp</var>, and <var data-type=\"double\">frame duration</var> to the <var>track buffer</var>.\n                    </dd>\n                  </dl>",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "If spliced audio frame is set:",
                      "html": "Add <var>spliced audio frame</var> to the <var>track buffer</var>."
                    },
                    {
                      "case": "If spliced timed text frame is set:",
                      "html": "Add <var>spliced timed text frame</var> to the <var>track buffer</var>."
                    },
                    {
                      "case": "Otherwise:",
                      "html": "Add the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-44\">coded frame</a> with the <var data-type=\"double\">presentation timestamp</var>, <var>decode\n                      timestamp</var>, and <var data-type=\"double\">frame duration</var> to the <var>track buffer</var>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Set <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-8\">last decode timestamp</a> for <var>track buffer</var> to <var data-type=\"double\">decode timestamp</var>."
            },
            {
              "html": "Set <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-frame-duration\" class=\"internalDFN\" id=\"ref-for-last-frame-duration-4\">last frame duration</a> for <var>track buffer</var> to <var data-type=\"double\">frame duration</var>."
            },
            {
              "html": "If <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-6\">highest end timestamp</a> for <var>track buffer</var> is unset or <var>frame end\n                timestamp</var> is greater than <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-7\">highest end timestamp</a>, then set <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-8\">highest end timestamp</a> for <var>track buffer</var> to <var data-type=\"double\">frame end timestamp</var>."
            },
            {
              "html": "If <var data-type=\"double\">frame end timestamp</var> is greater than <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-7\"><code>[[group end timestamp]]</code></a>, then set <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-8\"><code>[[group end timestamp]]</code></a> equal to <var>frame\n                end timestamp</var>."
            },
            {
              "html": "If <a data-link-type=\"attribute\" data-lt=\"[[generate timestamps flag]]\" href=\"https://w3c.github.io/media-source/#dfn-generate-timestamps-flag\" class=\"internalDFN\" id=\"ref-for-dfn-generate-timestamps-flag-7\"><code>[[generate timestamps flag]]</code></a> equals true, then set\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-timestampoffset\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-timestampoffset-10\"><code>timestampOffset</code></a> equal to <var data-type=\"double\">frame end timestamp</var>."
            }
          ]
        },
        {
          "html": "<p>\n                If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-26\"><code>readyState</code></a> attribute is\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a> and the new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-45\">coded frames</a> cause\n                <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> to have a <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> for\n                the current playback position, then set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-27\"><code>readyState</code></a> attribute to\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a>.\n              </p>"
        },
        {
          "html": "<p>\n                If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-29\"><code>readyState</code></a> attribute is\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_current_data\"><code>HAVE_CURRENT_DATA</code></a> and the new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-46\">coded frames</a> cause\n                <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> to have a <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> that\n                includes the current playback position and some time beyond the current playback\n                position, then set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-30\"><code>readyState</code></a>\n                attribute to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_future_data\"><code>HAVE_FUTURE_DATA</code></a>.\n              </p>"
        },
        {
          "html": "<p>\n                If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-32\"><code>readyState</code></a> attribute is\n                <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_future_data\"><code>HAVE_FUTURE_DATA</code></a> and the new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-47\">coded frames</a> cause\n                <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> to have a <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> that\n                includes the current playback position and <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#enough-data\" class=\"internalDFN\" id=\"ref-for-enough-data-3\">enough data to ensure uninterrupted playback</a>, then set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-33\"><code>readyState</code></a>\n                attribute to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_enough_data\"><code>HAVE_ENOUGH_DATA</code></a>.\n              </p>"
        },
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-media-segment\" class=\"internalDFN\" id=\"ref-for-dfn-media-segment-14\">media segment</a> contains data beyond the current <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-10\"><code>duration</code></a>,\n            then run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-duration-change\" class=\"internalDFN\" id=\"ref-for-dfn-duration-change-6\">duration change</a> algorithm with <var data-type=\"unrestricted double\">new duration</var> set\n            to the maximum of the current duration and the <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-9\"><code>[[group end timestamp]]</code></a>."
        }
      ]
    },
    {
      "html": "Follow these steps when <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-48\">coded frames</a> for a specific time range need to be removed\n            from the SourceBuffer:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"double\">start</var> be the starting <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-23\">presentation timestamp</a> for the removal\n            range."
        },
        {
          "html": "Let <var data-type=\"unrestricted double\">end</var> be the end <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-24\">presentation timestamp</a> for the removal\n            range."
        },
        {
          "html": "For each <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-34\">track buffer</a> in this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-104\"><code>SourceBuffer</code></a>, run the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"unrestricted double\">remove end timestamp</var> be the current value of\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-11\"><code>duration</code></a>"
            },
            {
              "html": "<p>\n                    If this <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-35\">track buffer</a> has a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#random-access-point\" class=\"internalDFN\" id=\"ref-for-random-access-point-8\">random access point</a> timestamp that is\n                    greater than or equal to <var data-type=\"unrestricted double\">end</var>, then update <var data-type=\"unrestricted double\">remove end timestamp</var> to that\n                    random access point timestamp.\n                  </p>"
            },
            {
              "html": "Remove all media data, from this <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-36\">track buffer</a>, that contain starting\n                timestamps greater than or equal to <var data-type=\"double\">start</var> and less than the <var>remove end\n                timestamp</var>.",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each removed frame, if the frame has a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-decode-timestamp-3\">decode timestamp</a> equal to\n                        the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-9\">last decode timestamp</a> for the frame's track, run the following\n                        steps:",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "If mode equals \"segments\":",
                          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-10\"><code>[[group end timestamp]]</code></a> to <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-25\">presentation timestamp</a>."
                        },
                        {
                          "case": "If mode equals \"sequence\":",
                          "html": "Set <a data-link-type=\"attribute\" data-lt=\"[[group start timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-start-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-start-timestamp-9\"><code>[[group start timestamp]]</code></a> equal to the\n                          <a data-link-type=\"attribute\" data-lt=\"[[group end timestamp]]\" href=\"https://w3c.github.io/media-source/#dfn-group-end-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-group-end-timestamp-11\"><code>[[group end timestamp]]</code></a>."
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-last-decode-timestamp-10\">last decode timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-37\">track buffers</a>."
                },
                {
                  "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#last-frame-duration\" class=\"internalDFN\" id=\"ref-for-last-frame-duration-5\">last frame duration</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-38\">track buffers</a>."
                },
                {
                  "html": "Unset the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#highest-end-timestamp\" class=\"internalDFN\" id=\"ref-for-highest-end-timestamp-9\">highest end timestamp</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-39\">track buffers</a>."
                },
                {
                  "html": "Set the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#need-RAP-flag\" class=\"internalDFN\" id=\"ref-for-need-RAP-flag-9\">need random access point flag</a> on all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-40\">track buffers</a> to true."
                }
              ]
            },
            {
              "html": "Remove all possible decoding dependencies on the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-50\">coded frames</a> removed in\n                the previous step by removing all <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-51\">coded frames</a> from this <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-41\">track buffer</a>\n                between those frames removed in the previous step and the next <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#random-access-point\" class=\"internalDFN\" id=\"ref-for-random-access-point-9\">random access point</a> after those removed frames."
            },
            {
              "html": "<p>\n                    If this object is in <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-30\"><code>activeSourceBuffers</code></a>, the <a href=\"https://html.spec.whatwg.org/multipage/media.html#current-playback-position\">current playback position</a> is greater than or equal to <var data-type=\"double\">start</var> and less\n                    than the <var data-type=\"unrestricted double\">remove end timestamp</var>, and <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-35\"><code>readyState</code></a> is greater than\n                    <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>, then set the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                    <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate\" class=\"internalDFN\" id=\"ref-for-dom-readystate-36\"><code>readyState</code></a> attribute to <a data-link-type=\"idl\" data-type=\"const\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-have_metadata\"><code>HAVE_METADATA</code></a>\n                    and stall playback.\n                  </p>"
            }
          ]
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[buffer full flag]]\" href=\"https://w3c.github.io/media-source/#dfn-buffer-full-flag\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-full-flag-3\"><code>[[buffer full flag]]</code></a> equals true and this object is ready\n            to accept more bytes, then set the <a data-link-type=\"attribute\" data-lt=\"[[buffer full flag]]\" href=\"https://w3c.github.io/media-source/#dfn-buffer-full-flag\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-full-flag-4\"><code>[[buffer full flag]]</code></a> to false."
        }
      ]
    },
    {
      "html": "This algorithm is run to free up space in this <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-105\"><code>SourceBuffer</code></a> when new data is\n            appended.",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"BufferSource\">new data</var> equal the data that is about to be appended to this\n            SourceBuffer."
        },
        {
          "html": "If the <a data-link-type=\"attribute\" data-lt=\"[[buffer full flag]]\" href=\"https://w3c.github.io/media-source/#dfn-buffer-full-flag\" class=\"internalDFN\" id=\"ref-for-dfn-buffer-full-flag-6\"><code>[[buffer full flag]]</code></a> equals false, then abort these steps."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">removal ranges</var> equal a list of presentation time ranges\n            that can be evicted from the presentation to make room for the <var data-type=\"BufferSource\">new data</var>."
        },
        {
          "html": "For each range in <var data-type=\"normalized TimeRanges\">removal ranges</var>, run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-removal\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-removal-4\">coded frame removal</a> algorithm with\n            <var data-type=\"double\">start</var> and <var data-type=\"unrestricted double\">end</var> equal to the removal range start and end\n            timestamp respectively."
        }
      ]
    },
    {
      "html": "Follow these steps when the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-processing\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-processing-11\">coded frame processing</a> algorithm needs to generate a\n            splice frame for two overlapping audio <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-53\">coded frames</a>:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var>track buffer</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-42\">track buffer</a> that will contain the splice."
        },
        {
          "html": "Let <var>new coded frame</var> be the new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-54\">coded frame</a>, that is being added to <var>track\n            buffer</var>, which triggered the need for a splice."
        },
        {
          "html": "Let <var data-type=\"double\">presentation timestamp</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-26\">presentation timestamp</a> for <var>new\n            coded frame</var>."
        },
        {
          "html": "Let <var data-type=\"double\">decode timestamp</var> be the decode timestamp for <var>new coded frame</var>."
        },
        {
          "html": "Let <var data-type=\"double\">frame duration</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-7\">coded frame duration</a> of <var>new coded frame</var>."
        },
        {
          "html": "Let <var>overlapped frame</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-55\">coded frame</a> in <var>track buffer</var> with a\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-interval\" class=\"internalDFN\" id=\"ref-for-presentation-interval-2\">presentation interval</a> that contains <var data-type=\"double\">presentation timestamp</var>."
        },
        {
          "html": "Update <var data-type=\"double\">presentation timestamp</var> and <var data-type=\"double\">decode timestamp</var> to the nearest audio sample\n            timestamp based on sample rate of the audio in <var>overlapped frame</var>. If a timestamp is\n            equidistant from both audio sample timestamps, then use the higher timestamp (e.g.,\n            <code>floor(x * sample_rate + 0.5) / sample_rate</code>)."
        },
        {
          "html": "If the user agent does not support crossfading then run the following steps:",
          "rationale": "remove",
          "steps": [
            {
              "html": "Remove <var>overlapped frame</var> from <var>track buffer</var>."
            },
            {
              "html": "Add a silence frame to <var>track buffer</var> with the following properties:\n                  <ul>\n                    <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-28\">presentation timestamp</a> set to the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-29\">presentation timestamp</a>.\n                    </li>\n                    <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-decode-timestamp-4\">decode timestamp</a> set to the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-decode-timestamp-5\">decode timestamp</a>.\n                    </li>\n                    <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-8\">coded frame duration</a> set to difference between <var>presentation\n                    timestamp</var> and the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-30\">presentation timestamp</a>.\n                    </li>\n                  </ul>"
            },
            {
              "html": "Return to caller without providing a splice frame."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"double\">frame end timestamp</var> equal the sum of <var data-type=\"double\">presentation timestamp</var> and\n            <var data-type=\"double\">frame duration</var>."
        },
        {
          "html": "Let <var data-type=\"double\">splice end timestamp</var> equal the sum of <var data-type=\"double\">presentation timestamp</var> and the\n            splice duration of 5 milliseconds."
        },
        {
          "html": "Let <var>fade out coded frames</var> equal <var>overlapped frame</var> as well as any additional\n            frames in <var>track buffer</var> that have a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-31\">presentation timestamp</a> greater than\n            <var data-type=\"double\">presentation timestamp</var> and less than <var data-type=\"double\">splice end timestamp</var>."
        },
        {
          "html": "Remove all the frames included in <var>fade out coded frames</var> from <var>track buffer</var>."
        },
        {
          "html": "Return a splice frame with the following properties:\n              <ul>\n                <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-32\">presentation timestamp</a> set to the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-33\">presentation timestamp</a>.\n                </li>\n                <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-decode-timestamp-6\">decode timestamp</a> set to the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-decode-timestamp\" class=\"internalDFN\" id=\"ref-for-dfn-decode-timestamp-7\">decode timestamp</a>.\n                </li>\n                <li>The <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-9\">coded frame duration</a> set to difference between <var data-type=\"double\">frame end timestamp</var>\n                and the <var>overlapped frame</var> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-34\">presentation timestamp</a>.\n                </li>\n                <li>The fade out coded frames equals <var>fade out coded frames</var>.\n                </li>\n                <li>The fade in coded frame equals <var>new coded frame</var>.\n                  \n                </li>\n                <li>The splice timestamp equals <var data-type=\"double\">presentation timestamp</var>.\n                </li>\n              </ul>"
        }
      ]
    },
    {
      "html": "The following steps are run when a spliced frame, generated by the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-audio-splice-frame\" class=\"internalDFN\" id=\"ref-for-dfn-audio-splice-frame-2\">audio splice frame</a> algorithm, needs to be rendered by the media element:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var>fade out coded frames</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-56\">coded frames</a> that are faded out during the\n            splice."
        },
        {
          "html": "Let <var>fade in coded frames</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-57\">coded frames</a> that are faded in during the\n            splice."
        },
        {
          "html": "Let <var data-type=\"double\">presentation timestamp</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-35\">presentation timestamp</a> of the first\n            coded frame in <var>fade out coded frames</var>."
        },
        {
          "html": "Let <var data-type=\"double\">end timestamp</var> be the sum of the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-36\">presentation timestamp</a> and the\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-10\">coded frame duration</a> of the last frame in <var>fade in coded frames</var>."
        },
        {
          "html": "Let <var data-type=\"double\">splice timestamp</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-37\">presentation timestamp</a> where the splice\n            starts. This corresponds with the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-38\">presentation timestamp</a> of the first frame in\n            <var>fade in coded frames</var>."
        },
        {
          "html": "Let <var data-type=\"double\">splice end timestamp</var> equal <var data-type=\"double\">splice timestamp</var> plus five milliseconds."
        },
        {
          "html": "Let <var>fade out samples</var> be the samples generated by decoding <var>fade out coded\n            frames</var>."
        },
        {
          "html": "Trim <var>fade out samples</var> so that it only contains samples between <var>presentation\n            timestamp</var> and <var data-type=\"double\">splice end timestamp</var>."
        },
        {
          "html": "Let <var>fade in samples</var> be the samples generated by decoding <var>fade in coded frames</var>."
        },
        {
          "html": "If <var>fade out samples</var> and <var>fade in samples</var> do not have a common sample rate and\n            channel layout, then convert <var>fade out samples</var> and <var>fade in samples</var> to a common\n            sample rate and channel layout."
        },
        {
          "html": "Let <var>output samples</var> be a buffer to hold the output samples."
        },
        {
          "html": "Apply a linear gain fade out with a starting gain of 1 and an ending gain of 0 to\n            the samples between <var data-type=\"double\">splice timestamp</var> and <var data-type=\"double\">splice end timestamp</var> in <var>fade out\n            samples</var>."
        },
        {
          "html": "Apply a linear gain fade in with a starting gain of 0 and an ending gain of 1 to\n            the samples between <var data-type=\"double\">splice timestamp</var> and <var data-type=\"double\">splice end timestamp</var> in <var>fade in samples</var>."
        },
        {
          "html": "Copy samples between <var data-type=\"double\">presentation timestamp</var> to <var data-type=\"double\">splice timestamp</var> from <var>fade out\n            samples</var> into <var>output samples</var>."
        },
        {
          "html": "For each sample between <var data-type=\"double\">splice timestamp</var> and <var data-type=\"double\">splice end timestamp</var>, compute the\n            sum of a sample from <var>fade out samples</var> and the corresponding sample in <var>fade in\n            samples</var> and store the result in <var>output samples</var>."
        },
        {
          "html": "Copy samples between <var data-type=\"double\">splice end timestamp</var> to <var data-type=\"double\">end timestamp</var> from <var>fade in\n            samples</var> into <var>output samples</var>."
        },
        {
          "html": "Render <var>output samples</var>."
        }
      ]
    },
    {
      "html": "Follow these steps when the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-processing\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-processing-12\">coded frame processing</a> algorithm needs to generate a\n            splice frame for two overlapping timed text <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-58\">coded frames</a>:",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var>track buffer</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#track-buffer\" class=\"internalDFN\" id=\"ref-for-track-buffer-43\">track buffer</a> that will contain the splice."
        },
        {
          "html": "Let <var>new coded frame</var> be the new <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-59\">coded frame</a>, that is being added to <var>track\n            buffer</var>, which triggered the need for a splice."
        },
        {
          "html": "Let <var data-type=\"double\">presentation timestamp</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-39\">presentation timestamp</a> for <var>new\n            coded frame</var>"
        },
        {
          "html": "Let <var data-type=\"double\">decode timestamp</var> be the decode timestamp for <var>new coded frame</var>."
        },
        {
          "html": "Let <var data-type=\"double\">frame duration</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-11\">coded frame duration</a> of <var>new coded frame</var>."
        },
        {
          "html": "Let <var data-type=\"double\">frame end timestamp</var> equal the sum of <var data-type=\"double\">presentation timestamp</var> and\n            <var data-type=\"double\">frame duration</var>."
        },
        {
          "html": "Let <var>first overlapped frame</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-60\">coded frame</a> in <var>track buffer</var> with a\n            <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-interval\" class=\"internalDFN\" id=\"ref-for-presentation-interval-3\">presentation interval</a> that contains <var data-type=\"double\">presentation timestamp</var>."
        },
        {
          "html": "Let <var data-type=\"double\">overlapped presentation timestamp</var> be the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-40\">presentation timestamp</a> of\n            the <var>first overlapped frame</var>."
        },
        {
          "html": "Let <var>overlapped frames</var> equal <var>first overlapped frame</var> as well as any additional\n            frames in <var>track buffer</var> that have a <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#presentation-timestamp\" class=\"internalDFN\" id=\"ref-for-presentation-timestamp-41\">presentation timestamp</a> greater than\n            <var data-type=\"double\">presentation timestamp</var> and less than <var data-type=\"double\">frame end timestamp</var>."
        },
        {
          "html": "Remove all the frames included in <var>overlapped frames</var> from <var>track buffer</var>."
        },
        {
          "html": "Update the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-duration\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-duration-12\">coded frame duration</a> of the <var>first overlapped frame</var> to\n            <var data-type=\"double\">presentation timestamp</var> minus <var data-type=\"double\">overlapped presentation timestamp</var>."
        },
        {
          "html": "Add <var>first overlapped frame</var> to the <var>track buffer</var>."
        },
        {
          "html": "Return to caller without providing a splice frame."
        }
      ]
    },
    {
      "name": "sourcebufferlist-getter",
      "href": "https://w3c.github.io/media-source/#dfn-sourcebufferlist-getter",
      "html": "When this method is invoked, the user agent must run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var data-type=\"unsigned long\">index</var> is greater than or equal to the\n              <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebufferlist-length\" class=\"internalDFN\" id=\"ref-for-dom-sourcebufferlist-length-2\"><code>length</code></a> attribute then return undefined and abort these steps."
        },
        {
          "html": "Return the <var data-type=\"unsigned long\">index</var>'th <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-110\"><code>SourceBuffer</code></a> object in the list."
        }
      ]
    },
    {
      "name": "ManagedMediaSource/streaming",
      "href": "https://w3c.github.io/media-source/#dom-managedmediasource-streaming",
      "html": "On getting:",
      "rationale": "return",
      "steps": [
        {
          "html": "Return the current value of the attribute."
        }
      ]
    },
    {
      "name": "able to retrieve and buffer data in an efficient way",
      "href": "https://w3c.github.io/media-source/#dfn-able-to-retrieve-and-buffer-data-in-an-efficient-way",
      "html": "Being <dfn id=\"dfn-able-to-retrieve-and-buffer-data-in-an-efficient-way\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">able to retrieve and buffer data in an efficient way</dfn> is an implementation\n        defined condition where the user agent determines that it can fetch new data in an energy\n        efficient manner while able to achieve the desired memory usage.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Run the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-102\"><code>MediaSource</code></a> <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-sourcebuffer-monitoring\" class=\"internalDFN\" id=\"ref-for-dfn-sourcebuffer-monitoring-2\">SourceBuffer Monitoring</a> algorithm."
        },
        {
          "html": "Let <var>can play uninterrupted and efficiently</var> be a flag that is true if the\n        <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> attribute contains a <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> that includes the current\n        playback position and <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-enough-managed-data-to-ensure-uninterrupted-playback\" class=\"internalDFN\" id=\"ref-for-dfn-enough-managed-data-to-ensure-uninterrupted-playback-1\">enough managed data to ensure uninterrupted playback</a> and is\n        <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-able-to-retrieve-and-buffer-data-in-an-efficient-way\" class=\"internalDFN\" id=\"ref-for-dfn-able-to-retrieve-and-buffer-data-in-an-efficient-way-1\">able to retrieve and buffer data in an efficient way</a>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If can play uninterrupted and efficiently is not equal to streaming, queue an element task on the media element that runs the following steps:",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource-streaming\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-streaming-7\"><code>streaming</code></a> attribute to <var>can play\n                uninterrupted and efficiently</var>."
                    },
                    {
                      "html": "If <var>can play uninterrupted and efficiently</var> is false <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> called\n                <a data-link-type=\"idl\" data-lt=\"startstreaming\" href=\"https://w3c.github.io/media-source/#dfn-startstreaming\" class=\"internalDFN\" id=\"ref-for-dfn-startstreaming-1\"><code>startstreaming</code></a> at the <a data-link-type=\"idl\" data-lt=\"ManagedMediaSource\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-8\"><code>ManagedMediaSource</code></a>."
                    },
                    {
                      "html": "Otherwise, <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> called <a data-link-type=\"idl\" data-lt=\"endstreaming\" href=\"https://w3c.github.io/media-source/#dfn-endstreaming\" class=\"internalDFN\" id=\"ref-for-dfn-endstreaming-1\"><code>endstreaming</code></a> at the\n                <a data-link-type=\"idl\" data-lt=\"ManagedMediaSource\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-9\"><code>ManagedMediaSource</code></a>."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "for",
      "steps": [
        {
          "html": "<dl class=\"switch\">\n            <dt>\n              For each <var data-type=\"ManagedSourceBuffer\">buffer</var> in <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-sourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-sourcebuffers-33\"><code>sourceBuffers</code></a>:\n            </dt>\n            <dd>\n              \n            </dd>\n          </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "For each buffer in this's sourceBuffers:",
                  "html": "",
                  "rationale": "run",
                  "steps": [
                    {
                      "html": "Run the <var data-type=\"ManagedSourceBuffer\">buffer</var>'s <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-memory-cleanup-0\" class=\"internalDFN\" id=\"ref-for-dfn-memory-cleanup-0-1\">memory cleanup</a> algorithm."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "The following steps are run at the completion of all operations to the\n        <a data-link-type=\"idl\" data-lt=\"ManagedSourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-managedsourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-managedsourcebuffer-6\"><code>ManagedSourceBuffer</code></a> <var data-type=\"ManagedSourceBuffer\">buffer</var> that would cause a <var data-type=\"ManagedSourceBuffer\">buffer</var>'s\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-5\"><code>buffered</code></a> to change. That is once <a data-link-type=\"idl\" data-lt=\"appendBuffer()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-appendbuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-appendbuffer-11\"><code>appendBuffer</code></a><code>()</code>,\n        <a data-link-type=\"idl\" data-lt=\"remove()\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-remove\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-remove-6\"><code>remove</code></a><code>()</code> or <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-memory-cleanup-0\" class=\"internalDFN\" id=\"ref-for-dfn-memory-cleanup-0-4\">memory cleanup</a> algorithm have\n        completed.",
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">previous buffered ranges</var> equal the\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-6\"><code>buffered</code></a> attribute before the changes occurred."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">new buffered ranges</var> equal the new <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-7\"><code>buffered</code></a>\n        <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a>."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">added</var> equal the <var data-type=\"normalized\n        TimeRanges\">previous buffered ranges</var> subtracted from <var data-type=\"normalized TimeRanges\">new buffered ranges</var>."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">removed</var> equal the <var data-type=\"normalized\n        TimeRanges\">new buffered ranges</var> subtracted from <var data-type=\"normalized TimeRanges\">previous buffered ranges</var>."
        },
        {
          "html": "Let <var>eventInitDict</var> be a new <a data-link-type=\"idl\" data-lt=\"BufferedChangeEventInit\" href=\"https://w3c.github.io/media-source/#dom-bufferedchangeeventinit\" class=\"internalDFN\" id=\"ref-for-dom-bufferedchangeeventinit-2\"><code>BufferedChangeEventInit</code></a> dictionary initialized with\n        <var data-type=\"normalized TimeRanges\">added</var> as its <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-bufferedchangeeventinit-addedranges\" class=\"internalDFN\" id=\"ref-for-dom-bufferedchangeeventinit-addedranges-1\"><code>addedRanges</code></a> and <var data-type=\"normalized TimeRanges\">removed</var> as its\n        <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-bufferedchangeeventinit-removedranges\" class=\"internalDFN\" id=\"ref-for-dom-bufferedchangeeventinit-removedranges-1\"><code>removedRanges</code></a>"
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> to <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> named <a data-link-type=\"idl\" data-lt=\"bufferedchange\" href=\"https://w3c.github.io/media-source/#dfn-bufferedchange\" class=\"internalDFN\" id=\"ref-for-dfn-bufferedchange-3\"><code>bufferedchange</code></a> at <var data-type=\"ManagedSourceBuffer\">buffer</var> using the\n        <a data-link-type=\"idl\" data-lt=\"BufferedChangeEvent\" href=\"https://w3c.github.io/media-source/#dom-bufferedchangeevent\" class=\"internalDFN\" id=\"ref-for-dom-bufferedchangeevent-4\"><code>BufferedChangeEvent</code></a> interface, initialized with <var>eventInitDict</var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "<dl class=\"switch\">\n            <dt>\n              If <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a> is not in <a data-link-type=\"dfn|abstract-op\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this</a>'s <a data-link-type=\"idl\" data-lt=\"ManagedMediaSource\" href=\"https://w3c.github.io/media-source/#dom-managedmediasource\" class=\"internalDFN\" id=\"ref-for-dom-managedmediasource-10\"><code>ManagedMediaSource</code></a> parent\n              <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-31\"><code>activeSourceBuffers</code></a>:\n            </dt>\n            <dd>\n              \n            </dd>\n          </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If this is not in this's ManagedMediaSource parent activeSourceBuffers:",
                  "html": "",
                  "rationale": "run",
                  "steps": [
                    {
                      "html": "Run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-removal\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-removal-6\">coded frame removal</a> algorithm with start set to 0, end set to\n                positive infinity, and abort these steps."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">removal ranges</var> equal a list of presentation time ranges\n        that can be evicted from the presentation to ensure uninterrupted playback from\n        <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-currenttime\"><code>currentTime</code></a> until such presentation could be retrieved again."
        },
        {
          "html": "For each range in <var data-type=\"normalized TimeRanges\">removal ranges</var>, run the <a data-link-type=\"dfn|abstract-op\" href=\"https://w3c.github.io/media-source/#dfn-coded-frame-removal\" class=\"internalDFN\" id=\"ref-for-dfn-coded-frame-removal-7\">coded frame removal</a> algorithm with\n        <var data-type=\"double\">start</var> and <var data-type=\"unrestricted double\">end</var> equal to the removal range start and end\n        timestamp respectively."
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-seekable\"><code>seekable</code></a> attribute returns a new static\n          <a href=\"https://html.spec.whatwg.org/multipage/media.html#normalised-timeranges-object\">normalized TimeRanges object</a> created based on the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-104\"><code>MediaSource</code></a> was constructed in a <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> that is\n          terminated or is closing then return an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object and abort these\n          steps."
        },
        {
          "html": "Let <var data-type=\"unrestricted double\">recent duration</var> and <var data-type=\"normalized\n          TimeRanges\">recent live seekable range</var> respectively be the recent values of <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-12\"><code>duration</code></a> and\n          <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-6\"><code>[[live seekable range]]</code></a>, determined as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the MediaSource was constructed in a Window",
                  "html": "Set <var data-type=\"unrestricted double\">recent duration</var> to be <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-13\"><code>duration</code></a> and set <var>recent live seekable\n                range</var> to be <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-7\"><code>[[live seekable range]]</code></a>."
                },
                {
                  "case": "Otherwise:",
                  "html": "Set <var data-type=\"unrestricted double\">recent duration</var> and <var data-type=\"normalized\n          TimeRanges\">recent live seekable range</var> respectively to be what the\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-14\"><code>duration</code></a> and <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-8\"><code>[[live seekable range]]</code></a> were recently,\n                updated by handling implicit messages posted by the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-106\"><code>MediaSource</code></a> to its\n                <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-10\"><code>[[port to main]]</code></a> on every change to <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-duration\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-duration-15\"><code>duration</code></a> or\n                <a data-link-type=\"attribute\" data-lt=\"[[live seekable range]]\" href=\"https://w3c.github.io/media-source/#dfn-live-seekable-range\" class=\"internalDFN\" id=\"ref-for-dfn-live-seekable-range-9\"><code>[[live seekable range]]</code></a>."
                }
              ]
            }
          ]
        },
        {
          "html": "<dl class=\"switch\">\n              <dt>\n                If <var data-type=\"unrestricted double\">recent duration</var> equals NaN:\n              </dt>\n              <dd>\n                Return an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object.\n              </dd>\n              <dt>\n                If <var data-type=\"unrestricted double\">recent duration</var> equals positive Infinity:\n              </dt>\n              <dd>\n                \n              </dd>\n              <dt>\n                Otherwise:\n              </dt>\n              <dd>\n                Return a single range with a start time of 0 and an end time equal to <var>recent\n                duration</var>.\n              </dd>\n            </dl>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If recent duration equals NaN:",
                  "html": "Return an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object."
                },
                {
                  "case": "If recent duration equals positive Infinity:",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var data-type=\"normalized\n          TimeRanges\">recent live seekable range</var> is not empty:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var data-type=\"normalized TimeRanges\">union ranges</var> be the union of <var>recent live\n                      seekable range</var> and the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a>\n                      attribute."
                        },
                        {
                          "html": "Return a single range with a start time equal to the earliest start time\n                      in <var data-type=\"normalized TimeRanges\">union ranges</var> and an end time equal to the highest end time in <var>union\n                      ranges</var> and abort these steps."
                        }
                      ]
                    },
                    {
                      "html": "If the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> attribute returns\n                  an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object, then return an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object and\n                  abort these steps."
                    },
                    {
                      "html": "Return a single range with a start time of 0 and an end time equal to the\n                  highest end time reported by the <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s\n                  <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> attribute."
                    }
                  ]
                },
                {
                  "case": "Otherwise:",
                  "html": "Return a single range with a start time of 0 and an end time equal to <var>recent\n                duration</var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"idl\" data-lt=\"HTMLMediaElement\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#htmlmediaelement\"><code>HTMLMediaElement</code></a>'s <a data-link-type=\"idl\" data-type=\"attribute\" href=\"https://html.spec.whatwg.org/multipage/media.html#dom-media-buffered\"><code>buffered</code></a> attribute returns a static\n          <a href=\"https://html.spec.whatwg.org/multipage/media.html#normalised-timeranges-object\">normalized TimeRanges object</a> based on the following steps.",
      "rationale": "if",
      "steps": [
        {
          "html": "If the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-107\"><code>MediaSource</code></a> was constructed in a <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> that is\n          terminated or is closing then return an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object and abort these\n          steps."
        },
        {
          "html": "Let <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> be determined as follows:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the MediaSource was constructed in a Window",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> equal an empty <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object."
                    },
                    {
                      "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-32\"><code>activeSourceBuffers</code></a>.length does not equal 0 then run the\n                  following steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var data-type=\"sequence of normalized TimeRanges\">active ranges</var> be the ranges\n                      returned by <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-8\"><code>buffered</code></a> for each <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-114\"><code>SourceBuffer</code></a> object in\n                      <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-33\"><code>activeSourceBuffers</code></a>."
                        },
                        {
                          "html": "Let <var data-type=\"unrestricted double\">highest end time</var> be the largest range end time\n                      in the <var data-type=\"sequence of normalized TimeRanges\">active ranges</var>."
                        },
                        {
                          "html": "Let <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> equal a\n                      <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> object containing a single range from 0 to <var data-type=\"unrestricted double\">highest end time</var>."
                        },
                        {
                          "html": "For each <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-115\"><code>SourceBuffer</code></a> object in <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-34\"><code>activeSourceBuffers</code></a>\n                      run the following steps:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "Let <var data-type=\"normalized TimeRanges\">source ranges</var> equal the ranges returned\n                          by the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-9\"><code>buffered</code></a> attribute on the current\n                          <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-116\"><code>SourceBuffer</code></a>."
                            },
                            {
                              "html": "If <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-35\"><code>readyState</code></a> is \"<a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-readystate-ended\" class=\"internalDFN\" id=\"ref-for-dom-readystate-ended-14\"><code>ended</code></a>\", then set\n                          the end time on the last range in <var data-type=\"normalized TimeRanges\">source ranges</var> to <var data-type=\"unrestricted double\">highest end time</var>."
                            },
                            {
                              "html": "Let <var data-type=\"normalized TimeRanges\">new intersection ranges</var> equal the\n                          intersection between the <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> and the <var>source\n                          ranges</var>."
                            },
                            {
                              "html": "Replace the ranges in <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> with the <var>new\n                          intersection ranges</var>."
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "Otherwise:",
                  "html": "Let <var data-type=\"normalized TimeRanges\">recent intersection ranges</var> be the <a data-link-type=\"idl\" data-lt=\"TimeRanges\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/media.html#timeranges\"><code>TimeRanges</code></a> resulting from the steps for\n                the <a data-link-type=\"idl\" data-lt=\"Window\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\"><code>Window</code></a> case, but run with the <a data-link-type=\"idl\" data-lt=\"MediaSource\" href=\"https://w3c.github.io/media-source/#dom-mediasource\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-109\"><code>MediaSource</code></a> and its <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-117\"><code>SourceBuffer</code></a>\n                objects in their <a data-link-type=\"idl\" data-lt=\"DedicatedWorkerGlobalScope\" data-type=\"interface\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\"><code>DedicatedWorkerGlobalScope</code></a> and communicated by using\n                <a data-link-type=\"attribute\" data-lt=\"[[port to main]]\" href=\"https://w3c.github.io/media-source/#dfn-port-to-main\" class=\"internalDFN\" id=\"ref-for-dfn-port-to-main-11\"><code>[[port to main]]</code></a> implicit messages on every update to the\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-35\"><code>activeSourceBuffers</code></a>, <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-readystate\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-readystate-36\"><code>readyState</code></a>, or any of the\n                buffering state that would change any of the values of each of those\n                <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer-buffered\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-buffered-10\"><code>buffered</code></a> attributes of the <a data-link-type=\"idl\" href=\"https://w3c.github.io/media-source/#dom-mediasource-activesourcebuffers\" class=\"internalDFN\" id=\"ref-for-dom-mediasource-activesourcebuffers-36\"><code>activeSourceBuffers</code></a>."
                }
              ]
            }
          ]
        },
        {
          "html": "If the current value of this attribute has not been set by this algorithm or <var>recent\n          intersection ranges</var> does not contain the exact same range information as the current\n          value of this attribute, then update the current value of this attribute to <var>recent\n          intersection ranges</var>."
        },
        {
          "html": "Return the current value of this attribute."
        }
      ]
    },
    {
      "name": "AudioTrack/sourceBuffer",
      "href": "https://w3c.github.io/media-source/#dom-audiotrack-sourcebuffer",
      "html": "On getting, run the following step:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If this track was created by a SourceBuffer that was created on the same realm as this track, and if that SourceBuffer has not been removed from the sourceBuffers attribute of its parent media source:",
              "html": "Return the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-122\"><code>SourceBuffer</code></a> that created this track."
            },
            {
              "case": "Otherwise:",
              "html": "Return null."
            }
          ]
        }
      ]
    },
    {
      "name": "VideoTrack/sourceBuffer",
      "href": "https://w3c.github.io/media-source/#dom-videotrack-sourcebuffer",
      "html": "On getting, run the following step:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If this track was created by a SourceBuffer that was created on the same realm as this track, and if that SourceBuffer has not been removed from the sourceBuffers attribute of its parent media source:",
              "html": "Return the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-128\"><code>SourceBuffer</code></a> that created this track."
            },
            {
              "case": "Otherwise:",
              "html": "Return null."
            }
          ]
        }
      ]
    },
    {
      "name": "TextTrack/sourceBuffer",
      "href": "https://w3c.github.io/media-source/#dom-texttrack-sourcebuffer",
      "html": "On getting, run the following step:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "If this track was created by a SourceBuffer that was created on the same realm as this track, and if that SourceBuffer has not been removed from the sourceBuffers attribute of its parent media source:",
              "html": "Return the <a data-link-type=\"idl\" data-lt=\"SourceBuffer\" href=\"https://w3c.github.io/media-source/#dom-sourcebuffer\" class=\"internalDFN\" id=\"ref-for-dom-sourcebuffer-134\"><code>SourceBuffer</code></a> that created this track."
            },
            {
              "case": "Otherwise:",
              "html": "Return null."
            }
          ]
        }
      ]
    }
  ]
}