{
  "spec": {
    "title": "Network Error Logging",
    "url": "https://w3c.github.io/network-error-logging/"
  },
  "algorithms": [
    {
      "name": "phase",
      "href": "https://w3c.github.io/network-error-logging/#phase",
      "html": "Regardless of which fetch algorithm and which underlying application and transport protocols are used, servicing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request④\">network request</a> consists of the following <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"phase\" data-noexport=\"\" id=\"phase\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">phases</dfn>:",
      "rationale": "resolve",
      "steps": [
        {
          "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"dns-resolution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DNS resolution</dfn>: The user agent uses the Domain Name System <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc1034\" title=\"Domain names - concepts and facilities\">[RFC1034]</a> to resolve a domain name into an <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-ip-address\" id=\"ref-for-concept-host-ip-address\">IP address</a> of a <dfn class=\"dfn-paneled has-dfn-panel\" data-cite=\"RFC9110#core.semantics\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"server\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">server</dfn> that can service HTTP <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">requests</a> to that domain.</p>"
        },
        {
          "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"secure-connection-establishment\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Secure connection establishment</dfn>: The user agent opens a connection to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server\">server</a>, and establishes a secure channel over this connection.</p>"
        },
        {
          "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"transmission-of-request-and-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Transmission of request and response</dfn>: Once the secure channel is established, the user agent can transmit the HTTP <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑤\">request</a>, and receive the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server①\">server</a>.</p>"
        }
      ]
    },
    {
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request①⑤\">network request</a> (<var>request</var>) and its corresponding <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> (<var>response</var>), this algorithm extracts a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies②⑦\">NEL policy</a> for <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑥\">origin</a>, and updates the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache①\">policy cache</a> accordingly.",
      "rationale": "abort",
      "steps": [
        {
          "html": "<p>Abort these steps if any of the following conditions are true:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>The result of executing the \"<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/secure-contexts/#is-origin-trustworthy\" id=\"ref-for-is-origin-trustworthy\">Is origin potentially trustworthy?</a>\" algorithm on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑦\">origin</a> is <strong>not</strong> <code>Potentially Trustworthy</code>.</p>\n      </li><li data-md=\"\">\n       <p><var>response</var> does not contain a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#response-headers\" id=\"ref-for-response-headers③\">response header</a> whose name is <code>NEL</code>.</p>\n     </li></ul>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑧\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>key</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#determine-the-network-partition-key\" id=\"ref-for-determine-the-network-partition-key\">determine the network partition key</a>, given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client\">reserved client</a>.</p>"
        },
        {
          "html": "<p>Let <var>header</var> be the value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#response-headers\" id=\"ref-for-response-headers④\">response header</a> whose name is <code>NEL</code>.</p>"
        },
        {
          "html": "<p>Let <var>list</var> be the result of executing the algorithm defined in Section 4 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-http-jfv\" title=\"A JSON Encoding for HTTP Header Field Values\">[HTTP-JFV]</a> on <var>header</var>. If that algorithm results in an error, or if <var>list</var> is empty, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>item</var> be the first element of <var>list</var>.</p>"
        },
        {
          "html": "<p>If <var>item</var> has no member named <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#max_age\" id=\"ref-for-max_age①\">max_age</a>, or that member’s value is not a number, abort these steps.</p>"
        },
        {
          "html": "<p>If the value of <var>item</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#max_age\" id=\"ref-for-max_age②\">max_age</a> member is <code>0</code>, then remove any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies②⑧\">NEL policy</a> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache②\">policy cache</a> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-origin\" id=\"ref-for-policy-origin\">policy origin</a> is <var>origin</var>, and skip the remaining steps.</p>"
        },
        {
          "html": "<p>If <var>item</var> has no member named <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#report_to\" id=\"ref-for-report_to②\">report_to</a>, or that member’s value is not a string, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>item</var> has a member named <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#success_fraction\" id=\"ref-for-success_fraction\">success_fraction</a>, whose value is not a number in the range 0.0 to 1.0, inclusive, abort these steps.</p>"
        },
        {
          "html": "<p>If <var>item</var> has a member named <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#failure_fraction\" id=\"ref-for-failure_fraction\">failure_fraction</a>, whose value is not a number in the range 0.0 to 1.0, inclusive, abort these steps.</p>"
        },
        {
          "html": "<p>Let <var>policy</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies②⑨\">NEL policy</a> whose properties are set as follows:</p>\n     <dl>\n      <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#received-ip-address\" id=\"ref-for-received-ip-address\">received IP address</a>\n      </dt><dd data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-ip-address\" id=\"ref-for-concept-host-ip-address②\">IP address</a> of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server⑥\">server</a> that the user agent received <var>response</var> from</p>\n       \n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑨\">origin</a>\n      </dt><dd data-md=\"\">\n       <p><var>origin</var></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#subdomains\" id=\"ref-for-subdomains\">subdomains</a> flag\n      </dt><dd data-md=\"\">\n       <p><code>include</code> if <var>item</var> has a member named <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#include_subdomains\" id=\"ref-for-include_subdomains\">include_subdomains</a> whose value is <code>true</code>, <code>exclude</code> otherwise</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#reporting-group\" id=\"ref-for-reporting-group\">reporting group</a>\n      </dt><dd data-md=\"\">\n       <p>the value of <var>item</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#report_to\" id=\"ref-for-report_to③\">report_to</a> member</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#ttl\" id=\"ref-for-ttl①\">ttl</a>\n      </dt><dd data-md=\"\">\n       <p>the value of <var>item</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#max_age\" id=\"ref-for-max_age③\">max_age</a> member</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#creation\" id=\"ref-for-creation②\">creation</a>\n      </dt><dd data-md=\"\">\n       <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-wall-clock\" id=\"ref-for-dfn-wall-clock②\">wall clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-unsafe-current-time\" id=\"ref-for-dfn-unsafe-current-time②\">unsafe current time</a></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#successful-sampling-rate\" id=\"ref-for-successful-sampling-rate①\">successful sampling rate</a>\n      </dt><dd data-md=\"\">\n       <p>the value of <var>item</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#success_fraction\" id=\"ref-for-success_fraction①\">success_fraction</a> member, if present; <code>0.0</code> otherwise</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#failure-sampling-rate\" id=\"ref-for-failure-sampling-rate①\">failure sampling rate</a>\n      </dt><dd data-md=\"\">\n       <p>the value of <var>item</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#failure_fraction\" id=\"ref-for-failure_fraction①\">failure_fraction</a> member, if present; <code>1.0</code> otherwise</p>\n     </dd></dl>"
        },
        {
          "html": "<p>If there is already an entry in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache③\">policy cache</a> for (<var>key</var>, <var>origin</var>), replace it with <var>policy</var>; otherwise, insert <var>policy</var> into the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache④\">policy cache</a> for (<var>key</var>, <var>origin</var>).</p>"
        }
      ]
    },
    {
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request①⑥\">network request</a> (<var>request</var>), this algorithm determines which <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies③⓪\">NEL policy</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache⑤\">policy cache</a> should be used to generate reports for that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request①⑦\">network request</a>.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>origin</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⓪\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>key</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#determine-the-network-partition-key\" id=\"ref-for-determine-the-network-partition-key①\">determine the network partition key</a>, given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client①\">reserved client</a>.</p>"
        },
        {
          "html": "If there is an entry in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache⑥\">policy cache</a> for (<var>key</var>, <var>origin</var>):",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>policy</var> be that entry.</p>"
            },
            {
              "html": "<p>If <var>policy</var> is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#expired\" id=\"ref-for-expired\">expired</a>, return it.</p>"
            }
          ]
        },
        {
          "html": "For each <var>parent origin</var> that is a superdomain match <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc6797\" title=\"HTTP Strict Transport Security (HSTS)\">[RFC6797]</a> of <var>origin</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If there is an entry in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache⑦\">policy cache</a> for (<var>key</var>, <var>parent origin</var>):",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>policy</var> be that entry.</p>"
                },
                {
                  "html": "<p>If <var>policy</var> is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#expired\" id=\"ref-for-expired①\">expired</a>, and its <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#subdomains\" id=\"ref-for-subdomains①\">subdomains</a> flag is <code>include</code>, return it.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <code>no policy</code>.</p>"
        }
      ]
    },
    {
      "html": "Given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request①⑧\">network request</a> (<var>request</var>) and its corresponding <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> (<var>response</var>), this algorithm generates a report about <var>request</var> if instructed to by any matching <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies③①\">NEL policy</a>, and returns the report and the NEL policy. Otherwise this algorithm returns null.",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the result of executing the \"<a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/secure-contexts/#is-origin-trustworthy\" id=\"ref-for-is-origin-trustworthy①\">Is origin potentially trustworthy?</a>\" algorithm on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①①\">origin</a> is <strong>not</strong> <code>Potentially Trustworthy</code>, return null.</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①②\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>policy</var> be the result of executing <a href=\"https://w3c.github.io/network-error-logging/#choose-a-policy-for-a-request\">§ 5.1 Choose a policy for a request</a> on <var>request</var>. If <var>policy</var> is <code>no policy</code>, return null.</p>"
        },
        {
          "html": "<p>Determine the active sampling rate for this request:</p>\n     <ul>\n      <li data-md=\"\">\n       <p>If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#succeed\" id=\"ref-for-succeed④\">succeeded</a>, let <var>sampling rate</var> be <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#successful-sampling-rate\" id=\"ref-for-successful-sampling-rate②\">successful sampling rate</a>.</p>\n      </li><li data-md=\"\">\n       <p>If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#fail\" id=\"ref-for-fail⑤\">failed</a>, let <var>sampling rate</var> be <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#failure-sampling-rate\" id=\"ref-for-failure-sampling-rate②\">failure sampling rate</a>.</p>\n     </li></ul>"
        },
        {
          "html": "<p>Decide whether or not to report on this request. Let <var>roll</var> be a random number between 0.0 and 1.0, inclusive. If <var>roll</var> &gt; <var>sampling rate</var>, return null.</p>"
        },
        {
          "html": "<p>Let <var>report body</var> be a new ECMAScript object with the following properties: <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-ecma-262\" title=\"ECMAScript Language Specification\">[ECMA-262]</a></p>\n     <dl>\n      <dt data-md=\"\"><code>sampling_fraction</code>\n      </dt><dd data-md=\"\">\n       <p><var>sampling rate</var></p>\n      </dd><dt data-md=\"\"><code>elapsed_time</code>\n      </dt><dd data-md=\"\">\n       <p>The elapsed number of milliseconds between the start of the resource fetch and when it was completed or aborted by the user agent.</p>\n      </dd><dt data-md=\"\"><code>phase</code>\n      </dt><dd data-md=\"\">\n       <p>If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#fail\" id=\"ref-for-fail⑥\">failed</a>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#type-phase\" id=\"ref-for-type-phase\">phase</a> of its <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-errors\" id=\"ref-for-network-errors④\">network error</a>. If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#succeed\" id=\"ref-for-succeed⑤\">succeeded</a>, <code>\"application\"</code>.</p>\n      </dd><dt data-md=\"\"><code>type</code>\n      </dt><dd data-md=\"\">\n       <p>If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#fail\" id=\"ref-for-fail⑦\">failed</a>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#types\" id=\"ref-for-types①\">type</a> of its <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-errors\" id=\"ref-for-network-errors⑤\">network error</a>. If <var>request</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#succeed\" id=\"ref-for-succeed⑥\">succeeded</a>, <code>\"ok\"</code>.</p>\n     </dd></dl>"
        },
        {
          "html": "<p>If <var>report body</var>’s <code>phase</code> property is not <code>dns</code>, append the following properties to <var>report body</var>:</p>\n     <dl>\n      <dt data-md=\"\"><code>server_ip</code>\n      </dt><dd data-md=\"\">\n       <p>The IP address of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server⑦\">server</a> to which the user agent sent the request, if available. Otherwise, an empty string.</p>\n       <ul>\n        <li data-md=\"\">\n         <p>A host identified by an IPv4 address is represented in dotted-decimal notation (a sequence of four decimal numbers in the range 0 to 255, separated by \".\"). <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc1123\" title=\"Requirements for Internet Hosts - Application and Support\">[RFC1123]</a></p>\n        </li><li data-md=\"\">\n         <p>A host identified by an IPv6 address is represented as an ordered list of eight 16-bit pieces (a sequence of <code>x:x:x:x:x:x:x:x</code>, where the <a class=\"css property\" data-link-type=\"property\" href=\"https://www.w3.org/TR/SVG2/geometry.html#XProperty\" id=\"ref-for-XProperty\">x</a>s are one to four hexadecimal digits of the eight 16-bit pieces of the address). <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc4291\" title=\"IP Version 6 Addressing Architecture\">[RFC4291]</a></p>\n       </li></ul>\n      </dd><dt data-md=\"\"><code>protocol</code>\n      </dt><dd data-md=\"\">\n       <p>The network protocol <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-resource-timing-2\" title=\"Resource Timing\">[RESOURCE-TIMING-2]</a> used to fetch the resource as identified by the ALPN Protocol ID, if available. Otherwise, <code>\"\"</code>.</p>\n     </dd></dl>"
        },
        {
          "html": "<p>If <var>report body</var>’s <code>phase</code> property is not <code>dns</code> or <code>connection</code>, append the following properties to <var>report body</var>:</p>\n     <dl>\n      <dt data-md=\"\"><code>referrer</code>\n      </dt><dd data-md=\"\">\n       <p><var>request</var>’s referrer, as determined by the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy\">referrer policy</a> associated with its client.</p>\n      </dd><dt data-md=\"\"><code>method</code>\n      </dt><dd data-md=\"\">\n       <p><var>request</var>’s request method <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc9110\" title=\"HTTP Semantics\">[RFC9110]</a>.</p>\n      </dd><dt data-md=\"\"><code>status_code</code>\n      </dt><dd data-md=\"\">\n       <p>The status code <a data-link-type=\"biblio\" href=\"https://w3c.github.io/network-error-logging/#biblio-rfc9110\" title=\"HTTP Semantics\">[RFC9110]</a> of the HTTP response, if available. Otherwise, <code>0</code>.</p>\n     </dd></dl>"
        },
        {
          "html": "<p>If <var>origin</var> is not equal to <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-origin\" id=\"ref-for-policy-origin①\">policy origin</a>, <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#subdomains\" id=\"ref-for-subdomains②\">subdomains</a> flag is <code>include</code>, and <var>report body</var>’s <code>phase</code> property is not <code>dns</code>, return null.</p>"
        },
        {
          "html": "<span class=\"marker\">Note:</span> This step \"downgrades\" a NEL report if the IP addresses of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server⑧\">server</a> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies③③\">policy</a> don’t match. This is a privacy protection, ensuring that NEL reports are only sent to the owner of the service that the report describes. If the IP addresses don’t match, then the user agent can only verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies③④\">NEL policy</a> was sent by the owner of the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①③\">origin</a>’s <dfn class=\"dfn-paneled has-dfn-panel\" data-cite=\"RFC1034#section-3.1\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"domain-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">domain name</dfn>; it cannot verify that the policy was sent by the owner of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#server\" id=\"ref-for-server⑨\">server</a> this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#domain-name\" id=\"ref-for-domain-name\">domain name</a> resolves to. We therefore downgrade the report to only contain information about <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#dns-resolution\" id=\"ref-for-dns-resolution④\">DNS resolution</a>. See <a href=\"https://w3c.github.io/network-error-logging/#privacy-considerations\">§ 9 Privacy Considerations</a> and <a href=\"https://w3c.github.io/network-error-logging/#origins-with-multiple-ip-addresses\">§ 7.4 Origins with multiple IP addresses</a> for more details.",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>report body</var>’s <code>phase</code> to <code>dns</code>.</p>"
            },
            {
              "html": "<p>Set <var>report body</var>’s <code>type</code> to <code>dns.address_changed</code>.</p>"
            },
            {
              "html": "<p>Clear <var>report body</var>’s <code>status_code</code>, and <code>elapsed_time</code> properties.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: All fields in <var>report body</var> that are derived from information not available during <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#dns-resolution\" id=\"ref-for-dns-resolution③\">DNS resolution</a> have been cleared.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>policy</var> is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#stale\" id=\"ref-for-stale\">stale</a>, then delete <var>policy</var> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#policy-cache\" id=\"ref-for-policy-cache⑧\">policy cache</a>.</p>"
        },
        {
          "html": "<p>Return <var>report body</var> and <var>policy</var>.</p>"
        }
      ]
    },
    {
      "html": "Given a ECMAScript object (<var>report body</var>, usually returned from <a href=\"https://w3c.github.io/network-error-logging/#generate-a-network-error-report\">§ 5.2 Generate a network error report</a> and then augmented by the calling specification) and its matching <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#nel-policies\" id=\"ref-for-nel-policies③⑤\">NEL policy</a> (<var>policy</var>) and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#network-request\" id=\"ref-for-network-request①⑨\">network request</a> (<var>request</var>), this algorithm queues the report for delivery.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be <var>request</var>’s URL.</p>"
        },
        {
          "html": "<p>Clear <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment\">fragment</a>.</p>"
        },
        {
          "html": "If <var>report body</var>’s <code>phase</code> property is <code>dns</code> or <code>connection</code>:",
          "rationale": "clear",
          "steps": [
            {
              "html": "<p>Clear <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path\">path</a> and <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query\">query</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/reporting/#generate-a-network-report\" id=\"ref-for-generate-a-network-report\">Generate a network report</a> given these parameters:</p>\n     <dl>\n      <dt data-md=\"\">type\n      </dt><dd data-md=\"\">\n       <p><code>network-error</code></p>\n      </dd><dt data-md=\"\">data\n      </dt><dd data-md=\"\">\n       <p><var>report body</var></p>\n      </dd><dt data-md=\"\">endpoint group\n      </dt><dd data-md=\"\">\n       <p><var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/network-error-logging/#reporting-group\" id=\"ref-for-reporting-group①\">reporting group</a></p>\n      </dd><dt data-md=\"\">url\n      </dt><dd data-md=\"\">\n       <p>The result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">URL serializer</a> on <var>url</var>.</p>\n     </dd></dl>"
        }
      ]
    }
  ]
}