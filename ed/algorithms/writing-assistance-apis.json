{
  "spec": {
    "title": "Writing Assistance APIs",
    "url": "https://webmachinelearning.github.io/writing-assistance-apis/"
  },
  "algorithms": [
    {
      "name": "Summarizer/create(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizer-create",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Summarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"create(options)|create()\" id=\"dom-summarizer-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>create(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object\" id=\"ref-for-create-an-ai-model-object\">creating an AI model object</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-summarizer\" id=\"ref-for-permissiondef-summarizer\">summarizer</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options\" id=\"ref-for-validate-and-canonicalize-summarizer-options\">validate and canonicalize summarizer options</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability\">computing summarizer options availability</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#download-the-summarizer-model\" id=\"ref-for-download-the-summarizer-model\">download the summarizer model</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarizer-model\" id=\"ref-for-initialize-the-summarizer-model\">initialize the summarizer model</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-a-summarizer-object\" id=\"ref-for-create-a-summarizer-object\">create a summarizer object</a>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize summarizer options",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-canonicalize-summarizer-options\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize summarizer options</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-summarizercreatecoreoptions\" id=\"ref-for-dictdef-summarizercreatecoreoptions②\">SummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags, and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedinputlanguages\">expectedInputLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags①\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedcontextlanguages\">expectedContextLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags②\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-summarizercreatecoreoptions-outputlanguage\">outputLanguage</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "download the summarizer model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#download-the-summarizer-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"download-the-summarizer-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">download the summarizer model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-summarizercreatecoreoptions\" id=\"ref-for-dictdef-summarizercreatecoreoptions③\">SummarizerCreateCoreOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Initiate the download process for everything the user agent needs to summarize text according to <var>options</var>. This could include a base AI model, fine-tunings for specific languages or option values, or other resources.</p>"
        },
        {
          "html": "<p>If the download process cannot be started for any reason, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "initialize the summarizer model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarizer-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-summarizer-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the summarizer model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-summarizercreateoptions\" id=\"ref-for-dictdef-summarizercreateoptions①\">SummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform any necessary initialization operations for the AI model backing the user agent’s summarization capabilities.</p>\n      <p>This could include loading the model into memory, loading <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreateoptions-sharedcontext\" id=\"ref-for-dom-summarizercreateoptions-sharedcontext\">sharedContext</a></code>\"] into the model’s context window, or loading any fine-tunings necessary to support the other options expressed by <var>options</var>.</p>"
        },
        {
          "html": "If initialization failed because the process of loading <var>options</var> resulted in using up all of the model’s input quota, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requested</var> be the amount of input usage needed to encode <var>options</var>. The encoding of <var>options</var> as input is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a>.</p>"
            },
            {
              "html": "<p>Let <var>quota</var> be the maximum input quota that the user agent supports for encoding <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>requested</var> is greater than <var>quota</var>. (That is how we reached this error branch.)</p>"
            },
            {
              "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information\">quota exceeded error information</a> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested\">requested</a> is <var>requested</var> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota\">quota</a> is <var>quota</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If initialization failed for any other reason, then return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information\">DOMException error information</a> whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name\">name</a> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror\">OperationError</a></code>\" and whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details\">details</a> contain appropriate detail.</p>"
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "create a summarizer object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-a-summarizer-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-summarizer-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a summarizer object</dfn>, given a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm\">realm</a> <var>realm</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-summarizercreateoptions\" id=\"ref-for-dictdef-summarizercreateoptions②\">SummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: these steps are running on <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#surrounding-agent\" id=\"ref-for-surrounding-agent\">surrounding agent</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop\" id=\"ref-for-concept-agent-event-loop\">event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputQuota</var> be the amount of input quota that is available to the user agent for future <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize①\">summarization</a> operations. (This value is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①\">implementation-defined</a>, and may be +∞ if there are no specific limits beyond, e.g., the user’s memory, or the limits of JavaScript strings.)</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer\" id=\"ref-for-summarizer③\">Summarizer</a></code> object, created in <var>realm</var>, with</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-shared-context\" id=\"ref-for-summarizer-shared-context\">shared context</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreateoptions-sharedcontext\" id=\"ref-for-dom-summarizercreateoptions-sharedcontext①\">sharedContext</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-type\" id=\"ref-for-summarizer-summary-type\">summary type</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-type\" id=\"ref-for-dom-summarizercreatecoreoptions-type\">type</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-format\" id=\"ref-for-summarizer-summary-format\">summary format</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-format\" id=\"ref-for-dom-summarizercreatecoreoptions-format\">format</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-length\" id=\"ref-for-summarizer-summary-length\">summary length</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-length\" id=\"ref-for-dom-summarizercreatecoreoptions-length\">length</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-expected-input-languages\" id=\"ref-for-summarizer-expected-input-languages\">expected input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedinputlanguages①\">expectedInputLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-expected-context-languages\" id=\"ref-for-summarizer-expected-context-languages\">expected context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array①\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedcontextlanguages①\">expectedContextLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-output-language\" id=\"ref-for-summarizer-output-language\">output language</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-summarizercreatecoreoptions-outputlanguage①\">outputLanguage</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-input-quota\" id=\"ref-for-summarizer-input-quota\">input quota</a>\n       </dt><dd data-md=\"\">\n        <p><var>inputQuota</var></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Summarizer/availability(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizer-availability",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Summarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"availability(options)|availability()\" id=\"dom-summarizer-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>availability(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-ai-model-availability\" id=\"ref-for-compute-ai-model-availability\">computing AI model availability</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-summarizer\" id=\"ref-for-permissiondef-summarizer①\">summarizer</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options\" id=\"ref-for-validate-and-canonicalize-summarizer-options①\">validate and canonicalize summarizer options</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability①\">compute summarizer options availability</a>.</p>"
        }
      ]
    },
    {
      "name": "compute summarizer options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-summarizer-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute summarizer options availability</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-summarizercreatecoreoptions\" id=\"ref-for-dictdef-summarizercreatecoreoptions④\">SummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They return either an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability①\">Availability</a></code> value or null, and they mutate <var>options</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>availability</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability\" id=\"ref-for-summarizer-non-language-options-availability\">summarizer non-language options availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-type\" id=\"ref-for-dom-summarizercreatecoreoptions-type①\">type</a></code>\"], <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-format\" id=\"ref-for-dom-summarizercreatecoreoptions-format①\">format</a></code>\"], and <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-length\" id=\"ref-for-dom-summarizercreatecoreoptions-length①\">length</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>triple</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities-triple\" id=\"ref-for-summarizer-language-availabilities-triple\">summarizer language availabilities triple</a>.</p>"
        },
        {
          "html": "<p>If <var>triple</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Let <var>inputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedinputlanguages②\">expectedInputLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages\">input languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextLanguagesAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability①\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-summarizercreatecoreoptions-expectedcontextlanguages②\">expectedContextLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages\">context languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>outputLanguagesList</var> be « <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-summarizercreatecoreoptions-outputlanguage②\">outputLanguage</a></code>\"] ».</p>"
        },
        {
          "html": "<p>Let <var>outputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability②\">computing language availability</a> given <var>outputLanguagesList</var> and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages\">output languages</a>.</p>"
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-summarizercreatecoreoptions-outputlanguage③\">outputLanguage</a></code>\"] to <var>outputLanguagesList</var>[0].</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#availability-minimum-availability\" id=\"ref-for-availability-minimum-availability\">minimum availability</a> given « <var>availability</var>, <var>inputLanguageAvailability</var>, <var>contextLanguagesAvailability</var>, <var>outputLanguageAvailability</var> ».</p>"
        }
      ]
    },
    {
      "name": "summarizer non-language options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-non-language-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer non-language options availability</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype②\">SummarizerType</a></code> <var>type</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerformat\" id=\"ref-for-enumdef-summarizerformat②\">SummarizerFormat</a></code> <var>format</var>, and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerlength\" id=\"ref-for-enumdef-summarizerlength②\">SummarizerLength</a></code> <var>length</var>, is given by the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability②\">Availability</a></code> value or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>If the user agent supports summarizing text into the type of summary described by <var>type</var>, in the format described by <var>format</var>, and with the length guidance given by <var>length</var> without performing any downloading operations, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available\">available</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can summarize text according to <var>type</var>, <var>format</var>, and <var>length</var>, but only after finishing a download (e.g., of an AI model or fine-tuning) that is already ongoing, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can summarize text according to <var>type</var>, <var>format</var>, and <var>length</var>, but only after performing a download (e.g., of an AI model or fine-tuning), then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable\">unavailable</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "summarizer language availabilities triple",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities-triple",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-language-availabilities-triple\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer language availabilities triple</dfn> is given by the following steps. They return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple\">language availabilities triple</a> or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple①\">language availabilities triple</a> with:</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages①\">input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition\">getting the language availabilities partition</a> given the purpose of summarizing text written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages①\">context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition①\">getting the language availabilities partition</a> given the purpose of summarizing text using web-developer provided context information written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages①\">output languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition②\">getting the language availabilities partition</a> given the purpose of producing text summaries in that language</p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Summarizer/summarize(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizer-summarize",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Summarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarize(input, options)|summarize(input)\" id=\"dom-summarizer-summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarize(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizersummarizeoptions-context\" id=\"ref-for-dom-summarizersummarizeoptions-context\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize②\">summarizes</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-shared-context\" id=\"ref-for-summarizer-shared-context②\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-type\" id=\"ref-for-summarizer-summary-type②\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-format\" id=\"ref-for-summarizer-summary-format②\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-length\" id=\"ref-for-summarizer-summary-length②\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-output-language\" id=\"ref-for-summarizer-output-language②\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-input-quota\" id=\"ref-for-summarizer-input-quota②\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result\" id=\"ref-for-get-an-aggregated-ai-model-result\">getting an aggregated AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Summarizer/summarizeStreaming(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizer-summarizestreaming",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Summarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarizeStreaming(input, options)|summarizeStreaming(input)\" id=\"dom-summarizer-summarizestreaming\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarizeStreaming(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizersummarizeoptions-context\" id=\"ref-for-dom-summarizersummarizeoptions-context①\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize③\">summarizes</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-shared-context\" id=\"ref-for-summarizer-shared-context③\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-type\" id=\"ref-for-summarizer-summary-type③\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-format\" id=\"ref-for-summarizer-summary-format③\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-length\" id=\"ref-for-summarizer-summary-length③\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-output-language\" id=\"ref-for-summarizer-output-language③\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-input-quota\" id=\"ref-for-summarizer-input-quota③\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result\" id=\"ref-for-get-a-streaming-ai-model-result\">getting a streaming AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Summarizer/measureInputUsage(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizer-measureinputusage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Summarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"measureInputUsage(input, options)|measureInputUsage(input)\" id=\"dom-summarizer-measureinputusage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>measureInputUsage(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizersummarizeoptions-context\" id=\"ref-for-dom-summarizersummarizeoptions-context②\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>measureUsage</var> be an algorithm step which takes argument <var>stopMeasuring</var>, and returns the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage\" id=\"ref-for-measure-summarizer-input-usage\">measuring summarizer input usage</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-shared-context\" id=\"ref-for-summarizer-shared-context④\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-type\" id=\"ref-for-summarizer-summary-type④\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-format\" id=\"ref-for-summarizer-summary-format④\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-summary-length\" id=\"ref-for-summarizer-summary-length④\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-output-language\" id=\"ref-for-summarizer-output-language④\">output language</a>, and <var>stopMeasuring</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage\" id=\"ref-for-measure-ai-model-input-usage\">measuring AI model input usage</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>, <var>options</var>, and <var>measureUsage</var>.</p>"
        }
      ]
    },
    {
      "name": "summarize",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarize</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype④\">SummarizerType</a></code> <var>type</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerformat\" id=\"ref-for-enumdef-summarizerformat④\">SummarizerFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerlength\" id=\"ref-for-enumdef-summarizerlength④\">SummarizerLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">string</a>-or-null <var>outputLanguage</var>,</p>\n     </li><li data-md=\"\">\n      <p>a number <var>inputQuota</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>chunkProduced</var> that takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥\">string</a> and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>done</var> that takes no arguments and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>error</var> that takes <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information\">error information</a> and returns nothing, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopProducing</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>requested</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage\" id=\"ref-for-measure-summarizer-input-usage①\">measuring summarizer input usage</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, <var>outputLanguage</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>If <var>requested</var> is null, then return.</p>"
        },
        {
          "html": "If <var>requested</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①\">error information</a>, then:",
          "rationale": "perform",
          "steps": [
            {
              "html": "<p>Perform <var>error</var> given <var>requested</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a>: <var>requested</var> is a number.</p>"
        },
        {
          "html": "If <var>requested</var> is greater than <var>inputQuota</var>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>errorInfo</var> be a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information①\">quota exceeded error information</a> with a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested\">requested</a> of <var>requested</var> and a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota\">quota</a> of <var>inputQuota</var>.</p>"
            },
            {
              "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②\">implementation-defined</a> manner, subject to the following guidelines, begin the processs of summarizing <var>input</var> into a string.</p>\n      <p>If they are non-null, <var>sharedContext</var> and <var>context</var> should be used to aid in the summarization by providing context on how the web developer wishes the input to be summarized.</p>\n      <p>If <var>input</var> is the empty string, or otherwise consists of no summarizable content (e.g., only contains whitespace, or control characters), then the resulting summary should be the empty string. In such cases, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var> should be ignored.</p>\n      <p>The summarization should conform to the guidance given by <var>type</var>, <var>format</var>, and <var>length</var>, in the definitions of each of their enumeration values.</p>\n      <p>The summarization process must conform to the guidance given in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy\">§ 6 Privacy considerations</a> and <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#security\">§ 7 Security considerations</a>.</p>\n      <p>If <var>outputLanguage</var> is non-null, the summarization should be in that language. Otherwise, it should be in the language of <var>input</var> (which might not match that of <var>context</var> or <var>sharedContext</var>). If <var>input</var> contains multiple languages, or the language of <var>input</var> cannot be detected, then either the output language is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined③\">implementation-defined</a>, or the implementation may treat this as an error, per the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 2.4.4 Errors</a>.</p>"
        },
        {
          "html": "While true:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for the next chunk of summarization data to be produced, for the summarization process to finish, or for the result of calling <var>stopProducing</var> to become true.</p>"
            },
            {
              "html": "If such a chunk is successfully produced:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let it be represented as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦\">string</a> <var>chunk</var>.</p>"
                },
                {
                  "html": "<p>Perform <var>chunkProduced</var> given <var>chunk</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the summarization process has finished:",
              "rationale": "perform",
              "steps": [
                {
                  "html": "<p>Perform <var>done</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>stopProducing</var> returns true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">break</a>.</p>"
            },
            {
              "html": "Otherwise, if an error occurred during summarization:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let the error be represented as <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information②\">error information</a> <var>errorInfo</var> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 2.4.4 Errors</a>.</p>"
                },
                {
                  "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "measure summarizer input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"measure-summarizer-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure summarizer input usage</dfn>, given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑧\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑨\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⓪\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype⑤\">SummarizerType</a></code> <var>type</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerformat\" id=\"ref-for-enumdef-summarizerformat⑤\">SummarizerFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizerlength\" id=\"ref-for-enumdef-summarizerlength⑤\">SummarizerLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①\">string</a>-or-null <var>outputLanguage</var>, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopMeasuring</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputToModel</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined④\">implementation-defined</a> string that would be sent to the underlying model in order to <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize④\">summarize</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var>.</p>\n      \n      <p>If during this process <var>stopMeasuring</var> starts returning true, then return null.</p>\n      <p>If an error occurs during this process, then return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information①\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 2.4.4 Errors</a>.</p>"
        },
        {
          "html": "<p>Return the amount of input usage needed to represent <var>inputToModel</var> when given to the underlying model. The exact calculation procedure is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑤\">implementation-defined</a>, subject to the following constraints.</p>\n      <p>The returned input usage must be nonnegative and finite. It must be 0, if there are no usage quotas for the summarization process (i.e., if the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-input-quota\" id=\"ref-for-summarizer-input-quota⑤\">input quota</a> is +∞). Otherwise, it must be positive and should be roughly proportional to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length\">length</a> of <var>inputToModel</var>.</p>\n      \n      <p>If during this process <var>stopMeasuring</var> starts returning true, then instead return null.</p>\n      <p>If an error occurs during this process, then instead return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information②\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 2.4.4 Errors</a>.</p>"
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype⑧\">SummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 3 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 12 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype⑨\">SummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 5 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 17 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-summarizertype\" id=\"ref-for-enumdef-summarizertype①⓪\">SummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 7 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 22 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Writer/create(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-writer-create",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Writer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"create(options)|create()\" id=\"dom-writer-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>create(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object\" id=\"ref-for-create-an-ai-model-object①\">creating an AI model object</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-writer\" id=\"ref-for-permissiondef-writer\">writer</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-writer-options\" id=\"ref-for-validate-and-canonicalize-writer-options\">validate and canonicalize writer options</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-writer-options-availability\" id=\"ref-for-compute-writer-options-availability\">computing writer options availability</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#download-the-writer-model\" id=\"ref-for-download-the-writer-model\">download the writer model</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-writer-model\" id=\"ref-for-initialize-the-writer-model\">initialize the writer model</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-a-writer-object\" id=\"ref-for-create-a-writer-object\">create a writer object</a>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize writer options",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-writer-options",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-canonicalize-writer-options\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize writer options</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-writercreatecoreoptions\" id=\"ref-for-dictdef-writercreatecoreoptions②\">WriterCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags, and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags③\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedinputlanguages\">expectedInputLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags④\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedcontextlanguages\">expectedContextLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags⑤\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-writercreatecoreoptions-outputlanguage\">outputLanguage</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "download the writer model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#download-the-writer-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"download-the-writer-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">download the writer model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-writercreatecoreoptions\" id=\"ref-for-dictdef-writercreatecoreoptions③\">WriterCreateCoreOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Initiate the download process for everything the user agent needs to write text according to <var>options</var>. This could include a base AI model, fine-tunings for specific languages or option values, or other resources.</p>"
        },
        {
          "html": "<p>If the download process cannot be started for any reason, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "initialize the writer model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-writer-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-writer-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the writer model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-writercreateoptions\" id=\"ref-for-dictdef-writercreateoptions①\">WriterCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform any necessary initialization operations for the AI model backing the user agent’s writing capabilities.</p>\n      <p>This could include loading the model into memory, loading <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreateoptions-sharedcontext\" id=\"ref-for-dom-writercreateoptions-sharedcontext\">sharedContext</a></code>\"] into the model’s context window, or loading any fine-tunings necessary to support the other options expressed by <var>options</var>.</p>"
        },
        {
          "html": "If initialization failed because the process of loading <var>options</var> resulted in using up all of the model’s input quota, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requested</var> be the amount of input usage needed to encode <var>options</var>. The encoding of <var>options</var> as input is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑧\">implementation-defined</a>.</p>"
            },
            {
              "html": "<p>Let <var>quota</var> be the maximum input quota that the user agent supports for encoding <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a>: <var>requested</var> is greater than <var>quota</var>. (That is how we reached this error branch.)</p>"
            },
            {
              "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information②\">quota exceeded error information</a> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested①\">requested</a> is <var>requested</var> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota①\">quota</a> is <var>quota</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If initialization failed for any other reason, then return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information③\">DOMException error information</a> whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name①\">name</a> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror①\">OperationError</a></code>\" and whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details①\">details</a> contain appropriate detail.</p>"
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "create a writer object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-a-writer-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-writer-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a writer object</dfn>, given a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm①\">realm</a> <var>realm</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-writercreateoptions\" id=\"ref-for-dictdef-writercreateoptions②\">WriterCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①③\">Assert</a>: these steps are running on <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#surrounding-agent\" id=\"ref-for-surrounding-agent①\">surrounding agent</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop\" id=\"ref-for-concept-agent-event-loop①\">event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputQuota</var> be the amount of input quota that is available to the user agent for future <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#write\" id=\"ref-for-write①\">writing</a> operations. (This value is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑨\">implementation-defined</a>, and may be +∞ if there are no specific limits beyond, e.g., the user’s memory, or the limits of JavaScript strings.)</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer\" id=\"ref-for-writer②\">Writer</a></code> object, created in <var>realm</var>, with</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-shared-context\" id=\"ref-for-writer-shared-context\">shared context</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreateoptions-sharedcontext\" id=\"ref-for-dom-writercreateoptions-sharedcontext①\">sharedContext</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-tone\" id=\"ref-for-writer-tone\">tone</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-tone\" id=\"ref-for-dom-writercreatecoreoptions-tone\">tone</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-format\" id=\"ref-for-writer-format\">format</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-format\" id=\"ref-for-dom-writercreatecoreoptions-format\">format</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-length\" id=\"ref-for-writer-length\">length</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-length\" id=\"ref-for-dom-writercreatecoreoptions-length\">length</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-expected-input-languages\" id=\"ref-for-writer-expected-input-languages\">expected input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array②\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedinputlanguages①\">expectedInputLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-expected-context-languages\" id=\"ref-for-writer-expected-context-languages\">expected context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array③\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedcontextlanguages①\">expectedContextLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-output-language\" id=\"ref-for-writer-output-language\">output language</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-writercreatecoreoptions-outputlanguage①\">outputLanguage</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-input-quota\" id=\"ref-for-writer-input-quota\">input quota</a>\n       </dt><dd data-md=\"\">\n        <p><var>inputQuota</var></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Writer/availability(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-writer-availability",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Writer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"availability(options)|availability()\" id=\"dom-writer-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>availability(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-ai-model-availability\" id=\"ref-for-compute-ai-model-availability①\">computing AI model availability</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-writer\" id=\"ref-for-permissiondef-writer①\">writer</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-writer-options\" id=\"ref-for-validate-and-canonicalize-writer-options①\">validate and canonicalize writer options</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-writer-options-availability\" id=\"ref-for-compute-writer-options-availability①\">compute writer options availability</a>.</p>"
        }
      ]
    },
    {
      "name": "compute writer options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-writer-options-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-writer-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute writer options availability</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-writercreatecoreoptions\" id=\"ref-for-dictdef-writercreatecoreoptions④\">WriterCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They return either an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability④\">Availability</a></code> value or null, and they mutate <var>options</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①④\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>availability</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-non-language-options-availability\" id=\"ref-for-writer-non-language-options-availability\">writer non-language options availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-tone\" id=\"ref-for-dom-writercreatecoreoptions-tone①\">tone</a></code>\"], <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-format\" id=\"ref-for-dom-writercreatecoreoptions-format①\">format</a></code>\"], and <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-length\" id=\"ref-for-dom-writercreatecoreoptions-length①\">length</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>triple</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-language-availabilities-triple\" id=\"ref-for-writer-language-availabilities-triple\">writer language availabilities triple</a>.</p>"
        },
        {
          "html": "<p>If <var>triple</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Let <var>inputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability③\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedinputlanguages②\">expectedInputLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages④\">input languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextLanguagesAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability④\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-writercreatecoreoptions-expectedcontextlanguages②\">expectedContextLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages②\">context languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>outputLanguagesList</var> be « <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-writercreatecoreoptions-outputlanguage②\">outputLanguage</a></code>\"] ».</p>"
        },
        {
          "html": "<p>Let <var>outputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability⑤\">computing language availability</a> given <var>outputLanguagesList</var> and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages②\">output languages</a>.</p>"
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-writercreatecoreoptions-outputlanguage③\">outputLanguage</a></code>\"] to <var>outputLanguagesList</var>[0].</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#availability-minimum-availability\" id=\"ref-for-availability-minimum-availability①\">minimum availability</a> given « <var>availability</var>, <var>inputLanguageAvailability</var>, <var>contextLanguagesAvailability</var>, <var>outputLanguageAvailability</var> ».</p>"
        }
      ]
    },
    {
      "name": "writer non-language options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#writer-non-language-options-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"writer-non-language-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">writer non-language options availability</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writertone\" id=\"ref-for-enumdef-writertone②\">WriterTone</a></code> <var>tone</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerformat\" id=\"ref-for-enumdef-writerformat②\">WriterFormat</a></code> <var>format</var>, and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerlength\" id=\"ref-for-enumdef-writerlength②\">WriterLength</a></code> <var>length</var>, is given by the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability⑤\">Availability</a></code> value or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑤\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports writing text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>If the user agent supports writing text with the tone described by <var>tone</var>, in the format described by <var>format</var>, and with the length guidance given by <var>length</var> without performing any downloading operations, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available②\">available</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can write text according to <var>tone</var>, <var>format</var>, and <var>length</var>, but only after finishing a download (e.g., of an AI model or fine-tuning) that is already ongoing, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable③\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can write text according to <var>tone</var>, <var>format</var>, and <var>length</var>, but only after performing a download (e.g., of an AI model or fine-tuning), then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable④\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable①\">unavailable</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "writer language availabilities triple",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#writer-language-availabilities-triple",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"writer-language-availabilities-triple\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">writer language availabilities triple</dfn> is given by the following steps. They return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple②\">language availabilities triple</a> or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑥\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports writing text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple③\">language availabilities triple</a> with:</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages⑤\">input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition③\">getting the language availabilities partition</a> given the purpose of writing text based on input in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages③\">context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition④\">getting the language availabilities partition</a> given the purpose of writing text using web-developer provided context information written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages③\">output languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition⑤\">getting the language availabilities partition</a> given the purpose of producing written text in that language</p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Writer/write(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-writer-write",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Writer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"write(input, options)|write(input)\" id=\"dom-writer-write\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>write(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writerwriteoptions-context\" id=\"ref-for-dom-writerwriteoptions-context\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#write\" id=\"ref-for-write②\">writes</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-shared-context\" id=\"ref-for-writer-shared-context②\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-tone\" id=\"ref-for-writer-tone②\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-format\" id=\"ref-for-writer-format②\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-length\" id=\"ref-for-writer-length②\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-output-language\" id=\"ref-for-writer-output-language②\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-input-quota\" id=\"ref-for-writer-input-quota②\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result\" id=\"ref-for-get-an-aggregated-ai-model-result①\">getting an aggregated AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④②\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Writer/writeStreaming(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-writer-writestreaming",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Writer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"writeStreaming(input, options)|writeStreaming(input)\" id=\"dom-writer-writestreaming\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>writeStreaming(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writerwriteoptions-context\" id=\"ref-for-dom-writerwriteoptions-context①\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#write\" id=\"ref-for-write③\">writes</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-shared-context\" id=\"ref-for-writer-shared-context③\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-tone\" id=\"ref-for-writer-tone③\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-format\" id=\"ref-for-writer-format③\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-length\" id=\"ref-for-writer-length③\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-output-language\" id=\"ref-for-writer-output-language③\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-input-quota\" id=\"ref-for-writer-input-quota③\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result\" id=\"ref-for-get-a-streaming-ai-model-result①\">getting a streaming AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑨\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Writer/measureInputUsage(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-writer-measureinputusage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Writer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"measureInputUsage(input, options)|measureInputUsage(input)\" id=\"dom-writer-measureinputusage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>measureInputUsage(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-writerwriteoptions-context\" id=\"ref-for-dom-writerwriteoptions-context②\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>measureUsage</var> be an algorithm step which takes argument <var>stopMeasuring</var>, and returns the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-writer-input-usage\" id=\"ref-for-measure-writer-input-usage\">measuring writer input usage</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-shared-context\" id=\"ref-for-writer-shared-context④\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-tone\" id=\"ref-for-writer-tone④\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-format\" id=\"ref-for-writer-format④\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-length\" id=\"ref-for-writer-length④\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-output-language\" id=\"ref-for-writer-output-language④\">output language</a>, and <var>stopMeasuring</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage\" id=\"ref-for-measure-ai-model-input-usage①\">measuring AI model input usage</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⑤\">this</a>, <var>options</var>, and <var>measureUsage</var>.</p>"
        }
      ]
    },
    {
      "name": "write",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#write",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"write\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">write</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①④\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writertone\" id=\"ref-for-enumdef-writertone④\">WriterTone</a></code> <var>tone</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerformat\" id=\"ref-for-enumdef-writerformat④\">WriterFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerlength\" id=\"ref-for-enumdef-writerlength④\">WriterLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">string</a>-or-null <var>outputLanguage</var>,</p>\n     </li><li data-md=\"\">\n      <p>a number <var>inputQuota</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>chunkProduced</var> that takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑧\">string</a> and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>done</var> that takes no arguments and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>error</var> that takes <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information③\">error information</a> and returns nothing, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopProducing</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑦\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>requested</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-writer-input-usage\" id=\"ref-for-measure-writer-input-usage①\">measuring writer input usage</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>tone</var>, <var>format</var>, <var>length</var>, <var>outputLanguage</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>If <var>requested</var> is null, then return.</p>"
        },
        {
          "html": "If <var>requested</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information④\">error information</a>, then:",
          "rationale": "perform",
          "steps": [
            {
              "html": "<p>Perform <var>error</var> given <var>requested</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑧\">Assert</a>: <var>requested</var> is a number.</p>"
        },
        {
          "html": "If <var>requested</var> is greater than <var>inputQuota</var>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>errorInfo</var> be a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information③\">quota exceeded error information</a> with a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested①\">requested</a> of <var>requested</var> and a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota①\">quota</a> of <var>inputQuota</var>.</p>"
            },
            {
              "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⓪\">implementation-defined</a> manner, subject to the following guidelines, begin the processs of writing to a string, based on the writing task specified in <var>input</var>.</p>\n      <p>If they are non-null, <var>sharedContext</var> and <var>context</var> should be used to aid in the writing by providing context on how the web developer wishes the writing task to be performed.</p>\n      <p>If <var>input</var> is the empty string, then the resulting text should be the empty string.</p>\n      <p>The written output should conform to the guidance given by <var>tone</var>, <var>format</var>, and <var>length</var>, in the definitions of each of their enumeration values.</p>\n      <p>The writing process must conform to the guidance given in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy\">§ 6 Privacy considerations</a> and <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#security\">§ 7 Security considerations</a>.</p>\n      <p>If <var>outputLanguage</var> is non-null, the writing should be in that language. Otherwise, it should be in the language of <var>input</var> (which might not match that of <var>context</var> or <var>sharedContext</var>). If <var>input</var> contains multiple languages, or the language of <var>input</var> cannot be detected, then either the output language is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①①\">implementation-defined</a>, or the implementation may treat this as an error, per the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-errors\">§ 3.4.4 Errors</a>.</p>"
        },
        {
          "html": "While true:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for the next chunk of written text to be produced, for the writing process to finish, or for the result of calling <var>stopProducing</var> to become true.</p>"
            },
            {
              "html": "If such a chunk is successfully produced:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let it be represented as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑨\">string</a> <var>chunk</var>.</p>"
                },
                {
                  "html": "<p>Perform <var>chunkProduced</var> given <var>chunk</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the writing process has finished:",
              "rationale": "perform",
              "steps": [
                {
                  "html": "<p>Perform <var>done</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>stopProducing</var> returns true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break④\">break</a>.</p>"
            },
            {
              "html": "Otherwise, if an error occurred during writing:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let the error be represented as <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑤\">error information</a> <var>errorInfo</var> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-errors\">§ 3.4.4 Errors</a>.</p>"
                },
                {
                  "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑤\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "measure writer input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-writer-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"measure-writer-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure writer input usage</dfn>, given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⓪\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②①\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②②\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writertone\" id=\"ref-for-enumdef-writertone⑤\">WriterTone</a></code> <var>tone</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerformat\" id=\"ref-for-enumdef-writerformat⑤\">WriterFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-writerlength\" id=\"ref-for-enumdef-writerlength⑤\">WriterLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②③\">string</a>-or-null <var>outputLanguage</var>, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopMeasuring</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑨\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputToModel</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①②\">implementation-defined</a> string that would be sent to the underlying model in order to <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#write\" id=\"ref-for-write④\">write</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>tone</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var>.</p>\n      <p>If during this process <var>stopMeasuring</var> starts returning true, then return null.</p>\n      <p>If an error occurs during this process, then return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information④\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-errors\">§ 3.4.4 Errors</a>.</p>"
        },
        {
          "html": "<p>Return the amount of input usage needed to represent <var>inputToModel</var> when given to the underlying model. The exact calculation procedure is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①③\">implementation-defined</a>, subject to the following constraints.</p>\n      <p>The returned input usage must be nonnegative and finite. It must be 0, if there are no usage quotas for the writing process (i.e., if the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-input-quota\" id=\"ref-for-writer-input-quota④\">input quota</a> is +∞). Otherwise, it must be positive and should be roughly proportional to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②\">length</a> of <var>inputToModel</var>.</p>\n      <p>If during this process <var>stopMeasuring</var> starts returning true, then instead return null.</p>\n      <p>If an error occurs during this process, then instead return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information⑤\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#writer-errors\">§ 3.4.4 Errors</a>.</p>"
        }
      ]
    },
    {
      "name": "Rewriter/create(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriter-create",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Rewriter\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"create(options)|create()\" id=\"dom-rewriter-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>create(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object\" id=\"ref-for-create-an-ai-model-object②\">creating an AI model object</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-rewriter\" id=\"ref-for-permissiondef-rewriter\">rewriter</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-rewriter-options\" id=\"ref-for-validate-and-canonicalize-rewriter-options\">validate and canonicalize rewriter options</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-rewriter-options-availability\" id=\"ref-for-compute-rewriter-options-availability\">computing rewriter options availability</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#download-the-rewriter-model\" id=\"ref-for-download-the-rewriter-model\">download the rewriter model</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-rewriter-model\" id=\"ref-for-initialize-the-rewriter-model\">initialize the rewriter model</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-a-rewriter-object\" id=\"ref-for-create-a-rewriter-object\">create a rewriter object</a>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize rewriter options",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-rewriter-options",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-canonicalize-rewriter-options\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize rewriter options</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-rewritercreatecoreoptions\" id=\"ref-for-dictdef-rewritercreatecoreoptions②\">RewriterCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags, and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags⑥\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedinputlanguages\">expectedInputLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags⑦\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedcontextlanguages\">expectedContextLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags⑧\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-rewritercreatecoreoptions-outputlanguage\">outputLanguage</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "download the rewriter model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#download-the-rewriter-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"download-the-rewriter-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">download the rewriter model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-rewritercreatecoreoptions\" id=\"ref-for-dictdef-rewritercreatecoreoptions③\">RewriterCreateCoreOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⓪\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①④\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Initiate the download process for everything the user agent needs to rewrite text according to <var>options</var>. This could include a base AI model, fine-tunings for specific languages or option values, or other resources.</p>"
        },
        {
          "html": "<p>If the download process cannot be started for any reason, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "initialize the rewriter model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-rewriter-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-rewriter-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the rewriter model</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-rewritercreateoptions\" id=\"ref-for-dictdef-rewritercreateoptions①\">RewriterCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②①\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑤\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform any necessary initialization operations for the AI model backing the user agent’s rewriting capabilities.</p>\n      <p>This could include loading the model into memory, loading <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreateoptions-sharedcontext\" id=\"ref-for-dom-rewritercreateoptions-sharedcontext\">sharedContext</a></code>\"] into the model’s context window, or loading any fine-tunings necessary to support the other options expressed by <var>options</var>.</p>"
        },
        {
          "html": "If initialization failed because the process of loading <var>options</var> resulted in using up all of the model’s input quota, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requested</var> be the amount of input usage needed to encode <var>options</var>. The encoding of <var>options</var> as input is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑥\">implementation-defined</a>.</p>"
            },
            {
              "html": "<p>Let <var>quota</var> be the maximum input quota that the user agent supports for encoding <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②②\">Assert</a>: <var>requested</var> is greater than <var>quota</var>. (That is how we reached this error branch.)</p>"
            },
            {
              "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information④\">quota exceeded error information</a> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested②\">requested</a> is <var>requested</var> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota②\">quota</a> is <var>quota</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If initialization failed for any other reason, then return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information⑥\">DOMException error information</a> whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name②\">name</a> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror②\">OperationError</a></code>\" and whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details②\">details</a> contain appropriate detail.</p>"
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "create a rewriter object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-a-rewriter-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-rewriter-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a rewriter object</dfn>, given a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm②\">realm</a> <var>realm</var> and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-rewritercreateoptions\" id=\"ref-for-dictdef-rewritercreateoptions②\">RewriterCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②③\">Assert</a>: these steps are running on <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#surrounding-agent\" id=\"ref-for-surrounding-agent②\">surrounding agent</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop\" id=\"ref-for-concept-agent-event-loop②\">event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputQuota</var> be the amount of input quota that is available to the user agent for future <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewrite\" id=\"ref-for-rewrite①\">rewriting</a> operations. (This value is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑦\">implementation-defined</a>, and may be +∞ if there are no specific limits beyond, e.g., the user’s memory, or the limits of JavaScript strings.)</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter\" id=\"ref-for-rewriter②\">Rewriter</a></code> object, created in <var>realm</var>, with</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-shared-context\" id=\"ref-for-rewriter-shared-context\">shared context</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreateoptions-sharedcontext\" id=\"ref-for-dom-rewritercreateoptions-sharedcontext①\">sharedContext</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-tone\" id=\"ref-for-rewriter-tone\">tone</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-tone\" id=\"ref-for-dom-rewritercreatecoreoptions-tone\">tone</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-format\" id=\"ref-for-rewriter-format\">format</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-format\" id=\"ref-for-dom-rewritercreatecoreoptions-format\">format</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-length\" id=\"ref-for-rewriter-length\">length</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-length\" id=\"ref-for-dom-rewritercreatecoreoptions-length\">length</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-expected-input-languages\" id=\"ref-for-rewriter-expected-input-languages\">expected input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array④\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedinputlanguages①\">expectedInputLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty④\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-expected-context-languages\" id=\"ref-for-rewriter-expected-context-languages\">expected context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array⑤\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedcontextlanguages①\">expectedContextLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-output-language\" id=\"ref-for-rewriter-output-language\">output language</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-rewritercreatecoreoptions-outputlanguage①\">outputLanguage</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-input-quota\" id=\"ref-for-rewriter-input-quota\">input quota</a>\n       </dt><dd data-md=\"\">\n        <p><var>inputQuota</var></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Rewriter/availability(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriter-availability",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Rewriter\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"availability(options)|availability()\" id=\"dom-rewriter-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>availability(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-ai-model-availability\" id=\"ref-for-compute-ai-model-availability②\">computing AI model availability</a> given <var>options</var>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#permissiondef-rewriter\" id=\"ref-for-permissiondef-rewriter①\">rewriter</a></code>\", <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-rewriter-options\" id=\"ref-for-validate-and-canonicalize-rewriter-options①\">validate and canonicalize rewriter options</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-rewriter-options-availability\" id=\"ref-for-compute-rewriter-options-availability①\">compute rewriter options availability</a>.</p>"
        }
      ]
    },
    {
      "name": "compute rewriter options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-rewriter-options-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-rewriter-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute rewriter options availability</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-rewritercreatecoreoptions\" id=\"ref-for-dictdef-rewritercreatecoreoptions④\">RewriterCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They return either an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability⑦\">Availability</a></code> value or null, and they mutate <var>options</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②④\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑥\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>availability</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-non-language-options-availability\" id=\"ref-for-rewriter-non-language-options-availability\">rewriter non-language options availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-tone\" id=\"ref-for-dom-rewritercreatecoreoptions-tone①\">tone</a></code>\"], <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-format\" id=\"ref-for-dom-rewritercreatecoreoptions-format①\">format</a></code>\"], and <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-length\" id=\"ref-for-dom-rewritercreatecoreoptions-length①\">length</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>triple</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-language-availabilities-triple\" id=\"ref-for-rewriter-language-availabilities-triple\">rewriter language availabilities triple</a>.</p>"
        },
        {
          "html": "<p>If <var>triple</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Let <var>inputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability⑥\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedinputlanguages②\">expectedInputLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages⑥\">input languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextLanguagesAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability⑦\">computing language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-rewritercreatecoreoptions-expectedcontextlanguages②\">expectedContextLanguages</a></code>\"] and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages④\">context languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>outputLanguagesList</var> be « <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-rewritercreatecoreoptions-outputlanguage②\">outputLanguage</a></code>\"] ».</p>"
        },
        {
          "html": "<p>Let <var>outputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability\" id=\"ref-for-compute-language-availability⑧\">computing language availability</a> given <var>outputLanguagesList</var> and <var>triple</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages④\">output languages</a>.</p>"
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewritercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-rewritercreatecoreoptions-outputlanguage③\">outputLanguage</a></code>\"] to <var>outputLanguagesList</var>[0].</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#availability-minimum-availability\" id=\"ref-for-availability-minimum-availability②\">minimum availability</a> given « <var>availability</var>, <var>inputLanguageAvailability</var>, <var>contextLanguagesAvailability</var>, <var>outputLanguageAvailability</var> ».</p>"
        }
      ]
    },
    {
      "name": "rewriter non-language options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-non-language-options-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"rewriter-non-language-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">rewriter non-language options availability</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewritertone\" id=\"ref-for-enumdef-rewritertone②\">RewriterTone</a></code> <var>tone</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterformat\" id=\"ref-for-enumdef-rewriterformat②\">RewriterFormat</a></code> <var>format</var>, and a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterlength\" id=\"ref-for-enumdef-rewriterlength②\">RewriterLength</a></code> <var>length</var>, is given by the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability⑧\">Availability</a></code> value or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑤\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑦\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports rewriting text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>If the user agent supports rewriting text with the tone modification described by <var>tone</var>, in the format described by <var>format</var>, and with the length modification given by <var>length</var> without performing any downloading operations, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available③\">available</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can rewrite text according to <var>tone</var>, <var>format</var>, and <var>length</var>, but only after finishing a download (e.g., of an AI model or fine-tuning) that is already ongoing, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable⑤\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can rewrite text according to <var>tone</var>, <var>format</var>, and <var>length</var>, but only after performing a download (e.g., of an AI model or fine-tuning), then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable⑥\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable②\">unavailable</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "rewriter language availabilities triple",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-language-availabilities-triple",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"rewriter-language-availabilities-triple\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">rewriter language availabilities triple</dfn> is given by the following steps. They return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple④\">language availabilities triple</a> or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑥\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑧\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports rewriting text, which the user agent believes to be transient (such that re-querying could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple\" id=\"ref-for-language-availabilities-triple⑤\">language availabilities triple</a> with:</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-input-languages\" id=\"ref-for-language-availabilities-triple-input-languages⑦\">input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition⑥\">getting the language availabilities partition</a> given the purpose of rewriting text written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-context-languages\" id=\"ref-for-language-availabilities-triple-context-languages⑤\">context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition⑦\">getting the language availabilities partition</a> given the purpose of rewriting text using web-developer provided context information written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-triple-output-languages\" id=\"ref-for-language-availabilities-triple-output-languages⑤\">output languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition\" id=\"ref-for-get-the-language-availabilities-partition⑧\">getting the language availabilities partition</a> given the purpose of producing rewritten text in that language</p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "Rewriter/rewrite(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriter-rewrite",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Rewriter\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"rewrite(input, options)|rewrite(input)\" id=\"dom-rewriter-rewrite\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>rewrite(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriterrewriteoptions-context\" id=\"ref-for-dom-rewriterrewriteoptions-context\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewrite\" id=\"ref-for-rewrite②\">rewrites</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-shared-context\" id=\"ref-for-rewriter-shared-context②\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-tone\" id=\"ref-for-rewriter-tone②\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-format\" id=\"ref-for-rewriter-format②\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-length\" id=\"ref-for-rewriter-length②\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-output-language\" id=\"ref-for-rewriter-output-language②\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-input-quota\" id=\"ref-for-rewriter-input-quota②\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result\" id=\"ref-for-get-an-aggregated-ai-model-result②\">getting an aggregated AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⓪\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Rewriter/rewriteStreaming(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriter-rewritestreaming",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Rewriter\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"rewriteStreaming(input, options)|rewriteStreaming(input)\" id=\"dom-rewriter-rewritestreaming\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>rewriteStreaming(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriterrewriteoptions-context\" id=\"ref-for-dom-rewriterrewriteoptions-context①\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewrite\" id=\"ref-for-rewrite③\">rewrites</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-shared-context\" id=\"ref-for-rewriter-shared-context③\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-tone\" id=\"ref-for-rewriter-tone③\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-format\" id=\"ref-for-rewriter-format③\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-length\" id=\"ref-for-rewriter-length③\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-output-language\" id=\"ref-for-rewriter-output-language③\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-input-quota\" id=\"ref-for-rewriter-input-quota③\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result\" id=\"ref-for-get-a-streaming-ai-model-result②\">getting a streaming AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑦\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "Rewriter/measureInputUsage(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriter-measureinputusage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Rewriter\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"measureInputUsage(input, options)|measureInputUsage(input)\" id=\"dom-rewriter-measureinputusage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>measureInputUsage(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-rewriterrewriteoptions-context\" id=\"ref-for-dom-rewriterrewriteoptions-context②\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>measureUsage</var> be an algorithm step which takes argument <var>stopMeasuring</var>, and returns the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-rewriter-input-usage\" id=\"ref-for-measure-rewriter-input-usage\">measuring rewriter input usage</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-shared-context\" id=\"ref-for-rewriter-shared-context④\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-tone\" id=\"ref-for-rewriter-tone④\">tone</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-format\" id=\"ref-for-rewriter-format④\">format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-length\" id=\"ref-for-rewriter-length④\">length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-output-language\" id=\"ref-for-rewriter-output-language④\">output language</a>, and <var>stopMeasuring</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage\" id=\"ref-for-measure-ai-model-input-usage②\">measuring AI model input usage</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧③\">this</a>, <var>options</var>, and <var>measureUsage</var>.</p>"
        }
      ]
    },
    {
      "name": "rewrite",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#rewrite",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"rewrite\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">rewrite</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑥\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑦\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑧\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewritertone\" id=\"ref-for-enumdef-rewritertone④\">RewriterTone</a></code> <var>tone</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterformat\" id=\"ref-for-enumdef-rewriterformat④\">RewriterFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterlength\" id=\"ref-for-enumdef-rewriterlength④\">RewriterLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑨\">string</a>-or-null <var>outputLanguage</var>,</p>\n     </li><li data-md=\"\">\n      <p>a number <var>inputQuota</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>chunkProduced</var> that takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⓪\">string</a> and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>done</var> that takes no arguments and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>error</var> that takes <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑥\">error information</a> and returns nothing, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopProducing</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑦\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑨\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>requested</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-rewriter-input-usage\" id=\"ref-for-measure-rewriter-input-usage①\">measuring rewriter input usage</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>tone</var>, <var>format</var>, <var>length</var>, <var>outputLanguage</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>If <var>requested</var> is null, then return.</p>"
        },
        {
          "html": "If <var>requested</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑦\">error information</a>, then:",
          "rationale": "perform",
          "steps": [
            {
              "html": "<p>Perform <var>error</var> given <var>requested</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑧\">Assert</a>: <var>requested</var> is a number.</p>"
        },
        {
          "html": "If <var>requested</var> is greater than <var>inputQuota</var>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>errorInfo</var> be a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information⑤\">quota exceeded error information</a> with a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested②\">requested</a> of <var>requested</var> and a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota②\">quota</a> of <var>inputQuota</var>.</p>"
            },
            {
              "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑧\">implementation-defined</a> manner, subject to the following guidelines, begin the processs of rewriting <var>input</var> into a string.</p>\n      <p>If they are non-null, <var>sharedContext</var> and <var>context</var> should be used to aid in the rewriting by providing context on how the web developer wishes the rewriting task to be performed.</p>\n      <p>If <var>input</var> is the empty string, then the resulting text should be the empty string.</p>\n      <p>The rewritten output should conform to the guidance given by <var>tone</var>, <var>format</var>, and <var>length</var>, in the definitions of each of their enumeration values.</p>\n      <p>The rewriting process must conform to the guidance given in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy\">§ 6 Privacy considerations</a> and <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#security\">§ 7 Security considerations</a>.</p>\n      <p>If <var>outputLanguage</var> is non-null, the rewritten output text should be in that language. Otherwise, it should be in the language of <var>input</var> (which might not match that of <var>context</var> or <var>sharedContext</var>). If <var>input</var> contains multiple languages, or the language of <var>input</var> cannot be detected, then either the output language is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑨\">implementation-defined</a>, or the implementation may treat this as an error, per the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-errors\">§ 4.4.4 Errors</a>.</p>"
        },
        {
          "html": "While true:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for the next chunk of rewritten text to be produced, for the rewriting process to finish, or for the result of calling <var>stopProducing</var> to become true.</p>"
            },
            {
              "html": "If such a chunk is successfully produced:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let it be represented as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③①\">string</a> <var>chunk</var>.</p>"
                },
                {
                  "html": "<p>Perform <var>chunkProduced</var> given <var>chunk</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the rewriting process has finished:",
              "rationale": "perform",
              "steps": [
                {
                  "html": "<p>Perform <var>done</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑥\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>stopProducing</var> returns true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑦\">break</a>.</p>"
            },
            {
              "html": "Otherwise, if an error occurred during rewriting:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let the error be represented as <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑧\">error information</a> <var>errorInfo</var> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-errors\">§ 4.4.4 Errors</a>.</p>"
                },
                {
                  "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑧\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "measure rewriter input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-rewriter-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"measure-rewriter-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure rewriter input usage</dfn>, given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③②\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③③\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③④\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewritertone\" id=\"ref-for-enumdef-rewritertone⑤\">RewriterTone</a></code> <var>tone</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterformat\" id=\"ref-for-enumdef-rewriterformat⑤\">RewriterFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-rewriterlength\" id=\"ref-for-enumdef-rewriterlength⑤\">RewriterLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑤\">string</a>-or-null <var>outputLanguage</var>, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopMeasuring</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑨\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②⓪\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputToModel</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②⓪\">implementation-defined</a> string that would be sent to the underlying model in order to <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewrite\" id=\"ref-for-rewrite④\">rewrite</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>tone</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var>.</p>\n      <p>If during this process <var>stopMeasuring</var> starts returning true, then return null.</p>\n      <p>If an error occurs during this process, then return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information⑦\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-errors\">§ 4.4.4 Errors</a>.</p>"
        },
        {
          "html": "<p>Return the amount of input usage needed to represent <var>inputToModel</var> when given to the underlying model. The exact calculation procedure is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②①\">implementation-defined</a>, subject to the following constraints.</p>\n      <p>The returned input usage must be nonnegative and finite. It must be 0, if there are no usage quotas for the rewriting process (i.e., if the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-input-quota\" id=\"ref-for-rewriter-input-quota④\">input quota</a> is +∞). Otherwise, it must be positive and should be roughly proportional to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length③\">length</a> of <var>inputToModel</var>.</p>\n      <p>If during this process <var>stopMeasuring</var> starts returning true, then instead return null.</p>\n      <p>If an error occurs during this process, then instead return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information⑧\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#rewriter-errors\">§ 4.4.4 Errors</a>.</p>"
        }
      ]
    },
    {
      "name": "initialize as a destroyable",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-as-a-destroyable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-as-a-destroyable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize as a destroyable</dfn> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel④\">DestroyableModel</a></code> object <var>destroyable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>controller</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortcontroller\" id=\"ref-for-abortcontroller①\">AbortController</a></code> created in <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal\">signal</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal⑧\">AbortSignal</a></code> created in <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destruction-abort-controller\" id=\"ref-for-destroyablemodel-destruction-abort-controller①\">destruction abort controller</a> to <var>controller</var>.</p>"
        }
      ]
    },
    {
      "name": "DestroyableModel/destroy",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destroy",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DestroyableModel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"destroyablemodel-destroy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">destroy</dfn> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel⑤\">DestroyableModel</a></code> <var>destroyable</var>, given a JavaScript value <var>reason</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal-abort\" id=\"ref-for-abortcontroller-signal-abort\">Signal abort</a> given <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destruction-abort-controller\" id=\"ref-for-destroyablemodel-destruction-abort-controller②\">destruction abort controller</a> and <var>reason</var>.</p>"
        },
        {
          "html": "<p>The user agent should release any resources associated with <var>destroyable</var>, such as AI models loaded to support its operation, as long as those resources are not needed for other ongoing operations.</p>"
        }
      ]
    },
    {
      "name": "create an AI model object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-an-ai-model-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an AI model object</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map\">ordered map</a> <var>options</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature③\">policy-controlled feature</a> <var>permissionsPolicyFeature</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>validateAndCanonicalizeOptions</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①\">ordered map</a> and returning nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>getAvailability</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">ordered map</a> and returning an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability⑨\">Availability</a></code> or null,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>startDownload</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③\">ordered map</a> and returning a boolean,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>initialize</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">ordered map</a> and returning an error information or null, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>create</var> taking a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm③\">realm</a> and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">ordered map</a> and returning a Web IDL object representing the model,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm\">current realm</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⓪\">Assert</a>: <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code> object.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Perform <var>validateAndCanonicalizeOptions</var> given <var>options</var>. If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①\">a promise rejected with</a> <var>e</var>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②\">a promise rejected with</a> <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> <var>permissionsPolicyFeature</var>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with③\">a promise rejected with</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror③\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringDownload</var> be false.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑥\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">add the following abort steps</a> to <var>options</var>[\"<code>signal</code>\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringDownload</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>fireProgressEvent</var> be an algorithm taking one argument that does nothing.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code>monitor</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑦\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>monitor</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#createmonitor\" id=\"ref-for-createmonitor②\">CreateMonitor</a></code> created in <var>realm</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">Invoke</a> <var>options</var>[\"<code>monitor</code>\"] with « <var>monitor</var> » and \"<code>rethrow</code>\".</p>\n        <p>If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with④\">a promise rejected with</a> <var>e</var>.</p>"
            },
            {
              "html": "Set <var>fireProgressEvent</var> to an algorithm taking argument <var>loaded</var>, which performs the following steps:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③①\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②②\">in parallel</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringDownload</var> is true, then abort these steps.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#eventdef-createmonitor-downloadprogress\" id=\"ref-for-eventdef-createmonitor-downloadprogress\">downloadprogress</a></code> at <var>monitor</var>, using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#progressevent\" id=\"ref-for-progressevent\">ProgressEvent</a></code>, with the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-loaded\" id=\"ref-for-dom-progressevent-loaded\">loaded</a></code> attribute initialized to <var>loaded</var>, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-total\" id=\"ref-for-dom-progressevent-total\">total</a></code> attribute initialized to 1, and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-lengthcomputable\" id=\"ref-for-dom-progressevent-lengthcomputable\">lengthComputable</a></code> attribute initialized to true.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a> created in <var>realm</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②③\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of performing <var>getAvailability</var> given <var>options</var>.</p>"
            },
            {
              "html": "<p>Switch on <var>availability</var>:</p>"
            }
          ],
          "additional": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②③\">In parallel</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "null",
                      "html": "",
                      "rationale": "queue",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror③\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"unavailable\"",
                      "html": "",
                      "rationale": "queue",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source②\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global④\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"available\"",
                      "html": "",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, <var>fireProgressEvent</var>, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"downloading\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>availability</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable⑧\">downloadable</a></code>\", then:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "If <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑤\">global object</a> does not have <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation\">transient activation</a>, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source③\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑥\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror④\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation\" id=\"ref-for-consume-user-activation\">Consume user activation</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑦\">global object</a>.</p>"
                            },
                            {
                              "html": "<span id=\"step-download-user-interface\"></span>The user agent may display a user interface to the user to confirm that they want to perform the download operation given by <var>startDownload</var>, or to show the progress of the download. Alternately, the user agent may decide to deny the ability to perform <var>startDownload</var> based on implicit signals of the user’s intent, including the considerations in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#security-disk-space\">§ 7.1 Disk space</a>. If the user explicitly or implicitly signals that they do not want to start the download, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source④\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑧\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑤\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Let <var>startDownloadResult</var> be the result of performing <var>startDownload</var> given <var>options</var>.</p>"
                            },
                            {
                              "html": "If <var>startDownloadResult</var> is false, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑤\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑨\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "Run the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>abortedDuringDownload</var> becomes true:",
                          "rationale": "wait",
                          "steps": [
                            {
                              "html": "<p>Wait for the total number of bytes to be downloaded to become determined, and let that number be <var>totalBytes</var>.</p>\n            <p>This number must be equal to the number of bytes that the user agent needs to download at the present time, not including any that have already been downloaded.</p>\n            \n            <p>If the actual number of bytes necessary to download is 0, but the user agent is faking a download for the reasons described in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy\">§ 6 Privacy considerations</a>, then set this number to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②④\">implementation-defined</a> value that helps with the download faking.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressFraction</var> be 0.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time\">unsafe current time</a>.</p>"
                            },
                            {
                              "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
                            },
                            {
                              "html": "While true:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If downloading has failed, or the user has canceled the download, then:",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑥\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①⓪\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①④\">DOMException</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>Abort these steps.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Let <var>bytesSoFar</var> be the number of bytes downloaded so far. (Or the number of bytes fake-downloaded so far, if the user agent is faking the download.)</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③②\">Assert</a>: <var>bytesSoFar</var> is greater than or equal to 0, and less than or equal to <var>totalBytes</var>.</p>"
                                },
                                {
                                  "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock①\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time①\">unsafe current time</a> minus <var>lastProgressTime</var> is greater than 50 ms, or <var>bytesSoFar</var> equals <var>totalBytes</var>, then:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>rawProgressFraction</var> be <var>bytesSoFar</var> divided by <var>totalBytes</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>progressFraction</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/#eqn-floor\" id=\"ref-for-eqn-floor\">floor</a>(<var>rawProgressFraction</var> × 65,536) ÷ 65,536.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>progressFraction</var> is not equal to <var>lastProgressFraction</var>, then perform <var>fireProgressEvent</var> given <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>bytesSoFar</var> equals <var>totalBytes</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑨\">break</a>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressFraction</var> to <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock②\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time②\">unsafe current time</a>.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑦\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①①\">global object</a> to perform the following steps:",
                              "rationale": "assert",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③③\">Assert</a>: <var>options</var>[\"<code>signal</code>\"] is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object①\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, a no-op algorithm, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"downloadable\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>availability</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable⑧\">downloadable</a></code>\", then:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "If <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑤\">global object</a> does not have <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation\">transient activation</a>, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source③\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑥\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror④\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation\" id=\"ref-for-consume-user-activation\">Consume user activation</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑦\">global object</a>.</p>"
                            },
                            {
                              "html": "<span id=\"step-download-user-interface\"></span>The user agent may display a user interface to the user to confirm that they want to perform the download operation given by <var>startDownload</var>, or to show the progress of the download. Alternately, the user agent may decide to deny the ability to perform <var>startDownload</var> based on implicit signals of the user’s intent, including the considerations in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#security-disk-space\">§ 7.1 Disk space</a>. If the user explicitly or implicitly signals that they do not want to start the download, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source④\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑧\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑤\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Let <var>startDownloadResult</var> be the result of performing <var>startDownload</var> given <var>options</var>.</p>"
                            },
                            {
                              "html": "If <var>startDownloadResult</var> is false, then:",
                              "rationale": "queue",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑤\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑨\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "Run the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>abortedDuringDownload</var> becomes true:",
                          "rationale": "wait",
                          "steps": [
                            {
                              "html": "<p>Wait for the total number of bytes to be downloaded to become determined, and let that number be <var>totalBytes</var>.</p>\n            <p>This number must be equal to the number of bytes that the user agent needs to download at the present time, not including any that have already been downloaded.</p>\n            \n            <p>If the actual number of bytes necessary to download is 0, but the user agent is faking a download for the reasons described in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy\">§ 6 Privacy considerations</a>, then set this number to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②④\">implementation-defined</a> value that helps with the download faking.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressFraction</var> be 0.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time\">unsafe current time</a>.</p>"
                            },
                            {
                              "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
                            },
                            {
                              "html": "While true:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If downloading has failed, or the user has canceled the download, then:",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑥\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①⓪\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①④\">DOMException</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>Abort these steps.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Let <var>bytesSoFar</var> be the number of bytes downloaded so far. (Or the number of bytes fake-downloaded so far, if the user agent is faking the download.)</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③②\">Assert</a>: <var>bytesSoFar</var> is greater than or equal to 0, and less than or equal to <var>totalBytes</var>.</p>"
                                },
                                {
                                  "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock①\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time①\">unsafe current time</a> minus <var>lastProgressTime</var> is greater than 50 ms, or <var>bytesSoFar</var> equals <var>totalBytes</var>, then:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>rawProgressFraction</var> be <var>bytesSoFar</var> divided by <var>totalBytes</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>progressFraction</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/#eqn-floor\" id=\"ref-for-eqn-floor\">floor</a>(<var>rawProgressFraction</var> × 65,536) ÷ 65,536.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>progressFraction</var> is not equal to <var>lastProgressFraction</var>, then perform <var>fireProgressEvent</var> given <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>bytesSoFar</var> equals <var>totalBytes</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑨\">break</a>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressFraction</var> to <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock②\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time②\">unsafe current time</a>.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑦\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①①\">global object</a> to perform the following steps:",
                              "rationale": "assert",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③③\">Assert</a>: <var>options</var>[\"<code>signal</code>\"] is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object①\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, a no-op algorithm, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize and return an AI model object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-and-return-an-ai-model-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize and return an AI model object</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise①②\">Promise</a></code> <var>promise</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">ordered map</a> <var>options</var>, and algorithms <var>fireProgressEvent</var>, <var>initialize</var>, and <var>create</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③④\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②④\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
        },
        {
          "html": "<p>Perform <var>fireProgressEvent</var> given 1.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of performing <var>initialize</var> given <var>options</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑧\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑧\">AI task source</a> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> to perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑧\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted②\">aborted</a>, then:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason②\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "If <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑨\">error information</a>, then:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">Reject</a> <var>promise</var> with the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object\">converting error information into an exception object</a> given <var>result</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>model</var> be the result of performing <var>create</var> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> and <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑤\">Assert</a>: <var>model</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#implements\" id=\"ref-for-implements\">implements</a> an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-interface\" id=\"ref-for-dfn-interface①\">interface</a> that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#include\" id=\"ref-for-include①\">includes</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel⑥\">DestroyableModel</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-as-a-destroyable\" id=\"ref-for-initialize-as-a-destroyable①\">Initialize as a destroyable</a> <var>model</var>.</p>"
            },
            {
              "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑨\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add①\">add the following abort steps</a> to <var>options</var>[\"<code>signal</code>\"]:",
              "rationale": "destroy",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destroy\" id=\"ref-for-destroyablemodel-destroy①\">Destroy</a> <var>model</var> given <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason③\">abort reason</a>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>promise</var> with <var>model</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get an aggregated AI model result",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-an-aggregated-ai-model-result\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get an aggregated AI model result</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel⑦\">DestroyableModel</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦\">ordered map</a> <var>options</var>, and an algorithm <var>operation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑥\">Assert</a>: <var>global</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> object.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active①\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑤\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destruction-abort-controller\" id=\"ref-for-destroyablemodel-destruction-abort-controller③\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal①\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⓪\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal①\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①⓪\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted④\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑥\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason④\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add②\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a> created in <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②⑥\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be the empty string.</p>"
            },
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑥\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑨\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑨\">AI task source</a> given <var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑤\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, append <var>chunk</var> to <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①⓪\">AI task source</a> given |<var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑥\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>promise</var> with <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①⓪\">error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①①\">AI task source</a> given <var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①①\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑦\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①②\">reject</a> <var>promise</var> with the result <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object①\">converting error information into an exception object</a> given <var>errorInfo</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>abortedDuringOperation</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Perform <var>operation</var> given <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "get a streaming AI model result",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-a-streaming-ai-model-result\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a streaming AI model result</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel⑧\">DestroyableModel</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧\">ordered map</a> <var>options</var>, and an algorithm <var>operation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑦\">Assert</a>: <var>global</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window②\">Window</a></code> object.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active②\">fully active</a>, then throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑥\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destruction-abort-controller\" id=\"ref-for-destroyablemodel-destruction-abort-controller④\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal②\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-summarizersummarizeoptions-signal\" id=\"ref-for-dom-summarizersummarizeoptions-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②①\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal②\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①①\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted⑤\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑦\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑧\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add③\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>stream</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream③\">ReadableStream</a></code> created in <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>canceledDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\" id=\"ref-for-readablestream-set-up\">Set up</a> <var>stream</var> with <i><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\" id=\"ref-for-readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a></i> set to the following steps (ignoring the <var>reason</var> argument):",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>canceledDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②⑨\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑦\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①②\">AI task source</a> given <var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑨\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue\">enqueue</a> <var>chunk</var> into <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①③\">AI task source</a> given <var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error①\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①⓪\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\" id=\"ref-for-readablestream-close\">close</a> <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①①\">error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①④\">AI task source</a> given <var>global</var> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error②\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①①\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error③\">error</a> <var>stream</var> with the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object②\">converting error information into an exception object</a> given <var>errorInfo</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If either <var>abortedDuringOperation</var> or <var>canceledDuringOperation</var> are true, then return true.</p>"
                },
                {
                  "html": "<p>Return false.</p>"
                }
              ]
            },
            {
              "html": "<p>Perform <var>operation</var> given <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "measure AI model input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"measure-ai-model-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure AI model input usage</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel\" id=\"ref-for-destroyablemodel⑨\">DestroyableModel</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨\">ordered map</a> <var>options</var>, and an algorithm <var>measure</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑧\">Assert</a>: <var>global</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window③\">Window</a></code> object.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active③\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑧\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#destroyablemodel-destruction-abort-controller\" id=\"ref-for-destroyablemodel-destruction-abort-controller⑤\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal③\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②②\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal③\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①②\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted⑥\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑨\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①②\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringMeasurement</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add④\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringMeasurement</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> created in <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③①\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>stopMeasuring</var> be the following steps:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>abortedDuringMeasurement</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>result</var> be the result of performing <var>measure</var> given <var>stopMeasuring</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①⑤\">AI task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>abortedDuringMeasurement</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①③\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①③\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, if <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①②\">error information</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①④\">reject</a> <var>promise</var> with the result <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object③\">converting error information into an exception object</a> given <var>result</var>.</p>"
                },
                {
                  "html": "Otherwise,",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⑨\">Assert</a>: <var>result</var> is a number. (It is not null, since in that case <var>abortedDuringMeasurement</var> would have been true.)</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>promise</var> with <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize language tags",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"validate-and-canonicalize-language-tags\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize language tags</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪\">ordered map</a> <var>options</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑧\">string</a> <var>key</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags found in <var>options</var>[<var>key</var>], and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④⓪\">Assert</a>: <var>options</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②③\">exists</a>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[<var>key</var>] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑨\">string</a>, then set <var>options</var>[<var>key</var>] to the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag\" id=\"ref-for-validate-and-canonicalize-a-single-language-tag\">validating and canonicalizing a single language tag</a> given <var>options</var>[<var>key</var>].</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④①\">Assert</a>: <var>options</var>[<var>key</var>] either does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②④\">exist</a>, or it is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⓪\">strings</a>.</p>"
            },
            {
              "html": "<p>Let <var>languageTags</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">ordered set</a>.</p>"
            },
            {
              "html": "If <var>options</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑤\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">for each</a> <var>languageTag</var> of <var>options</var>[<var>key</var>]:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag\" id=\"ref-for-validate-and-canonicalize-a-single-language-tag①\">validating and canonicalizing a single language tag</a> given <var>languageTag</var> to <var>languageTags</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>options</var>[<var>key</var>] to <var>languageTags</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "validate and canonicalize a single language tag",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"validate and canonicalize a single language tag|validating and canonicalizing a single language tag\" data-noexport=\"\" id=\"validate-and-canonicalize-a-single-language-tag\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize a single language tag</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④①\">string</a> <var>potentialLanguageTag</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag\">IsStructurallyValidLanguageTag</a>(<var>potentialLanguageTag</var>) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-canonicalizeunicodelocaleid\" id=\"ref-for-sec-canonicalizeunicodelocaleid\">CanonicalizeUnicodeLocaleId</a>(<var>potentialLanguageTag</var>).</p>"
        }
      ]
    },
    {
      "name": "compute AI model availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-ai-model-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"compute-ai-model-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute AI model availability</dfn> given <var>options</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature④\">policy-controlled feature</a> <var>permissionsPolicyFeature</var>, an algorithm <var>validate</var>, and an algorithm <var>compute</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object\">current global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④②\">Assert</a>: <var>global</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window④\">Window</a></code> object.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated Document</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active④\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①⓪\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑧\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Perform <var>validate</var> given <var>options</var>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use①\">allowed to use</a> <var>permissionsPolicyFeature</var>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\" id=\"ref-for-a-promise-resolved-with\">a promise resolved with</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable④\">unavailable</a></code>\".</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a> created in <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm\" id=\"ref-for-concept-global-object-realm\">realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③②\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of <var>compute</var> given <var>options</var>.</p>"
            },
            {
              "html": "<p><span id=\"download-masking-step\"></span>If <var>availability</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available⑤\">available</a></code>\" or \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading②\">downloading</a></code>\", the user agent should set <var>availability</var> to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①⓪\">downloadable</a></code>\" if doing so would improve the user’s privacy, per the discussions in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#privacy-availability-masking\">§ 6.1.1 Download masking</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①⑥\">AI task source</a> given <var>global</var> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>availability</var> is null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⑤\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror④\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑨\">DOMException</a></code>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolve</a> <var>promise</var> with <var>availability</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Availability/minimum availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#availability-minimum-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Availability\" data-dfn-type=\"dfn\" data-export=\"\" id=\"availability-minimum-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">minimum availability</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability①⓪\">Availability</a></code>-or-null values <var>availabilities</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> null, then return null.</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable⑤\">unavailable</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable⑥\">unavailable</a></code>\".</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading③\">downloading</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading④\">downloading</a></code>\".</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①①\">downloadable</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①②\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available⑥\">available</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "get the language availabilities partition",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-the-language-availabilities-partition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-the-language-availabilities-partition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the language availabilities partition</dfn> given a description <var>purpose</var> of the purpose for which we’re checking language availability:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>partition</var> be «[ \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available⑧\">available</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading⑥\">downloading</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">set</a>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①④\">downloadable</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">set</a> ]».</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags②\">Unicode canonicalized locale identifier</a>, for which the user agent supports <var>purpose</var>, without performing any downloading operations:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">Append</a> <var>languageTag</var> to <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available⑨\">available</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags③\">Unicode canonicalized locale identifier</a>, for which the user agent is currently downloading material (e.g., an AI model or fine-tuning) to support <var>purpose</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">Append</a> <var>languageTag</var> to <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading⑦\">downloading</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags④\">Unicode canonicalized locale identifier</a>, for which the user agent believes it can support <var>purpose</var>, but only after performing a not-currently-ongoing download (e.g., of an AI model or fine-tuning):",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>languageTag</var> to <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①⑤\">downloadable</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④③\">Assert</a>: <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available①⓪\">available</a></code>\"], <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading⑧\">downloading</a></code>\"], and <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①⑥\">downloadable</a></code>\"] are disjoint.</p>"
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">union</a> of <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available①①\">available</a></code>\"], <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading⑨\">downloading</a></code>\"], and <var>partition</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①⑦\">downloadable</a></code>\"] does not meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules②\">language tag set completeness rules</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>missingLanguageTags</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥\">set</a> of missing language tags necessary for that union to meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules③\">language tag set completeness rules</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>languageTag</var> of <var>missingLanguageTags</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><span id=\"language-tag-completeness-implementation-defined\"></span> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑦\">Append</a> <var>languageTag</var> to one of the three sets. Which of the sets to append to is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②⑤\">implementation-defined</a>, and should be guided by considerations similar to that of <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit②\">LookupMatchingLocaleByBestFit</a> in terms of keeping \"best fallback languages\" together.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <var>partition</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "compute language availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-language-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"compute-language-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute language availability</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑦\">ordered set</a> of strings <var>requestedLanguages</var> and a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-partition\" id=\"ref-for-language-availabilities-partition③\">language availabilities partition</a> <var>partition</var>, perform the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-availability\" id=\"ref-for-enumdef-availability①①\">Availability</a></code> value, and they mutate <var>requestedLanguages</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>availability</var> be \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available①②\">available</a></code>\".</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>language</var> of <var>requestedLanguages</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>availabilityToCheck</var> of « \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-available\" id=\"ref-for-dom-availability-available①③\">available</a></code>\", \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloading\" id=\"ref-for-dom-availability-downloading①⓪\">downloading</a></code>\", \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-downloadable\" id=\"ref-for-dom-availability-downloadable①⑧\">downloadable</a></code>\" »:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>languagesWithThisAvailability</var> be <var>partition</var>[<var>availabilityToCheck</var>].</p>"
                },
                {
                  "html": "<p>Let <var>bestMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit③\">LookupMatchingLocaleByBestFit</a>(<var>languagesWithThisAvailability</var>, « <var>language</var> »).</p>"
                },
                {
                  "html": "If <var>bestMatch</var> is not undefined, then:",
                  "rationale": "replace",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace\">Replace</a> <var>language</var> with <var>bestMatch</var>.[[locale]] in <var>requestedLanguages</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>availability</var> to the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#availability-minimum-availability\" id=\"ref-for-availability-minimum-availability③\">minimum availability</a> given <var>availability</var> and <var>availabilityToCheck</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①⓪\">Break</a>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-availability-unavailable\" id=\"ref-for-dom-availability-unavailable⑦\">unavailable</a></code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>availability</var>.</p>"
        }
      ]
    },
    {
      "name": "convert error information into an exception object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"convert-error-information-into-an-exception-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert error information into an exception object</dfn>, given an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①③\">error information</a> <var>errorInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>errorInfo</var> is a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information①⓪\">DOMException error information</a>, then return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②②\">DOMException</a></code> with name given by <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name③\">name</a>, using <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details③\">details</a> to populate the message appropriately.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④④\">Assert</a>: <var>error</var> is a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information⑦\">quota exceeded error information</a>.</p>"
            },
            {
              "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror\" id=\"ref-for-quotaexceedederror②\">QuotaExceededError</a></code> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested④\">requested</a> is <var>error</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested③\">requested</a> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota④\">quota</a> is <var>error</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota③\">quota</a>.</p>"
            }
          ]
        }
      ]
    }
  ]
}