{
  "spec": {
    "title": "Protected Audience (formerly FLEDGE)",
    "url": "https://wicg.github.io/turtledove/"
  },
  "algorithms": [
    {
      "name": "joinAdInterestGroup()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-joinadinterestgroup\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>joinAdInterestGroup(<var>group</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-lifetimems\" id=\"ref-for-dom-auctionadinterestgroup-lifetimems①\">lifetimeMs</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>.</p>"
        }
      ]
    },
    {
      "name": "joinAdInterestGroup()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-joinadinterestgroup",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-joinadinterestgroup\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>joinAdInterestGroup(<var>group</var>)</code></dfn> method steps are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the \"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#join-ad-interest-group\" id=\"ref-for-join-ad-interest-group\">join-ad-interest-group</a>\" <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature\">policy-controlled feature</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>frameOrigin</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin\">origin</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a> that <var>frameOrigin</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque\">opaque origin</a> and its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme\">scheme</a> is \"<code>https</code>\".</p>"
        },
        {
          "html": "<p>Let <var>interestGroup</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①\">interest group</a>.</p>"
        },
        {
          "html": "Validate the given <var>group</var> and set <var>interestGroup</var>’s fields accordingly.",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry\">expiry</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time\">current wall time</a> plus <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-lifetimems\" id=\"ref-for-dom-auctionadinterestgroup-lifetimems②\">lifetimeMs</a></code>\"] milliseconds.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-next-update-after\" id=\"ref-for-interest-group-next-update-after\">next update after</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①\">current wall time</a> plus 24\nhours.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-last-updated\" id=\"ref-for-interest-group-last-updated\">last updated</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time②\">current wall time</a>.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①\">owner</a> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin\">parsing an https origin</a> on <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-owner\" id=\"ref-for-dom-generatebidinterestgroup-owner\">owner</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②\">owner</a> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Optionally, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①\">name</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-name\" id=\"ref-for-dom-generatebidinterestgroup-name\">name</a></code>\"].</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority\">priority</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-priority\" id=\"ref-for-dom-auctionadinterestgroup-priority\">priority</a></code>\"].</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-enable-bidding-signals-prioritization\" id=\"ref-for-interest-group-enable-bidding-signals-prioritization\">enable bidding signals prioritization</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-enablebiddingsignalsprioritization\" id=\"ref-for-dom-generatebidinterestgroup-enablebiddingsignalsprioritization\">enableBiddingSignalsPrioritization</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-priorityvector\" id=\"ref-for-dom-generatebidinterestgroup-priorityvector\">priorityVector</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>, then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-vector\" id=\"ref-for-interest-group-priority-vector\">priority vector</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-priorityvector\" id=\"ref-for-dom-generatebidinterestgroup-priorityvector①\">priorityVector</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-prioritysignalsoverrides\" id=\"ref-for-dom-auctionadinterestgroup-prioritysignalsoverrides\">prioritySignalsOverrides</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>, then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides\">priority signals overrides</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-prioritysignalsoverrides\" id=\"ref-for-dom-auctionadinterestgroup-prioritysignalsoverrides①\">prioritySignalsOverrides</a></code>\"].</p>"
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-sellercapabilities\" id=\"ref-for-dom-generatebidinterestgroup-sellercapabilities\">sellerCapabilities</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">for each</a> <var>sellerString</var> → <var>capabilities</var> of <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-sellercapabilities\" id=\"ref-for-dom-generatebidinterestgroup-sellercapabilities①\">sellerCapabilities</a></code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>sellerCapabilities</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#seller-capability\" id=\"ref-for-seller-capability\">seller capabilities</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>capabilityString</var> of <var>capabilities</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>capabilityString</var> is \"<code>interest-group-counts</code>\" or \"<code>latency-stats</code>\", then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">append</a> <var>capabilityString</var> to <var>sellerCapabilities</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>sellerString</var> is \"<code>*</code>\", then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-all-sellers-capabilities\" id=\"ref-for-interest-group-all-sellers-capabilities\">all sellers capabilities</a> to <var>sellerCapabilities</var>.</p>"
                },
                {
                  "html": "Otherwise:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities\">seller capabilities</a> is null, then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities①\">seller capabilities</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">sets</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#seller-capability\" id=\"ref-for-seller-capability①\">seller capabilities</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>sellerUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">URL parser</a> on <var>sellerString</var>.</p>"
                    },
                    {
                      "html": "If <var>sellerUrl</var> is not failure:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>seller</var> be <var>sellerUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a>.</p>"
                        },
                        {
                          "html": "<p>If <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities②\">seller capabilities</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">contain</a> <var>seller</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">set</a> <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities③\">seller capabilities</a>[<var>seller</var>] to <var>sellerCapabilities</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-executionmode\" id=\"ref-for-dom-generatebidinterestgroup-executionmode\">executionMode</a></code>\"] is \"<code>compatibility</code>\",\n\"<code>frozen-context</code>\", or \"<code>group-by-origin</code>\", then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-execution-mode\" id=\"ref-for-interest-group-execution-mode\">execution mode</a> to it.</p>"
            },
            {
              "html": "For each <var>groupMember</var> and <var>interestGroupField</var> in the following table",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>group</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">contains</a> <var>groupMember</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>parsedUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-bidding-code-or-update-url\" id=\"ref-for-parse-and-verify-a-bidding-code-or-update-url\">parse and verify a bidding code or update URL</a> on <var>group</var>[<var>groupMember</var>] and <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④\">owner</a>.</p>"
                    },
                    {
                      "html": "<p>If <var>parsedUrl</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p>Set <var>interestGroup</var>’s <var>interestGroupField</var> to <var>parsedUrl</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsurl\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsurl\">trustedBiddingSignalsURL</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>parsedUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-trusted-signals-url\" id=\"ref-for-parse-and-verify-a-trusted-signals-url\">parse and verify a trusted signals URL</a> on <var>group</var>[<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsurl\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsurl①\">trustedBiddingSignalsURL</a></code>].</p>"
                },
                {
                  "html": "<p>If <var>parsedUrl</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④\">TypeError</a></code>.</p>"
                },
                {
                  "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-url\" id=\"ref-for-interest-group-trusted-bidding-signals-url\">trusted bidding signals url</a> to <var>parsedUrl</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalskeys\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalskeys\">trustedBiddingSignalsKeys</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>, then set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys\">trusted bidding signals keys</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalskeys\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalskeys①\">trustedBiddingSignalsKeys</a></code>\"].</p>"
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength\" id=\"ref-for-dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength\">maxTrustedBiddingSignalsURLLength</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength\" id=\"ref-for-dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength①\">maxTrustedBiddingSignalsURLLength</a></code>\"] ≥ 0, set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length\">max trusted bidding signals url length</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength\" id=\"ref-for-dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength②\">maxTrustedBiddingSignalsURLLength</a></code>\"], otherwise <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑤\">TypeError</a></code>.</p>"
                }
              ]
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-userbiddingsignals\" id=\"ref-for-dom-generatebidinterestgroup-userbiddingsignals\">userBiddingSignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-user-bidding-signals\" id=\"ref-for-interest-group-user-bidding-signals\">user bidding signals</a> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string\">serializing a JavaScript value to a JSON string</a>, given <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-userbiddingsignals\" id=\"ref-for-dom-generatebidinterestgroup-userbiddingsignals①\">userBiddingSignals</a></code>\"]. This can <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑦\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑥\">TypeError</a></code>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode\">trustedBiddingSignalsSlotSizeMode</a></code>\"] is one of \"none\",\n\"slot-size\", or \"all-slots-requested-sizes\", set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode\">trusted bidding signals slot size mode</a> to <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode①\">trustedBiddingSignalsSlotSizeMode</a></code>\"].</p>"
            },
            {
              "html": "<p>Let <var>adSizes</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string\">strings</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size\">ad sizes</a>.</p>"
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-adsizes\" id=\"ref-for-dom-generatebidinterestgroup-adsizes\">adSizes</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exists</a>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">For each</a> <var>sizeName</var> → <var>size</var> of <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-adsizes\" id=\"ref-for-dom-generatebidinterestgroup-adsizes①\">adSizes</a></code>\"]:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>sizeName</var> is \"\", <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑦\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p>Let <var>parsedSize</var> be the result from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-ad-size\" id=\"ref-for-parse-an-adrender-ad-size\">parse an AdRender ad size</a> with <var>size</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>parsedSize</var> is null, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑨\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑧\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">Set</a> <var>adSizes</var>[<var>sizeName</var>] to <var>parsedSize</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-sizes\" id=\"ref-for-interest-group-ad-sizes\">ad sizes</a> to <var>adSizes</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>sizeGroups</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①\">strings</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">lists</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②\">strings</a></p>"
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-sizegroups\" id=\"ref-for-dom-generatebidinterestgroup-sizegroups\">sizeGroups</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exists</a>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②\">For each</a> <var>sizeGroupName</var> → <var>sizeList</var> of <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-sizegroups\" id=\"ref-for-dom-generatebidinterestgroup-sizegroups①\">sizeGroups</a></code>\"]:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>sizeGroupName</var> is \"\", <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑨\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>sizeName</var> of <var>sizeList</var>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>sizeName</var> is \"\" or <var>adSizes</var>[<var>sizeName</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exist</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⓪\">TypeError</a></code>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">Set</a> <var>sizeGroups</var>[<var>sizeGroupName</var>] to <var>sizeList</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-size-groups\" id=\"ref-for-interest-group-size-groups\">size groups</a> to <var>sizeGroups</var>.</p>"
                }
              ]
            },
            {
              "html": "For each <var>groupMember</var> and <var>interestGroupField</var> in the following table",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>group</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">contains</a> <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">for each</a> <var>ad</var> of <var>group</var>[<var>groupMember</var>]:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>igAd</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad\">interest group ad</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>renderURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①\">URL parser</a> on <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-renderurl\" id=\"ref-for-dom-auctionad-renderurl\">renderURL</a></code>\"].</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①②\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①①\">TypeError</a></code> if any of the following conditions hold:</p>\n            <ul>\n             <li data-md=\"\">\n              <p><var>renderURL</var> is failure;</p>\n             </li><li data-md=\"\">\n              <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> is not \"<code>https</code>\";</p>\n             </li><li data-md=\"\">\n              <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials\">includes credentials</a>.</p>\n            </li></ul>"
                    },
                    {
                      "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url\">render url</a> to <var>renderURL</var>.</p>"
                    },
                    {
                      "html": "If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup\">sizeGroup</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exists</a>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>sizeGroup</var> be <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup①\">sizeGroup</a></code>}].</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①③\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①②\">TypeError</a></code> if none of the following conditions hold:</p>\n              <ul>\n               <li data-md=\"\">\n                <p><var>adSizes</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a>.</p>\n               </li><li data-md=\"\">\n                <p><var>sizeGroups</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑥\">exists</a>.</p>\n              </li></ul>"
                        },
                        {
                          "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group\">size group</a> to <var>sizeGroup</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata\">metadata</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑦\">exists</a>, then let <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata\">metadata</a> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string①\">serializing a JavaScript value to a JSON string</a>, given <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata①\">metadata</a></code>\"].\nThis can <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①③\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "If <var>groupMember</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-ads\" id=\"ref-for-dom-generatebidinterestgroup-ads①\">ads</a></code>\":",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerreportingid\" id=\"ref-for-dom-auctionad-buyerreportingid\">buyerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑧\">exists</a>, then set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id\">buyer reporting ID</a> to it.</p>"
                        },
                        {
                          "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerandsellerreportingid\" id=\"ref-for-dom-auctionad-buyerandsellerreportingid\">buyerAndSellerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑨\">exists</a>,\nthen set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id\">buyer and seller reporting ID</a> to it.</p>"
                        },
                        {
                          "html": "If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-allowedreportingorigins\" id=\"ref-for-dom-auctionad-allowedreportingorigins\">allowedReportingOrigins</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⓪\">exists</a>:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>allowedReportingOrigins</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a> of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①\">origins</a>.</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>originStr</var> in <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-allowedreportingorigins\" id=\"ref-for-dom-auctionad-allowedreportingorigins①\">allowedReportingOrigins</a></code>\"]:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>origin</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①\">parsing an https origin</a> on <var>originStr</var>.</p>"
                                },
                                {
                                  "html": "<p>If <var>origin</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①④\">TypeError</a></code>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>origin</var> to <var>allowedReportingOrigins</var>.</p>"
                                },
                                {
                                  "html": "<p>If <var>allowedReportingOrigins</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> &gt; 10, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑤\">TypeError</a></code>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-allowed-reporting-origins\" id=\"ref-for-interest-group-ad-allowed-reporting-origins\">allowed reporting origins</a> to <var>allowedReportingOrigins</var>.</p>"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>igAd</var> to <var>interestGroup</var>’s <var>interestGroupField</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-additionalbidkey\" id=\"ref-for-dom-auctionadinterestgroup-additionalbidkey\">additionalBidKey</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②①\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>decodedKey</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode\">forgiving-base64 decode</a> with <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroup-additionalbidkey\" id=\"ref-for-dom-auctionadinterestgroup-additionalbidkey①\">additionalBidKey</a></code>\"].</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑦\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑥\">TypeError</a></code> if any of the following conditions hold:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>decodedKey</var> is a failure;</p>\n           </li><li data-md=\"\">\n            <p><var>decodedKey</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length\">length</a> is not 32;</p>\n           </li><li data-md=\"\">\n            <p><var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-ads\" id=\"ref-for-dom-generatebidinterestgroup-ads②\">ads</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②②\">exists</a>;</p>\n           </li><li data-md=\"\">\n            <p><var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-updateurl\" id=\"ref-for-dom-generatebidinterestgroup-updateurl①\">updateURL</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②③\">exists</a>.</p>\n          </li></ul>"
                },
                {
                  "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key\">additional bid key</a> to <var>decodedKey</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-estimated-size\" id=\"ref-for-interest-group-estimated-size\">estimated size</a> &gt; 1048576 bytes, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑦\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue\">starting a new parallel queue</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps\">Enqueue the following steps</a> to <var>queue</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>permission</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-interest-group-permissions\" id=\"ref-for-check-interest-group-permissions\">checking interest group permissions</a> with <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤\">owner</a>, <var>frameOrigin</var>, and \"<code>join</code>\".</p>"
            },
            {
              "html": "<p>If <var>permission</var> is false, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source\">DOM manipulation task source</a>,\ngiven <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>p</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror②\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> and abort these\nsteps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①\">DOM manipulation task source</a>, given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">resolve</a> <var>p</var> with <code>undefined</code>.</p>"
            },
            {
              "html": "<p>If the browser is currently storing an interest group with <code>owner</code> and <code>name</code> that matches <var>interestGroup</var>, then set the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bid-counts\" id=\"ref-for-interest-group-bid-counts\">bid counts</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-counts\" id=\"ref-for-interest-group-join-counts\">join counts</a>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-previous-wins\" id=\"ref-for-interest-group-previous-wins\">previous wins</a> of <var>interestGroup</var> to the values of the currently stored one and remove\nthe currently stored one from the browser.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-joining-origin\" id=\"ref-for-interest-group-joining-origin\">joining origin</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin\">top-level origin</a>.</p>"
            },
            {
              "html": "<p>Set <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-time\" id=\"ref-for-interest-group-join-time\">join time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time③\">current wall time</a>.</p>"
            },
            {
              "html": "<p>If the most recent entry in <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-counts\" id=\"ref-for-interest-group-join-counts①\">join counts</a> corresponds to\nthe current day in UTC, increment its count. If not, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-insert\" id=\"ref-for-list-insert\">insert</a> a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple\">tuple</a> the time set to the current UTC day and a count of 1.</p>"
            },
            {
              "html": "<p>Store <var>interestGroup</var> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①\">interest group set</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-interest-group\" id=\"ref-for-update-k-anonymity-cache-for-interest-group\">update k-anonymity cache for interest group</a> for <var>interestGroup</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "perform storage maintenance",
      "href": "https://wicg.github.io/turtledove/#perform-storage-maintenance",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"perform-storage-maintenance\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">perform storage maintenance</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>ownersAndExpiry</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys③\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②\">origins</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values③\">values</a> are <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment\">moments</a>.</p>"
        },
        {
          "html": "<p>Let <var>now</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time④\">current wall time</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>ig</var> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑨\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set⑨\">interest group set</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>owner</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①④\">owner</a>.</p>"
            },
            {
              "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry③\">expiry</a> is before <var>now</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">remove</a> <var>ig</var> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⓪\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⓪\">interest group set</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>ownersAndExpiry</var>[<var>owner</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②④\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">set</a> <var>ownersAndExpiry</var>[<var>owner</var>] to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry④\">expiry</a> if it comes after <var>ownersAndExpiry</var>[<var>owner</var>].</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">set</a> <var>ownersAndExpiry</var>[<var>owner</var>] to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry⑤\">expiry</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>ownersAndExpiry</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size\">size</a> &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set-max-owners\" id=\"ref-for-interest-group-set-max-owners①\">interest group set max owners</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤\">set</a> <var>ownersAndExpiry</var> to <var>ownersAndExpiry</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-sort-in-descending-order\" id=\"ref-for-map-sort-in-descending-order\">sorted in descending order</a> with <var>a</var> being less than <var>b</var> if <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-value\" id=\"ref-for-map-value①\">value</a> comes before <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-value\" id=\"ref-for-map-value②\">value</a>, where <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑤\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry⑥\">expiry</a>.</p>"
        },
        {
          "html": "<p>Let <var>owners</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys④\">keys</a> of <var>ownersAndExpiry</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range\">the range</a> from 0 to <var>owners</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a>, exclusive:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>i</var> ≥ <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set-max-owners\" id=\"ref-for-interest-group-set-max-owners②\">interest group set max owners</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">remove</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group⑥\">interest groups</a> from\nthe <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①①\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①①\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①⑤\">owner</a> is <var>owners</var>[<var>i</var>], and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>regularIgs</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#regular-interest-group\" id=\"ref-for-regular-interest-group②\">regular interest groups</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①②\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①②\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①⑥\">owner</a> is <var>owners</var>[<var>i</var>].</p>"
            },
            {
              "html": "<p>If <var>regularIgs</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②\">size</a> &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#max-regular-interest-groups-per-owner\" id=\"ref-for-max-regular-interest-groups-per-owner\">max regular interest groups per owner</a>, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#clear-excess-interest-groups\" id=\"ref-for-clear-excess-interest-groups\">clear excess interest groups</a> with <var>regularIgs</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#max-regular-interest-groups-per-owner\" id=\"ref-for-max-regular-interest-groups-per-owner①\">max regular interest groups per owner</a>.</p>"
            },
            {
              "html": "<p>Let <var>negativeIgs</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-interest-group\" id=\"ref-for-negative-interest-group②\">negative interest groups</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①③\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①③\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①⑦\">owner</a> is <var>owners</var>[<var>i</var>].</p>"
            },
            {
              "html": "<p>If <var>negativeIgs</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size③\">size</a> &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#max-negative-interest-groups-per-owner\" id=\"ref-for-max-negative-interest-groups-per-owner\">max negative interest groups per owner</a>, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#clear-excess-interest-groups\" id=\"ref-for-clear-excess-interest-groups①\">clear excess interest groups</a> with <var>negativeIgs</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#max-negative-interest-groups-per-owner\" id=\"ref-for-max-negative-interest-groups-per-owner①\">max negative interest groups per owner</a>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>owner</var> of <var>owners</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>igs</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group⑦\">interest groups</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①④\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①④\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①⑧\">owner</a> is <var>owner</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-descending-order\" id=\"ref-for-list-sort-in-descending-order\">sorted in descending order</a> with <var>a</var> being\nless than <var>b</var> if <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry⑦\">expiry</a> comes before <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry⑧\">expiry</a>.</p>"
            },
            {
              "html": "<p>Let <var>cumulativeSize</var> be 0.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>ig</var> of <var>igs</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If the sum of <var>cumulativeSize</var> and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-estimated-size\" id=\"ref-for-interest-group-estimated-size②\">estimated size</a> &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#max-interest-groups-total-size-per-owner\" id=\"ref-for-max-interest-groups-total-size-per-owner\">max interest groups total size per owner</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">remove</a> <var>ig</var> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⑤\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⑤\">interest group set</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, increment <var>cumulativeSize</var> by <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-estimated-size\" id=\"ref-for-interest-group-estimated-size③\">estimated size</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "clear excess interest groups",
      "href": "https://wicg.github.io/turtledove/#clear-excess-interest-groups",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-excess-interest-groups\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear excess interest groups</dfn> with a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group⑧\">interest groups</a> <var>igs</var>, and an\ninteger <var>maxIgs</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>sortedIgs</var> be <var>igs</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-descending-order\" id=\"ref-for-list-sort-in-descending-order①\">sorted in descending order</a> with <var>a</var> being less\nthan <var>b</var> if <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry⑨\">expiry</a> comes before <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-expiry\" id=\"ref-for-interest-group-expiry①⓪\">expiry</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range①\">the range</a> from <var>maxIgs</var> to <var>igs</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size④\">size</a>, exclusive:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove④\">Remove</a> <var>sortedIgs</var>[<var>i</var>] from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⑥\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⑥\">interest group set</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Navigator/leaveAdInterestGroup(group)",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-leaveadinterestgroup",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"leaveAdInterestGroup(group)|leaveAdInterestGroup()\" id=\"dom-navigator-leaveadinterestgroup\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>leaveAdInterestGroup(group)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>frameOrigin</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin①\">origin</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a> that <var>frameOrigin</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque①\">opaque origin</a> and its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme①\">scheme</a> is \"<code>https</code>\".</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>.</p>"
        },
        {
          "html": "If <var>group</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty\">is empty</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>instance</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#browsing-context-fenced-frame-config-instance\" id=\"ref-for-browsing-context-fenced-frame-config-instance\">fenced frame config instance</a>.</p>"
            },
            {
              "html": "<p>If <var>instance</var> is null, then return.</p>"
            },
            {
              "html": "<p>Let <var>interestGroup</var> be <var>instance</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-instance-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-instance-interest-group-descriptor\">interest group descriptor</a>.</p>"
            },
            {
              "html": "Run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source②\">DOM manipulation task source</a>, given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>p</var> with <code>undefined</code>.</p>"
                },
                {
                  "html": "If <var>interestGroup</var> is not null:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>owner</var> be <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-owner\" id=\"ref-for-interest-group-descriptor-owner\">owner</a>.</p>"
                    },
                    {
                      "html": "<p>If <var>owner</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a> with <var>frameOrigin</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑤\">remove</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group⑨\">interest groups</a> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⑦\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⑦\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner①⑨\">owner</a> is <var>owner</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②\">name</a> is <var>interestGroup</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-name\" id=\"ref-for-interest-group-descriptor-name\">name</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use①\">allowed to use</a> the\n\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#join-ad-interest-group\" id=\"ref-for-join-ad-interest-group①\">join-ad-interest-group</a>\" <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature①\">policy-controlled feature</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑨\">throw</a> a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror③\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>owner</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin②\">parsing an https origin</a> with <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroupkey-owner\" id=\"ref-for-dom-auctionadinterestgroupkey-owner\">owner</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>owner</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑧\">TypeError</a></code>.</p>"
            },
            {
              "html": "Run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>permission</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-interest-group-permissions\" id=\"ref-for-check-interest-group-permissions①\">checking interest group permissions</a> with <var>owner</var>, <var>frameOrigin</var>, and \"<code>leave</code>\".</p>"
                },
                {
                  "html": "<p>If <var>permission</var> is false, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source③\">DOM manipulation task source</a>,\ngiven <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>p</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror④\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code> and abort\nthese steps.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source④\">DOM manipulation task source</a>, given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">resolve</a> <var>p</var> with <code>undefined</code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑥\">Remove</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⓪\">interest groups</a> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⑧\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⑧\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⓪\">owner</a> is <var>owner</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name③\">name</a> is <var>group</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadinterestgroupkey-name\" id=\"ref-for-dom-auctionadinterestgroupkey-name\">name</a></code>\"].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "Navigator/clearOriginJoinedAdInterestGroups(owner, interestGroupsToKeep)",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-clearoriginjoinedadinterestgroups",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"clearOriginJoinedAdInterestGroups(owner, interestGroupsToKeep)|clearOriginJoinedAdInterestGroups(owner)\" id=\"dom-navigator-clearoriginjoinedadinterestgroups\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>clearOriginJoinedAdInterestGroups(<var>owner</var>, <var>interestGroupsToKeep</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>frameOrigin</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object④\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin②\">origin</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a> that <var>frameOrigin</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque②\">opaque origin</a> and its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme②\">scheme</a> is \"<code>https</code>\".</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use②\">allowed to use</a> the\n\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#join-ad-interest-group\" id=\"ref-for-join-ad-interest-group②\">join-ad-interest-group</a>\" <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature②\">policy-controlled feature</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②①\">throw</a> a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑤\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>ownerOrigin</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin③\">parsing an https origin</a> with <var>owner</var>.</p>"
        },
        {
          "html": "<p>If <var>ownerOrigin</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑨\">TypeError</a></code>.</p>"
        },
        {
          "html": "Run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>permission</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-interest-group-permissions\" id=\"ref-for-check-interest-group-permissions②\">checking interest group permissions</a> with <var>ownerOrigin</var>, <var>frameOrigin</var>, and \"<code>leave</code>\".</p>"
            },
            {
              "html": "<p>If <var>permission</var> is false, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑤\">DOM manipulation task source</a> given <var>global</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>p</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑥\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code> and abort these steps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑥\">DOM manipulation task source</a> given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">resolve</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined③\">undefined</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑦\">Remove</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①②\">interest groups</a> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⑨\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set①⑨\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②①\">owner</a> is <var>ownerOrigin</var>, whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-joining-origin\" id=\"ref-for-interest-group-joining-origin②\">joining origin</a> is <var>frameOrigin</var>, and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name④\">name</a> is not in <var>interestGroupsToKeep</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "runAdAuction()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-runadauction",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-runadauction\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>runAdAuction(<var>config</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>settings</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑤\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use③\">allowed to use</a> the \"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#run-ad-auction\" id=\"ref-for-run-ad-auction\">run-ad-auction</a>\" <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature③\">policy-controlled feature</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②③\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑦\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>auctionConfig</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config\" id=\"ref-for-validate-and-convert-auction-ad-config\">validate and convert auction ad config</a> with <var>config</var> and true.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⓪\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Optionally, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑤\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑧\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>configMapping</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated Document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-traversable\" id=\"ref-for-nav-traversable\">traversable navigable</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#traversable-navigable-fenced-frame-config-mapping\" id=\"ref-for-traversable-navigable-fenced-frame-config-mapping\">fenced frame config mapping</a>.</p>"
        },
        {
          "html": "<p>Let <var>pendingConfig</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#construct-a-pending-fenced-frame-config\" id=\"ref-for-construct-a-pending-fenced-frame-config\">constructing a pending fenced frame config</a> with <var>auctionConfig</var>.</p>"
        },
        {
          "html": "<p>Let <var>urn</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-store-a-pending-config\" id=\"ref-for-fenced-frame-config-mapping-store-a-pending-config\">store a pending config</a> on <var>configMapping</var> with <var>pendingConfig</var>.</p>"
        },
        {
          "html": "<p>If <var>urn</var> is failure, then resolve <var>p</var> with null and return <var>p</var>.</p>"
        },
        {
          "html": "<p>Let <var>bidIgs</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①③\">interest groups</a>.</p>"
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-signal\" id=\"ref-for-dom-auctionadconfig-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑤\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>signal</var> be <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-signal\" id=\"ref-for-dom-auctionadconfig-signal①\">signal</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>signal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>p</var> with <var>signal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a> and return <var>p</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">Add the following abort steps</a> to <var>signal</var>:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">Reject</a> <var>p</var> with <var>signal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-bid-count\" id=\"ref-for-update-bid-count\">update bid counts</a> with <var>bidIgs</var>.</p>"
                },
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update\" id=\"ref-for-interest-group-update\">interest group update</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers\" id=\"ref-for-auction-config-interest-group-buyers\">interest group buyers</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>frameOrigin</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin③\">origin</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a> that <var>frameOrigin</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque③\">opaque origin</a> and its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme③\">scheme</a> is \"<code>https</code>\".</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue①\">starting a new parallel queue</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps①\">Enqueue the following steps</a> to <var>queue</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bidDebugReportInfoList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info\">bid debug reporting info</a>.</p>"
            },
            {
              "html": "If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-server-response\" id=\"ref-for-auction-config-server-response\">server response</a> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>winnerInfo</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-validate-server-response\" id=\"ref-for-parse-and-validate-server-response\">parse and validate server response</a> with <var>auctionConfig</var>,\nnull, <var>global</var>, <var>bidIgs</var>, and <var>bidDebugReportInfoList</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realTimeContributionsMap</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map\">real time reporting contributions map</a>.</p>"
                },
                {
                  "html": "<p>Let <var>winnerInfo</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generate-and-score-bids\" id=\"ref-for-generate-and-score-bids\">generate and score bids</a> with <var>auctionConfig</var>,\nnull, <var>global</var>, <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin②\">top-level origin</a>, <var>bidIgs</var>, <var>bidDebugReportInfoList</var>, and <var>realTimeContributionsMap</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>auctionReportInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info\" id=\"ref-for-auction-report-info\">auction report info</a>.</p>"
            },
            {
              "html": "If <var>winnerInfo</var> is not failure, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionReportInfo</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-fordebuggingonly-reports\" id=\"ref-for-collect-fordebuggingonly-reports\">collect forDebuggingOnly reports</a> with <var>bidDebugReportInfoList</var> and <var>winnerInfo</var>.</p>"
                },
                {
                  "html": "<p>Set <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-real-time-reporting-contributions-map\" id=\"ref-for-auction-report-info-real-time-reporting-contributions-map\">real time reporting contributions map</a> to <var>realTimeContributionsMap</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>winnerInfo</var> is failure, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑦\">DOM manipulation task source</a>,\ngiven <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">reject</a> <var>p</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②①\">TypeError</a></code>\".</p>"
            },
            {
              "html": "Otherwise if <var>winnerInfo</var> is null or <var>winnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid\">leading bid</a> is null:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑧\">Queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑧\">DOM manipulation task source</a>, given <var>global</var>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve④\">resolve</a> <var>p</var> with null.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">For each</a> <var>reportUrl</var> of <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls\">debug loss report urls</a>:",
                  "rationale": "send",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report\">Send report</a> with <var>reportUrl</var> and <var>frameOrigin</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-real-time-reports\" id=\"ref-for-send-real-time-reports\">Send real time reports</a> with <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-real-time-reporting-contributions-map\" id=\"ref-for-auction-report-info-real-time-reporting-contributions-map①\">real time reporting contributions map</a> and <var>frameOrigin</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>winner</var> be <var>winnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①\">leading bid</a>.</p>"
                },
                {
                  "html": "<p>Let <var>fencedFrameConfig</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fill-in-a-pending-fenced-frame-config\" id=\"ref-for-fill-in-a-pending-fenced-frame-config\">filling in a pending fenced frame config</a> with <var>pendingConfig</var>, <var>auctionConfig</var>, <var>winnerInfo</var>, <var>auctionReportInfo</var>, and <var>frameOrigin</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapping-finalize-a-pending-config\" id=\"ref-for-fenced-frame-config-mapping-finalize-a-pending-config\">Finalize a pending config</a> on <var>configMapping</var> with <var>urn</var> and <var>fencedFrameConfig</var>.</p>"
                },
                {
                  "html": "<p>Wait until <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-resolve-to-config\" id=\"ref-for-auction-config-resolve-to-config\">resolve to config</a> is a boolean.</p>"
                },
                {
                  "html": "<p>Let <var>result</var> be <var>fencedFrameConfig</var>.</p>"
                },
                {
                  "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-resolve-to-config\" id=\"ref-for-auction-config-resolve-to-config①\">resolve to config</a> is false, then set <var>result</var> to <var>urn</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑨\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑨\">DOM manipulation task source</a>, given <var>global</var>, to\n resolve <var>p</var> with <var>result</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update\" id=\"ref-for-interest-group-update①\">interest group update</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers\" id=\"ref-for-auction-config-interest-group-buyers①\">interest group buyers</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-bid-count\" id=\"ref-for-update-bid-count①\">update bid counts</a> with <var>bidIgs</var>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-previous-wins\" id=\"ref-for-update-previous-wins\">update previous wins</a> with <var>winner</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "construct a pending fenced frame config",
      "href": "https://wicg.github.io/turtledove/#construct-a-pending-fenced-frame-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"construct-a-pending-fenced-frame-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">construct a pending fenced frame config</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config\">auction config</a> <var>config</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config\">fenced frame config</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url\">mapped url</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p><code>\"about:blank\"</code></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-visibility\" id=\"ref-for-mapped-url-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque\"><code>opaque</code></a>\"</p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-container-size\" id=\"ref-for-fenced-frame-config-container-size\">container size</a>\n       </dt><dd data-md=\"\">\n        <p>the result of</p>\n      </dd></dl>\n      \n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size\">content size</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor\">interest group descriptor</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-value\" id=\"ref-for-interest-group-descriptor-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct②\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item③\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-owner\" id=\"ref-for-interest-group-descriptor-owner①\">owner</a>\n           </dt><dd data-md=\"\">\n            <p>\"\"</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-name\" id=\"ref-for-interest-group-descriptor-name①\">name</a>\n           </dt><dd data-md=\"\">\n            <p>\"\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-visibility\" id=\"ref-for-interest-group-descriptor-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque①\"><code>opaque</code></a>\"</p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback\">on navigate callback</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags\">effective sandboxing flags</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct③\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item④\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p>TODO: fill this in once fenced frame sandbox flags are more fully specified</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-visibility\" id=\"ref-for-effective-sandboxing-flags-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque②\"><code>opaque</code></a>\"</p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions\">effective enabled permissions</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct④\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑤\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-value\" id=\"ref-for-effective-enabled-permissions-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p>«\"<code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-permissionpolicy-attribution-reporting\" id=\"ref-for-dom-permissionpolicy-attribution-reporting\">attribution-reporting</a></code></code>\",\n  \"<code><a data-link-type=\"dfn\" href=\"https://patcg-individual-drafts.github.io/private-aggregation-api#private-aggregation\" id=\"ref-for-private-aggregation\">private-aggregation</a></code>\", \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/shared-storage#permissionspolicy-shared-storage\" id=\"ref-for-permissionspolicy-shared-storage\">shared-storage</a></code>\",\n  \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/shared-storage#permissionspolicy-shared-storage-select-url\" id=\"ref-for-permissionspolicy-shared-storage-select-url\">shared-storage-select-url</a></code>\"»</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-visibility\" id=\"ref-for-effective-enabled-permissions-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque③\"><code>opaque</code></a>\"</p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-fenced-frame-reporting-metadata\" id=\"ref-for-fenced-frame-config-fenced-frame-reporting-metadata\">fenced frame reporting metadata</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-exfiltration-budget-metadata\" id=\"ref-for-fenced-frame-config-exfiltration-budget-metadata\">exfiltration budget metadata</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-nested-configs\" id=\"ref-for-fenced-frame-config-nested-configs\">nested configs</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑤\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑥\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-value\" id=\"ref-for-nested-configs-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p>an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a> «»</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-visibility\" id=\"ref-for-nested-configs-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque④\"><code>opaque</code></a>\"</p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context\">embedder shared storage context</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "fill in a pending fenced frame config",
      "href": "https://wicg.github.io/turtledove/#fill-in-a-pending-fenced-frame-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fill-in-a-pending-fenced-frame-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fill in a pending fenced frame config</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config①\">fenced frame config</a> <var>pendingConfig</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①\">auction config</a> <var>auctionConfig</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info\">leading bid info</a> <var>winningBidInfo</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info\" id=\"ref-for-auction-report-info①\">auction report info</a> <var>auctionReportInfo</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>winningBid</var> be <var>winningBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②\">leading bid</a>.</p>"
        },
        {
          "html": "<p>Let <var>replacements</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑤\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑥\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">strings</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>replacement</var> in <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements\">deprecated render url replacements</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>k</var> be <var>replacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement-match\" id=\"ref-for-ad-keyword-replacement-match\">match</a>.</p>"
            },
            {
              "html": "<p>Let <var>v</var> be <var>replacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement-replacement\" id=\"ref-for-ad-keyword-replacement-replacement\">replacement</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥\">Set</a> <var>replacements</var>[<var>k</var>] to <var>v</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>replacedAdURL</var> be the result of\nrunning <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros\">substitute macros</a> with <var>replacements</var> and <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url\">url</a>.</p>"
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url①\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value①\">value</a> to <var>replacedAdURL</var>.</p>"
        },
        {
          "html": "<p>Let <var>adSize</var> be <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>concreteAdSize</var> be the result of</p>"
        },
        {
          "html": "<p>Let <var>adWidthString</var> and <var>adHeightString</var> be the result of</p>"
        },
        {
          "html": "<p>Let <var>sizeMacroMap</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">ordered map</a> «[ \"{%AD_WIDTH%}\" → <var>adWidthString</var>,\n \"{%AD_HEIGHT%}\" → <var>adHeightString</var>, \"${AD_WIDTH}\" → <var>adWidthString</var>,\n \"${AD_HEIGHT}\" → <var>adHeightString</var>]»</p>"
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url②\">mapped url</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value②\">value</a> to\n the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros①\">substituting macros</a> with <var>sizeMacroMap</var> into <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor②\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①\">url</a>.</p>"
        },
        {
          "html": "If <var>adSize</var> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size①\">content size</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑥\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑦\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-value\" id=\"ref-for-content-size-value\">value</a>\n         </dt><dd data-md=\"\">\n          <p><var>concreteAdSize</var>.</p>\n          \n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-visibility\" id=\"ref-for-content-size-visibility\">visibility</a>\n         </dt><dd data-md=\"\">\n          <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque⑤\"><code>opaque</code></a>\"</p>\n        </dd></dl>"
            }
          ]
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor①\">interest group descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#interest-group-descriptor-value\" id=\"ref-for-interest-group-descriptor-value①\">value</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑦\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑧\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\">owner\n       </dt><dd data-md=\"\">\n        <p><var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②②\">owner</a></p>\n       </dd><dt data-md=\"\">name\n       </dt><dd data-md=\"\">\n        <p><var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name⑤\">name</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>fencedFrameReportingMap</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">map</a> «[ \"<code>buyer</code>\" → «», \"<code>seller</code>\" → «» ]».</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions\">component auctions</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">empty</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦\">set</a> <var>fencedFrameReportingMap</var>[\"<code>component-seller</code>\"] to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a> «».</p>"
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-fenced-frame-reporting-metadata\" id=\"ref-for-fenced-frame-config-fenced-frame-reporting-metadata①\">fenced frame reporting metadata</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑧\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑨\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-value\" id=\"ref-for-fenced-frame-reporting-metadata-value\">value</a>\n       </dt><dd data-md=\"\">\n        <p>A <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑨\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⓪\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-fenced-frame-reporting-map\" id=\"ref-for-fenced-frame-reporting-metadata-fenced-frame-reporting-map\">fenced frame reporting map</a>\n         </dt><dd data-md=\"\">\n          <p><var>fencedFrameReportingMap</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-direct-seller-is-seller\" id=\"ref-for-fenced-frame-reporting-metadata-direct-seller-is-seller\">direct seller is seller</a>\n         </dt><dd data-md=\"\">\n          <p>true if <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions①\">component auctions</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①\">empty</a>, false\n  otherwise</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-allowed-reporting-origins\" id=\"ref-for-fenced-frame-reporting-metadata-allowed-reporting-origins\">allowed reporting origins</a>\n         </dt><dd data-md=\"\">\n          <p><var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad\">bid ad</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-allowed-reporting-origins\" id=\"ref-for-interest-group-ad-allowed-reporting-origins①\">allowed reporting origins</a></p>\n        </dd></dl>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-reporting-metadata-visibility\" id=\"ref-for-fenced-frame-reporting-metadata-visibility\">visibility</a>\n       </dt><dd data-md=\"\">\n        <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque⑥\"><code>opaque</code></a>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback①\">on navigate callback</a> to an algorithm with these\n steps:</p>",
          "ignored": [
            "Asynchronously finish reporting with pendingConfig’s fenced frame reporting metadata's value's fenced frame reporting map, winningBidInfo, auctionReportInfo and frameOrigin."
          ]
        },
        {
          "html": "<p>Let <var>adComponentDescriptorsWithReplacements</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor\">ad descriptors</a>.</p>"
        },
        {
          "html": "If <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors\">ad component descriptors</a> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①①\">For each</a> <var>adComponentDescriptor</var> of <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①\">ad component descriptors</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>descriptorWithReplacement</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor①\">ad descriptor</a>.</p>"
                },
                {
                  "html": "<p>Set <var>descriptorWithReplacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size①\">size</a> to <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size②\">size</a>.</p>"
                },
                {
                  "html": "<p>Set <var>descriptorWithReplacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url②\">url</a> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros②\">substitute macros</a> with <var>replacements</var> and <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url③\">url</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">Append</a> <var>descriptorWithReplacement</var> to <var>adComponentDescriptorsWithReplacements</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>pendingConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-nested-configs\" id=\"ref-for-fenced-frame-config-nested-configs①\">nested configs</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-value\" id=\"ref-for-nested-configs-value①\">value</a> to\n the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-nested-configs\" id=\"ref-for-create-nested-configs\">create nested configs</a> with <var>adComponentDescriptorsWithReplacements</var>.</p>"
        },
        {
          "html": "<p>Return <var>pendingConfig</var>.</p>"
        }
      ]
    },
    {
      "name": "asynchronously finish reporting",
      "href": "https://wicg.github.io/turtledove/#asynchronously-finish-reporting",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"asynchronously-finish-reporting\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">asynchronously finish reporting</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-fenced-frame-reporting-map\" id=\"ref-for-fencedframetype-fenced-frame-reporting-map\">fenced frame reporting map</a> <var>reportingMap</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info①\">leading bid info</a> <var>leadingBidInfo</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info\" id=\"ref-for-auction-report-info②\">auction report info</a> <var>auctionReportInfo</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-a-winning-bids-k-anonymity-count\" id=\"ref-for-increment-a-winning-bids-k-anonymity-count\">Increment a winning bid’s k-anonymity count</a> given <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid③\">leading bid</a>.</p>"
        },
        {
          "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid\">leading non-k-anon-enforced bid</a> is\n not null, and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid①\">leading non-k-anon-enforced bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-id\" id=\"ref-for-generated-bid-id\">id</a> ≠ <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid④\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-id\" id=\"ref-for-generated-bid-id①\">id</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-a-winning-bids-k-anonymity-count\" id=\"ref-for-increment-a-winning-bids-k-anonymity-count①\">increment a winning bid’s k-anonymity count</a> given <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid②\">leading non-k-anon-enforced bid</a>.</p>"
        },
        {
          "html": "<p>Let <var>buyerDone</var>, <var>sellerDone</var>, and <var>componentSellerDone</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean\">booleans</a>, initially false.</p>"
        },
        {
          "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller\">component seller</a> is null, set <var>componentSellerDone</var> to true.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while\">While</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>buyerDone</var>, <var>sellerDone</var>, and <var>componentSellerDone</var> are all true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">break</a>.</p>"
            },
            {
              "html": "<p>Wait until one of the following fields of <var>leadingBidInfo</var> being not null:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result\">buyer reporting result</a>;</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-seller-reporting-result\" id=\"ref-for-leading-bid-info-seller-reporting-result\">seller reporting result</a>;</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller-reporting-result\" id=\"ref-for-leading-bid-info-component-seller-reporting-result\">component seller reporting result</a>.</p>\n        </li></ul>"
            },
            {
              "html": "If <var>buyerDone</var> is false and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result①\">buyer reporting result</a> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>buyerMap</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result②\">buyer reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-beacon-map\" id=\"ref-for-reporting-result-reporting-beacon-map\">reporting beacon map</a>.</p>"
                },
                {
                  "html": "<p>If <var>buyerMap</var> is null, set <var>buyerMap</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦\">map</a> «[]».</p>"
                },
                {
                  "html": "<p>Let <var>macroMap</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result③\">buyer reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-macro-map\" id=\"ref-for-reporting-result-reporting-macro-map\">reporting macro map</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#finalize-a-reporting-destination\" id=\"ref-for-finalize-a-reporting-destination\">Finalize a reporting destination</a> with <var>reportingMap</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fencereportingdestination-buyer\" id=\"ref-for-dom-fencereportingdestination-buyer\">buyer</a></code>, <var>buyerMap</var>, and <var>macroMap</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report①\">Send report</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result④\">buyer reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-report-url\" id=\"ref-for-reporting-result-report-url\">report url</a> and <var>frameOrigin</var>.</p>"
                },
                {
                  "html": "<p>Set <var>buyerDone</var> to true.</p>"
                }
              ]
            },
            {
              "html": "If <var>sellerDone</var> is false and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-seller-reporting-result\" id=\"ref-for-leading-bid-info-seller-reporting-result①\">seller reporting result</a> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>sellerMap</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-seller-reporting-result\" id=\"ref-for-leading-bid-info-seller-reporting-result②\">seller reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-beacon-map\" id=\"ref-for-reporting-result-reporting-beacon-map①\">reporting beacon map</a>.</p>"
                },
                {
                  "html": "<p>If <var>sellerMap</var> is null, set <var>sellerMap</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧\">map</a> «[]».</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#finalize-a-reporting-destination\" id=\"ref-for-finalize-a-reporting-destination①\">Finalize a reporting destination</a> with <var>reportingMap</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fencereportingdestination-seller\" id=\"ref-for-dom-fencereportingdestination-seller\">seller</a></code>, and <var>sellerMap</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report②\">Send report</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-seller-reporting-result\" id=\"ref-for-leading-bid-info-seller-reporting-result③\">seller reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-report-url\" id=\"ref-for-reporting-result-report-url①\">report url</a> and <var>frameOrigin</var>.</p>"
                },
                {
                  "html": "<p>Set <var>sellerDone</var> to true.</p>"
                }
              ]
            },
            {
              "html": "If <var>componentSellerDone</var> is false and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller-reporting-result\" id=\"ref-for-leading-bid-info-component-seller-reporting-result①\">component seller reporting result</a> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>componentSellerMap</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller-reporting-result\" id=\"ref-for-leading-bid-info-component-seller-reporting-result②\">component seller reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-beacon-map\" id=\"ref-for-reporting-result-reporting-beacon-map②\">reporting beacon map</a>.</p>"
                },
                {
                  "html": "<p>If <var>componentSellerMap</var> is null, set <var>componentSellerMap</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨\">map</a> «[]».</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#finalize-a-reporting-destination\" id=\"ref-for-finalize-a-reporting-destination②\">Finalize a reporting destination</a> with <var>reportingMap</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/fenced-frame/#dom-fencereportingdestination-component-seller\" id=\"ref-for-dom-fencereportingdestination-component-seller\">component-seller</a></code>, and <var>componentSellerMap</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report③\">Send report</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller-reporting-result\" id=\"ref-for-leading-bid-info-component-seller-reporting-result③\">component seller reporting result</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-report-url\" id=\"ref-for-reporting-result-report-url②\">report url</a> and <var>frameOrigin</var>.</p>"
                },
                {
                  "html": "<p>Set <var>componentSellerDone</var> to true.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①②\">For each</a> <var>reportUrl</var> of <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-win-report-urls\" id=\"ref-for-auction-report-info-debug-win-report-urls\">debug win report urls</a>:",
          "rationale": "send",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report④\">Send report</a> with <var>report</var> and <var>frameOrigin</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①③\">For each</a> <var>reportUrl</var> of <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls①\">debug loss report urls</a>:",
          "rationale": "send",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-report\" id=\"ref-for-send-report⑤\">Send report</a> with <var>report</var> and <var>frameOrigin</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-real-time-reports\" id=\"ref-for-send-real-time-reports①\">Send real time reports</a> with <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-real-time-reporting-contributions-map\" id=\"ref-for-auction-report-info-real-time-reporting-contributions-map②\">real time reporting contributions map</a> and <var>frameOrigin</var>.</p>"
        }
      ]
    },
    {
      "name": "create nested configs",
      "href": "https://wicg.github.io/turtledove/#create-nested-configs",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-nested-configs\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create nested configs</dfn> given <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors②\">ad component descriptors</a> <var>adComponentDescriptors</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>nestedConfigs</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①②\">list</a> «».</p>"
        },
        {
          "html": "If <var>adComponentDescriptors</var> is null:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <var>nestedConfigs</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①④\">For each</a> <var>adComponentDescriptor</var> of <var>adComponentDescriptors</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>fencedFrameConfig</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config\" id=\"ref-for-fenced-frame-config②\">fenced frame config</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①①\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-mapped-url\" id=\"ref-for-fenced-frame-config-mapped-url③\">mapped url</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①⓪\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①②\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-value\" id=\"ref-for-mapped-url-value③\">value</a>\n           </dt><dd data-md=\"\">\n            <p><var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url④\">url</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#mapped-url-visibility\" id=\"ref-for-mapped-url-visibility①\">visibility</a>\n           </dt><dd data-md=\"\">\n            <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque⑦\"><code>opaque</code></a>\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-container-size\" id=\"ref-for-fenced-frame-config-container-size①\">container size</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-content-size\" id=\"ref-for-fenced-frame-config-content-size②\">content size</a>\n         </dt><dd data-md=\"\">\n          <p>If <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size③\">size</a> is null, then null. Otherwise, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①①\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①③\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-value\" id=\"ref-for-content-size-value②\">value</a>\n           </dt><dd data-md=\"\">\n            <p><var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size④\">size</a> TODO: Resolve screen-relative sizes and\n  macros and cast this properly.</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#content-size-visibility\" id=\"ref-for-content-size-visibility①\">visibility</a>\n           </dt><dd data-md=\"\">\n            <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque⑧\"><code>opaque</code></a>\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-interest-group-descriptor\" id=\"ref-for-fenced-frame-config-interest-group-descriptor②\">interest group descriptor</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-on-navigate-callback\" id=\"ref-for-fenced-frame-config-on-navigate-callback②\">on navigate callback</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-sandboxing-flags\" id=\"ref-for-fenced-frame-config-effective-sandboxing-flags①\">effective sandboxing flags</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①②\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①④\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-value\" id=\"ref-for-effective-sandboxing-flags-value①\">value</a>\n           </dt><dd data-md=\"\">\n            <p>TODO: fill this in once fenced frame sandbox flags are more fully specified</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-sandboxing-flags-visibility\" id=\"ref-for-effective-sandboxing-flags-visibility①\">visibility</a>\n           </dt><dd data-md=\"\">\n            <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque⑨\"><code>opaque</code></a>\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-effective-enabled-permissions\" id=\"ref-for-fenced-frame-config-effective-enabled-permissions①\">effective enabled permissions</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①③\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⑤\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-value\" id=\"ref-for-effective-enabled-permissions-value①\">value</a>\n           </dt><dd data-md=\"\">\n            <p>«\"<code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/attribution-reporting-api/#dom-permissionpolicy-attribution-reporting\" id=\"ref-for-dom-permissionpolicy-attribution-reporting①\">attribution-reporting</a></code></code>\",\n  \"<code><a data-link-type=\"dfn\" href=\"https://patcg-individual-drafts.github.io/private-aggregation-api#private-aggregation\" id=\"ref-for-private-aggregation①\">private-aggregation</a></code>\", \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/shared-storage#permissionspolicy-shared-storage\" id=\"ref-for-permissionspolicy-shared-storage①\">shared-storage</a></code>\",\n  \"<code><a data-link-type=\"dfn\" href=\"https://wicg.github.io/shared-storage#permissionspolicy-shared-storage-select-url\" id=\"ref-for-permissionspolicy-shared-storage-select-url①\">shared-storage-select-url</a></code>\"»</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#effective-enabled-permissions-visibility\" id=\"ref-for-effective-enabled-permissions-visibility①\">visibility</a>\n           </dt><dd data-md=\"\">\n            <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque①⓪\"><code>opaque</code></a>\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-fenced-frame-reporting-metadata\" id=\"ref-for-fenced-frame-config-fenced-frame-reporting-metadata③\">fenced frame reporting metadata</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-exfiltration-budget-metadata\" id=\"ref-for-fenced-frame-config-exfiltration-budget-metadata①\">exfiltration budget metadata</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-nested-configs\" id=\"ref-for-fenced-frame-config-nested-configs②\">nested configs</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct①④\">struct</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⑥\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-value\" id=\"ref-for-nested-configs-value②\">value</a>\n           </dt><dd data-md=\"\">\n            <p>an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①③\">list</a> «»</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#nested-configs-visibility\" id=\"ref-for-nested-configs-visibility①\">visibility</a>\n           </dt><dd data-md=\"\">\n            <p>\"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#visibility-opaque\" id=\"ref-for-visibility-opaque①①\"><code>opaque</code></a>\"</p>\n          </dd></dl>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fenced-frame-config-embedder-shared-storage-context\" id=\"ref-for-fenced-frame-config-embedder-shared-storage-context①\">embedder shared storage context</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">Append</a> <var>fencedFrameConfig</var> to <var>nestedConfigs</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>nestedConfigs</var>.</p>"
        }
      ]
    },
    {
      "name": "validate and convert auction ad config",
      "href": "https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-convert-auction-ad-config\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and convert auction ad config</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionadconfig\" id=\"ref-for-dictdef-auctionadconfig②\">AuctionAdConfig</a></code> <var>config</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①\">boolean</a> <var>isTopLevel</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a> that these steps are not running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>auctionConfig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config②\">auction config</a>.</p>"
        },
        {
          "html": "<p>Let <var>seller</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin④\">parsing an https origin</a> with <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-seller\" id=\"ref-for-dom-auctionadconfig-seller\">seller</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>seller</var> is failure, then return failure.</p>"
        },
        {
          "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①\">seller</a> to <var>seller</var>.</p>"
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-serverresponse\" id=\"ref-for-dom-auctionadconfig-serverresponse\">serverResponse</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑥\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requestid\" id=\"ref-for-dom-auctionadconfig-requestid\">requestId</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑦\">exist</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②②\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-server-response\" id=\"ref-for-auction-config-server-response①\">server response</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-serverresponse\" id=\"ref-for-dom-auctionadconfig-serverresponse①\">serverResponse</a></code>\"].</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-server-response-id\" id=\"ref-for-auction-config-server-response-id\">server response id</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requestid\" id=\"ref-for-dom-auctionadconfig-requestid①\">requestId</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requestid\" id=\"ref-for-dom-auctionadconfig-requestid②\">requestId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑧\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑦\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②③\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-decisionlogicurl\" id=\"ref-for-dom-auctionadconfig-decisionlogicurl\">decisionLogicURL</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑨\">exist</a>,\nthen <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②④\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-decisionlogicurl\" id=\"ref-for-dom-auctionadconfig-decisionlogicurl①\">decisionLogicURL</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⓪\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>decisionLogicURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser②\">URL parser</a> on <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-decisionlogicurl\" id=\"ref-for-dom-auctionadconfig-decisionlogicurl②\">decisionLogicURL</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>decisionLogicURL</var> is failure, or it is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller②\">seller</a>, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-decision-logic-url\" id=\"ref-for-auction-config-decision-logic-url\">decision logic url</a> to <var>decisionLogicURL</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-trustedscoringsignalsurl\" id=\"ref-for-dom-auctionadconfig-trustedscoringsignalsurl\">trustedScoringSignalsURL</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③①\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>trustedScoringSignalsURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-trusted-signals-url\" id=\"ref-for-parse-and-verify-a-trusted-signals-url①\">parse and verify a trusted signals URL</a> on <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-trustedscoringsignalsurl\" id=\"ref-for-dom-auctionadconfig-trustedscoringsignalsurl①\">trustedScoringSignalsURL</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>trustedScoringSignalsURL</var> is failure, return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-trusted-scoring-signals-url\" id=\"ref-for-auction-config-trusted-scoring-signals-url\">trusted scoring signals url</a> to <var>trustedScoringSignalsURL</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-maxtrustedscoringsignalsurllength\" id=\"ref-for-dom-auctionadconfig-maxtrustedscoringsignalsurllength\">maxTrustedScoringSignalsURLLength</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③②\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-maxtrustedscoringsignalsurllength\" id=\"ref-for-dom-auctionadconfig-maxtrustedscoringsignalsurllength①\">maxTrustedScoringSignalsURLLength</a></code>\"] ≥ 0, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-max-trusted-scoring-signals-url-length\" id=\"ref-for-auction-config-max-trusted-scoring-signals-url-length\">max trusted scoring signals url length</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-maxtrustedscoringsignalsurllength\" id=\"ref-for-dom-auctionadconfig-maxtrustedscoringsignalsurllength②\">maxTrustedScoringSignalsURLLength</a></code>\"], otherwise <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑨\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑤\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers\" id=\"ref-for-dom-auctionadconfig-interestgroupbuyers\">interestGroupBuyers</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③③\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>buyers</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①④\">list</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑤\">For each</a> <var>buyerString</var> in <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers\" id=\"ref-for-dom-auctionadconfig-interestgroupbuyers①\">interestGroupBuyers</a></code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin⑤\">parsing an https origin</a> with <var>buyerString</var>.</p>"
                },
                {
                  "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④\">Append</a> <var>buyer</var> to <var>buyers</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers\" id=\"ref-for-auction-config-interest-group-buyers②\">interest group buyers</a> to <var>buyers</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionsignals\" id=\"ref-for-dom-auctionadconfig-auctionsignals\">auctionSignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③④\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals\">auction signals</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionsignals\" id=\"ref-for-dom-auctionadconfig-auctionsignals①\">auctionSignals</a></code>\"].</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#handle-an-input-promise-in-configuration\" id=\"ref-for-handle-an-input-promise-in-configuration\">Handle an input promise in configuration</a> given <var>auctionConfig</var> and <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals①\">auction signals</a>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>To parse the value <var>result</var>, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals②\">auction signals</a> to the\nresult of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string②\">serializing a JavaScript value to a JSON string</a>.</p>\n         </li><li data-md=\"\">\n          <p>To handle an error, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals③\">auction signals</a> to failure.</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requestedsize\" id=\"ref-for-dom-auctionadconfig-requestedsize\">requestedSize</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑤\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adSize</var> be the result from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-ad-size\" id=\"ref-for-parse-an-adrender-ad-size①\">parse an AdRender ad size</a> with <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requestedsize\" id=\"ref-for-dom-auctionadconfig-requestedsize①\">requestedSize</a></code>\"]</p>"
            },
            {
              "html": "<p>If <var>adSize</var> is null, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑥\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size①\">requested size</a> to <var>adSize</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-allslotsrequestedsizes\" id=\"ref-for-dom-auctionadconfig-allslotsrequestedsizes\">allSlotsRequestedSizes</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑥\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-allslotsrequestedsizes\" id=\"ref-for-dom-auctionadconfig-allslotsrequestedsizes①\">allSlotsRequestedSizes</a></code>\"] is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty②\">empty</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑦\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes\">all slots requested sizes</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑥\">For each</a> <var>adSizeValue</var> in <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-allslotsrequestedsizes\" id=\"ref-for-dom-auctionadconfig-allslotsrequestedsizes②\">allSlotsRequestedSizes</a></code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>adSize</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-ad-size\" id=\"ref-for-parse-an-adrender-ad-size②\">parse an AdRender ad size</a> with <var>adSizeValue</var>.</p>"
                },
                {
                  "html": "<p>If <var>adSize</var> is null, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑧\">TypeError</a></code>.</p>"
                },
                {
                  "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes①\">all slots requested sizes</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> <var>adSize</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑨\">TypeError</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>adSize</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes②\">all slots requested sizes</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size②\">requested size</a> is not null, and <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes③\">all slots requested sizes</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contain</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size③\">requested size</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⓪\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellersignals\" id=\"ref-for-dom-auctionadconfig-sellersignals\">sellerSignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑦\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals\">seller signals</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellersignals\" id=\"ref-for-dom-auctionadconfig-sellersignals①\">sellerSignals</a></code>\"].</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#handle-an-input-promise-in-configuration\" id=\"ref-for-handle-an-input-promise-in-configuration①\">Handle an input promise in configuration</a> given <var>auctionConfig</var> and <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals①\">seller signals</a>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>To parse the value <var>result</var>, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals②\">seller signals</a> to the\nresult of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string③\">serializing a JavaScript value to a JSON string</a>, given <var>result</var>.</p>\n         </li><li data-md=\"\">\n          <p>To handle an error, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals③\">seller signals</a> to failure.</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionnonce\" id=\"ref-for-dom-auctionadconfig-auctionnonce\">auctionNonce</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑧\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑧\">set</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-nonce\" id=\"ref-for-auction-config-auction-nonce\">auction nonce</a> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-uuid-from-string\" id=\"ref-for-get-uuid-from-string\">get uuid from string</a> with <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionnonce\" id=\"ref-for-dom-auctionadconfig-auctionnonce①\">auctionNonce</a></code>\"].</p>"
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-additionalbids\" id=\"ref-for-dom-auctionadconfig-additionalbids\">additionalBids</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑨\">exists</a>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③⑤\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③①\">TypeError</a></code> if any of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionnonce\" id=\"ref-for-dom-auctionadconfig-auctionnonce②\">auctionNonce</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⓪\">exist</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers\" id=\"ref-for-dom-auctionadconfig-interestgroupbuyers②\">interestGroupBuyers</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④①\">exist</a>, or is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty③\">empty</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-componentauctions\" id=\"ref-for-dom-auctionadconfig-componentauctions\">componentAuctions</a></code>\"] is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty④\">empty</a>.</p>\n        </li></ul>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-expects-additional-bids\" id=\"ref-for-auction-config-expects-additional-bids\">expects additional bids</a> to true.</p>"
            },
            {
              "html": "To parse the value <var>result</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-expects-additional-bids\" id=\"ref-for-auction-config-expects-additional-bids①\">expects additional bids</a> to false.</p>"
                }
              ],
              "additional": [
                {
                  "html": "To handle an error:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-expects-additional-bids\" id=\"ref-for-auction-config-expects-additional-bids②\">expects additional bids</a> to failure.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-directfromsellersignalsheaderadslot\" id=\"ref-for-dom-auctionadconfig-directfromsellersignalsheaderadslot\">directFromSellerSignalsHeaderAdSlot</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④②\">exists</a>:",
          "rationale": "handle",
          "steps": [
            {
              "html": "To parse the value <var>result</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot\">direct from seller signals header ad slot</a> to <var>result</var>.</p>"
                }
              ],
              "additional": [
                {
                  "html": "To handle an error:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot①\">direct from seller signals header ad slot</a> to\nfailure.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-deprecatedrenderurlreplacements\" id=\"ref-for-dom-auctionadconfig-deprecatedrenderurlreplacements\">deprecatedRenderURLReplacements</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④③\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements①\">deprecated render url replacements</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-deprecatedrenderurlreplacements\" id=\"ref-for-dom-auctionadconfig-deprecatedrenderurlreplacements①\">deprecatedRenderURLReplacements</a></code>\"].</p>"
            },
            {
              "html": "To parse the value <var>result</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>renderUrlReplacements</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement\" id=\"ref-for-ad-keyword-replacement\">ad keyword replacement</a>s.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑦\">For each</a> <var>replacement</var> in <var>result</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-a-url-macro\" id=\"ref-for-validate-a-url-macro\">validate a url macro</a> with <var>replacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement-match\" id=\"ref-for-ad-keyword-replacement-match①\">match</a> returns false, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③②\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤\">append</a> <var>replacement</var> to <var>renderUrlReplacements</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements③\">deprecated render url replacements</a> to <var>renderUrlReplacements</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellertimeout\" id=\"ref-for-dom-auctionadconfig-sellertimeout\">sellerTimeout</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④④\">exists</a>, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-timeout\" id=\"ref-for-auction-config-seller-timeout\">seller timeout</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellertimeout\" id=\"ref-for-dom-auctionadconfig-sellertimeout①\">sellerTimeout</a></code>\"] in milliseconds\nor 500, whichever is smaller.</p>"
        },
        {
          "html": "<p>Let <var>reportingTimeout</var> be <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-reportingtimeout\" id=\"ref-for-dom-auctionadconfig-reportingtimeout\">reportingTimeout</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑤\">exists</a>,\n50 otherwise.</p>"
        },
        {
          "html": "<p>Set <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-reportingtimeout\" id=\"ref-for-dom-auctionadconfig-reportingtimeout①\">reportingTimeout</a></code>\"] to <var>reportingTimeout</var> in milliseconds or\n5000, whichever is smaller.</p>"
        },
        {
          "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellerexperimentgroupid\" id=\"ref-for-dom-auctionadconfig-sellerexperimentgroupid\">sellerExperimentGroupId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑥\">exists</a>, then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-experiment-group-id\" id=\"ref-for-auction-config-seller-experiment-group-id\">seller experiment group id</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellerexperimentgroupid\" id=\"ref-for-dom-auctionadconfig-sellerexperimentgroupid①\">sellerExperimentGroupId</a></code>\"].</p>"
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellercurrency\" id=\"ref-for-dom-auctionadconfig-sellercurrency\">sellerCurrency</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑦\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag\" id=\"ref-for-check-whether-a-string-is-a-valid-currency-tag\">checking whether a string is a valid currency tag</a> on <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellercurrency\" id=\"ref-for-dom-auctionadconfig-sellercurrency①\">sellerCurrency</a></code>\"] is false, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency\">seller currency</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellercurrency\" id=\"ref-for-dom-auctionadconfig-sellercurrency②\">sellerCurrency</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyersignals\" id=\"ref-for-dom-auctionadconfig-perbuyersignals\">perBuyerSignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑧\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals\">per buyer signals</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyersignals\" id=\"ref-for-dom-auctionadconfig-perbuyersignals①\">perBuyerSignals</a></code>\"].</p>"
            },
            {
              "html": "To parse the value <var>result</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals②\">per buyer signals</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑥\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑤\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑦\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">strings</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③\">For each</a> <var>key</var> → <var>value</var> of <var>result</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin⑥\">parsing an https origin</a> with <var>key</var>. If <var>buyer</var> is\n failure, throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③③\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p>Let <var>signalsString</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string④\">serializing a JavaScript value to a JSON string</a>,\ngiven <var>value</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑨\">Set</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals③\">per buyer signals</a>[<var>buyer</var>] to <var>signalsString</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>idlTimeoutMember</var>, <var>perBuyerTimeoutField</var>, <var>allBuyersTimeoutField</var> in the following table",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>config</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑨\">contains</a> <var>idlTimeoutMember</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <var>perBuyerTimeoutField</var> to <var>config</var>[<var>idlTimeoutMember</var>].</p>"
                },
                {
                  "html": "To parse the value <var>result</var>:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>auctionConfig</var>’s <var>perBuyerTimeoutField</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑦\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑧\">values</a> are <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration\">durations</a> in milliseconds.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate④\">For each</a> <var>key</var> → <var>value</var> of <var>result</var>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>perBuyerTimeoutField</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyertimeouts\" id=\"ref-for-dom-auctionadconfig-perbuyertimeouts①\">perBuyerTimeouts</a></code>\", and <var>value</var> &gt; 500, then set <var>value</var> to 500.</p>"
                        },
                        {
                          "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <var>allBuyersTimeoutField</var> to <var>value</var> in\nmilliseconds, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
                        },
                        {
                          "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin⑦\">parsing an https origin</a> with <var>key</var>. If <var>buyer</var> is\nfailure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③⑦\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③④\">TypeError</a></code>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⓪\">Set</a> <var>auctionConfig</var>’s <var>perBuyerTimeoutField</var>[<var>buyer</var>] to <var>value</var> in milliseconds.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyergrouplimits\" id=\"ref-for-dom-auctionadconfig-perbuyergrouplimits\">perBuyerGroupLimits</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⓪\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑤\">for each</a> <var>key</var> → <var>value</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyergrouplimits\" id=\"ref-for-dom-auctionadconfig-perbuyergrouplimits①\">perBuyerGroupLimits</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is 0, then return failure.</p>"
            },
            {
              "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-group-limit\" id=\"ref-for-auction-config-all-buyers-group-limit\">all buyers group limit</a> to <var>value</var>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin⑧\">parsing an https origin</a> with <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-group-limits\" id=\"ref-for-auction-config-per-buyer-group-limits\">per buyer group limits</a>[<var>buyer</var>] to <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerexperimentgroupids\" id=\"ref-for-dom-auctionadconfig-perbuyerexperimentgroupids\">perBuyerExperimentGroupIds</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤①\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑥\">for each</a> <var>key</var> → <var>value</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerexperimentgroupids\" id=\"ref-for-dom-auctionadconfig-perbuyerexperimentgroupids①\">perBuyerExperimentGroupIds</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyer-experiment-group-id\" id=\"ref-for-auction-config-all-buyer-experiment-group-id\">all buyer experiment group id</a> to <var>value</var>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>buyer</var> the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin⑨\">parsing an https origin</a> with <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-experiment-group-ids\" id=\"ref-for-auction-config-per-buyer-experiment-group-ids\">per buyer experiment group ids</a>[<var>buyer</var>] to <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyermultibidlimits\" id=\"ref-for-dom-auctionadconfig-perbuyermultibidlimits\">perBuyerMultiBidLimits</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤②\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑦\">for each</a> <var>key</var> → <var>value</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyermultibidlimits\" id=\"ref-for-dom-auctionadconfig-perbuyermultibidlimits①\">perBuyerMultiBidLimits</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-multi-bid-limit\" id=\"ref-for-auction-config-all-buyers-multi-bid-limit\">all buyers multi-bid limit</a> to <var>value</var>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>buyer</var> the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⓪\">parsing an https origin</a> with <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-multi-bid-limits\" id=\"ref-for-auction-config-per-buyer-multi-bid-limits\">per buyer multi-bid limits</a>[<var>buyer</var>] to <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerprioritysignals\" id=\"ref-for-dom-auctionadconfig-perbuyerprioritysignals\">perBuyerPrioritySignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤③\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑧\">for each</a> <var>key</var> → <var>value</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerprioritysignals\" id=\"ref-for-dom-auctionadconfig-perbuyerprioritysignals①\">perBuyerPrioritySignals</a></code>\"]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>signals</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑧\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values⑨\">values</a> are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double⑤\">double</a></code>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑨\">for each</a> <var>k</var> → <var>v</var> of <var>value</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>k</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with\">starts with</a> \"browserSignals.\", <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⑤\">TypeError</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①①\">Set</a> <var>signals</var>[<var>k</var>] to <var>v</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-priority-signals\" id=\"ref-for-auction-config-all-buyers-priority-signals\">all buyers priority signals</a> to <var>value</var>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①①\">parsing an https origin</a> with <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①②\">Set</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-priority-signals\" id=\"ref-for-auction-config-per-buyer-priority-signals\">per buyer priority signals</a>[<var>buyer</var>] to <var>signals</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requiredsellercapabilities\" id=\"ref-for-dom-auctionadconfig-requiredsellercapabilities\">requiredSellerCapabilities</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤④\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>sellerCapabilities</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#seller-capability\" id=\"ref-for-seller-capability②\">seller capabilities</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑧\">For each</a> <var>capabilityString</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-requiredsellercapabilities\" id=\"ref-for-dom-auctionadconfig-requiredsellercapabilities①\">requiredSellerCapabilities</a></code>\"]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>capabilityString</var> is \"<code>interest-group-counts</code>\" or \"<code>latency-stats</code>\", then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">append</a> <var>capabilityString</var> to <var>sellerCapabilities</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-required-seller-capabilities\" id=\"ref-for-auction-config-required-seller-capabilities\">required seller capabilities</a> to <var>sellerCapabilities</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyercurrencies\" id=\"ref-for-dom-auctionadconfig-perbuyercurrencies\">perBuyerCurrencies</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑤\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies\">per buyer currencies</a> to <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyercurrencies\" id=\"ref-for-dom-auctionadconfig-perbuyercurrencies①\">perBuyerCurrencies</a></code>\"]</p>"
            },
            {
              "html": "To parse the value <var>result</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies②\">per buyer currencies</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys⑨\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①⓪\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag\">currency tags</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⓪\">for each</a> <var>key</var> → <var>value</var> of <var>result</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag\" id=\"ref-for-check-whether-a-string-is-a-valid-currency-tag①\">checking whether a string is a valid currency tag</a> given <var>value</var> is\nfalse, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⑥\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p>If <var>key</var> is \"*\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-currency\" id=\"ref-for-auction-config-all-buyers-currency\">all buyers currency</a> to <var>value</var>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>buyer</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①②\">parsing an https origin</a> with <var>key</var>. If <var>buyer</var> is\nfailure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⑦\">TypeError</a></code>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①③\">Set</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies③\">per buyer currencies</a>[<var>buyer</var>] to <var>value</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellerrealtimereportingconfig\" id=\"ref-for-dom-auctionadconfig-sellerrealtimereportingconfig\">sellerRealTimeReportingConfig</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑥\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-sellerrealtimereportingconfig\" id=\"ref-for-dom-auctionadconfig-sellerrealtimereportingconfig①\">sellerRealTimeReportingConfig</a></code>\"][\"type\"] is\n\"<code>default-local-reporting</code>\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-real-time-reporting-config\" id=\"ref-for-auction-config-seller-real-time-reporting-config\">seller real time reporting config</a> to \"<code>default-local-reporting</code>\".</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerrealtimereportingconfig\" id=\"ref-for-dom-auctionadconfig-perbuyerrealtimereportingconfig\">perBuyerRealTimeReportingConfig</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑦\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①①\">For each</a> <var>key</var> → <var>value</var> of <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-perbuyerrealtimereportingconfig\" id=\"ref-for-dom-auctionadconfig-perbuyerrealtimereportingconfig①\">perBuyerRealTimeReportingConfig</a></code>\"]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>buyer</var> the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①③\">parsing an https origin</a> with <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>buyer</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p>If <var>value</var>[\"type\"] is \"<code>default-local-reporting</code>\", then set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-real-time-reporting-config\" id=\"ref-for-auction-config-per-buyer-real-time-reporting-config\">per buyer real time reporting config</a>[<var>buyer</var>] to \"<code>default-local-reporting</code>\".</p>"
            }
          ]
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-componentauctions\" id=\"ref-for-dom-auctionadconfig-componentauctions①\">componentAuctions</a></code>\"] is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑤\">empty</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-interestgroupbuyers\" id=\"ref-for-dom-auctionadconfig-interestgroupbuyers③\">interestGroupBuyers</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑧\">exists</a> and is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑥\">empty</a>,\nthen return failure.</p>"
            },
            {
              "html": "<p>If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-deprecatedrenderurlreplacements\" id=\"ref-for-dom-auctionadconfig-deprecatedrenderurlreplacements②\">deprecatedRenderURLReplacements</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑨\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⑧\">TypeError</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑨\">For each</a> <var>component</var> in <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-componentauctions\" id=\"ref-for-dom-auctionadconfig-componentauctions②\">componentAuctions</a></code>\"]:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>isTopLevel</var> is false, then return failure.</p>"
            },
            {
              "html": "<p>Let <var>componentAuction</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-and-convert-auction-ad-config\" id=\"ref-for-validate-and-convert-auction-ad-config①\">validate and convert auction ad config</a> with <var>component</var> and false.</p>"
            },
            {
              "html": "<p>If <var>componentAuction</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥\">Append</a> <var>componentAuction</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions②\">component auctions</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl\">config idl</a> to <var>config</var>.</p>"
        },
        {
          "html": "If <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-resolvetoconfig\" id=\"ref-for-dom-auctionadconfig-resolvetoconfig\">resolveToConfig</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⓪\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-resolve-to-config\" id=\"ref-for-auction-config-resolve-to-config②\">resolve to config</a> be <var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-resolvetoconfig\" id=\"ref-for-dom-auctionadconfig-resolvetoconfig①\">resolveToConfig</a></code>\"].</p>"
            },
            {
              "html": "<p>TODO: What should happen if this rejects?</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-fulfillment\" id=\"ref-for-upon-fulfillment\">Upon fulfillment</a> of <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-resolve-to-config\" id=\"ref-for-auction-config-resolve-to-config③\">resolve to config</a> with <var>resolveToConfig</var>, set <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-resolve-to-config\" id=\"ref-for-auction-config-resolve-to-config④\">resolve to config</a> to <var>resolveToConfig</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>auctionConfig</var>.</p>"
        }
      ]
    },
    {
      "name": "validate a url macro",
      "href": "https://wicg.github.io/turtledove/#validate-a-url-macro",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-a-url-macro\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate a url macro</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦\">string</a> <var>macro</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return true if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>macro</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with①\">starts with</a> \"'${'\" and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-ends-with\" id=\"ref-for-string-ends-with\">ends with</a> \"'}'\";</p>\n       </li><li data-md=\"\">\n        <p><var>macro</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with②\">starts with</a> \"'%%'\" and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-ends-with\" id=\"ref-for-string-ends-with①\">ends with</a> \"'%%'\".</p>\n      </li></ul>"
        },
        {
          "html": "<p>Otherwise, return false.</p>"
        }
      ]
    },
    {
      "name": "update bid count",
      "href": "https://wicg.github.io/turtledove/#update-bid-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-bid-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update bid count</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑥\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①④\">interest group</a>s <var>igs</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⓪\">For each</a> <var>ig</var> in <var>igs</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>loadedIg</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⑤\">interest group</a> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②①\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②⓪\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②③\">owner</a> is <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②④\">owner</a> and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name⑥\">name</a> is <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name⑦\">name</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a> if none found.</p>"
            },
            {
              "html": "<p>If the most recent entry in <var>loadedIg</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bid-counts\" id=\"ref-for-interest-group-bid-counts①\">bid counts</a> corresponds to\nthe current day in UTC, increment its count. If not, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-insert\" id=\"ref-for-list-insert①\">insert</a> a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple①\">tuple</a> of\nthe time set to the current UTC day and a count of 1.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⑥\">interest group</a> that has <var>loadedIg</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⑤\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name⑧\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②②\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②①\">interest group set</a> with <var>loadedIg</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "update previous wins",
      "href": "https://wicg.github.io/turtledove/#update-previous-wins",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-previous-wins\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update previous wins</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid\">generated bid</a> <var>bid</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>ig</var> be <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group②\">interest group</a>.</p>"
        },
        {
          "html": "<p>Let <var>loadedIg</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⑦\">interest group</a> from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②③\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②②\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⑥\">owner</a> is <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⑦\">owner</a> and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name⑨\">name</a> is <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①⓪\">name</a>, return if none found.</p>"
        },
        {
          "html": "<p>Let <var>win</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win\" id=\"ref-for-previous-win\">previous win</a>.</p>"
        },
        {
          "html": "<p>Set <var>win</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-time\" id=\"ref-for-previous-win-time\">time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time⑤\">current wall time</a>.</p>"
        },
        {
          "html": "<p>Let <var>ad</var> be an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①\">interest group ad</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①\">render url</a> is <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad①\">bid ad</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url②\">render url</a>, whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata①\">metadata</a> is <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad②\">bid ad</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata②\">metadata</a>, and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-ad-render-id\" id=\"ref-for-interest-group-ad-ad-render-id\">ad render ID</a> is <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad③\">bid ad</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-ad-render-id\" id=\"ref-for-interest-group-ad-ad-render-id①\">ad render ID</a>.</p>"
        },
        {
          "html": "<p>Set <var>win</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-ad-json\" id=\"ref-for-previous-win-ad-json\">ad json</a> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string\">serializing an Infra value to a JSON string</a> given <var>ad</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑦\">Append</a> <var>win</var> to <var>loadedIg</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-previous-wins\" id=\"ref-for-interest-group-previous-wins①\">previous wins</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace①\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⑧\">interest group</a> that has <var>loadedIg</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⑧\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①①\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②④\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②③\">interest group set</a> with <var>loadedIg</var>.</p>"
        }
      ]
    },
    {
      "name": "build bid generators map",
      "href": "https://wicg.github.io/turtledove/#build-bid-generators-map",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"build-bid-generators-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">build bid generators map</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config③\">auction config</a> <var>auctionConfig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>bidGenerators</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①⓪\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑧\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①①\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#per-buyer-bid-generator\" id=\"ref-for-per-buyer-bid-generator\">per buyer bid generators</a>.</p>"
        },
        {
          "html": "<p>Let <var>negativeTargetInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-target-info\" id=\"ref-for-negative-target-info\">negative target info</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②①\">For each</a> <var>buyer</var> in <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers\" id=\"ref-for-auction-config-interest-group-buyers③\">interest group buyers</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②②\">For each</a> <var>ig</var> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②⑤\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②④\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner②⑨\">owner</a> is <var>buyer</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>igName</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①②\">name</a>.</p>"
                },
                {
                  "html": "If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key①\">additional bid key</a> is not null:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①④\">Set</a> <var>negativeTargetInfo</var>[(<var>buyer</var>, <var>igName</var>)] to (<var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-joining-origin\" id=\"ref-for-interest-group-joining-origin③\">joining origin</a>, <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key②\">additional bid key</a>).</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑨\">Continue</a> if any of the following conditions hold:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url①\">bidding url</a> is null;</p>\n           </li><li data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①\">ads</a> is null, or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is empty</a>;</p>\n           </li><li data-md=\"\">\n            <p>the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-if-required-seller-capabilities-are-permitted\" id=\"ref-for-check-if-required-seller-capabilities-are-permitted\">check if required seller capabilities are permitted</a> with <var>auctionConfig</var> and <var>ig</var> is false.</p>\n          </li></ul>"
                },
                {
                  "html": "<p>Let <var>signalsUrl</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-url\" id=\"ref-for-interest-group-trusted-bidding-signals-url①\">trusted bidding signals url</a>.</p>"
                },
                {
                  "html": "<p>Let <var>slotSizeQueryParam</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#calculate-the-ad-slot-size-query-param\" id=\"ref-for-calculate-the-ad-slot-size-query-param\">calculating the ad slot size query param</a> given <var>ig</var> and <var>auctionConfig</var>.</p>"
                },
                {
                  "html": "<p>Let <var>joiningOrigin</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-joining-origin\" id=\"ref-for-interest-group-joining-origin④\">joining origin</a>.</p>"
                },
                {
                  "html": "If <var>bidGenerators</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥①\">contain</a> <var>buyer</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>perBuyerGenerator</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#per-buyer-bid-generator\" id=\"ref-for-per-buyer-bid-generator①\">per buyer bid generator</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>perSignalsUrlGenerator</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#per-signals-url-bid-generator\" id=\"ref-for-per-signals-url-bid-generator\">per signals url bid generator</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑤\">Set</a> <var>perSignalsUrlGenerator</var>[<var>joiningOrigin</var>] to « <var>ig</var> ».</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑥\">Set</a> <var>perSlotSizeQueryParam</var>[<var>slotSizeQueryParam</var>] to <var>perSignalsUrlGenerator</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑦\">Set</a> <var>perBuyerGenerator</var>[<var>signalsUrl</var>] to <var>perSlotSizeQueryParam</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑧\">Set</a> <var>bidGenerators</var>[<var>buyer</var>] to <var>perBuyerGenerator</var>.</p>"
                    },
                    {
                      "html": "<p>TODO: add a perBiddingScriptUrlGenerator layer that replaces the list of IGs with a map\nfrom biddingScriptUrl to a list of IGs.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>perBuyerGenerator</var> be <var>bidGenerators</var>[<var>buyer</var>].</p>"
                    },
                    {
                      "html": "If <var>perBuyerGenerator</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥②\">contain</a> <var>signalsUrl</var>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>perSignalsUrlGenerator</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#per-signals-url-bid-generator\" id=\"ref-for-per-signals-url-bid-generator①\">per signals url bid generator</a>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑨\">Set</a> <var>perSignalsUrlGenerator</var>[<var>joiningOrigin</var>] to « <var>ig</var> ».</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⓪\">Set</a> <var>perSlotSizeQueryParam</var>[<var>slotSizeQueryParam</var>] to <var>perSignalsUrlGenerator</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②①\">Set</a> <var>perBuyerGenerator</var>[<var>signalsUrl</var>] to <var>perSlotSizeQueryParam</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "Otherwise:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>perSlotSizeQueryParam</var> be <var>perBuyerGenerator</var>[<var>signalsUrl</var>].</p>"
                        },
                        {
                          "html": "If <var>perSlotSizeQueryParam</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥③\">contain</a> <var>slotSizeQueryParam</var>:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>perSignalsUrlGenerator</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#per-signals-url-bid-generator\" id=\"ref-for-per-signals-url-bid-generator②\">per signals url bid generator</a>.</p>"
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②②\">Set</a> <var>perSignalsUrlGenerator</var>[<var>joiningOrigin</var>] to « <var>ig</var> ».</p>"
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②③\">Set</a> <var>perSlotSizeQueryParam</var>[<var>slotSizeQueryParam</var>] to <var>perSignalsUrlGenerator</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "Otherwise:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>perSignalsUrlGenerator</var> be <var>perSlotSizeQueryParam</var>[<var>slotSizeQueryParam</var>].</p>"
                            },
                            {
                              "html": "<p>If <var>perSignalsUrlGenerator</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥④\">contain</a> <var>joiningOrigin</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②④\">set</a> <var>perSignalsUrlGenerator</var>[<var>joiningOrigin</var>] to « <var>ig</var> ».</p>"
                            },
                            {
                              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑧\">append</a> <var>ig</var> to <var>perSignalsUrlGenerator</var>[<var>joiningOrigin</var>].</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return « <var>bidGenerators</var>, <var>negativeTargetInfo</var> ».</p>"
        }
      ]
    },
    {
      "name": "check if required seller capabilities are permitted",
      "href": "https://wicg.github.io/turtledove/#check-if-required-seller-capabilities-are-permitted",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-if-required-seller-capabilities-are-permitted\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check if required seller capabilities are permitted</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config④\">auction config</a> <var>auctionConfig</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group①⑨\">interest group</a> <var>ig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>seller</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller③\">seller</a>.</p>"
        },
        {
          "html": "<p>Let <var>requiredSellerCapabilities</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-required-seller-capabilities\" id=\"ref-for-auction-config-required-seller-capabilities①\">required seller capabilities</a>.</p>"
        },
        {
          "html": "<p>Return true if all of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities④\">seller capabilities</a> is not null;</p>\n       </li><li data-md=\"\">\n        <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities⑤\">seller capabilities</a>[<var>seller</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑤\">exists</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>requiredSellerCapabilities</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-subset\" id=\"ref-for-set-subset\">subset</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities⑥\">seller capabilities</a>[<var>seller</var>].</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "generate potentially multiple bids",
      "href": "https://wicg.github.io/turtledove/#generate-potentially-multiple-bids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-potentially-multiple-bids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate potentially multiple bids</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤\">ordered map</a>-or-null <var>allTrustedBiddingSignals</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑨\">origin</a>-or-null <var>crossOriginTrustedBiddingSignalsOrigin</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑧\">string</a> <var>auctionSignals</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-biddingbrowsersignals\" id=\"ref-for-dictdef-biddingbrowsersignals\">BiddingBrowserSignals</a></code> <var>browserSignals</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑨\">string</a>-or-null <var>perBuyerSignals</var>,\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforbuyer\" id=\"ref-for-dictdef-directfromsellersignalsforbuyer\">DirectFromSellerSignalsForBuyer</a></code> <var>directFromSellerSignalsForBuyer</var>, a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①\">duration</a> <var>perBuyerTimeout</var> in milliseconds, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag①\">currency tag</a> <var>expectedCurrency</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short④\">unsigned short</a></code> <var>multiBidLimit</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②⓪\">interest group</a> <var>ig</var>, and a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment①\">moment</a> <var>auctionStartTime</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⓪\">origin</a> <var>frameOrigin</var>, perform the following steps. They return a failure if failing to fetch\nthe script or wasm, otherwise a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple②\">tuple</a> of (<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑦\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①\">generated bids</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info①\">bid debug reporting info</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution\">real time reporting contributions</a>).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>igGenerateBid</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-an-interest-group-passed-to-generatebid\" id=\"ref-for-build-an-interest-group-passed-to-generatebid\">building an interest group passed to generateBid</a> with <var>ig</var>.</p>"
        },
        {
          "html": "<p>Set <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-joincount\" id=\"ref-for-dom-biddingbrowsersignals-joincount\">joinCount</a></code>\"] to the sum of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-counts\" id=\"ref-for-interest-group-join-counts②\">join counts</a> for all days within the last 30 days.</p>"
        },
        {
          "html": "<p>Set <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-recency\" id=\"ref-for-dom-biddingbrowsersignals-recency\">recency</a></code>\"] to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time⑥\">current wall time</a> minus <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-time\" id=\"ref-for-interest-group-join-time①\">join time</a>, in milliseconds.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑤\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-bidcount\" id=\"ref-for-dom-biddingbrowsersignals-bidcount\">bidCount</a></code>\"] to the sum of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bid-counts\" id=\"ref-for-interest-group-bid-counts②\">bid counts</a> for all days within the last 30 days.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑥\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-adcomponentslimit\" id=\"ref-for-dom-biddingbrowsersignals-adcomponentslimit\">adComponentsLimit</a></code>\"] to 40.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑦\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-multibidlimit\" id=\"ref-for-dom-biddingbrowsersignals-multibidlimit\">multiBidLimit</a></code>\"] to <var>multiBidLimit</var>.</p>"
        },
        {
          "html": "<p>Let <var>prevWins</var> be a new <code><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①①\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-previouswin\" id=\"ref-for-dictdef-previouswin\">PreviousWin</a></code>&gt;</code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②③\">For each</a> <var>prevWin</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-previous-wins\" id=\"ref-for-interest-group-previous-wins②\">previous wins</a> for all days within the\nthe last 30 days:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>timeDelta</var> be <var>auctionStartTime</var> minus <var>prevWin</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-time\" id=\"ref-for-previous-win-time①\">time</a>.</p>"
            },
            {
              "html": "<p>Set <var>timeDelta</var> to 0 if <var>timeDelta</var> is negative, <var>timeDelta</var>’s nearest second (rounding down)\notherwise.</p>"
            },
            {
              "html": "<p>Let <var>prevWinIDL</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-previouswin\" id=\"ref-for-dictdef-previouswin①\">PreviousWin</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑧\">Set</a> <var>prevWinIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-previouswin-timedelta\" id=\"ref-for-dom-previouswin-timedelta\">timeDelta</a></code>\"] to <var>timeDelta</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⑨\">Set</a> <var>prevWinIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-previouswin-adjson\" id=\"ref-for-dom-previouswin-adjson\">adJSON</a></code>\"] to <var>prevWin</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-ad-json\" id=\"ref-for-previous-win-ad-json①\">ad json</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑨\">Append</a> <var>prevWinIDL</var> to <var>prevWins</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⓪\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-prevwinsms\" id=\"ref-for-dom-biddingbrowsersignals-prevwinsms\">prevWinsMs</a></code>\"] to <var>prevWins</var>.</p>"
        },
        {
          "html": "<p>Let <var>biddingScriptFetcher</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-fetcher\" id=\"ref-for-create-a-new-script-fetcher\">creating a new script fetcher</a> with <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url②\">bidding url</a>, and <var>frameOrigin</var>.</p>"
        },
        {
          "html": "<p>Let <var>biddingScript</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-for-script-body-from-a-fetcher\" id=\"ref-for-wait-for-script-body-from-a-fetcher\">waiting for script body from a fetcher</a> given <var>biddingScriptFetcher</var>.</p>"
        },
        {
          "html": "<p>If <var>biddingScript</var> is failure, return failure.</p>"
        },
        {
          "html": "If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-wasm-helper-url\" id=\"ref-for-interest-group-bidding-wasm-helper-url①\">bidding wasm helper url</a> is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>wasmModuleObject</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-webassembly\" id=\"ref-for-fetch-webassembly\">fetching WebAssembly</a> with <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-wasm-helper-url\" id=\"ref-for-interest-group-bidding-wasm-helper-url②\">bidding wasm helper url</a> and <var>frameOrigin</var>.</p>"
            },
            {
              "html": "<p>If <var>wasmModuleObject</var> is not failure, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③①\">set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-wasmhelper\" id=\"ref-for-dom-biddingbrowsersignals-wasmhelper\">wasmHelper</a></code>\"] to <var>wasmModuleObject</var>.</p>"
            },
            {
              "html": "<p>Otherwise, return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>trustedBiddingSignals</var> be null.</p>"
        },
        {
          "html": "If <var>allTrustedBiddingSignals</var> is not null:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a> that <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys①\">trusted bidding signals keys</a> is not null.</p>"
            },
            {
              "html": "<p>Set <var>trustedBiddingSignals</var> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑥\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①①\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⓪\">strings</a> and\nwhose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①②\">values</a> are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-any\" id=\"ref-for-idl-any⑤\">any</a></code>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②④\">For each</a> <var>key</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys②\">trusted bidding signals keys</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>allTrustedBiddingSignals</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑥\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③②\">set</a> <var>trustedBiddingSignals</var>[<var>key</var>] to <var>allTrustedBiddingSignals</var>[<var>key</var>].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>sameOriginTrustedBiddingSignals</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>crossOriginTrustedBiddingSignals</var> be null.</p>"
        },
        {
          "html": "If <var>trustedBiddingSignals</var> is not null:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>crossOriginTrustedBiddingSignalsOrigin</var> is null, then set <var>sameOriginTrustedBiddingSignals</var> to <var>trustedBiddingSignals</var>.</p>"
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>crossOriginTrustedBiddingSignals</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑦\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①②\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①③\">values</a> are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-any\" id=\"ref-for-idl-any⑥\">any</a></code>.</p>"
                },
                {
                  "html": "<p>Let <var>originKey</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin\">serialization</a> of <var>crossOriginTrustedBiddingSignalsOrigin</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③③\">Set</a> <var>crossOriginTrustedBiddingSignalsOrigin</var>[<var>originKey</var>] to <var>trustedBiddingSignals</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-bidding-script\" id=\"ref-for-evaluate-a-bidding-script\">evaluating a bidding script</a> with <var>biddingScript</var>, <var>multiBidLimit</var>, <var>ig</var>, <var>expectedCurrency</var>, <var>igGenerateBid</var>, <var>auctionSignals</var>, <var>perBuyerSignals</var>, <var>sameOriginTrustedBiddingSignals</var>, <var>crossOriginTrustedBiddingSignals</var>, <var>browserSignals</var>, <var>directFromSellerSignalsForBuyer</var>.\nand <var>perBuyerTimeout</var>.</p>"
        }
      ]
    },
    {
      "name": "generate and score bids",
      "href": "https://wicg.github.io/turtledove/#generate-and-score-bids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"generate-and-score-bids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">generate and score bids</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config⑤\">auction config</a> <var>auctionConfig</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config⑥\">auction config</a>-or-null <var>topLevelAuctionConfig</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object\">global object</a> <var>global</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①①\">origin</a> <var>topLevelOrigin</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑨\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②①\">interest groups</a> <var>bidIgs</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info②\">bid debug reporting info</a> <var>bidDebugReportInfoList</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map①\">real time reporting contributions map</a> <var>realTimeContributionsMap</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>settings</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑥\">relevant settings object</a>.</p>"
        },
        {
          "html": "<p>Let <var>frameOrigin</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin④\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>seller</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller④\">seller</a>.</p>"
        },
        {
          "html": "<p>Let <var>auctionStartTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time⑦\">current wall time</a>.</p>"
        },
        {
          "html": "<p>Let <var>decisionLogicFetcher</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-fetcher\" id=\"ref-for-create-a-new-script-fetcher①\">creating a new script fetcher</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-decision-logic-url\" id=\"ref-for-auction-config-decision-logic-url①\">decision logic url</a> and <var>frameOrigin</var>.</p>"
        },
        {
          "html": "<p>Let <var>seller</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller⑤\">seller</a>.</p>"
        },
        {
          "html": "<p>Let « <var>bidGenerators</var>, <var>negativeTargetInfo</var> » be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-bid-generators-map\" id=\"ref-for-build-bid-generators-map\">build bid generators map</a> with <var>auctionConfig</var>.</p>"
        },
        {
          "html": "<p>Let <var>leadingBidInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info②\">leading bid info</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue②\">starting a new parallel queue</a>.</p>"
        },
        {
          "html": "<p>Let <var>capturedAuctionHeaders</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑤\">associated Document’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable\">traversable navigable’s</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-signals-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-signals-headers\">captured ad auction signals headers</a>.</p>"
        },
        {
          "html": "If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions③\">component auctions</a> are not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">empty</a>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a> <var>topLevelAuctionConfig</var> is null.</p>"
            },
            {
              "html": "<p>Let <var>pendingComponentAuctions</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions④\">component auctions</a>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑤\">size</a>.</p>"
            },
            {
              "html": "<p>Let <var>topLevelDirectFromSellerSignalsForSeller</var> be null.</p>"
            },
            {
              "html": "<p>Let <var>topLevelDirectFromSellerSignalsRetrieved</var> be false.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑤\">For each</a> <var>component</var> in <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions⑤\">component auctions</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps②\">enqueue the following steps</a> to <var>queue</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>compWinnerInfo</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generate-and-score-bids\" id=\"ref-for-generate-and-score-bids①\">generate and score bids</a> with <var>component</var>, <var>auctionConfig</var>, <var>global</var>, <var>topLevelOrigin</var>, <var>bidIgs</var>, <var>bidDebugReportInfoList</var>, and <var>realTimeContributionsMap</var>.</p>"
                },
                {
                  "html": "<p>If <var>compWinnerInfo</var> is failure, return failure.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#recursively-wait-until-configuration-input-promises-resolve\" id=\"ref-for-recursively-wait-until-configuration-input-promises-resolve\">recursively wait until configuration input promises resolve</a> given <var>auctionConfig</var> returns\nfailure, return failure.</p>"
                },
                {
                  "html": "If <var>topLevelDirectFromSellerSignalsRetrieved</var> is false:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>topLevelDirectFromSellerSignals</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals\" id=\"ref-for-get-direct-from-seller-signals\">get direct from seller signals</a> given <var>seller</var>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot②\">direct from seller signals header ad slot</a>, and <var>capturedAuctionHeaders</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>topLevelDirectFromSellerSignalsForSeller</var> to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-seller\" id=\"ref-for-get-direct-from-seller-signals-for-a-seller\">get direct from seller signals for a seller</a> given <var>topLevelDirectFromSellerSignals</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>topLevelDirectFromSellerSignalsRetrieved</var> to true.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>compWinnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid⑤\">leading bid</a> is not null, then run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#score-and-rank-a-bid\" id=\"ref-for-score-and-rank-a-bid\">score and rank a bid</a> with <var>auctionConfig</var>, <var>compWinnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid⑥\">leading bid</a>, <var>leadingBidInfo</var>, <var>decisionLogicFetcher</var>,\nnull, \"top-level-auction\", null, and <var>topLevelOrigin</var>.</p>"
                },
                {
                  "html": "<p>If <var>compWinnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid③\">leading non-k-anon-enforced bid</a> is not null, then run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#score-and-rank-a-bid\" id=\"ref-for-score-and-rank-a-bid①\">score and rank a bid</a> with <var>auctionConfig</var>, <var>compWinnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid④\">leading non-k-anon-enforced bid</a>, <var>leadingBidInfo</var>, <var>decisionLogicFetcher</var>, <var>topLevelDirectFromSellerSignalsForSeller</var>, null,\n\"top-level-auction\", null, <var>topLevelOrigin</var> and <var>realTimeContributionsMap</var>..</p>"
                },
                {
                  "html": "<p>Decrement <var>pendingComponentAuctions</var> by 1.</p>"
                }
              ]
            },
            {
              "html": "<p>Wait until <var>pendingComponentAuctions</var> is 0.</p>"
            },
            {
              "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid⑦\">leading bid</a> is null, return null.</p>"
            },
            {
              "html": "<p>Let <var>winningComponentConfig</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config\">auction config</a>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config①\">auction config</a> to <var>auctionConfig</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller①\">component seller</a> to <var>winningComponentConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller⑥\">seller</a>.</p>"
            },
            {
              "html": "<p>Let « <var>topLevelSellerSignals</var>, unusedTopLevelReportResultBrowserSignals » be the result of\nrunning <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#report-result\" id=\"ref-for-report-result\">report result</a> with <var>leadingBidInfo</var>, <var>topLevelDirectFromSellerSignalsForSeller</var>, <var>winningComponentConfig</var>, and <var>global</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config②\">auction config</a> to <var>winningComponentConfig</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller②\">component seller</a> to null.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-level-seller\" id=\"ref-for-leading-bid-info-top-level-seller\">top level seller</a> to <var>seller</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-level-seller-signals\" id=\"ref-for-leading-bid-info-top-level-seller-signals\">top level seller signals</a> to <var>topLevelSellerSignals</var>.</p>"
            },
            {
              "html": "<p>Let <var>directFromSellerSignals</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals\" id=\"ref-for-get-direct-from-seller-signals①\">get direct from seller signals</a> given <var>winningComponentConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller⑦\">seller</a>, <var>winningComponentConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot③\">direct from seller signals header ad slot</a>, and <var>capturedAuctionHeaders</var>.</p>"
            },
            {
              "html": "<p>Let <var>directFromSellerSignalsForSeller</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-seller\" id=\"ref-for-get-direct-from-seller-signals-for-a-seller①\">get direct from seller signals for a seller</a> given <var>directFromSellerSignals</var>.</p>"
            },
            {
              "html": "<p>Let <var>directFromSellerSignalsForBuyer</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-buyer\" id=\"ref-for-get-direct-from-seller-signals-for-a-buyer\">get direct from seller signals for a buyer</a> with <var>directFromSellerSignals</var>, and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid⑧\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group③\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⓪\">owner</a>.</p>"
            },
            {
              "html": "<p>Let « <var>sellerSignals</var>, <var>reportResultBrowserSignals</var> » be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#report-result\" id=\"ref-for-report-result①\">report result</a> with <var>leadingBidInfo</var>, <var>directFromSellerSignalsForSeller</var>, null, and <var>global</var>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#report-win\" id=\"ref-for-report-win\">report win</a> with <var>leadingBidInfo</var>, <var>sellerSignals</var>, <var>reportResultBrowserSignals</var>, <var>directFromSellerSignalsForBuyer</var>, and <var>frameOrigin</var>.</p>"
            },
            {
              "html": "<p>Return <var>leadingBidInfo</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-until-configuration-input-promises-resolve\" id=\"ref-for-wait-until-configuration-input-promises-resolve\">waiting until configuration input promises resolve</a> given <var>auctionConfig</var> returns failure,\nthen return failure.</p>"
        },
        {
          "html": "<p>Let <var>allBuyersExperimentGroupId</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyer-experiment-group-id\" id=\"ref-for-auction-config-all-buyer-experiment-group-id①\">all buyer experiment group id</a>.</p>"
        },
        {
          "html": "<p>Let <var>allBuyersGroupLimit</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-group-limit\" id=\"ref-for-auction-config-all-buyers-group-limit①\">all buyers group limit</a>.</p>"
        },
        {
          "html": "<p>Let <var>auctionSignals</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals④\">auction signals</a>.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignals</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals\" id=\"ref-for-get-direct-from-seller-signals②\">get direct from seller signals</a> given <var>seller</var>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot④\">direct from seller signals header ad slot</a>, and <var>capturedAuctionHeaders</var>.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignalsForSeller</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-seller\" id=\"ref-for-get-direct-from-seller-signals-for-a-seller②\">get direct from seller signals for a seller</a> given <var>directFromSellerSignals</var>.</p>"
        },
        {
          "html": "<p>Let <var>browserSignals</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-biddingbrowsersignals\" id=\"ref-for-dictdef-biddingbrowsersignals①\">BiddingBrowserSignals</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>topLevelHost</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-serializer\" id=\"ref-for-concept-host-serializer\">host serializer</a> on <var>topLevelOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host\">host</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③④\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-topwindowhostname\" id=\"ref-for-dom-biddingbrowsersignals-topwindowhostname\">topWindowHostname</a></code>\"] to <var>topLevelHost</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑤\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-seller\" id=\"ref-for-dom-biddingbrowsersignals-seller\">seller</a></code>\"] to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①\">serialization</a> of <var>seller</var>.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size④\">requested size</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑥\">set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-requestedsize\" id=\"ref-for-dom-biddingbrowsersignals-requestedsize\">requestedSize</a></code>\"] to the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-map\" id=\"ref-for-convert-an-ad-size-to-a-map\">convert an ad size to a map</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size⑤\">requested size</a>.</p>"
        },
        {
          "html": "<p>Let <var>auctionLevel</var> be \"single-level-auction\".</p>"
        },
        {
          "html": "<p>Let <var>componentAuctionExpectedCurrency</var> be null.</p>"
        },
        {
          "html": "If <var>topLevelAuctionConfig</var> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑦\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-toplevelseller\" id=\"ref-for-dom-biddingbrowsersignals-toplevelseller\">topLevelSeller</a></code>\"]] to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin②\">serialization</a> of <var>topLevelAuctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller⑧\">seller</a>.</p>"
            },
            {
              "html": "<p>Set <var>auctionLevel</var> to \"component-auction\".</p>"
            },
            {
              "html": "<p>Set <var>componentAuctionExpectedCurrency</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-currency\" id=\"ref-for-look-up-per-buyer-currency\">looking up per-buyer currency</a> with <var>topLevelAuctionConfig</var> and <var>seller</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>pendingBuyers</var> be <var>bidGenerators</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-size\" id=\"ref-for-map-size①\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>additionalBids</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-and-convert-additional-bids\" id=\"ref-for-validate-and-convert-additional-bids\">validate and convert additional bids</a> with <var>auctionConfig</var>, <var>topLevelAuctionConfig</var>, <var>negativeTargetInfo</var> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>pendingAdditionalBids</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑥\">size</a> of <var>additionalBids</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑥\">For each</a> <var>additionalBid</var> of <var>additionalBids</var>, run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a>:",
          "rationale": "score",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#score-and-rank-a-bid\" id=\"ref-for-score-and-rank-a-bid②\">Score and rank a bid</a> with <var>auctionConfig</var>, <var>additionalBid</var>, <var>leadingBidInfo</var>, <var>decisionLogicFetcher</var>, <var>directFromSellerSignalsForSeller</var>, null, <var>auctionLevel</var>, <var>componentAuctionExpectedCurrency</var>, <var>topLevelOrigin</var> , and <var>realTimeContributionsMap</var>.</p>"
            },
            {
              "html": "<p>Decrement <var>pendingAdditionalBids</var> by 1.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①②\">For each</a> <var>buyer</var> → <var>perBuyerGenerator</var> of <var>bidGenerators</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps③\">enqueue the following steps</a> to <var>queue</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>perBuyerCumulativeTimeout</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-cumulative-timeout\" id=\"ref-for-auction-config-all-buyers-cumulative-timeout①\">all buyers cumulative timeout</a>.</p>"
            },
            {
              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-cumulative-timeouts\" id=\"ref-for-auction-config-per-buyer-cumulative-timeouts①\">per buyer cumulative timeouts</a> is not null and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-cumulative-timeouts\" id=\"ref-for-auction-config-per-buyer-cumulative-timeouts②\">per buyer cumulative timeouts</a>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑦\">exists</a>, then set <var>perBuyerCumulativeTimeout</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-cumulative-timeouts\" id=\"ref-for-auction-config-per-buyer-cumulative-timeouts③\">per buyer cumulative timeouts</a>[<var>buyer</var>].</p>"
            },
            {
              "html": "<p>Let <var>buyerExperimentGroupId</var> be <var>allBuyersExperimentGroupId</var>.</p>"
            },
            {
              "html": "<p>Let <var>perBuyerExperimentGroupIds</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-experiment-group-ids\" id=\"ref-for-auction-config-per-buyer-experiment-group-ids①\">per buyer experiment group ids</a>.</p>"
            },
            {
              "html": "<p>If <var>perBuyerExperimentGroupIds</var> is not null and <var>perBuyerExperimentGroupIds</var>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑧\">exists</a>, then set <var>buyerExperimentGroupId</var> to <var>perBuyerExperimentGroupIds</var>[<var>buyer</var>].</p>"
            },
            {
              "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-interest-groups-limits-to-prioritized-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Apply interest groups limits to prioritized list</dfn>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>buyerGroupLimit</var> be <var>allBuyersGroupLimit</var>.</p>"
                },
                {
                  "html": "<p>Let <var>perBuyerGroupLimits</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-group-limits\" id=\"ref-for-auction-config-per-buyer-group-limits①\">per buyer group limits</a>.</p>"
                },
                {
                  "html": "<p>If <var>perBuyerGroupLimits</var> is not null and <var>perBuyerGroupLimits</var>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑨\">exists</a>, then\nset <var>buyerGroupLimit</var> to <var>perBuyerGroupLimits</var>[<var>buyer</var>].</p>"
                },
                {
                  "html": "<p>Let <var>igs</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②②\">interest groups</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①③\">For each</a> signalsUrl → <var>perSlotSizeQueryParam</var> of <var>perBuyerGenerator</var>:",
                  "rationale": "for",
                  "steps": [
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①④\">For each</a> slotSizeQueryParam → <var>perSignalsUrlGenerator</var> of <var>perSlotSizeQueryParam</var>:",
                      "rationale": "for",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⑤\">For each</a> joiningOrigin → <var>groups</var> of <var>perSignalsUrlGenerator</var>:",
                          "rationale": "extend",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend\">Extend</a> <var>igs</var> with <var>groups</var>.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-descending-order\" id=\"ref-for-list-sort-in-descending-order②\">Sort in descending order</a> <var>igs</var>, with <var>a</var> being less than <var>b</var> if <var>a</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority①\">priority</a> is less than <var>b</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority②\">priority</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑧\">Remove</a> the first <var>buyerGroupLimit</var> items from <var>igs</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⑥\">For each</a> signalsUrl → <var>perSlotSizeQueryParam</var> of <var>perBuyerGenerator</var>:",
                  "rationale": "for",
                  "steps": [
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⑦\">For each</a> slotSizeQueryParam → <var>perSignalsUrlGenerator</var> of <var>perSlotSizeQueryParam</var>:",
                      "rationale": "for",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⑧\">For each</a> joiningOrigin → <var>groups</var> of <var>perSignalsUrlGenerator</var>:",
                          "rationale": "remove",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑨\">Remove</a> from <var>groups</var> any <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②③\">interest group</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contained</a> in <var>igs</var>.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Let <var>perBuyerSignals</var> be null.</p>"
            },
            {
              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals⑤\">per buyer signals</a> is not null and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals⑥\">per buyer signals</a>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⓪\">exists</a>, then set <var>perBuyerSignals</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals⑦\">per buyer signals</a>[<var>buyer</var>].</p>"
            },
            {
              "html": "<p>Let <var>perBuyerTimeout</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-timeout\" id=\"ref-for-auction-config-all-buyers-timeout①\">all buyers timeout</a>.</p>"
            },
            {
              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-timeouts\" id=\"ref-for-auction-config-per-buyer-timeouts①\">per buyer timeouts</a> is not null and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-timeouts\" id=\"ref-for-auction-config-per-buyer-timeouts②\">per buyer timeouts</a>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦①\">exists</a>, then set <var>perBuyerTimeout</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-timeouts\" id=\"ref-for-auction-config-per-buyer-timeouts③\">per buyer timeouts</a>[<var>buyer</var>].</p>"
            },
            {
              "html": "<p>Let <var>expectedCurrency</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-currency\" id=\"ref-for-look-up-per-buyer-currency①\">looking up per-buyer currency</a> with <var>auctionConfig</var> and <var>buyer</var>.</p>"
            },
            {
              "html": "<p>Let <var>multiBidLimit</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-multi-bid-limit\" id=\"ref-for-look-up-per-buyer-multi-bid-limit\">looking up per-buyer multi-bid limit</a> with <var>auctionConfig</var> and <var>buyer</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑧\">Set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-fordebuggingonlyincooldownorlockout\" id=\"ref-for-dom-biddingbrowsersignals-fordebuggingonlyincooldownorlockout\">forDebuggingOnlyInCooldownOrLockout</a></code>\"]\nto the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#is-debugging-only-in-cooldown-or-lockout\" id=\"ref-for-is-debugging-only-in-cooldown-or-lockout\">is debugging only in cooldown or lockout</a> with <var>buyer</var>.</p>"
            },
            {
              "html": "<p>Let <var>optedInForRealTimeReporting</var> be true if <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-real-time-reporting-config\" id=\"ref-for-auction-config-per-buyer-real-time-reporting-config①\">per buyer real time reporting config</a>[<var>buyer</var>] is \"<code>default-local-reporting</code>\",\nfalse otherwise.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①⑨\">For each</a> <var>slotSizeQueryParam</var> → <var>perSlotSizeQueryParam</var> of <var>perBuyerGenerator</var>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⓪\">For each</a> <var>signalsUrl</var> → <var>perSignalsUrlGenerator</var> of <var>perSlotSizeQueryParam</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>crossOriginTrustedBiddingSignalsOrigin</var> be null.</p>"
                    },
                    {
                      "html": "<p>If <var>buyer</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> with <var>signalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a>, then set <var>crossOriginTrustedBiddingSignalsOrigin</var> to <var>signalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>trustedBiddingSignalsBatcher</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher\" id=\"ref-for-trusted-bidding-signals-batcher\">trusted bidding signals batcher</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>fetchSignalStartTime</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time\">current monotonic time</a>.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②①\">For each</a> joiningOrigin → <var>groups</var> of <var>perSignalsUrlGenerator</var>:",
                      "rationale": "for",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑦\">For each</a> <var>ig</var> of <var>groups</var>:",
                          "rationale": "batch",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#batch-or-fetch-trusted-bidding-signals\" id=\"ref-for-batch-or-fetch-trusted-bidding-signals\">Batch or fetch trusted bidding signals</a> given <var>trustedBiddingSignalsBatcher</var>, <var>ig</var>, <var>signalsUrl</var>, <var>buyerExperimentGroupId</var>, <var>topLevelOrigin</var>, and <var>slotSizeQueryParam</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-the-current-outstanding-trusted-signals-batch\" id=\"ref-for-fetch-the-current-outstanding-trusted-signals-batch\">Fetch the current outstanding trusted signals batch</a> given <var>trustedBiddingSignalsBatcher</var>, <var>signalsUrl</var>, <var>buyer</var>, <var>buyerExperimentGroupId</var>, <var>topLevelOrigin</var>, and <var>slotSizeQueryParam</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#process-updateifolderthanms\" id=\"ref-for-process-updateifolderthanms\">Process updateIfOlderThanMs</a> with <var>buyer</var>, and <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-all-per-interest-group-data\" id=\"ref-for-trusted-bidding-signals-batcher-all-per-interest-group-data\">all per interest group data</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>fetchSignalDuration</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from\">duration from</a> <var>fetchSignalStartTime</var> to <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time①\">current monotonic time</a>, in milliseconds.</p>"
                    },
                    {
                      "html": "<p>If <var>perBuyerCumulativeTimeout</var> is not null, then decrement <var>perBuyerCumulativeTimeout</var> by <var>fetchSignalDuration</var>.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②②\">For each</a> joiningOrigin → <var>groups</var> of <var>perSignalsUrlGenerator</var>:",
                      "rationale": "for",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑧\">For each</a> <var>ig</var> of <var>groups</var>:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>perBuyerCumulativeTimeout</var> is negative, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">break</a>.</p>"
                            },
                            {
                              "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url③\">bidding url</a> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⓪\">continue</a>.</p>"
                            },
                            {
                              "html": "<p>If <var>perBuyerCumulativeTimeout</var> is not null and is less than <var>perBuyerTimeout</var>, then set <var>perBuyerTimeout</var> to <var>perBuyerCumulativeTimeout</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>generateBidStartTime</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time②\">current monotonic time</a>.</p>"
                            },
                            {
                              "html": "<p>Let <var>directFromSellerSignalsForBuyer</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-buyer\" id=\"ref-for-get-direct-from-seller-signals-for-a-buyer①\">get direct from seller signals for a buyer</a> with <var>directFromSellerSignals</var>, and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③①\">owner</a>.</p>"
                            },
                            {
                              "html": "<p>Let <var>dataVersion</var> be null.</p>"
                            },
                            {
                              "html": "<p>Let <var>allTrustedBiddingSignals</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑧\">ordered map</a>-or-null, initially null.</p>"
                            },
                            {
                              "html": "<p>Let <var>igName</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①③\">name</a>.</p>"
                            },
                            {
                              "html": "If <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-no-signals-flags\" id=\"ref-for-trusted-bidding-signals-batcher-no-signals-flags\">no signals flags</a>[<var>igName</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦②\">exist</a>:",
                              "rationale": "set",
                              "steps": [
                                {
                                  "html": "<p>Set <var>dataVersion</var> to <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-data-versions\" id=\"ref-for-trusted-bidding-signals-batcher-data-versions\">data versions</a>[<var>igName</var>].</p>"
                                },
                                {
                                  "html": "<p>Set <var>allTrustedBiddingSignals</var> to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-all-trusted-bidding-signals\" id=\"ref-for-trusted-bidding-signals-batcher-all-trusted-bidding-signals\">all trusted bidding signals</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "Otherwise if <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-no-signals-flags\" id=\"ref-for-trusted-bidding-signals-batcher-no-signals-flags①\">no signals flags</a>[<var>igName</var>] is \"fetch-failed\", and <var>optedInForRealTimeReporting</var> is true, then:",
                              "rationale": "add",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#add-a-platform-contribution\" id=\"ref-for-add-a-platform-contribution\">Add a platform contribution</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-failure-bucket\" id=\"ref-for-trusted-bidding-signals-failure-bucket\">trusted bidding signals failure bucket</a>, <var>realTimeContributionsMap</var>, and <var>igName</var>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-dataversion\" id=\"ref-for-dom-biddingbrowsersignals-dataversion\">dataVersion</a></code>\"].</p>"
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①\">Remove</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-crossorigindataversion\" id=\"ref-for-dom-biddingbrowsersignals-crossorigindataversion\">crossOriginDataVersion</a></code>\"].</p>"
                            },
                            {
                              "html": "If <var>dataVersion</var> is not null:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>crossOriginTrustedBiddingSignalsOrigin</var> is not null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③⑨\">set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-crossorigindataversion\" id=\"ref-for-dom-biddingbrowsersignals-crossorigindataversion①\">crossOriginDataVersion</a></code>\"] to <var>dataVersion</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⓪\">set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-dataversion\" id=\"ref-for-dom-biddingbrowsersignals-dataversion①\">dataVersion</a></code>\"] to <var>dataVersion</var>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Let « <var>bidsBatch</var>, <var>bidDebugReportInfo</var> » be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generate-potentially-multiple-bids\" id=\"ref-for-generate-potentially-multiple-bids\">generate potentially multiple bids</a> given <var>allTrustedBiddingSignals</var>, <var>crossOriginTrustedBiddingSignalsOrigin</var>, <var>auctionSignals</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone\">clone</a> of <var>browserSignals</var>, <var>perBuyerSignals</var>, <var>directFromSellerSignalsForBuyer</var>, <var>perBuyerTimeout</var>, <var>expectedCurrency</var>, <var>multiBidLimit</var>, <var>ig</var>, <var>auctionStartTime</var>, and <var>frameOrigin</var>.</p>"
                            },
                            {
                              "html": "If <var>generateBidResult</var> is failure, then:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>optedInForRealTimeReporting</var> is true, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#add-a-platform-contribution\" id=\"ref-for-add-a-platform-contribution①\">add a platform contribution</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-script-failure-bucket\" id=\"ref-for-bidding-script-failure-bucket\">bidding script failure bucket</a>, <var>realTimeContributionsMap</var> and <var>buyer</var>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①①\">Continue</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Let (<var>bidsBatch</var>, <var>bidDebugReportInfo</var>, <var>realTimeContributions</var>) be <var>generateBidResult</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>generateBidDuration</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from①\">duration from</a> <var>generateBidStartTime</var> to <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time③\">current monotonic time</a>, in milliseconds.</p>"
                            },
                            {
                              "html": "<p>If <var>perBuyerCumulativeTimeout</var> is not null, decrement <var>perBuyerCumulativeTimeout</var> by <var>generateBidDuration</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>bidsToScore</var> be the result of applying <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#adjust-bid-list-based-on-k-anonymity\" id=\"ref-for-adjust-bid-list-based-on-k-anonymity\">adjust bid list based on k-anonymity</a> to <var>bidsBatch</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>foundKAnonBids</var> be false.</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⑨\">For each</a> <var>generatedBid</var> of <var>bidsToScore</var>:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-for-k-anon-auction\" id=\"ref-for-generated-bid-for-k-anon-auction\">for k-anon auction</a> is true,\n set <var>foundKAnonBids</var> to true.</p>"
                                }
                              ]
                            },
                            {
                              "html": "If <var>bidsToScore</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty②\">is not empty</a> but <var>foundKAnonBids</var> is false:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>originalAds</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads⑥\">ads</a>.</p>"
                                },
                                {
                                  "html": "If <var>originalAds</var> is not null:",
                                  "rationale": "set",
                                  "steps": [
                                    {
                                      "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads⑦\">ads</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②②\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad②\">interest group ad</a>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⓪\">For each</a> <var>ad</var> in <var>originalAds</var>:",
                                      "rationale": "compute",
                                      "steps": [
                                        {
                                          "html": "<p>Compute <var>adHashCode</var> by getting the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-ad\" id=\"ref-for-compute-the-key-hash-of-ad\">compute the key hash of ad</a> given <var>ig</var> and <var>ad</var>.</p>"
                                        },
                                        {
                                          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-cache\" id=\"ref-for-query-k-anonymity-cache\">query k-anonymity cache</a> given <var>adHashCode</var> returns true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⓪\">append</a> <var>ad</var> to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads⑧\">ads</a>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Let <var>originalAdComponents</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components①\">ad components</a>.</p>"
                                },
                                {
                                  "html": "If <var>originalAdComponents</var> is not null:",
                                  "rationale": "set",
                                  "steps": [
                                    {
                                      "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components②\">ad components</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad③\">interest group ad</a>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③①\">For each</a> <var>adComponent</var> in <var>originalAdComponents</var>:",
                                      "rationale": "compute",
                                      "steps": [
                                        {
                                          "html": "<p>Compute <var>componentAdHashCode</var> by getting the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-component-ad\" id=\"ref-for-compute-the-key-hash-of-component-ad\">compute the key hash of component ad</a> given <var>adComponent</var>.</p>"
                                        },
                                        {
                                          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-cache\" id=\"ref-for-query-k-anonymity-cache①\">query k-anonymity cache</a> given <var>componentAdHashCode</var> returns true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①①\">append</a> <var>adComponent</var> to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components③\">ad components</a>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>If <var>perBuyerCumulativeTimeout</var> is not null and is &lt; <var>perBuyerTimeout</var>, then set <var>perBuyerTimeout</var> to <var>perBuyerCumulativeTimeout</var>.</p>"
                                },
                                {
                                  "html": "<p>Let <var>generateBidStartTime</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time④\">current monotonic time</a>.</p>"
                                },
                                {
                                  "html": "<p>Set (<var>generatedBids</var>, <var>bidDebugReportInfo</var>, <var>realTimeContributions</var>) to the result\nof running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generate-potentially-multiple-bids\" id=\"ref-for-generate-potentially-multiple-bids④\">generate potentially multiple bids</a> with <var>allTrustedBiddingSignals</var>, <var>crossOriginTrustedBiddingSignalsOrigin</var>, <var>auctionSignals</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone①\">clone</a> of <var>browserSignals</var>, <var>perBuyerSignals</var>, <var>directFromSellerSignalsForBuyer</var>, <var>perBuyerTimeout</var>, <var>expectedCurrency</var>,\n1 (for multiBidLimit), <var>ig</var>, <var>auctionStartTime</var>, and <var>frameOrigin</var>.</p>"
                                },
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads⑨\">ads</a> to <var>originalAds</var>.</p>"
                                },
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components④\">ad components</a> to <var>originalAdComponents</var>.</p>"
                                },
                                {
                                  "html": "<p>Let <var>generateBidDuration</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration-from\" id=\"ref-for-dfn-duration-from②\">duration from</a> <var>generateBidStartTime</var> to <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time⑤\">current monotonic time</a>, in milliseconds.</p>"
                                },
                                {
                                  "html": "<p>If <var>perBuyerCumulativeTimeout</var> is not null, then decrement <var>perBuyerCumulativeTimeout</var> by <var>generateBidDuration</var>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a> that <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑦\">size</a> of <var>generatedBids</var> ≤ 1.</p>"
                                },
                                {
                                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③②\">For each</a> <var>generatedBid</var> of <var>generatedBids</var>:",
                                  "rationale": "assert",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a> that <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-generated-bid-k-anonymity-count\" id=\"ref-for-query-generated-bid-k-anonymity-count\">query generated bid k-anonymity count</a> given <var>generatedBid</var> returns true.</p>"
                                    },
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#apply-any-component-ads-target-to-a-bid\" id=\"ref-for-apply-any-component-ads-target-to-a-bid\">Apply any component ads target to a bid</a> given <var>generatedBid</var>.</p>"
                                    },
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①②\">Append</a> <var>generatedBid</var> to <var>bidsToScore</var>.</p>"
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#register-bids-for-fordebuggingonly-reports\" id=\"ref-for-register-bids-for-fordebuggingonly-reports\">Register bids for forDebuggingOnly reports</a> given <var>bidsToScore</var>, <var>bidDebugReportInfo</var>, and <var>bidDebugReportInfoList</var>.</p>"
                            },
                            {
                              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-real-time-reporting-config\" id=\"ref-for-auction-config-per-buyer-real-time-reporting-config②\">per buyer real time reporting config</a>[<var>buyer</var>]\nis \"<code>default-local-reporting</code>\", then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#insert-entries-to-map\" id=\"ref-for-insert-entries-to-map\">insert entries to map</a> given <var>realTimeContributionsMap</var>, <var>buyer</var>, and <var>realTimeContributions</var>.</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③③\">For each</a> <var>bidToScore</var> of <var>bidsToScore</var>:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>bidToScore</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-for-k-anon-auction\" id=\"ref-for-generated-bid-for-k-anon-auction①\">for k-anon auction</a> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①③\">append</a> <var>bidToScore</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group④\">interest group</a> to <var>bidIgs</var>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#score-and-rank-a-bid\" id=\"ref-for-score-and-rank-a-bid③\">Score and rank a bid</a> with <var>auctionConfig</var>, <var>bidToScore</var>, <var>leadingBidInfo</var>, <var>decisionLogicFetcher</var>, <var>directFromSellerSignalsForSeller</var>, <var>dataVersion</var>, <var>auctionLevel</var>, <var>componentAuctionExpectedCurrency</var>, <var>topLevelOrigin</var>, and <var>realTimeContributionsMap</var>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Decrement <var>pendingBuyers</var> by 1.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait until both <var>pendingBuyers</var> and <var>pendingAdditionalBids</var> are 0.</p>"
        },
        {
          "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid⑨\">leading bid</a> is null, return null.</p>"
        },
        {
          "html": "If <var>topLevelAuctionConfig</var> is null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let « <var>sellerSignals</var>, <var>reportResultBrowserSignals</var> » be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#report-result\" id=\"ref-for-report-result②\">report result</a> with <var>leadingBidInfo</var>, <var>directFromSellerSignalsForSeller</var>, null, and <var>global</var>.</p>"
            },
            {
              "html": "<p>Let <var>directFromSellerSignalsForWinner</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-buyer\" id=\"ref-for-get-direct-from-seller-signals-for-a-buyer②\">get direct from seller signals for a buyer</a> with <var>directFromSellerSignals</var>, and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⓪\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group⑤\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③②\">owner</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#report-win\" id=\"ref-for-report-win①\">report win</a> with <var>leadingBidInfo</var>, <var>sellerSignals</var>, <var>reportResultBrowserSignals</var>, <var>directFromSellerSignalsForWinner</var>, and <var>frameOrigin</var>.</p>"
            }
          ]
        },
        {
          "html": "Let <var>replacements</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑨\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①③\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①②\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①④\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①③\">strings</a>.",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③④\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement\" id=\"ref-for-ad-keyword-replacement①\">ad keyword replacement</a>, <var>replacement</var>, within <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements⑤\">deprecated render url replacements</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>k</var> be <var>replacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement-match\" id=\"ref-for-ad-keyword-replacement-match②\">match</a>.</p>"
                },
                {
                  "html": "<p>Let <var>v</var> be <var>replacement</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-keyword-replacement-replacement\" id=\"ref-for-ad-keyword-replacement-replacement①\">replacement</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④①\">Set</a> <var>replacements</var>[<var>k</var>] to <var>v</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①①\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor③\">ad descriptor</a> to the\nresult of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros③\">substitute macros</a> with <var>replacements</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①②\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor④\">ad descriptor</a>.</p>"
        },
        {
          "html": "If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①③\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor⑤\">ad descriptors</a> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑤\">For each</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor⑥\">ad descriptor</a>, <var>adDescriptor</var>, within <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①④\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor⑦\">ad descriptors</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>adDescriptor</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframeutil-substitute-macros\" id=\"ref-for-fencedframeutil-substitute-macros④\">substitute macros</a> with <var>replacements</var> and <var>adDescriptor</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>leadingBidInfo</var>.</p>"
        }
      ]
    },
    {
      "name": "build an interest group passed to generateBid",
      "href": "https://wicg.github.io/turtledove/#build-an-interest-group-passed-to-generatebid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"build-an-interest-group-passed-to-generatebid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">build an interest group passed to generateBid</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②④\">interest group</a> <var>ig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>igGenerateBid</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidinterestgroup\" id=\"ref-for-dictdef-generatebidinterestgroup①\">GenerateBidInterestGroup</a></code> with the following fields:</p>\n      <dl>\n       <dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-owner\" id=\"ref-for-dom-generatebidinterestgroup-owner①\">owner</a></code> \n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin③\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③③\">owner</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-name\" id=\"ref-for-dom-generatebidinterestgroup-name①\">name</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①④\">name</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-enablebiddingsignalsprioritization\" id=\"ref-for-dom-generatebidinterestgroup-enablebiddingsignalsprioritization①\">enableBiddingSignalsPrioritization</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-enable-bidding-signals-prioritization\" id=\"ref-for-interest-group-enable-bidding-signals-prioritization①\">enable bidding signals prioritization</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-priorityvector\" id=\"ref-for-dom-generatebidinterestgroup-priorityvector②\">priorityVector</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-vector\" id=\"ref-for-interest-group-priority-vector①\">priority vector</a> if not null, otherwise not set. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-executionmode\" id=\"ref-for-dom-generatebidinterestgroup-executionmode①\">executionMode</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-execution-mode\" id=\"ref-for-interest-group-execution-mode①\">execution mode</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-biddinglogicurl\" id=\"ref-for-dom-generatebidinterestgroup-biddinglogicurl①\">biddingLogicURL</a></code> \n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-url\" id=\"ref-for-serialize-a-url\">serialization-or-undefined</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url④\">bidding url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-biddingwasmhelperurl\" id=\"ref-for-dom-generatebidinterestgroup-biddingwasmhelperurl①\">biddingWasmHelperURL</a></code> \n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-url\" id=\"ref-for-serialize-a-url①\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-wasm-helper-url\" id=\"ref-for-interest-group-bidding-wasm-helper-url③\">bidding wasm helper url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-updateurl\" id=\"ref-for-dom-generatebidinterestgroup-updateurl②\">updateURL</a></code> \n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-url\" id=\"ref-for-serialize-a-url②\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update-url\" id=\"ref-for-interest-group-update-url①\">update url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsurl\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsurl②\">trustedBiddingSignalsURL</a></code> \n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-url\" id=\"ref-for-serialize-a-url③\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-url\" id=\"ref-for-interest-group-trusted-bidding-signals-url②\">trusted bidding signals url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalskeys\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalskeys②\">trustedBiddingSignalsKeys</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys③\">trusted bidding signals keys</a>, if not null, otherwise not set. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode\" id=\"ref-for-dom-generatebidinterestgroup-trustedbiddingsignalsslotsizemode②\">trustedBiddingSignalsSlotSizeMode</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode①\">trusted bidding signals slot size mode</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength\" id=\"ref-for-dom-generatebidinterestgroup-maxtrustedbiddingsignalsurllength③\">maxTrustedBiddingSignalsURLLength</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length①\">max trusted bidding signals url length</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-userbiddingsignals\" id=\"ref-for-dom-generatebidinterestgroup-userbiddingsignals②\">userBiddingSignals</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-a-javascript-value\" id=\"ref-for-parse-a-json-string-to-a-javascript-value\">Parse a JSON string to a JavaScript value</a> given <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-user-bidding-signals\" id=\"ref-for-interest-group-user-bidding-signals①\">user bidding signals</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-ads\" id=\"ref-for-dom-generatebidinterestgroup-ads③\">ads</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①⓪\">ads</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-to-an-auctionad-sequence\" id=\"ref-for-convert-to-an-auctionad-sequence\">converted to an AuctionAd sequence</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidinterestgroup-adcomponents\" id=\"ref-for-dom-generatebidinterestgroup-adcomponents①\">adComponents</a></code> \n       </dt><dd><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components⑤\">ad components</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-to-an-auctionad-sequence\" id=\"ref-for-convert-to-an-auctionad-sequence①\">converted to an AuctionAd sequence</a> \n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>igGenerateBid</var>.</p>"
        }
      ]
    },
    {
      "name": "convert to an AuctionAd sequence",
      "href": "https://wicg.github.io/turtledove/#convert-to-an-auctionad-sequence",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-to-an-auctionad-sequence\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert to an AuctionAd sequence</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②④\">list</a>-or-null <var>ads</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>ads</var> is null, then return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑤\">undefined</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>adsIDL</var> be a new <code><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①②\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionad\" id=\"ref-for-dictdef-auctionad②\">AuctionAd</a></code>&gt;</code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑥\">For each</a> <var>ad</var> of <var>ads</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adIDL</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionad\" id=\"ref-for-dictdef-auctionad③\">AuctionAd</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④②\">Set</a> <var>adIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-renderurl\" id=\"ref-for-dom-auctionad-renderurl①\">renderURL</a></code>\"] to the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">serialization</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url③\">render url</a>.</p>"
            },
            {
              "html": "<p>If <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group①\">size group</a> is not null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④③\">set</a> <var>adIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup②\">sizeGroup</a></code>\"] to <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group②\">size group</a>.</p>"
            },
            {
              "html": "<p>If <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata③\">metadata</a> is not null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④④\">set</a> <var>adIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata②\">metadata</a></code>\"] to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-a-javascript-value\" id=\"ref-for-parse-a-json-string-to-a-javascript-value①\">parsing a JSON string to a JavaScript value</a> given <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata④\">metadata</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①④\">Append</a> <var>adIDL</var> to <var>adsIDL</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>adsIDL</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch and decode trusted scoring signals",
      "href": "https://wicg.github.io/turtledove/#fetch-and-decode-trusted-scoring-signals",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-and-decode-trusted-scoring-signals\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch and decode trusted scoring signals</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config⑦\">auction config</a> <var>auctionConfig</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid②\">generated bid</a> <var>generatedBid</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher\">script fetcher</a> <var>decisionLogicFetcher</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①②\">origin</a> <var>topLevelOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map②\">real time reporting contributions map</a> <var>realTimeContributionsMap</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>crossOriginTrustedScoringSignalsOrigin</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>sameOriginTrustedScoringSignals</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>crossOriginTrustedScoringSignals</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>scoringDataVersion</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>renderURL</var> be <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①\">serialized</a> <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor⑧\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url⑤\">url</a>.</p>"
        },
        {
          "html": "<p>Let <var>adComponentRenderURLs</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑤\">list</a>.</p>"
        },
        {
          "html": "If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors③\">ad component descriptors</a> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑦\">For each</a> <var>adComponentDescriptor</var> in <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors④\">ad component\ndescriptors</a>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑤\">Append</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer②\">serialized</a> <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url⑥\">url</a> to <var>adComponentRenderURLs</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>fullSignalsUrl</var> be null.</p>"
        },
        {
          "html": "If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-trusted-scoring-signals-url\" id=\"ref-for-auction-config-trusted-scoring-signals-url①\">trusted scoring signals url</a> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>fullSignalsUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-trusted-scoring-signals-url\" id=\"ref-for-build-trusted-scoring-signals-url\">building trusted scoring signals url</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-trusted-scoring-signals-url\" id=\"ref-for-auction-config-trusted-scoring-signals-url②\">trusted scoring signals url</a>, «<var>renderURL</var>», <var>adComponentRenderURLs</var>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-experiment-group-id\" id=\"ref-for-auction-config-seller-experiment-group-id①\">seller experiment group id</a>, and <var>topLevelOrigin</var>.</p>\n        <p>Implementations may batch <a href=\"https://wicg.github.io/turtledove/#trusted-scoring-signals-fetch\">trusted scoring signals\nrequests</a> with same <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-trusted-scoring-signals-url\" id=\"ref-for-auction-config-trusted-scoring-signals-url③\">trusted scoring signals url</a>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-experiment-group-id\" id=\"ref-for-auction-config-seller-experiment-group-id②\">seller experiment group id</a>, and <var>topLevelOrigin</var> by collecting render URLs\nand ad component render URLs from multiple invocations of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#score-and-rank-a-bid\" id=\"ref-for-score-and-rank-a-bid④\">score and rank a bid</a> and passing\nthem all to a single invocation of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-trusted-scoring-signals-url\" id=\"ref-for-build-trusted-scoring-signals-url①\">building trusted scoring signals url</a> to get a <var>scoringSignalsUrl</var>. Requests may not be combined if the resulting combination’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length\">length</a> of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer③\">serialized</a> <var>scoringSignalsUrl</var> exceeds the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-max-trusted-scoring-signals-url-length\" id=\"ref-for-auction-config-max-trusted-scoring-signals-url-length①\">max trusted scoring signals url length</a> of the auction; however this limit does not\napply if no combining has taken place.</p>\n        <p>The network response has to be parsed to pull out the pieces relevant to each <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-scoring-script\" id=\"ref-for-evaluate-a-scoring-script\">evaluation of a scoring script</a>.</p>\n        <p>These requests may also begin before the script fetch, but requests cross-origin to the\nscript origin must not happen until <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-allow-trusted-scoring-signals-from\" id=\"ref-for-http-headerdef-ad-auction-allow-trusted-scoring-signals-from\">Ad-Auction-Allow-Trusted-Scoring-Signals-From</a></code>`</span> header on\nthe script is received, parsed, and determined to authorize such a fetch.</p>"
            },
            {
              "html": "If <var>fullSignalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin③\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same origin</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller⑨\">seller</a>, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>crossOriginTrustedScoringSignalsOrigin</var> to <var>fullSignalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin④\">origin</a>.</p>"
                },
                {
                  "html": "<p>Let <var>allowCrossOriginTrustedScoringSignalsFrom</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-for-cross-origin-trusted-scoring-signals-authorization-from-a-fetcher\" id=\"ref-for-wait-for-cross-origin-trusted-scoring-signals-authorization-from-a-fetcher\">wait for cross origin\ntrusted scoring signals authorization from a fetcher</a> given <var>decisionLogicFetcher</var>.</p>"
                },
                {
                  "html": "If <var>allowCrossOriginTrustedScoringSignalsFrom</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contain</a> <var>crossOriginTrustedScoringSignalsOrigin</var>:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>crossOriginTrustedScoringSignalsOrigin</var> to null.</p>"
                    },
                    {
                      "html": "<p>Set <var>fullSignalsUrl</var> to null.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>seller</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①⓪\">seller</a>.</p>"
        },
        {
          "html": "If <var>fullSignalsUrl</var> is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>allTrustedScoringSignals</var> be null.</p>"
            },
            {
              "html": "<p><i id=\"trusted-scoring-signals-fetch\">Set</i> «<var>allTrustedScoringSignals</var>, <var>ignored</var>, <var>scoringDataVersion</var>» to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-trusted-signals\" id=\"ref-for-fetch-trusted-signals\">fetching trusted signals</a> with <var>fullSignalsUrl</var>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①①\">seller</a>, and false.</p>"
            },
            {
              "html": "If <var>allTrustedScoringSignals</var> is null, and <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-real-time-reporting-config\" id=\"ref-for-auction-config-seller-real-time-reporting-config①\">seller real time reporting config</a> is \"<code>default-local-reporting</code>\",then:",
              "rationale": "add",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#add-a-platform-contribution\" id=\"ref-for-add-a-platform-contribution②\">Add a platform contribution</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-scoring-signals-failure-bucket\" id=\"ref-for-trusted-scoring-signals-failure-bucket\">trusted scoring signals failure bucket</a>, <var>realTimeContributionsMap</var>, and <var>seller</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise if <var>allTrustedScoringSignals</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⓪\">ordered map</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>trustedScoringSignals</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②①\">map</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⑤\">Set</a> <var>trustedScoringSignals</var>[\"<code>renderURL</code>\"] to a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②②\">map</a>.</p>"
                },
                {
                  "html": "<p>If <var>allTrustedScoringSignals</var>[\"<code>renderURLs</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦③\">exists</a> and <var>allTrustedScoringSignals</var>[\"<code>renderURLs</code>\"][<var>renderURL</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦④\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⑥\">set</a> <var>trustedScoringSignals</var>[\"<code>renderURL</code>\"][<var>renderURL</var>] to <var>allTrustedScoringSignals</var>[\"<code>renderURLs</code>\"][<var>renderURL</var>].</p>"
                },
                {
                  "html": "If <var>adComponentRenderURLs</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑦\">empty</a>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>adComponentRenderURLsValue</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②③\">map</a>.</p>"
                    },
                    {
                      "html": "If <var>allTrustedScoringSignals</var>[\"<code>adComponentRenderURLs</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑤\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑧\">for each</a> <var>adComponentRenderURL</var> in <var>adComponentRenderURLs</var>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>allTrustedScoringSignals</var>[\"<code>adComponentRenderURLs</code>\"][<var>adComponentRenderURL</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑥\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⑦\">set</a> <var>adComponentRenderURLsValue</var>[<var>adComponentRenderURL</var>] to <var>allTrustedScoringSignals</var>[\"<code>adComponentRenderURLs</code>\"][<var>adComponentRenderURL</var>].</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⑧\">Set</a> <var>trustedScoringSignals</var>[\"<code>adComponentRenderURLs</code>\"] to <var>adComponentRenderURLsValue</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>crossOriginTrustedScoringSignalsOrigin</var> is null, set <var>sameOriginTrustedScoringSignals</var> to <var>trustedScoringSignals</var>.</p>"
                },
                {
                  "html": "Otherwise:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>crossOriginTrustedScoringSignals</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②④\">map</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>originKey</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin④\">serialization</a> given <var>crossOriginTrustedScoringSignalsOrigin</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④⑨\">Set</a> <var>crossOriginTrustedScoringSignals</var>[<var>originKey</var>] to <var>trustedScoringSignals</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return «<var>crossOriginTrustedScoringSignalsOrigin</var>, <var>sameOriginTrustedScoringSignals</var>, <var>crossOriginTrustedScoringSignals</var>, <var>scoringDataVersion</var>»</p>"
        }
      ]
    },
    {
      "name": "score and rank a bid",
      "href": "https://wicg.github.io/turtledove/#score-and-rank-a-bid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"score-and-rank-a-bid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">score and rank a bid</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config⑧\">auction config</a> <var>auctionConfig</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid③\">generated bid</a> <var>generatedBid</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info③\">bid debug reporting info</a> <var>bidDebugReportInfo</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info③\">leading bid info</a> <var>leadingBidInfo</var>,\na <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher①\">script fetcher</a> <var>decisionLogicFetcher</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforseller\" id=\"ref-for-dictdef-directfromsellersignalsforseller\">DirectFromSellerSignalsForSeller</a></code> <var>directFromSellerSignalsForSeller</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-long\" id=\"ref-for-idl-unsigned-long\">unsigned long</a></code>-or-null <var>biddingDataVersion</var>, an enum <var>auctionLevel</var>,\nwhich is \"single-level-auction\", \"top-level-auction\", or \"component-auction\", a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag②\">currency tag</a> <var>componentAuctionExpectedCurrency</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①③\">origin</a> <var>topLevelOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map③\">real time reporting contributions map</a> <var>realTimeContributionsMap</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let «<var>crossOriginTrustedScoringSignalsOrigin</var>, <var>sameOriginTrustedScoringSignals</var>, <var>crossOriginTrustedScoringSignals</var>, <var>scoringDataVersion</var>» be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-and-decode-trusted-scoring-signals\" id=\"ref-for-fetch-and-decode-trusted-scoring-signals\">fetch and\ndecode trusted scoring signals</a> given <var>auctionConfig</var>, <var>generatedBid</var>, <var>decisionLogicFetcher</var>, <var>topLevelOrigin</var>, and <var>realTimeContributionsMap</var>.</p>"
        },
        {
          "html": "<p>Let <var>adMetadata</var> be <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad\" id=\"ref-for-generated-bid-ad\">ad</a>.</p>"
        },
        {
          "html": "<p>Let <var>bidValue</var> be <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid\">bid</a>.</p>"
        },
        {
          "html": "<p>If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid\">modified bid</a> is not null, then set <var>bidValue</var> to <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid①\">modified bid</a>.</p>"
        },
        {
          "html": "<p>Let <var>owner</var> be <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group⑥\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③④\">owner</a>.</p>"
        },
        {
          "html": "<p>Let <var>browserSignals</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-scoringbrowsersignals\" id=\"ref-for-dictdef-scoringbrowsersignals\">ScoringBrowserSignals</a></code> with the following fields:</p>\n      <dl>\n       <dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-topwindowhostname\" id=\"ref-for-dom-scoringbrowsersignals-topwindowhostname\">topWindowHostname</a></code> \n       </dt><dd>The result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-serializer\" id=\"ref-for-concept-host-serializer①\">host serializer</a> on <var>topLevelOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host①\">host</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-interestgroupowner\" id=\"ref-for-dom-scoringbrowsersignals-interestgroupowner\">interestGroupOwner</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin⑤\">Serialized</a> <var>owner</var> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-renderurl\" id=\"ref-for-dom-scoringbrowsersignals-renderurl\">renderURL</a></code> \n       </dt><dd>The result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer④\">URL serializer</a> on <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor⑨\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url⑦\">url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-rendersize\" id=\"ref-for-dom-scoringbrowsersignals-rendersize\">renderSize</a></code> \n       </dt><dd>The result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-map\" id=\"ref-for-convert-an-ad-size-to-a-map①\">convert an ad size to a map</a> with <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①⓪\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size⑤\">size</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑥\">undefined</a></code> otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-biddingdurationmsec\" id=\"ref-for-dom-scoringbrowsersignals-biddingdurationmsec\">biddingDurationMsec</a></code> \n       </dt><dd><var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-duration\" id=\"ref-for-generated-bid-bid-duration\">bid duration</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-bidcurrency\" id=\"ref-for-dom-scoringbrowsersignals-bidcurrency\">bidCurrency</a></code> \n       </dt><dd>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-currency-tag\" id=\"ref-for-serialize-a-currency-tag\">serializing a currency tag</a> with <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid①\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency\">currency</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-dataversion\" id=\"ref-for-dom-scoringbrowsersignals-dataversion\">dataVersion</a></code> \n       </dt><dd><var>scoringDataVersion</var> if it is not null and <var>crossOriginTrustedScoringSignalsOrigin</var> is null,\n      unset otherwise. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-crossorigindataversion\" id=\"ref-for-dom-scoringbrowsersignals-crossorigindataversion\">crossOriginDataVersion</a></code> \n       </dt><dd><var>scoringDataVersion</var> if it is not null and <var>crossOriginTrustedScoringSignalsOrigin</var> is not\n      null, unset otherwise. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-adcomponents\" id=\"ref-for-dom-scoringbrowsersignals-adcomponents\">adComponents</a></code> \n       </dt><dd><var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors⑤\">ad component descriptors</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-to-a-string-sequence\" id=\"ref-for-convert-to-a-string-sequence\">converted to a string sequence</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoringbrowsersignals-fordebuggingonlyincooldownorlockout\" id=\"ref-for-dom-scoringbrowsersignals-fordebuggingonlyincooldownorlockout\">forDebuggingOnlyInCooldownOrLockout</a></code> \n       </dt><dd>The result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#is-debugging-only-in-cooldown-or-lockout\" id=\"ref-for-is-debugging-only-in-cooldown-or-lockout①\">is debugging only in cooldown or lockout</a> with <var>seller</var> \n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>decisionLogicScript</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-for-script-body-from-a-fetcher\" id=\"ref-for-wait-for-script-body-from-a-fetcher①\">wait for script body from a fetcher</a> given <var>decisionLogicFetcher</var>.</p>"
        },
        {
          "html": "If <var>decisionLogicScript</var> is failure, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-real-time-reporting-config\" id=\"ref-for-auction-config-seller-real-time-reporting-config②\">seller real time reporting config</a> is\n\"<code>default-local-reporting</code>\", then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#add-a-platform-contribution\" id=\"ref-for-add-a-platform-contribution③\">add a platform contribution</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#scoring-script-failure-bucket\" id=\"ref-for-scoring-script-failure-bucket\">scoring script failure bucket</a>, <var>realTimeContributionsMap</var> and <var>seller</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let « <var>scoreAdResult</var>, <var>debugWinReportUrl</var>, <var>debugLossReportUrl</var>, <var>realTimeContributions</var> » be\nthe result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-scoring-script\" id=\"ref-for-evaluate-a-scoring-script①\">evaluating a scoring script</a> with <var>decisionLogicScript</var>, <var>adMetadata</var>, <var>bidValue</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value\">value</a>, <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl①\">config idl</a>, <var>sameOriginTrustedScoringSignals</var>, <var>crossOriginTrustedScoringSignals</var>, <var>browserSignals</var>, <var>directFromSellerSignalsForSeller</var>, and <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-timeout\" id=\"ref-for-auction-config-seller-timeout①\">seller timeout</a>.</p>"
        },
        {
          "html": "If <var>auctionLevel</var> is \"top-level-auction\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-top-level-seller-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-top-level-seller-debug-loss-report-url\">top level seller debug loss report url</a> to <var>debugLossReportUrl</var>.</p>"
            },
            {
              "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-top-level-seller-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-top-level-seller-debug-win-report-url\">top level seller debug win report url</a> to <var>debugWinReportUrl</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-loss-report-url\">seller debug loss report url</a> to <var>debugLossReportUrl</var>.</p>"
            },
            {
              "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-win-report-url\">seller debug win report url</a> to <var>debugWinReportUrl</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>scoreAdOutput</var> be result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#process-scoread-output\" id=\"ref-for-process-scoread-output\">processing scoreAd output</a> with <var>scoreAdResult</var>.</p>"
        },
        {
          "html": "<p>If <var>auctionLevel</var> is \"component-auction\", then set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-component-seller\" id=\"ref-for-generated-bid-component-seller\">component seller</a> and <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-component-seller\" id=\"ref-for-bid-debug-reporting-info-component-seller\">component seller</a> to <var>seller</var>.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-real-time-reporting-config\" id=\"ref-for-auction-config-seller-real-time-reporting-config③\">seller real time reporting config</a> is\n\"<code>default-local-reporting</code>\", then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#insert-entries-to-map\" id=\"ref-for-insert-entries-to-map①\">insert entries to map</a> given <var>realTimeContributionsMap</var>, <var>seller</var>, and <var>realTimeContributions</var>.</p>"
        },
        {
          "html": "<p>Return if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>scoreAdOutput</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>auctionLevel</var> is not \"single-level-auction\", and <var>scoreAdOutput</var> [\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-allowcomponentauction\" id=\"ref-for-dom-scoreadoutput-allowcomponentauction\">allowComponentAuction</a></code>\"] is false;</p>\n       </li><li data-md=\"\">\n        <p><var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-desirability\" id=\"ref-for-dom-scoreadoutput-desirability\">desirability</a></code>\"] ≤ 0.</p>\n      </li></ul>"
        },
        {
          "html": "If <var>auctionLevel</var> is \"component-auction\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bidToCheck</var> be <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid②\">bid</a>.</p>"
            },
            {
              "html": "If <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bid\" id=\"ref-for-dom-scoreadoutput-bid\">bid</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑦\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>modifiedBidValue</var> be <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bid\" id=\"ref-for-dom-scoreadoutput-bid①\">bid</a></code>\"].</p>"
                },
                {
                  "html": "<p>If <var>modifiedBidValue</var> ≤ 0, return.</p>"
                },
                {
                  "html": "<p>Let <var>modifiedBidCurrency</var> be null.</p>"
                },
                {
                  "html": "<p>If <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bidcurrency\" id=\"ref-for-dom-scoreadoutput-bidcurrency\">bidCurrency</a></code>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑧\">exists</a>, then set <var>modifiedBidCurrency</var> to <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bidcurrency\" id=\"ref-for-dom-scoreadoutput-bidcurrency①\">bidCurrency</a></code>].</p>"
                },
                {
                  "html": "<p>Set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid②\">modified bid</a> to a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency\" id=\"ref-for-bid-with-currency\">bid with currency</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value①\">value</a> <var>modifiedBidValue</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency①\">currency</a> <var>modifiedBidCurrency</var>.</p>"
                },
                {
                  "html": "<p>Set <var>bidToCheck</var> to <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid③\">modified bid</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-a-currency-tag\" id=\"ref-for-check-a-currency-tag\">checking a currency tag</a> with <var>componentAuctionExpectedCurrency</var> and <var>bidToCheck</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency②\">currency</a> is false, return.</p>"
            },
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-a-currency-tag\" id=\"ref-for-check-a-currency-tag①\">checking a currency tag</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency①\">seller currency</a> and <var>bidToCheck</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency③\">currency</a> is false,\nreturn.</p>"
            }
          ]
        },
        {
          "html": "If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency②\">seller currency</a> is not null:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid③\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency④\">currency</a> is equal to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency③\">seller currency</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-in-seller-currency\" id=\"ref-for-generated-bid-bid-in-seller-currency\">bid in seller currency</a> to <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid④\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value②\">value</a>.</p>"
                },
                {
                  "html": "<p>If <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-incomingbidinsellercurrency\" id=\"ref-for-dom-scoreadoutput-incomingbidinsellercurrency\">incomingBidInSellerCurrency</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑨\"> exists</a> and does\nnot equal <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-in-seller-currency\" id=\"ref-for-generated-bid-bid-in-seller-currency①\">bid in seller currency</a>, return.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise if <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-incomingbidinsellercurrency\" id=\"ref-for-dom-scoreadoutput-incomingbidinsellercurrency①\">incomingBidInSellerCurrency</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⓪\"> exists</a>,\nthen set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-in-seller-currency\" id=\"ref-for-generated-bid-bid-in-seller-currency②\">bid in seller currency</a> to <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-incomingbidinsellercurrency\" id=\"ref-for-dom-scoreadoutput-incomingbidinsellercurrency②\">incomingBidInSellerCurrency</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>score</var> be <var>scoreAdOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-desirability\" id=\"ref-for-dom-scoreadoutput-desirability①\">desirability</a></code>\"].</p>"
        },
        {
          "html": "If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-for-k-anon-auction\" id=\"ref-for-generated-bid-for-k-anon-auction②\">for k-anon auction</a> is false:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>updateLeadingNonKAnonEnforcedBid</var> be false.</p>"
            },
            {
              "html": "If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid⑤\">leading non-k-anon-enforced bid</a> is null, or <var>score</var> &gt; <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-score\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-score\">top non-k-anon-enforced score</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>updateLeadingNonKAnonEnforcedBid</var> to true.</p>"
                },
                {
                  "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-bids-count\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-bids-count\">top non-k-anon-enforced bids count</a> to 1.</p>"
                }
              ]
            },
            {
              "html": "If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid⑥\">leading non-k-anon-enforced bid</a> is not null and <var>score</var> = <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-score\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-score①\">top non-k-anon-enforced score</a>:",
              "rationale": "increment",
              "steps": [
                {
                  "html": "<p>Increment <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-bids-count\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-bids-count①\">top non-k-anon-enforced bids count</a> by 1.</p>"
                },
                {
                  "html": "<p>Set <var>updateLeadingNonKAnonEnforcedBid</var> to true with 1 in <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-bids-count\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-bids-count②\">top non-k-anon-enforced bids count</a> chance.</p>"
                }
              ]
            },
            {
              "html": "If <var>updateLeadingNonKAnonEnforcedBid</var> is true:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-non-k-anon-enforced-score\" id=\"ref-for-leading-bid-info-top-non-k-anon-enforced-score②\">top non-k-anon-enforced score</a> to <var>score</var>.</p>"
                },
                {
                  "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-non-k-anon-enforced-bid\" id=\"ref-for-leading-bid-info-leading-non-k-anon-enforced-bid⑦\">leading non-k-anon-enforced bid</a> to <var>generatedBid</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>updateLeadingBid</var> be false.</p>"
        },
        {
          "html": "If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⑤\">leading bid</a> is null, or <var>score</var> &gt; <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-score\" id=\"ref-for-leading-bid-info-top-score\">top score</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>updateLeadingBid</var> to true.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-bids-count\" id=\"ref-for-leading-bid-info-top-bids-count\">top bids count</a> to 1.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-at-most-one-top-bid-owner\" id=\"ref-for-leading-bid-info-at-most-one-top-bid-owner\">at most one top bid owner</a> to true.</p>"
            }
          ]
        },
        {
          "html": "Otherwise if <var>score</var> equals <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-score\" id=\"ref-for-leading-bid-info-top-score①\">top score</a>:",
          "rationale": "increment",
          "steps": [
            {
              "html": "<p>Increment <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-bids-count\" id=\"ref-for-leading-bid-info-top-bids-count①\">top bids count</a> by 1.</p>"
            },
            {
              "html": "<p>Set <var>updateLeadingBid</var> to true with 1 in <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-bids-count\" id=\"ref-for-leading-bid-info-top-bids-count②\">top bids count</a> chance.</p>"
            },
            {
              "html": "<p>If <var>updateLeadingBid</var> is false, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-highest-scoring-other-bid\" id=\"ref-for-update-highest-scoring-other-bid\">update highest scoring other bid</a> with <var>score</var>, <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⑥\">leading bid</a>, and <var>leadingBidInfo</var>.</p>"
            },
            {
              "html": "<p>If <var>owner</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin④\">same origin</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⑦\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group⑦\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⑤\">owner</a>, then set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-at-most-one-top-bid-owner\" id=\"ref-for-leading-bid-info-at-most-one-top-bid-owner①\">at most one top bid owner</a> to false.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise if <var>score</var> is greater than or equal to <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-second-highest-score\" id=\"ref-for-leading-bid-info-second-highest-score\">second highest score</a>, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-highest-scoring-other-bid\" id=\"ref-for-update-highest-scoring-other-bid①\">update highest scoring other bid</a> with <var>score</var>, <var>bidValue</var>, and <var>leadingBidInfo</var>.</p>"
        },
        {
          "html": "If <var>updateLeadingBid</var> is true:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⑧\">leading bid</a> is not null, then <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-highest-scoring-other-bid\" id=\"ref-for-update-highest-scoring-other-bid②\">update highest scoring other bid</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-score\" id=\"ref-for-leading-bid-info-top-score②\">top score</a>, <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid①⑨\">leading bid</a>, and <var>leadingBidInfo</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-score\" id=\"ref-for-leading-bid-info-top-score③\">top score</a> to <var>score</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②⓪\">leading bid</a> to <var>generatedBid</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config③\">auction config</a> to <var>auctionConfig</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-bidding-data-version\" id=\"ref-for-leading-bid-info-bidding-data-version\">bidding data version</a> to <var>biddingDataVersion</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-scoring-data-version\" id=\"ref-for-leading-bid-info-scoring-data-version\">scoring data version</a> to <var>scoringDataVersion</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "convert to a string sequence",
      "href": "https://wicg.github.io/turtledove/#convert-to-a-string-sequence",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-to-a-string-sequence\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert to a string sequence</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑥\">list</a>-or-null <var>adComponents</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>adComponents</var> is null, return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑦\">undefined</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new <code><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①③\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString③⑨\">USVString</a></code>&gt;</code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③⑨\">For each</a> <var>component</var> of <var>adComponents</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑥\">Append</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑤\">serialized</a> <var>component</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url⑧\">url</a> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "update highest scoring other bid",
      "href": "https://wicg.github.io/turtledove/#update-highest-scoring-other-bid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-highest-scoring-other-bid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update highest scoring other bid</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double⑥\">double</a></code> <var>score</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid④\">generated bid</a>-or-null <var>bid</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info④\">leading bid info</a> <var>leadingBidInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>bid</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>owner</var> be <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group⑧\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⑥\">owner</a>.</p>"
        },
        {
          "html": "If <var>score</var> is greater than <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-second-highest-score\" id=\"ref-for-leading-bid-info-second-highest-score①\">second highest score</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid\">highest scoring other bid</a> to <var>bid</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bids-count\" id=\"ref-for-leading-bid-info-highest-scoring-other-bids-count\">highest scoring other bids count</a> to 1.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-second-highest-score\" id=\"ref-for-leading-bid-info-second-highest-score②\">second highest score</a> to <var>score</var>.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner\">highest scoring other bid owner</a> to <var>owner</var> if <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-at-most-one-top-bid-owner\" id=\"ref-for-leading-bid-info-at-most-one-top-bid-owner②\">at most one top bid owner</a> is true, null otherwise.</p>"
            }
          ]
        },
        {
          "html": "Otherwise if <var>score</var> is equal to <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-second-highest-score\" id=\"ref-for-leading-bid-info-second-highest-score③\">second highest score</a>:",
          "rationale": "increment",
          "steps": [
            {
              "html": "<p>Increment <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bids-count\" id=\"ref-for-leading-bid-info-highest-scoring-other-bids-count①\">highest scoring other bids count</a> by 1.</p>"
            },
            {
              "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid①\">highest scoring other bid</a> to <var>bid</var> with 1 in <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bids-count\" id=\"ref-for-leading-bid-info-highest-scoring-other-bids-count②\">highest scoring other bids count</a> chance.</p>"
            },
            {
              "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner①\">highest scoring other bid owner</a> is not null and <var>owner</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑤\">same origin</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner②\">highest scoring other bid owner</a>, then set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner③\">highest scoring other bid owner</a> to null.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "validate fetching response headers",
      "href": "https://wicg.github.io/turtledove/#validate-fetching-response-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-fetching-response-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate fetching response headers</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header\">getting</a> <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-allowed\" id=\"ref-for-http-headerdef-ad-auction-allowed\">Ad-Auction-Allowed</a></code>`</span> and\n \"<code>item</code>\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a> does not return a true value, return false.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status\">status</a> is not an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#ok-status\" id=\"ref-for-ok-status\">ok status</a>, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "validate fetching response mime and body",
      "href": "https://wicg.github.io/turtledove/#validate-fetching-response-mime-and-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-fetching-response-mime-and-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate fetching response mime and body</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④\">response</a> <var>response</var>, null,\nfailure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence\">byte sequence</a> <var>responseBody</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①④\">string</a> <var>mimeType</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>responseBody</var> is null or failure, return false.</p>"
        },
        {
          "html": "<p>Let <var>headerMimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type\">extracting a MIME type</a> from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①\">header list</a>.</p>"
        },
        {
          "html": "<p>Return false if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>headerMimeType</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>mimeType</var> is \"<code>text/javascript</code>\" and <var>headerMimeType</var> is not a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#javascript-mime-type\" id=\"ref-for-javascript-mime-type\">JavaScript MIME type</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>mimeType</var> is \"<code>application/json</code>\" and <var>headerMimeType</var> is not a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#json-mime-type\" id=\"ref-for-json-mime-type\">JSON MIME type</a>.</p>\n       </li><li data-md=\"\">\n        <p><var>mimeType</var> is \"<code>application/wasm</code>\" and the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get\">getting</a> \"<code>Content-Type</code>\"\nfrom <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②\">header list</a> is null or not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive\">byte-case-insensitive</a> equal to\n\"<code>application/wasm</code>\".</p>\n        \n      </li></ul>"
        },
        {
          "html": "If <var>mimeType</var> is not \"<code>application/wasm</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>mimeTypeCharset</var> be \"utf-8\".</p>"
            },
            {
              "html": "<p>If <var>headerMimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters\">parameters</a>[\"<code>charset</code>\"] exists, set <var>mimeTypeCharset</var> to <var>headerMimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters①\">parameters</a>[\"<code>charset</code>\"].</p>"
            },
            {
              "html": "<p>Return true if any of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>mimeTypeCharset</var> is \"utf-8\", and <var>responseBody</var> is <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8\" id=\"ref-for-utf-8\">UTF-8</a> encoded;</p>\n         </li><li data-md=\"\">\n          <p><var>mimeTypeCharset</var> is \"us-ascii\", and all bytes in <var>responseBody</var> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-byte\" id=\"ref-for-ascii-byte\">ASCII bytes</a>.</p>\n        </li></ul>"
            },
            {
              "html": "<p>Return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "validate fetching response",
      "href": "https://wicg.github.io/turtledove/#validate-fetching-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-fetching-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate fetching response</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤\">response</a> <var>response</var>, null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①\">byte sequence</a> <var>responseBody</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a> <var>mimeType</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response-headers\" id=\"ref-for-validate-fetching-response-headers\">validating fetching response headers</a> given <var>response</var> is false, then\n return false.</p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response-mime-and-body\" id=\"ref-for-validate-fetching-response-mime-and-body\">validating fetching response mime and body</a> given <var>response</var>, <var>responseBody</var>, <var>mimeType</var> is false, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "fetch WebAssembly",
      "href": "https://wicg.github.io/turtledove/#fetch-webassembly",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-webassembly\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch WebAssembly</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url\">URL</a> <var>url</var> and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①④\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request②\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>«<code>Accept</code>: <code>application/wasm</code>»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>frameOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>moduleObject</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response-end-of-body\" id=\"ref-for-process-response-end-of-body\">processResponseConsumeBody</a> set to the following steps given\na <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥\">response</a> <var>response</var> and null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②\">byte sequence</a> <var>responseBody</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response\" id=\"ref-for-validate-fetching-response\">validate fetching response</a> with <var>response</var>, <var>responseBody</var> and \"<code>application/wasm</code>\"\n  returns false, set <var>moduleObject</var> to failure and return.</p>"
            },
            {
              "html": "<p>Let <var>module</var> be the result of <a data-link-type=\"dfn\" href=\"https://webassembly.github.io/spec/js-api/#compile-a-webassembly-module\" id=\"ref-for-compile-a-webassembly-module\">compiling a WebAssembly module</a> <var>response</var>.</p>"
            },
            {
              "html": "<p>If <var>module</var> is <a data-link-type=\"dfn\" href=\"https://webassembly.github.io/spec/core/appendix/embedding.html#embed-error\" id=\"ref-for-embed-error\">error</a>, set <var>moduleObject</var> to failure.</p>"
            },
            {
              "html": "<p>Otherwise, set <var>moduleObject</var> to <var>module</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>moduleObject</var> to be set.</p>"
        },
        {
          "html": "<p>Return <var>moduleObject</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch trusted signals",
      "href": "https://wicg.github.io/turtledove/#fetch-trusted-signals",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-trusted-signals\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch trusted signals</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①\">URL</a> <var>url</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⑤\">origin</a> <var>scriptOrigin</var>,\nand a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean③\">boolean</a> <var>isBiddingSignal</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>scriptOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>«<code>Accept</code>: <code>application/json</code>»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode①\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>signals</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>dataVersion</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>formatVersion</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>perInterestGroupData</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑤\">ordered map</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch①\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue\">useParallelQueue</a> set to true, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response-end-of-body\" id=\"ref-for-process-response-end-of-body①\">processResponseConsumeBody</a> set to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑦\">response</a> <var>response</var> and null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence③\">byte sequence</a> <var>responseBody</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response\" id=\"ref-for-validate-fetching-response①\">validate fetching response</a> with <var>response</var>, <var>responseBody</var> and \"<code>application/json</code>\"\nreturns false, set <var>signals</var> to failure and return.</p>"
            },
            {
              "html": "<p>Let <var>headers</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③\">header list</a>.</p>"
            },
            {
              "html": "<p>Set <var>dataVersion</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header①\">getting a structured field value</a> given <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-data-version\" id=\"ref-for-http-headerdef-data-version\">Data-Version</a></code>`</span> and \"<code>item</code>\" from <var>headers</var>.</p>"
            },
            {
              "html": "If <var>dataVersion</var> is not null:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>dataVersion</var> is not an integer, or is less than 0 or more than 2<sup>32</sup>−1,\nset <var>signals</var> to failure and return.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>isBiddingSignal</var> is true, then set <var>formatVersion</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header②\">getting a structured field value</a> given <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-x-fledge-bidding-signals-format-version\" id=\"ref-for-http-headerdef-x-fledge-bidding-signals-format-version\">X-fledge-bidding-signals-format-version</a></code>`</span> and \"<code>item</code>\" from <var>headers</var>.</p>"
            },
            {
              "html": "<p>Set <var>signals</var> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value\">parsing JSON bytes to an Infra value</a> <var>responseBody</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>signals</var> to be set.</p>"
        },
        {
          "html": "<p>If <var>signals</var> is a parsing exception, or if <var>signals</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑥\">ordered map</a>, return « null,\nnull, null ».</p>"
        },
        {
          "html": "If <var>formatVersion</var> is 2:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>signals</var>[\"<code>keys</code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧①\">exist</a>, return « null, null ».</p>"
            },
            {
              "html": "<p>Set <var>signals</var> to <var>signals</var>[\"<code>keys</code>\"].</p>"
            },
            {
              "html": "<p>If <var>signals</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑦\">ordered map</a>, return « null, null ».</p>"
            },
            {
              "html": "If <var>signals</var>[\"<code>perInterestGroupData</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧②\">exists</a> and is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑧\">ordered map</a>:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a> <var>isBiddingSignal</var> is true.</p>"
                },
                {
                  "html": "<p>Let <var>perInterestGroupData</var> be <var>signals</var>[\"<code>perInterestGroupData</code>\"].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②③\">For each</a> <var>key</var> → <var>value</var> of <var>signals</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⓪\">Set</a> <var>signals</var>[<var>key</var>] to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string①\">serializing an Infra value to a JSON string</a> given <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return « <var>signals</var>, <var>perInterestGroupData</var>, <var>dataVersion</var> ».</p>"
        }
      ]
    },
    {
      "name": "encode trusted signals keys",
      "href": "https://wicg.github.io/turtledove/#encode-trusted-signals-keys",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"encode-trusted-signals-keys\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">encode trusted signals keys</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">ordered set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">strings</a> <var>keys</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>list</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑦\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>keysStr</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate\">concatenating</a> <var>keys</var> with separator set to \",\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑦\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-utf-8-percent-encode\" id=\"ref-for-string-utf-8-percent-encode\">UTF-8 percent-encoding</a> <var>keysStr</var> using <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#component-percent-encode-set\" id=\"ref-for-component-percent-encode-set\">component percent-encode set</a> to <var>list</var>.</p>"
        },
        {
          "html": "<p>Return <var>list</var>.</p>"
        }
      ]
    },
    {
      "name": "convert an ad size to a string",
      "href": "https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-string",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-an-ad-size-to-a-string\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert an ad size to a string</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size①\">ad size</a> <var>adSize</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>sizeList</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑧\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>jsWidth</var> be <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width\" id=\"ref-for-ad-size-width\">width</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value\">converted to an ECMAScript value</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑧\">Append</a> <a data-link-type=\"abstract-op\" href=\"https://tc39.github.io/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring\">ToString</a>(<var>jsWidth</var>) to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑨\">Append</a> <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width\" id=\"ref-for-ad-size-width①\">width</a> to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⓪\">Append</a> <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width-units\" id=\"ref-for-ad-size-width-units\">width units</a> to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②①\">Append</a> \",\" to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p>Let <var>jsHeight</var> be <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height\" id=\"ref-for-ad-size-height\">height</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①\">converted to an ECMAScript value</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②②\">Append</a> <a data-link-type=\"abstract-op\" href=\"https://tc39.github.io/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring①\">ToString</a>(<var>jsHeight</var>) to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②③\">Append</a> <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height-units\" id=\"ref-for-ad-size-height-units\">height units</a> to <var>sizeList</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①\">concatenating</a> <var>sizeList</var>.</p>"
        }
      ]
    },
    {
      "name": "calculate the ad slot size query param",
      "href": "https://wicg.github.io/turtledove/#calculate-the-ad-slot-size-query-param",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"calculate-the-ad-slot-size-query-param\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">calculate the ad slot size query param</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②⑤\">interest group</a> <var>ig</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config⑨\">auction config</a> <var>config</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Switch on <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode②\">trusted bidding signals slot size mode</a>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"none\"",
                  "html": "",
                  "rationale": "return",
                  "steps": [
                    {
                      "html": "<p>Return \"\".</p>"
                    }
                  ]
                },
                {
                  "case": "\"slot-size\"",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size⑥\">requested size</a> is null, then return \"\".</p>"
                    },
                    {
                      "html": "Otherwise:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>adSizeString</var> the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-string\" id=\"ref-for-convert-an-ad-size-to-a-string\">convert an ad size to a string</a> on <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-requested-size\" id=\"ref-for-auction-config-requested-size⑦\">requested size</a>.</p>"
                        },
                        {
                          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate②\">concatenating</a> « \"&amp;slotSize=\", <var>adSizeString</var> ».</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "\"all-slots-requested-sizes\"",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes④\">all slots requested sizes</a> is null, then return \"\".</p>"
                    },
                    {
                      "html": "<p>Let <var>allSizesList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑨\">list</a> or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">strings</a>.</p>"
                    },
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⓪\">For each</a> <var>adSize</var> in <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-slots-requested-sizes\" id=\"ref-for-auction-config-all-slots-requested-sizes⑤\">all slots requested sizes</a>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>adSizeString</var> the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-string\" id=\"ref-for-convert-an-ad-size-to-a-string①\">convert an ad size to a string</a> on <var>adSize</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②④\">Append</a> <var>adSizeString</var> to <var>allSizesList</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>allSizes</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate③\">concatenating</a> <var>allSizesList</var>, with \",\"\nas a separator.</p>"
                    },
                    {
                      "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate④\">concatenating</a> « \"&amp;allSlotsRequestedSizes=\", <var>allSizes</var> ».</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "build trusted bidding signals url",
      "href": "https://wicg.github.io/turtledove/#build-trusted-bidding-signals-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"build-trusted-bidding-signals-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">build trusted bidding signals url</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URL</a> <var>signalsUrl</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">ordered set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑧\">strings</a> <var>keys</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥\">ordered set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑨\">strings</a> <var>igNames</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short⑤\">unsigned short</a></code>-or-null <var>experimentGroupId</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⑥\">origin</a> <var>topLevelOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⓪\">string</a> <var>slotSizeQueryParam</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>queryParamsList</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⓪\">list</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑤\">Append</a> \"hostname=\" to <var>queryParamsList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑥\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-utf-8-percent-encode\" id=\"ref-for-string-utf-8-percent-encode②\">UTF-8 percent-encoding</a> the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin⑥\">serialized</a> <var>topLevelOrigin</var> using <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#component-percent-encode-set\" id=\"ref-for-component-percent-encode-set①\">component percent-encode set</a> to <var>queryParamsList</var>.</p>"
        },
        {
          "html": "If <var>keys</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③\">empty</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑦\">Append</a> \"<code>&amp;keys=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend①\">Extend</a> <var>queryParamsList</var> with the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#encode-trusted-signals-keys\" id=\"ref-for-encode-trusted-signals-keys\">encode trusted signals keys</a> with <var>keys</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>igNames</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty④\">empty</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑧\">Append</a> \"<code>&amp;interestGroupNames=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend②\">Extend</a> <var>queryParamsList</var> with the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#encode-trusted-signals-keys\" id=\"ref-for-encode-trusted-signals-keys①\">encode trusted signals keys</a> with <var>igNames</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>experimentGroupId</var> is not null:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑨\">Append</a> \"<code>&amp;experimentGroupId=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⓪\">Append</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-an-integer\" id=\"ref-for-serialize-an-integer\">serialized</a> <var>experimentGroupId</var> to <var>queryParamsList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③①\">Append</a> <var>slotSizeQueryParam</var> to <var>queryParamsList</var>.</p>"
        },
        {
          "html": "<p>Let <var>fullSignalsUrl</var> be <var>signalsUrl</var>.</p>"
        },
        {
          "html": "<p>Set <var>fullSignalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query①\">query</a> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate⑤\">concatenating</a> <var>queryParamsList</var>.</p>"
        },
        {
          "html": "<p>return <var>fullSignalsUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "build trusted scoring signals url",
      "href": "https://wicg.github.io/turtledove/#build-trusted-scoring-signals-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"build-trusted-scoring-signals-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">build trusted scoring signals url</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url③\">URL</a> <var>signalsUrl</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③①\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②①\">strings</a> <var>renderURLs</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑦\">ordered set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②②\">strings</a> <var>adComponentRenderURLs</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short⑥\">unsigned short</a></code> <var>experimentGroupId</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⑦\">origin</a> <var>topLevelOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>queryParamsList</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③②\">list</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③②\">Append</a> \"hostname=\" to <var>queryParamsList</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③③\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-utf-8-percent-encode\" id=\"ref-for-string-utf-8-percent-encode③\">UTF-8 percent-encoding</a> <var>topLevelOrigin</var> using <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#component-percent-encode-set\" id=\"ref-for-component-percent-encode-set②\">component percent-encode set</a> to <var>queryParamsList</var>.</p>"
        },
        {
          "html": "If <var>renderURLs</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">empty</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③④\">Append</a> \"<code>&amp;renderURLs=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend③\">Extend</a> <var>queryParamsList</var> with the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#encode-trusted-signals-keys\" id=\"ref-for-encode-trusted-signals-keys②\">encode trusted signals keys</a> with <var>renderURLs</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>adComponentRenderURLs</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑥\">empty</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑤\">Append</a> \"<code>&amp;adComponentRenderURLs=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend④\">Extend</a> <var>queryParamsList</var> with the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#encode-trusted-signals-keys\" id=\"ref-for-encode-trusted-signals-keys③\">encode trusted signals keys</a> with <var>adComponentRenderURLs</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>experimentGroupId</var> is not null:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑥\">Append</a> \"<code>&amp;experimentGroupId=</code>\" to <var>queryParamsList</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑦\">Append</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①\">serialized</a> <var>experimentGroupId</var> to <var>queryParamsList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>signalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query②\">query</a> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate⑥\">concatenating</a> <var>queryParamsList</var>.</p>"
        },
        {
          "html": "<p>return <var>signalsUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "send report",
      "href": "https://wicg.github.io/turtledove/#send-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send report</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url④\">URL</a> <var>url</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⑧\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url②\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>frameOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer②\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode②\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode②\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch②\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue①\">useParallelQueue</a> set to true.</p>"
        }
      ]
    },
    {
      "name": "get direct from seller signals",
      "href": "https://wicg.github.io/turtledove/#get-direct-from-seller-signals",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-direct-from-seller-signals\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get direct from seller signals</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin①⑨\">origin</a> <var>seller</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②③\">string</a>-or-null <var>adSlot</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑨\">map</a> <var>capturedAuctionHeaders</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>adSlot</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②④\">string</a>, then return null.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignals</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignalsKey</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key\" id=\"ref-for-direct-from-seller-signals-key\">direct from seller signals key</a> with its <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key-seller\" id=\"ref-for-direct-from-seller-signals-key-seller\">seller</a> set to <var>seller</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key-ad-slot\" id=\"ref-for-direct-from-seller-signals-key-ad-slot\">ad slot</a> set to <var>adSlot</var>.</p>"
        },
        {
          "html": "If <var>capturedAuctionHeaders</var>[<var>directFromSellerSignalsKey</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧③\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>directFromSellerSignals</var> to <var>capturedAuctionHeaders</var>[<var>directFromSellerSignalsKey</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>directFromSellerSignals</var>.</p>"
        }
      ]
    },
    {
      "name": "get direct from seller signals for a seller",
      "href": "https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-seller",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-direct-from-seller-signals-for-a-seller\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get direct from seller signals for a seller</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals\" id=\"ref-for-direct-from-seller-signals\">direct from seller signals</a>-or-null <var>directFromSellerSignals</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>directFromSellerSignalsForSeller</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforseller\" id=\"ref-for-dictdef-directfromsellersignalsforseller①\">DirectFromSellerSignalsForSeller</a></code>.</p>"
        },
        {
          "html": "<p>If <var>directFromSellerSignals</var> is null, then return <var>directFromSellerSignalsForSeller</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤①\">Set</a> <var>directFromSellerSignalsForSeller</var>[\"auctionSignals\"] to the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value\">parse a JSON string to an Infra value</a> given <var>directFromSellerSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-auction-signals\" id=\"ref-for-direct-from-seller-signals-auction-signals\">auction signals</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤②\">Set</a> <var>directFromSellerSignalsForSeller</var>[\"sellerSignals\"] to the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value①\">parse a JSON string to an Infra value</a> given <var>directFromSellerSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-seller-signals\" id=\"ref-for-direct-from-seller-signals-seller-signals\">seller signals</a>.</p>"
        },
        {
          "html": "<p>Return <var>directFromSellerSignalsForSeller</var>.</p>"
        }
      ]
    },
    {
      "name": "get direct from seller signals for a buyer",
      "href": "https://wicg.github.io/turtledove/#get-direct-from-seller-signals-for-a-buyer",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-direct-from-seller-signals-for-a-buyer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get direct from seller signals for a buyer</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals\" id=\"ref-for-direct-from-seller-signals①\">direct from seller signals</a>-or-null <var>directFromSellerSignals</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②⓪\">origin</a> <var>owner</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>directFromSellerSignalsForBuyer</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforbuyer\" id=\"ref-for-dictdef-directfromsellersignalsforbuyer①\">DirectFromSellerSignalsForBuyer</a></code>.</p>"
        },
        {
          "html": "<p>If <var>directFromSellerSignals</var> is null, then return <var>directFromSellerSignalsForBuyer</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤③\">Set</a> <var>directFromSellerSignalsForBuyer</var>[\"auctionSignals\"] to the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value②\">parse a JSON string to an Infra value</a> given <var>directFromSellerSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-auction-signals\" id=\"ref-for-direct-from-seller-signals-auction-signals①\">auction signals</a>.</p>"
        },
        {
          "html": "If <var>directFromSellerSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-per-buyer-signals\" id=\"ref-for-direct-from-seller-signals-per-buyer-signals\">per buyer signals</a>[<var>owner</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧④\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤④\">Set</a> <var>directFromSellerSignalsForBuyer</var>[\"perBuyerSignals\"] to the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value③\">parse a JSON string to an Infra value</a> given <var>directFromSellerSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-per-buyer-signals\" id=\"ref-for-direct-from-seller-signals-per-buyer-signals①\">per buyer signals</a>[<var>owner</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>directFromSellerSignalsForBuyer</var>.</p>"
        }
      ]
    },
    {
      "name": "report result",
      "href": "https://wicg.github.io/turtledove/#report-result",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"report-result\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">report result</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info⑤\">leading bid info</a> <var>leadingBidInfo</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals\" id=\"ref-for-direct-from-seller-signals②\">direct from seller signals</a>-or-null <var>directFromSellerSignals</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①⓪\">auction config</a>-or-null <var>winningComponentConfig</var>, and a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object①\">global object</a> <var>global</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>config</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config④\">auction config</a>.</p>"
        },
        {
          "html": "<p>Let <var>bidCurrency</var> be null.</p>"
        },
        {
          "html": "If <var>winningComponentConfig</var> is not null:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a> that <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller③\">component seller</a> is not null.</p>"
            },
            {
              "html": "<p>Set <var>bidCurrency</var> to <var>winningComponentConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency④\">seller currency</a>.</p>"
            },
            {
              "html": "<p>If <var>bidCurrency</var> is null, then set <var>bidCurrency</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-currency\" id=\"ref-for-look-up-per-buyer-currency②\">looking up per-buyer currency</a> with <var>config</var> and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller④\">component seller</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, set <var>bidCurrency</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-currency\" id=\"ref-for-look-up-per-buyer-currency③\">looking up per-buyer currency</a> with <var>config</var> and <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②①\">leading bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group⑨\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⑦\">owner</a>.</p>"
        },
        {
          "html": "<p>Let <var>winner</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②②\">leading bid</a>.</p>"
        },
        {
          "html": "<p>Let <var>sellerCurrency</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config⑤\">auction config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-currency\" id=\"ref-for-auction-config-seller-currency⑤\">seller currency</a>.</p>"
        },
        {
          "html": "<p>Let <var>highestScoringOtherBid</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid②\">highest scoring other bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-in-seller-currency\" id=\"ref-for-generated-bid-bid-in-seller-currency③\">bid in seller currency</a> (or\n0 if encountered a null).</p>"
        },
        {
          "html": "<p>If <var>sellerCurrency</var> is null, then set <var>highestScoringOtherBid</var> to <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid③\">highest scoring other bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid⑤\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value③\">value</a> (or 0 if encountered a null).</p>"
        },
        {
          "html": "<p>Let <var>bid</var> be <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid⑥\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value④\">value</a>.</p>"
        },
        {
          "html": "<p>Let <var>modifiedBid</var> be null.</p>"
        },
        {
          "html": "If <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid④\">modified bid</a> is not null:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller⑤\">component seller</a> is not null, then set <var>bid</var> to <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid⑤\">modified bid</a>.</p>"
            },
            {
              "html": "<p>Otherwise, set <var>modifiedBid</var> to <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modified-bid\" id=\"ref-for-generated-bid-modified-bid⑥\">modified bid</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>browserSignals</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-reportresultbrowsersignals\" id=\"ref-for-dictdef-reportresultbrowsersignals\">ReportResultBrowserSignals</a></code> with the following fields:</p>\n      <dl data-link-for-hint=\"ReportingBrowserSignals\">\n       <dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-topwindowhostname\" id=\"ref-for-dom-reportingbrowsersignals-topwindowhostname\">topWindowHostname</a></code> \n       </dt><dd>The result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host-serializer\" id=\"ref-for-concept-host-serializer②\">host serializer</a> on <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin③\">top-level origin</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host②\">host</a>. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-interestgroupowner\" id=\"ref-for-dom-reportingbrowsersignals-interestgroupowner\">interestGroupOwner</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin⑦\">Serialized</a> <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⓪\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⑧\">owner</a>. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-renderurl\" id=\"ref-for-dom-reportingbrowsersignals-renderurl\">renderURL</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑥\">Serialized</a> <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①①\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url⑨\">url</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-bid\" id=\"ref-for-dom-reportingbrowsersignals-bid\">bid</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#round-a-value\" id=\"ref-for-round-a-value\">Stochastically rounded</a> <var>bid</var> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-bidcurrency\" id=\"ref-for-dom-reportingbrowsersignals-bidcurrency\">bidCurrency</a></code> \n       </dt><dd>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#serialize-a-currency-tag\" id=\"ref-for-serialize-a-currency-tag①\">serializing a currency tag</a> with <var>bidCurrency</var> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-highestscoringotherbid\" id=\"ref-for-dom-reportingbrowsersignals-highestscoringotherbid\">highestScoringOtherBid</a></code> \n       </dt><dd><var>highestScoringOtherBid</var> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-highestscoringotherbidcurrency\" id=\"ref-for-dom-reportingbrowsersignals-highestscoringotherbidcurrency\">highestScoringOtherBidCurrency</a></code> \n       </dt><dd><var>sellerCurrency</var> if it is not null, \"<code>???</code>\" otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-toplevelseller\" id=\"ref-for-dom-reportingbrowsersignals-toplevelseller\">topLevelSeller</a></code> \n       </dt><dd><var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-level-seller\" id=\"ref-for-leading-bid-info-top-level-seller①\">top level seller</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑧\">undefined</a></code> otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-componentseller\" id=\"ref-for-dom-reportingbrowsersignals-componentseller\">componentSeller</a></code> \n       </dt><dd><var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller\" id=\"ref-for-leading-bid-info-component-seller⑥\">component seller</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑨\">undefined</a></code> otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportresultbrowsersignals-desirability\" id=\"ref-for-dom-reportresultbrowsersignals-desirability\">desirability</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#round-a-value\" id=\"ref-for-round-a-value①\">Stochastically rounded</a> <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-score\" id=\"ref-for-leading-bid-info-top-score④\">top score</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportresultbrowsersignals-toplevelsellersignals\" id=\"ref-for-dom-reportresultbrowsersignals-toplevelsellersignals\">topLevelSellerSignals</a></code> \n       </dt><dd><var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-level-seller-signals\" id=\"ref-for-leading-bid-info-top-level-seller-signals①\">top level seller signals</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①⓪\">undefined</a></code> otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportresultbrowsersignals-modifiedbid\" id=\"ref-for-dom-reportresultbrowsersignals-modifiedbid\">modifiedBid</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#round-a-value\" id=\"ref-for-round-a-value②\">Stochastically rounded</a> <var>modifiedBid</var> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①①\">undefined</a></code> otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportresultbrowsersignals-dataversion\" id=\"ref-for-dom-reportresultbrowsersignals-dataversion\">dataVersion</a></code> \n       </dt><dd><var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-scoring-data-version\" id=\"ref-for-leading-bid-info-scoring-data-version①\">scoring data version</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①②\">undefined</a></code> otherwise \n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>igAd</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad④\">interest group ad</a> from <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①①\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①①\">ads</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url④\">render url</a> is <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①②\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⓪\">url</a>.</p>"
        },
        {
          "html": "<p>If <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id①\">buyer and seller reporting ID</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑤\">exists</a> and the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-reporting-id-k-anonymity-count\" id=\"ref-for-query-reporting-id-k-anonymity-count\">query reporting ID k-anonymity count</a> given <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①②\">interest group</a> and <var>igAd</var> is true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⑤\">set</a> <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportingbrowsersignals-buyerandsellerreportingid\" id=\"ref-for-dom-reportingbrowsersignals-buyerandsellerreportingid\">buyerAndSellerReportingId</a></code>\"] to <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id②\">buyer and seller reporting ID</a>.</p>"
        },
        {
          "html": "<p>Let <var>sellerReportingScriptFetcher</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-fetcher\" id=\"ref-for-create-a-new-script-fetcher②\">creating a new script fetcher</a> with <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-decision-logic-url\" id=\"ref-for-auction-config-decision-logic-url②\">decision logic url</a> and <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑦\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin⑤\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>sellerReportingScript</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-for-script-body-from-a-fetcher\" id=\"ref-for-wait-for-script-body-from-a-fetcher②\">waiting for script body from a fetcher</a> given <var>sellerReportingScriptFetcher</var>.</p>"
        },
        {
          "html": "<p>Let « <var>sellerSignals</var>, <var>reportUrl</var>, <var>reportingBeaconMap</var>, ignored » be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-reporting-script\" id=\"ref-for-evaluate-a-reporting-script\">evaluating a reporting script</a> with <var>sellerReportingScript</var>, \"<code>reportResult</code>\", <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl②\">config idl</a>'s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-reportingtimeout\" id=\"ref-for-dom-auctionadconfig-reportingtimeout②\">reportingTimeout</a></code>, and\n« <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl③\">config idl</a>, <var>browserSignals</var>, <var>directFromSellerSignals</var> ».</p>"
        },
        {
          "html": "<p>Let <var>reportingResult</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result\" id=\"ref-for-reporting-result\">reporting result</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⑦\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-report-url\" id=\"ref-for-reporting-result-report-url③\">report url</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-beacon-map\" id=\"ref-for-reporting-result-reporting-beacon-map③\">reporting beacon map</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingBeaconMap</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-top-level-seller\" id=\"ref-for-leading-bid-info-top-level-seller②\">top level seller</a> is null (i.e., if we are reporting\n for a component seller), set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-component-seller-reporting-result\" id=\"ref-for-leading-bid-info-component-seller-reporting-result④\">component seller reporting result</a> to <var>reportingResult</var>.</p>"
        },
        {
          "html": "<p>Otherwise, set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-seller-reporting-result\" id=\"ref-for-leading-bid-info-seller-reporting-result④\">seller reporting result</a> to <var>reportingResult</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove②\">Remove</a> <var>browserSignals</var>[\"<code>desirability</code>\"].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove③\">Remove</a> <var>browserSignals</var>[\"<code>modifiedBid</code>\"].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove④\">Remove</a> <var>browserSignals</var>[\"<code>topLevelSellerSignals</code>\"].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑤\">Remove</a> <var>browserSignals</var>[\"<code>dataVersion</code>\"].</p>"
        },
        {
          "html": "<p>Return « <var>sellerSignals</var>, <var>browserSignals</var> ».</p>"
        }
      ]
    },
    {
      "name": "report win",
      "href": "https://wicg.github.io/turtledove/#report-win",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"report-win\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">report win</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info⑥\">leading bid info</a> <var>leadingBidInfo</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②⑤\">string</a> <var>sellerSignals</var>,\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-reportingbrowsersignals\" id=\"ref-for-dictdef-reportingbrowsersignals\">ReportingBrowserSignals</a></code> <var>browserSignals</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals\" id=\"ref-for-direct-from-seller-signals③\">direct from seller signals</a>-or-null <var>directFromSellerSignals</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②①\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>config</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config⑥\">auction config</a>.</p>"
        },
        {
          "html": "<p>Let <var>winner</var> be <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②③\">leading bid</a>.</p>"
        },
        {
          "html": "<p>Let <var>perBuyerSignals</var> be <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals⑧\">per buyer signals</a>.</p>"
        },
        {
          "html": "<p>Let <var>buyer</var> be <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①③\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner③⑨\">owner</a>.</p>"
        },
        {
          "html": "<p>Let <var>perBuyerSignalsForBuyer</var> be <var>perBuyerSignals</var>[<var>buyer</var>] if that member <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑥\">exists</a>,\nand null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>reportWinBrowserSignals</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-reportwinbrowsersignals\" id=\"ref-for-dictdef-reportwinbrowsersignals\">ReportWinBrowserSignals</a></code> with the members that\nare declared on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-reportingbrowsersignals\" id=\"ref-for-dictdef-reportingbrowsersignals①\">ReportingBrowserSignals</a></code> initialized to their values in <var>browserSignals</var>.</p>"
        },
        {
          "html": "<p>Add the following fields to <var>reportWinBrowserSignals</var>:</p>\n      <dl>\n       <dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-dataversion\" id=\"ref-for-dom-reportwinbrowsersignals-dataversion\">dataVersion</a></code> \n       </dt><dd><var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-bidding-data-version\" id=\"ref-for-leading-bid-info-bidding-data-version①\">bidding data version</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①③\">undefined</a></code> otherwise. \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-adcost\" id=\"ref-for-dom-reportwinbrowsersignals-adcost\">adCost</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#round-a-value\" id=\"ref-for-round-a-value③\">Rounded</a> <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-cost\" id=\"ref-for-generated-bid-ad-cost\">ad cost</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-seller\" id=\"ref-for-dom-reportwinbrowsersignals-seller\">seller</a></code> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin⑧\">Serialized</a> <var>config</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①②\">seller</a> \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-madehighestscoringotherbid\" id=\"ref-for-dom-reportwinbrowsersignals-madehighestscoringotherbid\">madeHighestScoringOtherBid</a></code> \n       </dt><dd>Set to true if <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner④\">highest scoring other bid owner</a> is\n    not null, and <var>buyer</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑥\">same origin</a> with <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-highest-scoring-other-bid-owner\" id=\"ref-for-leading-bid-info-highest-scoring-other-bid-owner⑤\">highest scoring other bid owner</a>, false otherwise \n       </dd><dt><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-modelingsignals\" id=\"ref-for-dom-reportwinbrowsersignals-modelingsignals\">modelingSignals</a></code> \n       </dt><dd><var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modeling-signals\" id=\"ref-for-generated-bid-modeling-signals\">modeling signals</a> if it is not null, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①④\">undefined</a></code> otherwise\n    (TODO: noise and bucket this signal) \n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>igAd</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑤\">interest group ad</a> from <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①④\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①②\">ads</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url⑤\">render url</a> is <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①③\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①①\">url</a>.</p>"
        },
        {
          "html": "If <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id③\">buyer and seller reporting ID</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑦\">exist</a> and the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-reporting-id-k-anonymity-count\" id=\"ref-for-query-reporting-id-k-anonymity-count①\">query reporting ID k-anonymity count</a> given <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⑤\">interest group</a> and <var>igAd</var> is true:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id①\">buyer reporting ID</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑧\">exists</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⑥\">set</a> <var>reportWinBrowserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-buyerreportingid\" id=\"ref-for-dom-reportwinbrowsersignals-buyerreportingid\">buyerReportingId</a></code>\"] to <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id②\">buyer reporting ID</a>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⑦\">Set</a> <var>reportWinBrowserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-reportwinbrowsersignals-interestgroupname\" id=\"ref-for-dom-reportwinbrowsersignals-interestgroupname\">interestGroupName</a></code>\"]\nto <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⑥\">interest group</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①⑤\">name</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>buyerReportingScriptFetcher</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-fetcher\" id=\"ref-for-create-a-new-script-fetcher③\">creating a new script fetcher</a> with <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⑦\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url⑤\">bidding url</a> and <var>frameOrigin</var>.</p>"
        },
        {
          "html": "<p>Let <var>buyerReportingScript</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-for-script-body-from-a-fetcher\" id=\"ref-for-wait-for-script-body-from-a-fetcher③\">waiting for script body from a fetcher</a> given <var>buyerReportingScriptFetcher</var>.</p>"
        },
        {
          "html": "<p>Let <var>reportFunctionName</var> be \"<code>reportWin</code>\".</p>"
        },
        {
          "html": "If <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-provided-as-additional-bid\" id=\"ref-for-generated-bid-provided-as-additional-bid\">provided as additional bid</a> is true:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>reportFunctionName</var> be \"<code>reportAdditionalBidWin</code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Let « ignored, <var>resultUrl</var>, <var>reportingBeaconMap</var>, <var>reportingMacroMap</var> » be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-reporting-script\" id=\"ref-for-evaluate-a-reporting-script①\">evaluating a reporting script</a> with <var>buyerReportingScript</var>, \"<code>reportWin</code>\", <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config⑦\">auction config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl④\">config idl</a>'s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-reportingtimeout\" id=\"ref-for-dom-auctionadconfig-reportingtimeout③\">reportingTimeout</a></code>, and\n« <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-auction-config\" id=\"ref-for-leading-bid-info-auction-config⑧\">auction config</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-config-idl\" id=\"ref-for-auction-config-config-idl⑤\">config idl</a>'s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionadconfig-auctionsignals\" id=\"ref-for-dom-auctionadconfig-auctionsignals②\">auctionSignals</a></code>, <var>perBuyerSignalsForBuyer</var>, <var>sellerSignals</var>, <var>reportWinBrowserSignals</var>, <var>directFromSellerSignals</var> ».</p>"
        },
        {
          "html": "<p>Set <var>leadingBidInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-buyer-reporting-result\" id=\"ref-for-leading-bid-info-buyer-reporting-result⑤\">buyer reporting result</a> to a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result\" id=\"ref-for-reporting-result①\">reporting result</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⑧\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-report-url\" id=\"ref-for-reporting-result-report-url④\">report url</a>\n       </dt><dd data-md=\"\">\n        <p><var>resultUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-beacon-map\" id=\"ref-for-reporting-result-reporting-beacon-map④\">reporting beacon map</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingBeaconMap</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#reporting-result-reporting-macro-map\" id=\"ref-for-reporting-result-reporting-macro-map①\">reporting macro map</a>\n       </dt><dd data-md=\"\">\n        <p><var>reportingMacroMap</var></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "parse and validate server response",
      "href": "https://wicg.github.io/turtledove/#parse-and-validate-server-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-and-validate-server-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse and validate server response</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①①\">auction config</a> <var>auctionConfig</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①②\">auction config</a>-or-null <var>topLevelAuctionConfig</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object②\">global object</a> <var>global</var>,\na <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②⑥\">interest groups</a> <var>bidIgs</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info④\">bid debug reporting info</a> <var>bidDebugReportInfoList</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①③\">Assert</a> that <var>topLevelAuctionConfig</var> is null.</p>"
        },
        {
          "html": "<p>Let <var>requestId</var> be the value of <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-server-response-id\" id=\"ref-for-auction-config-server-response-id①\">server response id</a>.</p>"
        },
        {
          "html": "<p>Let <var>requestContexts</var> be the value of <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑥\">associated Document’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable②\">node navigable’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable①\">traversable navigable’s</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-saved-bidding-and-auction-request-context\" id=\"ref-for-traversable-navigable-saved-bidding-and-auction-request-context\">saved Bidding and Auction request context</a>.</p>"
        },
        {
          "html": "<p>If <var>requestContexts</var>[<var>requestId</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑨\">exist</a>, return null.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of deserializing <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-server-response\" id=\"ref-for-auction-config-server-response②\">server response</a> according to the Bidding and Auction Services IETF standard.</p>"
        },
        {
          "html": "<p>Construct bids based on <var>response</var>.</p>"
        },
        {
          "html": "<p>Add the bids form the <var>response</var> to <var>bidIgs</var>.</p>"
        },
        {
          "html": "<p>Insert the debug reporting URLs from <var>response</var> into <var>bidDebugReportInfoList</var>.</p>"
        }
      ]
    },
    {
      "name": "Navigator/canLoadAdAuctionFencedFrame()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-canloadadauctionfencedframe",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-canloadadauctionfencedframe\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>canLoadAdAuctionFencedFrame()</code></dfn> method steps are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc\" id=\"ref-for-window-bc①\">browsing context</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-cspee/#browsing-context-required-csp\" id=\"ref-for-browsing-context-required-csp\">required CSP</a> is not null, then return false.</p>"
        },
        {
          "html": "<p>Let <var>CSPList</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑧\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container\">policy\n container</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-csp-list\" id=\"ref-for-policy-container-csp-list\">CSP list</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④①\">For each</a> <var>policy</var> of <var>CSPList</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④②\">For each</a> <var>directive</var> of <var>policy</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#policy-directive-set\" id=\"ref-for-policy-directive-set\">directive set</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#directive-name\" id=\"ref-for-directive-name\">name</a> is either \"<code>fenced-frame-src</code>\", \"<code>frame-src</code>\",\n \"<code>child-src</code>\", or \"<code>default-src</code>\", and if <var>directive</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#directive-value\" id=\"ref-for-directive-value\">value</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contain</a> any of \"<code>https:</code>\", \"<code>https://*:*</code>\", or \"<code>*</code>\", then return false.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>sandboxFlags</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑦\">associated Document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#active-sandboxing-flag-set\" id=\"ref-for-active-sandboxing-flag-set\">active sandboxing flag\n set</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection\">intersection</a> of <var>sandboxFlags</var> and TBD <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑦\">is not empty</a>, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "getInterestGroupAdAuctionData()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-getinterestgroupadauctiondata",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-getinterestgroupadauctiondata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getInterestGroupAdAuctionData(<var>config</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑧\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use④\">allowed to use</a> the \"<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#run-ad-auction\" id=\"ref-for-run-ad-auction①\">run-ad-auction</a>\" <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature④\">policy-controlled feature</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④③\">throw</a> a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑨\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise④\">a new promise</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue③\">starting a new parallel queue</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps④\">Enqueue the following steps</a> to <var>queue</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>igMap</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⓪\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys①④\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②②\">origins</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①⑤\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑧\">lists</a>.</p>"
            },
            {
              "html": "<p>Let <var>startTime</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-moment\" id=\"ref-for-dfn-moment②\">moment</a> equal to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⓪\">current wall time</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④③\">For each</a> <var>ig</var> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②⑥\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②⑤\">interest group set</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①④\">ads</a> is null or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑧\">is empty</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①②\">continue</a>.</p>"
                },
                {
                  "html": "<p>Let <var>owner</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④⓪\">owner</a>.</p>"
                },
                {
                  "html": "<p>If <var>igMap</var>[<var>owner</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⓪\">exist</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⑧\">set</a> <var>igMap</var>[<var>owner</var>] to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑨\">list</a>.</p>"
                },
                {
                  "html": "<p>Let <var>ads</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⓪\">list</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④④\">For each</a> <var>ad</var> in <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①⑤\">ads</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑧\">append</a> <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-ad-render-id\" id=\"ref-for-interest-group-ad-ad-render-id⑤\">ad render ID</a> to <var>ads</var>.</p>"
                },
                {
                  "html": "<p>Let <var>components</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④①\">list</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑤\">For each</a> <var>component</var> in <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components⑦\">ad components</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑨\">append</a> <var>component</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-ad-render-id\" id=\"ref-for-interest-group-ad-ad-render-id⑥\">ad render ID</a> to <var>components</var>.</p>"
                },
                {
                  "html": "<p>Let <var>prevWins</var> be a new <code><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①⑤\">sequence</a>&lt;<a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-previous-win\" id=\"ref-for-server-auction-previous-win①\">server auction previous win</a>&gt;</code>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑥\">For each</a> <var>prevWin</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-previous-wins\" id=\"ref-for-interest-group-previous-wins③\">previous wins</a> for all days within the\nthe last 30 days:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>timeDelta</var> be <var>startTime</var> minus <var>prevWin</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-time\" id=\"ref-for-previous-win-time③\">time</a>.</p>"
                    },
                    {
                      "html": "<p>Set <var>timeDelta</var> to 0 if <var>timeDelta</var> is negative, <var>timeDelta</var>’s nearest second (rounding down)\notherwise.</p>"
                    },
                    {
                      "html": "<p>Let <var>serverPrevWin</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-previous-win\" id=\"ref-for-server-auction-previous-win②\">server auction previous win</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②③\">items</a>:</p>\n            <dl>\n             <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-previous-win-time-delta\" id=\"ref-for-server-auction-previous-win-time-delta\">time delta</a>\n             </dt><dd data-md=\"\">\n              <p><var>timeDelta</var></p>\n             </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-previous-win-ad-render-id\" id=\"ref-for-server-auction-previous-win-ad-render-id\">ad render ID</a>\n             </dt><dd data-md=\"\">\n              <p>the value of the \"adRenderId\" field in <var>prevWin</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#previous-win-ad-json\" id=\"ref-for-previous-win-ad-json②\">ad json</a>, or the empty string if not present</p>\n            </dd></dl>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⓪\">Append</a> <var>serverPrevWin</var> to <var>prevWins</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>browserSignals</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-browser-signals\" id=\"ref-for-server-auction-browser-signals①\">server auction browser signals</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②④\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-browser-signals-bid-count\" id=\"ref-for-server-auction-browser-signals-bid-count\">bid count</a>\n           </dt><dd data-md=\"\">\n            <p>the sum of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bid-counts\" id=\"ref-for-interest-group-bid-counts④\">bid counts</a> with a bid day within the last 30 days</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-browser-signals-join-count\" id=\"ref-for-server-auction-browser-signals-join-count\">join count</a>\n           </dt><dd data-md=\"\">\n            <p>the sum of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-counts\" id=\"ref-for-interest-group-join-counts④\">join counts</a> with a join day within the last 30 days</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-browser-signals-recency-ms\" id=\"ref-for-server-auction-browser-signals-recency-ms\">recency ms</a>\n           </dt><dd data-md=\"\">\n            <p>the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①①\">current wall time</a> minus <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-join-time\" id=\"ref-for-interest-group-join-time③\">join time</a> in millseconds</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-browser-signals-previous-wins\" id=\"ref-for-server-auction-browser-signals-previous-wins\">previous wins</a>\n           </dt><dd data-md=\"\">\n            <p><var>prevWins</var></p>\n          </dd></dl>"
                },
                {
                  "html": "<p>Let <var>serverIg</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group\" id=\"ref-for-server-auction-interest-group\">server auction interest group</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②⑤\">items</a>:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-name\" id=\"ref-for-server-auction-interest-group-name\">name</a>\n           </dt><dd data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①⑦\">name</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-bidding-signals-keys\" id=\"ref-for-server-auction-interest-group-bidding-signals-keys\">bidding signals keys</a>\n           </dt><dd data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys⑤\">trusted bidding signals keys</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-user-bidding-signals\" id=\"ref-for-server-auction-interest-group-user-bidding-signals\">user bidding signals</a>\n           </dt><dd data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-user-bidding-signals\" id=\"ref-for-interest-group-user-bidding-signals③\">user bidding signals</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-ads\" id=\"ref-for-server-auction-interest-group-ads\">ads</a>\n           </dt><dd data-md=\"\">\n            <p><var>ads</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-components\" id=\"ref-for-server-auction-interest-group-components\">components</a>\n           </dt><dd data-md=\"\">\n            <p><var>components</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-interest-group-browser-signals\" id=\"ref-for-server-auction-interest-group-browser-signals\">browser signals</a>\n           </dt><dd data-md=\"\">\n            <p><var>browserSignals</var></p>\n          </dd></dl>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④①\">Append</a> <var>serverIg</var> to <var>igMap</var>[<var>owner</var>].</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>result</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-adauctiondata\" id=\"ref-for-dictdef-adauctiondata①\">AdAuctionData</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>requestId</var> be the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#string-representation\" id=\"ref-for-string-representation\">string representation</a> of a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#version-4-uuid\" id=\"ref-for-version-4-uuid\">version 4 UUID</a>.</p>"
            },
            {
              "html": "<p>Set <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adauctiondata-requestid\" id=\"ref-for-dom-adauctiondata-requestid\">requestId</a></code> field to <var>requestId</var>.</p>"
            },
            {
              "html": "<p>Let <var>context</var> be the result of serializing <var>igMap</var> using <var>config</var> into <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adauctiondata-request\" id=\"ref-for-dom-adauctiondata-request\">request</a></code> field.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①⓪\">DOM manipulation task source</a>, given <var>global</var>, to\nresolve <var>p</var> with <var>result</var>.</p>"
            },
            {
              "html": "<p>Let <var>requestContext</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-request-context\" id=\"ref-for-server-auction-request-context\">server auction request context</a>.</p>"
            },
            {
              "html": "<p>Set <var>requestContext</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-request-context-request-id\" id=\"ref-for-server-auction-request-context-request-id\">request ID</a> field to the value of <var>result</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adauctiondata-requestid\" id=\"ref-for-dom-adauctiondata-requestid①\">requestId</a></code> field.</p>"
            },
            {
              "html": "<p>Set <var>requestContext</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#server-auction-request-context-request-context\" id=\"ref-for-server-auction-request-context-request-context\">request context</a> field to <var>context</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤⑨\">Set</a> <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑨\">associated Document’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable③\">node navigable’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable②\">traversable navigable’s</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-saved-bidding-and-auction-request-context\" id=\"ref-for-traversable-navigable-saved-bidding-and-auction-request-context①\">saved Bidding and Auction request context</a>[<var>requestId</var>] to <var>requestContext</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return p.</p>"
        }
      ]
    },
    {
      "name": "collect a single forDebuggingOnly report",
      "href": "https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"collect-a-single-fordebuggingonly-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">collect a single forDebuggingOnly report</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑤\">URL</a> <var>reportUrl</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②③\">origin</a> <var>invokingOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④②\">list</a> <var>debugReportUrls</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>reportUrl</var> is null, or the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#is-debugging-only-in-cooldown-or-lockout\" id=\"ref-for-is-debugging-only-in-cooldown-or-lockout②\">is debugging only in cooldown or lockout</a> with <var>invokingOrigin</var> is true, then return.</p>"
        },
        {
          "html": "<p>If the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#sample-a-debug-report\" id=\"ref-for-sample-a-debug-report\">sample a debug report</a> with <var>invokingOrigin</var> is true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④②\">append</a> <var>reportUrl</var> to <var>debugReportUrls</var>.</p>"
        }
      ]
    },
    {
      "name": "collect forDebuggingOnly reports",
      "href": "https://wicg.github.io/turtledove/#collect-fordebuggingonly-reports",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"collect-fordebuggingonly-reports\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">collect forDebuggingOnly reports</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info⑤\">bid debug reporting info</a> <var>bidDebugReportInfoList</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②④\">origin</a> <var>seller</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info\" id=\"ref-for-leading-bid-info⑦\">leading bid info</a>-or-null <var>winnerInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>auctionReportInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info\" id=\"ref-for-auction-report-info③\">auction report info</a>.</p>"
        },
        {
          "html": "<p>Let <var>winningBid</var> be <var>winnerInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#leading-bid-info-leading-bid\" id=\"ref-for-leading-bid-info-leading-bid②④\">leading bid</a> if <var>winnerInfo</var> is\nnot null, null otherwise.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑦\">For each</a> <var>bidDebugReportInfo</var> of <var>bidDebugReportInfoList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>winningBid</var> is not null and <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-ids\" id=\"ref-for-bid-debug-reporting-info-ids\">ids</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contains</a> <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-id\" id=\"ref-for-generated-bid-id②\">id</a>:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①④\">Assert</a> that <var>winningBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-id\" id=\"ref-for-generated-bid-id③\">id</a> is not null.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-bidder-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-bidder-debug-win-report-url\">bidder debug win report url</a>, <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-interest-group-owner\" id=\"ref-for-bid-debug-reporting-info-interest-group-owner\">interest group owner</a>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-win-report-urls\" id=\"ref-for-auction-report-info-debug-win-report-urls①\">debug win report urls</a>.</p>"
                },
                {
                  "html": "If <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-component-seller\" id=\"ref-for-bid-debug-reporting-info-component-seller①\">component seller</a> is null:",
                  "rationale": "collect",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report①\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-win-report-url①\">seller debug win report url</a>, <var>seller</var>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-win-report-urls\" id=\"ref-for-auction-report-info-debug-win-report-urls②\">debug win report urls</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise:",
                  "rationale": "collect",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report②\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-win-report-url②\">seller debug win report url</a>, <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-component-seller\" id=\"ref-for-bid-debug-reporting-info-component-seller②\">component seller</a>, <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-win-report-urls\" id=\"ref-for-auction-report-info-debug-win-report-urls③\">debug win report urls</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report③\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-top-level-seller-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-top-level-seller-debug-win-report-url①\">top level seller debug win report url</a>, <var>seller</var>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-win-report-urls\" id=\"ref-for-auction-report-info-debug-win-report-urls④\">debug win report urls</a>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "collect",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report④\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-bidder-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-bidder-debug-loss-report-url\">bidder debug loss report url</a>, <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-interest-group-owner\" id=\"ref-for-bid-debug-reporting-info-interest-group-owner①\">interest group owner</a>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls②\">debug loss report urls</a>.</p>"
                },
                {
                  "html": "If <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-component-seller\" id=\"ref-for-bid-debug-reporting-info-component-seller③\">component seller</a> is null:",
                  "rationale": "collect",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report⑤\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-loss-report-url①\">seller debug loss report url</a>, <var>seller</var>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls③\">debug loss report urls</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise:",
                  "rationale": "collect",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report⑥\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-seller-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-seller-debug-loss-report-url②\">seller debug loss report url</a>, <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-component-seller\" id=\"ref-for-bid-debug-reporting-info-component-seller④\">component seller</a>, <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls④\">debug loss report urls</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#collect-a-single-fordebuggingonly-report\" id=\"ref-for-collect-a-single-fordebuggingonly-report⑦\">Collect a single forDebuggingOnly report</a> with <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-top-level-seller-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-top-level-seller-debug-loss-report-url①\">top level seller debug loss report url</a>, <var>seller</var>, and <var>auctionReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-report-info-debug-loss-report-urls\" id=\"ref-for-auction-report-info-debug-loss-report-urls⑤\">debug loss report urls</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>auctionReportInfo</var>.</p>"
        }
      ]
    },
    {
      "name": "register bids for forDebuggingOnly reports",
      "href": "https://wicg.github.io/turtledove/#register-bids-for-fordebuggingonly-reports",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"register-bids-for-fordebuggingonly-reports\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">register bids for forDebuggingOnly reports</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid⑤\">generated bids</a> <var>generatedBids</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info⑥\">bid debug reporting info</a> <var>bidDebugReportInfo</var>,\n  a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info⑦\">bid debug reporting info</a> <var>bidDebugReportInfoList</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>mainId</var> be <var>bidDebugReportInfoList</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑨\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>subId</var> be 0.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④③\">Append</a> <var>bidDebugReportInfo</var> to <var>bidDebugReportInfoList</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑧\">For each</a> <var>generatedBid</var> of <var>generatedBids</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-for-k-anon-auction\" id=\"ref-for-generated-bid-for-k-anon-auction③\">for k-anon auction</a> is true:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>id</var> be (<var>mainId</var>, <var>subId</var>).</p>"
                },
                {
                  "html": "<p>Set <var>subId</var> to <var>subId</var> + 1.</p>"
                },
                {
                  "html": "<p>Set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-id\" id=\"ref-for-generated-bid-id④\">id</a> to <var>id</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> <var>id</var> to <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-ids\" id=\"ref-for-bid-debug-reporting-info-ids①\">ids</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "is debugging only in cooldown or lockout",
      "href": "https://wicg.github.io/turtledove/#is-debugging-only-in-cooldown-or-lockout",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"is-debugging-only-in-cooldown-or-lockout\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">is debugging only in cooldown or lockout</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②⑥\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②⑧\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-lockout-until\" id=\"ref-for-debug-report-lockout-until\">debug report lockout until</a> is not null, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①②\">current wall time</a> is\nless than <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent②⑨\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-lockout-until\" id=\"ref-for-debug-report-lockout-until①\">debug report lockout until</a>, return true.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③⓪\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-cooldown\" id=\"ref-for-debug-report-cooldown\">debug report cooldown</a> is null, then return false.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③①\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-cooldown\" id=\"ref-for-debug-report-cooldown①\">debug report cooldown</a>[<var>origin</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨①\">exists</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①③\">current wall time</a> is less than <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③②\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-cooldown\" id=\"ref-for-debug-report-cooldown②\">debug report cooldown</a>[<var>origin</var>], then return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "sample a debug report",
      "href": "https://wicg.github.io/turtledove/#sample-a-debug-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"sample-a-debug-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">sample a debug report</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②⑦\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>canSendAfterSampled</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>sampleRand</var> be a random <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-long\" id=\"ref-for-idl-long②\">long</a></code>, 0 ≤ <var>sampleRand</var> &lt; 1000, so each possible long would be\nchosen with a probability equal to <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#sampling-rate\" id=\"ref-for-sampling-rate①\">sampling rate</a>.</p>"
        },
        {
          "html": "If <var>sampleRand</var> is 0:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>canSendAfterSampled</var> to true.</p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③③\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-lockout-until\" id=\"ref-for-debug-report-lockout-until②\">debug report lockout until</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①④\">current wall time</a> plus <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#lockout-period\" id=\"ref-for-lockout-period①\">lockout period</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>cooldownRand</var> be a random <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-long\" id=\"ref-for-idl-long③\">long</a></code> ≥ 0 and &lt; 10, which corresponds to</p>\n      <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#long-cooldown-rate\" id=\"ref-for-long-cooldown-rate①\">long cooldown rate</a>.</p>"
        },
        {
          "html": "<p>Let <var>cooldownPeriod</var> be <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#long-cooldown-period\" id=\"ref-for-long-cooldown-period①\">long cooldown period</a> if <var>cooldownRand</var> is 0, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#short-cooldown-period\" id=\"ref-for-short-cooldown-period①\">short cooldown period</a> otherwise.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③④\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#debug-report-cooldown\" id=\"ref-for-debug-report-cooldown③\">debug report cooldown</a>[<var>origin</var>] to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⑤\">current wall time</a> plus <var>cooldownPeriod</var>.</p>"
        },
        {
          "html": "<p>Return <var>canSendAfterSampled</var>.</p>"
        }
      ]
    },
    {
      "name": "sample real time contributions",
      "href": "https://wicg.github.io/turtledove/#sample-real-time-contributions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"sample-real-time-contributions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">sample real time contributions</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑥\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution①\">real time reporting contributions</a> <var>contributions</var>, perform the following steps. They return an\n  integer or null:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>contributions</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑨\">is empty</a>, then return null.</p>"
        },
        {
          "html": "<p>Let <var>priorityWeightSum</var> be 0.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④⑨\">For each</a> <var>contribution</var> of <var>contributions</var>:",
          "rationale": "increment",
          "steps": [
            {
              "html": "<p>Increment <var>priorityWeightSum</var> by <var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-priority-weight\" id=\"ref-for-real-time-reporting-contribution-priority-weight\">priority weight</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>sampleRand</var> be a random <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double⑦\">double</a></code>, 0 ≤ sampleRand &lt; 1.</p>"
        },
        {
          "html": "<p>Set <var>sampleRand</var> to <var>sampleRand</var> multiplied by <var>priorityWeightSum</var>.</p>"
        },
        {
          "html": "<p>Set <var>priorityWeightSum</var> to 0.</p>"
        },
        {
          "html": "<p>Let <var>selectedBucket</var> be -1.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⓪\">For each</a> <var>contribution</var> of <var>contributions</var>:",
          "rationale": "increment",
          "steps": [
            {
              "html": "<p>Increment <var>priorityWeightSum</var> by <var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-priority-weight\" id=\"ref-for-real-time-reporting-contribution-priority-weight①\">priority weight</a>.</p>"
            },
            {
              "html": "<p>If <var>priorityWeightSum</var> ≥ <var>sampleRand</var>, then set <var>selectedBucket</var> to <var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-bucket\" id=\"ref-for-real-time-reporting-contribution-bucket\">bucket</a>, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">break</a>;</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑤\">Assert</a> <var>selectedBucket</var> is not -1.</p>"
        },
        {
          "html": "<p>Return <var>selectedBucket</var>.</p>"
        }
      ]
    },
    {
      "name": "bit pack",
      "href": "https://wicg.github.io/turtledove/#bit-pack",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"bit-pack\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">bit pack</dfn> a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑦\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean④\">booleans</a> <var>input</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>inputSize</var> be <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⓪\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>packed</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte\" id=\"ref-for-byte\">bytes</a>.</p>"
        },
        {
          "html": "<p>Let <var>currentByte</var> be 0.</p>"
        },
        {
          "html": "<p>Let <var>numBits</var> be 0.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤①\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range②\">the range</a> from 0 to <var>inputSize</var>, exclusive:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>currentByte</var> to <var>currentByte</var> * 2 + <var>input</var>[<var>i</var>].</p>"
            },
            {
              "html": "<p>Increment <var>numBits</var> by 1.</p>"
            },
            {
              "html": "If <var>numBits</var> is 8, then:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④④\">Append</a> <var>currentByte</var> to <var>packed</var>.</p>"
                },
                {
                  "html": "<p>Set <var>currentByte</var> to 0 and <var>numBits</var> to 0.</p>"
                }
              ]
            },
            {
              "html": "Otherwise if <var>i</var> is <var>inputSize</var> - 1, then:",
              "rationale": "while",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while①\">While</a> <var>numBits</var> &lt; 8:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>currentByte</var> to <var>currentByte</var> * 2.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⑤\">Append</a> <var>currentByte</var> to <var>packed</var>.</p>"
                    },
                    {
                      "html": "<p>Increment <var>numBits</var> by 1.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑥\">Assert</a> that <var>packed</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①①\">size</a> is (<var>inputSize</var> + 7) / 8.0.</p>"
        },
        {
          "html": "<p>Return <var>packed</var>.</p>"
        }
      ]
    },
    {
      "name": "send a real time report",
      "href": "https://wicg.github.io/turtledove/#send-a-real-time-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-a-real-time-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send a real time report</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑥\">URL</a> <var>url</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④⑨\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean⑤\">booleans</a> <var>histogram</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②⑧\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>totalBuckets</var> be the sum of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-user-buckets\" id=\"ref-for-number-of-user-buckets\">number of user buckets</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-platform-buckets\" id=\"ref-for-number-of-platform-buckets\">number of platform buckets</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑦\">Assert</a> <var>histogram</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①②\">size</a> is <var>totalBuckets</var>.</p>"
        },
        {
          "html": "<p>Let <var>userHistogram</var> and <var>platformHistogram</var> be new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⓪\">lists</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean⑥\">booleans</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤②\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range③\">the range</a> 0 to <var>totalBuckets</var>, exclusive:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>i</var> &lt; <var>userHistogram</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⑥\">append</a> <var>histogram</var>[<var>i</var>] to <var>userHistogram</var>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⑦\">append</a> <var>histogram</var>[<var>i</var>] to <var>platformHistogram</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③②\">ordered map</a> of the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\" id=\"ref-for-map-entry\">entries</a>:</p>\n      <dl>\n       <dt data-md=\"\">\"version\"\n       </dt><dd data-md=\"\">\n        <p>1</p>\n       </dd><dt data-md=\"\">\"histogram\"\n       </dt><dd data-md=\"\">\n        <p>a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③③\">ordered map</a> of the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\" id=\"ref-for-map-entry①\">entries</a>:</p>\n        <dl>\n         <dt data-md=\"\">\"buckets\"\n         </dt><dd data-md=\"\">\n          <p>the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bit-pack\" id=\"ref-for-bit-pack\">bit packing</a> with <var>userHistogram</var></p>\n         </dd><dt data-md=\"\">\"length\"\n         </dt><dd data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-user-buckets\" id=\"ref-for-number-of-user-buckets①\">number of user buckets</a></p>\n        </dd></dl>\n       </dd><dt data-md=\"\">\"platformHistogram\"\n       </dt><dd data-md=\"\">\n        <p>a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③④\">ordered map</a> of the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\" id=\"ref-for-map-entry②\">entries</a>:</p>\n        <dl>\n         <dt data-md=\"\">\"buckets\"\n         </dt><dd data-md=\"\">\n          <p>the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bit-pack\" id=\"ref-for-bit-pack①\">bit packing</a> with <var>platformHistogram</var></p>\n         </dd><dt data-md=\"\">\"length\"\n         </dt><dd data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-platform-buckets\" id=\"ref-for-number-of-platform-buckets①\">number of platform buckets</a></p>\n        </dd></dl>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑤\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url③\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>«<code>Content-Type</code>: <code>application/cbor</code>»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a>\n       </dt><dd data-md=\"\">\n        <p><code>POST</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a>\n       </dt><dd data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence④\">byte sequence</a> resulting from <a href=\"https://www.rfc-editor.org/rfc/rfc8949#name-specification-of-the-cbor-e\">CBOR encoding</a> <var>body</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client③\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin③\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>frameOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode③\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer③\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode③\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode③\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch③\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue②\">useParallelQueue</a> set to true.</p>"
        }
      ]
    },
    {
      "name": "send real time reports",
      "href": "https://wicg.github.io/turtledove/#send-real-time-reports",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-real-time-reports\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send real time reports</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map④\">real time reporting contributions map</a> <var>contributionsMap</var> and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②⑨\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②④\">For each</a> <var>origin</var> → <var>contributions</var> of <var>contributionsMap</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>maybeBucket</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#sample-real-time-contributions\" id=\"ref-for-sample-real-time-contributions\">sampling real time contributions</a> with <var>contributions</var>.</p>"
            },
            {
              "html": "<p>Let <var>histogram</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#apply-rappor-noise\" id=\"ref-for-apply-rappor-noise\">applying RAPPOR noise</a> with <var>maybeBucket</var>.</p>"
            },
            {
              "html": "<p>Let <var>reportUrl</var> be a new <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑦\">URL</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②⑥\">items</a>:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a>\n         </dt><dd data-md=\"\">\n          <p><var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme④\">scheme</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a>\n         </dt><dd data-md=\"\">\n          <p><var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host③\">host</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port\">port</a>\n         </dt><dd data-md=\"\">\n          <p><var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port\" id=\"ref-for-concept-origin-port\">port</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path\">path</a>\n         </dt><dd data-md=\"\">\n          <p>« \".well-known\", \"interest-group\", \"real-time-report\" »</p>\n        </dd></dl>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#send-a-real-time-report\" id=\"ref-for-send-a-real-time-report\">Send a real time report</a> with <var>reportUrl</var>, <var>histogram</var> and <var>frameOrigin</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "add a platform contribution",
      "href": "https://wicg.github.io/turtledove/#add-a-platform-contribution",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"add-a-platform-contribution\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add a platform contribution</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-long\" id=\"ref-for-idl-long④\">long</a></code> <var>bucket</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contributions-map\" id=\"ref-for-real-time-reporting-contributions-map⑤\">real time reporting contributions map</a> <var>realTimeContributionsMap</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③⓪\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑧\">Assert</a> <var>bucket</var> is one of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#platform-contribution-buckets\" id=\"ref-for-platform-contribution-buckets\">platform contribution buckets</a>.</p>"
        },
        {
          "html": "<p>Let <var>contribution</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution②\">real time reporting contribution</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item②⑦\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-bucket\" id=\"ref-for-real-time-reporting-contribution-bucket①\">bucket</a>\n       </dt><dd data-md=\"\">\n        <p><var>bucket</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-priority-weight\" id=\"ref-for-real-time-reporting-contribution-priority-weight②\">priority weight</a>\n       </dt><dd data-md=\"\">\n        <p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#platform-contribution-priority-weight\" id=\"ref-for-platform-contribution-priority-weight\">platform contribution priority weight</a></p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#insert-entries-to-map\" id=\"ref-for-insert-entries-to-map②\">Insert entries to map</a> given <var>realTimeContributionsMap</var>, <var>origin</var>, and « <var>contribution</var> » .</p>"
        }
      ]
    },
    {
      "name": "apply RAPPOR noise",
      "href": "https://wicg.github.io/turtledove/#apply-rappor-noise",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-rappor-noise\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply RAPPOR noise</dfn> given an integer-or-null <var>maybeBucket</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>totalBuckets</var> be the sum of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-user-buckets\" id=\"ref-for-number-of-user-buckets⑦\">number of user buckets</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-platform-buckets\" id=\"ref-for-number-of-platform-buckets②\">number of platform buckets</a>.</p>"
        },
        {
          "html": "<p>Let <var>histogram</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤①\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean⑦\">booleans</a>, whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①③\">size</a> is <var>totalBuckets</var>.</p>"
        },
        {
          "html": "If <var>maybeBucket</var> is not null:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑨\">Assert</a> 0 ≤ <var>maybeBucket</var> &lt; <var>totalBuckets</var>.</p>"
            },
            {
              "html": "<p>Set <var>histogram</var>[<var>maybeBucket</var>] to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>f</var> be <code><span class=\"math\">2.0/(1+e<sup><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#epsilon\" id=\"ref-for-epsilon①\">epsilon</a>/2.0</sup>)</span></code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤③\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range④\">the range</a> from 0 to <var>totalBuckets</var>, exclusive:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>rand</var> be a random <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double⑧\">double</a></code>, 0 ≤ <var>rand</var> &lt; 1</p>"
            },
            {
              "html": "If <var>rand</var> &lt; <var>f</var> / 2.0, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>flipped</var> be false if <var>histogram</var>[<var>i</var>] is true, otherwise true.</p>"
                },
                {
                  "html": "<p>Set <var>histogram</var>[<var>i</var>] to <var>flipped</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>histogram</var>.</p>"
        }
      ]
    },
    {
      "name": "createAuctionNonce()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-createauctionnonce",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-createauctionnonce\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>createAuctionNonce()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise⑤\">a new promise</a>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>nonce</var> be the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#string-representation\" id=\"ref-for-string-representation①\">string representation</a> of a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#version-4-uuid\" id=\"ref-for-version-4-uuid②\">version 4 UUID</a>.</p>"
            }
          ],
          "additional": [
            {
              "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①①\">Queue a global task</a> on <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①①\">DOM manipulation task source</a>, given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve⑤\">resolve</a> <var>p</var> with <var>nonce</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "validate and convert additional bids",
      "href": "https://wicg.github.io/turtledove/#validate-and-convert-additional-bids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-convert-additional-bids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and convert additional bids</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①③\">auction config</a> <var>auctionConfig</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①④\">auction config</a>-or-null <var>topLevelAuctionConfig</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-target-info\" id=\"ref-for-negative-target-info①\">negative target info</a> <var>negativeTargetInfo</var>,\nand a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object③\">global object</a> <var>global</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⓪\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②①\">Assert</a> that <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-nonce\" id=\"ref-for-auction-config-auction-nonce①\">auction nonce</a> is not null.</p>"
        },
        {
          "html": "<p>Let <var>auctionNonce</var> be the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#string-representation\" id=\"ref-for-string-representation②\">string representation</a> of <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-nonce\" id=\"ref-for-auction-config-auction-nonce②\">auction nonce</a>.</p>"
        },
        {
          "html": "<p>Let <var>capturedAdditionalBidsHeaders</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①⓪\">associated Document’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable④\">node navigable’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable③\">traversable navigable’s</a> <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#captured-additional-bids-headers\" id=\"ref-for-captured-additional-bids-headers\">captured additional bids headers</a>.</p>"
        },
        {
          "html": "<p>Let <var>additionalBids</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤②\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid\" id=\"ref-for-decoded-additional-bid\">decoded additional bids</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤④\">For each</a> <var>encodedSignedAdditionalBid</var> of <var>capturedAdditionalBidsHeaders</var>[<var>auctionNonce</var>]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>signedAdditionalBid</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode①\">forgiving-base64 decode</a> with <var>encodedSignedAdditionalBid</var>.</p>"
            },
            {
              "html": "<p>If <var>signedAdditionalBid</var> is failure, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①③\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>additionalBid</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-a-signed-additional-bid\" id=\"ref-for-parse-a-signed-additional-bid\">parse a signed additional bid</a> given <var>signedAdditionalBid</var>, <var>auctionConfig</var>, <var>topLevelAuctionConfig</var>, and <var>negativeTargetInfo</var>.</p>"
            },
            {
              "html": "<p>If <var>additionalBid</var> is not null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⑧\">append</a> <var>additionalBid</var> to <var>additionalBids</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>additionalBids</var>.</p>"
        }
      ]
    },
    {
      "name": "parse a signed additional bid",
      "href": "https://wicg.github.io/turtledove/#parse-a-signed-additional-bid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-a-signed-additional-bid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a signed additional bid</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑤\">byte sequence</a> <var>signedAdditionalBid</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①⑤\">auction config</a> <var>auctionConfig</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①⑥\">auction config</a>-or-null <var>topLevelAuctionConfig</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-target-info\" id=\"ref-for-negative-target-info②\">negative target info</a> <var>negativeTargetInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②②\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsedSignedAdditionalBid</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value④\">parse a JSON string to an infra value</a> given <var>signedAdditionalBid</var>.</p>"
        },
        {
          "html": "<p>Return null if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>parsedSignedAdditionalBid</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑤\">map</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedSignedAdditionalBid</var>[\"bid\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨②\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③②\">string</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedSignedAdditionalBid</var>[\"signatures\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨③\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤③\">list</a>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>signatures</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature\" id=\"ref-for-signed-additional-bid-signature\">signed additional bid signatures</a>.</p>"
        },
        {
          "html": "<p>Let <var>decodeSignatureFailed</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑤\">For each</a> <var>sig</var> of <var>parsedSignedAdditionalBid</var>[\"signatures\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>decodeSignatureFailed</var> to true and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">break</a> if any of the following\nconditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>sig</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑥\">map</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>sig</var>[\"key\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨④\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③③\">string</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>sig</var>[\"signature\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑤\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③④\">string</a>.</p>\n        </li></ul>"
            },
            {
              "html": "<p>Let <var>maybeKey</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode②\">forgiving-base64 decode</a> with <var>sig</var>[\"key\"].</p>"
            },
            {
              "html": "<p>Let <var>maybeSignature</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode③\">forgiving-base64 decode</a> with <var>sig</var>[\"signature\"].</p>"
            },
            {
              "html": "<p>Set <var>decodeSignatureFailed</var> to true and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break④\">break</a> if any of the following\nconditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>maybeKey</var> is failure, or its <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length①\">length</a> is not 32;</p>\n         </li><li data-md=\"\">\n          <p><var>maybeSignature</var> is failure, or its <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length②\">length</a> is not 64;</p>\n        </li></ul>"
            },
            {
              "html": "<p>Let <var>signature</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature\" id=\"ref-for-signed-additional-bid-signature①\">signed additional bid signatures</a>, whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature-key\" id=\"ref-for-signed-additional-bid-signature-key\">key</a> is <var>maybeKey</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature-signature\" id=\"ref-for-signed-additional-bid-signature-signature\">signature</a> is <var>maybeSignature</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④⑨\">Append</a> <var>signature</var> to <var>signatures</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>decodeSignatureFailed</var> is true, then return null.</p>"
        },
        {
          "html": "<p>Let <var>decodedAdditionalBid</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decode-an-additional-bid-json\" id=\"ref-for-decode-an-additional-bid-json\">decode an additional bid json</a> given <var>parsedSignedAdditionalBid</var>[\"bid\"], <var>auctionConfig</var> and <var>topLevelAuctionConfig</var>.</p>"
        },
        {
          "html": "<p>Return null if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>decodedAdditionalBid</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-a-currency-tag\" id=\"ref-for-check-a-currency-tag②\">checking a currency tag</a> with <var>decodedAdditionalBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-bid\" id=\"ref-for-decoded-additional-bid-bid\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid⑦\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency⑤\">currency</a> and\nthe result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#look-up-per-buyer-currency\" id=\"ref-for-look-up-per-buyer-currency④\">look up per-buyer currency</a> with <var>auctionConfig</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>verifiedSignatureKeys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑧\">set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑥\">byte sequences</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑥\">For each</a> <var>signature</var> of <var>signatures</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>isSignatureValid</var> be the result of running <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc8032#section-5.1.7\" id=\"ref-for-section-5.1.7\">verify</a> <var>signature</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature-signature\" id=\"ref-for-signed-additional-bid-signature-signature①\">signature</a> on message <var>parsedSignedAdditionalBid</var>[\"bid\"]\nusing <var>signature</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature-key\" id=\"ref-for-signed-additional-bid-signature-key①\">key</a>, with 0 for Ed25519ctx.</p>"
            },
            {
              "html": "<p>If <var>isSignatureValid</var> is true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">append</a> <var>signature</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#signed-additional-bid-signature-key\" id=\"ref-for-signed-additional-bid-signature-key②\">key</a> to <var>verifiedSignatureKeys</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-negative-targeted\" id=\"ref-for-check-whether-negative-targeted\">checking whether negative targeted</a> given <var>decodedAdditionalBid</var>, <var>verifiedSignatureKeys</var> and <var>negativeTargetInfo</var> is true, then return null.</p>"
        },
        {
          "html": "<p>Return <var>decodedAdditionalBid</var>.</p>"
        }
      ]
    },
    {
      "name": "decode an additional bid json",
      "href": "https://wicg.github.io/turtledove/#decode-an-additional-bid-json",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"decode-an-additional-bid-json\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">decode an additional bid json</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑤\">string</a> <var>additionalBidJson</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①⑦\">auction config</a> <var>auctionConfig</var>, and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config①⑧\">auction config</a>-or-null <var>topLevelAuctionConfig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②③\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsedAdditionalBid</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value⑤\">parse a JSON string to an infra value</a> given <var>additionalBidJson</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedAdditionalBid</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑦\">map</a>, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid\" id=\"ref-for-decoded-additional-bid①\">decoded additional bid</a>.</p>"
        },
        {
          "html": "<p>Return failure if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>parsedAdditionalBid</var>[\"auctionNonce\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑥\">exist</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedAdditionalBid</var>[\"auctionNonce\"] is not the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc4122.txt#string-representation\" id=\"ref-for-string-representation③\">string representation</a> of <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-nonce\" id=\"ref-for-auction-config-auction-nonce③\">auction nonce</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedAdditionalBid</var>[\"seller\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑦\">exist</a>;</p>\n       </li><li data-md=\"\">\n        <p>The result of running the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①④\">parse an https origin</a> with <var>parsedAdditionalBid</var>[\"seller\"] is\nfailure, or not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑦\">same origin</a> with <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①③\">seller</a>.</p>\n      </li></ul>"
        },
        {
          "html": "If <var>topLevelAuctionConfig</var> is null:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>parsedAdditionalBid</var>[\"topLevelSeller\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑧\">exists</a>, then return failure.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>parsedAdditionalBid</var>[\"topLevelSeller\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑨\">exist</a>, then return failure.</p>"
            },
            {
              "html": "<p>Let <var>bidTopLevelSeller</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⑤\">parse an https origin</a> with <var>parsedAdditionalBid</var>[\"topLevelSeller\"].</p>"
            },
            {
              "html": "<p>If <var>bidTopLevelSeller</var> is failure, or <var>bidTopLevelSeller</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑧\">same origin</a> with <var>topLevelAuctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller\" id=\"ref-for-auction-config-seller①④\">seller</a>, then return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>parsedAdditionalBid</var>[\"interestGroup\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⓪\">exist</a>, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>igMap</var> be <var>parsedAdditionalBid</var>[\"interestGroup\"].</p>"
        },
        {
          "html": "<p>Return failure if any the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>igMap</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑧\">map</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>igMap</var>[\"name\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪①\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑥\">string</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>igMap</var>[\"biddingLogicURL\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪②\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑦\">string</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>igMap</var>[\"owner\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪③\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑧\">string</a>;</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>igOwner</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⑥\">parse an https origin</a> given <var>igMap</var>[\"owner\"].</p>"
        },
        {
          "html": "<p>Let <var>igName</var> be <var>igMap</var>[\"name\"].</p>"
        },
        {
          "html": "<p>Let <var>igBiddingUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser③\">url parser</a> on <var>igMap</var>[\"biddingLogicURL\"].</p>"
        },
        {
          "html": "<p>Return failure if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>igOwner</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-interest-group-buyers\" id=\"ref-for-auction-config-interest-group-buyers④\">interest group buyers</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑥\">contain</a> <var>igOwner</var>;</p>\n       </li><li data-md=\"\">\n        <p><var>igBiddingUrl</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>igOwner</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑨\">same origin</a> with <var>igBiddingUrl</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>ig</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②⑧\">interest group</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④①\">owner</a>\n       </dt><dd data-md=\"\">\n        <p><var>igOwner</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name①⑧\">name</a>\n       </dt><dd data-md=\"\">\n        <p><var>igName</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url⑥\">bidding url</a>\n       </dt><dd data-md=\"\">\n        <p><var>igBiddingUrl</var></p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>parsedAdditionalBid</var>[\"bid\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪④\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑨\">map</a>, return failure.</p>"
        },
        {
          "html": "<p>Let <var>bidMap</var> be <var>parsedAdditionalBid</var>[\"bid\"].</p>"
        },
        {
          "html": "<p>If <var>bidMap</var>[\"render\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑤\">exist</a> or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③⑨\">string</a>, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>renderUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser④\">URL parser</a> on <var>bidMap</var>[\"render\"].</p>"
        },
        {
          "html": "<p>If <var>renderUrl</var> is failure, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>ad</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑥\">interest group ad</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url⑥\">render url</a> is <var>renderUrl</var>.</p>"
        },
        {
          "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①⑥\">ads</a> to « <var>ad</var> ».</p>"
        },
        {
          "html": "<p>Let <var>bidVal</var> be <var>bidMap</var>[\"bid\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑥\">exists</a>, otherwise return failure.</p>"
        },
        {
          "html": "<p>If <var>bidVal</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double⑨\">double</a></code>, or is less than or equal to 0, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>adMetadata</var> be \"null\".</p>"
        },
        {
          "html": "If <var>bidMap</var>[\"ad\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑦\">exists</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>adMetadata</var> to the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string②\">serialize an Infra value to a JSON string</a> with <var>bidMap</var>[\"ad\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>bidCurrency</var> be null.</p>"
        },
        {
          "html": "If <var>bidMap</var>[\"bidCurrency\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑧\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>bidMap</var>[\"bidCurrency\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⓪\">string</a>, or the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag\" id=\"ref-for-check-whether-a-string-is-a-valid-currency-tag②\">checking whether a string\nis a valid currency tag</a> is failure, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>bidCurrency</var> to <var>bidMap</var>[\"bidCurrency\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>adCost</var> be null.</p>"
        },
        {
          "html": "If <var>bidMap</var>[\"adCost\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑨\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>bidMap</var>[\"adCost\"] is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double①⓪\">double</a></code>, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>adCost</var> to <var>bidMap</var>[\"adCost\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>modelingSignals</var> be null.</p>"
        },
        {
          "html": "If <var>bidMap</var>[\"modelingSignals\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⓪\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>bidMap</var>[\"modelingSignals\"] is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double①①\">double</a></code>, then return failure.</p>"
            },
            {
              "html": "<p>If <var>bidMap</var>[\"modelingSignals\"] ≥ 0, and &lt; 4096, then set <var>modelingSignals</var> to <var>bidMap</var>[\"modelingSignals\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>adComponents</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor②\">ad descriptors</a>.</p>"
        },
        {
          "html": "If <var>bidMap</var>[\"adComponents\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①①\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>bidMap</var>[\"adComponents\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑥\">list</a>, then return failure.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑦\">For each</a> <var>component</var> of <var>bidMap</var>[\"adComponents\"]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>component</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④①\">string</a>, then return failure.</p>"
                },
                {
                  "html": "<p>Let <var>componentUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser⑤\">URL parser</a> on <var>component</var>.</p>"
                },
                {
                  "html": "<p>If <var>componentUrl</var> is failure, then return failure.</p>"
                },
                {
                  "html": "<p>Let <var>componentDescriptor</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor③\">ad descriptor</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①②\">url</a> is <var>componentUrl</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⓪\">Append</a> <var>componentDescriptor</var> to <var>adComponents</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components⑧\">ad components</a> to <var>adComponents</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>parsedAdditionalBid</var>[\"negativeInterestGroup\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①②\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>parsedAdditionalBid</var>[\"negativeInterestGroups\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①③\">exists</a>, or <var>parsedAdditionalBid</var>[\"negativeInterestGroup\"] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④②\">string</a>, then return failure.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤①\">Append</a> <var>parsedAdditionalBid</var>[\"negativeInterestGroup\"] to <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-negative-target-interest-group-names\" id=\"ref-for-decoded-additional-bid-negative-target-interest-group-names\">negative target interest group names</a>.</p>"
            }
          ]
        },
        {
          "html": "If <var>parsedAdditionalBid</var>[\"negativeInterestGroups\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①④\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>multipleNegativeIg</var> be <var>parsedAdditionalBid</var>[\"negativeInterestGroups\"].</p>"
            },
            {
              "html": "<p>Return failure if any of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>multipleNegativeIg</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⓪\">map</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>multipleNegativeIg</var>[\"joiningOrigin\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑤\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④③\">string</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>multipleNegativeIg</var>[\"interestGroupNames\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑥\">exist</a>, or is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤⑦\">list</a>.</p>\n        </li></ul>"
            },
            {
              "html": "<p>Let <var>joiningOrigin</var> be the result of running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⑦\">parse an https origin</a> with <var>multipleNegativeIg</var>[\"joiningOrigin\"].</p>"
            },
            {
              "html": "<p>If <var>joiningOrigin</var> is failure, then return failure.</p>"
            },
            {
              "html": "<p>Set <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-negative-target-joining-origin\" id=\"ref-for-decoded-additional-bid-negative-target-joining-origin\">negative target joining origin</a> to <var>joiningOrigin</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑧\">For each</a> <var>igName</var> of <var>multipleNegativeIg</var>[\"interestGroupNames\"]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>igName</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④④\">string</a>, then return failure.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤②\">Append</a> <var>igName</var> to <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-negative-target-interest-group-names\" id=\"ref-for-decoded-additional-bid-negative-target-interest-group-names①\">negative target interest group names</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-bid\" id=\"ref-for-decoded-additional-bid-bid①\">bid</a> to a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid⑥\">generated bid</a> with the following\nproperties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid⑧\">bid</a>\n       </dt><dd data-md=\"\">\n        <p>A <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency\" id=\"ref-for-bid-with-currency①\">bid with currency</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value⑤\">value</a> is <var>bidVal</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency⑥\">currency</a> is <var>bidCurrency</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad\" id=\"ref-for-generated-bid-ad①\">ad</a>\n       </dt><dd data-md=\"\">\n        <p><var>adMetadata</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①④\">ad descriptor</a>\n       </dt><dd data-md=\"\">\n        <p>An <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor④\">ad descriptor</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①③\">url</a> is <var>renderUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors⑥\">ad component descriptors</a>\n       </dt><dd data-md=\"\">\n        <p><var>adComponents</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-cost\" id=\"ref-for-generated-bid-ad-cost①\">ad cost</a>\n       </dt><dd data-md=\"\">\n        <p><var>adCost</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modeling-signals\" id=\"ref-for-generated-bid-modeling-signals①\">modeling signals</a>\n       </dt><dd data-md=\"\">\n        <p><var>modelingSignals</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⑧\">interest group</a>\n       </dt><dd data-md=\"\">\n        <p><var>ig</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad④\">bid ad</a>\n       </dt><dd data-md=\"\">\n        <p>A <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑦\">interest group ad</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url⑦\">render url</a> is <var>renderUrl</var>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata⑤\">metadata</a> is <var>adMetadata</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-provided-as-additional-bid\" id=\"ref-for-generated-bid-provided-as-additional-bid①\">provided as additional bid</a>\n       </dt><dd data-md=\"\">\n        <p>true</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "check whether negative targeted",
      "href": "https://wicg.github.io/turtledove/#check-whether-negative-targeted",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-whether-negative-targeted\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check whether negative targeted</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid\" id=\"ref-for-decoded-additional-bid②\">decoded additional bid</a> <var>additionalBid</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑨\">set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑨\">byte sequences</a> <var>verifiedSignatureKeys</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-target-info\" id=\"ref-for-negative-target-info③\">negative target info</a> <var>negativeTargetInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②④\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>negativeTargeted</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>additionalBidBuyer</var> be <var>additionalBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-bid\" id=\"ref-for-decoded-additional-bid-bid②\">bid</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group①⑨\">interest group</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④②\">owner</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤⑨\">For each</a> <var>igName</var> of <var>additionalBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-negative-target-interest-group-names\" id=\"ref-for-decoded-additional-bid-negative-target-interest-group-names③\">negative target interest group names</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>negativeTargetInfo</var>[(<var>additionalBidBuyer</var>, <var>igName</var>)] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑦\">exists</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let (<var>joiningOrigin</var>, <var>additionalBidKey</var>) be <var>negativeTargetInfo</var>[(<var>additionalBidBuyer</var>, <var>igName</var>)].</p>"
                },
                {
                  "html": "If <var>verifiedSignatureKeys</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑦\">contains</a> <var>additionalBidKey</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>joiningOrigin</var> is not null:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>joiningOrigin</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①⓪\">same origin</a> with <var>additionalBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid-negative-target-joining-origin\" id=\"ref-for-decoded-additional-bid-negative-target-joining-origin①\">negative target joining origin</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①④\">continue</a>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Set <var>negativeTargeted</var> to true, and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break⑤\">break</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "check whether negative targeted",
      "href": "https://wicg.github.io/turtledove/#check-whether-negative-targeted",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-whether-negative-targeted\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check whether negative targeted</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#decoded-additional-bid\" id=\"ref-for-decoded-additional-bid②\">decoded additional bid</a> <var>additionalBid</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑨\">set</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑨\">byte sequences</a> <var>verifiedSignatureKeys</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#negative-target-info\" id=\"ref-for-negative-target-info③\">negative target info</a> <var>negativeTargetInfo</var>:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return <var>negativeTargeted</var>.</p>"
        }
      ]
    },
    {
      "name": "query k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#query-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"query-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query k-anonymity count</dfn> given a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256①\">SHA-256</a> <var>hashCode</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-server\" id=\"ref-for-k-anonymity-server①\">k-anonymity server</a> has recorded at least <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-threshold\" id=\"ref-for-k-anonymity-threshold\">k-anonymity threshold</a> users\n  seeing <var>hashCode</var> over the last <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-duration\" id=\"ref-for-k-anonymity-duration\">k-anonymity duration</a>, return true.\n  Otherwise, return false.</p>"
        },
        {
          "html": "<p>Return true if it is above the threshold, otherwise return false.</p>"
        }
      ]
    },
    {
      "name": "query k-anonymity cache",
      "href": "https://wicg.github.io/turtledove/#query-k-anonymity-cache",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"query-k-anonymity-cache\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query k-anonymity cache</dfn> given a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256②\">SHA-256</a> <var>hashCode</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③⑦\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-cache\" id=\"ref-for-k-anonymity-cache\">k-anonymity cache</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑧\">contain</a> <var>hashCode</var>, then return false.</p>"
        },
        {
          "html": "<p>Let <var>record</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③⑧\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-cache\" id=\"ref-for-k-anonymity-cache①\">k-anonymity cache</a>[<var>hashCode</var>].</p>"
        },
        {
          "html": "<p>If the difference between <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⑥\">current wall time</a> and <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-record-timestamp\" id=\"ref-for-k-anonymity-record-timestamp\">timestamp</a> is more than 7 days then return false.</p>"
        },
        {
          "html": "<p>Return <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-record-is-k-anonymous\" id=\"ref-for-k-anonymity-record-is-k-anonymous\">is k-anonymous</a>.</p>"
        }
      ]
    },
    {
      "name": "compute the key hash of ad",
      "href": "https://wicg.github.io/turtledove/#compute-the-key-hash-of-ad",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-key-hash-of-ad\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the key hash of ad</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group②⑨\">interest group</a> <var>ig</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑧\">interest group ad</a> <var>igAd</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyString</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-key\" id=\"ref-for-k-anonymity-key①\">k-anonymity key</a> formed from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate⑦\">concatenation</a> of the following strings separated with U+000A LF:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>\"AdBid\"</p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin⑨\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④⑤\">owner</a></p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑦\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url⑦\">bidding url</a></p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑧\">serialization</a> of <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url⑧\">render url</a>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256③\">SHA-256</a> hash of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode\">ASCII encoding</a> of <var>keyString</var>.</p>"
        }
      ]
    },
    {
      "name": "compute the key hash of reporting ID",
      "href": "https://wicg.github.io/turtledove/#compute-the-key-hash-of-reporting-id",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-key-hash-of-reporting-id\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the key hash of reporting ID</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③⓪\">interest group</a> <var>ig</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑨\">interest group ad</a> <var>igAd</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyString</var> be a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-key\" id=\"ref-for-k-anonymity-key②\">k-anonymity key</a> formed from the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate⑧\">concatenation</a> of the following strings separated with U+000A (LF):</p>\n      <ul>\n       <li data-md=\"\">\n        <p>\"NameReport\"</p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①⓪\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④⑥\">owner</a></p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑨\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url⑧\">bidding url</a></p>\n       </li><li data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⓪\">serialization</a> of <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url⑨\">render url</a></p>\n       </li><li data-md=\"\">\n        <p>If <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id④\">buyer and seller reporting ID</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑨\">exists</a>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>\"BuyerAndSellerReportingId\"</p>\n         </li><li data-md=\"\">\n          <p><var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id⑤\">buyer and seller reporting ID</a></p>\n        </li></ul>\n       </li><li data-md=\"\">\n        <p>Otherwise, if <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id③\">buyer reporting ID</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⓪\">exists</a>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>\"BuyerReportingId\"</p>\n         </li><li data-md=\"\">\n          <p><var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id④\">buyer reporting ID</a></p>\n        </li></ul>\n       </li><li data-md=\"\">\n        <p>Otherwise:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>\"IgName\"</p>\n         </li><li data-md=\"\">\n          <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②⓪\">name</a>.</p>\n        </li></ul>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "compute the key hash of reporting ID",
      "href": "https://wicg.github.io/turtledove/#compute-the-key-hash-of-reporting-id",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-key-hash-of-reporting-id\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the key hash of reporting ID</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③⓪\">interest group</a> <var>ig</var> and an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad⑨\">interest group ad</a> <var>igAd</var>:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256④\">SHA-256</a> hash of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode①\">ASCII encoding</a> of <var>keyString</var>.</p>"
        }
      ]
    },
    {
      "name": "compute the key hash of component ad",
      "href": "https://wicg.github.io/turtledove/#compute-the-key-hash-of-component-ad",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-key-hash-of-component-ad\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the key hash of component ad</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①⓪\">interest group ad</a> <var>igAd</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyString</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate⑨\">concatenation</a> of the following strings separated with U+000A LF:</p>",
          "ignored": [
            "\"ComponentBid\" the serialization of igAd."
          ]
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256⑤\">SHA-256</a> hash of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode②\">ASCII encoding</a> of <var>keyString</var>.</p>"
        }
      ]
    },
    {
      "name": "query generated bid k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#query-generated-bid-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"query-generated-bid-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query generated bid k-anonymity count</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid⑧\">generated bid</a> <var>bid</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Compute the <var>adHashCode</var> following <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-ad\" id=\"ref-for-compute-the-key-hash-of-ad①\">compute the key hash of ad</a> with the <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group②⓪\">interest group</a> and <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①⑤\">ad descriptor</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-cache\" id=\"ref-for-query-k-anonymity-cache②\">query k-anonymity cache</a> for <var>adHashCode</var> returns false, return false.</p>"
        },
        {
          "html": "If <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors⑦\">ad component descriptors</a> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⓪\">For each</a> <var>adComponentDescriptor</var> in <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors⑧\">ad component descriptors</a>:",
              "rationale": "compute",
              "steps": [
                {
                  "html": "<p>Compute the <var>componentAdHashCode</var> by getting the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-component-ad\" id=\"ref-for-compute-the-key-hash-of-component-ad①\">compute the key hash of component ad</a> with <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①④\">url</a>.</p>"
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-cache\" id=\"ref-for-query-k-anonymity-cache③\">query k-anonymity cache</a> for <var>componentAdHashCode</var> returns false, return false.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "query reporting ID k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#query-reporting-id-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"query-reporting-id-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">query reporting ID k-anonymity count</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③①\">interest group</a> <var>ig</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①①\">interest group ad</a> <var>igAd</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyHash</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-reporting-id\" id=\"ref-for-compute-the-key-hash-of-reporting-id\">computing the key hash of reporting ID</a> given <var>ig</var> and <var>igAd</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-count\" id=\"ref-for-query-k-anonymity-count③\">querying the k-anonymity count</a> given <var>keyHash</var>.</p>"
        }
      ]
    },
    {
      "name": "update k-anonymity cache for key",
      "href": "https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-key",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-k-anonymity-cache-for-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update k-anonymity cache for key</dfn> given a <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256⑥\">SHA-256</a> <var>hashCode</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>record</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-record\" id=\"ref-for-k-anonymity-record①\">k-anonymity record</a>.</p>"
        },
        {
          "html": "<p>Set <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-record-timestamp\" id=\"ref-for-k-anonymity-record-timestamp①\">timestamp</a> field to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⑦\">current wall time</a>.</p>"
        },
        {
          "html": "<p>Set <var>record</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-record-is-k-anonymous\" id=\"ref-for-k-anonymity-record-is-k-anonymous①\">is k-anonymous</a> field to the result of executing <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-count\" id=\"ref-for-query-k-anonymity-count④\">query k-anonymity count</a> for <var>hashCode</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⓪\">Set</a> <var>record</var>[<var>hashCode</var>] to <var>record</var>.</p>"
        }
      ]
    },
    {
      "name": "update k-anonymity cache for interest group",
      "href": "https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-interest-group",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-k-anonymity-cache-for-interest-group\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update k-anonymity cache for interest group</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③②\">interest group</a> <var>ig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥①\">For each</a> <var>igAd</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads①⑨\">ads</a>:",
          "rationale": "compute",
          "steps": [
            {
              "html": "<p>Compute the <var>adHashCode</var> following <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-ad\" id=\"ref-for-compute-the-key-hash-of-ad②\">compute the key hash of ad</a> for <var>ig</var> and <var>igAd</var>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-key\" id=\"ref-for-update-k-anonymity-cache-for-key\">update k-anonymity cache for key</a> on <var>adHashCode</var>.</p>"
            },
            {
              "html": "<p>Compute the <var>adReportingHashCode</var> following <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-reporting-id\" id=\"ref-for-compute-the-key-hash-of-reporting-id①\">compute the key hash of reporting ID</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-key\" id=\"ref-for-update-k-anonymity-cache-for-key①\">update k-anonymity cache for key</a> on <var>adReportingHashCode</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥②\">For each</a> <var>componentAd</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components①⓪\">ad components</a>:",
          "rationale": "compute",
          "steps": [
            {
              "html": "<p>Compute the <var>componentAdHashCode</var> following <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-component-ad\" id=\"ref-for-compute-the-key-hash-of-component-ad②\">compute the key hash of component ad</a> for <var>componentAd</var>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-key\" id=\"ref-for-update-k-anonymity-cache-for-key②\">update k-anonymity cache for key</a> on <var>componentAdHashCode</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "increment k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#increment-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"increment-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">increment k-anonymity count</dfn> given a <var>hashCode</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Ask the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#k-anonymity-server\" id=\"ref-for-k-anonymity-server②\">k-anonymity server</a> to record that this <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent③⑨\">user agent</a> has seen <var>hashCode</var>.</p>"
        }
      ]
    },
    {
      "name": "increment ad k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#increment-ad-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"increment-ad-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">increment ad k-anonymity count</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③③\">interest group</a> <var>ig</var> and a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑧\">URL</a> <var>ad</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyString</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①⓪\">concatenation</a> of the following strings separated with U+000A LF:</p>",
          "ignored": [
            "\"AdBid\" the serialization of ig’s owner the serialization of ig’s bidding url the serialization of ad."
          ]
        },
        {
          "html": "<p>Let <var>keyHash</var> be the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256⑦\">SHA-256</a> hash of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode③\">ASCII encoding</a> of <var>keyString</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-k-anonymity-count\" id=\"ref-for-increment-k-anonymity-count②\">Increment k-anonymity count</a> given <var>keyHash</var>.</p>"
        }
      ]
    },
    {
      "name": "increment component ad k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#increment-component-ad-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"increment-component-ad-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">increment component ad k-anonymity count</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url⑨\">URL</a> <var>ad</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>keyString</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①①\">concatenation</a> of the following strings separated with U+000A LF:</p>",
          "ignored": [
            "\"ComponentBid\" the serialization of ad."
          ]
        },
        {
          "html": "<p>Let <var>keyHash</var> be the <a data-link-type=\"dfn\" href=\"https://www.ietf.org/rfc/rfc6234.txt#sha-256\" id=\"ref-for-sha-256⑧\">SHA-256</a> hash of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode④\">ASCII encoding</a> of <var>keyString</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-k-anonymity-count\" id=\"ref-for-increment-k-anonymity-count③\">Increment k-anonymity count</a> given <var>keyHash</var>.</p>"
        }
      ]
    },
    {
      "name": "increment reporting ID k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#increment-reporting-id-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"increment-reporting-id-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">increment reporting ID k-anonymity count</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③④\">interest group</a> <var>ig</var> and a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⓪\">URL</a> <var>ad</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>igAd</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①②\">interest group ad</a> from <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads②⓪\">ads</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①⓪\">render url</a> is <var>ad</var>.</p>"
        },
        {
          "html": "<p>Let <var>keyHash</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-reporting-id\" id=\"ref-for-compute-the-key-hash-of-reporting-id②\">computing the key hash of reporting ID</a> given <var>ig</var> and <var>igAd</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-k-anonymity-count\" id=\"ref-for-increment-k-anonymity-count④\">Increment k-anonymity count</a> given <var>keyHash</var>.</p>"
        }
      ]
    },
    {
      "name": "increment a winning bid’s k-anonymity count",
      "href": "https://wicg.github.io/turtledove/#increment-a-winning-bids-k-anonymity-count",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-local-lt=\"update k-anonymity counts\" data-noexport=\"\" id=\"increment-a-winning-bids-k-anonymity-count\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">increment a winning bid’s k-anonymity count</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid⑨\">generated bid</a> <var>winner</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-ad-k-anonymity-count\" id=\"ref-for-increment-ad-k-anonymity-count\">Increment ad k-anonymity count</a> given <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group②①\">interest group</a> and <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①⑥\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⑤\">url</a>.</p>"
        },
        {
          "html": "If <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors⑨\">ad component descriptors</a> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥③\">For each</a> <var>adComponentDescriptor</var> in <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①⓪\">ad component descriptors</a>:",
              "rationale": "increment",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-component-ad-k-anonymity-count\" id=\"ref-for-increment-component-ad-k-anonymity-count\">Increment component ad k-anonymity count</a> given <var>adComponentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⑥\">url</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#increment-reporting-id-k-anonymity-count\" id=\"ref-for-increment-reporting-id-k-anonymity-count\">Increment reporting ID k-anonymity count</a> given <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group②②\">interest group</a> and <var>winner</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①⑦\">ad descriptor</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⑦\">url</a>.</p>"
        }
      ]
    },
    {
      "name": "create a new script runner agent",
      "href": "https://wicg.github.io/turtledove/#create-a-new-script-runner-agent",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-new-script-runner-agent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new script runner agent</dfn>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>signifier</var> be a new unique internal value.</p>"
        },
        {
          "html": "<p>Let <var>candidateExecution</var> be a new <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/memory-model.html#sec-candidate-executions\" id=\"ref-for-sec-candidate-executions\">candidate execution</a>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#agent\" id=\"ref-for-agent①\">agent</a> whose [[CanBlock]] is false, [[Signifier]] is <var>signifier</var>, [[CandidateExecution]] is <var>candidateExecution</var>, and [[IsLockFree1]],\n [[IsLockFree2]], and [[LittleEndian]] are set at the implementation’s discretion.</p>"
        }
      ]
    },
    {
      "name": "obtain a script runner agent",
      "href": "https://wicg.github.io/turtledove/#obtain-a-script-runner-agent",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-script-runner-agent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a script runner agent</dfn>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>agentCluster</var> be a new <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters\" id=\"ref-for-sec-agent-clusters②\">agent cluster</a>.</p>"
        },
        {
          "html": "<p>Let <var>agent</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-runner-agent\" id=\"ref-for-create-a-new-script-runner-agent\">creating a new script runner agent</a>.</p>"
        },
        {
          "html": "<p>Add <var>agent</var> to <var>agentCluster</var>.</p>"
        },
        {
          "html": "<p>Return <var>agent</var>.</p>"
        }
      ]
    },
    {
      "name": "create a new script runner realm",
      "href": "https://wicg.github.io/turtledove/#create-a-new-script-runner-realm",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-new-script-runner-realm\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new script runner realm</dfn> with a global type <var>globalType</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑤\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>agent</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#obtain-a-script-runner-agent\" id=\"ref-for-obtain-a-script-runner-agent\">obtaining a script runner agent</a> given null, true, and false.\nRun the rest of these steps in <var>agent</var>.</p>"
        },
        {
          "html": "<p>Let <var>realmExecutionContext</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#creating-a-new-javascript-realm\" id=\"ref-for-creating-a-new-javascript-realm\">creating a new realm</a> given <var>agent</var> and the\n following customizations:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>For the global object, create a new object of type <var>globalType</var>.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Let <var>realm</var> be <var>realmExecutionContext</var>’s Realm component.</p>"
        },
        {
          "html": "Let <var>global</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a>, and run these steps:",
          "rationale": "perform",
          "steps": [
            {
              "html": "<p>Perform !<var>global</var>.[[Delete]](\"<code>Date</code>\").</p>"
            },
            {
              "html": "<p>If !<var>global</var>.[[HasProperty]](\"<code>Temporal</code>\") is true, then perform\n !<var>global</var>.[[Delete]](\"<code>Temporal</code>\").</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>realm</var>.</p>"
        }
      ]
    },
    {
      "name": "evaluate a bidding script",
      "href": "https://wicg.github.io/turtledove/#evaluate-a-bidding-script",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"evaluate-a-bidding-script\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">evaluate a bidding script</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④⑨\">string</a> <var>script</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short⑦\">unsigned short</a></code> <var>multiBidLimit</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③⑥\">interest group</a> <var>ig</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag③\">currency tag</a> <var>expectedCurrency</var>,\n  a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidinterestgroup\" id=\"ref-for-dictdef-generatebidinterestgroup②\">GenerateBidInterestGroup</a></code> <var>igGenerateBid</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⓪\">string</a>-or-null <var>auctionSignals</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤①\">string</a>-or-null <var>perBuyerSignals</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④④\">ordered map</a>-or-null <var>sameOriginTrustedBiddingSignals</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑤\">ordered map</a>-or-null <var>crossOriginTrustedBiddingSignals</var>,\n  a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-biddingbrowsersignals\" id=\"ref-for-dictdef-biddingbrowsersignals②\">BiddingBrowserSignals</a></code> <var>browserSignals</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforbuyer\" id=\"ref-for-dictdef-directfromsellersignalsforbuyer②\">DirectFromSellerSignalsForBuyer</a></code> <var>directFromSellerSignalsForBuyer</var>, and an integer millisecond <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration④\">duration</a> <var>timeout</var>, perform the\n  following steps. They return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑤\">tuple</a> (<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①⓪\">generated bids</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info⑧\">bid debug reporting info</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution③\">real time reporting contributions</a>).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-runner-realm\" id=\"ref-for-create-a-new-script-runner-realm\">creating a new script runner realm</a> given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope①\">InterestGroupBiddingScriptRunnerGlobalScope</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>settings</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-settings-object\" id=\"ref-for-concept-realm-settings-object①\">settings object</a>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components\">group has ad components</a> to true if <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components①①\">ad components</a> is not null, or false otherwise.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-expected-currency\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-expected-currency\">expected currency</a> to <var>expectedCurrency</var>.</p>"
        },
        {
          "html": "<p>Let <var>isComponentAuction</var> be true if <var>browserSignals</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-biddingbrowsersignals-toplevelseller\" id=\"ref-for-dom-biddingbrowsersignals-toplevelseller①\">topLevelSeller</a></code>\"] is not null, or\nfalse otherwise.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-is-component-auction\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-is-component-auction\">is component auction</a> to <var>isComponentAuction</var>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-multi-bid-limit\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-multi-bid-limit\">multi-bid limit</a> to <var>multiBidLimit</var>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group\">interest group</a> to <var>ig</var>.</p>"
        },
        {
          "html": "<p>Let <var>igJS</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value②\">converting to ECMAScript values</a> given <var>igGenerateBid</var>.</p>"
        },
        {
          "html": "<p>Let <var>auctionSignalsJS</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-a-javascript-value\" id=\"ref-for-parse-a-json-string-to-a-javascript-value②\">parsing a JSON string to a JavaScript value</a> given <var>auctionSignals</var> if <var>auctionSignals</var> is not null, otherwise <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①⑤\">undefined</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>perBuyerSignalsJS</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-a-javascript-value\" id=\"ref-for-parse-a-json-string-to-a-javascript-value③\">parsing a JSON string to a JavaScript value</a> given <var>perBuyerSignals</var> if <var>perBuyerSignals</var> is not null, otherwise <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined①⑥\">undefined</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>sameOriginTrustedBiddingSignalsJS</var> be <var>sameOriginTrustedBiddingSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value③\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>browserSignalsJS</var> be <var>browserSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value④\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignalsJS</var> be <var>directFromSellerSignalsForBuyer</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value⑤\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>crossOriginTrustedBiddingSignalsJS</var> be <var>crossOriginTrustedBiddingSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value⑥\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>startTime</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time⑥\">current monotonic time</a>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-script\" id=\"ref-for-evaluate-a-script\">evaluating a script</a> with <var>realm</var>, <var>script</var>, \"<code>generateBid</code>\",\n« <var>igJS</var>, <var>auctionSignalsJS</var>, <var>perBuyerSignalsJS</var>, <var>sameOriginTrustedBiddingSignalsJS</var>, <var>browserSignalsJS</var>, <var>directFromSellerSignalsJS</var>, <var>crossOriginTrustedBiddingSignalsJS</var> »,\n  and <var>timeout</var>.</p>"
        },
        {
          "html": "<p>Let <var>duration</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time⑦\">current monotonic time</a> minus <var>startTime</var> in milliseconds.</p>"
        },
        {
          "html": "If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority\">priority</a> is not null and not failure:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority③\">priority</a> to <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority①\">priority</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace②\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③⑦\">interest group</a> that has <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④⑧\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②①\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④②\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set②⑨\">interest group set</a> with <var>ig</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority-signals\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority-signals\">priority signals</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty①\">is not empty</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⑤\">For each</a> <var>k</var> → <var>v</var> of <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority-signals\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority-signals①\">priority signals</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>v</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑥\">remove</a> <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides①\">priority signals overrides</a>[<var>k</var>].</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥①\">set</a> <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides②\">priority signals overrides</a>[<var>k</var>] to <var>v</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace③\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group③⑧\">interest group</a> that has <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner④⑨\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②②\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④③\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③⓪\">interest group set</a> with <var>ig</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>generatedBids</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-bids\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-bids\">bids</a>.</p>"
        },
        {
          "html": "If <var>result</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type\">normal completion</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>generatedBidIDL</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value\">converting</a> <var>result</var>’s [[Value]] to a (<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput\">GenerateBidOutput</a></code> or <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①⑥\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput①\">GenerateBidOutput</a></code>&gt;).</p>"
            },
            {
              "html": "<p>If no exception was <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④⑤\">thrown</a> in the previous step, set <var>generatedBids</var> to the\n  result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids\" id=\"ref-for-convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids\">converting one or many GenerateBidOutputs to a list of generated bids</a> with <var>generatedBidIDL</var>, <var>multiBidLimit</var>, <var>ig</var>, <var>expectedCurrency</var>, <var>isComponentAuction</var>,\n  and <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components①\">group has ad components</a>.</p>"
            },
            {
              "html": "<p>Otherwise, set <var>generatedBids</var> to failure.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>generatedBids</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥②\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①①\">generated bids</a>, set <var>generatedBids</var> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①②\">generated bids</a>.</p>"
        },
        {
          "html": "<p>Let <var>bidDebugReportInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info\" id=\"ref-for-bid-debug-reporting-info⑨\">bid debug reporting info</a>.</p>"
        },
        {
          "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-interest-group-owner\" id=\"ref-for-bid-debug-reporting-info-interest-group-owner②\">interest group owner</a> to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤⓪\">owner</a>.</p>"
        },
        {
          "html": "<p>Let <var>debugLossReportUrl</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url\">debug loss report url</a> if it’s not\nfailure, null otherwise.</p>"
        },
        {
          "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-bidder-debug-loss-report-url\" id=\"ref-for-bid-debug-reporting-info-bidder-debug-loss-report-url①\">bidder debug loss report url</a> to <var>debugLossReportUrl</var>.</p>"
        },
        {
          "html": "If <var>generatedBids</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⓪\">is not empty</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>debugWinReportUrl</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url\">debug win report url</a> if it’s not\nfailure, null otherwise.</p>"
            },
            {
              "html": "<p>Set <var>bidDebugReportInfo</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-debug-reporting-info-bidder-debug-win-report-url\" id=\"ref-for-bid-debug-reporting-info-bidder-debug-win-report-url①\">bidder debug win report url</a> to <var>debugWinReportUrl</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥④\">For each</a> <var>generatedBid</var> in <var>generatedBids</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-duration\" id=\"ref-for-generated-bid-bid-duration①\">bid duration</a> to <var>duration</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-interest-group\" id=\"ref-for-generated-bid-interest-group②③\">interest group</a> to <var>ig</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>realTimeContributions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥④\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution④\">real time reporting contributions</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑤\">For each</a> <var>contribution</var> of <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions\">real time reporting contributions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-latency-threshold\" id=\"ref-for-real-time-reporting-contribution-latency-threshold\">latency threshold</a> is not null, and\n≥ <var>duration</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑤\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤③\">Append</a> <var>contribution</var> to <var>realTimeContributions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple⑥\">tuple</a> (<var>generatedBids</var>, <var>bidDebugReportInfo</var>, <var>realTimeContributions</var>).</p>"
        }
      ]
    },
    {
      "name": "evaluate a scoring script",
      "href": "https://wicg.github.io/turtledove/#evaluate-a-scoring-script",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"evaluate-a-scoring-script\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">evaluate a scoring script</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤②\">string</a> <var>script</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤③\">string</a> <var>adMetadata</var>,\n  a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double①②\">double</a></code> <var>bidValue</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionadconfig\" id=\"ref-for-dictdef-auctionadconfig④\">AuctionAdConfig</a></code> <var>auctionConfigIDL</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑥\">ordered map</a>-or-null <var>sameOriginTrustedScoringSignals</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑦\">ordered map</a>-or-null <var>crossOriginTrustedScoringSignals</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-scoringbrowsersignals\" id=\"ref-for-dictdef-scoringbrowsersignals①\">ScoringBrowserSignals</a></code> <var>browserSignals</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-directfromsellersignalsforseller\" id=\"ref-for-dictdef-directfromsellersignalsforseller②\">DirectFromSellerSignalsForSeller</a></code> <var>directFromSellerSignalsForSeller</var>, and an integer millisecond <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration⑤\">duration</a> <var>timeout</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-runner-realm\" id=\"ref-for-create-a-new-script-runner-realm①\">creating a new script runner realm</a> given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#interestgroupscoringscriptrunnerglobalscope\" id=\"ref-for-interestgroupscoringscriptrunnerglobalscope①\">InterestGroupScoringScriptRunnerGlobalScope</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>browserSignalsJS</var> be <var>browserSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value⑦\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>auctionConfigJS</var> be <var>auctionConfigIDL</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value⑧\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>sameOriginTrustedScoringSignalsJS</var> be <var>sameOriginTrustedScoringSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value⑨\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>crossOriginTrustedScoringSignalsJS</var> be <var>crossOriginTrustedScoringSignals</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①⓪\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>directFromSellerSignalsJs</var> be <var>directFromSellerSignalsForSeller</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①①\">converted to ECMAScript values</a>.</p>"
        },
        {
          "html": "<p>Let <var>startTime</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time⑧\">current monotonic time</a>.</p>"
        },
        {
          "html": "<p>Let <var>scoreAdResult</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-script\" id=\"ref-for-evaluate-a-script①\">evaluating a script</a> with <var>realm</var>, <var>script</var>, \"<code>scoreAd</code>\",\n«<var>adMetadata</var>, <var>bidValue</var>, <var>auctionConfigJS</var>, <var>sameOriginTrustedScoringSignalsJS</var>, <var>browserSignalsJS</var>, <var>directFromSellerSignalsJs</var>, <var>crossOriginTrustedScoringSignalsJS</var>»,\nand <var>timeout</var>.</p>"
        },
        {
          "html": "<p>Let <var>duration</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-monotonic-time\" id=\"ref-for-dfn-current-monotonic-time⑨\">current monotonic time</a> minus <var>startTime</var> in milliseconds.</p>"
        },
        {
          "html": "<p>Let <var>debugWinReportUrl</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url①\">debug win report url</a> if it’s not\nfailure, null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>debugLossReportUrl</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url①\">debug loss report url</a> if it’s not\nfailure, null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>realTimeContributions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution⑤\">real time reporting contributions</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑥\">For each</a> <var>contribution</var> of <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions①\">real time reporting contributions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>contribution</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-latency-threshold\" id=\"ref-for-real-time-reporting-contribution-latency-threshold①\">latency threshold</a> is not null, and\n≥ <var>duration</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑥\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤④\">Append</a> <var>contribution</var> to <var>realTimeContributions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return « <var>scoreAdResult</var>, <var>debugWinReportUrl</var>, <var>debugLossReportUrl</var>, <var>realTimeContributions</var> ».</p>"
        }
      ]
    },
    {
      "name": "evaluate a reporting script",
      "href": "https://wicg.github.io/turtledove/#evaluate-a-reporting-script",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"evaluate-a-reporting-script\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">evaluate a reporting script</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤④\">string</a> <var>script</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⑤\">string</a> <var>functionName</var>, an integer millisecond <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration⑥\">duration</a> <var>timeout</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑥\">list</a> of arguments <var>arguments</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#create-a-new-script-runner-realm\" id=\"ref-for-create-a-new-script-runner-realm②\">creating a new script runner realm</a> given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope①\">InterestGroupReportingScriptRunnerGlobalScope</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>argumentsJS</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#web-idl-arguments-list-converting\" id=\"ref-for-web-idl-arguments-list-converting\">converting</a> <var>arguments</var> to an ECMAScript arguments list. If this <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④⑥\">throws</a> an exception, return « \"null\", null, null, null ».</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#evaluate-a-script\" id=\"ref-for-evaluate-a-script②\">evaluating a script</a> with <var>realm</var>, <var>script</var>, <var>functionName</var>, <var>argumentsJS</var>, and <var>timeout</var>.</p>"
        },
        {
          "html": "<p>If <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①\">abrupt completion</a>, return « \"null\", null, null, null ».</p>"
        },
        {
          "html": "<p>Let <var>resultJSON</var> be \"null\".</p>"
        },
        {
          "html": "<p>If <var>functionName</var> is \"<code>reportResult</code>\", then set <var>resultJSON</var> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string⑤\">serializing a JavaScript value to a JSON string</a> given <var>result</var>.</p>"
        },
        {
          "html": "<p>Let <var>reportURL</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-report-url\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-report-url\">report url</a></p>"
        },
        {
          "html": "<p>If <var>reportURL</var> is failure, set <var>reportURL</var> to null.</p>"
        },
        {
          "html": "<p>Let <var>macroMap</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-reporting-macro-map\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-reporting-macro-map\">reporting macro map</a> if <var>functionName</var> is \"<code>reportWin</code>\" or \"<code>reportAdditionalBidWin</code>\", null otherwise.</p>"
        },
        {
          "html": "<p>Return « <var>resultJSON</var>, <var>reportURL</var>, <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map\">reporting beacon map</a>, <var>macroMap</var> ».</p>"
        }
      ]
    },
    {
      "name": "evaluate a script",
      "href": "https://wicg.github.io/turtledove/#evaluate-a-script",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"evaluate-a-script\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">evaluate a script</dfn> with a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm①\">realm</a> <var>realm</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⑥\">string</a> <var>script</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⑦\">string</a> <var>functionName</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥⑦\">list</a> <var>arguments</var>, and an integer millisecond <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration⑦\">duration</a> <var>timeout</var>, run these steps.\n  They return a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type②\">Completion Record</a>, which is either an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type③\">abrupt completion</a> (in\n  the case of a parse failure or execution error), or a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type④\">normal completion</a> populated with the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-ecmascript-language-types\" id=\"ref-for-sec-ecmascript-language-types\">ECMAScript language value</a> result of invoking <var>functionName</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑥\">Assert</a> that these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If <var>timeout</var> ≤ 0, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/C#immediately\" id=\"ref-for-immediately\">immediately</a> interrupt the execution and set <var>finalCompletion</var> to a\nnew <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑤\">throw completion</a> given null.</p>"
        },
        {
          "html": "<p>Let <var>global</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a>, and run these steps in <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm's-agent\" id=\"ref-for-realm's-agent\">agent</a>:</p>"
        },
        {
          "html": "<p>Let <var>result</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/multipage/ecmascript-language-scripts-and-modules.html#sec-parse-script\" id=\"ref-for-sec-parse-script\">ParseScript</a>(<var>script</var>, <var>realm</var>, <code>empty</code>).</p>"
        },
        {
          "html": "<p>If <var>result</var> is a list of errors, return\n Completion { [[Type]]: <code>throw</code>, [[Value]]: <var>result</var>, [[Target]]: <code>empty</code> }.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑦\">Assert</a>: <var>result</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-language-scripts-and-modules.html#script-record\" id=\"ref-for-script-record①\">Script Record</a>.</p>"
        },
        {
          "html": "<p><em>Prepare to run script</em>: Push <var>realmExecutionContext</var> onto the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#execution-context-stack\" id=\"ref-for-execution-context-stack\">JavaScript execution context stack</a>; it is now the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#running-execution-context\" id=\"ref-for-running-execution-context\">running JavaScript execution context</a>.</p>"
        },
        {
          "html": "<p>Let <var>evaluationStatus</var> be the result of <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/multipage/ecmascript-language-scripts-and-modules.html#sec-runtime-semantics-scriptevaluation\" id=\"ref-for-sec-runtime-semantics-scriptevaluation\">ScriptEvaluation</a>(result).</p>"
        },
        {
          "html": "<p>If <var>evaluationStatus</var> is an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑥\">abrupt completion</a>, jump to the step labeled <i> <a href=\"https://wicg.github.io/turtledove/#evaluate-script-return\">return</a></i>.</p>"
        },
        {
          "html": "<p>Let <var>F</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/multipage/abstract-operations.html#sec-get-o-p\" id=\"ref-for-sec-get-o-p\">Get</a>(<var>global</var>, <var>functionName</var>). If that returns a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑦\">throw completion</a>,\n set <var>finalCompletion</var> to <var>F</var> and jump to the step labeled <i> <a href=\"https://wicg.github.io/turtledove/#evaluate-script-return\">return</a></i>.</p>"
        },
        {
          "html": "<p>Set <var>finalCompletion</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑧\">Completion</a>(<a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/multipage/abstract-operations.html#sec-call\" id=\"ref-for-sec-call\">Call</a>(F, <code>undefined</code>, <var>arguments</var>)).</p>\n      <p>In <var>timeout</var> milliseconds, if the invocation of <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/multipage/abstract-operations.html#sec-call\" id=\"ref-for-sec-call①\">Call</a> has not completed, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/C#immediately\" id=\"ref-for-immediately①\">immediately</a> interrupt the execution and set <var>finalCompletion</var> to a new <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑨\">throw completion</a> given null.</p>"
        },
        {
          "html": "<i id=\"evaluate-script-return\">Return</i>: at this point <var>finalCompletion</var> will be set to a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①⓪\">Completion Record</a>.",
          "rationale": "clean",
          "steps": [
            {
              "html": "<p><em>Clean up after script</em>: <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑧\">Assert</a> <var>realmExecutionContext</var> is the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#running-execution-context\" id=\"ref-for-running-execution-context①\">running JavaScript execution context</a>, and remove it from the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#execution-context-stack\" id=\"ref-for-execution-context-stack①\">JavaScript execution context stack</a>.</p>"
            },
            {
              "html": "<p>Return <var>finalCompletion</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "InterestGroupBiddingAndScoringScriptRunnerGlobalScope/forDebuggingOnly",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupbiddingandscoringscriptrunnerglobalscope-fordebuggingonly",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupBiddingAndScoringScriptRunnerGlobalScope\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-interestgroupbiddingandscoringscriptrunnerglobalscope-fordebuggingonly\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>forDebuggingOnly</code></dfn> getter steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-fordebuggingonly\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-fordebuggingonly\">forDebuggingOnly</a>.</p>"
        }
      ]
    },
    {
      "name": "ForDebuggingOnly/reportAdAuctionWin(url)",
      "href": "https://wicg.github.io/turtledove/#dom-fordebuggingonly-reportadauctionwin",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"ForDebuggingOnly\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-fordebuggingonly-reportadauctionwin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>reportAdAuctionWin(<var>url</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsedUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser⑥\">URL parser</a> on <var>url</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedUrl</var> is failure, or <var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme④\">scheme</a> is not \"<code>https</code>\", then set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url②\">debug win report url</a> to failure.</p>"
        },
        {
          "html": "<p>Optionally, return.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-win-report-url③\">debug win report url</a> to <var>parsedUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "ForDebuggingOnly/reportAdAuctionLoss(url)",
      "href": "https://wicg.github.io/turtledove/#dom-fordebuggingonly-reportadauctionloss",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"ForDebuggingOnly\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-fordebuggingonly-reportadauctionloss\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>reportAdAuctionLoss(<var>url</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsedUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser⑦\">URL parser</a> on <var>url</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedUrl</var> is failure, or <var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑤\">scheme</a> is not \"<code>https</code>\", then set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url②\">debug loss report url</a> to failure.</p>"
        },
        {
          "html": "<p>Optionally, return.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-debug-loss-report-url③\">debug loss report url</a> to <var>parsedUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupBiddingAndScoringScriptRunnerGlobalScope/realTimeReporting",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupbiddingandscoringscriptrunnerglobalscope-realtimereporting",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupBiddingAndScoringScriptRunnerGlobalScope\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-interestgroupbiddingandscoringscriptrunnerglobalscope-realtimereporting\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>realTimeReporting</code></dfn> getter steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-realtimereporting\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-realtimereporting\">realTimeReporting</a>.</p>"
        }
      ]
    },
    {
      "name": "RealTimeReporting/contributeToHistogram(RealTimeContribution contribution)",
      "href": "https://wicg.github.io/turtledove/#dom-realtimereporting-contributetohistogram",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"RealTimeReporting\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"contributeToHistogram(contribution)\" id=\"dom-realtimereporting-contributetohistogram\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>contributeToHistogram(<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-realtimecontribution\" id=\"ref-for-dictdef-realtimecontribution①\">RealTimeContribution</a></code> <var>contribution</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>contribution</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-realtimecontribution-bucket\" id=\"ref-for-dom-realtimecontribution-bucket\">bucket</a></code>\"] ≥ <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#number-of-user-buckets\" id=\"ref-for-number-of-user-buckets⑧\">number of user buckets</a> or is\nnegative, then return;</p>"
        },
        {
          "html": "<p>If <var>contribution</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-realtimecontribution-priorityweight\" id=\"ref-for-dom-realtimecontribution-priorityweight\">priorityWeight</a></code>\"] ≤ 0, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④⑨\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⓪\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>contributionEntry</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution\" id=\"ref-for-real-time-reporting-contribution⑦\">real time reporting contribution</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item③⓪\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-bucket\" id=\"ref-for-real-time-reporting-contribution-bucket②\">bucket</a>\n       </dt><dd data-md=\"\">\n        <p><var>contribution</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-realtimecontribution-bucket\" id=\"ref-for-dom-realtimecontribution-bucket①\">bucket</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-priority-weight\" id=\"ref-for-real-time-reporting-contribution-priority-weight③\">priority weight</a>\n       </dt><dd data-md=\"\">\n        <p><var>contribution</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-realtimecontribution-priorityweight\" id=\"ref-for-dom-realtimecontribution-priorityweight①\">priorityWeight</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#real-time-reporting-contribution-latency-threshold\" id=\"ref-for-real-time-reporting-contribution-latency-threshold②\">latency threshold</a>\n       </dt><dd data-md=\"\">\n        <p><var>contribution</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-realtimecontribution-latencythreshold\" id=\"ref-for-dom-realtimecontribution-latencythreshold\">latencyThreshold</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②①\">exists</a>, null otherwise</p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑤\">Append</a> <var>contributionEntry</var> to <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions\" id=\"ref-for-interestgroupbiddingandscoringscriptrunnerglobalscope-real-time-reporting-contributions②\">real time reporting contributions</a>.</p>"
        }
      ]
    },
    {
      "name": "convert one or many GenerateBidOutputs to a list of generated bids",
      "href": "https://wicg.github.io/turtledove/#convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert one or many GenerateBidOutputs to a list of generated bids</dfn> given a (<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput④\">GenerateBidOutput</a></code> or <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence①⑨\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput⑤\">GenerateBidOutput</a></code>&gt;) <var>oneOrManyBids</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short⑨\">unsigned short</a></code> <var>multiBidLimit</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⓪\">interest group</a> <var>ig</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag⑤\">currency tag</a> <var>expectedCurrency</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①⓪\">boolean</a> \n    <p><var>isComponentAuction</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①①\">boolean</a> <var>groupHasAdComponents</var>:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>bidSequence</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence②⓪\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput⑥\">GenerateBidOutput</a></code>&gt;.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-specific-type\" id=\"ref-for-dfn-specific-type\">specific type</a> of <var>oneOrManyBids</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput⑦\">GenerateBidOutput</a></code>, then set <var>bidSequence</var> to « <var>oneOrManyBids</var> ».</p>"
        },
        {
          "html": "<p>Otherwise, set <var>bidSequence</var> to <var>oneOrManyBids</var>.</p>"
        },
        {
          "html": "<p>If <var>bidSequence</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①④\">size</a> &gt; <var>multiBidLimit</var>, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>bids</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⓪\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①④\">generated bids</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑦\">for each</a> <var>bidOutput</var> of <var>bidSequence</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bid</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-generatebidoutput-to-generated-bid\" id=\"ref-for-convert-generatebidoutput-to-generated-bid\">converting GenerateBidOutput to generated bid</a> given <var>bidOutput</var>, <var>ig</var>, <var>expectedCurrency</var>, <var>isComponentAuction</var>, <var>groupHasAdComponents</var>.</p>"
            },
            {
              "html": "<p>If <var>bid</var> is failure, return failure.</p>"
            },
            {
              "html": "<p>If <var>bid</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑦\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑥\">Append</a> <var>bid</var> to <var>bids</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>bids</var>.</p>"
        }
      ]
    },
    {
      "name": "convert GenerateBidOutput to generated bid",
      "href": "https://wicg.github.io/turtledove/#convert-generatebidoutput-to-generated-bid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-generatebidoutput-to-generated-bid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert GenerateBidOutput to generated bid</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-generatebidoutput\" id=\"ref-for-dictdef-generatebidoutput⑧\">GenerateBidOutput</a></code> <var>generateBidOutput</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④①\">interest group</a> <var>ig</var>, a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag⑥\">currency tag</a> <var>expectedCurrency</var>, a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①②\">boolean</a> <var>isComponentAuction</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①③\">boolean</a> <var>groupHasAdComponents</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-bid\" id=\"ref-for-dom-generatebidoutput-bid\">bid</a></code>\"] ≤ 0, then return null.</p>"
        },
        {
          "html": "<p>Let <var>bid</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①⑤\">generated bid</a>.</p>"
        },
        {
          "html": "<p>If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-render\" id=\"ref-for-dom-generatebidoutput-render\">render</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②②\">exist</a>, return failure.</p>"
        },
        {
          "html": "<p>If <var>isComponentAuction</var> is true, and <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-allowcomponentauction\" id=\"ref-for-dom-generatebidoutput-allowcomponentauction\">allowComponentAuction</a></code>\"] is false, then return failure.</p>"
        },
        {
          "html": "<p>Let <var>bidCurrency</var> be null.</p>"
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-bidcurrency\" id=\"ref-for-dom-generatebidoutput-bidcurrency\">bidCurrency</a></code>\"] is specified:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag\" id=\"ref-for-check-whether-a-string-is-a-valid-currency-tag③\">checking whether a string is a valid currency tag</a> on <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-bidcurrency\" id=\"ref-for-dom-generatebidoutput-bidcurrency①\">bidCurrency</a></code>\"] is true, then set <var>bidCurrency</var> to <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-bidcurrency\" id=\"ref-for-dom-generatebidoutput-bidcurrency②\">bidCurrency</a></code>\"], otherwise return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-a-currency-tag\" id=\"ref-for-check-a-currency-tag③\">checking a currency tag</a> with <var>expectedCurrency</var> and <var>bidCurrency</var> is\nfalse, return failure.</p>"
        },
        {
          "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid\" id=\"ref-for-generated-bid-bid⑨\">bid</a> to a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency\" id=\"ref-for-bid-with-currency②\">bid with currency</a> with <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-value\" id=\"ref-for-bid-with-currency-value⑥\">value</a> <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-bid\" id=\"ref-for-dom-generatebidoutput-bid①\">bid</a></code>\"] and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bid-with-currency-currency\" id=\"ref-for-bid-with-currency-currency⑦\">currency</a> <var>bidCurrency</var>.</p>"
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-ad\" id=\"ref-for-dom-generatebidoutput-ad\">ad</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②③\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adJSON</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string⑥\">serializing a JavaScript value to a JSON string</a>, given <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-ad\" id=\"ref-for-dom-generatebidoutput-ad①\">ad</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>adJSON</var> is failure, return failure.</p>"
            },
            {
              "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad\" id=\"ref-for-generated-bid-ad②\">ad</a> to <var>adJSON</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>adDescriptor</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor⑤\">ad descriptor</a>.</p>"
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-render\" id=\"ref-for-dom-generatebidoutput-render①\">render</a></code>\"] is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString②⑤\">DOMString</a></code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser⑧\">URL parser</a> on <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-render\" id=\"ref-for-dom-generatebidoutput-render②\">render</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>adUrl</var> is failure, return failure.</p>"
            },
            {
              "html": "<p>Set <var>adDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⑧\">url</a> to <var>adUrl</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>adDescriptor</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-render\" id=\"ref-for-convert-an-ad-render\">converting an ad render</a> given <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-render\" id=\"ref-for-dom-generatebidoutput-render③\">render</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>adDescriptor</var> is failure, return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>bidAd</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#find-matching-ad\" id=\"ref-for-find-matching-ad\">finding matching ad</a> given <var>adDescriptor</var>, <var>ig</var>, and false.</p>"
        },
        {
          "html": "<p>If <var>bidAd</var> is null, return failure.</p>"
        },
        {
          "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-descriptor\" id=\"ref-for-generated-bid-ad-descriptor①⑧\">ad descriptor</a> to <var>adDescriptor</var>.</p>"
        },
        {
          "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-bid-ad\" id=\"ref-for-generated-bid-bid-ad⑤\">bid ad</a> to <var>bidAd</var>.</p>"
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-adcomponents\" id=\"ref-for-dom-generatebidoutput-adcomponents\">adComponents</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②④\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adComponents</var> be <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-adcomponents\" id=\"ref-for-dom-generatebidoutput-adcomponents①\">adComponents</a></code>\"].</p>"
            },
            {
              "html": "<p>Return failure if any of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>groupHasAdComponents</var> is false;</p>\n         </li><li data-md=\"\">\n          <p><var>adComponents</var>’s size is greater than 40 and <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents\">targetNumAdComponents</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑤\">exist</a>.</p>\n        </li></ul>"
            },
            {
              "html": "<p>Let <var>adComponentDescriptors</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor⑥\">ad descriptors</a>.</p>"
            },
            {
              "html": "For <var>component</var> in <var>adComponents</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>componentDescriptor</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor⑦\">ad descriptor</a>.</p>"
                },
                {
                  "html": "If <var>component</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString②⑥\">DOMString</a></code>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>componentUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser⑨\">URL parser</a> on <var>component</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>componentUrl</var> is failure, return failure.</p>"
                    },
                    {
                      "html": "<p>Set <var>componentDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url①⑨\">url</a> to <var>componentUrl</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>componentDescriptor</var> to the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-an-ad-render\" id=\"ref-for-convert-an-ad-render①\">converting an ad render</a> given <var>component</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>componentDescriptor</var> is failure, return failure.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#find-matching-ad\" id=\"ref-for-find-matching-ad①\">finding matching ad</a> given <var>componentUrl</var>, <var>ig</var>, and true returns null, return failure.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑦\">Append</a> <var>componentDescriptor</var> to <var>adComponentDescriptors</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①①\">ad component descriptors</a> to <var>adComponentDescriptors</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents①\">targetNumAdComponents</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑥\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents②\">targetNumAdComponents</a></code>\"] is equal to 0 or\n greater than 40, then return failure.</p>"
            },
            {
              "html": "<p>If <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①②\">ad component descriptors</a> is null, or <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①③\">ad component descriptors</a>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑤\">size</a> &lt; <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents③\">targetNumAdComponents</a></code>\"], return failure.</p>"
            },
            {
              "html": "<p>If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents④\">targetNumAdComponents</a></code>\"] &lt; <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-nummandatoryadcomponents\" id=\"ref-for-dom-generatebidoutput-nummandatoryadcomponents\">numMandatoryAdComponents</a></code>\"], return failure.</p>"
            },
            {
              "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-target-number-of-ad-components\" id=\"ref-for-generated-bid-target-number-of-ad-components\">target number of ad components</a> to <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-targetnumadcomponents\" id=\"ref-for-dom-generatebidoutput-targetnumadcomponents⑤\">targetNumAdComponents</a></code>\"].</p>"
            },
            {
              "html": "<p>Set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-number-of-mandatory-ad-components\" id=\"ref-for-generated-bid-number-of-mandatory-ad-components\">number of mandatory ad components</a> to <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-nummandatoryadcomponents\" id=\"ref-for-dom-generatebidoutput-nummandatoryadcomponents①\">numMandatoryAdComponents</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-adcost\" id=\"ref-for-dom-generatebidoutput-adcost\">adCost</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑦\">exists</a>, then set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-cost\" id=\"ref-for-generated-bid-ad-cost②\">ad cost</a> to <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-adcost\" id=\"ref-for-dom-generatebidoutput-adcost①\">adCost</a></code>\"].</p>"
        },
        {
          "html": "If <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-modelingsignals\" id=\"ref-for-dom-generatebidoutput-modelingsignals\">modelingSignals</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑧\">exists</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>modelingSignals</var> be <var>generateBidOutput</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-generatebidoutput-modelingsignals\" id=\"ref-for-dom-generatebidoutput-modelingsignals①\">modelingSignals</a></code>\"].</p>"
            },
            {
              "html": "<p>If <var>modelingSignals</var> ≥ 0 and <var>modelingSignals</var> &lt; 4096, then set <var>bid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-modeling-signals\" id=\"ref-for-generated-bid-modeling-signals②\">modeling signals</a> to the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value①\">converting</a> the ECMAScript value represented by <var>modelingSignals</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short①⓪\">unsigned short</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>bid</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an AdRender dimension value",
      "href": "https://wicg.github.io/turtledove/#parse-an-adrender-dimension-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-adrender-dimension-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an AdRender dimension value</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤⑨\">string</a> <var>input</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>position</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-position-variable\" id=\"ref-for-string-position-variable\">position variable</a>, initially pointing at the start of <var>input</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#strip-leading-and-trailing-ascii-whitespace\" id=\"ref-for-strip-leading-and-trailing-ascii-whitespace\">Strip leading and trailing ASCII whitespace</a> from <var>input</var>.</p>"
        },
        {
          "html": "<p>If <var>input</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with③\">starts with</a> \"<code>0</code>\" but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is\">is</a> not \"<code>0</code>\" and does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with④\">start with</a> \"<code>0.</code>\", then return null as the dimension and the empty string as the\ndimension unit.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points\">Collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-digit\" id=\"ref-for-ascii-digit\">ASCII digits</a> or U+002E (.), given <var>position</var>.\nLet that be <var>dimensionString</var>.</p>"
        },
        {
          "html": "<p>If <var>dimensionString</var> is the empty string, then return null as the dimension and the empty\nstring as the dimension unit.</p>"
        },
        {
          "html": "<p>Let <var>dimension</var> be the result of parsing <var>dimensionString</var> using the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#rules-for-parsing-floating-point-number-values\" id=\"ref-for-rules-for-parsing-floating-point-number-values\">rules for parsing floating-point number values</a>.</p>"
        },
        {
          "html": "<p>If <var>dimension</var> is an error, then return null as the dimension and the empty string as the dimension unit.</p>"
        },
        {
          "html": "<p>If <var>dimension</var> is less than 0, then return null as the dimension and the empty string as the\n dimension unit.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points①\">Collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lower-alpha\" id=\"ref-for-ascii-lower-alpha\">ASCII lower alpha</a>, given <var>position</var>. Let\nthat be <var>dimensionUnit</var>.</p>"
        },
        {
          "html": "<p>If <var>position</var> is not past the end of <var>input</var>, then return null as the dimension and the empty\nstring as the dimension unit.</p>"
        },
        {
          "html": "<p>If <var>dimensionUnit</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is①\">is</a> the empty string, then set <var>dimensionUnit</var> to \"px\".</p>"
        },
        {
          "html": "<p>If <var>dimensionUnit</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is②\">is</a> not \"px\", \"sh\", or \"sw\", then return null as the dimension and\nthe empty string as the dimension unit.</p>"
        },
        {
          "html": "<p>Return <var>dimension</var> as the dimension and <var>dimensionUnit</var> as the dimension unit.</p>"
        }
      ]
    },
    {
      "name": "convert an ad render",
      "href": "https://wicg.github.io/turtledove/#convert-an-ad-render",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-an-ad-render\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert an ad render</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-adrender\" id=\"ref-for-dictdef-adrender②\">AdRender</a></code> <var>adRender</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>adUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①⓪\">URL parser</a> on <var>adRender</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adrender-url\" id=\"ref-for-dom-adrender-url\">url</a></code>\"].</p>"
        },
        {
          "html": "<p>If <var>adUrl</var> is failure, return failure.</p>"
        },
        {
          "html": "<p>Let <var>adDescriptor</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor⑧\">ad descriptor</a>.</p>"
        },
        {
          "html": "<p>Set <var>adDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url②⓪\">url</a> to <var>adUrl</var>.</p>"
        },
        {
          "html": "If <var>adRender</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adrender-width\" id=\"ref-for-dom-adrender-width\">width</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑨\">exists</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>adRender</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adrender-height\" id=\"ref-for-dom-adrender-height\">height</a></code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⓪\">exist</a>, return failure.</p>"
            },
            {
              "html": "<p>Let <var>width</var> and <var>widthUnit</var> be the dimension and dimension unit that results from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-dimension-value\" id=\"ref-for-parse-an-adrender-dimension-value\">parse an AdRender dimension value</a> with <var>adRender</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adrender-width\" id=\"ref-for-dom-adrender-width①\">width</a></code>\"], respectively.</p>"
            },
            {
              "html": "<p>If <var>width</var> is null, return failure.</p>"
            },
            {
              "html": "<p>Let <var>height</var> and <var>heightUnit</var> be the dimension and dimension unit that results from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-dimension-value\" id=\"ref-for-parse-an-adrender-dimension-value①\">parse an AdRender dimension value</a> with <var>adRender</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-adrender-height\" id=\"ref-for-dom-adrender-height①\">height</a></code>\"], respectively.</p>"
            },
            {
              "html": "<p>If <var>height</var> is null, return failure.</p>"
            },
            {
              "html": "<p>Let <var>adSize</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size②\">ad size</a>.</p>"
            },
            {
              "html": "<p>Set <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width\" id=\"ref-for-ad-size-width②\">width</a> to <var>width</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width-units\" id=\"ref-for-ad-size-width-units①\">width units</a> to <var>widthUnit</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height\" id=\"ref-for-ad-size-height①\">height</a> to <var>height</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height-units\" id=\"ref-for-ad-size-height-units①\">height units</a> to <var>heightUnit</var>.</p>"
            },
            {
              "html": "<p>Set <var>adDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size⑥\">size</a> to <var>adSize</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>adDescriptor</var>.</p>"
        }
      ]
    },
    {
      "name": "find matching ad",
      "href": "https://wicg.github.io/turtledove/#find-matching-ad",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"find-matching-ad\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">find matching ad</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor⑨\">ad descriptor</a> <var>adDescriptor</var>, an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④②\">interest group</a> <var>ig</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①④\">boolean</a> <var>isComponent</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>adUrl</var> be <var>adDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-url\" id=\"ref-for-ad-descriptor-url②①\">url</a>.</p>"
        },
        {
          "html": "<p>If <var>adUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑥\">scheme</a> is not \"<code>https</code>\", return null.</p>"
        },
        {
          "html": "<p>Let <var>adSize</var> be <var>adDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor-size\" id=\"ref-for-ad-descriptor-size⑦\">size</a>.</p>"
        },
        {
          "html": "<p>Let <var>adList</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components①②\">ad components</a> if <var>isComponent</var>, otherwise <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads②①\">ads</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑧\">For each</a> <var>ad</var> in <var>adList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①①\">render url</a> does not equal <var>adUrl</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑧\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group③\">size group</a> is null, return <var>ad</var>.</p>"
            },
            {
              "html": "<p>If <var>adSize</var> is null, return <var>ad</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥⑨\">For each</a> <var>igSize</var> in (<var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-size-groups\" id=\"ref-for-interest-group-size-groups①\">size groups</a>)[<var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group④\">size group</a>]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>igSize</var> equals <var>adSize</var>, return <var>ad</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupBiddingScriptRunnerGlobalScope/setBid(oneOrManyBids)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupbiddingscriptrunnerglobalscope-setbid",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupBiddingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"setBid(oneOrManyBids)|setBid()\" id=\"dom-interestgroupbiddingscriptrunnerglobalscope-setbid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>setBid(<var>oneOrManyBids</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-bids\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-bids①\">bids</a> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦②\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>ig</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-interest-group\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-interest-group①\">interest group</a>.</p>"
        },
        {
          "html": "<p>Let <var>expectedCurrency</var> be <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-expected-currency\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-expected-currency①\">expected currency</a>.</p>"
        },
        {
          "html": "<p>Let <var>bidsToSet</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids\" id=\"ref-for-convert-one-or-many-generatebidoutputs-to-a-list-of-generated-bids①\">converting one or many GenerateBidOutputs to a list of generated bids</a> with <var>oneOrManyBids</var>, <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-multi-bid-limit\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-multi-bid-limit①\">multi-bid limit</a>, <var>ig</var>, <var>expectedCurrency</var>, <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-is-component-auction\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-is-component-auction①\">is component auction</a>, and <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-group-has-ad-components②\">group has ad components</a>.</p>"
        },
        {
          "html": "<p>If <var>bidsToSet</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④①\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-bids\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-bids②\">bids</a> to <var>bidsToSet</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupBiddingScriptRunnerGlobalScope/setPriority(priority)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupbiddingscriptrunnerglobalscope-setpriority",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupBiddingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-interestgroupbiddingscriptrunnerglobalscope-setpriority\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>setPriority(<var>priority</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority②\">priority</a> is not null, then set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority③\">priority</a> to failure, and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④②\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority④\">priority</a> to <var>priority</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupBiddingScriptRunnerGlobalScope/setPrioritySignalsOverride(key, priority)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupbiddingscriptrunnerglobalscope-setprioritysignalsoverride",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupBiddingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"setPrioritySignalsOverride(key, priority)|setPrioritySignalsOverride(key)\" id=\"dom-interestgroupbiddingscriptrunnerglobalscope-setprioritysignalsoverride\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>setPrioritySignalsOverride(<var>key</var>, <var>priority</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥②\">Set</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupbiddingscriptrunnerglobalscope-priority-signals\" id=\"ref-for-interestgroupbiddingscriptrunnerglobalscope-priority-signals②\">priority signals</a>[<var>key</var>] to <var>priority</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupReportingScriptRunnerGlobalScope/sendReportTo(url)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupreportingscriptrunnerglobalscope-sendreportto",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupReportingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-interestgroupreportingscriptrunnerglobalscope-sendreportto\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>sendReportTo(<var>url</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑤\">relevant global object</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-report-url\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-report-url①\">report url</a> is not null, then\nset <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-report-url\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-report-url②\">report url</a> to failure, and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④③\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>parsedUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①①\">URL parser</a> on <var>url</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedUrl</var> is failure, or <var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑨\">scheme</a> is not \"<code>https</code>\", set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-report-url\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-report-url③\">report url</a> to failure, and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④④\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Optionally, return.</p>"
        },
        {
          "html": "<p>Set <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-report-url\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-report-url④\">report url</a> to <var>parsedUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupReportingScriptRunnerGlobalScope/registerAdBeacon(map)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupreportingscriptrunnerglobalscope-registeradbeacon",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupReportingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-interestgroupreportingscriptrunnerglobalscope-registeradbeacon\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>registerAdBeacon(<var>map</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑥\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map①\"> reporting beacon map</a> is not null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤④\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⑤\">TypeError</a></code>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⑥\">For each</a> <var>type</var> → <var>url</var> of <var>map</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>type</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with⑤\">starts with</a> \"<code>reserved.</code>\" and <var>type</var> does not match one of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/fenced-frame/#fencedframetype-automatic-beacon-event-type\" id=\"ref-for-fencedframetype-automatic-beacon-event-type\">automatic beacon event type</a> values, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⑥\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>parsedURL</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①②\">URL parser</a> on <var>url</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤⑥\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⑦\">TypeError</a></code> if any of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>parsedURL</var> is failure;</p>\n         </li><li data-md=\"\">\n          <p><var>parsedURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①⓪\">scheme</a> is not \"<code>https</code>\".</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑦\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-reporting-beacon-map②\"> reporting beacon map</a> to <var>map</var>.</p>"
        }
      ]
    },
    {
      "name": "InterestGroupReportingScriptRunnerGlobalScope/registerAdMacro(name, value)",
      "href": "https://wicg.github.io/turtledove/#dom-interestgroupreportingscriptrunnerglobalscope-registeradmacro",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"InterestGroupReportingScriptRunnerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"registerAdMacro(name, value)\" id=\"dom-interestgroupreportingscriptrunnerglobalscope-registeradmacro\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>registerAdMacro(<var>name</var>, <var>value</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⓪\">For each</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-unit\" id=\"ref-for-code-unit\">code unit</a> <var>c</var> in <var>name</var>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤⑦\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⑧\">TypeError</a></code> if both of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>c</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc3986#section-2.3\" id=\"ref-for-section-2.3\">unreserved percent encoding character</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>c</var> is not \"<code>%</code>\".</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦①\">For each</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-unit\" id=\"ref-for-code-unit①\">code unit</a> <var>c</var> in <var>value</var>:",
          "rationale": "throw",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤⑧\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④⑨\">TypeError</a></code> if both of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>c</var> is not an <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc3986#section-2.3\" id=\"ref-for-section-2.3①\">unreserved percent encoding character</a>;</p>\n         </li><li data-md=\"\">\n          <p><var>c</var> is not \"<code>%</code>\".</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥③\">Set</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⑧\">relevant global object</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interestgroupreportingscriptrunnerglobalscope-reporting-macro-map\" id=\"ref-for-interestgroupreportingscriptrunnerglobalscope-reporting-macro-map①\">reporting macro map</a>[<var>name</var>] to <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "Navigator/updateAdInterestGroups()",
      "href": "https://wicg.github.io/turtledove/#dom-navigator-updateadinterestgroups",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Navigator\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-navigator-updateadinterestgroups\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>updateAdInterestGroups()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①④\">In parallel</a>, run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update\" id=\"ref-for-interest-group-update③\">interest group update</a> with\n« <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object⑨\">relevant settings object</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin④\">top-level origin</a> »</p>"
        }
      ]
    },
    {
      "name": "interest group update",
      "href": "https://wicg.github.io/turtledove/#interest-group-update",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"interest group update\" data-noexport=\"\" id=\"interest-group-update\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update interest groups</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦③\">list</a> of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③⑥\">origins</a> <var>owners</var>: \n    <p>Implementations can consider aborting all updating if updating has been running for too long. This\ncan avoid continuing to reveal coarse IP location information to update servers long after\nnavigating to another page. Some implementations, such as Chromium, have chosen a 10 minute limit.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦②\">For each</a> <var>owner</var> of <var>owners</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦③\">For each</a> <var>originalInterestGroup</var> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④⑦\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③①\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤①\">owner</a> is <var>owner</var> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-next-update-after\" id=\"ref-for-interest-group-next-update-after①\">next update after</a> is before\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⑧\">current wall time</a> and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update-url\" id=\"ref-for-interest-group-update-url⑤\">update url</a> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>ig</var> be a deep copy of <var>originalInterestGroup</var>.</p>"
                },
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#update-k-anonymity-cache-for-interest-group\" id=\"ref-for-update-k-anonymity-cache-for-interest-group①\">update k-anonymity cache for interest group</a> for <var>ig</var>.</p>"
                },
                {
                  "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑥\">request</a> with the following properties:</p>\n          <dl>\n           <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url④\">URL</a>\n           </dt><dd data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update-url\" id=\"ref-for-interest-group-update-url⑥\">update url</a></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③\">header list</a>\n           </dt><dd data-md=\"\">\n            <p>«<code>Accept</code>: <code>application/json</code>»</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client④\">client</a>\n           </dt><dd data-md=\"\">\n            <p><code>null</code></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin④\">origin</a>\n           </dt><dd data-md=\"\">\n            <p><var>owner</var></p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode④\">mode</a>\n           </dt><dd data-md=\"\">\n            <p>\"<code>no-cors</code>\"</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer④\">referrer</a>\n           </dt><dd data-md=\"\">\n            <p>\"<code>no-referrer</code>\"</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode④\">credentials mode</a>\n           </dt><dd data-md=\"\">\n            <p>\"<code>omit</code>\"</p>\n           </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode④\">redirect mode</a>\n           </dt><dd data-md=\"\">\n            <p>\"<code>error</code>\"</p>\n          </dd></dl>"
                },
                {
                  "html": "<p>Let <var>update</var> be null.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch④\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue③\">useParallelQueue</a> set to true, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response-end-of-body\" id=\"ref-for-process-response-end-of-body②\">processResponseConsumeBody</a> set to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑧\">response</a> <var>response</var> and null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①①\">byte sequence</a> <var>responseBody</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response\" id=\"ref-for-validate-fetching-response②\">validate fetching response</a> with <var>response</var>, <var>responseBody</var> and \"<code>application/json</code>\"\nreturns false, set <var>update</var> to failure and return.</p>"
                    },
                    {
                      "html": "<p>Set <var>update</var> to <var>responseBody</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Wait for <var>update</var> to be set.</p>"
                },
                {
                  "html": "<p>If <var>update</var> is failure, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑨\">continue</a>.</p>"
                },
                {
                  "html": "<p>Let <var>parsedUpdate</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value①\">parsing JSON bytes to an Infra value</a>, given <var>update</var>.</p>"
                },
                {
                  "html": "<p>If <var>parsedUpdate</var> is failure, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⓪\">continue</a>.</p>"
                },
                {
                  "html": "<p>If <var>parsedUpdate</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤①\">ordered map</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②①\">continue</a>.</p>"
                },
                {
                  "html": "<p>If <var>parsedUpdate</var>[\"<code>name</code>\"] exists and doesn’t match <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②③\">name</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②②\">continue</a>.</p>"
                },
                {
                  "html": "<p>If <var>parsedUpdate</var>[\"<code>owner</code>\"] exists and doesn’t match <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤②\">owner</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②③\">continue</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⑦\">For each</a> <var>key</var> → <var>value</var> of <var>parsedUpdate</var>:",
                  "rationale": "switch",
                  "steps": [
                    {
                      "html": "Switch on <var>key</var>:",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "\"priority\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②⓪\">double</a></code>, set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority④\">priority</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"enableBiddingSignalsPrioritization\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean⑥\">boolean</a></code>, set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-enable-bidding-signals-prioritization\" id=\"ref-for-interest-group-enable-bidding-signals-prioritization②\">enable bidding signals prioritization</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"priorityVector\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is null or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤②\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②②\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥③\">strings</a> and\nwhose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②②\">values</a> are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②①\">double</a></code>, set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-vector\" id=\"ref-for-interest-group-priority-vector②\">priority vector</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"prioritySignalsOverrides\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>value</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤③\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②③\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥④\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②③\">values</a> are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②②\">double</a></code> or null:",
                                  "rationale": "for",
                                  "steps": [
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⑧\">For each</a> <var>pvKey</var> → <var>pvValue</var> of <var>value</var>:",
                                      "rationale": "if",
                                      "steps": [
                                        {
                                          "html": "<p>If <var>pvValue</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑦\">remove</a> <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides③\">priority signals overrides</a>[<var>pvKey</var>].</p>"
                                        },
                                        {
                                          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥④\">set</a> <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides④\">priority signals overrides</a>[<var>pvKey</var>] to <var>pvValue</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"sellerCapabilities\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>value</var> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤④\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②④\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑤\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②④\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦④\">lists</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑥\">strings</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②⑨\">for each</a> <var>sellerString</var> → <var>capabilities</var> of <var>value</var>:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>sellerCapabilities</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⓪\">set</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#seller-capability\" id=\"ref-for-seller-capability③\">seller capabilities</a>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦④\">For each</a> <var>capabilityString</var> of <var>capabilities</var>:",
                                      "rationale": "if",
                                      "steps": [
                                        {
                                          "html": "<p>If <var>capabilityString</var> is \"<code>interest-group-counts</code>\" or \"<code>latency-stats</code>\", then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">append</a> <var>capabilityString</var> to <var>sellerCapabilities</var>.</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "html": "<p>If <var>sellerString</var> is \"<code>*</code>\", then set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-all-sellers-capabilities\" id=\"ref-for-interest-group-all-sellers-capabilities①\">all sellers capabilities</a> to <var>sellerCapabilities</var>.</p>"
                                    },
                                    {
                                      "html": "Otherwise:",
                                      "rationale": "if",
                                      "steps": [
                                        {
                                          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities⑦\">seller capabilities</a> is null, then set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities⑧\">seller capabilities</a> to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑤\">ordered map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②⑤\">keys</a> are <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③⑦\">origins</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②⑤\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①①\">sets</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#seller-capability\" id=\"ref-for-seller-capability④\">seller capabilities</a>.</p>"
                                        },
                                        {
                                          "html": "<p>Let <var>sellerUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①③\">URL parser</a> on <var>sellerString</var>.</p>"
                                        },
                                        {
                                          "html": "If <var>sellerUrl</var> is not failure:",
                                          "rationale": "let",
                                          "steps": [
                                            {
                                              "html": "<p>Let <var>seller</var> be <var>sellerUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑤\">origin</a>.</p>"
                                            },
                                            {
                                              "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities⑨\">seller capabilities</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③①\">contain</a> <var>seller</var>,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⑤\">set</a> <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities①⓪\">seller capabilities</a>[<var>seller</var>] to <var>sellerCapabilities</var>.</p>"
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"executionMode\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is \"<code>compatibility</code>\", \"<code>frozen-context</code>\", or \"<code>group-by-origin</code>\", then set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-execution-mode\" id=\"ref-for-interest-group-execution-mode③\">execution mode</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-execution-mode\" id=\"ref-for-interest-group-execution-mode④\">execution mode</a> to \"<code>compatibility</code>\".</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"biddingLogicURL\"",
                              "html": "",
                              "rationale": "for",
                              "steps": [
                                {
                                  "html": "For each <var>groupMember</var> and <var>interestGroupField</var>, in the following table",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>key</var> is not <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②④\">continue</a>.</p>"
                                    },
                                    {
                                      "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑦\">string</a>:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-bidding-code-or-update-url\" id=\"ref-for-parse-and-verify-a-bidding-code-or-update-url①\">parse and verify a bidding code or update URL</a> on <var>value</var> and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤③\">owner</a>.</p>"
                                        },
                                        {
                                          "html": "<p>If <var>parsedURL</var> is failure, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\"> Abort update</a></i></p>"
                                        },
                                        {
                                          "html": "<p>Set <var>ig</var>’s <var>interestGroupField</var> to <var>parsedURL</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"biddingWasmHelperURL\"",
                              "html": "",
                              "rationale": "for",
                              "steps": [
                                {
                                  "html": "For each <var>groupMember</var> and <var>interestGroupField</var>, in the following table",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>key</var> is not <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②④\">continue</a>.</p>"
                                    },
                                    {
                                      "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑦\">string</a>:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-bidding-code-or-update-url\" id=\"ref-for-parse-and-verify-a-bidding-code-or-update-url①\">parse and verify a bidding code or update URL</a> on <var>value</var> and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤③\">owner</a>.</p>"
                                        },
                                        {
                                          "html": "<p>If <var>parsedURL</var> is failure, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\"> Abort update</a></i></p>"
                                        },
                                        {
                                          "html": "<p>Set <var>ig</var>’s <var>interestGroupField</var> to <var>parsedURL</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"updateURL\"",
                              "html": "",
                              "rationale": "for",
                              "steps": [
                                {
                                  "html": "For each <var>groupMember</var> and <var>interestGroupField</var>, in the following table",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>key</var> is not <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②④\">continue</a>.</p>"
                                    },
                                    {
                                      "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑦\">string</a>:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-bidding-code-or-update-url\" id=\"ref-for-parse-and-verify-a-bidding-code-or-update-url①\">parse and verify a bidding code or update URL</a> on <var>value</var> and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤③\">owner</a>.</p>"
                                        },
                                        {
                                          "html": "<p>If <var>parsedURL</var> is failure, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\"> Abort update</a></i></p>"
                                        },
                                        {
                                          "html": "<p>Set <var>ig</var>’s <var>interestGroupField</var> to <var>parsedURL</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"trustedBiddingSignalsURL\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑧\">string</a>:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-and-verify-a-trusted-signals-url\" id=\"ref-for-parse-and-verify-a-trusted-signals-url②\">parse and verify a trusted signals URL</a> on <var>value</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>parsedURL</var> is failure, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\"> Abort update</a></i></p>"
                                    },
                                    {
                                      "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-url\" id=\"ref-for-interest-group-trusted-bidding-signals-url③\">trusted bidding signals url</a> to <var>parsedURL</var>.</p>"
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"trustedBiddingSignalsKeys\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥⑨\">strings</a>,\nset <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys⑥\">trusted bidding signals keys</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"trustedBiddingSignalsSlotSizeMode\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>value</var> is one of \"none\", \"slot-size\", or \"all-slots-requested-sizes\", set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode③\">trusted bidding signals slot size mode</a> to <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, set <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode④\">trusted bidding signals slot size mode</a> to \"none\".</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"maxTrustedBiddingSignalsURLLength\"",
                              "html": "",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>value</var> is a Number:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>convertedValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value②\">converting</a> <var>value</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-long\" id=\"ref-for-idl-long⑦\">long</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>convertedValue</var> ≥ 0, then set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length②\">max trusted bidding signals url length</a> to <var>convertedValue</var>.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"userBiddingSignals\"",
                              "html": "",
                              "rationale": "set",
                              "steps": [
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-user-bidding-signals\" id=\"ref-for-interest-group-user-bidding-signals④\">user bidding signals</a> to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes\">serialize an Infra\nvalue to JSON bytes</a> given <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Otherwise, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"adSizes\"",
                              "html": "",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>adSizes</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑥\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②⑥\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⓪\">strings</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②⑥\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size③\">ad sizes</a>.</p>"
                                },
                                {
                                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⓪\">For each</a> <var>sizeName</var> → <var>size</var> of <var>value</var>:",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>sizeName</var> is \"\", jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>adSize</var> be the result from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-ad-size\" id=\"ref-for-parse-an-adrender-ad-size③\">parse an AdRender ad size</a> with <var>size</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>adSize</var> is null, jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                    },
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⑥\">Set</a> <var>adSizes</var>[<var>sizeName</var>] to <var>adSize</var>.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-sizes\" id=\"ref-for-interest-group-ad-sizes①\">ad sizes</a> to <var>adSizes</var>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"sizeGroups\"",
                              "html": "",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>adSizes</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-sizes\" id=\"ref-for-interest-group-ad-sizes②\">ad sizes</a>.</p>"
                                },
                                {
                                  "html": "<p>Let <var>sizeGroups</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑦\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②⑦\">keys</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦①\">strings</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②⑦\">values</a> are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦②\">strings</a>.</p>"
                                },
                                {
                                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③①\">For each</a> <var>sizeGroupName</var> → <var>sizeList</var> of <var>value</var>:",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>sizeGroupName</var> is \"\", jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑤\">For each</a> <var>sizeName</var> of <var>sizeList</var>:",
                                      "rationale": "if",
                                      "steps": [
                                        {
                                          "html": "<p>If <var>sizeName</var> is \"\" or <var>adSizes</var>[<var>sizeName</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③②\">exist</a>,\n jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⑦\">Set</a> <var>sizeGroups</var>[<var>sizeGroupName</var>] to <var>sizeList</var>.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-size-groups\" id=\"ref-for-interest-group-size-groups②\">size groups</a> to <var>sizeGroups</var>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "\"ads\"",
                              "html": "",
                              "rationale": "for",
                              "steps": [
                                {
                                  "html": "For each <var>groupMember</var> and <var>interestGroupField</var> in the following table",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>key</var> is not <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑤\">continue</a>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑥\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionad\" id=\"ref-for-dictdef-auctionad④\">AuctionAd</a></code>, jump to the step\nlabeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>igAds</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑦\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①③\">interest group ads</a>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑥\">For each</a> <var>ad</var> of <var>value</var>:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>igAd</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①④\">interest group ad</a>.</p>"
                                        },
                                        {
                                          "html": "<p>Let <var>renderURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①④\">URL parser</a> on <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-renderurl\" id=\"ref-for-dom-auctionad-renderurl②\">renderURL</a></code>\"].</p>"
                                        },
                                        {
                                          "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if any of the following conditions hold:</p>\n                    <ul>\n                     <li data-md=\"\">\n                      <p><var>renderURL</var> is failure;</p>\n                     </li><li data-md=\"\">\n                      <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①①\">scheme</a> is not \"<code>https</code>\";</p>\n                     </li><li data-md=\"\">\n                      <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials①\">includes credentials</a>.</p>\n                    </li></ul>"
                                        },
                                        {
                                          "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①②\">render url</a> to <var>renderURL</var>.</p>"
                                        },
                                        {
                                          "html": "If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup③\">sizeGroup</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③③\">exists</a>:",
                                          "rationale": "let",
                                          "steps": [
                                            {
                                              "html": "<p>Let <var>sizeGroup</var> be <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup④\">sizeGroup</a></code>}].</p>"
                                            },
                                            {
                                              "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if none of\n the following conditions hold:</p>\n                      <ul>\n                       <li data-md=\"\">\n                        <p><var>adSizes</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③④\">exists</a>.</p>\n                       </li><li data-md=\"\">\n                        <p><var>sizeGroups</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑤\">exists</a>.</p>\n                      </li></ul>"
                                            },
                                            {
                                              "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group⑤\">size group</a> to <var>sizeGroup</var>.</p>"
                                            }
                                          ]
                                        },
                                        {
                                          "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata③\">metadata</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑥\">exists</a>, then let <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata⑥\">metadata</a> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string⑦\">serializing a JavaScript value to a JSON string</a>, given <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata④\">metadata</a></code>\"].\nIf this <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥⓪\">throws</a>, jump to the step\nlabeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                        },
                                        {
                                          "html": "If <var>groupMember</var> is \"<code>ads</code>\":",
                                          "rationale": "if",
                                          "steps": [
                                            {
                                              "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerreportingid\" id=\"ref-for-dom-auctionad-buyerreportingid①\">buyerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑦\">exists</a> then set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id⑤\">buyer reporting ID</a> to it.</p>"
                                            },
                                            {
                                              "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerandsellerreportingid\" id=\"ref-for-dom-auctionad-buyerandsellerreportingid①\">buyerAndSellerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑧\">exists</a> then set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id⑥\">buyer and seller reporting ID</a> to it.</p>"
                                            }
                                          ]
                                        },
                                        {
                                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑧\">Append</a> <var>igAd</var> to <var>igAds</var>.</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "html": "If <var>igAds</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①①\">is empty</a>:",
                                      "rationale": "set",
                                      "steps": [
                                        {
                                          "html": "<p>Set <var>ig</var>’s <var>interestGroupField</var> to <var>igAds</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"adComponents\"",
                              "html": "",
                              "rationale": "for",
                              "steps": [
                                {
                                  "html": "For each <var>groupMember</var> and <var>interestGroupField</var> in the following table",
                                  "rationale": "if",
                                  "steps": [
                                    {
                                      "html": "<p>If <var>key</var> is not <var>groupMember</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑤\">continue</a>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑥\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-auctionad\" id=\"ref-for-dictdef-auctionad④\">AuctionAd</a></code>, jump to the step\nlabeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>igAds</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑦\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①③\">interest group ads</a>.</p>"
                                    },
                                    {
                                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑥\">For each</a> <var>ad</var> of <var>value</var>:",
                                      "rationale": "let",
                                      "steps": [
                                        {
                                          "html": "<p>Let <var>igAd</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad\" id=\"ref-for-interest-group-ad①④\">interest group ad</a>.</p>"
                                        },
                                        {
                                          "html": "<p>Let <var>renderURL</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①④\">URL parser</a> on <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-renderurl\" id=\"ref-for-dom-auctionad-renderurl②\">renderURL</a></code>\"].</p>"
                                        },
                                        {
                                          "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if any of the following conditions hold:</p>\n                    <ul>\n                     <li data-md=\"\">\n                      <p><var>renderURL</var> is failure;</p>\n                     </li><li data-md=\"\">\n                      <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①①\">scheme</a> is not \"<code>https</code>\";</p>\n                     </li><li data-md=\"\">\n                      <p><var>renderURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials①\">includes credentials</a>.</p>\n                    </li></ul>"
                                        },
                                        {
                                          "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①②\">render url</a> to <var>renderURL</var>.</p>"
                                        },
                                        {
                                          "html": "If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup③\">sizeGroup</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③③\">exists</a>:",
                                          "rationale": "let",
                                          "steps": [
                                            {
                                              "html": "<p>Let <var>sizeGroup</var> be <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-sizegroup\" id=\"ref-for-dom-auctionad-sizegroup④\">sizeGroup</a></code>}].</p>"
                                            },
                                            {
                                              "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if none of\n the following conditions hold:</p>\n                      <ul>\n                       <li data-md=\"\">\n                        <p><var>adSizes</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③④\">exists</a>.</p>\n                       </li><li data-md=\"\">\n                        <p><var>sizeGroups</var>[<var>sizeGroup</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑤\">exists</a>.</p>\n                      </li></ul>"
                                            },
                                            {
                                              "html": "<p>Set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group⑤\">size group</a> to <var>sizeGroup</var>.</p>"
                                            }
                                          ]
                                        },
                                        {
                                          "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata③\">metadata</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑥\">exists</a>, then let <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata⑥\">metadata</a> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string⑦\">serializing a JavaScript value to a JSON string</a>, given <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-metadata\" id=\"ref-for-dom-auctionad-metadata④\">metadata</a></code>\"].\nIf this <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥⓪\">throws</a>, jump to the step\nlabeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i>.</p>"
                                        },
                                        {
                                          "html": "If <var>groupMember</var> is \"<code>ads</code>\":",
                                          "rationale": "if",
                                          "steps": [
                                            {
                                              "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerreportingid\" id=\"ref-for-dom-auctionad-buyerreportingid①\">buyerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑦\">exists</a> then set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id⑤\">buyer reporting ID</a> to it.</p>"
                                            },
                                            {
                                              "html": "<p>If <var>ad</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-auctionad-buyerandsellerreportingid\" id=\"ref-for-dom-auctionad-buyerandsellerreportingid①\">buyerAndSellerReportingId</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑧\">exists</a> then set <var>igAd</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id⑥\">buyer and seller reporting ID</a> to it.</p>"
                                            }
                                          ]
                                        },
                                        {
                                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑧\">Append</a> <var>igAd</var> to <var>igAds</var>.</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "html": "If <var>igAds</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①①\">is empty</a>:",
                                      "rationale": "set",
                                      "steps": [
                                        {
                                          "html": "<p>Set <var>ig</var>’s <var>interestGroupField</var> to <var>igAds</var>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "case": "\"additionalBidKey\"",
                              "html": "",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>decodedKey</var> be the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode④\">forgiving-base64 decode</a> with <var>value</var>.</p>"
                                },
                                {
                                  "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if any of the\nfollowing conditions hold:</p>\n                <ul>\n                 <li data-md=\"\">\n                  <p><var>decodedKey</var> is a failure;</p>\n                 </li><li data-md=\"\">\n                  <p><var>decodedKey</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length③\">length</a> is not 32;</p>\n                </li></ul>"
                                },
                                {
                                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key⑤\">additional bid key</a> to <var>decodedKey</var>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Jump to the step labeled <i><a href=\"https://wicg.github.io/turtledove/#abort-update\">Abort update</a></i> if any of the\nfollowing conditions hold:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads②③\">ads</a> is not null, and <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key⑥\">additional bid key</a> is not null;</p>\n           </li><li data-md=\"\">\n            <p><var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-estimated-size\" id=\"ref-for-interest-group-estimated-size④\">estimated size</a> is greater than 1048576 bytes.</p>\n          </li></ul>"
                },
                {
                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-next-update-after\" id=\"ref-for-interest-group-next-update-after②\">next update after</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time①⑨\">current wall time</a> plus 24 hours.</p>"
                },
                {
                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-last-updated\" id=\"ref-for-interest-group-last-updated①\">last updated</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time②⓪\">current wall time</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace④\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④④\">interest group</a> that has <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤④\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②④\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④⑧\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③②\">interest group set</a> with <var>ig</var>.</p>"
                },
                {
                  "html": "<p><i id=\"abort-update\">Abort update</i>: We jump here if some part of the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⑤\">interest group</a> update failed. <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑥\">Continue</a> to the next <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⑥\">interest group</a> update.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "process updateIfOlderThanMs",
      "href": "https://wicg.github.io/turtledove/#process-updateifolderthanms",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-updateifolderthanms\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process updateIfOlderThanMs</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③⑧\">origin</a> <var>buyer</var>, and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑧\">ordered map</a> <var>perInterestGroupData</var> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-keys\" id=\"ref-for-map-getting-the-keys②⑧\">keys</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②⑤\">name</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦③\">strings</a> and whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values②⑧\">values</a> are <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data\" id=\"ref-for-bidding-signals-per-interest-group-data\">bidding signals per interest group data</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③②\">For each</a> <var>igName</var> → <var>perIgData</var> of <var>perInterestGroupData</var>, the following steps should be\ndone:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>perIgData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data-updateifolderthanms\" id=\"ref-for-bidding-signals-per-interest-group-data-updateifolderthanms\">updateIfOlderThanMs</a> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>ig</var> be the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⑦\">interest group</a> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④⑨\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③③\">interest group set</a> whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤⑤\">owner</a> is <var>buyer</var> and whose <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②⑥\">name</a> is <var>igName</var>, or null if <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③④\">interest group set</a> does not have such an interest group.</p>"
            },
            {
              "html": "If <var>ig</var> is not null and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time②①\">current wall time</a> − <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-last-updated\" id=\"ref-for-interest-group-last-updated②\">last updated</a> ≥ <var>perIgData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data-updateifolderthanms\" id=\"ref-for-bidding-signals-per-interest-group-data-updateifolderthanms①\">updateIfOlderThanMs</a> milliseconds:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-next-update-after\" id=\"ref-for-interest-group-next-update-after③\">next update after</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-current-wall-time\" id=\"ref-for-dfn-current-wall-time②②\">current wall time</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace⑤\">Replace</a> the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⑧\">interest group</a> that has <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤⑥\">owner</a> and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②⑦\">name</a> in the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑤⓪\">user agent</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-set\" id=\"ref-for-interest-group-set③⑤\">interest group set</a> with <var>ig</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ProtectedAudience/queryFeatureSupport(feature)",
      "href": "https://wicg.github.io/turtledove/#dom-protectedaudience-queryfeaturesupport",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"ProtectedAudience\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-protectedaudience-queryfeaturesupport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>queryFeatureSupport(feature)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>featuresTable</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑨\">ordered map</a> whose keys are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString③①\">DOMString</a></code>s and whose values are <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-boolean\" id=\"ref-for-idl-boolean⑦\">boolean</a></code>s or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-long\" id=\"ref-for-idl-long⑧\">long</a></code>s, with the following entries:</p>\n      <dl>\n       <dt data-md=\"\">\"adComponentsLimit\"\n       </dt><dd data-md=\"\">\n        <p>40</p>\n       </dd><dt data-md=\"\">\"deprecatedRenderURLReplacements\"\n       </dt><dd data-md=\"\">\n        <p>true</p>\n       </dd><dt data-md=\"\">\"permitCrossOriginTrustedSignals\"\n       </dt><dd data-md=\"\">\n        <p>true</p>\n       </dd><dt data-md=\"\">\"realTimeReporting\"\n       </dt><dd data-md=\"\">\n        <p>true</p>\n       </dd><dt data-md=\"\">\"reportingTimeout\"\n       </dt><dd data-md=\"\">\n        <p>true</p>\n      </dd></dl>"
        },
        {
          "html": "<p>If <var>feature</var> is \"*\", then return <var>featuresTable</var>.</p>"
        },
        {
          "html": "<p>If <var>featuresTable</var>[<var>feature</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⑨\">exists</a>, then return <var>featuresTable</var>[<var>feature</var>].</p>"
        },
        {
          "html": "<p>Return <code>undefined</code>.</p>"
        }
      ]
    },
    {
      "name": "interest group/estimated size",
      "href": "https://wicg.github.io/turtledove/#interest-group-estimated-size",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"interest group\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"interest-group-estimated-size\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">estimated size</dfn> of an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group④⑨\">interest group</a> <var>ig</var> is the sum of:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①\">length</a> of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①②\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-owner\" id=\"ref-for-interest-group-owner⑤⑦\">owner</a>.</p>"
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②\">length</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name②⑧\">name</a>.</p>"
        },
        {
          "html": "<p>8, which is the size of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority\" id=\"ref-for-interest-group-priority⑤\">priority</a>.</p>"
        },
        {
          "html": "<p>4, which is the size of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-execution-mode\" id=\"ref-for-interest-group-execution-mode⑤\">execution mode</a>.</p>"
        },
        {
          "html": "<p>2, which is the size of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-enable-bidding-signals-prioritization\" id=\"ref-for-interest-group-enable-bidding-signals-prioritization③\">enable bidding signals prioritization</a>.</p>"
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-vector\" id=\"ref-for-interest-group-priority-vector③\">priority vector</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③③\">for each</a> <var>key</var> → <var>value</var> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-vector\" id=\"ref-for-interest-group-priority-vector④\">priority vector</a>:</p>",
          "ignored": [
            "The length of key. 8, which is the size of value."
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides⑤\">priority signals overrides</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③④\">for each</a> <var>key</var> → <var>value</var> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-priority-signals-overrides\" id=\"ref-for-interest-group-priority-signals-overrides⑥\">priority signals overrides</a>:</p>",
          "ignored": [
            "The length of key. 8, which is the size of value."
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities①①\">seller capabilities</a> is not null, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⑤\">for each</a> <var>seller</var> → <var>capabilities</var> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-seller-capabilities\" id=\"ref-for-interest-group-seller-capabilities①②\">seller capabilities</a>:</p>",
          "ignored": [
            "The length of the serialization of seller. 4, which is capabilities’s underlying number of enum bytes."
          ]
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑥\">length</a> of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⑤\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-url\" id=\"ref-for-interest-group-bidding-url①①\">bidding url</a>, if the field is not null.</p>"
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑦\">length</a> of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⑥\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-bidding-wasm-helper-url\" id=\"ref-for-interest-group-bidding-wasm-helper-url⑤\">bidding wasm helper url</a>, if the field is not null.</p>"
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑧\">length</a> of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⑦\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-update-url\" id=\"ref-for-interest-group-update-url⑧\">update url</a>, if the field is not null.</p>"
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length⑨\">length</a> of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⑧\">serialization</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-url\" id=\"ref-for-interest-group-trusted-bidding-signals-url④\">trusted bidding signals url</a>, if the field is not null.</p>"
        },
        {
          "html": "<p>4, which is the size of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-slot-size-mode\" id=\"ref-for-interest-group-trusted-bidding-signals-slot-size-mode⑤\">trusted bidding signals slot size mode</a>.</p>"
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys⑦\">trusted bidding signals keys</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑦\">for each</a> <var>key</var> of it:</p>",
          "ignored": [
            "The length of key."
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length③\">max trusted bidding signals url length</a> is not null:</p>",
          "ignored": [
            "4, which is the size of ig’s max trusted bidding signals url length."
          ]
        },
        {
          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①①\">length</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-user-bidding-signals\" id=\"ref-for-interest-group-user-bidding-signals⑤\">user bidding signals</a>.</p>"
        },
        {
          "html": "If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ads\" id=\"ref-for-interest-group-ads②④\">ads</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑧\">for each</a> <var>ad</var> of it:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①②\">length</a> of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①⑨\">serialization</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①③\">render url</a>.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①③\">length</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-size-group\" id=\"ref-for-interest-group-ad-size-group⑥\">size group</a> if the field is not null.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①④\">length</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-metadata\" id=\"ref-for-interest-group-ad-metadata⑦\">metadata</a> if the field is not null.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①⑤\">length</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-reporting-id\" id=\"ref-for-interest-group-ad-buyer-reporting-id⑥\">buyer reporting ID</a> if the field is not null.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length①⑥\">length</a> of <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-buyer-and-seller-reporting-id\" id=\"ref-for-interest-group-ad-buyer-and-seller-reporting-id⑦\">buyer and seller reporting ID</a> if the\nfield is not null.</p>"
            },
            {
              "html": "<p>If <var>ad</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-allowed-reporting-origins\" id=\"ref-for-interest-group-ad-allowed-reporting-origins②\">allowed reporting origins</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦⑨\">for each</a> <var>origin</var> of it:</p>",
              "ignored": [
                "The length of the serialization of origin."
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-components\" id=\"ref-for-interest-group-ad-components①④\">ad components</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⓪\">for each</a> <var>ad</var> of it:</p>",
          "ignored": [
            "The length of the serialization of ad’s render url. The length of ad’s size group if the field is not null. The length of ad’s metadata if the field is not null."
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-sizes\" id=\"ref-for-interest-group-ad-sizes③\">ad sizes</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⑥\">for each</a> <var>sizeName</var> → <var>size</var> of it:</p>",
          "ignored": [
            "The sum of the length of sizeName and 18 (representing the fixed length of size)."
          ]
        },
        {
          "html": "If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-size-groups\" id=\"ref-for-interest-group-size-groups③\">size groups</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⑦\">for each</a> <var>sizeGroupName</var> → <var>sizeList</var> of it:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>The sum of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②②\">length</a> of <var>sizeGroupName</var> and the following:</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧①\">For each</a> <var>sizeName</var> of <var>sizeList</var>:</p>",
              "ignored": [
                "The length of sizeName."
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-additional-bid-key\" id=\"ref-for-interest-group-additional-bid-key⑦\">additional bid key</a> is not null:</p>",
          "ignored": [
            "32, which is its size (number of bytes)."
          ]
        }
      ]
    },
    {
      "name": "parse an https origin",
      "href": "https://wicg.github.io/turtledove/#parse-an-https-origin",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-https-origin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an https origin</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦④\">string</a> <var>input</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①⑤\">URL parser</a> on <var>input</var>.</p>"
        },
        {
          "html": "<p>If <var>url</var> is failure, or its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme⑤\">scheme</a> is not \"<code>https</code>\", then return failure.</p>"
        },
        {
          "html": "<p>Return <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑥\">origin</a>.</p>"
        }
      ]
    },
    {
      "name": "serialize a URL",
      "href": "https://wicg.github.io/turtledove/#serialize-a-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-a-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize a URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⑤\">URL</a>-or-null <var>url</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>url</var> is null, then return <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined②⑥\">undefined</a></code>.</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer②①\">serialization</a> of <var>url</var>.</p>"
        }
      ]
    },
    {
      "name": "parse and verify a bidding code or update URL",
      "href": "https://wicg.github.io/turtledove/#parse-and-verify-a-bidding-code-or-update-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-and-verify-a-bidding-code-or-update-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse and verify a bidding code or update URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⑤\">string</a> <var>input</var> and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③⑨\">origin</a> <var>igOwner</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parsedUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①⑥\">URL parser</a> on <var>input</var>.</p>"
        },
        {
          "html": "<p>Return failure if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>parsedUrl</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑦\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①②\">same origin</a> with <var>igOwner</var>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials②\">includes credentials</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment\">fragment</a> is not null.</p>\n      </li></ul>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑨\">Assert</a>: <var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①②\">scheme</a> is \"<code>https</code>\".</p>"
        },
        {
          "html": "<p>Return <var>parsedUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "parse and verify a trusted signals URL",
      "href": "https://wicg.github.io/turtledove/#parse-and-verify-a-trusted-signals-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-and-verify-a-trusted-signals-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse and verify a trusted signals URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⑥\">string</a> <var>input</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parsedUrl</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①⑦\">URL parser</a> on <var>input</var>.</p>"
        },
        {
          "html": "<p>Return failure if any of the following conditions hold:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>parsedUrl</var> is failure;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①③\">scheme</a> is not \"<code>https</code>\";</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials③\">includes credentials</a>;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment①\">fragment</a> is not null;</p>\n       </li><li data-md=\"\">\n        <p><var>parsedUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query③\">query</a> is not null.</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>parsedUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "round a value",
      "href": "https://wicg.github.io/turtledove/#round-a-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"round-a-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">round a value</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②③\">double</a></code> <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/C#valid-floating-point-number\" id=\"ref-for-valid-floating-point-number\">valid floating-point number</a>, return <var>value</var>.</p>"
        },
        {
          "html": "<p>Let <var>valueExp</var> be <var>value</var>’s IEEE 754 biased exponent field minus 1023.</p>"
        },
        {
          "html": "<p>Let <var>normValue</var> be <var>value</var> multiplied by 2<sup>(−1 × <var>valueExp</var>)</sup>.</p>"
        },
        {
          "html": "If <var>valueExp</var> &lt; −128:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> &lt; 0, return −0.</p>"
            },
            {
              "html": "<p>Otherwise, return 0.</p>"
            }
          ]
        },
        {
          "html": "If <var>valueExp</var> &gt; 127:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> &lt; 0, return −∞.</p>"
            },
            {
              "html": "<p>Otherwise, return ∞.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>precisionScaledValue</var> be <var>normValue</var> multiplied by 256.</p>"
        },
        {
          "html": "<p>Let <var>noisyScaledValue</var> be <var>precisionScaledValue</var> plus a random <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double②④\">double</a></code> value greater than\nor equal to 0 but less than 1.</p>"
        },
        {
          "html": "<p>Let <var>truncatedScaledValue</var> be the largest integer not greater than <var>noisyScaledValue</var>.</p>"
        },
        {
          "html": "<p>Return <var>truncatedScaledValue</var> multiplied by 2<sup>(<var>valueExp</var> − 8)</sup>.</p>"
        }
      ]
    },
    {
      "name": "get uuid from string",
      "href": "https://wicg.github.io/turtledove/#get-uuid-from-string",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-uuid-from-string\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get uuid from string</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⑦\">string</a> <var>input</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②④\">length</a> is not 36, return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⑧\">string</a>.</p>"
        },
        {
          "html": "<p>Let <var>uuidStr</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦⑨\">string</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧②\">For each</a> <var>i</var> in <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#the-range\" id=\"ref-for-the-range⑤\">the range</a> from 1 to 36, inclusive:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>unit</var> be <var>input</var>’s <var>i</var>th <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-unit\" id=\"ref-for-code-unit②\">code unit</a>.</p>"
            },
            {
              "html": "If « 8, 13, 18, 23 » <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑨\">contains</a> <var>i</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>unit</var> is not 0x002D (-), then return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑧⓪\">string</a>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>unit</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lower-hex-digit\" id=\"ref-for-ascii-lower-hex-digit\">ASCII lower hex digit</a>, then return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑧①\">string</a>.</p>"
                },
                {
                  "html": "<p>Append <var>unit</var> to the end of <var>uuidStr</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-encode\" id=\"ref-for-ascii-encode⑤\">ASCII encoded</a> <var>uuidStr</var>.</p>"
        }
      ]
    },
    {
      "name": "insert entries to map",
      "href": "https://wicg.github.io/turtledove/#insert-entries-to-map",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"insert-entries-to-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">insert entries to map</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⓪\">ordered map</a> <var>map</var>, a <var>key</var> which is in same type\n  as <var>map</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-key\" id=\"ref-for-map-key①\">key</a>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑧\">list</a> <var>entries</var> which is in same type as <var>map</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-value\" id=\"ref-for-map-value③\">value</a>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>map</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④⓪\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend⑤\">extend</a> <var>map</var>[<var>key</var>] with <var>entries</var>.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⑧\">set</a> <var>map</var>[<var>key</var>] to <var>entries</var>.</p>"
        }
      ]
    },
    {
      "name": "check interest group permissions",
      "href": "https://wicg.github.io/turtledove/#check-interest-group-permissions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-interest-group-permissions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check interest group permissions</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④⓪\">origin</a> <var>ownerOrigin</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④①\">origin</a> <var>frameOrigin</var>, and an enum <var>joinOrLeave</var> which is \"<code>join</code>\" or \"<code>leave</code>\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>ownerOrigin</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①③\">same origin</a> with <var>frameOrigin</var>, then return true.</p>"
        },
        {
          "html": "<p>Let <var>encodedFrameOrigin</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-utf-8-percent-encode\" id=\"ref-for-string-utf-8-percent-encode④\">UTF-8 percent-encoding</a> the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①⑤\">serialized</a> <var>frameOrigin</var> using <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#component-percent-encode-set\" id=\"ref-for-component-percent-encode-set③\">component percent-encode set</a>.</p>"
        },
        {
          "html": "<p>Let <var>permissionsUrl</var> be a new <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⑥\">URL</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item③①\">items</a>:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①④\">scheme</a>\n       </dt><dd data-md=\"\">\n        <p><var>ownerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme⑥\">scheme</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a>\n       </dt><dd data-md=\"\">\n        <p><var>ownerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host④\">host</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port①\">port</a>\n       </dt><dd data-md=\"\">\n        <p><var>ownerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-port\" id=\"ref-for-concept-origin-port①\">port</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path①\">path</a>\n       </dt><dd data-md=\"\">\n        <p>« \".well-known\", \"interest-group\", \"permissions\" »</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query④\">query</a>\n       </dt><dd data-md=\"\">\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①②\">concatenating</a> « \"origin=\", <var>encodedFrameOrigin</var> »</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑤\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>permissionsUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>«<code>Accept</code>: <code>application/json</code>»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑤\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑤\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>frameOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑤\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑤\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode⑤\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑤\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>resource</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch⑤\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue④\">useParallelQueue</a> set to true, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response-end-of-body\" id=\"ref-for-process-response-end-of-body③\">processResponseConsumeBody</a> set to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑨\">response</a> <var>response</var> and null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①②\">byte sequence</a> <var>responseBody</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>responseBody</var> is null or failure, set <var>resource</var> to failure and return.</p>"
            },
            {
              "html": "<p>Let <var>headers</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list④\">header list</a>.</p>"
            },
            {
              "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type①\">extracting a MIME type</a> from <var>headers</var>.</p>"
            },
            {
              "html": "<p>If <var>mimeType</var> is failure or is not a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#json-mime-type\" id=\"ref-for-json-mime-type①\">JSON MIME Type</a>, set <var>resource</var> to failure and return.</p>"
            },
            {
              "html": "<p>Set <var>resource</var> to <var>responseBody</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>resource</var> to be set.</p>"
        },
        {
          "html": "<p>If <var>resource</var> is failure, then return false.</p>"
        },
        {
          "html": "<p>Let <var>permissions</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value②\">parsing JSON bytes to an Infra value</a> with <var>resource</var>,\nreturning false on failure.</p>"
        },
        {
          "html": "<p>If <var>permissions</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥①\">ordered map</a>, then return false.</p>"
        },
        {
          "html": "<p>If <var>joinOrLeave</var> is \"<code>join</code>\" and <var>permissions</var>[\"<code>joinAdInterestGroup</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④①\">exists</a>, then\nreturn <var>permissions</var>[\"<code>joinAdInterestGroup</code>\"].</p>"
        },
        {
          "html": "<p>If <var>joinOrLeave</var> is \"<code>leave</code>\" and <var>permissions</var>[\"<code>leaveAdInterestGroup</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④②\">exists</a>, then\nreturn <var>permissions</var>[\"<code>leaveAdInterestGroup</code>\"].</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "fetch new request patch",
      "html": "The following step will be added to the <code><a class=\"idl-code\" data-link-type=\"constructor\" href=\"https://fetch.spec.whatwg.org/#dom-request\" id=\"ref-for-dom-request\"> new Request (<var>input</var>, <var>init</var>)</a></code> constructor steps, before\nstep \"Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request\">request</a> to <var>request</var>\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-requestinit-adauctionheaders\" id=\"ref-for-dom-requestinit-adauctionheaders⑤\">adAuctionHeaders</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④③\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#request-capture-ad-auction-headers\" id=\"ref-for-request-capture-ad-auction-headers\">capture-ad-auction-headers</a> to it.</p>"
        }
      ]
    },
    {
      "name": "iframe navigation patch",
      "html": "The following step will be added to the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\" id=\"ref-for-create-navigation-params-by-fetching\">create navigation params by fetching</a> steps\nafter step \"Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①②\">request</a>, with ...\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-container\" id=\"ref-for-nav-container\">container</a> is an <code><a data-link-type=\"element\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element\" id=\"ref-for-the-iframe-element③\">iframe</a></code> element,\nand if it has a <code><a data-link-type=\"element-sub\" href=\"https://wicg.github.io/turtledove/#element-attrdef-iframe-adauctionheaders\" id=\"ref-for-element-attrdef-iframe-adauctionheaders⑥\">adauctionheaders</a></code> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#concept-element-attributes\" id=\"ref-for-concept-element-attributes⑦\">content attribute</a>,\nthen set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#request-capture-ad-auction-headers\" id=\"ref-for-request-capture-ad-auction-headers①\">capture-ad-auction-headers</a> to true.</p>"
        }
      ]
    },
    {
      "name": "fetch Sec-Ad-Auction-Fetch patch",
      "html": "The following step will be added to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch\">HTTP-network-or-cache fetch</a> algorithm, before step\n\"Modify <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑤\">header list</a> per HTTP. ...\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①③\">request</a>'s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#request-capture-ad-auction-headers\" id=\"ref-for-request-capture-ad-auction-headers②\">capture-ad-auction-headers</a> is true, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header\" id=\"ref-for-concept-header-list-set-structured-header\">set a\nstructured field value</a> given «<span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-sec-ad-auction-fetch\" id=\"ref-for-http-headerdef-sec-ad-auction-fetch\">Sec-Ad-Auction-Fetch</a></code>`</span>, the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc8941.html#boolean\" id=\"ref-for-boolean①⑤\">boolean</a> <code>?1</code>»\nin <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list\">header list</a>.</p>"
        }
      ]
    },
    {
      "name": "ad auction fetch redirect patch",
      "html": "The following steps will be added to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch\">HTTP fetch</a> algorithm, immediately under the step \"If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-status\" id=\"ref-for-concept-status\">status</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status\">redirect status</a>:\"",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete\">Delete</a> \"<span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-signals\" id=\"ref-for-http-headerdef-ad-auction-signals⑥\">Ad-Auction-Signals</a></code>`</span>\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑤\">header list</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete①\">Delete</a> \"<span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-additional-bid\" id=\"ref-for-http-headerdef-ad-auction-additional-bid⑦\">Ad-Auction-Additional-Bid</a></code>`</span>\" from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑥\">header list</a>.</p>"
        }
      ]
    },
    {
      "name": "fetch auction signals response patch",
      "html": "The following step will be added to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch①\">HTTP fetch</a> algorithm, before step\n\"Return <var>response</var>.\":",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>response</var> is not null, <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-status\" id=\"ref-for-concept-status①\">status</a> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status①\">redirect status</a>, <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination\">task destination</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object④\">global object</a> that’s a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code> object, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#request-capture-ad-auction-headers\" id=\"ref-for-request-capture-ad-auction-headers③\">capture-ad-auction-headers</a> is <code>true</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination①\">task destination</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①①\">associated Document</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑤\">node navigable</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#traversable-navigable\" id=\"ref-for-traversable-navigable①⓪\">traversable navigable</a>.</p>"
            },
            {
              "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#concept-update-captured-headers\" id=\"ref-for-concept-update-captured-headers\">update captured headers</a> with <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-signals-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-signals-headers①\">captured ad auction signals headers</a>, <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-additional-bids-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-additional-bids-headers\">captured ad auction additional bids headers</a>, <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑦\">header list</a>, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑥\">URL</a>'s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑧\">origin</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fetch update captured headers patch",
      "href": "https://wicg.github.io/turtledove/#concept-update-captured-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-update-captured-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update captured headers</dfn> with a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-signals-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-signals-headers②\">captured ad auction signals headers</a> <var>storedSignalsHeaders</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-additional-bids-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-additional-bids-headers①\">captured ad auction additional bids headers</a> <var>storedAdditionalBidsHeaders</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①\">header list</a> <var>responseHeaders</var>, and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④②\">origin</a> <var>requestOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>adAuctionSignals</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get①\">getting</a> <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-signals\" id=\"ref-for-http-headerdef-ad-auction-signals⑦\">Ad-Auction-Signals</a></code>`</span> from <var>responseHeaders</var>.</p>"
        },
        {
          "html": "If <var>adAuctionSignals</var> is not null:",
          "rationale": "delete",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete②\">Delete</a> \"<span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-signals\" id=\"ref-for-http-headerdef-ad-auction-signals⑧\">Ad-Auction-Signals</a></code>`</span>\" from <var>responseHeaders</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#handle-ad-auction-signals-header-value\" id=\"ref-for-handle-ad-auction-signals-header-value\">Handle ad auction signals header value</a> given <var>adAuctionSignals</var>, <var>storedSignalsHeaders</var> and <var>requestOrigin</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>additionalBids</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split\">getting, decoding, and splitting</a> <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-additional-bid\" id=\"ref-for-http-headerdef-ad-auction-additional-bid⑧\">Ad-Auction-Additional-Bid</a></code>`</span> from <var>responseHeaders</var>.</p>"
        },
        {
          "html": "If <var>additionalBids</var> is not null:",
          "rationale": "delete",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete③\">Delete</a> \"<span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-additional-bid\" id=\"ref-for-http-headerdef-ad-auction-additional-bid⑨\">Ad-Auction-Additional-Bid</a></code>`</span>\" from <var>responseHeaders</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧③\">For each</a> <var>bid</var> of <var>additionalBids</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>nonceAndAdditionalBid</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#strictly-split\" id=\"ref-for-strictly-split\">strictly splitting</a> <var>bid</var> on U+003A (:).</p>"
                },
                {
                  "html": "<p>If <var>nonceAndAdditionalBid</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑥\">size</a> is not 2, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑧\">continue</a>.</p>"
                },
                {
                  "html": "<p>Let <var>nonce</var> be <var>nonceAndAdditionalBid</var>[0].</p>"
                },
                {
                  "html": "<p>If <var>nonce</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②⑤\">length</a> is not 36, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②⑨\">continue</a>.</p>"
                },
                {
                  "html": "<p>Set <var>storedAdditionalBidsHeaders</var>[<var>nonce</var>] to <var>nonceAndAdditionalBid</var>[1].</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "handle ad auction signals header value",
      "href": "https://wicg.github.io/turtledove/#handle-ad-auction-signals-header-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-ad-auction-signals-header-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle ad auction signals header value</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①③\">byte sequence</a> <var>adAuctionSignals</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#traversable-navigable-captured-ad-auction-signals-headers\" id=\"ref-for-traversable-navigable-captured-ad-auction-signals-headers③\">captured ad auction signals headers</a> <var>storedSignalsHeaders</var>, and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④③\">origin</a> <var>requestOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parsedSignals</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-an-infra-value\" id=\"ref-for-parse-json-bytes-to-an-infra-value③\">parsing JSON bytes to an Infra value</a>, given <var>adAuctionSignals</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedSignals</var> is failure or not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦⑨\">list</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>headerAdSlots</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①②\">ordered set</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧④\">For each</a> <var>signal</var> of <var>parsedSignals</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>signal</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑤\">ordered map</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③⓪\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>signal</var>[\"<code>adSlot</code>\"] doesn’t exist, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③①\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>headerAdSlots</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⓪\">contains</a> <var>signal</var>[\"<code>adSlot</code>\"], <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③②\">continue</a>. Optionally, <a data-link-type=\"dfn\" href=\"https://console.spec.whatwg.org/#report-a-warning-to-the-console\" id=\"ref-for-report-a-warning-to-the-console\">report a warning to the console</a> with a diagnostic error message indicating that a\nduplicate <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-signals\" id=\"ref-for-http-headerdef-ad-auction-signals⑨\">Ad-Auction-Signals</a></code>`</span> <code>adSlot</code> dictionary was ignored.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>signal</var>[\"<code>adSlot</code>\"] to <var>headerAdSlots</var>.</p>"
            },
            {
              "html": "<p>Let <var>signalsKey</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key\" id=\"ref-for-direct-from-seller-signals-key②\">direct from seller signals key</a>, with its <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key-seller\" id=\"ref-for-direct-from-seller-signals-key-seller①\">seller</a> set to <var>requestOrigin</var> and its <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-key-ad-slot\" id=\"ref-for-direct-from-seller-signals-key-ad-slot①\">ad slot</a> set to <var>signal</var>[\"<code>adSlot</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>processedSignals</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals\" id=\"ref-for-direct-from-seller-signals⑥\">direct from seller signals</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑧\">Remove</a> <var>signal</var>[\"<code>adSlot</code>\"].</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⑧\">For each</a> <var>key</var> → <var>value</var> of <var>signal</var>:",
              "rationale": "switch",
              "steps": [
                {
                  "html": "Switch on <var>key</var>:",
                  "rationale": ".switch",
                  "steps": [
                    {
                      "operation": "switch",
                      "steps": [
                        {
                          "case": "\"sellerSignals\"",
                          "html": "",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "<p>Set <var>processedSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-seller-signals\" id=\"ref-for-direct-from-seller-signals-seller-signals①\">seller signals</a> to the result\nof <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string③\">serializing an Infra value to a JSON string</a>, given <var>value</var>.</p>"
                            }
                          ]
                        },
                        {
                          "case": "\"auctionSignals\"",
                          "html": "",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "<p>Set <var>processedSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-auction-signals\" id=\"ref-for-direct-from-seller-signals-auction-signals②\">auction signals</a> to the result\nof <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string④\">serializing an Infra value to a JSON string</a>, given <var>value</var>.</p>"
                            }
                          ]
                        },
                        {
                          "case": "\"perBuyerSignals\"",
                          "html": "",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>value</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑥\">ordered map</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③③\">continue</a>.</p>"
                            },
                            {
                              "html": "For each <var>buyer</var> → <var>buyerSignals</var> of <var>value</var>:",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>buyerOrigin</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⑧\">parsing an https origin</a> on <var>buyer</var>.</p>"
                                },
                                {
                                  "html": "<p>If <var>buyerOrigin</var> is failure, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③④\">continue</a>.</p>"
                                },
                                {
                                  "html": "<p>Let <var>buyerSignalsString</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-a-json-string\" id=\"ref-for-serialize-an-infra-value-to-a-json-string⑤\">serializing an Infra value to a JSON string</a>, given <var>buyerSignals</var>.</p>"
                                },
                                {
                                  "html": "<p>Set <var>processedSignals</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#direct-from-seller-signals-per-buyer-signals\" id=\"ref-for-direct-from-seller-signals-per-buyer-signals②\">per buyer signals</a>[<var>buyerOrigin</var>] to <var>buyerSignalsString</var>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Set <var>storedSignalsHeaders</var>[<var>signalsKey</var>] to <var>processedSignals</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "convert an ad size to a map",
      "href": "https://wicg.github.io/turtledove/#convert-an-ad-size-to-a-map",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-an-ad-size-to-a-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert an ad size to a map</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size④\">ad size</a> <var>adSize</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>dict</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑦\">map</a>.</p>"
        },
        {
          "html": "<p>Let <var>jsWidth</var> be <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width\" id=\"ref-for-ad-size-width④\">width</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①②\">converted to an ECMAScript value</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥⑨\">Set</a> <var>dict</var>[\"width\"] to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①③\">concatenating</a> « <a data-link-type=\"abstract-op\" href=\"https://tc39.github.io/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring②\">ToString</a>(<var>jsWidth</var>), <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width-units\" id=\"ref-for-ad-size-width-units③\">width units</a> ».</p>"
        },
        {
          "html": "<p>Let <var>jsHeight</var> be <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height\" id=\"ref-for-ad-size-height③\">height</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-idl-to-javascript-value\" id=\"ref-for-dfn-convert-idl-to-javascript-value①③\">converted to an ECMAScript value</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦⓪\">Set</a> <var>dict</var>[\"height\"] to the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate①④\">concatenating</a> « <a data-link-type=\"abstract-op\" href=\"https://tc39.github.io/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring③\">ToString</a>(<var>jsHeight</var>), <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height-units\" id=\"ref-for-ad-size-height-units③\">height units</a> ».</p>"
        },
        {
          "html": "<p>Return <var>dict</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize a currency tag",
      "href": "https://wicg.github.io/turtledove/#serialize-a-currency-tag",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-a-currency-tag\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize a currency tag</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag⑦\">currency tag</a> <var>currency</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>currency</var> is null, return \"???\".</p>"
        },
        {
          "html": "<p>Return <var>currency</var>.</p>"
        }
      ]
    },
    {
      "name": "check whether a string is a valid currency tag",
      "href": "https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-whether-a-string-is-a-valid-currency-tag\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check whether a string is a valid currency tag</dfn> given <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑨⑧\">string</a> <var>currencyString</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②⑥\">length</a> of <var>currencyString</var> is not 3, return false.</p>"
        },
        {
          "html": "<p>If <var>currencyString</var>[0] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-upper-alpha\" id=\"ref-for-ascii-upper-alpha\">ASCII upper alpha</a> code point, return false.</p>"
        },
        {
          "html": "<p>If <var>currencyString</var>[1] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-upper-alpha\" id=\"ref-for-ascii-upper-alpha①\">ASCII upper alpha</a> code point, return false.</p>"
        },
        {
          "html": "<p>If <var>currencyString</var>[2] is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-upper-alpha\" id=\"ref-for-ascii-upper-alpha②\">ASCII upper alpha</a> code point, return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "check a currency tag",
      "href": "https://wicg.github.io/turtledove/#check-a-currency-tag",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-a-currency-tag\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check a currency tag</dfn> given the <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#currency-tag\" id=\"ref-for-currency-tag⑧\">currency tags</a> <var>expected</var> and <var>actual</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>expected</var> is null, return true.</p>"
        },
        {
          "html": "<p>If <var>actual</var> is null, return true.</p>"
        },
        {
          "html": "<p>If <var>actual</var> is equal to <var>expected</var>, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "wait until configuration input promises resolve",
      "href": "https://wicg.github.io/turtledove/#wait-until-configuration-input-promises-resolve",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"wait-until-configuration-input-promises-resolve\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">wait until configuration input promises resolve</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config②⑥\">auction config</a> <var>auctionConfig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Wait until <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-pending-promise-count\" id=\"ref-for-auction-config-pending-promise-count\">pending promise count</a> is 0.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③⓪\">Assert</a> <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals⑥\">auction signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals⑤\">seller signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals①⓪\">per buyer signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies⑦\">per buyer currencies</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-timeouts\" id=\"ref-for-auction-config-per-buyer-timeouts⑥\">per buyer timeouts</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-cumulative-timeouts\" id=\"ref-for-auction-config-per-buyer-cumulative-timeouts⑤\">per buyer cumulative timeouts</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements⑥\">deprecated render url replacements</a>, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot⑥\">direct from seller signals header ad slot</a> are not <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise③①\">Promise</a></code>s, and <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-expects-additional-bids\" id=\"ref-for-auction-config-expects-additional-bids③\">expects additional bids</a> is false.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-auction-signals\" id=\"ref-for-auction-config-auction-signals⑦\">auction signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-seller-signals\" id=\"ref-for-auction-config-seller-signals⑥\">seller signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-signals\" id=\"ref-for-auction-config-per-buyer-signals①①\">per buyer signals</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies⑧\">per buyer currencies</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-timeouts\" id=\"ref-for-auction-config-per-buyer-timeouts⑦\">per buyer timeouts</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-cumulative-timeouts\" id=\"ref-for-auction-config-per-buyer-cumulative-timeouts⑥\">per buyer cumulative timeouts</a>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-deprecated-render-url-replacements\" id=\"ref-for-auction-config-deprecated-render-url-replacements⑦\">deprecated render url replacements</a>, or <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-direct-from-seller-signals-header-ad-slot\" id=\"ref-for-auction-config-direct-from-seller-signals-header-ad-slot⑦\">direct from seller signals header ad slot</a> is failure, return failure.</p>"
        },
        {
          "html": "<p>Return.</p>"
        }
      ]
    },
    {
      "name": "recursively wait until configuration input promises resolve",
      "href": "https://wicg.github.io/turtledove/#recursively-wait-until-configuration-input-promises-resolve",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"recursively-wait-until-configuration-input-promises-resolve\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">recursively wait until configuration input promises resolve</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config②⑦\">auction config</a> <var>auctionConfig</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⑤\">For each</a> <var>componentAuctionConfig</var> in <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-component-auctions\" id=\"ref-for-auction-config-component-auctions⑥\">component auctions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-until-configuration-input-promises-resolve\" id=\"ref-for-wait-until-configuration-input-promises-resolve②\">waiting until configuration input promises resolve</a> given <var>componentAuctionConfig</var> is failure, return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#wait-until-configuration-input-promises-resolve\" id=\"ref-for-wait-until-configuration-input-promises-resolve③\">waiting until configuration input promises resolve</a> given <var>auctionConfig</var>.</p>"
        }
      ]
    },
    {
      "name": "handle an input promise in configuration",
      "href": "https://wicg.github.io/turtledove/#handle-an-input-promise-in-configuration",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-an-input-promise-in-configuration\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle an input promise in configuration</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config②⑧\">auction config</a> <var>auctionConfig</var>,\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise③②\">Promise</a></code> <var>p</var>, and two sequences of steps, covering the parsing of the value and error-handling:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Increment <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-pending-promise-count\" id=\"ref-for-auction-config-pending-promise-count①\">pending promise count</a>.</p>"
        },
        {
          "html": "Let <var>resolvedAndTypeChecked</var> be the promise representing performing the following steps <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-fulfillment\" id=\"ref-for-upon-fulfillment①\">upon fulfillment</a> of <var>p</var> with <var>result</var>:",
          "rationale": "execute",
          "steps": [
            {
              "html": "<p>Execute the steps to be run for parsing of the value given <var>result</var>.</p>"
            },
            {
              "html": "<p>If no exception was <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥①\">thrown</a> in the previous step, then decrement <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-pending-promise-count\" id=\"ref-for-auction-config-pending-promise-count②\">pending promise count</a>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-rejection\" id=\"ref-for-upon-rejection\">Upon rejection</a> of <var>resolvedAndTypeChecked</var>:",
          "rationale": "execute",
          "steps": [
            {
              "html": "<p>Execute the steps for error-handling.</p>"
            },
            {
              "html": "<p>Decrement <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-pending-promise-count\" id=\"ref-for-auction-config-pending-promise-count③\">pending promise count</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "look up per-buyer currency",
      "href": "https://wicg.github.io/turtledove/#look-up-per-buyer-currency",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"look-up-per-buyer-currency\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">look up per-buyer currency</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config②⑨\">auction config</a> <var>auctionConfig</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥④\">origin</a> <var>buyer</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>perBuyerCurrency</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-currency\" id=\"ref-for-auction-config-all-buyers-currency①\">all buyers currency</a></p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③①\">Assert</a> that <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies⑨\">per buyer currencies</a> is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑤\">ordered map</a>.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies①⓪\">per buyer currencies</a>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④④\">exists</a>, then set <var>perBuyerCurrency</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-currencies\" id=\"ref-for-auction-config-per-buyer-currencies①①\">per buyer currencies</a>[<var>buyer</var>].</p>"
        },
        {
          "html": "<p>Return <var>perBuyerCurrency</var></p>"
        }
      ]
    },
    {
      "name": "look up per-buyer multi-bid limit",
      "href": "https://wicg.github.io/turtledove/#look-up-per-buyer-multi-bid-limit",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"look-up-per-buyer-multi-bid-limit\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">look up per-buyer multi-bid limit</dfn> given an <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config\" id=\"ref-for-auction-config③⓪\">auction config</a> <var>auctionConfig</var>, and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥⑤\">origin</a> <var>buyer</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>multiBidLimit</var> be <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-all-buyers-multi-bid-limit\" id=\"ref-for-auction-config-all-buyers-multi-bid-limit①\">all buyers multi-bid limit</a>.</p>"
        },
        {
          "html": "<p>If <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-multi-bid-limits\" id=\"ref-for-auction-config-per-buyer-multi-bid-limits②\">per buyer multi-bid limits</a>[<var>buyer</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④⑤\">exists</a>, then set <var>multiBidLimit</var> to <var>auctionConfig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#auction-config-per-buyer-multi-bid-limits\" id=\"ref-for-auction-config-per-buyer-multi-bid-limits③\">per buyer multi-bid limits</a>[<var>buyer</var>].</p>"
        },
        {
          "html": "<p>If <var>multiBidLimit</var> &lt; 1, set <var>multiBidLimit</var> to 1.</p>"
        },
        {
          "html": "<p>Return <var>multiBidLimit</var>.</p>"
        }
      ]
    },
    {
      "name": "create a new script fetcher",
      "href": "https://wicg.github.io/turtledove/#create-a-new-script-fetcher",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-new-script-fetcher\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new script fetcher</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②⑤\">URL</a> <var>url</var> and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥⑧\">origin</a> <var>frameOrigin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>fetcher</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher②\">script fetcher</a>.</p>"
        },
        {
          "html": "<p>Let <var>queue</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue④\">starting a new parallel queue</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps⑤\">Enqueue the following steps</a> to <var>queue</var>:",
          "rationale": "fetch",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-script\" id=\"ref-for-fetch-script\">Fetch script</a> given <var>url</var>, <var>frameOrigin</var> and <var>fetcher</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>fetcher</var>.</p>"
        }
      ]
    },
    {
      "name": "wait for script body from a fetcher",
      "href": "https://wicg.github.io/turtledove/#wait-for-script-body-from-a-fetcher",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"wait-for-script-body-from-a-fetcher\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">wait for script body from a fetcher</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher③\">script fetcher</a> <var>fetcher</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Wait until <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body\">script body</a> is not null.</p>"
        },
        {
          "html": "<p>Return <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body①\">script body</a>.</p>"
        }
      ]
    },
    {
      "name": "wait for cross origin trusted scoring signals authorization from a fetcher",
      "href": "https://wicg.github.io/turtledove/#wait-for-cross-origin-trusted-scoring-signals-authorization-from-a-fetcher",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"wait-for-cross-origin-trusted-scoring-signals-authorization-from-a-fetcher\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">wait for cross origin trusted scoring signals authorization from a fetcher</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher④\">script fetcher</a> <var>fetcher</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Wait until <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-origins-authorized-for-cross-origin-trusted-signals\" id=\"ref-for-script-fetcher-origins-authorized-for-cross-origin-trusted-signals\">origins authorized for cross origin trusted signals</a>.\nis not null.</p>"
        },
        {
          "html": "<p>Return <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-origins-authorized-for-cross-origin-trusted-signals\" id=\"ref-for-script-fetcher-origins-authorized-for-cross-origin-trusted-signals①\">origins authorized for cross origin trusted signals</a>.</p>"
        }
      ]
    },
    {
      "name": "parse allowed trusted scoring signals origins",
      "href": "https://wicg.github.io/turtledove/#parse-allowed-trusted-scoring-signals-origins",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-allowed-trusted-scoring-signals-origins\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse allowed trusted scoring signals origins</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list②\">header list</a> <var>headerList</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parsedHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header\" id=\"ref-for-concept-header-list-get-structured-header③\">getting a structured field value</a> given <span>`<code><a data-link-type=\"http-header\" href=\"https://wicg.github.io/turtledove/#http-headerdef-ad-auction-allow-trusted-scoring-signals-from\" id=\"ref-for-http-headerdef-ad-auction-allow-trusted-scoring-signals-from②\">Ad-Auction-Allow-Trusted-Scoring-Signals-From</a></code>`</span> and \"<code>list</code>\" from <var>headerList</var>.</p>"
        },
        {
          "html": "<p>If <var>parsedHeader</var> is null, return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨④\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑥⑨\">origins</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⑥\">For each</a> <var>entry</var> in <var>parsedHeader</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>entry</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⓪⑧\">string</a>, return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨⑥\">list</a>.</p>"
            },
            {
              "html": "<p>Let <var>parsedEntry</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-https-origin\" id=\"ref-for-parse-an-https-origin①⑨\">parsing an https origin</a> on <var>entry</var>.</p>"
            },
            {
              "html": "<p>If <var>parsedEntry</var> is failure, return an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨⑦\">list</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤⑨\">Append</a> <var>parsedEntry</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch script",
      "href": "https://wicg.github.io/turtledove/#fetch-script",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-script\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch script</dfn> given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②⑥\">URL</a> <var>url</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦⓪\">origin</a> <var>frameOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher\" id=\"ref-for-script-fetcher⑤\">script fetcher</a> <var>fetcher</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⑤\">request</a> with the following properties:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑦\">URL</a>\n       </dt><dd data-md=\"\">\n        <p><var>url</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑥\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>«<code>Accept</code>: <code>text/javascript</code>»</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑥\">client</a>\n       </dt><dd data-md=\"\">\n        <p><code>null</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑥\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>frameOrigin</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑥\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-cors</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑥\">referrer</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>no-referrer</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode⑥\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>omit</code>\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑥\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"<code>error</code>\"</p>\n      </dd></dl>"
        },
        {
          "html": "Let <var>fetchController</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch⑥\">fetching</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-useparallelqueue\" id=\"ref-for-fetch-useparallelqueue⑤\">useParallelQueue</a> set to true, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response\" id=\"ref-for-process-response\">processResponse</a> set to the following steps given\na <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①①\">response</a> <var>response</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response-headers\" id=\"ref-for-validate-fetching-response-headers①\">validating fetching response headers</a> given <var>response</var> is false:",
              "rationale": "abort",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-abort\" id=\"ref-for-fetch-controller-abort\">Abort</a> <var>fetchController</var>.</p>"
                },
                {
                  "html": "<p>Set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-origins-authorized-for-cross-origin-trusted-signals\" id=\"ref-for-script-fetcher-origins-authorized-for-cross-origin-trusted-signals②\">origins authorized for cross origin trusted signals</a> to\nan empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨⑧\">list</a> of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦①\">origins</a>.</p>"
                },
                {
                  "html": "<p>Set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body②\">script body</a> to failure.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-origins-authorized-for-cross-origin-trusted-signals\" id=\"ref-for-script-fetcher-origins-authorized-for-cross-origin-trusted-signals③\">origins authorized for cross origin trusted signals</a> to the\nresult of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-allowed-trusted-scoring-signals-origins\" id=\"ref-for-parse-allowed-trusted-scoring-signals-origins\">parsing allowed trusted scoring signals origins</a> given <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑧\"> header list</a>.</p>"
            },
            {
              "html": "<p>Let <var>bodyStream</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream\">stream</a>.</p>"
            },
            {
              "html": "<p>Let <var>bodyReader</var> be result of <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-get-a-reader\" id=\"ref-for-readablestream-get-a-reader\">getting a reader</a> from <var>bodyStream</var>.</p>"
            },
            {
              "html": "Let <var>successSteps</var> be a set of steps that take a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⑧\">byte sequence</a> <var>responseBody</var>, and\nperform the following:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#validate-fetching-response-mime-and-body\" id=\"ref-for-validate-fetching-response-mime-and-body①\">validate fetching response mime and body</a> with <var>response</var>, <var>responseBody</var> and\n\"<code>text/javascript</code>\" returns false, set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body③\">script body</a> to\nfailure.</p>"
                },
                {
                  "html": "<p>Otherwise, set set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body④\">script body</a> to <var>responseBody</var>.</p>"
                }
              ]
            },
            {
              "html": "Let <var>failureSteps</var> be a set of steps that take an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\" id=\"ref-for-dfn-exception\">exception</a> <var>e</var>, and\nperform the following:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set set <var>fetcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#script-fetcher-script-body\" id=\"ref-for-script-fetcher-script-body⑤\">script body</a> to failure.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-all-bytes\" id=\"ref-for-readablestreamdefaultreader-read-all-bytes\">Read all bytes</a> from <var>bodyReader</var>, given <var>successSteps</var> and <var>failureSteps</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "append to a bidding signals per-interest group data map",
      "href": "https://wicg.github.io/turtledove/#append-to-a-bidding-signals-per-interest-group-data-map",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"append-to-a-bidding-signals-per-interest-group-data-map\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">append to a bidding signals per-interest group data map</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨②\">ordered map</a> <var>sourceMap</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⑨\">ordered set</a> <var>igNames</var>, and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨③\">ordered map</a> <var>destinationMap</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③⑨\">For each</a> <var>sourceKey</var> → <var>sourceValue</var> of <var>sourceMap</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>igNames</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①①\">contain</a> <var>sourceKey</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>perGroupData</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data\" id=\"ref-for-bidding-signals-per-interest-group-data②\">bidding signals per interest group data</a>.</p>"
            },
            {
              "html": ""
            },
            {
              "html": "<p>If <var>sourceValue</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨④\">ordered map</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③⑥\">continue</a>.</p>"
            },
            {
              "html": "If <var>sourceValue</var>[\"<code>updateIfOlderThanMs</code>\"] is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double③⑥\">double</a></code>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>updateIfOlderThanMs</var> be <var>sourceValue</var>[\"<code>updateIfOlderThanMs</code>\"].</p>"
                },
                {
                  "html": "<p>If <var>updateIfOlderThanMs</var> &lt; 600,000, set <var>updateIfOlderThanMs</var> to 600,000.</p>"
                },
                {
                  "html": "<p>Set <var>perGroupData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data-updateifolderthanms\" id=\"ref-for-bidding-signals-per-interest-group-data-updateifolderthanms②\">updateIfOlderThanMs</a> to <var>updateIfOlderThanMs</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>perGroupData</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#bidding-signals-per-interest-group-data-updateifolderthanms\" id=\"ref-for-bidding-signals-per-interest-group-data-updateifolderthanms③\">updateIfOlderThanMs</a> is not\nnull, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦①\">set</a> <var>destinationMap</var>[<var>sourceKey</var>] to <var>perGroupData</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fetch the current outstanding trusted signals batch",
      "href": "https://wicg.github.io/turtledove/#fetch-the-current-outstanding-trusted-signals-batch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-current-outstanding-trusted-signals-batch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch the current outstanding trusted signals batch</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher\" id=\"ref-for-trusted-bidding-signals-batcher①\">trusted bidding signals batcher</a> <var>trustedBiddingSignalsBatcher</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②⑦\">URL</a> <var>signalsUrl</var>,\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦②\">origin</a> <var>scriptOrigin</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short②⓪\">unsigned short</a></code>-or-null <var>experimentGroupId</var>,\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦③\">origin</a> <var>topLevelOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①⑥\">string</a> <var>slotSizeQueryParam</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>signalsUrl</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>biddingSignalsUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-trusted-bidding-signals-url\" id=\"ref-for-build-trusted-bidding-signals-url②\">building trusted bidding signals url</a> with <var>signalsUrl</var>, <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-keys\" id=\"ref-for-trusted-bidding-signals-batcher-keys\">keys</a>, <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names\">ig names</a>, <var>experimentGroupId</var>, <var>topLevelOrigin</var>, and <var>slotSizeQueryParam</var>.</p>"
        },
        {
          "html": "<p>Let « <var>partialTrustedBiddingSignals</var>, <var>partialPerInterestGroupData</var>, <var>dataVersion</var> » be the\n result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-trusted-signals\" id=\"ref-for-fetch-trusted-signals①\">fetching trusted signals</a> with <var>biddingSignalsUrl</var>, <var>scriptOrigin</var>, and true.</p>"
        },
        {
          "html": "If <var>partialTrustedBiddingSignals</var> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate④⓪\">For each</a> <var>key</var> → <var>value</var> in <var>partialTrustedBiddingSignals</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦②\">set</a> <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-all-trusted-bidding-signals\" id=\"ref-for-trusted-bidding-signals-batcher-all-trusted-bidding-signals①\">all trusted bidding\nsignals</a>[<var>key</var>] to <var>value</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⑦\">For each</a> <var>igName</var> of <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names①\">ig names</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦③\">set</a> <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-data-versions\" id=\"ref-for-trusted-bidding-signals-batcher-data-versions①\">data versions</a>[<var>igName</var>] to <var>dataVersion</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#append-to-a-bidding-signals-per-interest-group-data-map\" id=\"ref-for-append-to-a-bidding-signals-per-interest-group-data-map\">Append to a bidding signals per-interest group data map</a> with <var>partialPerInterestGroupData</var>, <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names②\">ig names</a>, and <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-all-per-interest-group-data\" id=\"ref-for-trusted-bidding-signals-batcher-all-per-interest-group-data①\">all per interest group data</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⑧\">for each</a> <var>igName</var> of <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names③\">ig names</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦④\">Set</a> <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-no-signals-flags\" id=\"ref-for-trusted-bidding-signals-batcher-no-signals-flags②\">no signals flags</a>[<var>igName</var>] to \"fetch-failed\".</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "batch or fetch trusted bidding signals",
      "href": "https://wicg.github.io/turtledove/#batch-or-fetch-trusted-bidding-signals",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"batch-or-fetch-trusted-bidding-signals\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">batch or fetch trusted bidding signals</dfn> given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher\" id=\"ref-for-trusted-bidding-signals-batcher②\">trusted bidding signals batcher</a> <var>trustedBiddingSignalsBatcher</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group\" id=\"ref-for-interest-group⑥③\">interest group</a> <var>ig</var>, a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②⑧\">URL</a> <var>signalsUrl</var>,\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦④\">origin</a> <var>scriptOrigin</var> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-unsigned-short\" id=\"ref-for-idl-unsigned-short②①\">unsigned short</a></code>-or-null <var>experimentGroupId</var>,\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑦⑤\">origin</a> <var>topLevelOrigin</var>, and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①⑦\">string</a> <var>slotSizeQueryParam</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>igName</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-name\" id=\"ref-for-interest-group-name③③\">name</a>.</p>"
        },
        {
          "html": "If <var>signalsUrl</var> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦⑤\">Set</a> <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-no-signals-flags\" id=\"ref-for-trusted-bidding-signals-batcher-no-signals-flags③\">no signals flags</a> [<var>igName</var>] to \"no-fetch\".</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦⑥\">Set</a> <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-no-signals-flags\" id=\"ref-for-trusted-bidding-signals-batcher-no-signals-flags④\">no signals flags</a>[<var>igName</var>] to \"no-fetch\"\n if <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys⑧\">trusted bidding signals keys</a> is null or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty②\">is empty</a>.</p>"
        },
        {
          "html": "<p>Let <var>putativeKeys</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone\">clone</a> of <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-keys\" id=\"ref-for-trusted-bidding-signals-batcher-keys①\">keys</a>.</p>"
        },
        {
          "html": "<p>Let <var>putativeIgNames</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone①\">clone</a> of <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names④\">ig names</a>.</p>"
        },
        {
          "html": "<p>Let <var>putativeLengthLimit</var> be <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length⑤\">max trusted bidding signals url length</a>.</p>"
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length⑥\">max trusted bidding signals url length</a> is 0 or &gt; <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-length-limit\" id=\"ref-for-trusted-bidding-signals-batcher-length-limit\">length limit</a>,\nthen set <var>putativeLengthLimit</var> to <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-length-limit\" id=\"ref-for-trusted-bidding-signals-batcher-length-limit①\">length limit</a>.</p>"
        },
        {
          "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys⑨\">trusted bidding signals keys</a> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend⑥\">extend</a> <var>putativeKeys</var> with <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys①⓪\">trusted bidding signals keys</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥⓪\">Append</a> <var>igName</var> to <var>putativeIgNames</var>.</p>"
        },
        {
          "html": "<p>Let <var>biddingSignalsUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#build-trusted-bidding-signals-url\" id=\"ref-for-build-trusted-bidding-signals-url③\">building trusted bidding signals url</a> with <var>signalsUrl</var>, <var>putativeKeys</var>, <var>putativeIgNames</var>, <var>experimentGroupId</var>, <var>topLevelOrigin</var>, and <var>slotSizeQueryParam</var>.</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer②②\">serialized</a> <var>biddingSignalsUrl</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length②⑦\">length</a> ≤ <var>putativeLengthLimit</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-keys\" id=\"ref-for-trusted-bidding-signals-batcher-keys②\">keys</a> to <var>putativeKeys</var>.</p>"
            },
            {
              "html": "<p>Set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names⑤\">ig names</a> to <var>putativeIgNames</var>.</p>"
            },
            {
              "html": "<p>Set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-length-limit\" id=\"ref-for-trusted-bidding-signals-batcher-length-limit②\">length limit</a> to <var>putativeLengthLimit</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "fetch",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#fetch-the-current-outstanding-trusted-signals-batch\" id=\"ref-for-fetch-the-current-outstanding-trusted-signals-batch①\">Fetch the current outstanding trusted signals batch</a> given <var>trustedBiddingSignalsBatcher</var>, <var>signalsUrl</var>, <var>scriptOrigin</var>, <var>experimentGroupId</var>, <var>topLevelOrigin</var>, <var>slotSizeQueryParam</var>.</p>"
            },
            {
              "html": "<p>If <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys①①\">trusted bidding signals keys</a> is not null, set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-keys\" id=\"ref-for-trusted-bidding-signals-batcher-keys③\">keys</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone②\">clone</a> of <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys\" id=\"ref-for-interest-group-trusted-bidding-signals-keys①②\">trusted bidding signals keys</a>.</p>"
            },
            {
              "html": "<p>Otherwise, set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-keys\" id=\"ref-for-trusted-bidding-signals-batcher-keys④\">keys</a> to a\n new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨⑨\">list</a>.</p>"
            },
            {
              "html": "<p>Set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-ig-names\" id=\"ref-for-trusted-bidding-signals-batcher-ig-names⑥\">ig names</a> to\n  « <var>igName</var> ».</p>"
            },
            {
              "html": "<p>Set <var>trustedBiddingSignalsBatcher</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#trusted-bidding-signals-batcher-length-limit\" id=\"ref-for-trusted-bidding-signals-batcher-length-limit③\">length limit</a> to <var>ig</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-max-trusted-bidding-signals-url-length\" id=\"ref-for-interest-group-max-trusted-bidding-signals-url-length⑦\">max trusted bidding signals url length</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "apply any component ads target to a bid",
      "href": "https://wicg.github.io/turtledove/#apply-any-component-ads-target-to-a-bid",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-any-component-ads-target-to-a-bid\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply any component ads target to a bid</dfn>, given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①⑦\">generated bid</a> <var>generatedBid</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-target-number-of-ad-components\" id=\"ref-for-generated-bid-target-number-of-ad-components②\">target number of ad components</a> is null, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③②\">Assert</a> that <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①⑥\">ad component descriptors</a> is not null.</p>"
        },
        {
          "html": "While <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①⑦\">ad component descriptors</a>'s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑦\">size</a> &gt; <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-target-number-of-ad-components\" id=\"ref-for-generated-bid-target-number-of-ad-components③\">target number of ad components</a>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⓪\">Remove</a> the last value from <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①⑧\">ad component descriptors</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "try to reach component ads target considering k-anonymity",
      "href": "https://wicg.github.io/turtledove/#try-to-reach-component-ads-target-considering-k-anonymity",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"try-to-reach-component-ads-target-considering-k-anonymity\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">try to reach component ads target considering k-anonymity</dfn>, given a <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①⑧\">generated bid</a> <var>generatedBid</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-target-number-of-ad-components\" id=\"ref-for-generated-bid-target-number-of-ad-components④\">target number of ad components</a> is null, return false.</p>"
        },
        {
          "html": "<p>Let <var>selectedComponents</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪①\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-descriptor\" id=\"ref-for-ad-descriptor①②\">ad descriptors</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧⑨\">For each</a> <var>i</var> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-get-the-indices\" id=\"ref-for-list-get-the-indices\">get the indices</a> of <var>generatedBid</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>candidateComponent</var> be <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors①⑨\">ad component descriptors</a>[<var>i</var>].</p>"
            },
            {
              "html": "<p>Compute <var>componentAdHashCode</var> by getting the result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#compute-the-key-hash-of-component-ad\" id=\"ref-for-compute-the-key-hash-of-component-ad③\">compute the key hash of component ad</a> given <var>candidateComponent</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#interest-group-ad-render-url\" id=\"ref-for-interest-group-ad-render-url①⑤\">render url</a>.</p>"
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-k-anonymity-cache\" id=\"ref-for-query-k-anonymity-cache④\">query k-anonymity cache</a> given <var>componentAdHashCode</var> returns true:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥①\">Append</a> <var>candidateComponent</var> to <var>selectedComponents</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>i</var> &lt; <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-number-of-mandatory-ad-components\" id=\"ref-for-generated-bid-number-of-mandatory-ad-components①\">number of mandatory ad components</a>, return false.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>selectedComponents</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑧\">size</a> &lt; <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-target-number-of-ad-components\" id=\"ref-for-generated-bid-target-number-of-ad-components⑤\">target number of ad components</a>,\n return false.</p>"
        },
        {
          "html": "<p>Set <var>generatedBid</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-ad-component-descriptors\" id=\"ref-for-generated-bid-ad-component-descriptors②⓪\">ad component descriptors</a> to <var>selectedComponents</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#apply-any-component-ads-target-to-a-bid\" id=\"ref-for-apply-any-component-ads-target-to-a-bid①\">Apply any component ads target to a bid</a> given <var>generatedBid</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-generated-bid-k-anonymity-count\" id=\"ref-for-query-generated-bid-k-anonymity-count①\">query generated bid k-anonymity count</a> given <var>generatedBid</var>.</p>"
        }
      ]
    },
    {
      "name": "adjust bid list based on k-anonymity",
      "href": "https://wicg.github.io/turtledove/#adjust-bid-list-based-on-k-anonymity",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"adjust-bid-list-based-on-k-anonymity\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">adjust bid list based on k-anonymity</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪②\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid①⑨\">generated bids</a> <var>bidsBatch</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>bidsToScore</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪③\">list</a> of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid\" id=\"ref-for-generated-bid②⓪\">generated bids</a></p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨⓪\">For each</a> <var>generatedBid</var> of <var>bidsBatch</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bidCopy</var> be a clone of <var>generatedBid</var>.</p>"
            },
            {
              "html": "<p>Set <var>bidCopy</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#generated-bid-for-k-anon-auction\" id=\"ref-for-generated-bid-for-k-anon-auction④\">for k-anon auction</a> to false.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#apply-any-component-ads-target-to-a-bid\" id=\"ref-for-apply-any-component-ads-target-to-a-bid②\">Apply any component ads target to a bid</a> given <var>bidCopy</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥②\">Append</a> <var>bidCopy</var> to <var>bidsToScore</var></p>"
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#query-generated-bid-k-anonymity-count\" id=\"ref-for-query-generated-bid-k-anonymity-count②\">query generated bid k-anonymity count</a> given <var>generatedBid</var> returns true:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥③\">Append</a> <var>generatedBid</var> to <var>bidsToScore</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the result of applying <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#try-to-reach-component-ads-target-considering-k-anonymity\" id=\"ref-for-try-to-reach-component-ads-target-considering-k-anonymity\">try to reach component ads target considering k-anonymity</a> given <var>generatedBid</var> is true:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥④\">Append</a> <var>generatedBid</var> to <var>bidsToScore</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>bidsToScore</var>.</p>"
        }
      ]
    },
    {
      "name": "parse an AdRender ad size",
      "href": "https://wicg.github.io/turtledove/#parse-an-adrender-ad-size",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-an-adrender-ad-size\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse an AdRender ad size</dfn> given an object <var>adSlotSize</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If either <var>adSlotSize</var>[\"height\"] or <var>adSlotSize</var>[\"width\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④⑥\">exist</a>, return null.</p>"
        },
        {
          "html": "<p>Let <var>width</var> and <var>widthUnit</var> be the dimension and dimension unit that results from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-dimension-value\" id=\"ref-for-parse-an-adrender-dimension-value②\">parse an AdRender dimension value</a> with <var>adSlotSize</var>[\"width\"], respectively.</p>"
        },
        {
          "html": "<p>If <var>width</var> is null, return null.</p>"
        },
        {
          "html": "<p>Let <var>height</var> and <var>heightUnit</var> be the dimension and dimension unit that results from running <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#parse-an-adrender-dimension-value\" id=\"ref-for-parse-an-adrender-dimension-value③\">parse an AdRender dimension value</a> with <var>adSlotSize</var>[\"height\"], respectively.</p>"
        },
        {
          "html": "<p>If <var>height</var> is null, return null.</p>"
        },
        {
          "html": "<p>Let <var>adSize</var> be a new <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size\" id=\"ref-for-ad-size⑨\">ad size</a>.</p>"
        },
        {
          "html": "<p>Set <var>adSize</var>’s <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width\" id=\"ref-for-ad-size-width⑤\">width</a> to <var>width</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-width-units\" id=\"ref-for-ad-size-width-units④\">width units</a> to <var>widthUnit</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height\" id=\"ref-for-ad-size-height④\">height</a> to <var>height</var>, <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#ad-size-height-units\" id=\"ref-for-ad-size-height-units④\">height units</a> to <var>heightUnit</var>.</p>"
        },
        {
          "html": "<p>Return <var>adSize</var>.</p>"
        }
      ]
    },
    {
      "name": "process scoreAd output",
      "href": "https://wicg.github.io/turtledove/#process-scoread-output",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-scoread-output\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process scoreAd output</dfn> given an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①①\">Completion Record</a> <var>result</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>result</var> is an an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①②\">abrupt completion</a>, return failure.</p>"
        },
        {
          "html": "If <var>result</var>.[[Value]] is a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#number\" id=\"ref-for-number\">Number</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>checkedScore</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value③\">converting</a> <var>result</var>.[[Value]] to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-double\" id=\"ref-for-idl-double④⑥\">double</a></code>.</p>"
            },
            {
              "html": "<p>If an exception was <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥②\">thrown</a> in the previous step, return failure.</p>"
            },
            {
              "html": "<p>Let <var>resultIDL</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-scoreadoutput\" id=\"ref-for-dictdef-scoreadoutput\">ScoreAdOutput</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>resultIDL</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-desirability\" id=\"ref-for-dom-scoreadoutput-desirability③\">desirability</a></code> to <var>checkedScore</var>.</p>"
            },
            {
              "html": "<p>Return <var>resultIDL</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>resultIDL</var> be the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value④\">converting</a> <var>result</var>.[[Value]] to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dictdef-scoreadoutput\" id=\"ref-for-dictdef-scoreadoutput①\">ScoreAdOutput</a></code>.</p>"
        },
        {
          "html": "<p>If an exception was <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥③\">thrown</a> in the previous step, return failure.</p>"
        },
        {
          "html": "<p>If <var>resultIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bidcurrency\" id=\"ref-for-dom-scoreadoutput-bidcurrency③\">bidCurrency</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④⑦\">exists</a> and result of <a data-link-type=\"dfn\" href=\"https://wicg.github.io/turtledove/#check-whether-a-string-is-a-valid-currency-tag\" id=\"ref-for-check-whether-a-string-is-a-valid-currency-tag④\">checking whether a string is a valid currency tag</a> applied to <var>resultIDL</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://wicg.github.io/turtledove/#dom-scoreadoutput-bidcurrency\" id=\"ref-for-dom-scoreadoutput-bidcurrency④\">bidCurrency</a></code>\"] is false, then return failure.</p>"
        },
        {
          "html": "<p>Return <var>resultIDL</var>.</p>"
        }
      ]
    }
  ]
}