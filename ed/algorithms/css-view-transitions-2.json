{
  "spec": {
    "title": "CSS View Transitions Module Level 2",
    "url": "https://drafts.csswg.org/css-view-transitions-2/"
  },
  "algorithms": [
    {
      "name": "start-vt-with-options",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#dom-document-startviewtransition",
      "html": "The <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#method-steps\" id=\"ref-for-method-steps\">method steps</a> for <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Document\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"startViewTransition(callbackOptions)|startViewTransition()\" id=\"dom-document-startviewtransition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>startViewTransition(<var>callbackOptions</var>)</code></dfn> are as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Perform the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element①\">Element</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-element-startviewtransition\" id=\"ref-for-dom-element-startviewtransition②\">startViewTransition()</a></code> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#method-steps\" id=\"ref-for-method-steps①\">method steps</a>\ngiven <var>callbackOptions</var>,\nbut for the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#root-element\" id=\"ref-for-root-element\">document root element</a>,\nand return the result.</p>"
        }
      ]
    },
    {
      "name": "start-el-vt-with-options",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#dom-element-startviewtransition",
      "html": "The <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#method-steps\" id=\"ref-for-method-steps②\">method steps</a> for <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Element\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"startViewTransition(callbackOptions)|startViewTransition()\" id=\"dom-element-startviewtransition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>startViewTransition(<var>callbackOptions</var>)</code></dfn> are as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated document</a>.</p>"
        },
        {
          "html": "<p>Let <var>viewTransition</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑧\">ViewTransition</a></code> object in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant Realm</a>,\nwith <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-root-element\" id=\"ref-for-viewtransition-root-element②\">root element</a> set to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>.</p>"
        },
        {
          "html": "<p>If <var>callbackOptions</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#callbackdef-viewtransitionupdatecallback\" id=\"ref-for-callbackdef-viewtransitionupdatecallback①⑨\">ViewTransitionUpdateCallback</a></code>,\nset <var>viewTransition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback\" id=\"ref-for-viewtransition-update-callback\">update callback</a> to <var>callbackOptions</var>.</p>\n      <p>Otherwise, if <var>callbackOptions</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dictdef-startviewtransitionoptions\" id=\"ref-for-dictdef-startviewtransitionoptions②\">StartViewTransitionOptions</a></code>, then set <var>viewTransition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback\" id=\"ref-for-viewtransition-update-callback①\">update callback</a>\nto <var>callbackOptions</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-startviewtransitionoptions-update\" id=\"ref-for-dom-startviewtransitionoptions-update\">update</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#principal-box\" id=\"ref-for-principal-box\">principal box</a> is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-images-4/#element-not-rendered\" id=\"ref-for-element-not-rendered\">not rendered</a>,\nor is an <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#internal-ruby-box\" id=\"ref-for-internal-ruby-box\">internal ruby box</a>\nor a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#atomic-inline\" id=\"ref-for-atomic-inline\">non-atomic</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-3/#inline-level\" id=\"ref-for-inline-level\">inline-level</a> box,\n<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition\">skip</a> <var>viewTransition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a> is not the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#root-element\" id=\"ref-for-root-element①\">document root element</a>,\nforce <span id=\"ref-for-this④\">this</span> to have both <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-contain-2/#layout-containment\" id=\"ref-for-layout-containment\">layout containment</a> and <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-scope-view-transition-scoping\" id=\"ref-for-view-transition-scope-view-transition-scoping\">view transition scoping</a> for the duration of the transition.</p>"
        },
        {
          "html": "If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition④\">active view transition</a> is not null and its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-outbound-post-capture-steps\" id=\"ref-for-viewtransition-outbound-post-capture-steps\">outbound post-capture steps</a> is not null,\nthen:",
          "rationale": "skip",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①\">Skip</a> <var>viewTransition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Return <var>viewTransition</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition⑤\">active view transition</a> is not null,\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition②\">skip that view transition</a>\nwith an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> in <span id=\"ref-for-this⑥\">this’s</span> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant Realm</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition⑦\">active view transition</a> to <var>viewTransition</var>.</p>"
        },
        {
          "html": "<p>If <var>callbackOptions</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dictdef-startviewtransitionoptions\" id=\"ref-for-dictdef-startviewtransitionoptions③\">StartViewTransitionOptions</a></code>, set <var>viewTransition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-active-types\" id=\"ref-for-viewtransition-active-types\">active types</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone\">clone</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-startviewtransitionoptions-types\" id=\"ref-for-dom-startviewtransitionoptions-types\">types</a></code> as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">set</a>.</p>"
        },
        {
          "html": "<p>Return <var>viewTransition</var>.</p>"
        }
      ]
    },
    {
      "name": "dom-viewtransition-skipTransition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-skiptransition",
      "html": "The <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#method-steps\" id=\"ref-for-method-steps③\">method steps</a> for <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"ViewTransition\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-viewtransition-skiptransition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>skipTransition()</code></dfn> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase\">phase</a> is not \"<code>done</code>\",\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition④\">skip the view transition</a> for <span id=\"ref-for-this①⑧\">this</span>\nwith an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror①\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
        }
      ]
    },
    {
      "name": "document-scoped view transition name",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name",
      "html": "To get the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"document-scoped-view-transition-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">document-scoped view transition name</dfn> for an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element①①\">Element</a></code> <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>scopedViewTransitionName</var> be the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-name\" id=\"ref-for-propdef-view-transition-name⑥\">view-transition-name</a> for <var>element</var>.</p>"
        },
        {
          "html": "<p>If <var>scopedViewTransitionName</var> is associated with <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a>, then return <var>scopedViewTransitionName</var>.</p>"
        },
        {
          "html": "<p>Otherwise, return <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-name-none\" id=\"ref-for-valdef-view-transition-name-none\">none</a>.</p>"
        }
      ]
    },
    {
      "html": "A successful cross-document view transition goes through the following phases:",
      "rationale": "if",
      "steps": [
        {
          "html": "In the old <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑦\">Document</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>The user initiates a navigation, by clicking a link, submitting a form, pressing the browser’s back button, etc.</p>"
            },
            {
              "html": "<p>When the new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑧\">Document</a></code> is ready to be activated, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/indices.html#event-pageswap\" id=\"ref-for-event-pageswap②\">pageswap</a></code> event is fired.</p>"
            },
            {
              "html": "<p>If the navigation is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a>, has no cross-origin redirects,\nand the old <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document⑨\">Document</a></code> has <a href=\"https://drafts.csswg.org/css-view-transitions-2/#cross-doc-opt-in\">opted in to cross-document view transitions</a>, the event’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-pageswapevent-viewtransition\" id=\"ref-for-dom-pageswapevent-viewtransition①\">viewTransition</a></code> attribute would be\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition②⑧\">ViewTransition</a></code> object.</p>"
            },
            {
              "html": "<p>The author can now customize the transition, e.g. by mutating its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-types\" id=\"ref-for-dom-viewtransition-types④\">types</a></code>, or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-skiptransition\" id=\"ref-for-dom-viewtransition-skiptransition⑤\">skip</a></code> it altogether.</p>"
            },
            {
              "html": "<p>If the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition②⑨\">ViewTransition</a></code> is not skipped, the state of the old document is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-old-state\" id=\"ref-for-capture-the-old-state\">captured</a>.</p>"
            },
            {
              "html": "<p>The navigation proceeds: the old <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⓪\">Document</a></code> is unloaded, and the new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①①\">Document</a></code> is now active.</p>"
            }
          ]
        },
        {
          "html": "Then, in the new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①②\">Document</a></code>:",
          "rationale": "resolve",
          "steps": [
            {
              "html": "<p>When the new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①③\">Document</a></code> is ready for its first <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#rendering-opportunity\" id=\"ref-for-rendering-opportunity\">rendering opportunity</a>, an event named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/indices.html#event-pagereveal\" id=\"ref-for-event-pagereveal①\">pagereveal</a></code> is fired on the new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①④\">Document</a></code>, with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-pagerevealevent-viewtransition\" id=\"ref-for-dom-pagerevealevent-viewtransition①\">viewTransition</a></code> attribute.</p>"
            },
            {
              "html": "<p>This <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⓪\">ViewTransition</a></code>’s <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-updatecallbackdone\" id=\"ref-for-dom-viewtransition-updatecallbackdone⑦\">updateCallbackDone</a></code></code> promise is already resolved,\nand its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element①\">captured elements</a> are populated from the old <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⑤\">Document</a></code>.</p>"
            },
            {
              "html": "<p>This is another opportunity for the author to customize the transition, e.g. by mutating its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-types\" id=\"ref-for-dom-viewtransition-types⑤\">types</a></code>, or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#dom-viewtransition-skiptransition\" id=\"ref-for-dom-viewtransition-skiptransition⑥\">skip</a></code> it altogether.</p>"
            },
            {
              "html": "<p>The state of the new document is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-new-state\" id=\"ref-for-capture-the-new-state\">captured</a> as the \"new\" state of the transition.</p>"
            },
            {
              "html": "<p>From this point forward, the transition continues in a similar fashion to a same-document transition, as per <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#activate-view-transition\" id=\"ref-for-activate-view-transition\">activate view transition</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "view-transition-name/auto",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#view-transition-name-auto",
      "html": "In addition to the existing values, the <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-name\" id=\"ref-for-propdef-view-transition-name③④\">view-transition-name</a> also accepts an <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"view-transition-name\" data-dfn-type=\"dfn\" data-export=\"\" id=\"view-transition-name-auto\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">auto</dfn> keyword.\nTo resolve the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value①\">used value</a> of <span class=\"property\" id=\"ref-for-propdef-view-transition-name③⑤\">view-transition-name</span> for <var>element</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>computed</var> be the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value②\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-name\" id=\"ref-for-propdef-view-transition-name③⑥\">view-transition-name</a>.</p>"
        },
        {
          "html": "<p>If <var>computed</var> is <span class=\"css\">none</span>, return null.</p>"
        },
        {
          "html": "<p>If <var>computed</var> is a <a class=\"css production\" data-link-type=\"type\" href=\"https://drafts.csswg.org/css-values-4/#identifier-value\" id=\"ref-for-identifier-value②②\">&lt;custom-ident&gt;</a>, return <var>computed</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>computed</var> is <span class=\"css\">auto</span> or <span class=\"css\">match-element</span>.</p>"
        },
        {
          "html": "<p>If <var>computed</var> is <span class=\"css\">auto</span>, <var>element</var> has an associated <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-id\" id=\"ref-for-concept-id②\">id</a>, and <var>computed</var> is associated with the same <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\" id=\"ref-for-concept-tree-root①\">root</a> as <var>element</var>’s <span id=\"ref-for-concept-tree-root②\">root</span>, then return a unique string starting with \"<code>-ua-</code>\".\nTwo elements with the same <span id=\"ref-for-concept-id③\">id</span> must return the same string, regardless of their <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document③\">node document</a>.</p>"
        },
        {
          "html": "<p>Return a unique string starting with \"<code>-ua-</code>\". The string should remain consistent and unique for this element and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①⑧\">Document</a></code>, at least for the lifetime of <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document④\">node document</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition①⑥\">active view transition</a>.</p>"
        }
      ]
    },
    {
      "name": "perform pending transition operations",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#perform-pending-transition-operations",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"perform-pending-transition-operations\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">perform pending transition operations</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②②\">Document</a></code> <var>document</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition①⑧\">active view transition</a> is not null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition①⑨\">active view transition</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase②\">phase</a> is \"<code>pending-capture</code>\",\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#setup-view-transition\" id=\"ref-for-setup-view-transition①\">setup view transition</a> for <var>document</var>’s <span id=\"ref-for-document-active-view-transition②⓪\">active view transition</span>.</p>"
            },
            {
              "html": "<p>Otherwise, if <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②①\">active view transition</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase③\">phase</a> is \"<code>animating</code>\",\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#handle-transition-frame\" id=\"ref-for-handle-transition-frame\">handle transition frame</a> for <var>document</var>’s <span id=\"ref-for-document-active-view-transition②②\">active view transition</span>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "resolve @view-transition rule",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#resolve-view-transition-rule",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"resolve-view-transition-rule\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">resolve @view-transition rule</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②③\">Document</a></code> <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-visibility-state\">visibility state</a> is \"<code>hidden</code>\",\nthen return \"<code>skip transition</code>\".</p>"
        },
        {
          "html": "<p>Let <var>matchingRule</var> be the last <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#at-view-transition-rule\" id=\"ref-for-at-view-transition-rule①⑤\">@view-transition</a> rule in <var>document</var>.</p>"
        },
        {
          "html": "<p>If <var>matchingRule</var> is not found, then return \"<code>skip transition</code>\".</p>"
        },
        {
          "html": "<p>If <var>matchingRule</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-navigation\" id=\"ref-for-view-transition-navigation②\">navigation</a> descriptor’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value③\">computed value</a> is <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-navigation-none\" id=\"ref-for-valdef-view-transition-navigation-none\">none</a>, then return \"<code>skip transition</code>\".</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>matchingRule</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-navigation\" id=\"ref-for-view-transition-navigation③\">navigation</a> descriptor’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value④\">computed value</a> is <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-navigation-auto\" id=\"ref-for-valdef-view-transition-navigation-auto①\">auto</a>.</p>"
        },
        {
          "html": "<p>Let <var>typesDescriptor</var> be <var>matchingRule</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-types\" id=\"ref-for-view-transition-types④\">types</a> descriptor.</p>"
        },
        {
          "html": "<p>If <var>typesDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑤\">computed value</a> is <span class=\"css\">none</span>, then return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a> « ».</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> of strings corresponding to <var>typesDescriptor</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑥\">computed value</a>.</p>"
        }
      ]
    },
    {
      "name": "setup view transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#setup-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"setup-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">setup view transition</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⑤\">ViewTransition</a></code> <var>transition</var>,\n\t\t\tperform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated document</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#flush-the-update-callback-queue\" id=\"ref-for-flush-the-update-callback-queue\">Flush the update callback queue</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-old-state\" id=\"ref-for-capture-the-old-state①\">Capture the old state</a> for <var>transition</var>.</p>\n      <p>If failure is returned, then <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition⑤\">skip the view transition</a> for <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant Realm</a>,\nand return.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-rendering-suppression-for-view-transitions\" id=\"ref-for-document-rendering-suppression-for-view-transitions①\">rendering suppression for view transitions</a> to true.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source\">DOM manipulation task source</a>,\ngiven <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>,\nto perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase④\">phase</a> is \"<code>done</code>\", then abort these steps.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#schedule-the-update-callback\" id=\"ref-for-schedule-the-update-callback\">schedule the update callback</a> for <var>transition</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#flush-the-update-callback-queue\" id=\"ref-for-flush-the-update-callback-queue①\">Flush the update callback queue</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "activate view transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#activate-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"activate-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">activate view transition</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⑥\">ViewTransition</a></code> <var>transition</var>,\n\t\t\tperform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase⑤\">phase</a> is \"<code>done</code>\", then return.</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated document</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-rendering-suppression-for-view-transitions\" id=\"ref-for-document-rendering-suppression-for-view-transitions②\">rendering suppression for view transitions</a> to false.</p>"
        },
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-initial-snapshot-containing-block-size\" id=\"ref-for-viewtransition-initial-snapshot-containing-block-size\">initial snapshot containing block size</a> is not equal to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-size\" id=\"ref-for-snapshot-containing-block-size①\">snapshot containing block size</a>,\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition⑧\">skip</a> <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant Realm</a>,\nand return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-new-state\" id=\"ref-for-capture-the-new-state①\">Capture the new state</a> for <var>transition</var>.</p>\n      <p>If failure is returned, then <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition⑨\">skip</a> <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant Realm</a>,\nand return.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>capturedElement</var> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements①\">named elements</a>' <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">values</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①\">new element</a> is not null,\nthen set <var>capturedElement</var>’s <span id=\"ref-for-captured-element-new-element②\">new element</span>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-in-a-view-transition\" id=\"ref-for-captured-in-a-view-transition③\">captured in a view transition</a> to true.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#setup-transition-pseudo-elements\" id=\"ref-for-setup-transition-pseudo-elements④\">Setup transition pseudo-elements</a> for <var>transition</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#update-pseudo-element-styles\" id=\"ref-for-update-pseudo-element-styles②\">Update pseudo-element styles</a> for <var>transition</var>.</p>\n      <p>If failure is returned, then <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①⓪\">skip the view transition</a> for <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑧\">relevant Realm</a>,\nand return.</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase⑥\">phase</a> to \"<code>animating</code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-ready-promise\" id=\"ref-for-viewtransition-ready-promise②\">ready promise</a>.</p>"
        }
      ]
    },
    {
      "name": "capture the old state",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#capture-the-old-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"capture-the-old-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">capture the old state</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⑦\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated document</a>.</p>"
        },
        {
          "html": "<p>Let <var>namedElements</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements②\">named elements</a>.</p>"
        },
        {
          "html": "<p>Let <var>usedTransitionNames</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">set</a> of strings.</p>"
        },
        {
          "html": "<p>Let <var>captureElements</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of elements.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-size\" id=\"ref-for-snapshot-containing-block-size②\">snapshot containing block size</a> exceeds an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a> maximum, then return failure.</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-initial-snapshot-containing-block-size\" id=\"ref-for-viewtransition-initial-snapshot-containing-block-size①\">initial snapshot containing block size</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-size\" id=\"ref-for-snapshot-containing-block-size③\">snapshot containing block size</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>element</var> of every <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element①⑧\">element</a> that is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#connected\" id=\"ref-for-connected\">connected</a>,\nand has a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑤\">node document</a> equal to <var>document</var>,\nin <a href=\"https://drafts.csswg.org/css2/#painting-order\">paint order</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree③\">flat tree</a> ancestor of this <var>element</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-contain-2/#skips-its-contents\" id=\"ref-for-skips-its-contents①\">skips its contents</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree④\">flat tree</a> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-inclusive-ancestor\" id=\"ref-for-concept-tree-inclusive-ancestor\">inclusive ancestor</a> of this <var>element</var>,\nup to but not including <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-root-element\" id=\"ref-for-viewtransition-root-element①⑤\">root element</a>,\nhas <a class=\"css\" data-link-type=\"propdesc\" href=\"https://drafts.csswg.org/css-contain-2/#propdef-contain\" id=\"ref-for-propdef-contain\">contain: view-transition</a>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>element</var> has more than one <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-break-4/#box-fragment\" id=\"ref-for-box-fragment\">box fragment</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>transitionName</var> be the <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name\" id=\"ref-for-document-scoped-view-transition-name①\">document-scoped view transition name</a>.</p>"
            },
            {
              "html": "<p>If <var>transitionName</var> is <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-name-none\" id=\"ref-for-valdef-view-transition-name-none④\">none</a>,\nor <var>element</var> is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-images-4/#element-not-rendered\" id=\"ref-for-element-not-rendered②\">not rendered</a>,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "If <var>usedTransitionNames</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> <var>transitionName</var>, then:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>element</var> in <var>captureElements</var>:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-in-a-view-transition\" id=\"ref-for-captured-in-a-view-transition④\">captured in a view transition</a> to false.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Return failure.</p>"
                }
              ]
            },
            {
              "html": "<p>If <em>any other</em> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②③\">active view transition</a> contains <var>element</var>\nin its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element⑤\">captured elements</a>,\nthen for each such <span id=\"ref-for-document-active-view-transition②④\">active view transition</span>,\nin <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-order\" id=\"ref-for-concept-tree-order\">tree order</a> of their corresponding <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-root-element\" id=\"ref-for-viewtransition-root-element①⑥\">root elements</a>,\n<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①①\">skip</a> that view transition with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror②\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code> in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑨\">relevant Realm</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>transitionName</var> to <var>usedTransitionNames</var>.</p>"
            },
            {
              "html": "<p>Set <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-in-a-view-transition\" id=\"ref-for-captured-in-a-view-transition⑤\">captured in a view transition</a> to true.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>element</var> to <var>captureElements</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>element</var> in <var>captureElements</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>capture</var> be a new <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element⑥\">captured element</a> struct.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image①\">old image</a> to the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-image\" id=\"ref-for-capture-the-image④\">capturing the image</a> of <var>element</var>.</p>"
            },
            {
              "html": "<p>Let <var>originalRect</var> be <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block\" id=\"ref-for-snapshot-containing-block①②\">snapshot containing block</a> if <var>element</var> is the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#document-element\" id=\"ref-for-document-element①③\">document element</a>,\notherwise, the <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-box-4/#border-box\" id=\"ref-for-border-box②\">border box</a>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-width\" id=\"ref-for-captured-element-old-width\">old width</a> to <var>originalRect</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/geometry-1/#dom-domrect-width\" id=\"ref-for-dom-domrect-width\">width</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-height\" id=\"ref-for-captured-element-old-height\">old height</a> to <var>originalRect</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/geometry-1/#dom-domrect-height\" id=\"ref-for-dom-domrect-height\">height</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-transform\" id=\"ref-for-captured-element-old-transform\">old transform</a> to a\n<a class=\"css\" data-link-type=\"type\" data-xref-type=\"css-type\" href=\"https://drafts.csswg.org/css-transforms-2/#typedef-transform-function\" id=\"ref-for-typedef-transform-function①\">&lt;transform-function&gt;</a> that would map\n<var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-box-4/#border-box\" id=\"ref-for-border-box③\">border box</a> from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-origin\" id=\"ref-for-snapshot-containing-block-origin\">snapshot containing block origin</a> to its\ncurrent visual position.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-writing-mode\" id=\"ref-for-captured-element-old-writing-mode\">old writing-mode</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑦\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode\" id=\"ref-for-propdef-writing-mode①\">writing-mode</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-direction\" id=\"ref-for-captured-element-old-direction\">old direction</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑧\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction\" id=\"ref-for-propdef-direction①\">direction</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-text-orientation\" id=\"ref-for-captured-element-old-text-orientation\">old text-orientation</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value⑨\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-4/#propdef-text-orientation\" id=\"ref-for-propdef-text-orientation①\">text-orientation</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-mix-blend-mode\" id=\"ref-for-captured-element-old-mix-blend-mode\">old mix-blend-mode</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⓪\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/compositing-2/#propdef-mix-blend-mode\" id=\"ref-for-propdef-mix-blend-mode②\">mix-blend-mode</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-backdrop-filter\" id=\"ref-for-captured-element-old-backdrop-filter\">old backdrop-filter</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①①\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/filter-effects-2/#propdef-backdrop-filter\" id=\"ref-for-propdef-backdrop-filter①\">backdrop-filter</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-color-scheme\" id=\"ref-for-captured-element-old-color-scheme\">old color-scheme</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①②\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-adjust-1/#propdef-color-scheme\" id=\"ref-for-propdef-color-scheme①\">color-scheme</a> on <var>element</var>.</p>"
            },
            {
              "html": "<p>Let <var>transitionName</var> be the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①③\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-name\" id=\"ref-for-propdef-view-transition-name③⑧\">view-transition-name</a> for <var>element</var>.</p>"
            },
            {
              "html": "<p>Set <var>namedElements</var>[<var>transitionName</var>] to <var>capture</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>element</var> in <var>captureElements</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-in-a-view-transition\" id=\"ref-for-captured-in-a-view-transition⑦\">captured in a view transition</a> to false.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "capture the new state",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#capture-the-new-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"capture-the-new-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">capture the new state</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⑧\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated document</a>.</p>"
        },
        {
          "html": "<p>Let <var>namedElements</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements③\">named elements</a>.</p>"
        },
        {
          "html": "<p>Let <var>usedTransitionNames</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">set</a> of strings.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>element</var> of every <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element①⑨\">element</a> that is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#connected\" id=\"ref-for-connected①\">connected</a>,\nand has a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑥\">node document</a> equal to <var>document</var>,\nin <a href=\"https://drafts.csswg.org/css2/#painting-order\">paint order</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree⑤\">flat tree</a> ancestor of this <var>element</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-contain-2/#skips-its-contents\" id=\"ref-for-skips-its-contents②\">skips its contents</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>transitionName</var> be <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name\" id=\"ref-for-document-scoped-view-transition-name②\">document-scoped view transition name</a>.</p>"
            },
            {
              "html": "<p>If <var>transitionName</var> is <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-name-none\" id=\"ref-for-valdef-view-transition-name-none⑤\">none</a>,\nor <var>element</var> is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-images-4/#element-not-rendered\" id=\"ref-for-element-not-rendered③\">not rendered</a>,\nthen <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>element</var> has more than one <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-break-4/#box-fragment\" id=\"ref-for-box-fragment②\">box fragment</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>usedTransitionNames</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a> <var>transitionName</var>,\nthen return failure.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>transitionName</var> to <var>usedTransitionNames</var>.</p>"
            },
            {
              "html": "<p>If <var>namedElements</var>[<var>transitionName</var>] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exist</a>,\nthen set <var>namedElements</var>[<var>transitionName</var>] to a new <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element⑦\">captured element</a> struct.</p>"
            },
            {
              "html": "<p>Set <var>namedElements</var>[<var>transitionName</var>]'s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element③\">new element</a> to <var>element</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "setup transition pseudo-elements",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#setup-transition-pseudo-elements",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"setup-transition-pseudo-elements\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">setup transition pseudo-elements</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition③⑨\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑤\">associated document</a>.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-show-view-transition-tree\" id=\"ref-for-document-show-view-transition-tree\">show view transition tree</a> to true.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">For each</a> <var>transitionName</var> → <var>capturedElement</var> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements④\">named elements</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>group</var> be a new <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-group\" id=\"ref-for-selectordef-view-transition-group②③\">::view-transition-group()</a>,\nwith its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①③\">view transition name</a> set to <var>transitionName</var>.</p>"
            },
            {
              "html": "<p>Append <var>group</var> to <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-transition-root-pseudo-element\" id=\"ref-for-viewtransition-transition-root-pseudo-element④\">transition root pseudo-element</a>.</p>"
            },
            {
              "html": "<p>Let <var>imagePair</var> be a new <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-image-pair\" id=\"ref-for-selectordef-view-transition-image-pair⑧\">::view-transition-image-pair()</a>,\nwith its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①④\">view transition name</a> set to <var>transitionName</var>.</p>"
            },
            {
              "html": "<p>Append <var>imagePair</var> to <var>group</var>.</p>"
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image②\">old image</a> is not null, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>old</var> be a new <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-old\" id=\"ref-for-selectordef-view-transition-old①⓪\">::view-transition-old()</a>,\nwith its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①⑤\">view transition name</a> set to <var>transitionName</var>,\ndisplaying <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image③\">old image</a>\nas its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#replaced-element\" id=\"ref-for-replaced-element②\">replaced</a> content.</p>"
                },
                {
                  "html": "<p>Append <var>old</var> to <var>imagePair</var>.</p>"
                }
              ]
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element④\">new element</a> is not null, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>new</var> be a new <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-new\" id=\"ref-for-selectordef-view-transition-new①⓪\">::view-transition-new()</a>,\nwith its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①⑥\">view transition name</a> set to <var>transitionName</var>.</p>"
                },
                {
                  "html": "<p>Append <var>new</var> to <var>imagePair</var>.</p>"
                }
              ]
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image④\">old image</a> is null, then:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element⑤\">new element</a> is not null.</p>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-image-animation-name-rule\" id=\"ref-for-captured-element-image-animation-name-rule\">image animation name rule</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule④\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet⑤\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\">:root::view-transition-new<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">animation-name</c-><c- p=\"\">:</c-> -ua-view-transition-fade-in<c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
                }
              ]
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element⑥\">new element</a> is null, then:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image⑤\">old image</a> is not null.</p>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-image-animation-name-rule\" id=\"ref-for-captured-element-image-animation-name-rule①\">image animation name rule</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule⑤\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet⑥\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\">:root::view-transition-old<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">animation-name</c-><c- p=\"\">:</c-> -ua-view-transition-fade-out<c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
                }
              ]
            },
            {
              "html": "If both of <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-image\" id=\"ref-for-captured-element-old-image⑥\">old image</a> and <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element⑦\">new element</a>\nare not null, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>transform</var> be <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-transform\" id=\"ref-for-captured-element-old-transform①\">old transform</a>.</p>"
                },
                {
                  "html": "<p>Let <var>width</var> be <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-width\" id=\"ref-for-captured-element-old-width①\">old width</a>.</p>"
                },
                {
                  "html": "<p>Let <var>height</var> be <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-height\" id=\"ref-for-captured-element-old-height①\">old height</a>.</p>"
                },
                {
                  "html": "<p>Let <var>backdropFilter</var> be <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-backdrop-filter\" id=\"ref-for-captured-element-old-backdrop-filter①\">old backdrop-filter</a>.</p>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-group-keyframes\" id=\"ref-for-captured-element-group-keyframes\">group keyframes</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-animations-1/#csskeyframesrule\" id=\"ref-for-csskeyframesrule①\">CSSKeyframesRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet⑦\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\"><c- n=\"\">@keyframes</c-> -ua-view-transition-group-anim-<var>transitionName</var> <c- p=\"\">{</c->\n  from <c- p=\"\">{</c->\n    <c- k=\"\">transform</c-><c- p=\"\">:</c-> <var>transform</var><c- p=\"\">;</c->\n    <c- k=\"\">width</c-><c- p=\"\">:</c-> <var>width</var><c- p=\"\">;</c->\n    <c- k=\"\">height</c-><c- p=\"\">:</c-> <var>height</var><c- p=\"\">;</c->\n    <c- k=\"\">backdrop-filter</c-><c- p=\"\">:</c-> <var>backdropFilter</var><c- p=\"\">;</c->\n  <c- p=\"\">}</c->\n<c- p=\"\">}</c->\n</pre>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-group-animation-name-rule\" id=\"ref-for-captured-element-group-animation-name-rule\">group animation name rule</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule⑥\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet⑧\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\">:root::view-transition-group<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">animation-name</c-><c- p=\"\">:</c-> -ua-view-transition-group-anim-<var>transitionName</var><c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-image-pair-isolation-rule\" id=\"ref-for-captured-element-image-pair-isolation-rule\">image pair isolation rule</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule⑦\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet⑨\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\">:root::view-transition-image-pair<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">isolation</c-><c- p=\"\">:</c-> isolate<c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
                },
                {
                  "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-image-animation-name-rule\" id=\"ref-for-captured-element-image-animation-name-rule②\">image animation name rule</a> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule⑧\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet①⓪\">dynamic view transition style sheet</a>:</p>\n<pre class=\"highlight\">:root::view-transition-old<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">animation-name</c-><c- p=\"\">:</c-> -ua-view-transition-fade-out<c- p=\"\">,</c-> -ua-mix-blend-mode-plus-lighter<c- p=\"\">;</c->\n<c- p=\"\">}</c->\n:root::view-transition-new<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">animation-name</c-><c- p=\"\">:</c-> -ua-view-transition-fade-in<c- p=\"\">,</c-> -ua-mix-blend-mode-plus-lighter<c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "navigation can trigger a cross-document view-transition?",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#navigation-can-trigger-a-cross-document-view-transition",
      "html": "To check if a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"navigation-can-trigger-a-cross-document-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">navigation can trigger a cross-document view-transition?</dfn> given\n\ta <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑤\">Document</a></code> <var>oldDocument</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑥\">Document</a></code> <var>newDocument</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#navigationtype\" id=\"ref-for-navigationtype①\">NavigationType</a></code> <var>navigationType</var>, and a boolean <var>isBrowserUINavigation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the user agent decides to display an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①\">implementation-defined</a> navigation experience, e.g. a gesture-based transition for a back navigation,\nthe user agent may ignore the author-defined view transition. If that is the case, return false.</p>"
        },
        {
          "html": "<p>If <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-can-initiate-outbound-view-transition\" id=\"ref-for-document-can-initiate-outbound-view-transition\">can initiate outbound view transition</a> is false, then return false.</p>"
        },
        {
          "html": "<p>If <var>navigationType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-navigationtype-reload\" id=\"ref-for-dom-navigationtype-reload①\">reload</a></code>, then return false.</p>"
        },
        {
          "html": "<p>If <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> as <var>newDocument</var>’s <span id=\"ref-for-concept-document-origin①\">origin</span>, then return false.</p>"
        },
        {
          "html": "<p>If <var>newDocument</var> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#was-created-via-cross-origin-redirects\" id=\"ref-for-was-created-via-cross-origin-redirects\">was created via cross-origin redirects</a> and <var>newDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#latest-entry\" id=\"ref-for-latest-entry\">latest entry</a> is null, then return false.</p>"
        },
        {
          "html": "<p>If <var>navigationType</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-navigationtype-traverse\" id=\"ref-for-dom-navigationtype-traverse②\">traverse</a></code>, then return true.</p>"
        },
        {
          "html": "<p>If <var>isBrowserUINavigation</var> is true, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "setup cross-document view-transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#setup-cross-document-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"setup-cross-document-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">setup cross-document view-transition</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑦\">Document</a></code> <var>oldDocument</var>,\n\ta <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑧\">Document</a></code> <var>newDocument</var>, and <var>proceedWithNavigation</var>, which is an algorithm accepting nothing:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: These steps are running as part of a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-task\" id=\"ref-for-concept-task\">task</a> queued on <var>oldDocument</var>.</p>"
        },
        {
          "html": "<p>If <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-can-initiate-outbound-view-transition\" id=\"ref-for-document-can-initiate-outbound-view-transition①\">can initiate outbound view transition</a> is false, then return null.</p>"
        },
        {
          "html": "<p>Let <var>transitionTypesFromRule</var> be the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#resolve-view-transition-rule\" id=\"ref-for-resolve-view-transition-rule\">resolving the @view-transition rule</a> for <var>oldDocument</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: <var>transitionTypesFromRule</var> is not \"<code>skip transition</code>\".</p>"
        },
        {
          "html": "<p>If <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②⑤\">active view transition</a> is not null,\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①②\">skip</a> <var>oldDocument</var>’s <span id=\"ref-for-document-active-view-transition②⑥\">active view transition</span>\nwith an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror③\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code> in <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⓪\">relevant Realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>outboundTransition</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④⓪\">ViewTransition</a></code> object in <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①①\">relevant Realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>outboundTransition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-active-types\" id=\"ref-for-viewtransition-active-types⑦\">active types</a> to <var>transitionTypesFromRule</var>.</p>"
        },
        {
          "html": "Set <var>outboundTransition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-outbound-post-capture-steps\" id=\"ref-for-viewtransition-outbound-post-capture-steps①\">outbound post-capture steps</a> to the following steps given a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params\" id=\"ref-for-view-transition-params②\">view transition params</a>-or-null <var>params</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>newDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-inbound-view-transition-params\" id=\"ref-for-document-inbound-view-transition-params\">inbound view transition params</a> to <var>params</var>.</p>"
            },
            {
              "html": "To skip the transition after a timeout, the user agent may perform the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
              "rationale": "wait",
              "steps": [
                {
                  "html": "<p>Wait for an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②\">implementation-defined</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration\">duration</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①\">DOM manipulation task source</a> given <var>newDocument</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a> to perform the following step:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>newDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-inbound-view-transition-params\" id=\"ref-for-document-inbound-view-transition-params①\">inbound view transition params</a> is <var>params</var>, then set <var>newDocument</var>’s <span id=\"ref-for-document-inbound-view-transition-params②\">inbound view transition params</span> to null.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Call <var>proceedWithNavigation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>oldDocument</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②⑦\">active view transition</a> to <var>outboundTransition</var>.</p>"
        },
        {
          "html": "<p>The user agent should display the currently displayed frame until either:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/indices.html#event-pagereveal\" id=\"ref-for-event-pagereveal⑤\">pagereveal</a></code> event is fired.</p>\n       </li><li data-md=\"\">\n        <p>its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②⑧\">active view transition</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase⑦\">phase</a> is \"<code>done</code>\".</p>\n      </li></ul>"
        },
        {
          "html": "<p>Return <var>outboundTransition</var>.</p>"
        }
      ]
    },
    {
      "name": "update-opt-in-for-outbound",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#update-the-opt-in-state-for-outbound-transitions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-the-opt-in-state-for-outbound-transitions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the opt-in state for outbound transitions</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document②⑨\">Document</a></code> <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>document</var> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#has-been-revealed\" id=\"ref-for-has-been-revealed\">has been revealed</a>, and the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#resolve-view-transition-rule\" id=\"ref-for-resolve-view-transition-rule①\">resolving the @view-transition rule</a> is not \"<code>skip transition</code>\",\nthen set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-can-initiate-outbound-view-transition\" id=\"ref-for-document-can-initiate-outbound-view-transition②\">can initiate outbound view transition</a> to true.</p>"
        },
        {
          "html": "<p>Otherwise, set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-can-initiate-outbound-view-transition\" id=\"ref-for-document-can-initiate-outbound-view-transition③\">can initiate outbound view transition</a> to false.</p>"
        }
      ]
    },
    {
      "name": "additional skip steps",
      "html": "Append the following steps to <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①③\">skip the view transition</a> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④②\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-outbound-post-capture-steps\" id=\"ref-for-viewtransition-outbound-post-capture-steps②\">outbound post-capture steps</a> is not null, then run <var>transition</var>’s <span id=\"ref-for-viewtransition-outbound-post-capture-steps③\">outbound post-capture steps</span> with null.</p>"
        }
      ]
    },
    {
      "name": "additional transition operation",
      "html": "Prepend the following step to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#perform-pending-transition-operations\" id=\"ref-for-perform-pending-transition-operations③\">Perform pending transition operations</a> algorithm given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document③⓪\">Document</a></code> <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition②⑨\">active view transition</a> is not null and its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-outbound-post-capture-steps\" id=\"ref-for-viewtransition-outbound-post-capture-steps④\">outbound post-capture steps</a> is not null, then:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③⓪\">active view transition</a>’s  <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase⑧\">phase</a> is \"<code>pending-capture</code>\".</p>"
            },
            {
              "html": "<p>Let <var>viewTransitionParams</var> be null;</p>"
            },
            {
              "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-rendering-suppression-for-view-transitions\" id=\"ref-for-document-rendering-suppression-for-view-transitions③\">rendering suppression for view transitions</a> to true.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-old-state\" id=\"ref-for-capture-the-old-state④\">Capture the old state</a> for <var>transition</var>.</p>"
            },
            {
              "html": "<p>If this succeeded, then set <var>viewTransitionParams</var> to a new <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params\" id=\"ref-for-view-transition-params③\">view transition params</a> whose\n<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params-named-elements\" id=\"ref-for-view-transition-params-named-elements\">named elements</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone\">clone</a> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements⑤\">named elements</a>,\nand whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params-initial-snapshot-containing-block-size\" id=\"ref-for-view-transition-params-initial-snapshot-containing-block-size\">initial snapshot containing block size</a> is <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-initial-snapshot-containing-block-size\" id=\"ref-for-viewtransition-initial-snapshot-containing-block-size②\">initial snapshot containing block size</a>.</p>"
            },
            {
              "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-rendering-suppression-for-view-transitions\" id=\"ref-for-document-rendering-suppression-for-view-transitions④\">rendering suppression for view transitions</a> to false.</p>"
            },
            {
              "html": "<p>Call <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-outbound-post-capture-steps\" id=\"ref-for-viewtransition-outbound-post-capture-steps⑤\">outbound post-capture steps</a> given <var>viewTransitionParams</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "resolve inbound cross-document view-transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#resolve-inbound-cross-document-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"resolve-inbound-cross-document-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">resolve inbound cross-document view-transition</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document③②\">Document</a></code> <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>document</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active\">fully active</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: <var>document</var> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#has-been-revealed\" id=\"ref-for-has-been-revealed①\">has been revealed</a> is true.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#update-the-opt-in-state-for-outbound-transitions\" id=\"ref-for-update-the-opt-in-state-for-outbound-transitions①\">Update the opt-in state for outbound transitions</a> for <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>inboundViewTransitionParams</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-inbound-view-transition-params\" id=\"ref-for-document-inbound-view-transition-params③\">inbound view transition params</a>.</p>"
        },
        {
          "html": "<p>If <var>inboundViewTransitionParams</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-inbound-view-transition-params\" id=\"ref-for-document-inbound-view-transition-params④\">inbound view transition params</a> to null.</p>"
        },
        {
          "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③①\">active view transition</a> is not null, then return null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#resolve-view-transition-rule\" id=\"ref-for-resolve-view-transition-rule②\">Resolve @view-transition rule</a> for <var>document</var> and let <var>resolvedRule</var> be the result.</p>"
        },
        {
          "html": "<p>If <var>resolvedRule</var> is \"<code>skip transition</code>\", then return null.</p>"
        },
        {
          "html": "<p>Let <var>transition</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④③\">ViewTransition</a></code> in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①②\">relevant Realm</a>,\nwhose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements⑥\">named elements</a> is <var>inboundViewTransitionParams</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params-named-elements\" id=\"ref-for-view-transition-params-named-elements①\">named elements</a>,\nand <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-initial-snapshot-containing-block-size\" id=\"ref-for-viewtransition-initial-snapshot-containing-block-size③\">initial snapshot containing block size</a> is <var>inboundViewTransitionParams</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-params-initial-snapshot-containing-block-size\" id=\"ref-for-view-transition-params-initial-snapshot-containing-block-size①\">initial snapshot containing block size</a>.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③②\">active view transition</a> to <var>transition</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">Resolve</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback-done-promise\" id=\"ref-for-viewtransition-update-callback-done-promise③\">update callback done promise</a> with undefined.</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase⑨\">phase</a> to \"<code>update-callback-called</code>\".</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-active-types\" id=\"ref-for-viewtransition-active-types⑨\">active types</a> to <var>resolvedRule</var>.</p>"
        },
        {
          "html": "<p>Return <var>transition</var>.</p>"
        }
      ]
    },
    {
      "name": "additional capture steps",
      "html": "When capturing the old or new state for an element, perform the following steps given a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element⑧\">captured element</a> <var>capture</var> and an <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element②⓪\">element</a> <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>capture</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-class-list\" id=\"ref-for-captured-element-class-list①\">class list</a> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①④\">computed value</a> of <var>element</var>’s <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-class\" id=\"ref-for-propdef-view-transition-class⑧\">view-transition-class</a>, if it is associated with <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑦\">node document</a>.</p>"
        }
      ]
    },
    {
      "name": "resolve the document-scoped view-transition-group",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-group",
      "html": "To get the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"document-scoped-view-transition-group\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">document-scoped view transition group</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element②①\">Element</a></code> <var>element</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>computedGroup</var> be the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⑤\">computed value</a> of element’s <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-view-transitions-2/#propdef-view-transition-group\" id=\"ref-for-propdef-view-transition-group⑦\">view-transition-group</a> property.</p>"
        },
        {
          "html": "<p>If <var>computedGroup</var> is associated with <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑧\">node document</a>, return <var>computedGroup</var>.</p>"
        },
        {
          "html": "<p>Return <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-normal\" id=\"ref-for-valdef-view-transition-group-normal②\">normal</a>.</p>"
        }
      ]
    },
    {
      "name": "resolve nearest containing group name",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#nearest-containing-group-name",
      "html": "To resolve the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"nearest-containing-group-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">nearest containing group name</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element②②\">Element</a></code> <var>element</var>, perform the following steps given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④④\">ViewTransition</a></code> <var>viewTransition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <var>element</var> participates in <var>viewTransition</var>.</p>"
        },
        {
          "html": "<p>Let <var>ancestorGroup</var> be <var>element</var>’s nearest <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree⑥\">flat tree</a> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-ancestor\" id=\"ref-for-concept-tree-ancestor\">ancestor</a> who participates in <var>viewTransition</var> and whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-group\" id=\"ref-for-document-scoped-view-transition-group\">document-scoped view transition group</a> is not <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-normal\" id=\"ref-for-valdef-view-transition-group-normal③\">normal</a>.</p>"
        },
        {
          "html": "<p>If <var>ancestorGroup</var> exists, return <var>ancestorGroup</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name\" id=\"ref-for-document-scoped-view-transition-name③\">document-scoped view transition name</a>.</p>"
        },
        {
          "html": "<p>Return <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-name-none\" id=\"ref-for-valdef-view-transition-name-none⑥\">none</a>.</p>"
        }
      ]
    },
    {
      "name": "resolve used group name",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#used-group-name",
      "html": "To resolve the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"used-group-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">used group name</dfn> of an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element②③\">Element</a></code> <var>element</var>, perform the following steps given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④⑤\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <var>element</var> participates in <var>transition</var>.</p>"
        },
        {
          "html": "<p>Let <var>group</var> be <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-group\" id=\"ref-for-document-scoped-view-transition-group①\">document-scoped view transition group</a>.</p>"
        },
        {
          "html": "<p>Let <var>containingGroupName</var> be <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#nearest-containing-group-name\" id=\"ref-for-nearest-containing-group-name\">nearest containing group name</a> given <var>transition</var>.</p>"
        },
        {
          "html": "<p>Return the first matching statement, switching on <var>group</var>:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-normal\" id=\"ref-for-valdef-view-transition-group-normal④\">normal</a>, <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-contain\" id=\"ref-for-valdef-view-transition-group-contain\">contain</a>: <var>containingGroupName</var>.\nNote: an element with <span class=\"css\" id=\"ref-for-valdef-view-transition-group-contain①\">contain</span> becomes the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#nearest-containing-group-name\" id=\"ref-for-nearest-containing-group-name①\">nearest containing group name</a> for its descendants.</p>\n       </li><li data-md=\"\">\n        <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-nearest\" id=\"ref-for-valdef-view-transition-group-nearest\">nearest</a>: The <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name\" id=\"ref-for-document-scoped-view-transition-name④\">document-scoped view transition name</a> of the element’s nearest <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree⑦\">flat tree</a> ancestor which participates in the <var>transition</var>.</p>\n       </li><li data-md=\"\">\n        <p><a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#valdef-view-transition-group-custom-ident\" id=\"ref-for-valdef-view-transition-group-custom-ident\">&lt;custom-ident&gt;</a>: <var>group</var> if the element has a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree⑧\">flat tree</a> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-ancestor\" id=\"ref-for-concept-tree-ancestor①\">ancestor</a> whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-scoped-view-transition-name\" id=\"ref-for-document-scoped-view-transition-name⑤\">document-scoped view transition name</a> is <var>group</var> and participates in <var>transition</var>; Otherwise <var>containingGroupName</var>.</p>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "additional old capture steps (group)",
      "html": "When  <a href=\"https://drafts.csswg.org/css-view-transitions-1/#capture-old-state-algorithm\">capturing the old state for an element</a>, perform the following steps given a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element⑨\">captured element</a> <var>capturedElement</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④⑥\">ViewTransition</a></code> <var>transition</var>, and an <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element②④\">element</a> <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-containing-group-name\" id=\"ref-for-captured-element-containing-group-name\">containing group name</a> to <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#used-group-name\" id=\"ref-for-used-group-name\">used group name</a> given <var>transition</var>.</p>"
        },
        {
          "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-border-width\" id=\"ref-for-captured-element-old-border-width\">old border width</a> to <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#used-value\" id=\"ref-for-used-value③\">used</a> <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-borders-4/#propdef-border-width\" id=\"ref-for-propdef-border-width①\">border-width</a>.</p>"
        }
      ]
    },
    {
      "name": "additional new capture steps (group)",
      "html": "When <a href=\"https://drafts.csswg.org/css-view-transitions-1/#capture-new-state-algorithm\">capturing the new state for an element</a>, perform the following steps given a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element①⓪\">captured element</a> <var>capturedElement</var> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④⑦\">ViewTransition</a></code> <var>transition</var>, and an <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element②⑤\">element</a> <var>element</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-containing-group-name\" id=\"ref-for-captured-element-containing-group-name①\">containing group name</a> to <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#used-group-name\" id=\"ref-for-used-group-name①\">used group name</a> given <var>transition</var>.</p>"
        }
      ]
    },
    {
      "name": "additional pseudo-element setup steps (group)",
      "html": "When <a href=\"https://drafts.csswg.org/css-view-transitions-1/#setup-transition-pseudo-elements-algorithm\">setting up the transition pseudo-element</a> for a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element①①\">captured element</a> <var>capturedElement</var>, given a <var>transitionName</var> and a <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>containingGroupName</var> be <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-containing-group-name\" id=\"ref-for-captured-element-containing-group-name②\">containing group name</a>.</p>"
        },
        {
          "html": "<p>If <var>containingGroupName</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>groupContainerElement</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements⑦\">named elements</a>[<var>containingGroupName</var>].</p>"
        },
        {
          "html": "<p>Let <var>group</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-group\" id=\"ref-for-selectordef-view-transition-group②⑤\">::view-transition-group()</a>,\nwhose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①⑦\">view transition name</a> is set to <var>transitionName</var>.</p>"
        },
        {
          "html": "<p>Let <var>childrenContainerGroup</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-group-children\" id=\"ref-for-selectordef-view-transition-group-children④\">::view-transition-group-children()</a> whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①⑧\">view transition name</a> is set to <var>containingGroupName</var>.</p>"
        },
        {
          "html": "<p>If <var>childrenContainerGroup</var> does not exist:\nGenerate it and append to the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-group\" id=\"ref-for-selectordef-view-transition-group②⑥\">::view-transition-group()</a>,\nwhose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name①⑨\">view transition name</a> is set to <var>containingGroupName</var>.</p>"
        },
        {
          "html": "<p>Append <var>group</var> to <var>childrenContainerGroup</var>.</p>"
        },
        {
          "html": "<p>When setting the animation keyframes given <var>transform</var>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#adjust-nested-view-transition-group-transform\" id=\"ref-for-adjust-nested-view-transition-group-transform\">adjust</a> <var>transform</var> given <var>groupContainerElement</var>.</p>"
        }
      ]
    },
    {
      "name": "additional pseudo-element style update steps (group)",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#adjust-nested-view-transition-group-transform",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"adjust-nested-view-transition-group-transform\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">adjust nested view transition group transform</dfn> given a <var>transform</var> and a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element①③\">captured element</a> <var>groupContainerElement</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>childrenTransform</var> be <var>transform</var>.</p>"
        },
        {
          "html": "<p>Set <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-transform-from-snapshot-containing-block\" id=\"ref-for-captured-element-transform-from-snapshot-containing-block\">transform from snapshot containing block</a> to <var>transform</var>.</p>"
        },
        {
          "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-containing-group-name\" id=\"ref-for-captured-element-containing-group-name③\">containing group name</a> is not null, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>groupContainerElement</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements⑧\">named elements</a>[<var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-containing-group-name\" id=\"ref-for-captured-element-containing-group-name④\">containing group name</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#adjust-nested-view-transition-group-transform\" id=\"ref-for-adjust-nested-view-transition-group-transform①\">Adjust</a> <var>transform</var> given <var>groupContainerElement</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "additional pseudo-element style update steps (group)",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#adjust-nested-view-transition-group-transform",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"adjust-nested-view-transition-group-transform\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">adjust nested view transition group transform</dfn> given a <var>transform</var> and a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element\" id=\"ref-for-captured-element①③\">captured element</a> <var>groupContainerElement</var>:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>childrenTransform</var> be <var>groupContainerElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-transform-from-snapshot-containing-block\" id=\"ref-for-captured-element-transform-from-snapshot-containing-block①\">transform from snapshot containing block</a>.</p>"
        },
        {
          "html": "<p>If <var>childrenTransform</var> is null, set it to <var>groupContainerElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-transform\" id=\"ref-for-captured-element-old-transform②\">old transform</a>.</p>"
        },
        {
          "html": "<p>Translate <var>childrenTransform</var> by <var>groupContainerElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-border-width\" id=\"ref-for-captured-element-old-border-width①\">old border width</a>’s left and top components.</p>"
        },
        {
          "html": "<p>Multiply <var>transform</var> by the inverse matrix of <var>childrenTransform</var>.</p>"
        }
      ]
    },
    {
      "name": "call the update callback",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#call-the-update-callback",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"call-the-update-callback\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">call the update callback</dfn> of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition④⑨\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①⓪\">phase</a> is \"<code>done</code>\", or before \"<code>update-callback-called</code>\".</p>"
        },
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①①\">phase</a> is not \"<code>done</code>\", then set <var>transition</var>’s <span id=\"ref-for-viewtransition-phase①②\">phase</span> to \"<code>update-callback-called</code>\".</p>"
        },
        {
          "html": "<p>Let <var>callbackPromise</var> be null.</p>"
        },
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback\" id=\"ref-for-viewtransition-update-callback③\">update callback</a> is null,\nthen set <var>callbackPromise</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\" id=\"ref-for-a-promise-resolved-with\">a promise resolved with</a> undefined,\nin <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①③\">relevant Realm</a>.</p>"
        },
        {
          "html": "<p>Otherwise, set <var>callbackPromise</var> to the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">invoking</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback\" id=\"ref-for-viewtransition-update-callback④\">update callback</a>.</p>"
        },
        {
          "html": "Let <var>fulfillSteps</var> be to following steps:",
          "rationale": "resolve",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback-done-promise\" id=\"ref-for-viewtransition-update-callback-done-promise④\">update callback done promise</a> with undefined.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#activate-view-transition\" id=\"ref-for-activate-view-transition①\">Activate</a> <var>transition</var>.</p>"
            }
          ]
        },
        {
          "html": "Let <var>rejectSteps</var> be the following steps given <var>reason</var>:",
          "rationale": "reject",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback-done-promise\" id=\"ref-for-viewtransition-update-callback-done-promise⑤\">update callback done promise</a> with <var>reason</var>.</p>"
            },
            {
              "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①③\">phase</a> is \"<code>done</code>\", then return.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#mark-a-promise-as-handled\" id=\"ref-for-mark-a-promise-as-handled③\">Mark as handled</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-ready-promise\" id=\"ref-for-viewtransition-ready-promise③\">ready promise</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①⑥\">Skip the view transition</a> <var>transition</var> with <var>reason</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled\" id=\"ref-for-dfn-perform-steps-once-promise-is-settled\">React</a> to <var>callbackPromise</var> with <var>fulfillSteps</var> and <var>rejectSteps</var>.</p>"
        },
        {
          "html": "To skip a transition after a timeout, the user agent may perform the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for an implementation-defined <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-duration\" id=\"ref-for-dfn-duration①\">duration</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source②\">DOM manipulation task source</a>,\ngiven <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a>, to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①④\">phase</a> is \"<code>done</code>\", then return.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition①⑧\">Skip</a> <var>transition</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#timeouterror\" id=\"ref-for-timeouterror\">TimeoutError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "schedule the update callback",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#schedule-the-update-callback",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"schedule-the-update-callback\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">schedule the update callback</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑤①\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> <var>transition</var> to <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-update-callback-queue\" id=\"ref-for-document-update-callback-queue\">update callback queue</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source③\">DOM manipulation task source</a>,\ngiven <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a>, to <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#flush-the-update-callback-queue\" id=\"ref-for-flush-the-update-callback-queue②\">flush the update callback queue</a>.</p>"
        }
      ]
    },
    {
      "name": "flush the update callback queue",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#flush-the-update-callback-queue",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"flush-the-update-callback-queue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">flush the update callback queue</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document③③\">Document</a></code> <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>transition</var> in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-update-callback-queue\" id=\"ref-for-document-update-callback-queue①\">update callback queue</a>, <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#call-the-update-callback\" id=\"ref-for-call-the-update-callback①\">call the update callback</a> given <var>transition</var>.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-update-callback-queue\" id=\"ref-for-document-update-callback-queue②\">update callback queue</a> to an empty list.</p>"
        }
      ]
    },
    {
      "name": "skip the view transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"skip-the-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">skip the view transition</dfn> for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑤②\">ViewTransition</a></code> <var>transition</var> with reason <var>reason</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑥\">associated document</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①⑤\">phase</a> is not \"<code>done</code>\".</p>"
        },
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①⑥\">phase</a> is before \"<code>update-callback-called</code>\",\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#schedule-the-update-callback\" id=\"ref-for-schedule-the-update-callback①\">schedule the update callback</a> for <var>transition</var>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-rendering-suppression-for-view-transitions\" id=\"ref-for-document-rendering-suppression-for-view-transitions⑤\">rendering suppression for view transitions</a> to false.</p>"
        },
        {
          "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③③\">active view transition</a> is <var>transition</var>,\n<a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#clear-view-transition\" id=\"ref-for-clear-view-transition①\">Clear view transition</a> <var>transition</var>.</p>"
        },
        {
          "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①⑦\">phase</a> to \"<code>done</code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-ready-promise\" id=\"ref-for-viewtransition-ready-promise④\">ready promise</a> with <var>reason</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">Resolve</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-finished-promise\" id=\"ref-for-viewtransition-finished-promise①\">finished promise</a> with the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled\" id=\"ref-for-dfn-perform-steps-once-promise-is-settled①\">reacting</a> to <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-update-callback-done-promise\" id=\"ref-for-viewtransition-update-callback-done-promise⑦\">update callback done promise</a>:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>If the promise was fulfilled, then return undefined.</p>\n      </li></ul>"
        }
      ]
    },
    {
      "name": "view transition page-visibility change steps",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#view-transition-page-visibility-change-steps",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"view-transition-page-visibility-change-steps\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">view transition page-visibility change steps</dfn> given <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document③④\">Document</a></code> <var>document</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source④\">DOM manipulation task source</a>,\n\tgiven <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a>,\n\tto perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-visibility-state①\">visibility state</a> is \"<code>hidden</code>\", then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③④\">active view transition</a> is not null, then <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition②⓪\">skip</a> <var>document</var>’s <span id=\"ref-for-document-active-view-transition③⑤\">active view transition</span> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑥\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">assert</a>: <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③⑥\">active view transition</a> is null.</p>"
            },
            {
              "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-inbound-view-transition-params\" id=\"ref-for-document-inbound-view-transition-params⑤\">inbound view transition params</a> to null.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "capture the image",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#capture-the-image",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"capture the image|capturing the image\" data-noexport=\"\" id=\"capture-the-image\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">capture the image</dfn> given an <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css2/#element\" id=\"ref-for-element②⑥\">element</a> <var>element</var>, perform the following steps.\n\t\tThey return an image.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>element</var> is the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#document-element\" id=\"ref-for-document-element①④\">document element</a>, then:",
          "rationale": "render",
          "steps": [
            {
              "html": "<p>Render the region of document\n(including its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-backgrounds-3/#canvas-background\" id=\"ref-for-canvas-background\">canvas background</a> and any <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-position-4/#document-top-layer\" id=\"ref-for-document-top-layer②\">top layer</a> content)\nthat intersects the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block\" id=\"ref-for-snapshot-containing-block①③\">snapshot containing block</a>,\non a transparent canvas the size of the <span id=\"ref-for-snapshot-containing-block①④\">snapshot containing block</span>,\nfollowing the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-rendering-characteristics\" id=\"ref-for-capture-rendering-characteristics\">capture rendering characteristics</a>, and these additional characteristics:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>Areas outside <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#scrolling-box\" id=\"ref-for-scrolling-box①\">scrolling box</a> should be rendered as if they were scrolled to, without moving or resizing the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#layout-viewport\" id=\"ref-for-layout-viewport\">layout viewport</a>.\nThis must not trigger events related to scrolling or resizing, such as <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/IntersectionObserver/#intersectionobserver\" id=\"ref-for-intersectionobserver\">IntersectionObserver</a></code>s.</p>\n          <figure>\n           \n\t<img alt=\"A phone browser window, showing a URL bar, a fixed-position element directly beneath it, and some page content beneath that. A scroll bar indicates the page has been scrolled significantly.\" height=\"297\" src=\"https://drafts.csswg.org/css-view-transitions-2/diagrams/phone-browser-with-url.svg\" width=\"202\">\n\t<img alt=\"The captured snapshot. It shows that content beneath the URL bar was included in the capture.\" height=\"297\" src=\"https://drafts.csswg.org/css-view-transitions-2/diagrams/phone-browser-without-url.svg\" width=\"202\">\n\t\n           <figcaption>\n\t\tAn example of what the user sees compared to the captured snapshot.\n\t\tThis example assumes the root is the only element with a transition name.\n\t</figcaption>\n          </figure>\n         </li><li data-md=\"\">\n          <p>Areas that cannot be scrolled to (i.e. they are out of scrolling bounds),\nshould render the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-backgrounds-3/#canvas-background\" id=\"ref-for-canvas-background①\">canvas background</a>.</p>\n          <figure>\n           \n\t<img alt=\"A phone browser window, showing a URL bar, and some content beneath. A scroll bar indicates the page is scrolled to the top.\" height=\"297\" src=\"https://drafts.csswg.org/css-view-transitions-2/diagrams/phone-browser-scrolled-to-top-with-url.svg\" width=\"202\">\n\t<img alt=\"The captured snapshot. It shows the area underneath the URL bar as the same color as the rest of the document.\" height=\"297\" src=\"https://drafts.csswg.org/css-view-transitions-2/diagrams/phone-browser-scrolled-to-top-without-url.svg\" width=\"202\">\n\t\n           <figcaption>\n\t\tAn example of what the user sees compared to the captured snapshot.\n\t\tThis example assumes the root is the only element with a transition name.\n\t</figcaption>\n          </figure>\n        </li></ul>"
            },
            {
              "html": "<p>Return this canvas as an image.\nThe natural size of the image is equal to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block\" id=\"ref-for-snapshot-containing-block①⑤\">snapshot containing block</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "render",
          "steps": [
            {
              "html": "<p>Render <var>element</var> and its <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-descendant\" id=\"ref-for-concept-tree-descendant②\">descendants</a>,\nat the same size it appears in its <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document⑨\">node document</a>,\nover an infinite transparent canvas,\nfollowing the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-rendering-characteristics\" id=\"ref-for-capture-rendering-characteristics①\">capture rendering characteristics</a>.</p>"
            },
            {
              "html": "<p>Return the portion of this canvas that includes <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-overflow-3/#ink-overflow-rectangle\" id=\"ref-for-ink-overflow-rectangle\">ink overflow rectangle</a> as an image.\nThe <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-images-3/#natural-dimensions\" id=\"ref-for-natural-dimensions②\">natural dimensions</a> of this image must be those of its <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#principal-box\" id=\"ref-for-principal-box②\">principal</a> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-box-4/#border-box\" id=\"ref-for-border-box④\">border box</a>,\nand its origin must correspond to that <span id=\"ref-for-border-box⑤\">border box</span>’s origin,\nsuch that the image represents the contents of this <span id=\"ref-for-border-box⑥\">border box</span>\nand any captured <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-overflow-3/#ink-overflow\" id=\"ref-for-ink-overflow\">ink overflow</a> is represented outside these bounds.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "delay finish for promise",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#delay-finish-for-promise",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"delay-finish-for-promise\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">delay finish for promise</dfn>, given promise <var>p</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>p</var> is settled, abort the remainder of the steps and return.</p>"
        },
        {
          "html": "<p>Increment <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-wait-until-promise-count\" id=\"ref-for-document-wait-until-promise-count\">wait until promise count</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-fulfillment\" id=\"ref-for-upon-fulfillment\">Upon fulfillment</a> or <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-rejection\" id=\"ref-for-upon-rejection\">rejection</a> of <var>p</var>:",
          "rationale": "decrement",
          "steps": [
            {
              "html": "<p>Decrement <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-wait-until-promise-count\" id=\"ref-for-document-wait-until-promise-count①\">wait until promise count</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "handle transition frame",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#handle-transition-frame",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-transition-frame\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle transition frame</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑤③\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑦\">associated document</a>.</p>"
        },
        {
          "html": "<p>Let <var>hasActiveAnimations</var> be a boolean, initially false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>element</var> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-transition-root-pseudo-element\" id=\"ref-for-viewtransition-transition-root-pseudo-element⑤\">transition root pseudo-element</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-inclusive-descendant\" id=\"ref-for-concept-tree-inclusive-descendant①\">inclusive descendants</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For each <var>animation</var> whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#timeline\" id=\"ref-for-timeline①\">timeline</a> is a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#document-timeline\" id=\"ref-for-document-timeline\">document timeline</a> associated with <var>document</var>,\nand contains at least one <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#animation-associated-effect\" id=\"ref-for-animation-associated-effect\">associated effect</a> whose <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#keyframe-effect-effect-target\" id=\"ref-for-keyframe-effect-effect-target\">effect target</a> is <var>element</var>,\nset <var>hasActiveAnimations</var> to true if any of the following conditions are true:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>animation</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#animation-play-state\" id=\"ref-for-animation-play-state\">play state</a> is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#play-state-paused\" id=\"ref-for-play-state-paused\">paused</a> or <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#play-state-running\" id=\"ref-for-play-state-running\">running</a>.</p>\n         </li><li data-md=\"\">\n          <p><var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/web-animations-1/#pending-animation-event-queue\" id=\"ref-for-pending-animation-event-queue\">pending animation event queue</a> has any events associated with <var>animation</var>.</p>\n        </li></ul>"
            }
          ]
        },
        {
          "html": "If <var>hasActiveAnimations</var> is false and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-wait-until-promise-count\" id=\"ref-for-document-wait-until-promise-count③\">wait until promise count</a> is 0:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-phase\" id=\"ref-for-viewtransition-phase①⑧\">phase</a> to \"<code>done</code>\".</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#clear-view-transition\" id=\"ref-for-clear-view-transition②\">Clear view transition</a> <var>transition</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve④\">Resolve</a> <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-finished-promise\" id=\"ref-for-viewtransition-finished-promise③\">finished promise</a>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-initial-snapshot-containing-block-size\" id=\"ref-for-viewtransition-initial-snapshot-containing-block-size④\">initial snapshot containing block size</a> is not equal to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-size\" id=\"ref-for-snapshot-containing-block-size④\">snapshot containing block size</a>,\nthen <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition②①\">skip the view transition</a> for <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑦\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①④\">relevant Realm</a>,\nand return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#update-pseudo-element-styles\" id=\"ref-for-update-pseudo-element-styles④\">Update pseudo-element styles</a> for <var>transition</var>.</p>\n      <p>If failure is returned, then <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#skip-the-view-transition\" id=\"ref-for-skip-the-view-transition②②\">skip the view transition</a> for <var>transition</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑧\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code> in <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⑤\">relevant Realm</a>,\nand return.</p>"
        }
      ]
    },
    {
      "name": "update pseudo-element styles",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#update-pseudo-element-styles",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-pseudo-element-styles\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update pseudo-element styles</dfn> for a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑤④\">ViewTransition</a></code> <var>transition</var>:\n\n\n    \n    <p>This algorithm must be executed to update styles in <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#cascade-origin-ua\" id=\"ref-for-cascade-origin-ua③\">user-agent origin</a> if its effects can be observed by a web API.</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">For each</a> <var>transitionName</var> → <var>capturedElement</var> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements⑨\">named elements</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>width</var>, <var>height</var>, <var>transform</var>, <var>writingMode</var>, <var>direction</var>, <var>textOrientation</var>, <var>mixBlendMode</var>, <var>backdropFilter</var> and <var>colorScheme</var> be null.</p>"
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element⑧\">new element</a> is null, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>width</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-width\" id=\"ref-for-captured-element-old-width②\">old width</a>.</p>"
                },
                {
                  "html": "<p>Set <var>height</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-height\" id=\"ref-for-captured-element-old-height②\">old height</a>.</p>"
                },
                {
                  "html": "<p>Set <var>transform</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-transform\" id=\"ref-for-captured-element-old-transform③\">old transform</a>.</p>"
                },
                {
                  "html": "<p>Set <var>writingMode</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-writing-mode\" id=\"ref-for-captured-element-old-writing-mode①\">old writing-mode</a>.</p>"
                },
                {
                  "html": "<p>Set <var>direction</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-direction\" id=\"ref-for-captured-element-old-direction①\">old direction</a>.</p>"
                },
                {
                  "html": "<p>Set <var>textOrientation</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-text-orientation\" id=\"ref-for-captured-element-old-text-orientation①\">old text-orientation</a>.</p>"
                },
                {
                  "html": "<p>Set <var>mixBlendMode</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-mix-blend-mode\" id=\"ref-for-captured-element-old-mix-blend-mode①\">old mix-blend-mode</a>.</p>"
                },
                {
                  "html": "<p>Set <var>backdropFilter</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-backdrop-filter\" id=\"ref-for-captured-element-old-backdrop-filter②\">old backdrop-filter</a>.</p>"
                },
                {
                  "html": "<p>Set <var>colorScheme</var> to <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-old-color-scheme\" id=\"ref-for-captured-element-old-color-scheme①\">old color-scheme</a>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return failure if any of the following conditions are true:</p>\n          <ul>\n           <li data-md=\"\">\n            <p><var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element⑨\">new element</a> has a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-shadow-1/#flat-tree\" id=\"ref-for-flat-tree⑨\">flat tree</a> ancestor that <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-contain-2/#skips-its-contents\" id=\"ref-for-skips-its-contents③\">skips its contents</a>.</p>\n           </li><li data-md=\"\">\n            <p><var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⓪\">new element</a> is <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-images-4/#element-not-rendered\" id=\"ref-for-element-not-rendered④\">not rendered</a>.</p>\n           </li><li data-md=\"\">\n            <p><var>capturedElement</var> has more than one <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-break-4/#box-fragment\" id=\"ref-for-box-fragment③\">box fragment</a>.</p>\n          </li></ul>"
                },
                {
                  "html": "<p>Let <var>newRect</var> be the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block\" id=\"ref-for-snapshot-containing-block①⑧\">snapshot containing block</a> if <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①②\">new element</a> is the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#document-element\" id=\"ref-for-document-element①⑤\">document element</a>,\notherwise, <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-box-4/#border-box\" id=\"ref-for-border-box⑦\">border box</a>.</p>"
                },
                {
                  "html": "<p>Set <var>width</var> to the current width of <var>newRect</var>.</p>"
                },
                {
                  "html": "<p>Set <var>height</var> to the current height of <var>newRect</var>.</p>"
                },
                {
                  "html": "<p>Set <var>transform</var> to a transform that would map <var>newRect</var> from the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#snapshot-containing-block-origin\" id=\"ref-for-snapshot-containing-block-origin①\">snapshot containing block origin</a> to its current visual position.</p>"
                },
                {
                  "html": "<p>Set <var>writingMode</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⑥\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-4/#propdef-writing-mode\" id=\"ref-for-propdef-writing-mode②\">writing-mode</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①③\">new element</a>.</p>"
                },
                {
                  "html": "<p>Set <var>direction</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⑦\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-3/#propdef-direction\" id=\"ref-for-propdef-direction②\">direction</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①④\">new element</a>.</p>"
                },
                {
                  "html": "<p>Set <var>textOrientation</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⑧\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-writing-modes-4/#propdef-text-orientation\" id=\"ref-for-propdef-text-orientation②\">text-orientation</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⑤\">new element</a>.</p>"
                },
                {
                  "html": "<p>Set <var>mixBlendMode</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value①⑨\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/compositing-2/#propdef-mix-blend-mode\" id=\"ref-for-propdef-mix-blend-mode④\">mix-blend-mode</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⑥\">new element</a>.</p>"
                },
                {
                  "html": "<p>Set <var>backdropFilter</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value②⓪\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/filter-effects-2/#propdef-backdrop-filter\" id=\"ref-for-propdef-backdrop-filter②\">backdrop-filter</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⑦\">new element</a>.</p>"
                },
                {
                  "html": "<p>Set <var>colorScheme</var> to the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-cascade-5/#computed-value\" id=\"ref-for-computed-value②①\">computed value</a> of <a class=\"css property\" data-link-type=\"property\" href=\"https://drafts.csswg.org/css-color-adjust-1/#propdef-color-scheme\" id=\"ref-for-propdef-color-scheme②\">color-scheme</a> on <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⑧\">new element</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-group-styles-rule\" id=\"ref-for-captured-element-group-styles-rule①\">group styles rule</a> is null,\nthen set <var>capturedElement</var>’s <span id=\"ref-for-captured-element-group-styles-rule②\">group styles rule</span> to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/cssom-1/#cssstylerule\" id=\"ref-for-cssstylerule⑨\">CSSStyleRule</a></code> representing the following CSS,\nand append it to <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑧\">associated document</a>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet①①\">dynamic view transition style sheet</a>.</p>\n        <p>Otherwise, update <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-group-styles-rule\" id=\"ref-for-captured-element-group-styles-rule③\">group styles rule</a> to match the following CSS:</p>\n<pre class=\"highlight\">:root::view-transition-group<c- p=\"\">(</c-><var>transitionName</var><c- p=\"\">)</c-> <c- p=\"\">{</c->\n  <c- k=\"\">width</c-><c- p=\"\">:</c-> <var>width</var><c- p=\"\">;</c->\n  <c- k=\"\">height</c-><c- p=\"\">:</c-> <var>height</var><c- p=\"\">;</c->\n  <c- k=\"\">transform</c-><c- p=\"\">:</c-> <var>transform</var><c- p=\"\">;</c->\n  <c- k=\"\">writing-mode</c-><c- p=\"\">:</c-> <var>writingMode</var><c- p=\"\">;</c->\n  <c- k=\"\">direction</c-><c- p=\"\">:</c-> <var>direction</var><c- p=\"\">;</c->\n  <c- k=\"\">text-orientation</c-><c- p=\"\">:</c-> <var>textOrientation</var><c- p=\"\">;</c->\n  <c- k=\"\">mix-blend-mode</c-><c- p=\"\">:</c-> <var>mixBlendMode</var><c- p=\"\">;</c->\n  <c- k=\"\">backdrop-filter</c-><c- p=\"\">:</c-> <var>backdropFilter</var><c- p=\"\">;</c->\n  <c- k=\"\">color-scheme</c-><c- p=\"\">:</c-> <var>colorScheme</var><c- p=\"\">;</c->\n<c- p=\"\">}</c->\n</pre>"
            },
            {
              "html": "If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element①⑨\">new element</a> is not null, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>new</var> be the <a class=\"css\" data-link-type=\"maybe\" href=\"https://drafts.csswg.org/css-view-transitions-2/#selectordef-view-transition-new\" id=\"ref-for-selectordef-view-transition-new①①\">::view-transition-new()</a> with the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#view-transition-name\" id=\"ref-for-view-transition-name②⓪\">view transition name</a> <var>transitionName</var>.</p>"
                },
                {
                  "html": "<p>Set <var>new</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-display-4/#replaced-element\" id=\"ref-for-replaced-element④\">replaced element</a> content to the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#capture-the-image\" id=\"ref-for-capture-the-image⑥\">capturing the image</a> of <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element②⓪\">new element</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "clear view transition",
      "href": "https://drafts.csswg.org/css-view-transitions-2/#clear-view-transition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clear-view-transition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clear view transition</dfn> of a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition\" id=\"ref-for-viewtransition⑤⑤\">ViewTransition</a></code> <var>transition</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object’s</a> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑨\">associated document</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③⑦\">active view transition</a> is <var>transition</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">For each</a> <var>capturedElement</var> of <var>transition</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#viewtransition-named-elements\" id=\"ref-for-viewtransition-named-elements①⓪\">named elements</a>' <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①\">values</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-new-element\" id=\"ref-for-captured-element-new-element②①\">new element</a> is not null,\nthen set <var>capturedElement</var>’s <span id=\"ref-for-captured-element-new-element②②\">new element</span>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-in-a-view-transition\" id=\"ref-for-captured-in-a-view-transition①⓪\">captured in a view transition</a> to false.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>style</var> of <var>capturedElement</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#captured-element-style-definitions\" id=\"ref-for-captured-element-style-definitions\">style definitions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>style</var> is not null,\nand <var>style</var> is in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-dynamic-view-transition-style-sheet\" id=\"ref-for-document-dynamic-view-transition-style-sheet①②\">dynamic view transition style sheet</a>,\nthen remove <var>style</var> from <var>document</var>’s <span id=\"ref-for-document-dynamic-view-transition-style-sheet①③\">dynamic view transition style sheet</span>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-show-view-transition-tree\" id=\"ref-for-document-show-view-transition-tree①\">show view transition tree</a> to false.</p>"
        },
        {
          "html": "<p>Set <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-view-transitions-2/#document-active-view-transition\" id=\"ref-for-document-active-view-transition③⑧\">active view transition</a> to null.</p>"
        }
      ]
    }
  ]
}