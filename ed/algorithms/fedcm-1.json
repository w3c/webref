{
  "spec": {
    "title": "Federated Credential Management API",
    "url": "https://w3c-fedid.github.io/FedCM/"
  },
  "algorithms": [
    {
      "name": "compute the connected account key",
      "href": "https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-connected-account-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the connected account key</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig\">IdentityProviderConfig</a></code> <var>provider</var>, an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount\">IdentityProviderAccount</a></code> <var>account</var>, and a <var>globalObject</var>, run the following steps. It returns a\nquadruple of the form (embedder, rp, idp, account).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url\">parse url</a> with <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Let <var>embedderOrigin</var> be the <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable\">navigable</a>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>idpOrigin</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a> corresponding to <var>configUrl</var>.</p>"
        },
        {
          "html": "<p>Let <var>rpOrigin</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>accountId</var> be <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-id\" id=\"ref-for-dom-identityprovideraccount-id\">id</a></code>.</p>"
        },
        {
          "html": "<p>Return (<var>embedderOrigin</var>, <var>rpOrigin</var>, <var>idpOrigin</var>, <var>accountId</var>).</p>"
        }
      ]
    },
    {
      "name": "eligible for auto reauthentication",
      "href": "https://w3c-fedid.github.io/FedCM/#eligible-for-auto-reauthentication",
      "html": "When asked whether an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount①\">IdentityProviderAccount</a></code> <var>account</var> is\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"eligible-for-auto-reauthentication\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">eligible for auto reauthentication</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig①\">IdentityProviderConfig</a></code> <var>provider</var> and a\n<var>globalObject</var>, run the following steps. This returns a boolean.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>account</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">contains</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-approved_clients\" id=\"ref-for-dom-identityprovideraccount-approved_clients\">approved_clients</a></code> and\n<var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-approved_clients\" id=\"ref-for-dom-identityprovideraccount-approved_clients①\">approved_clients</a></code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contain</a>\n<var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-clientid\" id=\"ref-for-dom-identityproviderconfig-clientid\">clientId</a></code>, return false.</p>"
        },
        {
          "html": "<p>Let <var>tuple</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key\" id=\"ref-for-compute-the-connected-account-key\">compute the connected account key</a> given <var>provider</var>,\n<var>account</var>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Return whether <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set①\">connected accounts set</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> <var>tuple</var>.</p>"
        }
      ]
    },
    {
      "name": "compute the connection status",
      "href": "https://w3c-fedid.github.io/FedCM/#compute-the-connection-status",
      "html": "When asked to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-connection-status\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute the connection status</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount②\">IdentityProviderAccount</a></code>\n<var>account</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig②\">IdentityProviderConfig</a></code> <var>provider</var> and a <var>globalObject</var>, run the following steps.\nThis returns <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"compute the connection status\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-connection-status-connected\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">connected</dfn> or\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"compute the connection status\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-the-connection-status-disconnected\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">disconnected</dfn>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>account</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">contains</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-approved_clients\" id=\"ref-for-dom-identityprovideraccount-approved_clients②\">approved_clients</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-approved_clients\" id=\"ref-for-dom-identityprovideraccount-approved_clients③\">approved_clients</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a><var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-clientid\" id=\"ref-for-dom-identityproviderconfig-clientid①\">clientId</a></code>, return <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connection-status-connected\" id=\"ref-for-compute-the-connection-status-connected\">connected</a>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connection-status-disconnected\" id=\"ref-for-compute-the-connection-status-disconnected\">disconnected</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>tuple</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key\" id=\"ref-for-compute-the-connected-account-key①\">compute the connected account key</a> given <var>provider</var>,\n<var>account</var>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set②\">connected accounts set</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a> <var>tuple</var>, return\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connection-status-connected\" id=\"ref-for-compute-the-connection-status-connected①\">connected</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connection-status-disconnected\" id=\"ref-for-compute-the-connection-status-disconnected①\">disconnected</a>.</p>"
        }
      ]
    },
    {
      "name": "create a connection between the RP and the IdP account",
      "href": "https://w3c-fedid.github.io/FedCM/#create-a-connection-between-the-rp-and-the-idp-account",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-connection-between-the-rp-and-the-idp-account\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a connection between the RP and the IdP account</dfn> given an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig③\">IdentityProviderConfig</a></code> <var>provider</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount③\">IdentityProviderAccount</a></code> <var>account</var>, and a\n<var>globalObject</var> (the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#rp\" id=\"ref-for-rp⑨\">RP</a>’s), run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url①\">parse url</a> with <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl①\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Let <var>embedderOrigin</var> be the <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①\">navigable</a>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top②\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin②\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>idpOrigin</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a> corresponding to <var>configUrl</var>.</p>"
        },
        {
          "html": "<p>Let <var>rpOrigin</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin③\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>accountId</var> be <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-id\" id=\"ref-for-dom-identityprovideraccount-id①\">id</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>tuple</var> be (<var>embedderOrigin</var>, <var>rpOrigin</var>, <var>idpOrigin</var>, <var>accountId</var>).</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>tuple</var> to <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set③\">connected accounts set</a>.</p>"
        }
      ]
    },
    {
      "name": "remove a connection",
      "href": "https://w3c-fedid.github.io/FedCM/#remove-a-connection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-a-connection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove a connection</dfn>: given <var>accountId</var>, <var>embedderOrigin</var>, <var>rpOrigin</var>, and <var>idpOrigin</var>,\nrun the following steps. It returns whether the <var>accountId</var> connection was successfully removed.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>tuple</var> be (<var>embedderOrigin</var>, <var>rpOrigin</var>, <var>idpOrigin</var>, <var>accountId</var>).</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set④\">connected accounts set</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contains</a> <var>tuple</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">Remove</a> <var>tuple</var> from the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set⑤\">connected accounts set</a>.</p>"
            },
            {
              "html": "<p>Return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "remove all connections",
      "href": "https://w3c-fedid.github.io/FedCM/#remove-all-connections",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-all-connections\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove all connections</dfn>: given <var>embedderOrigin</var>, <var>rpOrigin</var> and <var>idpOrigin</var>, run the\nfollowing steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For every (<var>embedder</var>, <var>rp</var>, <var>idp</var>, <var>accountId</var>) <var>tuple</var> in the\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set⑥\">connected accounts set</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>embedder</var> equals <var>embedderOrigin</var>, <var>rp</var> equals <var>rpOrigin</var>, and <var>idp</var> equals\n<var>idpOrigin</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">remove</a> <var>tuple</var> from the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set⑦\">connected accounts set</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "identity-credential-disconnect",
      "html": "When the static <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredential-disconnect\" id=\"ref-for-dom-identitycredential-disconnect\">disconnect</a></code> method is invoked, given an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identitycredentialdisconnectoptions\" id=\"ref-for-dictdef-identitycredentialdisconnectoptions①\">IdentityCredentialDisconnectOptions</a></code> <var>options</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>globalObject</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object\">current global object</a>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use\">allowed to use</a> the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#identity-credentials-get\" id=\"ref-for-identity-credentials-get\">identity-credentials-get</a>\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature\">policy-controlled feature</a>, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise①\">Promise</a></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">In parallel</a>, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#attempt-to-disconnect\" id=\"ref-for-attempt-to-disconnect\">attempt to disconnect</a> given <var>options</var>, <var>promise</var>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "attempt to disconnect",
      "href": "https://w3c-fedid.github.io/FedCM/#attempt-to-disconnect",
      "html": "When asked to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"attempt-to-disconnect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attempt to disconnect</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identitycredentialdisconnectoptions\" id=\"ref-for-dictdef-identitycredentialdisconnectoptions②\">IdentityCredentialDisconnectOptions</a></code>\n<var>options</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise②\">Promise</a></code> <var>promise</var>, and a <var>globalObject</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url②\">parse url</a> with <var>options</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl②\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>configUrl</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\"\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Run a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-csp/\"><cite>Content Security Policy Level 3</cite></a> check with a <a href=\"https://w3c.github.io/webappsec-csp/#directive-connect-src\">connect-src</a> directive on the URL\npassed as <var>configUrl</var>. If it fails, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\"\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If there is another pending <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredential-disconnect\" id=\"ref-for-dom-identitycredential-disconnect①\">disconnect</a></code> call for this <var>globalObject</var>\n(e.g., it has not yet thrown an exception or its associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise③\">Promise</a></code> has not yet been\nresolved), <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>configUrl</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-origin\" id=\"ref-for-potentially-trustworthy-origin\">potentially trustworthy origin</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror②\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If the user has disabled the FedCM API on the <var>globalObject</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror③\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If there does not exist an account <var>account</var> such that <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set⑧\">connected accounts set</a>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contains</a> the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key\" id=\"ref-for-compute-the-connected-account-key②\">compute the connected account key</a> given <var>account</var>,\n<var>options</var>, and <var>globalObject</var>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror④\">NetworkError</a></code>\"\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>. This check can be performed by iterating over the\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set⑨\">connected accounts set</a> or by keeping a separate data structure to make this lookup fast.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-config-file\" id=\"ref-for-fetch-the-config-file\">fetch the config file</a> with <var>options</var> and\n<var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>config</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑤\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>disconnectUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url\">computing the manifest URL</a> given <var>options</var>,\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-disconnect_endpoint\" id=\"ref-for-dom-identityproviderapiconfig-disconnect_endpoint\">disconnect_endpoint</a></code>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>disconnectUrl</var> is failure, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑥\">NetworkError</a></code>\"\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#send-a-disconnect-request\" id=\"ref-for-send-a-disconnect-request\">Send a disconnect request</a> with <var>disconnectUrl</var>, <var>options</var>, and <var>globalObject</var>, and let\n<var>result</var> be the result.</p>"
        },
        {
          "html": "<p>Let <var>idpOrigin</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a> corresponding to <var>configUrl</var>.</p>"
        },
        {
          "html": "<p>Let <var>rpOrigin</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated Document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin④\">origin</a>.</p>"
        },
        {
          "html": "<p>Let <var>embedderOrigin</var> be the <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable②\">navigable</a>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top③\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin⑤\">origin</a>.</p>"
        },
        {
          "html": "If <var>result</var> is failure:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#remove-all-connections\" id=\"ref-for-remove-all-connections\">Remove all connections</a> given <var>embedderOrigin</var>, <var>rpOrigin</var>, and <var>idpOrigin</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">Reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑦\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>accountId</var> be <var>result</var> (note that it is not failure).\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top④\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document③\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin⑥\">origin</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#remove-a-connection\" id=\"ref-for-remove-a-connection\">Remove a connection</a> using <var>accountId</var>, <var>embedderOrigin</var>, <var>rpOrigin</var>, and <var>idpOrigin</var>, and\nlet <var>wasAccountRemoved</var> be the result.</p>"
        },
        {
          "html": "<p>If <var>wasAccountRemoved</var> is false, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#remove-all-connections\" id=\"ref-for-remove-all-connections①\">remove all connections</a> given <var>embedderOrigin</var>,\n<var>rpOrigin</var> and <var>idpOrigin</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "send a disconnect request",
      "href": "https://w3c-fedid.github.io/FedCM/#send-a-disconnect-request",
      "html": "When asked to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-a-disconnect-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send a disconnect request</dfn>, given a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url\">URL</a>\n<var>disconnectUrl</var>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identitycredentialdisconnectoptions\" id=\"ref-for-dictdef-identitycredentialdisconnectoptions③\">IdentityCredentialDisconnectOptions</a></code> <var>options</var>, and a <var>globalObject</var>,\nperform the following steps. This returns an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString②\">USVString</a></code> or failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>requestBody</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlencoded-serializer\" id=\"ref-for-concept-urlencoded-serializer\">urlencoded serializer</a> with a list containing:</p>",
          "ignored": [
            "(\"client_id\", options’s clientId) (\"account_hint\", options’s accountHint)"
          ]
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request\">request</a> as follows:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">url</a>\n       </dt><dd data-md=\"\">\n        <p><var>disconnectUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a>\n       </dt><dd data-md=\"\">\n        <p>\"POST\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a>\n       </dt><dd data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">UTF-8 encode</a> of <var>requestBody</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"error\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"none\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination\">destination</a>\n       </dt><dd data-md=\"\">\n        <p>\"webidentity\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin⑦\">origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> containing a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header\">header</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name\">name</a> set to <code>Accept</code> and\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value\">value</a> set to <code>application/x-www-form-urlencoded</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"include\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"cors\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>accountId</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request\">Fetch request</a> with <var>request</var> and <var>globalObject</var>, and with\n<var>processResponseConsumeBody</var> set to the following steps given a\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a> <var>response</var> and <var>responseBody</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response\" id=\"ref-for-extract-the-json-fetch-response\">extract the JSON fetch response</a> from <var>response</var> and\n<var>responseBody</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value\">Convert</a> <var>json</var> to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-disconnectedaccount\" id=\"ref-for-dictdef-disconnectedaccount\">DisconnectedAccount</a></code>, <var>account</var>.</p>"
            },
            {
              "html": "<p>If one of the previous two steps threw an exception, set <var>accountId</var> to failure\nand return.</p>"
            },
            {
              "html": "<p>Set <var>accountId</var> to <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-disconnectedaccount-account_id\" id=\"ref-for-dom-disconnectedaccount-account_id\">account_id</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>accountId</var> to be set.</p>"
        },
        {
          "html": "<p>Return <var>accountId</var>.</p>"
        }
      ]
    },
    {
      "name": "create an IdentityCredentialError",
      "href": "https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-an-identitycredentialerror\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an IdentityCredentialError</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identitycredentialerrorinit\" id=\"ref-for-dictdef-identitycredentialerrorinit①\">IdentityCredentialErrorInit</a></code> <var>options</var>\nand a <var>globalObject</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>error</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredentialerror\" id=\"ref-for-identitycredentialerror①\">IdentityCredentialError</a></code> with <var>globalObject</var>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>error</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-message\" id=\"ref-for-dom-domexception-message\">message</a></code> to \"IdentityCredentialError\".</p>"
        },
        {
          "html": "<p>Set <var>error</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error\">error</a></code> to <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error①\">error</a></code>\nif it is present in <var>options</var>, or to \"\" otherwise.</p>"
        },
        {
          "html": "<p>Set <var>error</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-url\" id=\"ref-for-dom-identitycredentialerror-url\">url</a></code> to <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-url\" id=\"ref-for-dom-identitycredentialerror-url①\">url</a></code>\nif it is present in <var>options</var>, or to \"\" otherwise.</p>"
        },
        {
          "html": "<p>Return <var>error</var>.</p>"
        }
      ]
    },
    {
      "name": "IdentityCredentialError constructor",
      "html": "Given a <var>realm</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString③\">DOMString</a></code> <var>message</var>, and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identitycredentialerrorinit\" id=\"ref-for-dictdef-identitycredentialerrorinit②\">IdentityCredentialErrorInit</a></code> <var>options</var>, the\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-identitycredentialerror\" id=\"ref-for-dom-identitycredentialerror-identitycredentialerror\">IdentityCredentialError()</a></code> must run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Invoke the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#dom-domexception-domexception\" id=\"ref-for-dom-domexception-domexception\">DOMException()</a></code>, passing <var>realm</var> and <var>message</var>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error②\">error</a></code> to <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error③\">error</a></code>\nif it is present in <var>options</var>, or to \"\" otherwise.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-url\" id=\"ref-for-dom-identitycredentialerror-url②\">url</a></code> to <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-url\" id=\"ref-for-dom-identitycredentialerror-url③\">url</a></code>\nif it is present in <var>options</var>, or to \"\" otherwise.</p>"
        }
      ]
    },
    {
      "name": "[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)",
      "href": "https://w3c-fedid.github.io/FedCM/#dom-identitycredential-discoverfromexternalsource-slot",
      "html": "When the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredential\" id=\"ref-for-identitycredential⑦\">IdentityCredential</a></code>’s\n<dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"IdentityCredential\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-identitycredential-discoverfromexternalsource-slot\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</code></dfn>\nalgorithm is invoked, the user agent MUST execute the following steps. This returns an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredential\" id=\"ref-for-identitycredential⑧\">IdentityCredential</a></code> or throws an error to the caller.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: These steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If\n<var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-credentialrequestoptions-identity\" id=\"ref-for-dom-credentialrequestoptions-identity①\">identity</a></code>\"][\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptions-providers\" id=\"ref-for-dom-identitycredentialrequestoptions-providers\">providers</a></code>\"]\nis <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">empty</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source\">DOM manipulation task source</a> given\n<var>globalObject</var> to throw a new \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑧\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>providerList</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-credentialrequestoptions-identity\" id=\"ref-for-dom-credentialrequestoptions-identity②\">identity</a></code>\"][\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptions-providers\" id=\"ref-for-dom-identitycredentialrequestoptions-providers①\">providers</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>credential</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredential\" id=\"ref-for-create-an-identitycredential\">create an IdentityCredential</a> with <var>providerList</var>,\n<var>options</var>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "If <var>credential</var> is a pair:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>throwImmediately</var> be the value of the second element of the pair.</p>"
            },
            {
              "html": "<p>The user agent SHOULD wait a random amount of time\nbefore the next step if all of the following conditions hold:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><var>throwImmediately</var> is false</p>\n         </li><li data-md=\"\">\n          <p>The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"promise-rejection-delay\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">promise rejection delay</dfn> was not disabled by\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#setdelayenabled\" id=\"ref-for-setdelayenabled\">user agent automation</a></p>\n         </li><li data-md=\"\">\n          <p>The user agent has not implemented another way to prevent\nexposing to the RP whether the user has an account logged\nin to the RP</p>\n        </li></ul>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source①\">DOM manipulation task source</a>\nto throw a new \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror⑨\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①④\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, return <var>credential</var> (this may throw, since it may be an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredentialerror\" id=\"ref-for-identitycredentialerror②\">IdentityCredentialError</a></code>).</p>"
        }
      ]
    },
    {
      "name": "create an IdentityCredential",
      "href": "https://w3c-fedid.github.io/FedCM/#create-an-identitycredential",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-an-identitycredential\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an IdentityCredential</dfn> given a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence②\">sequence</a> of\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderrequestoptions\" id=\"ref-for-dictdef-identityproviderrequestoptions①\">IdentityProviderRequestOptions</a></code> <var>providerList</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dictdef-credentialrequestoptions\" id=\"ref-for-dictdef-credentialrequestoptions③\">CredentialRequestOptions</a></code> <var>options</var>, and a\n<var>globalObject</var>, run the following steps. This returns an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredential\" id=\"ref-for-identitycredential①⓪\">IdentityCredential</a></code>, an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredentialerror\" id=\"ref-for-identitycredentialerror③\">IdentityCredentialError</a></code>, or a pair (failure, bool), where the bool indicates whether to throw\nthe exception immediately.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: These steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>mode</var> be <var>options</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptions-mode\" id=\"ref-for-dom-identitycredentialrequestoptions-mode\">mode</a></code>.</p>"
        },
        {
          "html": "If <var>mode</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptionsmode-active\" id=\"ref-for-dom-identitycredentialrequestoptionsmode-active\">active</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>providerList</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> is not equal to 1, return (failure, true).</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>globalObject</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code>.</p>"
            },
            {
              "html": "<p>If <var>globalObject</var> does not have <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation\">transient activation</a>, return (failure, true).</p>"
            },
            {
              "html": "<p>Otherwise, if there is a pending request where <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#enumdef-identitycredentialrequestoptionsmode\" id=\"ref-for-enumdef-identitycredentialrequestoptionsmode②\">IdentityCredentialRequestOptionsMode</a></code> is\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptionsmode-passive\" id=\"ref-for-dom-identitycredentialrequestoptionsmode-passive\">passive</a></code> on <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable③\">navigable</a>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑤\">top-level traversable</a> or on any of its descendants, reject the pending\nrequest with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⓪\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑤\">DOMException</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>The user agent MAY wait an arbitrary amount of time before continuing with the next steps.\nThe user agent MAY also return (failure, false) at this point or after some arbitrary wait.\nThe user agent MAY also set <var>providerList</var> to a subset of itself after some arbitrary wait.</p>"
        },
        {
          "html": "<p>Let <var>mediation</var> be <var>options</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-mediation\" id=\"ref-for-dom-credentialrequestoptions-mediation\">mediation</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>providerMap</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map\">map</a>.</p>"
        },
        {
          "html": "For each <var>provider</var> in <var>providerList</var>:\nNote: The fetches performed in these steps to populate <var>providerMap</var> can be performed at the\n    same time, e.g., the second <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#idp\" id=\"ref-for-idp①④\">IDP</a>’s fetches can be started before the first ones finish,\n    since these are indepedent.",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>providerOrigin</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin③\">origin</a> of <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl④\">configURL</a></code>.</p>"
            },
            {
              "html": "<p>If <var>providerMap</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">contains</a> <var>providerOrigin</var>, return (failure, true).</p>"
            },
            {
              "html": "<p>If <var>mediation</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-silent\" id=\"ref-for-dom-credentialmediationrequirement-silent\">silent</a></code>\" and there does not exist an\naccount <var>account</var> such that <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set①⓪\">connected accounts set</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑥\">contains</a> the result of\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key\" id=\"ref-for-compute-the-connected-account-key③\">compute the connected account key</a> given <var>account</var>, <var>provider</var>, and <var>globalObject</var>,\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>. Note that this check can be performed by iterating over the\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set①①\">connected accounts set</a> or by keeping a separate data structure to make this lookup\nfast.</p>"
            },
            {
              "html": "<p>Let <var>loginStatus</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#get-the-login-status\" id=\"ref-for-get-the-login-status\">get the login status</a> with <var>providerOrigin</var>.</p>"
            },
            {
              "html": "<p>If <var>loginStatus</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#unknown\" id=\"ref-for-unknown\">unknown</a>, a user agent MAY set it to <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-out\" id=\"ref-for-logged-out\">logged-out</a>.</p>"
            },
            {
              "html": "If <var>loginStatus</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-out\" id=\"ref-for-logged-out①\">logged-out</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>mode</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptionsmode-active\" id=\"ref-for-dom-identitycredentialrequestoptionsmode-active①\">active</a></code> and <var>mediation</var> is not\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-silent\" id=\"ref-for-dom-credentialmediationrequirement-silent①\">silent</a></code>\":",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>result</var> be the result of running\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-config-file-and-show-an-idp-login-dialog\" id=\"ref-for-fetch-the-config-file-and-show-an-idp-login-dialog\">fetch the config file and show an IDP login dialog</a> with\n<var>provider</var> and <var>globalObject</var>.</p>"
                    },
                    {
                      "html": "<p>If <var>result</var> is failure, return (failure, true).</p>"
                    },
                    {
                      "html": "<p>Otherwise, set <var>loginStatus</var> to <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-in\" id=\"ref-for-logged-in\">logged-in</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Otherwise, set <var>providerMap</var>[<var>providerOrigin</var>] to \"logged-out\" and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>requiresUserMediation</var> be <var>providerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-credential-management/#origin-requires-user-mediation\" id=\"ref-for-origin-requires-user-mediation\">requires user mediation</a>.</p>"
            },
            {
              "html": "<p>If <var>requiresUserMediation</var> is true and <var>mediation</var> is\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-silent\" id=\"ref-for-dom-credentialmediationrequirement-silent②\">silent</a></code>\", <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>config</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-config-file\" id=\"ref-for-fetch-the-config-file①\">fetch the config file</a> with\n<var>provider</var> and <var>globalObject</var>.</p>"
            },
            {
              "html": "<p>If <var>config</var> is failure, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-fetch-accounts\" id=\"ref-for-create-identity-credential-fetch-accounts\">Fetch accounts</a> given <var>config</var>, <var>provider</var>, and <var>globalObject</var>, and let <var>accountsList</var>\nbe the result.</p>"
            },
            {
              "html": "If <var>accountsList</var> is empty:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>loginStatus</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-in\" id=\"ref-for-logged-in①\">logged-in</a> and <var>mediation</var> is not\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-silent\" id=\"ref-for-dom-credentialmediationrequirement-silent③\">silent</a></code>, set <var>providerMap</var>[<var>providerOrigin</var>] to\n\"mismatch\".</p>"
                },
                {
                  "html": "<p>Otherwise, set <var>providerMap</var>[<var>providerOrigin</var>] to \"logged-out\".</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, set <var>providerMap</var>[<var>providerOrigin</var>] to <var>accountsList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>providerMap</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty\">is empty</a>, return (failure, false).</p>"
        },
        {
          "html": "<p>Let <var>registeredAccount</var> and <var>numRegisteredAccounts</var> be null and 0, respectively.</p>"
        },
        {
          "html": "<p>Let <var>selectedAccount</var> be null.</p>"
        },
        {
          "html": "For each (<var>providerOrigin</var>, <var>value</var>) in <var>providerMap</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a> <var>accountsList</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "For each <var>acc</var> in <var>accountsList</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>acc</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#eligible-for-auto-reauthentication\" id=\"ref-for-eligible-for-auto-reauthentication\">eligible for auto reauthentication</a> given the relevant <var>provider</var>, and\n<var>globalObject</var>, set <var>registeredAccount</var> to <var>acc</var>, increase <var>numRegisteredAccounts</var> by 1,\nand set <var>requiresUserMediation</var> be <var>providerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-credential-management/#origin-requires-user-mediation\" id=\"ref-for-origin-requires-user-mediation①\">requires user mediation</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>permission</var>, <var>permissionRequested</var>, and <var>isAutoSelected</var> be set to false.</p>"
        },
        {
          "html": "If <var>mediation</var> is not \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-required\" id=\"ref-for-dom-credentialmediationrequirement-required\">required</a></code>\", <var>requiresUserMediation</var>\nis false, <var>numRegisteredAccounts</var> is equal to 1, and <var>providerMap</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">values</a> do not\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">contain</a> \"mismatch\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>selectedAccount</var> to <var>registeredAccount</var>, and set <var>permission</var> and <var>isAutoSelected</var> to\ntrue. When doing this, the user agent MAY show some UI to the user indicating that they\nare being <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"auto-reauthenticated\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">auto-reauthenticated</dfn>. Go to the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-wait-for-user-step\" id=\"ref-for-create-identity-credential-wait-for-user-step\">wait for user step</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise, if <var>mediation</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-silent\" id=\"ref-for-dom-credentialmediationrequirement-silent④\">silent</a></code>\":",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p>Assert that <var>providerMap</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①\">values</a> do not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">contain</a> \"mismatch\".</p>"
            },
            {
              "html": "<p>Return (failure, false).</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>allAccounts</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a>.</p>"
        },
        {
          "html": "Build UI by adding the following for each (<var>providerOrigin</var>, <var>value</var>) in <var>providerMap</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "Prompt the user whether to continue with this <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#idp\" id=\"ref-for-idp①⑥\">IDP</a>. If the user continues:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>result</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#show-an-idp-login-dialog\" id=\"ref-for-show-an-idp-login-dialog\">show an IDP login dialog</a> with the\nrelevant <var>config</var>, <var>provider</var>, and <var>globalObject</var>.</p>"
                },
                {
                  "html": "<p>If <var>result</var> is failure, return (failure, true).</p>"
                }
              ]
            },
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#show-an-idp-login-dialog\" id=\"ref-for-show-an-idp-login-dialog②\">show an IDP login dialog</a> algorithm was triggered:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>result</var> be the result of that algorithm.</p>"
                },
                {
                  "html": "<p>If <var>result</var> is failure, return (failure, true). The user\nagent MAY show a dialog to the user before or after\nreturning failure indicating this failure.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-fetch-accounts\" id=\"ref-for-create-identity-credential-fetch-accounts①\">fetch accounts</a> with the relevant <var>config</var>, <var>provider</var>, and\n<var>globalObject</var>, and let <var>accountsList</var> be the result.</p>"
                },
                {
                  "html": "<p>If <var>accountsList</var> is empty, show the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#confirm-idp-login-dialog\" id=\"ref-for-confirm-idp-login-dialog\">confirm IDP login dialog</a> again.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend\">Extend</a> <var>allAccounts</var> with <var>accountsList</var> and\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-show-accounts\" id=\"ref-for-create-identity-credential-show-accounts\">show accounts</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, <var>value</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of accounts. <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend①\">Extend</a> <var>allAccounts</var> with <var>value</var>.</p>"
            },
            {
              "html": "If <var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialrequestoptions-mode\" id=\"ref-for-dom-identitycredentialrequestoptions-mode①\">mode</a></code> is <code>\"active\"</code> and the provider’s\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-supports_use_other_account\" id=\"ref-for-dom-identityproviderapiconfig-supports_use_other_account\">supports_use_other_account</a></code> is true, add an\naffordance to trigger <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#show-an-idp-login-dialog\" id=\"ref-for-show-an-idp-login-dialog③\">show an IDP login dialog</a> to let the user sign in to another\naccount. If that affordance is triggered:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>result</var> be the result of that algorithm.</p>"
                },
                {
                  "html": "<p>If <var>result</var> is failure, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-show-accounts\" id=\"ref-for-create-identity-credential-show-accounts①\">show accounts</a>.</p>"
                },
                {
                  "html": "Otherwise:",
                  "rationale": "fetch",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-fetch-accounts\" id=\"ref-for-create-identity-credential-fetch-accounts②\">Fetch accounts</a> given <var>config</var>, <var>provider</var>, and <var>globalObject</var>, and let\n<var>accountsList</var> be the result.</p>"
                    },
                    {
                      "html": "<p>If <var>accountsList</var> is empty, show the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#confirm-idp-login-dialog\" id=\"ref-for-confirm-idp-login-dialog①\">confirm IDP login dialog</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend②\">extend</a> <var>allAccounts</var> with <var>accountsList</var> and\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-identity-credential-show-accounts\" id=\"ref-for-create-identity-credential-show-accounts②\">show accounts</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Also include a UI affordance to close the dialog. If the user closes this dialog, return\n(failure, true).</p>"
        },
        {
          "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create identity credential\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-identity-credential-show-accounts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Show accounts</dfn> step: if <var>allAccounts</var> is not\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①\">empty</a>, also add UI to present the account options to the user. If the user selects\nan account, perform the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>selectedAccount</var> to the chosen <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount⑤\">IdentityProviderAccount</a></code> and <var>permission</var> to\ntrue.</p>"
            },
            {
              "html": "<p>Close the dialog.</p>"
            }
          ]
        },
        {
          "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create identity credential\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-identity-credential-wait-for-user-step\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Wait for user step</dfn>: if the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent④\">user agent</a> created\nany dialogs requesting user choice or permission in the previous steps, wait until they are\nclosed.</p>"
        },
        {
          "html": "<p>If <var>permission</var> is false, then return (failure, true).</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>selectedAccount</var> is not null.</p>"
        },
        {
          "html": "<p>Let <var>credential</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-an-identity-assertion\" id=\"ref-for-fetch-an-identity-assertion\">fetch an identity assertion</a> algorithm with\n<var>selectedAccount</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-id\" id=\"ref-for-dom-identityprovideraccount-id②\">id</a></code>, <var>permissionRequested</var>, <var>isAutoSelected</var>,\n<var>provider</var>, <var>config</var>, and <var>globalObject</var>.</p>"
        },
        {
          "html": "If <var>credential</var> is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredentialerror\" id=\"ref-for-identitycredentialerror④\">IdentityCredentialError</a></code>:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑤\">user agent</a> MUST show UI to the user indicating that the identity assertion fetch\nhas failed.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑥\">user agent</a> SHOULD use the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error⑥\">error</a></code> in its UI to provide\na more specific error message to the user. For instance, if the value is one of\n\"invalid_request\", \"unauthorized_client\", \"access_denied\", \"server_error\", and\n\"temporarily_unavailable\", the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑦\">user agent</a> may note the reason in a user-friendly\nmanner. See <a href=\"https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.2.1\">here</a> for\nmore details about these.</p>"
            },
            {
              "html": "<p>The <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent⑧\">user agent</a> MAY use the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-url\" id=\"ref-for-dom-identitycredentialerror-url⑥\">url</a></code> to display a hyperlink\nin its UI so the user can click on it to learn more information about the error message.</p>"
            },
            {
              "html": "<p>Wait until the UI is acknowledged or dismissed by the user.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>credential</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch accounts",
      "href": "https://w3c-fedid.github.io/FedCM/#create-identity-credential-fetch-accounts",
      "html": "When asked to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create identity credential\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-identity-credential-fetch-accounts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch accounts</dfn> given an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig\">IdentityProviderAPIConfig</a></code> <var>config</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderrequestoptions\" id=\"ref-for-dictdef-identityproviderrequestoptions②\">IdentityProviderRequestOptions</a></code> <var>provider</var>, and a\n<var>globalObject</var>, run the following steps. This returns a possibly empty list of accounts.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>accountsList</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-accounts\" id=\"ref-for-fetch-the-accounts\">fetch the accounts</a> with <var>config</var>, <var>provider</var>, and\n  <var>globalObject</var>.</p>"
        },
        {
          "html": "If <var>accountsList</var> is failure, or the size of <var>accountsList</var> is 0:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#set-the-login-status\" id=\"ref-for-set-the-login-status\">Set the login status</a> of <var>providerOrigin</var> to <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-out\" id=\"ref-for-logged-out②\">logged-out</a>.\n  A user agent may decide to skip this step if no credentials were\n  sent to server.</p>"
            },
            {
              "html": "<p>Return an empty list.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>accountsList</var> is not failure and the size of <var>accountsList</var> is not 0.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#set-the-login-status\" id=\"ref-for-set-the-login-status①\">Set the login status</a> for <var>providerOrigin</var> to <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-in\" id=\"ref-for-logged-in②\">logged-in</a>.</p>"
        },
        {
          "html": "For each <var>acc</var> in <var>accountsList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>acc</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-picture\" id=\"ref-for-dom-identityprovideraccount-picture\">picture</a></code>\"] is present, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-account-picture\" id=\"ref-for-fetch-the-account-picture\">fetch the account picture</a>\n  with <var>acc</var> and <var>globalObject</var>. If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①⓪\">user agent</a> displays this picture to\n  the user at any point, it MUST reuse the result of this fetch instead of redownloading\n  the picture.</p>"
            }
          ]
        },
        {
          "html": "If <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-loginhint\" id=\"ref-for-dom-identityproviderrequestoptions-loginhint①\">loginHint</a></code> is not empty:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For every <var>account</var> in <var>accountList</var>, if <var>account</var>’s\n  <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-login_hints\" id=\"ref-for-dom-identityprovideraccount-login_hints\">login_hints</a></code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑦\">contain</a> <var>provider</var>’s\n  <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-loginhint\" id=\"ref-for-dom-identityproviderrequestoptions-loginhint②\">loginHint</a></code>, remove <var>account</var> from <var>accountList</var> .</p>"
            }
          ]
        },
        {
          "html": "If <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-domainhint\" id=\"ref-for-dom-identityproviderrequestoptions-domainhint①\">domainHint</a></code> is not empty:",
          "rationale": "for",
          "steps": [
            {
              "html": "For every <var>account</var> in <var>accountList</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-domainhint\" id=\"ref-for-dom-identityproviderrequestoptions-domainhint②\">domainHint</a></code> is \"any\":",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-domain_hints\" id=\"ref-for-dom-identityprovideraccount-domain_hints\">domain_hints</a></code> is empty, remove\n  <var>account</var> from <var>accountList</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Otherwise, if <var>account</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-domain_hints\" id=\"ref-for-dom-identityprovideraccount-domain_hints①\">domain_hints</a></code> does not\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑧\">contain</a> <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-domainhint\" id=\"ref-for-dom-identityproviderrequestoptions-domainhint③\">domainHint</a></code>, remove\n  <var>account</var> from <var>accountList</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-account_label\" id=\"ref-for-dom-identityproviderapiconfig-account_label\">account_label</a></code> is present:",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For every <var>account</var> in <var>accountList</var>, if <var>account</var>’s\n  <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-label_hints\" id=\"ref-for-dom-identityprovideraccount-label_hints\">label_hints</a></code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑨\">contain</a>\n  <var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-account_label\" id=\"ref-for-dom-identityproviderapiconfig-account_label①\">account_label</a></code>, remove <var>account</var> from <var>accountList</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>accountsList</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch the config file",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-the-config-file",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-config-file\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch the config file</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig⑧\">IdentityProviderConfig</a></code> <var>provider</var> and\n<var>globalObject</var>, run the following steps. This returns an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig①\">IdentityProviderAPIConfig</a></code>\nor failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url③\">parse url</a> with <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl⑦\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>configUrl</var> is failure, return failure.</p>"
        },
        {
          "html": "<p>Run a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-csp/\"><cite>Content Security Policy Level 3</cite></a> check with a <a href=\"https://w3c.github.io/webappsec-csp/#directive-connect-src\">connect-src</a> directive on the URL\npassed as <var>configUrl</var>. If it fails, return failure.</p>"
        },
        {
          "html": "<p>If <var>configUrl</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url\" id=\"ref-for-potentially-trustworthy-url\">potentially trustworthy URL</a>, return failure.</p>"
        },
        {
          "html": "<p>Let <var>rootUrl</var> be a new <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①\">URL</a>.</p>"
        },
        {
          "html": "<p>Set <var>rootUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a> to <var>configUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a>.</p>"
        },
        {
          "html": "<p>Set <var>rootUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a> to <var>configUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain①\">registrable domain</a>.</p>"
        },
        {
          "html": "<p>Set <var>rootUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path\">path</a> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a> «\".well-known\", \"web-identity\"».</p>"
        },
        {
          "html": "<p>Let <var>config</var>, <var>wellKnown</var>, <var>accounts_url</var>, and <var>login_url</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>skipWellKnown</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>rpOrigin</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑦\">associated Document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①①\">origin</a>.</p>"
        },
        {
          "html": "<p>If <var>rpOrigin</var> is not an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque\">opaque origin</a>, and <var>rootUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host②\">host</a> is equal\nto <var>rpOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain②\">registrable domain</a>, and <var>rootUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme②\">scheme</a> is\nequal to <var>rpOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme\">scheme</a>, set <var>skipWellKnown</var> to true.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>wellKnownRequest</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①\">request</a> as follows:</p>\n        <dl>\n         <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">URL</a>\n         </dt><dd data-md=\"\">\n          <p><var>rootUrl</var></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①\">client</a>\n         </dt><dd data-md=\"\">\n          <p>null</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode①\">service-workers mode</a>\n         </dt><dd data-md=\"\">\n          <p>\"none\"</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①\">destination</a>\n         </dt><dd data-md=\"\">\n          <p>\"webidentity\"</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①\">origin</a>\n         </dt><dd data-md=\"\">\n          <p>a unique <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque①\">opaque origin</a></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①\">header list</a>\n         </dt><dd data-md=\"\">\n          <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a> containing a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①\">header</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①\">name</a> set to <code>Accept</code> and\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value①\">value</a> set to <code>application/json</code></p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy\">referrer policy</a>\n         </dt><dd data-md=\"\">\n          <p>\"no-referrer\"</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①\">credentials mode</a>\n         </dt><dd data-md=\"\">\n          <p>\"omit\"</p>\n         </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①\">mode</a>\n         </dt><dd data-md=\"\">\n          <p>\"no-cors\"</p>\n        </dd></dl>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request①\">Fetch request</a> with <var>wellKnownRequest</var> and <var>globalObject</var>, and with <var>processResponseConsumeBody</var>\nset to the following steps, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> <var>response</var> and <var>responseBody</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response\" id=\"ref-for-extract-the-json-fetch-response①\">extract the JSON fetch response</a> from <var>response</var> and\n<var>responseBody</var>.</p>"
                },
                {
                  "html": "<p>Set <var>wellKnown</var> to the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value①\">converting</a> <var>json</var>\nto an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderwellknown\" id=\"ref-for-dictdef-identityproviderwellknown\">IdentityProviderWellKnown</a></code>.</p>"
                },
                {
                  "html": "<p>If one of the previous two steps threw an exception, or if the\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a> of <var>wellKnown</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-provider_urls\" id=\"ref-for-dom-identityproviderwellknown-provider_urls\">provider_urls</a></code>\"] is\ngreater than 1, set <var>wellKnown</var> to failure.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>configRequest</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> as follows:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url②\">url</a>\n       </dt><dd data-md=\"\">\n        <p><var>configUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode①\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"error\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode②\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"none\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination②\">destination</a>\n       </dt><dd data-md=\"\">\n        <p>\"webidentity\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②\">origin</a>\n       </dt><dd data-md=\"\">\n        <p>a unique <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque②\">opaque origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a> containing a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header②\">header</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②\">name</a> set to <code>Accept</code> and\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value②\">value</a> set to <code>application/json</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy①\">referrer policy</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-referrer\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode②\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"omit\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode③\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-cors\"</p>\n      </dd></dl>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request②\">Fetch request</a> with <var>configRequest</var> and <var>globalObject</var>, and with <var>processResponseConsumeBody</var>\nset to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> <var>response</var> and <var>responseBody</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response\" id=\"ref-for-extract-the-json-fetch-response②\">extract the JSON fetch response</a> from <var>response</var> and\n<var>responseBody</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value②\">Convert</a> <var>json</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig②\">IdentityProviderAPIConfig</a></code> stored\nin <var>config</var>.</p>"
            },
            {
              "html": "<p>If one of the previous two steps threw an exception, set <var>config</var> to failure.</p>"
            },
            {
              "html": "<p>Set <var>login_url</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url①\">computing the manifest URL</a> with <var>provider</var>,\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-login_url\" id=\"ref-for-dom-identityproviderapiconfig-login_url\">login_url</a></code>, and <var>globalObject</var>.</p>"
            },
            {
              "html": "<p>Set <var>accounts_url</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url②\">computing the manifest URL</a> with <var>provider</var>,\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-accounts_endpoint\" id=\"ref-for-dom-identityproviderapiconfig-accounts_endpoint\">accounts_endpoint</a></code>, and <var>globalObject</var>.</p>"
            },
            {
              "html": "<p>If <var>login_url</var> or <var>accounts_url</var> is failure, set <var>config</var> to failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>config</var> to be set.</p>"
        },
        {
          "html": "<p>If <var>config</var> is failure, return failure.</p>"
        },
        {
          "html": "<p>If <var>skipWellKnown</var> is true, return <var>config</var>.</p>"
        },
        {
          "html": "<p>Wait for <var>wellKnown</var> to be set.</p>"
        },
        {
          "html": "<p>If <var>wellKnown</var> is failure, return failure.</p>"
        },
        {
          "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch the config file\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-config-file-check-accounts-and-login-url-step\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Check accounts and login url step</dfn>: If\n<var>wellKnown</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-accounts_endpoint\" id=\"ref-for-dom-identityproviderwellknown-accounts_endpoint\">accounts_endpoint</a></code> and\n<var>wellKnown</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-login_url\" id=\"ref-for-dom-identityproviderwellknown-login_url\">login_url</a></code> are set:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>well_known_accounts_url</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url③\">computing the manifest URL</a> with\n<var>provider</var>, <var>wellKnown</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-accounts_endpoint\" id=\"ref-for-dom-identityproviderwellknown-accounts_endpoint①\">accounts_endpoint</a></code>, and\n<var>globalObject</var>.</p>"
            },
            {
              "html": "<p>Let <var>well_known_login_url</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url④\">computing the manifest URL</a> with <var>provider</var>,\n<var>wellKnown</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-login_url\" id=\"ref-for-dom-identityproviderwellknown-login_url①\">login_url</a></code>, and <var>globalObject</var>.</p>"
            },
            {
              "html": "<p>If <var>well_known_accounts_url</var> is not <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-equals\" id=\"ref-for-concept-url-equals\">equal</a> to <var>accounts_url</var>, return failure.</p>"
            },
            {
              "html": "<p>If <var>well_known_login_url</var> is not <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-equals\" id=\"ref-for-concept-url-equals①\">equal</a> to <var>login_url</var>, return failure.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>allowed_config_url</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url⑤\">computing the manifest URL</a> with <var>provider</var>,\n<var>wellKnown</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderwellknown-provider_urls\" id=\"ref-for-dom-identityproviderwellknown-provider_urls①\">provider_urls</a></code>[0], and <var>globalObject</var>.</p>"
            },
            {
              "html": "<p>If <var>allowed_config_url</var> is not <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-equals\" id=\"ref-for-concept-url-equals②\">equal</a> to <var>configUrl</var>, return failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>config</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch the accounts",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-the-accounts",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-accounts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch the accounts</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig③\">IdentityProviderAPIConfig</a></code> <var>config</var>, an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderrequestoptions\" id=\"ref-for-dictdef-identityproviderrequestoptions③\">IdentityProviderRequestOptions</a></code> <var>provider</var>, and <var>globalObject</var>, run the following steps. This\nreturns an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccountlist\" id=\"ref-for-dictdef-identityprovideraccountlist\">IdentityProviderAccountList</a></code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>accountsUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url⑥\">computing the manifest URL</a> given <var>provider</var>,\n<var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-accounts_endpoint\" id=\"ref-for-dom-identityproviderapiconfig-accounts_endpoint②\">accounts_endpoint</a></code>\"], and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>accountsUrl</var> is failure, return an empty list.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑤\">request</a> as follows:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url③\">url</a>\n       </dt><dd data-md=\"\">\n        <p><var>accountsUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode②\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"error\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client③\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode③\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"none\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination③\">destination</a>\n       </dt><dd data-md=\"\">\n        <p>\"webidentity\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin③\">origin</a>\n       </dt><dd data-md=\"\">\n        <p>a unique <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque③\">opaque origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a> containing a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header③\">header</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name③\">name</a> set to <code>Accept</code> and\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value③\">value</a> set to <code>application/json</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy②\">referrer policy</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-referrer\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode③\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"include\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑤\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-cors\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>accountsList</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request③\">Fetch request</a> with <var>request</var> and <var>globalObject</var>, and with <var>processResponseConsumeBody</var>\nset to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> <var>response</var> and <var>responseBody</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response\" id=\"ref-for-extract-the-json-fetch-response③\">extract the JSON fetch response</a> from <var>response</var> and\n<var>responseBody</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value③\">Convert</a> <var>json</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccountlist\" id=\"ref-for-dictdef-identityprovideraccountlist①\">IdentityProviderAccountList</a></code>, and\nstore the result in <var>accountsList</var>.</p>"
            },
            {
              "html": "<p>If one of the previous two steps threw an exception, or if there is an account in\n<var>accountsList</var> that has neither <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-email\" id=\"ref-for-dom-identityprovideraccount-email\">email</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-name\" id=\"ref-for-dom-identityprovideraccount-name\">name</a></code>,\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-tel\" id=\"ref-for-dom-identityprovideraccount-tel\">tel</a></code>, nor <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-username\" id=\"ref-for-dom-identityprovideraccount-username\">username</a></code> set, set <var>accountsList</var>\nto failure.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>accountsList</var> to be set.</p>"
        },
        {
          "html": "<p>Return <var>accountsList</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch the account picture",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-the-account-picture",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-account-picture\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch the account picture</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityprovideraccount\" id=\"ref-for-dictdef-identityprovideraccount⑧\">IdentityProviderAccount</a></code> <var>account</var> and a\n<var>globalObject</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>pictureUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url④\">parse url</a> with\n<var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-picture\" id=\"ref-for-dom-identityprovideraccount-picture②\">picture</a></code>\"] and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>pictureUrl</var> is failure, abort these steps. The user agent may use a placeholder image.</p>"
        },
        {
          "html": "<p>Let <var>pictureRequest</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦\">request</a> as follows:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url④\">url</a>\n       </dt><dd data-md=\"\">\n        <p><var>pictureUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client④\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode④\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"none\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination④\">destination</a>\n       </dt><dd data-md=\"\">\n        <p>\"image\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin④\">origin</a>\n       </dt><dd data-md=\"\">\n        <p>a unique <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque④\">opaque origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy③\">referrer policy</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-referrer\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode④\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"omit\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑦\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"no-cors\"</p>\n      </dd></dl>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request④\">Fetch request</a> with <var>pictureRequest</var> and <var>globalObject</var>, and with <var>processResponseConsumeBody</var>\nset to the following steps given a <var>response</var> and a <var>responseBody</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>responseBody</var> is null or failure, the user agent may choose an arbitrary placeholder image\nand associate it with the <var>account</var>.</p>"
            },
            {
              "html": "<p>Otherwise, decode <var>responseBody</var> into an image, and associate it with <var>account</var> if successful. This\nallows the user agent to use the decoded image in a dialog displaying <var>account</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "fetch an identity assertion",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-an-identity-assertion",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-an-identity-assertion\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch an identity assertion</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString③⓪\">USVString</a></code>\n    <var>accountId</var>, a boolean <var>permissionRequested</var>, a boolean <var>isAutoSelected</var>, an\n    <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderrequestoptions\" id=\"ref-for-dictdef-identityproviderrequestoptions④\">IdentityProviderRequestOptions</a></code> <var>provider</var>, an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig④\">IdentityProviderAPIConfig</a></code> <var>config</var>,\n    and <var>globalObject</var>, run the following steps. This returns an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredential\" id=\"ref-for-identitycredential①①\">IdentityCredential</a></code> or an\n    <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredentialerror\" id=\"ref-for-identitycredentialerror⑤\">IdentityCredentialError</a></code>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>tokenUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url\" id=\"ref-for-computing-the-manifest-url⑦\">computing the manifest URL</a> given <var>provider</var>,\n<var>config</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-id_assertion_endpoint\" id=\"ref-for-dom-identityproviderapiconfig-id_assertion_endpoint①\">id_assertion_endpoint</a></code>\"], and <var>globalObject</var>.</p>"
        },
        {
          "html": "If <var>tokenUrl</var> is failure:",
          "rationale": "queue",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source②\">DOM manipulation task source</a> given <var>globalObject</var> to\nlet <var>error</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror\">create an IdentityCredentialError</a> given {} and\n<var>globalObject</var>.</p>"
            },
            {
              "html": "<p>Wait for <var>error</var> to be set, and return it.</p>"
            }
          ]
        },
        {
          "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch identity assertion\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-identity-assertion-create-a-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Create a list</dfn>: let <var>list</var> be a list with the\nfollowing entries:</p>",
          "ignored": [
            "(\"client_id\", provider’s clientId) (\"account_id\", accountId) (\"is_auto_selected\", isAutoSelected)"
          ]
        },
        {
          "html": "If <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-params\" id=\"ref-for-dom-identityproviderrequestoptions-params①\">params</a></code> is not empty:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\" id=\"ref-for-serialize-a-javascript-value-to-a-json-string\">serializing a JavaScript value to a JSON string</a>\nwith <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-params\" id=\"ref-for-dom-identityproviderrequestoptions-params②\">params</a></code>.</p>"
            },
            {
              "html": "<p>If serializing threw an exception, return failure.</p>"
            },
            {
              "html": "<p>Append (\"params\", <var>json</var>) to <var>list</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>requestBody</var> be the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlencoded-serializer\" id=\"ref-for-concept-urlencoded-serializer①\">urlencoded serializer</a> with <var>list</var>.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑨\">request</a> as follows:</p>\n      <dl>\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑤\">url</a>\n       </dt><dd data-md=\"\">\n        <p><var>tokenUrl</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①\">method</a>\n       </dt><dd data-md=\"\">\n        <p>\"POST\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①\">body</a>\n       </dt><dd data-md=\"\">\n        <p>the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode①\">UTF-8 encode</a> of <var>requestBody</var></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode③\">redirect mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"error\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑤\">client</a>\n       </dt><dd data-md=\"\">\n        <p>null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode⑤\">service-workers mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"none\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑤\">destination</a>\n       </dt><dd data-md=\"\">\n        <p>\"webidentity\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑤\">origin</a>\n       </dt><dd data-md=\"\">\n        <p><var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑧\">associated document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①②\">origin</a></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④\">header list</a>\n       </dt><dd data-md=\"\">\n        <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a> containing a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header④\">header</a> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name④\">name</a> set to <code>Accept</code> and\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value④\">value</a> set to <code>application/x-www-form-urlencoded</code></p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode⑤\">credentials mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"include\"</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑨\">mode</a>\n       </dt><dd data-md=\"\">\n        <p>\"cors\"</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>credential</var> be null.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-request\" id=\"ref-for-fetch-request⑤\">Fetch request</a> with <var>request</var> and <var>globalObject</var>, and with <var>processResponseConsumeBody</var>\nset to the following steps given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④\">response</a> <var>response</var> and <var>responseBody</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>responseBody</var> is null or failure, set <var>credential</var> to the result of\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror①\">create an IdentityCredentialError</a> with {} and <var>globalObject</var>, and return.</p>"
            },
            {
              "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response\" id=\"ref-for-extract-the-json-fetch-response④\">extract the JSON fetch response</a> from <var>response</var> and\n<var>responseBody</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\" id=\"ref-for-dfn-convert-ecmascript-to-idl-value④\">Convert</a> <var>json</var> to an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityassertionresponse\" id=\"ref-for-dictdef-identityassertionresponse\">IdentityAssertionResponse</a></code>, <var>token</var>.</p>"
            },
            {
              "html": "<p>If one of the previous two steps threw an exception, set <var>credential</var> to the result of\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror②\">create an IdentityCredentialError</a> with {} and <var>globalObject</var>, and return.</p>"
            },
            {
              "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityassertionresponse-error\" id=\"ref-for-dom-identityassertionresponse-error\">error</a></code> was specified, let <var>errorInit</var> be the value and:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>errorInit</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerrorinit-url\" id=\"ref-for-dom-identitycredentialerrorinit-url\">url</a></code> is present:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>errorUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url⑤\">parse url</a> given\n<var>errorInit</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerrorinit-url\" id=\"ref-for-dom-identitycredentialerrorinit-url①\">url</a></code> (the relative URL),\n<var>globalObject</var>, and <var>tokenUrl</var> (the base URL).</p>"
                    },
                    {
                      "html": "<p>If <var>errorUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host③\">host</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-registrable-domain\" id=\"ref-for-host-registrable-domain③\">registrable domain</a>\nis not equal to <var>tokenUrl</var>’s, set <var>errorUrl</var> to failure.</p>"
                    },
                    {
                      "html": "<p>If <var>errorUrl</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url\" id=\"ref-for-potentially-trustworthy-url①\">potentially trustworthy URL</a>, set set <var>errorUrl</var> to\nfailure.</p>"
                    },
                    {
                      "html": "<p>If <var>errorUrl</var> is failure, set <var>errorInit</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerrorinit-url\" id=\"ref-for-dom-identitycredentialerrorinit-url②\">url</a></code>\nto \"\". Otherwise, set <var>errorInit</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerrorinit-url\" id=\"ref-for-dom-identitycredentialerrorinit-url③\">url</a></code> to\n<var>errorUrl</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Set <var>credential</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror③\">create an IdentityCredentialError</a> with\n<var>errorInit</var>, and <var>globalObject</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status\">status</a> is not an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#ok-status\" id=\"ref-for-ok-status\">ok status</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>credential</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror④\">create an IdentityCredentialError</a> with {} and\n<var>globalObject</var>.</p>"
                },
                {
                  "html": "<p>The user agent MAY set <var>credential</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredentialerror-error\" id=\"ref-for-dom-identitycredentialerror-error⑦\">error</a></code> based on\n<var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①\">status</a>. For example, if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②\">status</a> is <code>500</code>, it\ncould set it to \"server_error\", and if the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status③\">status</a> is <code>503</code>, it could set\nit to \"temporarily_unavailable\".</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityassertionresponse-token\" id=\"ref-for-dom-identityassertionresponse-token①\">token</a></code> was specified:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>tokenValue</var> be <var>token</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityassertionresponse-token\" id=\"ref-for-dom-identityassertionresponse-token②\">token</a></code>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityassertionresponse-continue_on\" id=\"ref-for-dom-identityassertionresponse-continue_on\">continue_on</a></code> was specified, run these steps\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>continueOnUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url⑥\">parse url</a> with <var>token</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityassertionresponse-continue_on\" id=\"ref-for-dom-identityassertionresponse-continue_on①\">continue_on</a></code> and <var>globalObject</var>.</p>"
                },
                {
                  "html": "<p>If <var>continueOnUrl</var> is failure, set <var>credential</var> to failure and return.</p>"
                },
                {
                  "html": "<p>If <var>continueOnUrl</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>tokenUrl</var>, set <var>credential</var>\nto failure and return.</p>"
                },
                {
                  "html": "<p>Let <var>tokenPair</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#show-a-continuation-dialog\" id=\"ref-for-show-a-continuation-dialog\">show a continuation dialog</a> with <var>continueOnUrl</var>.</p>"
                },
                {
                  "html": "<p>If <var>tokenPair</var> is failure, set <var>credential</var> to failure and return.</p>"
                },
                {
                  "html": "<p>Let <var>tokenValue</var> be the first entry of <var>tokenPair</var>.</p>"
                },
                {
                  "html": "<p>If the second entry of <var>tokenPair</var> is not null, set <var>accountId</var> to that second entry.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, set <var>credential</var> to a the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredentialerror\" id=\"ref-for-create-an-identitycredentialerror⑤\">create an IdentityCredentialError</a> with\n{} and <var>globalObject</var>,</p>"
            },
            {
              "html": "<p>Wait for <var>tokenValue</var> or <var>credential</var> to be set.</p>"
            },
            {
              "html": "If <var>credential</var> is set:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p>Assert that <var>credential</var> is set to failure.</p>"
                },
                {
                  "html": "<p>Return <var>credential</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-a-connection-between-the-rp-and-the-idp-account\" id=\"ref-for-create-a-connection-between-the-rp-and-the-idp-account①\">Create a connection between the RP and the IdP account</a> with <var>provider</var>, <var>accountId</var>, and\n<var>globalObject</var>.</p>"
            },
            {
              "html": "<p>Let <var>credential</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identitycredential\" id=\"ref-for-identitycredential①②\">IdentityCredential</a></code> given <var>globalObject</var>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-global-object-realm\" id=\"ref-for-concept-global-object-realm\">realm</a>.</p>"
            },
            {
              "html": "<p>Set <var>credential</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredential-token\" id=\"ref-for-dom-identitycredential-token②\">token</a></code> to <var>tokenValue</var>.</p>"
            },
            {
              "html": "<p>Set <var>credential</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredential-isautoselected\" id=\"ref-for-dom-identitycredential-isautoselected②\">isAutoSelected</a></code> to\n<var>isAutoSelected</var>.</p>"
            },
            {
              "html": "<p>Set <var>credential</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identitycredential-configurl\" id=\"ref-for-dom-identitycredential-configurl②\">configURL</a></code> to <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl⑧\">configURL</a></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Wait for <var>credential</var> to be set.</p>"
        },
        {
          "html": "<p>Return <var>credential</var>.</p>"
        }
      ]
    },
    {
      "name": "parse url",
      "href": "https://w3c-fedid.github.io/FedCM/#parse-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse url</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-USVString\" id=\"ref-for-idl-USVString③④\">USVString</a></code> <var>stringUrl</var>, a <var>globalObject</var>, and an optional\n<var>baseUrl</var> (default null), run the following steps. This returns a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②\">URL</a> or failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>configUrl</var> be null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source③\">DOM manipulation task source</a> given <var>globalObject</var> to set\n<var>configUrl</var> to the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">url parser</a> with <var>stringUrl</var> and <var>baseUrl</var>.</p>"
        },
        {
          "html": "<p>Wait for <var>configUrl</var> to be set.</p>"
        },
        {
          "html": "<p>Return <var>configUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "fetch request",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch request</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①②\">request</a> <var>request</var>, <var>globalObject</var>, and an algorithm\n<var>processResponseConsumeBody</var>, run the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source\">network task source</a> given <var>globalObject</var> to:",
          "rationale": "fetch",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch\">Fetch</a> <var>request</var> with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response-end-of-body\" id=\"ref-for-process-response-end-of-body\">processResponseConsumeBody</a> set to\n  <var>processResponseConsumeBody</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "computing the manifest URL",
      "href": "https://w3c-fedid.github.io/FedCM/#computing-the-manifest-url",
      "html": "When <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"computing-the-manifest-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">computing the manifest URL</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig⑨\">IdentityProviderConfig</a></code> <var>provider</var>, a\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string\">string</a> <var>manifestString</var>, and <var>globalObject</var>, perform the following steps. This returns a\n<a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url③\">URL</a> or failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url⑦\">parse url</a> with <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl⑨\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Let <var>manifestUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url⑧\">parse url</a> given <var>manifestString</var> (the relative\nURL), <var>globalObject</var>, and <var>configUrl</var> (the base URL).</p>"
        },
        {
          "html": "<p>Wait until <var>manifestUrl</var> is set.</p>"
        },
        {
          "html": "<p>If <var>manifestUrl</var> is failure, return failure.</p>"
        },
        {
          "html": "<p>If <var>manifestUrl</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> with <var>configUrl</var>, return failure.</p>"
        },
        {
          "html": "<p>If <var>manifestUrl</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url\" id=\"ref-for-potentially-trustworthy-url②\">potentially trustworthy URL</a>, return failure.</p>"
        },
        {
          "html": "<p>Return <var>manifestUrl</var>.</p>"
        }
      ]
    },
    {
      "name": "extract the JSON fetch response",
      "href": "https://w3c-fedid.github.io/FedCM/#extract-the-json-fetch-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"extract-the-json-fetch-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract the JSON fetch response</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥\">response</a> <var>response</var>\nand a <var>responseBody</var>, run the following steps. This returns an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">ordered map</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: These steps are running on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source①\">networking task source</a>.</p>"
        },
        {
          "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a> or its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status④\">status</a> is not an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#ok-status\" id=\"ref-for-ok-status①\">ok status</a>,\nthrow a new \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑥\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type\">extracting a MIME TYPE</a> from <var>response</var>’s\n<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a>.</p>"
        },
        {
          "html": "<p>If <var>mimeType</var> is failure or is not a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#json-mime-type\" id=\"ref-for-json-mime-type\">JSON MIME Type</a>, throw a new \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①②\">NetworkError</a></code>\"\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑦\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>json</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-json-bytes-to-a-javascript-value\" id=\"ref-for-parse-json-bytes-to-a-javascript-value\">parse JSON bytes to a JavaScript value</a> passing <var>responseBody</var>.</p>"
        },
        {
          "html": "<p>If <var>json</var> is a parsing exception, throw a new \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①③\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑧\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Return <var>json</var>.</p>"
        }
      ]
    },
    {
      "name": "show an IDP login dialog",
      "href": "https://w3c-fedid.github.io/FedCM/#show-an-idp-login-dialog",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"show-an-idp-login-dialog\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">show an IDP login dialog</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderapiconfig\" id=\"ref-for-dictdef-identityproviderapiconfig⑥\">IdentityProviderAPIConfig</a></code> <var>config</var>, an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig①⓪\">IdentityProviderConfig</a></code> <var>provider</var>, and a <var>globalObject</var>, run the following steps. This returns\nsuccess or failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>loginUrl</var> be null.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source④\">DOM manipulation task source</a> given <var>globalObject</var> to set\n<var>loginUrl</var> to the result of running <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser②\">url parser</a> with\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-login_url\" id=\"ref-for-dom-identityproviderapiconfig-login_url②\">login_url</a></code>.</p>"
        },
        {
          "html": "<p>Wait until <var>loginUrl</var> is not null.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>loginUrl</var> is not failure (the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#user-agent\" id=\"ref-for-user-agent①①\">user agent</a> has previously checked that\n<var>config</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-login_url\" id=\"ref-for-dom-identityproviderapiconfig-login_url③\">login_url</a></code> is a valid URL).</p>"
        },
        {
          "html": "<p>Let <var>queryList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-loginhint\" id=\"ref-for-dom-identityproviderrequestoptions-loginhint③\">loginHint</a></code> is not empty, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">append</a>\n(\"login_hint\", <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-loginhint\" id=\"ref-for-dom-identityproviderrequestoptions-loginhint④\">loginHint</a></code>) to <var>queryList</var>.</p>"
        },
        {
          "html": "<p>If <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-domainhint\" id=\"ref-for-dom-identityproviderrequestoptions-domainhint④\">domainHint</a></code> is not empty, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">append</a>\n(\"domain_hint\", <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderrequestoptions-domainhint\" id=\"ref-for-dom-identityproviderrequestoptions-domainhint⑤\">domainHint</a></code>) to <var>queryList</var>.</p>"
        },
        {
          "html": "If <var>queryList</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑥\">empty</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>queryParameters</var> be the result of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlencoded-serializer\" id=\"ref-for-concept-urlencoded-serializer②\">urlencoded serializer</a> with <var>queryList</var>.</p>"
            },
            {
              "html": "<p>If <var>loginUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query\">query</a> is not null or empty, prepend \"&amp;\" to <var>queryParameters</var>.</p>"
            },
            {
              "html": "<p>Append <var>queryParameters</var> to <var>loginUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query①\">query</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#create-a-fresh-top-level-traversable\" id=\"ref-for-create-a-fresh-top-level-traversable\">Create a fresh top-level traversable</a> with <var>loginUrl</var>.</p>"
        },
        {
          "html": "<p>The user agent MAY <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#set-up-browsing-context-features\" id=\"ref-for-set-up-browsing-context-features\">set up browsing context features</a> or otherwise\naffect the presentation of this traversable in an implementation-defined\nway.</p>"
        },
        {
          "html": "<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identityprovider\" id=\"ref-for-identityprovider\">IdentityProvider</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovider-close\" id=\"ref-for-dom-identityprovider-close\">close</a></code> is called in the\ncontext of this new traversable:",
          "rationale": "close",
          "steps": [
            {
              "html": "<p>Close the traversable.</p>"
            },
            {
              "html": "<p>Let <var>loginStatus</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#get-the-login-status\" id=\"ref-for-get-the-login-status①\">get the login status</a>\nwith the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④\">origin</a> of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderapiconfig-login_url\" id=\"ref-for-dom-identityproviderapiconfig-login_url④\">login_url</a></code>.</p>"
            },
            {
              "html": "<p>If <var>loginStatus</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/login-status#logged-in\" id=\"ref-for-logged-in③\">logged-in</a>, return success.</p>"
            },
            {
              "html": "<p>Otherwise, return failure.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "show a continuation dialog",
      "href": "https://w3c-fedid.github.io/FedCM/#show-a-continuation-dialog",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"show-a-continuation-dialog\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">show a continuation dialog</dfn> given a <var>continueOnUrl</var>, run the\nfollowing steps. This returns a failure or a tuple (any, string?) (a token\nand an optional account ID).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑨\">in parallel</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#create-a-fresh-top-level-traversable\" id=\"ref-for-create-a-fresh-top-level-traversable①\">Create a fresh top-level traversable</a> with <var>continueOnUrl</var>.</p>"
        },
        {
          "html": "<p>The user agent MAY <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#set-up-browsing-context-features\" id=\"ref-for-set-up-browsing-context-features①\">set up browsing context features</a> or otherwise\naffect the presentation of this traversable in an implementation-defined\nway.</p>"
        },
        {
          "html": "<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identityprovider\" id=\"ref-for-identityprovider①\">IdentityProvider</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovider-close\" id=\"ref-for-dom-identityprovider-close①\">close</a></code> is called in the\ncontext of this new traversable:",
          "rationale": "close",
          "steps": [
            {
              "html": "<p>Close the traversable.</p>"
            },
            {
              "html": "<p>Return failure.</p>"
            }
          ],
          "additional": [
            {
              "html": "<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#identityprovider\" id=\"ref-for-identityprovider②\">IdentityProvider</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovider-resolve\" id=\"ref-for-dom-identityprovider-resolve\">resolve()</a></code> is called in\nthe context of this new traversable.",
              "rationale": "close",
              "steps": [
                {
                  "html": "<p>Close the traversable.</p>"
                },
                {
                  "html": "<p>Let <var>tokenValue</var> be the token that was passed to that resolve call.</p>"
                },
                {
                  "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityresolveoptions-accountid\" id=\"ref-for-dom-identityresolveoptions-accountid\">accountId</a></code> was specified in the\nresolve call, let <var>accountId</var> be that account ID.</p>"
                },
                {
                  "html": "<p>Otherwise, let <var>accountId</var> be null.</p>"
                },
                {
                  "html": "<p>Return (<var>tokenValue</var>, <var>accountId</var>).</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "fetch the config file and show an IDP login dialog",
      "href": "https://w3c-fedid.github.io/FedCM/#fetch-the-config-file-and-show-an-idp-login-dialog",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-the-config-file-and-show-an-idp-login-dialog\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch the config file and show an IDP login dialog</dfn> given an\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig①①\">IdentityProviderConfig</a></code> <var>provider</var>, and a <var>globalObject</var>, run the following\nsteps. This returns success or failure.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-config-file\" id=\"ref-for-fetch-the-config-file③\">fetch the config file</a>\n      with <var>provider</var> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>config</var> is failure, return failure.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#show-an-idp-login-dialog\" id=\"ref-for-show-an-idp-login-dialog⑤\">Show an IDP login dialog</a> with <var>config</var> and <var>provider</var>.</p>"
        },
        {
          "html": "<p>If that algorithm succeeds, return success.</p>"
        },
        {
          "html": "<p>Otherwise, return failure.</p>"
        }
      ]
    },
    {
      "name": "getUserInfo",
      "html": "When invoking the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovider-getuserinfo\" id=\"ref-for-dom-identityprovider-getuserinfo②\">getUserInfo()</a></code> method given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig①③\">IdentityProviderConfig</a></code>\n<var>provider</var>, perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>promise</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise⑥\">Promise</a></code> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object\" id=\"ref-for-current-global-object①\">current global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">In parallel</a>, run the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#in-parallel-steps-for-getuserinfo\" id=\"ref-for-in-parallel-steps-for-getuserinfo\">in parallel steps for getUserInfo</a> with <var>promise</var> and <var>provider</var>.</p>"
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "in parallel steps for getUserInfo",
      "href": "https://w3c-fedid.github.io/FedCM/#in-parallel-steps-for-getuserinfo",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"in-parallel-steps-for-getuserinfo\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">in parallel steps for getUserInfo</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise⑦\">Promise</a></code> <var>promise</var> and an\n    <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderconfig\" id=\"ref-for-dictdef-identityproviderconfig①④\">IdentityProviderConfig</a></code> <var>provider</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①②\">associated Document</a>.</p>"
        },
        {
          "html": "<p>If <var>document</var> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\" id=\"ref-for-allowed-to-use①\">allowed to use</a> the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#identity-credentials-get\" id=\"ref-for-identity-credentials-get①\">identity-credentials-get</a>\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-permissions-policy/#policy-controlled-feature\" id=\"ref-for-policy-controlled-feature①\">policy-controlled feature</a>, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror②\">NotAllowedError</a></code>\"\nand return.</p>"
        },
        {
          "html": "<p>If there does not exist an account <var>account</var> such that <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set①③\">connected accounts set</a>\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①①\">contains</a> the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connected-account-key\" id=\"ref-for-compute-the-connected-account-key④\">compute the connected account key</a> given <var>account</var>,\n<var>provider</var>, and <var>globalObject</var>, then <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject①\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①④\">NetworkError</a></code>\"\nand return. This check can be performed by iterating over the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#connected-accounts-set\" id=\"ref-for-connected-accounts-set①④\">connected accounts set</a> or\nby keeping a separate data structure to make this lookup fast.</p>"
        },
        {
          "html": "<p>Let <var>configUrl</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#parse-url\" id=\"ref-for-parse-url⑨\">parse url</a> with <var>provider</var>’s\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-configurl\" id=\"ref-for-dom-identityproviderconfig-configurl①①\">configURL</a></code> and <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>configUrl</var> is failure, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject②\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\"\nand return.</p>"
        },
        {
          "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin①⑦\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same origin</a> as <var>configUrl</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin③\">origin</a>,\n<a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject③\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" and return.</p>"
        },
        {
          "html": "<p>Run a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webappsec-csp/\"><cite>Content Security Policy Level 3</cite></a> check with a <a href=\"https://w3c.github.io/webappsec-csp/#directive-connect-src\">connect-src</a> directive on the URL\npassed as <var>configUrl</var>. If it fails, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject④\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑤\">NetworkError</a></code>\"\nand return.</p>"
        },
        {
          "html": "<p>If <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑥\">navigable</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable\">top-level traversable</a>, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject⑤\">queue to reject</a>\n<var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑥\">NetworkError</a></code>\" and return.</p>"
        },
        {
          "html": "<p>If the user has disabled the FedCM API on the <var>globalObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable⑦\">navigable</a>’s\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑧\">top-level traversable</a>, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject⑥\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑦\">NetworkError</a></code>\"\nand return.</p>"
        },
        {
          "html": "<p>Let <var>config</var> be the result of running <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-config-file\" id=\"ref-for-fetch-the-config-file④\">fetch the config file</a> with <var>provider</var> and\n<var>globalObject</var>.</p>"
        },
        {
          "html": "<p>If <var>config</var> is failure, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject⑦\">queue to reject</a> <var>promise</var> with \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑧\">NetworkError</a></code>\" and return.</p>"
        },
        {
          "html": "<p>Let <var>accountsList</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#fetch-the-accounts\" id=\"ref-for-fetch-the-accounts②\">fetch the accounts</a> with <var>config</var>, <var>provider</var>,\nand <var>globalObject</var>.</p>"
        },
        {
          "html": "<p>Let <var>hasAccountEligibleForAutoReauthentication</var> be false.</p>"
        },
        {
          "html": "For each <var>account</var> in <var>accountsList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-approved_clients\" id=\"ref-for-dom-identityprovideraccount-approved_clients⑦\">approved_clients</a></code>\"] is not empty and it does not\n<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①②\">contain</a> <var>provider</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityproviderconfig-clientid\" id=\"ref-for-dom-identityproviderconfig-clientid⑧\">clientId</a></code>, continue.</p>"
            },
            {
              "html": "<p>If <var>account</var> is <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#eligible-for-auto-reauthentication\" id=\"ref-for-eligible-for-auto-reauthentication①\">eligible for auto reauthentication</a> given <var>provider</var> and\n<var>globalObject</var>, set <var>hasAccountEligibleForAutoReauthentication</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>hasAccountEligibleForAutoReauthentication</var> is false, <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#queue-to-reject\" id=\"ref-for-queue-to-reject⑧\">queue to reject</a> <var>promise</var> with\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①⑨\">NetworkError</a></code>\" and return.</p>"
        },
        {
          "html": "<p>Let <var>userInfoList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a>.</p>"
        },
        {
          "html": "For each <var>account</var> in <var>accountsList</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">Append</a> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityuserinfo\" id=\"ref-for-dictdef-identityuserinfo③\">IdentityUserInfo</a></code> to <var>userInfoList</var> with the following values:</p>\n        <dl>\n         <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityuserinfo-email\" id=\"ref-for-dom-identityuserinfo-email\">email</a></code>\n         </dt><dd data-md=\"\">\n          <p><var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-email\" id=\"ref-for-dom-identityprovideraccount-email③\">email</a></code>\"]</p>\n         </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityuserinfo-name\" id=\"ref-for-dom-identityuserinfo-name\">name</a></code>\n         </dt><dd data-md=\"\">\n          <p><var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-name\" id=\"ref-for-dom-identityprovideraccount-name③\">name</a></code>\"]</p>\n         </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityuserinfo-givenname\" id=\"ref-for-dom-identityuserinfo-givenname\">givenName</a></code>\n         </dt><dd data-md=\"\">\n          <p><var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-given_name\" id=\"ref-for-dom-identityprovideraccount-given_name①\">given_name</a></code>\"]</p>\n         </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityuserinfo-picture\" id=\"ref-for-dom-identityuserinfo-picture\">picture</a></code>\n         </dt><dd data-md=\"\">\n          <p><var>account</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dom-identityprovideraccount-picture\" id=\"ref-for-dom-identityprovideraccount-picture④\">picture</a></code>\"]</p>\n        </dd></dl>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑤\">DOM manipulation task source</a> given <var>globalObject</var> to\n<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>promise</var> with <var>userInfoList</var>.</p>"
        }
      ]
    },
    {
      "name": "queue to reject",
      "href": "https://w3c-fedid.github.io/FedCM/#queue-to-reject",
      "html": "When asked to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"queue-to-reject\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">queue to reject</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise⑧\">Promise</a></code> <var>promise</var> with a name <var>exceptionName</var>, run\nthe following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: we are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①②\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>globalObject</var> be <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#dom-manipulation-task-source\" id=\"ref-for-dom-manipulation-task-source⑥\">DOM manipulation task source</a> given <var>globalObject</var> to\n<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">reject</a> <var>promise</var> with a new <var>exceptionName</var> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⓪\">DOMException</a></code>.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-validate-capabilities\" id=\"ref-for-dfn-validate-capabilities\">validating capabilities</a>, the extension-specific substeps to validate <code>\"fedcm:accounts\"</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean\">boolean</a> return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error\">WebDriver Error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Otherwise, let <code>deserialized</code> be set to <code>value</code>.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-matching-capabilities\" id=\"ref-for-dfn-matching-capabilities\">matching capabilities</a>, the extension-specific steps to match <code>\"fedcm:accounts\"</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is <code>true</code> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node①\">endpoint node</a> does not support any of the Federated Credential Management commands,\nthe match is unsuccessful.</p>"
        },
        {
          "html": "<p>Otherwise, the match is successful.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If no FedCM dialog is currently open, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①\">WebDriver error</a> with\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Close the dialog and continue the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredential\" id=\"ref-for-create-an-identitycredential②\">create an IdentityCredential</a> algorithm\nas if the user had canceled the dialog without choosing an account.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a href=\"https://tc39.es/ecma262/multipage/structured-data.html#sec-json-object\">Object</a>, return a\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If no FedCM dialog is currently open, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error③\">WebDriver error</a> with\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert①\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Let <var>accountIndex</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties\">getting a property</a> named <code>\"accountIndex\"</code>\nfrom <var>parameters</var>.</p>"
        },
        {
          "html": "<p>If <var>accountIndex</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined③\">undefined</a></code> or is less than 0 or greater than or\nequal to the number of accounts that the user can choose from in the\ncurrent flow, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error④\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④\">error code</a>\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Close the dialog and continue the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#create-an-identitycredential\" id=\"ref-for-create-an-identitycredential③\">create an IdentityCredential</a> algorithm\nas if the user had selected the account indicated by <var>accountIndex</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a href=\"https://tc39.es/ecma262/multipage/structured-data.html#sec-json-object\">Object</a>, return a\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑤\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>dialogButton</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties①\">getting a property</a> named\n<code>\"dialogButton\"</code> from <var>parameters</var>.</p>"
        },
        {
          "html": "<p>If <var>dialogButton</var> is not a string that is \"<code>ConfirmIdpLoginContinue</code>\", return\na <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑥\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If no FedCM dialog is currently open or the dialog is not a <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#confirm-idp-login-dialog\" id=\"ref-for-confirm-idp-login-dialog③\">confirm IDP login dialog</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑦\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert②\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Act as if the user had clicked the \"continue\" button in the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#confirm-idp-login-dialog\" id=\"ref-for-confirm-idp-login-dialog④\">confirm IDP login dialog</a> and initiate the login flow.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If no FedCM dialog is currently open, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑧\">WebDriver error</a> with\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert③\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Let <var>accounts</var> be the list of accounts that the user can or could choose\nfrom in the current flow.</p>"
        },
        {
          "html": "<p>Let <var>list</var> be an empty list.</p>"
        },
        {
          "html": "For each <var>account</var> in <var>accounts</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>accountState</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#compute-the-connection-status\" id=\"ref-for-compute-the-connection-status③\">compute the connection status</a>\nalgorithm given <var>account</var> and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c-fedid.github.io/FedCM/#dictdef-identityproviderrequestoptions\" id=\"ref-for-dictdef-identityproviderrequestoptions⑦\">IdentityProviderRequestOptions</a></code> of the IDP\n<var>account</var> belongs to</p>"
            },
            {
              "html": "<p><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fedcm webdriver error\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fedcm-webdriver-error-create-dictionary\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Create dictionary</dfn><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">Append</a> a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-dictionary\" id=\"ref-for-dfn-dictionary\">dictionary</a> to <var>list</var>\nwith the following properties:</p>",
              "ignored": [
                "accountId set to the account’s id email set to the account’s email name set to the account’s name givenName set to the account’s given_name, if present pictureUrl set to the account’s picture, if present idpConfigUrl set to the configURL of the IDP this account belongs to loginState to \"SignUp\" if accountState is disconnected and \"SignIn\" otherwise"
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③\">success</a> with data <var>list</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If no FedCM dialog is currently open, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑨\">WebDriver error</a> with\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert④\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Let <var>data</var> be a dictionary with an object with properties as follows:</p>",
          "ignored": [
            "title set to the title of the open dialog subtitle set to the subtitle of the open dialog, if there is one"
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④\">success</a> with data <var>data</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If no FedCM dialog is currently open, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⓪\">WebDriver error</a> with\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert⑤\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Let <var>type</var> be a string that is \"<code>AutoReauthn</code>\" if the user is being <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#auto-reauthenticated\" id=\"ref-for-auto-reauthenticated\">auto-reauthenticated</a>,\nor \"<code>AccountChooser</code>\" if the dialog is an account chooser, or \"<code>ConfirmIdpLogin</code>\" if the\ndialog is a <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#confirm-idp-login-dialog\" id=\"ref-for-confirm-idp-login-dialog⑤\">confirm IDP login dialog</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤\">success</a> with data <var>type</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑥\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a href=\"https://tc39.es/ecma262/multipage/structured-data.html#sec-json-object\">Object</a>, return a\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①①\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>enabled</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties②\">getting a property</a> named <code>\"enabled\"</code> from\n<var>parameters</var>.</p>"
        },
        {
          "html": "<p>If <var>enabled</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-undefined\" id=\"ref-for-idl-undefined⑥\">undefined</a></code> or is not a boolean, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①②\">WebDriver error</a>\nwith <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>enabled</var> is false, disables the <a data-link-type=\"dfn\" href=\"https://w3c-fedid.github.io/FedCM/#promise-rejection-delay\" id=\"ref-for-promise-rejection-delay\">promise rejection delay</a>; otherwise,\nre-enables it.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥\">success</a> with data <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑦\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If the user agent uses a cooldown delay, which disables the API for an\namount of time after the user dismissed the dialog, then this command\nresets that cooldown such that the next FedCM call can succeed again.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦\">success</a> with data <code>null</code>.</p>"
        }
      ]
    }
  ]
}