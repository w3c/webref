{
  "spec": {
    "title": "WebDriver BiDi",
    "url": "https://w3c.github.io/webdriver-bidi/"
  },
  "algorithms": [
    {
      "name": "awaits",
      "href": "https://w3c.github.io/webdriver-bidi/#awaits",
      "html": "When an algorithm <var>algorithm</var> running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"awaits\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">awaits</dfn> a set of\nevents <var>events</var>, and <var>resume id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Pause the execution of <var>algorithm</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#wait-queue\" id=\"ref-for-wait-queue\">wait queue</a> does not contain <var>resume id</var>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#wait-queue\" id=\"ref-for-wait-queue①\">wait queue</a>[<var>resume id</var>] to (<var>events</var>, <var>algorithm</var>).</p>"
        }
      ]
    },
    {
      "name": "resume",
      "href": "https://w3c.github.io/webdriver-bidi/#resume",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"resume\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">resume</dfn> given <var>name</var>, <var>id</var> and <var>parameters</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#wait-queue\" id=\"ref-for-wait-queue②\">wait queue</a> does not contain <var>id</var>, return.</p>"
        },
        {
          "html": "<p>Let (<var>events</var>, <var>algorithm</var>) be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#wait-queue\" id=\"ref-for-wait-queue③\">wait queue</a>[<var>id</var>]</p>"
        },
        {
          "html": "For each <var>event</var> in <var>events</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>event</var> equals <var>name</var>:",
              "rationale": "remove",
              "steps": [
                {
                  "html": "<p>Remove <var>id</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#wait-queue\" id=\"ref-for-wait-queue④\">wait queue</a>.</p>"
                },
                {
                  "html": "<p>Resume running the steps in <var>algorithm</var> from the\n point at which they were paused, passing <var>name</var> and <var>parameters</var> as the\n result of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits\">await</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "active BiDi sessions",
      "href": "https://w3c.github.io/webdriver-bidi/#active-bidi-sessions",
      "html": "The list of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"active-bidi-sessions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">active BiDi sessions</dfn> is given by:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>BiDi sessions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a>.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions\">active sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>session</var> is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-session\" id=\"ref-for-bidi-session\">BiDi session</a> append <var>session</var> to <var>BiDi sessions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>BiDi sessions</var>.</p>"
        }
      ]
    },
    {
      "name": "set of sessions for which an event is enabled",
      "href": "https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"set-of-sessions-for-which-an-event-is-enabled\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set of sessions for which an event is enabled</dfn> given <var>event name</var> and <var>navigables</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>sessions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">set</a>.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions\">active BiDi sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-is-enabled\" id=\"ref-for-event-is-enabled\">event is enabled</a> with <var>session</var>, <var>event name</var> and <var>navigables</var>,\nappend <var>session</var> to <var>sessions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>sessions</var>.</p>"
        }
      ]
    },
    {
      "name": "event is enabled",
      "href": "https://w3c.github.io/webdriver-bidi/#event-is-enabled",
      "html": "To determine if an <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"event-is-enabled\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">event is enabled</dfn> given <var>session</var>,\n<var>event name</var> and <var>navigables</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>top-level traversables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-top-level-traversables\" id=\"ref-for-get-top-level-traversables\">get top-level traversables</a> with <var>navigables</var>.</p>"
        },
        {
          "html": "For each <var>subscription</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions①\">subscriptions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names①\">event names</a> do not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> <var>event name</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>subscription</var> is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-global\" id=\"ref-for-subscription-global\">global</a> return true.</p>"
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids①\">user context ids</a> is not empty:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>navigable</var> in <var>top-level traversables</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids②\">user context ids</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a>\n  <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context\">associated user context</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id\">user context id</a>, return true.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>subscription top-level traversables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-navigables-by-ids\" id=\"ref-for-get-navigables-by-ids\">get navigables by ids</a> with <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids①\">top-level traversable ids</a>.</p>"
                },
                {
                  "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection\">intersection</a> of <var>top-level traversables</var> and\n <var>subscription top-level traversables</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty\">empty</a> return true.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "set of top-level traversables for which an event is enabled",
      "href": "https://w3c.github.io/webdriver-bidi/#set-of-top-level-traversables-for-which-an-event-is-enabled",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"set-of-top-level-traversables-for-which-an-event-is-enabled\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set of top-level traversables for which an event is enabled</dfn>\ngiven <var>event name</var> and <var>session</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥\">set</a>.</p>"
        },
        {
          "html": "For each <var>subscription</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions②\">subscriptions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names②\">event names</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">does not contain</a> <var>event name</var>,\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "If <var>subscription</var>’s is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-global\" id=\"ref-for-subscription-global①\">global</a>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each <var>traversable</var> in remote end’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①\">top-level traversables</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>traversable</var> to <var>result</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids③\">user context ids</a> is not empty:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each <var>traversable</var> in remote end’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②\">top-level traversables</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>traversable</var> to <var>result</var> if\n  <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids④\">user context ids</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a>\n  <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①\">associated user context</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id①\">user context id</a>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>top-level traversables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-navigables-by-ids\" id=\"ref-for-get-navigables-by-ids①\">get navigables by ids</a> with <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids②\">top-level traversable ids</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">Append</a> each item of <var>top-level traversables</var> to <var>result</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "obtain a set of event names",
      "href": "https://w3c.github.io/webdriver-bidi/#obtain-a-set-of-event-names",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"obtain-a-set-of-event-names\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a set of event names</dfn> given a <var>name</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>events</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑦\">set</a>.</p>"
        },
        {
          "html": "If <var>name</var> contains a U+002E (period):",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>name</var> is the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-event-name\" id=\"ref-for-event-event-name①\">event name</a> for an event, append <var>name</var> to <var>events</var>\n and return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <var>events</var>.</p>"
            },
            {
              "html": "<p>Return an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument\">invalid argument</a></p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise <var>name</var> is interpreted as representing all the events in a\n module. If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#module-module-name\" id=\"ref-for-module-module-name②\">module name</a> return an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Append the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-event-name\" id=\"ref-for-event-event-name②\">event name</a> for each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event\" id=\"ref-for-event②\">event</a> in the module with name <var>name</var> to\n <var>events</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①\">success</a> with data <var>events</var>.</p>"
        }
      ]
    },
    {
      "html": "When a client <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-4.1\" id=\"ref-for-section-4.1\">establishes a WebSocket connection</a> <var>connection</var> by\nconnecting to one of the set of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-listeners\" id=\"ref-for-active-listeners\">active listeners</a> <var>listener</var>, the\nimplementation must proceed according to the WebSocket <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-4.2\" id=\"ref-for-section-4.2\">server-side requirements</a>, with the following steps run when deciding whether to\naccept the incoming connection:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>resource name</var> be the resource name from <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-4.2.1\" id=\"ref-for-section-4.2.1\">reading the client’s opening handshake</a>. If <var>resource name</var> is not in\n <var>listener</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#list-of-websocket-resources\" id=\"ref-for-list-of-websocket-resources\">list of WebSocket resources</a>, then stop\n running these steps and act as if the requested service is not\n available.</p>"
        },
        {
          "html": "If <var>resource name</var> is the byte string \"<code>/session</code>\",\n and the implementation <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#supports-bidi-only-sessions\" id=\"ref-for-supports-bidi-only-sessions\">supports BiDi-only sessions</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run any other implementation-defined steps to decide if the\n connection should be accepted, and if it is not stop running these\n steps and act as if the requested service is not available.</p>"
            },
            {
              "html": "<p>Add the connection to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connections-not-associated-with-a-session\" id=\"ref-for-websocket-connections-not-associated-with-a-session\">WebSocket connections not associated with a session</a>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-session-id-for-a-websocket-resource\" id=\"ref-for-get-a-session-id-for-a-websocket-resource\">Get a session ID for a WebSocket resource</a> with <var>resource name</var>\n and let <var>session id</var> be that value. If <var>session id</var> is null then\n stop running these steps and act as if the requested service is not\n available.</p>"
        },
        {
          "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-sessions\" id=\"ref-for-dfn-sessions③\">session</a> in the list of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions①\">active sessions</a> with\n <var>session id</var> as its <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-id\" id=\"ref-for-dfn-session-id\">session ID</a> then let <var>session</var> be that\n session. Otherwise stop running these steps and act as if the\n requested service is not available.</p>"
        },
        {
          "html": "<p>Run any other implementation-defined steps to decide if the\n connection should be accepted, and if it is not stop running these\n steps and act as if the requested service is not available.</p>"
        },
        {
          "html": "<p>Otherwise append <var>connection</var> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-websocket-connections\" id=\"ref-for-session-websocket-connections①\">session WebSocket connections</a>, and proceed with the WebSocket <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-4.2\" id=\"ref-for-section-4.2①\">server-side requirements</a>\n when a server chooses to accept an incoming connection.</p>"
        }
      ]
    },
    {
      "name": "construct a WebSocket resource name",
      "href": "https://w3c.github.io/webdriver-bidi/#construct-a-websocket-resource-name",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"construct-a-websocket-resource-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">construct a WebSocket resource name</dfn>\ngiven a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-sessions\" id=\"ref-for-dfn-sessions④\">session</a> <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var> is null, return \"<code>/session</code>\"</p>"
        },
        {
          "html": "<p>Return the result of concatenating the string \"<code>/session/</code>\"\n with <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-id\" id=\"ref-for-dfn-session-id①\">session ID</a>.</p>"
        }
      ]
    },
    {
      "name": "construct a WebSocket URL",
      "href": "https://w3c.github.io/webdriver-bidi/#construct-a-websocket-url",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"construct-a-websocket-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">construct a WebSocket URL</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-listener\" id=\"ref-for-websocket-listener③\">WebSocket listener</a>\n<var>listener</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-sessions\" id=\"ref-for-dfn-sessions⑤\">session</a> <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>resource name</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#construct-a-websocket-resource-name\" id=\"ref-for-construct-a-websocket-resource-name\">construct a WebSocket resource name</a> with <var>session</var>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-3\" id=\"ref-for-section-3\">WebSocket URI</a> constructed with host set to\n <var>listener</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-host\" id=\"ref-for-listener-host①\">host</a>, port set to <var>listener</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-port\" id=\"ref-for-listener-port①\">port</a>, path set to <var>resource name</var>, following the wss-URI\n construct if <var>listener</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-secure-flag\" id=\"ref-for-listener-secure-flag①\">secure flag</a> is set and the ws-URL\n construct otherwise.</p>"
        }
      ]
    },
    {
      "name": "get a session ID for a WebSocket resource",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-session-id-for-a-websocket-resource",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-session-id-for-a-websocket-resource\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a session ID for a WebSocket resource</dfn>\ngiven <var>resource name</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>resource name</var> doesn’t begin with the byte string\n \"<code>/session/</code>\", return null.</p>"
        },
        {
          "html": "<p>Let <var>session id</var> be the bytes in <var>resource name</var> following the\n \"<code>/session/</code>\" prefix.</p>"
        },
        {
          "html": "<p>If <var>session id</var> is not the string representation of a\n <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>, return null.</p>"
        },
        {
          "html": "<p>Return <var>session id</var>.</p>"
        }
      ]
    },
    {
      "name": "start listening for a WebSocket connection",
      "href": "https://w3c.github.io/webdriver-bidi/#start-listening-for-a-websocket-connection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"start-listening-for-a-websocket-connection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">start listening for a WebSocket connection</dfn> given a\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-sessions\" id=\"ref-for-dfn-sessions⑥\">session</a> <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If there is an existing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-listener\" id=\"ref-for-websocket-listener④\">WebSocket listener</a> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-listeners\" id=\"ref-for-active-listeners①\">active listeners</a> which\n the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends①③\">remote end</a> would like to reuse, let <var>listener</var> be that\n listener. Otherwise let <var>listener</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-listener\" id=\"ref-for-websocket-listener⑤\">WebSocket listener</a> with\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-host\" id=\"ref-for-listener-host②\">host</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-port\" id=\"ref-for-listener-port②\">port</a>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#listener-secure-flag\" id=\"ref-for-listener-secure-flag②\">secure flag</a>, and an empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#list-of-websocket-resources\" id=\"ref-for-list-of-websocket-resources①\">list of WebSocket resources</a>.</p>"
        },
        {
          "html": "<p>Let <var>resource name</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#construct-a-websocket-resource-name\" id=\"ref-for-construct-a-websocket-resource-name①\">construct a WebSocket resource name</a> with <var>session</var>.</p>"
        },
        {
          "html": "<p>Append <var>resource name</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#list-of-websocket-resources\" id=\"ref-for-list-of-websocket-resources②\">list of WebSocket resources</a> for\n <var>listener</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> <var>listener</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends①④\">remote end</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-listeners\" id=\"ref-for-active-listeners②\">active listeners</a>.</p>"
        },
        {
          "html": "<p>Return <var>listener</var>.</p>"
        }
      ]
    },
    {
      "name": "handle an incoming message",
      "href": "https://w3c.github.io/webdriver-bidi/#handle-an-incoming-message",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-an-incoming-message\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle an incoming message</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connection\" id=\"ref-for-websocket-connection④\">WebSocket connection</a>\n<var>connection</var>, type <var>type</var> and data <var>data</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>type</var> is not <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-5.2\" id=\"ref-for-section-5.2\">text</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#send-an-error-response\" id=\"ref-for-send-an-error-response\">send an error response</a> given <var>connection</var>, null, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②\">invalid argument</a>, and finally\n return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>data</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#scalar-value-string\" id=\"ref-for-scalar-value-string\">scalar value string</a>, because the\n  WebSocket <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-8.1\" id=\"ref-for-section-8.1\">handling errors in UTF-8-encoded data</a> would already\n  have <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7\" id=\"ref-for-section-7.1.7\">failed the WebSocket\n  connection</a> otherwise.</p>"
        },
        {
          "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-session\" id=\"ref-for-bidi-session⑦\">BiDi Session</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-with-connection\" id=\"ref-for-associated-with-connection\">associated with connection</a> <var>connection</var>,\n let <var>session</var> be that session. Otherwise if <var>connection</var> is in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connections-not-associated-with-a-session\" id=\"ref-for-websocket-connections-not-associated-with-a-session①\">WebSocket connections not associated with a session</a>, let <var>session</var> be\n null. Otherwise, return.</p>"
        },
        {
          "html": "<p>Let <var>parsed</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#parse-a-json-string-to-an-infra-value\" id=\"ref-for-parse-a-json-string-to-an-infra-value\">parsing JSON\n into Infra values</a> given <var>data</var>. If this throws an exception, then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#send-an-error-response\" id=\"ref-for-send-an-error-response①\">send an error response</a> given <var>connection</var>, null, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③\">invalid argument</a>, and\n finally return.</p>"
        },
        {
          "html": "<p>If <var>session</var> is not null and not in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions②\">active sessions</a> then return.</p>"
        },
        {
          "html": "Match <var>parsed</var> against the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-remote-end-definition\" id=\"ref-for-cddl-module-remote-end-definition⑤\">remote end definition</a></code>. If this results in a\n match:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>matched</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①\">map</a> representing the matched data.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>matched</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">contains</a> \"<code>id</code>\", \"<code>method</code>\", and\n  \"<code>params</code>\".</p>"
            },
            {
              "html": "<p>Let <var>command id</var> be <var>matched</var>[\"<code>id</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>method</var> be <var>matched</var>[\"<code>method</code>\"]</p>"
            },
            {
              "html": "<p>Let <var>command</var> be the command with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#command-command-name\" id=\"ref-for-command-command-name③\">command name</a> <var>method</var>.</p>"
            },
            {
              "html": "<p>If <var>session</var> is null and <var>command</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#static-command\" id=\"ref-for-static-command\">static command</a>, then\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#send-an-error-response\" id=\"ref-for-send-an-error-response②\">send an error response</a> given <var>connection</var>, <var>command id</var>, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-session-id\" id=\"ref-for-dfn-invalid-session-id\">invalid session id</a>, and return.</p>"
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>result</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①\">remote end steps</a> for\n  <var>command</var> given <var>session</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#command-command-parameters\" id=\"ref-for-command-command-parameters①\">command parameters</a>\n  <var>matched</var>[\"<code>params</code>\"]</p>"
                },
                {
                  "html": "<p>If <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②\">error</a>, then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#send-an-error-response\" id=\"ref-for-send-an-error-response③\">send an error response</a> given\n <var>connection</var>, <var>command id</var>, and <var>result</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③\">error code</a>, and finally\n return.</p>"
                },
                {
                  "html": "<p>Let <var>value</var> be <var>result</var>’s data.</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: <var>value</var> matches the definition for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#command-result-type\" id=\"ref-for-command-result-type①\">result type</a>\n corresponding to the command with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#command-command-name\" id=\"ref-for-command-command-name④\">command name</a> <var>method</var>.</p>"
                },
                {
                  "html": "<p>If <var>method</var> is \"<code>session.new</code>\", let <var>session</var> be the entry in\n the list of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions③\">active sessions</a> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-id\" id=\"ref-for-dfn-session-id②\">session ID</a> is equal to the\n \"<code>sessionId</code>\" property of <var>value</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">append</a>\n <var>connection</var> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-websocket-connections\" id=\"ref-for-session-websocket-connections②\">session WebSocket connections</a>, and\n remove <var>connection</var> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connections-not-associated-with-a-session\" id=\"ref-for-websocket-connections-not-associated-with-a-session②\">WebSocket connections not associated with a session</a>.</p>"
                },
                {
                  "html": "<p>Let <var>response</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">map</a> matching the <code>CommandResponse</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑦\">local end definition</a></code> with the <code>id</code>\n field set to <var>command id</var> and the <code>value</code> field set to\n <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes\">serialize an infra value to JSON bytes</a> given <var>response</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1\">Send a WebSocket message</a> comprised of <var>serialized</var> over\n <var>connection</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>command id</var> be null.</p>"
            },
            {
              "html": "<p>If <var>parsed</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③\">map</a> and <var>parsed</var>[\"<code>id</code>\"] exists and is an\n  integer greater than or equal to zero, set <var>command id</var> to that integer.</p>"
            },
            {
              "html": "<p>Let <var>error code</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>If <var>parsed</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">map</a> and <var>parsed</var>[\"<code>method</code>\"] exists and is a\n  string, but <var>parsed</var>[\"<code>method</code>\"] is not in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-all-command-names\" id=\"ref-for-set-of-all-command-names\">set of all command names</a>, set <var>error code</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-command\" id=\"ref-for-dfn-unknown-command\">unknown command</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#send-an-error-response\" id=\"ref-for-send-an-error-response④\">Send an error response</a> given <var>connection</var>, <var>command id</var>, and\n  <var>error code</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get related navigables",
      "href": "https://w3c.github.io/webdriver-bidi/#get-related-navigables",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-related-navigables\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get related navigables</dfn> given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#settings-object\" id=\"ref-for-settings-object\">settings object</a>\n<var>settings</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>related navigables</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①①\">set</a>.</p>"
        },
        {
          "html": "If <var>settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated\n  <code>Document</code></a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable\">node navigable</a>.</p>"
            },
            {
              "html": "<p>If <var>navigable</var> is not null, append <var>navigable</var> to <var>related navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise if the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a> specified by <var>settings</var> is a\n <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope\" id=\"ref-for-workerglobalscope\">WorkerGlobalScope</a></code>, for each <var>owner</var> in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set\" id=\"ref-for-concept-WorkerGlobalScope-owner-set\">owner set</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be null.</p>"
            },
            {
              "html": "<p>If <var>owner</var> is a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document\">Document</a>, set <var>navigable</var> to <var>owner</var>’s\n  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①\">node navigable</a>.</p>"
            },
            {
              "html": "<p>If <var>navigable</var> is not null, append <var>navigable</var> to <var>related navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>related navigables</var>.</p>"
        }
      ]
    },
    {
      "name": "get navigables by ids",
      "href": "https://w3c.github.io/webdriver-bidi/#get-navigables-by-ids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-navigables-by-ids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get navigables by ids</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a> of context ids <var>navigable ids</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①②\">set</a>.</p>"
        },
        {
          "html": "For each <var>navigable id</var> in <var>navigable ids</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables\">navigable</a> with id <var>navigable id</var>\n  if such <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables①\">navigable</a> exists, and null otherwise.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">Append</a> <var>navigable</var> to <var>result</var> if <var>navigable</var> is not null.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "get top-level traversables",
      "href": "https://w3c.github.io/webdriver-bidi/#get-top-level-traversables",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-top-level-traversables\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get top-level traversables</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②\">navigables</a> <var>navigables</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①③\">set</a>.</p>"
        },
        {
          "html": "For each <var>navigable</var> in <var>navigables</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top\">top-level traversable</a> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "get valid navigables by ids",
      "href": "https://w3c.github.io/webdriver-bidi/#get-valid-navigables-by-ids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-valid-navigables-by-ids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get valid navigables by ids</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a> of context ids <var>navigable ids</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①④\">set</a>.</p>"
        },
        {
          "html": "For each <var>navigable id</var> in <var>navigable ids</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable\">get a navigable</a> with <var>navigable id</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑦\">Append</a> <var>navigable</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "get valid top-level traversables by ids",
      "href": "https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-valid-top-level-traversables-by-ids\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get valid top-level traversables by ids</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a> of context ids <var>navigable ids</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⑤\">set</a>.</p>"
        },
        {
          "html": "For each <var>navigable id</var> in <var>navigable ids</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①\">get a navigable</a> with <var>navigable id</var>.</p>"
            },
            {
              "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③\">error</a>\n  with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤\">invalid argument</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑧\">Append</a> <var>navigable</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "emit an event",
      "href": "https://w3c.github.io/webdriver-bidi/#emit-an-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"emit-an-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">emit an event</dfn> given <var>session</var>, and <var>body</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>body</var> matches the <code>Event</code> production.</p>"
        },
        {
          "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes①\">serialize an infra value to JSON bytes</a> given <var>body</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>connection</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-websocket-connections\" id=\"ref-for-session-websocket-connections③\">session WebSocket connections</a>:",
          "rationale": "send",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1①\">Send a WebSocket message</a> comprised of <var>serialized</var> over <var>connection</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "send an error response",
      "href": "https://w3c.github.io/webdriver-bidi/#send-an-error-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"send-an-error-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">send an error response</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connection\" id=\"ref-for-websocket-connection⑤\">WebSocket connection</a>\n<var>connection</var>, <var>command id</var>, and <var>error code</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>error data</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">map</a> matching the <code>ErrorResponse</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑧\">local end definition</a></code>, with the <code>id</code> field\n set to <var>command id</var>, the <code>error</code> field set to <var>error code</var>, the\n <code>message</code> field set to an implementation-defined string\n containing a human-readable definition of the error that occurred and the\n <code>stacktrace</code> field optionally set to an implementation-defined\n string containing a stack trace report of the active stack frames at the\n time when the error occurred.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-an-infra-value-to-json-bytes\" id=\"ref-for-serialize-an-infra-value-to-json-bytes②\">serialize an infra value to JSON bytes</a>\n given <var>error data</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1②\">Send a WebSocket message</a> comprised of <var>response</var> over <var>connection</var>.</p>"
        }
      ]
    },
    {
      "name": "handle a connection closing",
      "href": "https://w3c.github.io/webdriver-bidi/#handle-a-connection-closing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-a-connection-closing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle a connection closing</dfn> given a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connection\" id=\"ref-for-websocket-connection⑥\">WebSocket connection</a>\n<var>connection</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If there is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-session\" id=\"ref-for-bidi-session⑧\">BiDi session</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-with-connection\" id=\"ref-for-associated-with-connection①\">associated with connection</a> <var>connection</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>session</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-session\" id=\"ref-for-bidi-session⑨\">BiDi session</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-with-connection\" id=\"ref-for-associated-with-connection②\">associated with connection</a>\n <var>connection</var>.</p>"
            },
            {
              "html": "<p>Remove <var>connection</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-websocket-connections\" id=\"ref-for-session-websocket-connections④\">session WebSocket connections</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, if <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#websocket-connections-not-associated-with-a-session\" id=\"ref-for-websocket-connections-not-associated-with-a-session③\">WebSocket connections not associated with a session</a>\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain④\">contains</a> <var>connection</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">remove</a> <var>connection</var> from that set.</p>"
        }
      ]
    },
    {
      "name": "close the WebSocket connections",
      "href": "https://w3c.github.io/webdriver-bidi/#close-the-websocket-connections",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"close-the-websocket-connections\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">close the WebSocket connections</dfn> given <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>connection</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-websocket-connections\" id=\"ref-for-session-websocket-connections⑤\">session WebSocket connections</a>:",
          "rationale": "start",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.2\" id=\"ref-for-section-7.1.2\">Start the WebSocket closing handshake</a> with <var>connection</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "webSocketUrl new session algorithm",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-webdriver-new-session-algorithms\" id=\"ref-for-dfn-webdriver-new-session-algorithms\">WebDriver new session algorithm</a> defined by this specification,\nwith parameters <var>session</var>, <var>capabilities</var>, and <var>flags</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>flags</var> contains \"<code>bidi</code>\", return.</p>"
        },
        {
          "html": "<p>Let <var>webSocketUrl</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties\">getting a property</a> named\n \"<code>webSocketUrl</code>\" from <var>capabilities</var>.</p>"
        },
        {
          "html": "<p>If <var>webSocketUrl</var> is undefined, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>webSocketUrl</var> is true.</p>"
        },
        {
          "html": "<p>Let <var>listener</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#start-listening-for-a-websocket-connection\" id=\"ref-for-start-listening-for-a-websocket-connection\">start listening for a WebSocket connection</a> given <var>session</var>.</p>"
        },
        {
          "html": "<p>Set <var>webSocketUrl</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#construct-a-websocket-url\" id=\"ref-for-construct-a-websocket-url\">construct a WebSocket URL</a> with <var>listener</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-set-a-property\" id=\"ref-for-dfn-set-a-property\">Set a property</a> on <var>capabilities</var> named\n \"<code>webSocketUrl</code>\" to <var>webSocketUrl</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-flag\" id=\"ref-for-bidi-flag①\">BiDi flag</a> to true.</p>"
        },
        {
          "html": "<p>Append \"<code>bidi</code>\" to flags.</p>"
        }
      ]
    },
    {
      "name": "no HTTP new session",
      "href": "https://w3c.github.io/webdriver-bidi/#supports-bidi-only-sessions",
      "html": "Implementations should also allow clients to establish a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-session\" id=\"ref-for-bidi-session①⓪\">BiDi Session</a> which\nis not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-http-session\" id=\"ref-for-dfn-http-session\">HTTP Session</a>. In this case the URL to the WebSocket server is\ncommunicated out-of-band. An implementation that allows this <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"supports BiDi-only sessions\" data-noexport=\"\" id=\"supports-bidi-only-sessions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">supports\nBiDi-only sessions</dfn>. At the time such an implementation is ready to accept\nrequests to start a WebDriver session, it must:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#start-listening-for-a-websocket-connection\" id=\"ref-for-start-listening-for-a-websocket-connection①\">Start listening for a WebSocket connection</a> given null.</p>"
        }
      ]
    },
    {
      "name": "get or create a sandbox realm",
      "href": "https://w3c.github.io/webdriver-bidi/#get-or-create-a-sandbox-realm",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-or-create-a-sandbox-realm\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get or create a sandbox realm</dfn> given <var>name</var> and <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is an empty string, then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>window</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window\">active window</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#sandbox-map\" id=\"ref-for-sandbox-map\">sandbox map</a> does not contain <var>window</var>, set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#sandbox-map\" id=\"ref-for-sandbox-map①\">sandbox map</a>[<var>window</var>]\n to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">map</a>.</p>"
        },
        {
          "html": "<p>Let <var>sandboxes</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#sandbox-map\" id=\"ref-for-sandbox-map②\">sandbox map</a>[<var>window</var>].</p>"
        },
        {
          "html": "<p>If <var>sandboxes</var> does not contain <var>name</var>, set <var>sandboxes</var>[<var>name</var>] to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#create-a-sandbox-realm\" id=\"ref-for-create-a-sandbox-realm\">create a sandbox realm</a> with <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④\">success</a> with data <var>sandboxes</var>[<var>name</var>].</p>"
        }
      ]
    },
    {
      "name": "get a sandbox name",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-sandbox-name",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-sandbox-name\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a sandbox name</dfn> given <var>target realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realms maps</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values\">get the values</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#sandbox-map\" id=\"ref-for-sandbox-map③\">sandbox map</a>.</p>"
        },
        {
          "html": "For each <var>realms map</var> in <var>realms maps</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <var>name</var> → <var>realm</var> in <var>realms map</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>realm</var> is <var>target realm</var>, return <var>name</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "unwrapped",
      "href": "https://w3c.github.io/webdriver-bidi/#unwrapped",
      "html": "To get <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"unwrapped\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unwrapped</dfn> <var>object</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>While <var>object</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webdriver-bidi/#sandboxproxy\" id=\"ref-for-sandboxproxy③\">SandboxProxy</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webdriver-bidi/#sandboxwindowproxy\" id=\"ref-for-sandboxwindowproxy②\">SandboxWindowProxy</a></code>, set <var>object</var> to it’s\n wrapped object.</p>"
        },
        {
          "html": "<p>Return <var>object</var>.</p>"
        }
      ]
    },
    {
      "name": "remove user context subscriptions",
      "href": "https://w3c.github.io/webdriver-bidi/#remove-user-context-subscriptions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"remove-user-context-subscriptions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove user context subscriptions</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions④\">active sessions</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>subscriptions to remove</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⑦\">set</a>.</p>"
            },
            {
              "html": "For each <var>subscription</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions③\">subscriptions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids⑤\">user context ids</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑤\">contains</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context⑧\">associated user context</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id③\">user context id</a>;",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">Remove</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context⑨\">associated user context</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id④\">user context id</a> from <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids⑥\">user context ids</a>.</p>"
                    },
                    {
                      "html": "If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids⑦\">user context ids</a> is empty:",
                      "rationale": "append",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⓪\">Append</a> <var>subscription</var> to <var>subscriptions to remove</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove④\">Remove</a> <var>subscriptions to remove</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions④\">subscriptions</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get user context",
      "href": "https://w3c.github.io/webdriver-bidi/#get-user-context",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-user-context\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get user context</dfn> given <var>user context id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>For each <var>user context</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts⑥\">set of user contexts</a>:</p>"
        },
        {
          "html": "If <var>user context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id⑤\">user context id</a> equals <var>user context id</var>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <var>user context</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "get valid user contexts",
      "href": "https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-valid-user-contexts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get valid user contexts</dfn> given <var>user context ids</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⑧\">set</a>.</p>"
        },
        {
          "html": "For each <var>user context id</var> of <var>user context ids</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>user context</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context\">get user context</a> with <var>user context id</var>.</p>"
            },
            {
              "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-user-context\" id=\"ref-for-errors-no-such-user-context\">no such user context</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①①\">Append</a> <var>user context</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "end the session",
      "href": "https://w3c.github.io/webdriver-bidi/#end-the-session",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"end-the-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">end the session</dfn> given <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Remove <var>session</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions⑤\">active sessions</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions⑥\">active sessions</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①\">empty</a>, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-webdriver-active-flag\" id=\"ref-for-dfn-webdriver-active-flag\">webdriver-active flag</a>\n to false.</p>"
        }
      ]
    },
    {
      "name": "cleanup the session",
      "href": "https://w3c.github.io/webdriver-bidi/#cleanup-the-session",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cleanup-the-session\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cleanup the session</dfn> given <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#close-the-websocket-connections\" id=\"ref-for-close-the-websocket-connections\">Close the WebSocket connections</a> with <var>session</var>.</p>"
        },
        {
          "html": "For each <var>user context</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts⑦\">set of user contexts</a>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove\">Remove</a> <var>session</var>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-accept-insecure-certificates-override-map\" id=\"ref-for-user-context-to-accept-insecure-certificates-override-map\">user context to accept insecure certificates override map</a>[<var>user context</var>].</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①\">Remove</a> <var>session</var>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-proxy-configuration-map\" id=\"ref-for-user-context-to-proxy-configuration-map\">user context to proxy configuration map</a>[<var>user context</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>For each <var>request id</var> → (<var>request</var>, <var>phase</var>, <var>response</var>)\n in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map\">blocked request map</a>:</p>",
          "ignored": [
            "Resume with \"continue request\", request id and (response, \"incomplete\")."
          ]
        },
        {
          "html": "For each <var>collector</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors\">network collectors</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>collector id</var> be <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-collector\" id=\"ref-for-network-collector-collector\">collector</a>.</p>"
            },
            {
              "html": "<p>For each <var>collected data</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data\">collected network data</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#remove-collector-from-data\" id=\"ref-for-remove-collector-from-data\">remove collector from data</a>\n  with <var>collected data</var> and <var>collector id</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions⑦\">active sessions</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty②\">empty</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#cleanup-remote-end-state\" id=\"ref-for-cleanup-remote-end-state\">cleanup remote end state</a>.</p>"
        },
        {
          "html": "<p>Perform any implementation-specific cleanup steps.</p>"
        }
      ]
    },
    {
      "name": "cleanup remote end state",
      "href": "https://w3c.github.io/webdriver-bidi/#cleanup-remote-end-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cleanup-remote-end-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cleanup remote end state</dfn>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clear\" id=\"ref-for-map-clear\">Clear</a> the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map\">before request sent map</a>.</p>"
        },
        {
          "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-cache-behavior\" id=\"ref-for-default-cache-behavior\">default cache behavior</a> to \"<code>default</code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clear\" id=\"ref-for-map-clear①\">Clear</a> the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map\">navigable cache behavior map</a>.</p>"
        },
        {
          "html": "<p>Perform implementation-defined steps to enable any\n implementation-specific resource caches that are usually enabled in the\n current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends①⑦\">remote end</a> configuration.</p>"
        }
      ]
    },
    {
      "name": "webSocketUrl capability deserialization algorithm",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-additional-capability-deserialization-algorithm\" id=\"ref-for-dfn-additional-capability-deserialization-algorithm\">additional capability deserialization algorithm</a> for the\n\"<code>webSocketUrl</code>\" capability, with parameter <var>value</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is not a boolean, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦\">code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤\">success</a> with data <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "webSocketUrl capability serialization algorithm",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-matched-capability-serialization-algorithm\" id=\"ref-for-dfn-matched-capability-serialization-algorithm\">matched capability serialization algorithm</a> for the \"<code>webSocketUrl</code>\" capability,\nwith parameter <var>value</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var> is false, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥\">success</a> with data null.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦\">success</a> with data true.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for session.status",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②\">remote end steps</a> given <var>session</var>, and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨\">map</a> with the following properties:</p>\n      <dl>\n       <dt>\"ready\"\n       </dt><dd>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends①⑧\">remote end</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-readiness-state\" id=\"ref-for-dfn-readiness-state\">readiness state</a>.\n       </dd><dt>\"message\"\n       </dt><dd>An implementation-defined string explaining the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends①⑨\">remote end</a>’s\n    <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-readiness-state\" id=\"ref-for-dfn-readiness-state①\">readiness state</a>.\n      </dd></dl>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧\">success</a> with data <var>body</var></p>"
        }
      ]
    },
    {
      "name": "remote end steps for session.new",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>session</var> is not null, return an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-not-created\" id=\"ref-for-dfn-session-not-created\">session not created</a>.</p>"
        },
        {
          "html": "<p>If the implementation is unable to start a new session for any reason, return\n an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-not-created\" id=\"ref-for-dfn-session-not-created①\">session not created</a>.</p>"
        },
        {
          "html": "<p>Let <var>flags</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⑨\">set</a> containing \"<code>bidi</code>\".</p>"
        },
        {
          "html": "<p>Let <var>capabilities json</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-capabilities-processing\" id=\"ref-for-dfn-capabilities-processing\">process capabilities</a>\n with <var>command parameters</var> and <var>flags</var>.</p>"
        },
        {
          "html": "<p>Let <var>capabilities</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#convert-a-json-derived-javascript-value-to-an-infra-value\" id=\"ref-for-convert-a-json-derived-javascript-value-to-an-infra-value\">convert a JSON-derived JavaScript value to an Infra value</a> with <var>capabilities json</var>.</p>"
        },
        {
          "html": "<p>Let <var>session</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-create-a-session\" id=\"ref-for-dfn-create-a-session\">create a session</a> with\n <var>capabilities</var> and <var>flags</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#bidi-flag\" id=\"ref-for-bidi-flag②\">BiDi flag</a> to true.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪\">map</a> matching the <code>session.NewResult</code> production,\n with the <code>sessionId</code> field set to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-session-id\" id=\"ref-for-dfn-session-id③\">session ID</a>, and\n the <code>capabilities</code> field set to <var>capabilities</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for session.end",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#end-the-session\" id=\"ref-for-end-the-session\">End the session</a> with <var>session</var>.</p>"
        },
        {
          "html": "Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪\">success</a> with data null, and in parallel run the following steps:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait until the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1③\">Send a WebSocket message</a> steps have been called with the\n response to this command.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#cleanup-the-session\" id=\"ref-for-cleanup-the-session\">Cleanup the session</a> with <var>session</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for session.subscribe",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>event names</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⓪\">set</a>.</p>"
        },
        {
          "html": "<p>For each entry <var>name</var> in <var>command parameters</var>[\"<code>events</code>\"],\n let <var>event names</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">union</a> of <var>event names</var> and the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#obtain-a-set-of-event-names\" id=\"ref-for-obtain-a-set-of-event-names\">obtain a set of event names</a> with <var>name</var>.</p>"
        },
        {
          "html": "<p>Let <var>input user context ids</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create\">create a set</a> with <var>command parameters</var>[<code>userContexts</code>].</p>"
        },
        {
          "html": "<p>Let <var>input context ids</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create①\">create a set</a> with <var>command parameters</var>[<code>contexts</code>].</p>"
        },
        {
          "html": "<p>If <var>input user context ids</var> is not empty and <var>input context ids</var> is not empty,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>subscription navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②①\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>top-level traversable context ids</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②②\">set</a>.</p>"
        },
        {
          "html": "If <var>input context ids</var> is not empty:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-navigables-by-ids\" id=\"ref-for-get-valid-navigables-by-ids\">get valid navigables by ids</a> with <var>input context ids</var>.</p>"
            },
            {
              "html": "<p>Set <var>subscription navigables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-top-level-traversables\" id=\"ref-for-get-top-level-traversables①\">get top-level traversables</a> with <var>navigables</var>.</p>"
            },
            {
              "html": "For each <var>navigable</var> in <var>subscription navigables</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①②\">Append</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id\">navigable id</a> to <var>top-level traversable context ids</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise, if <var>input user context ids</var> is not empty:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>user context id</var> of <var>input user context ids</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>user context</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context①\">get user context</a> with <var>user context id</var>.</p>"
                },
                {
                  "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-user-context\" id=\"ref-for-errors-no-such-user-context①\">no such user context</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>top-level traversable</var> in the list of all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①⓪\">top-level traversables</a>\n  whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⓪\">associated user context</a> is <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>top-level traversable</var> to <var>subscription navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Otherwise, set <var>subscription navigables</var> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②③\">set</a> of all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①\">top-level traversables</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends②⓪\">remote end</a>.</p>"
        },
        {
          "html": "<p>Let <var>subscription</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscription\" id=\"ref-for-event-subscription①\">subscription</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id①\">subscription id</a> set to the string representation of a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names③\">event names</a> set to <var>event names</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids③\">top-level traversable ids</a> set to <var>top-level traversable context ids</var> and\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-user-context-ids\" id=\"ref-for-subscription-user-context-ids⑧\">user context ids</a> set to <var>input user context ids</var>.</p>"
        },
        {
          "html": "<p>Let <var>subscribe step events</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①\">map</a>.</p>"
        },
        {
          "html": "For each <var>event name</var> in the <var>event names</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event\" id=\"ref-for-event④\">event</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-event-name\" id=\"ref-for-event-event-name③\">event name</a> <var>event name</var> does not define <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-subscribe-steps\" id=\"ref-for-event-remote-end-subscribe-steps\">remote end subscribe steps</a>, continue;</p>"
            },
            {
              "html": "<p>Let <var>existing navigables</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-top-level-traversables-for-which-an-event-is-enabled\" id=\"ref-for-set-of-top-level-traversables-for-which-an-event-is-enabled\">set of top-level traversables for which an event is enabled</a> with <var>session</var> and <var>event name</var>.</p>"
            },
            {
              "html": "<p>Set <var>subscribe step events</var>[<var>event name</var>] to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-difference\" id=\"ref-for-set-difference\">difference</a> of\n  <var>subscription navigables</var> and <var>existing navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Append <var>subscription</var> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions⑤\">subscriptions</a>.</p>"
        },
        {
          "html": "<p>Append <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id②\">subscription id</a> to <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-known-subscription-ids\" id=\"ref-for-event-known-subscription-ids\">known subscription ids</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-sort-in-ascending-order\" id=\"ref-for-map-sort-in-ascending-order\">Sort in ascending order</a> <var>subscribe step events</var> using the following less\n than algorithm given two entries with keys <var>event name one</var> and <var>event\n name two</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>event one</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event\" id=\"ref-for-event⑤\">event</a> with name <var>event name one</var></p>"
            },
            {
              "html": "<p>Let <var>event two</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event\" id=\"ref-for-event⑥\">event</a> with name <var>event name two</var></p>"
            },
            {
              "html": "<p>Return true if <var>event one</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscribe-priority\" id=\"ref-for-event-subscribe-priority\">subscribe priority</a> is less than <var>event\n two</var>’s subscribe priority, or false otherwise.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>subscription</var> is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-global\" id=\"ref-for-subscription-global②\">global</a>, let <var>include global</var> be true, otherwise let\n <var>include global</var> be false.</p>"
        },
        {
          "html": "For each <var>event name</var> → <var>navigables</var> in <var>subscribe step events</var>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-subscribe-steps\" id=\"ref-for-event-remote-end-subscribe-steps①\">remote end subscribe steps</a> for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event\" id=\"ref-for-event⑦\">event</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-event-name\" id=\"ref-for-event-event-name④\">event name</a>\n <var>event name</var> given <var>session</var>, <var>navigables</var> and <var>include global</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②\">map</a> matching the <code>session.SubscribeResult</code> production,\n with the <code>subscription</code> field set to <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id③\">subscription id</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①①\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for session.unsubscribe",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑥\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>command parameters</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">contain</a> \"<code>subscriptions</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>event names</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②④\">set</a>.</p>"
            },
            {
              "html": "<p>For each entry <var>name</var> in <var>command parameters</var>[\"<code>events</code>\"],\n  let <var>event names</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union①\">union</a> of <var>event names</var> and the result of\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#obtain-a-set-of-event-names\" id=\"ref-for-obtain-a-set-of-event-names①\">obtain a set of event names</a> with <var>name</var>.</p>"
            },
            {
              "html": "<p>Let <var>new subscriptions</var> to be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a>.</p>"
            },
            {
              "html": "<p>Let <var>matched events</var> to be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑤\">set</a>.</p>"
            },
            {
              "html": "For each <var>subscription</var> of <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions⑥\">subscriptions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection①\">intersection</a> of <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names④\">event names</a> and <var>event names</var> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑥\">set</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">append</a> <var>subscription</var> to <var>new subscriptions</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">Continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "If <var>subscription</var> is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-global\" id=\"ref-for-subscription-global③\">global</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">append</a> <var>subscription</var> to <var>new subscriptions</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">Continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>subscription event names</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone\">clone</a> of <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names⑤\">event names</a>.</p>"
                },
                {
                  "html": "For each <var>event name</var> of <var>event names</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>subscription event names</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑥\">contains</a> <var>event name</var>:",
                      "rationale": "append",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">Append</a> <var>event name</var> to <var>matched events</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑤\">Remove</a> <var>event name</var> from <var>subscription event names</var>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "If <var>subscription event names</var> is not empty:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>cloned subscription</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscription\" id=\"ref-for-event-subscription②\">subscription</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id④\">subscription id</a> set to <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id⑤\">subscription id</a>,\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-event-names\" id=\"ref-for-subscription-event-names⑥\">event names</a> set to a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑦\">set</a> containing <var>subscription event names</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④\">append</a> <var>cloned subscription</var> to <var>new subscriptions</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>If <var>matched events</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-equal\" id=\"ref-for-set-equal\">equal</a> to <var>event names</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑨\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions⑦\">subscriptions</a> to <var>new subscriptions</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>subscriptions</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create②\">create a set</a> with <var>command parameters</var>[<code>subscriptions</code>].</p>"
            },
            {
              "html": "<p>Let <var>unknown subscription ids</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-difference\" id=\"ref-for-set-difference①\">difference</a> between <var>subscriptions</var> and <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-known-subscription-ids\" id=\"ref-for-event-known-subscription-ids①\">known subscription ids</a>.</p>"
            },
            {
              "html": "If <var>unknown subscription ids</var> is not empty:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⓪\">invalid argument</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>subscriptions to remove</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑧\">set</a>.</p>"
            },
            {
              "html": "For each <var>subscription</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions⑧\">subscriptions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>subscriptions</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑦\">contains</a> <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-subscription-id\" id=\"ref-for-subscription-subscription-id⑥\">subscription id</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①③\">Append</a> <var>subscription</var> to <var>subscriptions to remove</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-known-subscription-ids\" id=\"ref-for-event-known-subscription-ids②\">known subscription ids</a> to\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-difference\" id=\"ref-for-set-difference②\">difference</a> between <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-known-subscription-ids\" id=\"ref-for-event-known-subscription-ids③\">known subscription ids</a> and <var>subscriptions</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑥\">Remove</a> each item in <var>subscriptions to remove</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions⑨\">subscriptions</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①②\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "get the client window state",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-client-window-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-client-window-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the client window state</dfn> given <var>window</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>documents</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>visible documents</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑧\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①⑤\">top-level traversable</a> <var>traversable</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window⑥\">client window</a> is not <var>window</var> then continue.</p>"
            },
            {
              "html": "<p>Let <var>document</var> be <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document③\">active document</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤\">Append</a> <var>document</var> to <var>documents</var>.</p>"
            },
            {
              "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-visibility-state②\">visibility state</a> is \"<code>visible</code>\",\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥\">Append</a> <var>document</var> to <var>visible documents</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>document</var> in <var>visible documents</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://fullscreen.spec.whatwg.org/#fullscreen-element\" id=\"ref-for-fullscreen-element\">fullscreen element</a> is not null, return\n \"<code>fullscreen</code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>visible documents</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty③\">empty</a> but <var>documents</var> is not\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty④\">empty</a>, or if <var>window</var> is otherwise in an OS-specific minimized\n state, return \"<code>minimized</code>\".</p>"
        },
        {
          "html": "<p>If <var>window</var> is in an OS-specific maximized state return\n \"<code>maximized</code>\".</p>"
        },
        {
          "html": "<p>Return \"<code>normal</code>\".</p>"
        }
      ]
    },
    {
      "name": "set the client window state",
      "href": "https://w3c.github.io/webdriver-bidi/#set-the-client-window-state",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-the-client-window-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set the client window state</dfn> given <var>window</var> and <var>state</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>current state</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-client-window-state\" id=\"ref-for-get-the-client-window-state\">get the client window state</a> with <var>window</var>.</p>"
        },
        {
          "html": "<p>If <var>current state</var> is \"<code>fullscreen</code>\", \"<code>maximized</code>\", or \"<code>minimized</code>\" and is equal to <var>state</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①③\">success</a> with data null.</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set of steps for which the associated condition is true:</p>\n      <dl>\n       <dt>\"<code>fullscreen</code>\"\n  \n       </dt><dd>If not <a data-link-type=\"dfn\" href=\"https://fullscreen.spec.whatwg.org/#fullscreen-is-supported\" id=\"ref-for-fullscreen-is-supported\">fullscreen is supported</a> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②\">error code</a>\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation\">unsupported operation</a>.\n\n  \n       </dd><dt>\"<code>normal</code>\"\n  \n       </dt><dd>If not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#restore-client-window-is-supported\" id=\"ref-for-restore-client-window-is-supported\">restore client window is supported</a> for <var>window</var> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④\">error</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①\">unsupported operation</a>.\n\n  \n       </dd><dt>\"<code>maximize</code>\"\n  \n       </dt><dd>If not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maximize-client-window-is-supported\" id=\"ref-for-maximize-client-window-is-supported\">maximize client window is supported</a> for <var>window</var> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑤\">error</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation②\">unsupported operation</a>.\n\n  \n       </dd><dt>\"<code>minimize</code>\"\n  \n       </dt><dd>If not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#minimize-client-window-is-supported\" id=\"ref-for-minimize-client-window-is-supported\">minimize client window is supported</a> for <var>window</var> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑥\">error</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation③\">unsupported operation</a>.\n \n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>documents</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①⑥\">top-level traversable</a> <var>traversable</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>traversable</var>’s associated <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window⑦\">client window</a> is not <var>window</var> then\n continue.</p>"
            },
            {
              "html": "<p>Let <var>document</var> be <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document④\">active document</a>.</p>"
            },
            {
              "html": "<p>Append <var>document</var> to <var>documents</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>documents</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑤\">empty</a> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑥\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-client-window\" id=\"ref-for-errors-no-such-client-window\">no such client window</a>.</p>"
        },
        {
          "html": "If <var>current state</var> is \"<code>fullscreen</code>\":",
          "rationale": "for",
          "steps": [
            {
              "html": "<p>For each <var>document</var> in <var>documents</var>:</p>",
              "ignored": [
                "Fully exit fullscreen with document."
              ]
            }
          ]
        },
        {
          "html": "<p>Switch on the value of <var>state</var>:</p>\n      <dl>\n       <dt>\"<code>fullscreen</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt>\"<code>normal</code>\"\n  \n       </dt><dd>1. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#restore-the-client-window\" id=\"ref-for-restore-the-client-window\">Restore the client window</a> <var>window</var>.\n\n  \n       </dd><dt>\"<code>maximize</code>\"\n  \n       </dt><dd>1. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maximize-the-client-window\" id=\"ref-for-maximize-the-client-window\">Maximize the client window</a> <var>window</var>.\n\n  \n       </dd><dt>\"<code>minimize</code>\"\n  \n       </dt><dd>1. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#minimize-the-client-window\" id=\"ref-for-minimize-the-client-window\">Minimize the client window</a> <var>window</var>.\n\n\n      </dd></dl>",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <var>document</var> in <var>documents</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\" id=\"ref-for-visibility-state③\">visibility state</a> is \"<code>visible</code>\",\n <a data-link-type=\"dfn\" href=\"https://fullscreen.spec.whatwg.org/#fullscreen-an-element\" id=\"ref-for-fullscreen-an-element\">fullscreen an element</a> with <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#ref-for-dom-document-documentelement\" id=\"ref-for-ref-for-dom-document-documentelement\">document element</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">Break</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①④\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "get the client window info",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-client-window-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-client-window-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the client window info</dfn> given <var>client window</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>client window id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-id\" id=\"ref-for-client-window-id\">client window id</a> for <var>client window</var>.</p>"
        },
        {
          "html": "<p>Let <var>state</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-client-window-state\" id=\"ref-for-get-the-client-window-state①\">get the client window state</a> with <var>client window</var>.</p>"
        },
        {
          "html": "<p>If <var>client window</var> can receive keyboard input channeled from the operating\n system, let <var>active</var> be true, otherwise let <var>active</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>client window info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③\">map</a> matching the\n <code>browser.ClientWindowsInfo</code> production with the\n <code>clientWindow</code> field set to <var>client window id</var>, <code>state</code>\n field set to <var>state</var>, the <code>x</code> field set to <var>client window</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-x-coordinate\" id=\"ref-for-client-window-x-coordinate①\">x-coordinate</a>, the <code>y</code> field set to <var>client\n window</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-y-coordinate\" id=\"ref-for-client-window-y-coordinate①\">y-coordinate</a>, the <code>width</code> field set to\n <var>client window</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-width\" id=\"ref-for-client-window-width④\">width</a>, the <code>height</code> field\n set to <var>client window</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-height\" id=\"ref-for-client-window-height④\">height</a>, and the <code>active</code>\n field set to <var>active</var>.</p>"
        },
        {
          "html": "<p>Return <var>client window info</var></p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.close",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑦\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#end-the-session\" id=\"ref-for-end-the-session①\">End the session</a> with <var>session</var>.</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions⑧\">active sessions</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑥\">empty</a> an implementation may\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-unable-to-close-browser\" id=\"ref-for-errors-unable-to-close-browser\">unable to close browser</a>, and then\n run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait until the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1④\">Send a WebSocket message</a> steps have been called with the\n response to this command.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#cleanup-the-session\" id=\"ref-for-cleanup-the-session①\">Cleanup the session</a> with <var>session</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>active session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-active-sessions\" id=\"ref-for-dfn-active-sessions⑨\">active sessions</a>:",
          "rationale": "end",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#end-the-session\" id=\"ref-for-end-the-session②\">End the session</a> <var>active session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#cleanup-the-session\" id=\"ref-for-cleanup-the-session②\">Cleanup the session</a> with <var>active session</var></p>"
            }
          ]
        },
        {
          "html": "Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⑤\">success</a> with data null, and run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>.",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait until the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-6.1\" id=\"ref-for-section-6.1⑤\">Send a WebSocket message</a> steps have been called with the\n response to this command.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#cleanup-the-session\" id=\"ref-for-cleanup-the-session③\">Cleanup the session</a> with <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#close-a-top-level-traversable\" id=\"ref-for-close-a-top-level-traversable\">Close</a> any <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top②\">top-level traversables</a> without <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document\" id=\"ref-for-prompt-to-unload-a-document\">prompting to unload</a>.</p>"
            },
            {
              "html": "<p>Perform implementation defined steps to clean up resources associated with\n the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends②①\">remote end</a> under automation.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for browser.createUserContext",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑧\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user context</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context\" id=\"ref-for-user-context①②\">user context</a>.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">contain</a> \"<code>acceptInsecureCerts</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>acceptInsecureCerts</var> be\n  <var>command parameters</var>[\"<code>acceptInsecureCerts</code>\"]:</p>"
            },
            {
              "html": "<p>If <var>acceptInsecureCerts</var> is true and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node②\">endpoint node</a> doesn’t support\n  accepting insecure TLS connections, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑧\">error code</a>\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation④\">unsupported operation</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">Set</a> <var>session</var>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-accept-insecure-certificates-override-map\" id=\"ref-for-user-context-to-accept-insecure-certificates-override-map①\">user context to accept insecure certificates override map</a>[<var>user context</var>]\n  to <var>acceptInsecureCerts</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">contains</a> \"<code>unhandledPromptBehavior</code>\",\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unhandled-prompt-behavior-overrides-map\" id=\"ref-for-unhandled-prompt-behavior-overrides-map\">unhandled prompt behavior overrides map</a>[<var>user context</var>] to\n <var>command parameters</var>[\"<code>unhandledPromptBehavior</code>\"].</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">contains</a> \"<code>proxy</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>proxy configuration</var> be <var>command parameters</var>[\"<code>proxy</code>\"].</p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends②③\">remote end</a> is unable to configure proxy settings per <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context\" id=\"ref-for-user-context①③\">user context</a>,\n   or is unable to configure the proxy with <var>proxy configuration</var>, return  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⓪\">error</a> with\n   <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation⑤\">unsupported operation</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">Set</a> <var>session</var>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-proxy-configuration-map\" id=\"ref-for-user-context-to-proxy-configuration-map①\">user context to proxy configuration map</a>[<var>user context</var>]\n  to <var>proxy configuration</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①④\">Append</a> <var>user context</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts⑧\">set of user contexts</a>.</p>"
        },
        {
          "html": "<p>Let <var>user context info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④\">map</a> matching the\n  <code>browser.UserContextInfo</code> production with the\n  <code>userContext</code> field set to <var>user context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id⑥\">user context id</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⑥\">success</a> with data <var>user context info</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.getClientWindows",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑨\">remote end steps</a> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>client window ids</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②⑨\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>client windows</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⓪\">list</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable①⑧\">top-level traversable</a> <var>traversable</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>client window</var> be <var>traversable</var>’s associated <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①②\">client window</a></p>"
            },
            {
              "html": "<p>Let <var>client window id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-id\" id=\"ref-for-client-window-id①\">client window id</a> for <var>client window</var>.</p>"
            },
            {
              "html": "<p>If <var>client window ids</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑧\">contains</a> <var>client window id</var>, continue.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑤\">Append</a> <var>client window id</var> to <var>client window ids</var>.</p>"
            },
            {
              "html": "<p>Let <var>client window info</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-client-window-info\" id=\"ref-for-get-the-client-window-info\">get the client window info</a> with <var>client\n window</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑦\">Append</a> <var>client window info</var> to <var>client windows</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤\">map</a> matching the\n <code>browser.GetClientWindowsResult</code> production with the\n <code>clientWindows</code> field set to <var>client windows</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⑦\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.getUserContexts",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⓪\">remote end steps</a> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user contexts</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①①\">list</a>.</p>"
        },
        {
          "html": "For each <var>user context</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts⑨\">set of user contexts</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user context info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑥\">map</a> matching the\n <code>browser.UserContextInfo</code> production with the\n <code>userContext</code> field set to <var>user context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id⑦\">user context id</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑧\">Append</a> <var>user context info</var> to <var>user contexts</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑦\">map</a> matching the\n <code>browser.GetUserContextsResult</code> production with the\n <code>userContexts</code> field set to <var>user contexts</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⑧\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.removeUserContext",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①①\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user context id</var> be <var>command  parameters</var>[\"<code>userContext</code>\"].</p>"
        },
        {
          "html": "<p>If <var>user context id</var> is <code>\"default\"</code>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Set <var>user context</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context②\">get user context</a> with <var>user context id</var>.</p>"
        },
        {
          "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-user-context\" id=\"ref-for-errors-no-such-user-context②\">no such user context</a>.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top③\">top-level traversable</a> <var>navigable</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①①\">associated user context</a> is <var>user context</var>:",
              "rationale": "close",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#close-a-top-level-traversable\" id=\"ref-for-close-a-top-level-traversable①\">Close</a> <var>navigable</var> without <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document\" id=\"ref-for-prompt-to-unload-a-document①\">prompting to unload</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑦\">Remove</a> <var>user context</var> for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts①⓪\">set of user contexts</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⑨\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.setClientWindowState",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①②\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the implementation does not support setting the client window state at\n all, then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation⑥\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①④\">client window</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-id\" id=\"ref-for-client-window-id②\">client window id</a> <var>command\n parameters</var>[\"<code>clientWindow</code>\"], let <var>client window</var> be that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①⑤\">client window</a>. Otherwise return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-client-window\" id=\"ref-for-errors-no-such-client-window①\">no such client window</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" data-refhint-key=\"f5554d6d\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦\">Try</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-the-client-window-state\" id=\"ref-for-set-the-client-window-state\">set the client window state</a> with <var>client window</var> and <var>command\n parameters</var>[\"<code>state</code>\"].</p>"
        },
        {
          "html": "If <var>command parameters</var>[\"<code>state</code>\"] is \"<code>normal</code>\":",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">contains</a> \"<code>x</code>\" and the\n implementation supports positioning <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①⑥\">client windows</a>, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-x-coordinate\" id=\"ref-for-client-window-x-coordinate②\">x-coordinate</a> of <var>client window</var> to a value that is as close as\n possible <var>command parameters</var>[\"<code>x</code>\"].</p>"
            },
            {
              "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">contains</a> \"<code>y</code>\" and the\n implementation supports positioning <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①⑦\">client windows</a>, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-y-coordinate\" id=\"ref-for-client-window-y-coordinate②\">y-coordinate</a> of <var>client window</var> to a value that is as close as\n possible <var>command parameters</var>[\"<code>y</code>\"].</p>"
            },
            {
              "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">contains</a> \"<code>width</code>\" and the\n implementation supports resizing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①⑧\">client windows</a>, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-width\" id=\"ref-for-client-window-width⑤\">width</a> of <var>client window</var> to a value that is as close as possible\n <var>command parameters</var>[\"<code>width</code>\"].</p>"
            },
            {
              "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">contains</a> \"<code>width</code>\" and the\n implementation supports resizing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window①⑨\">client windows</a>, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-width\" id=\"ref-for-client-window-width⑥\">width</a> of <var>client window</var> to a value that is as close as possible\n <var>command parameters</var>[\"<code>width</code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>client window info</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-client-window-info\" id=\"ref-for-get-the-client-window-info①\">get the client window info</a> with <var>client window</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⓪\">success</a> with data <var>client window info</var>.</p>"
        }
      ]
    },
    {
      "name": "get download behavior",
      "href": "https://w3c.github.io/webdriver-bidi/#get-download-behavior",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-download-behavior\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get download behavior</dfn> given <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①②\">associated user context</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior\">download behavior</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-user-context-download-behavior\" id=\"ref-for-download-behavior-user-context-download-behavior\">user context download behavior</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">contains</a>\n <var>user context</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior①\">download behavior</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-user-context-download-behavior\" id=\"ref-for-download-behavior-user-context-download-behavior①\">user context download behavior</a>[<var>user context</var>].</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior②\">download behavior</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-default-download-behavior\" id=\"ref-for-download-behavior-default-download-behavior\">default download behavior</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browser.setDownloadBehavior",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①③\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var>[\"<code>downloadBehavior</code>\"] is null, let\n <var>download behavior</var> be null.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>command parameters</var>[\"<code>downloadBehavior</code>\"][\"<code>type</code>\"]\n  is \"<code>allowed</code>\", let <var>allowed</var> be true, otherwise let <var>allowed</var> be\n  false.</p>"
            },
            {
              "html": "<p>If <var>command parameters</var>[\"<code>downloadBehavior</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">contains</a>\n  \"<code>destinationFolder</code>\", let <var>destinationFolder</var> be\n  <var>command parameters</var>[\"<code>downloadBehavior</code>\"][\"<code>destinationFolder</code>\"],\n  otherwise let <var>destinationFolder</var> be null.</p>"
            },
            {
              "html": "<p>Let <var>download behavior</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-struct\" id=\"ref-for-download-behavior-struct②\">download behavior struct</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-struct-allowed\" id=\"ref-for-download-behavior-struct-allowed\">allowed</a> set to <var>allowed</var> and\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-struct-destination-folder\" id=\"ref-for-download-behavior-struct-destination-folder\">destinationFolder</a> set to <var>destinationFolder</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If the implementation does not support required <var>download behavior</var>, then return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation⑦\">unsupported operation</a>.</p>"
        },
        {
          "html": "If the <code>userContexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>download behavior</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove②\">remove</a> <var>user context</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior③\">download behavior</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-user-context-download-behavior\" id=\"ref-for-download-behavior-user-context-download-behavior②\">user context download behavior</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior④\">download behavior</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-user-context-download-behavior\" id=\"ref-for-download-behavior-user-context-download-behavior③\">user context download behavior</a>[<var>user context</var>] to\n <var>download behavior</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Otherwise, set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior\" id=\"ref-for-download-behavior⑤\">download behavior</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#download-behavior-default-download-behavior\" id=\"ref-for-download-behavior-default-download-behavior①\">default download behavior</a> to\n <var>download behavior</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②①\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "get a navigable",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-navigable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-a-navigable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a navigable</dfn> given <var>navigable id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>navigable id</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②②\">success</a> with data null.</p>"
        },
        {
          "html": "<p>If there is no navigable with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②\">navigable id</a> <var>navigable id</var> return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-frame\" id=\"ref-for-dfn-no-such-frame\">no such frame</a></p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables①④\">navigable</a> with id <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②③\">success</a> with data <var>navigable</var>.</p>"
        }
      ]
    },
    {
      "name": "get the child navigables",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-child-navigables",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-child-navigables\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the child navigables</dfn> given <var>navigable</var>:\n\n\n    <p>TODO: make this return a list in document order</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>child navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⓪\">set</a> containing all navigables that are\n a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#child-navigable\" id=\"ref-for-child-navigable①\">child navigable</a> of <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Return <var>child navigables</var>.</p>"
        }
      ]
    },
    {
      "name": "get the navigable info",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-navigable-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-navigable-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the navigable info</dfn> given <var>navigable</var>,\n<var>max depth</var> and <var>include parent id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id③\">navigable id</a> for <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>parent navigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent①\">parent</a>.</p>"
        },
        {
          "html": "<p>If <var>parent navigable</var> is not null let <var>parent id</var> be the\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id④\">navigable id</a> of <var>parent navigable</var>. Otherwise let\n <var>parent id</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑤\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">URL serializer</a>, given\n <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-url\" id=\"ref-for-concept-document-url\">URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>child infos</var> be null.</p>"
        },
        {
          "html": "If <var>max depth</var> is null, or <var>max depth</var> is greater than 0:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>child navigables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-child-navigables\" id=\"ref-for-get-the-child-navigables\">get the child navigables</a> given <var>navigable</var>.</p>"
            },
            {
              "html": "<p>Let <var>child depth</var> be <var>max depth</var> - 1 if <var>max depth</var> is not null, or null otherwise.</p>"
            },
            {
              "html": "<p>Set <var>child infos</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①②\">list</a>.</p>"
            },
            {
              "html": "For each <var>child navigable</var> of <var>child navigables</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigable-info\" id=\"ref-for-get-the-navigable-info\">get the navigable info</a> given\n <var>child navigable</var>, <var>child depth</var>, and false.</p>"
                },
                {
                  "html": "<p>Append <var>info</var> to <var>child infos</var></p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①③\">associated user context</a>.</p>"
        },
        {
          "html": "<p>Let <var>opener id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id⑤\">navigable id</a> for <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#original-opener\" id=\"ref-for-original-opener\">original opener</a>, if <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#original-opener\" id=\"ref-for-original-opener①\">original opener</a> is not null,\n and null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top④\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Let <var>client window id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window-id\" id=\"ref-for-client-window-id③\">client window id</a> for <var>top-level\n traversable</var>’s associated <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#client-window\" id=\"ref-for-client-window②⓪\">client window</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑧\">map</a> matching the\n <code>browsingContext.Info</code> production with the <code>context</code>\n field set to <var>navigable id</var>, the <code>parent</code> field set to <var>parent id</var>\n if <var>include parent id</var> is <code>true</code>, or unset otherwise, the\n <code>url</code> field set to <var>url</var>, the <code>userContext</code> field set\n to <var>user context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id⑧\">user context id</a>, <code>originalOpener</code> field\n set to <var>opener id</var>, the <code>children</code> field set to <var>child infos</var>, and\n the <code>clientWindow</code> field set to <var>client window id</var>.</p>"
        },
        {
          "html": "<p>Return <var>navigable info</var>.</p>"
        }
      ]
    },
    {
      "name": "await a navigation",
      "href": "https://w3c.github.io/webdriver-bidi/#await-a-navigation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"await-a-navigation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">await a navigation</dfn> given <var>navigable</var>, <var>request</var>, <var>wait condition</var>, and optionally\n<var>history handling</var> (default: \"<code>default</code>\") and <var>ignore cache</var> (default: false):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation id</var> be the string representation of a\n <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a> based on truly random, or pseudo-random numbers.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate\" id=\"ref-for-navigate\">Navigate</a> <var>navigable</var> with resource <var>request</var>, and using\n <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑥\">active document</a> as the source\n <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document\">Document</a></code>, with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-id\" id=\"ref-for-navigation-id①\">navigation id</a> <var>navigation id</var>, and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#history-handling-behavior\" id=\"ref-for-history-handling-behavior\">history handling behavior</a> <var>history handling</var>. If <var>ignore cache</var> is true,\n the navigation must not load resources from the HTTP cache.</p>"
        },
        {
          "html": "<p>Let (<var>event received</var>, <var>navigation status</var>) be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits①\">await</a> given\n  «\"<code>navigation started</code>\", \"<code>navigation failed</code>\",\n  \"<code>fragment navigated</code>\"», and <var>navigation id</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id\">id</a> is <var>navigation id</var>.</p>"
        },
        {
          "html": "If <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-status\" id=\"ref-for-navigation-status-status\">status</a> is \"<code>complete</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑨\">map</a> matching the\n <code>browsingContext.NavigateResult</code> production, with the\n <code>navigation</code> field set to <var>navigation id</var>, and the\n <code>url</code> field set to the result of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①\">URL serializer</a> given\n <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-url\" id=\"ref-for-navigation-status-url\">url</a>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②④\">success</a> with data <var>body</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-status\" id=\"ref-for-navigation-status-status①\">status</a> is \"<code>canceled</code>\"\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-error\" id=\"ref-for-dfn-unknown-error\">unknown error</a>.</p>\n      <p>TODO: is this the right way to handle errors here?</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-status\" id=\"ref-for-navigation-status-status②\">status</a> is\n \"<code>pending</code>\" and <var>navigation id</var> is not null.</p>"
        },
        {
          "html": "<p>If <var>wait condition</var> is \"<code>committed</code>\", let <var>event name</var> be\n \"<code>committed</code>\".</p>"
        },
        {
          "html": "<p>Otherwise, if <var>wait condition</var> is \"<code>interactive</code>\", let <var>event name</var> be\n \"<code>domContentLoaded</code>\".</p>"
        },
        {
          "html": "<p>Otherwise, let <var>event name</var> be \"<code>load</code>\".</p>"
        },
        {
          "html": "<p>Let (<var>event received</var>, <var>status</var>) be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits②\">await</a> given «<var>event name</var>,\n  \"<code>download started</code>\", \"<code>navigation aborted</code>\",\n  \"<code>navigation failed</code>\"» and <var>navigation id</var>.</p>"
        },
        {
          "html": "<p>If <var>event received</var> is \"<code>navigation failed</code>\"\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-error\" id=\"ref-for-dfn-unknown-error①\">unknown error</a>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⓪\">map</a> matching the\n <code>browsingContext.NavigateResult</code> production, with the\n <code>navigation</code> field set to <var>status</var>’s id, and the\n <code>url</code> field set to the result of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer②\">URL serializer</a> given\n <var>status</var>’s url.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⑤\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "get the navigation info",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-navigation-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-navigation-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the navigation info</dfn>, given <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables①⑤\">navigable</a> <var>navigable</var> and\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status\">navigation status</a> <var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id⑥\">navigable id</a> for <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id①\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>timestamp</var> be a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-time-values-and-time-range\" id=\"ref-for-sec-time-values-and-time-range\">time value</a> representing the current date and time in UTC.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-url\" id=\"ref-for-navigation-status-url①\">url</a>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②①\">map</a> matching the <code>browsingContext.NavigationInfo</code>\n production, with the <code>context</code> field set to <var>navigable id</var>, the\n <code>navigation</code> field set to <var>navigation id</var>, the\n <code>timestamp</code> field set to <var>timestamp</var>, and the <code>url</code>\n field set to the result of the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer③\">URL serializer</a> given <var>url</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.activate",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①④\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <var>command parameters</var>[\"<code>context</code>\"] field.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②\">get a navigable</a> with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⓪\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors②⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#activate-a-navigable\" id=\"ref-for-activate-a-navigable\">activate a navigable</a> with <var>navigable</var>.</p>"
        }
      ]
    },
    {
      "name": "activate a navigable",
      "href": "https://w3c.github.io/webdriver-bidi/#activate-a-navigable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"activate-a-navigable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">activate a navigable</dfn> given <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Run implementation-specific steps so that <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#system-visibility-state\" id=\"ref-for-system-visibility-state\">system visibility state</a> becomes <a data-link-type=\"dfn\" data-refhint-key=\"e08512b4\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#system-visibility-state\" id=\"ref-for-system-visibility-state①\">visible</a>. If this is not possible return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⓪\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation⑧\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Run implementation-specific steps to set the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#system-focus\" id=\"ref-for-system-focus①\">system focus</a> on the <var>navigable</var> if it is not focused.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⑥\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "normalize rect",
      "href": "https://w3c.github.io/webdriver-bidi/#normalize-rect",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"normalize-rect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">normalize rect</dfn> given <var>rect</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>x</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate\">x coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>y</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate\">y coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>width</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension①\">width dimension</a>.</p>"
        },
        {
          "html": "<p>Let <var>height</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension①\">height dimension</a>.</p>"
        },
        {
          "html": "<p>If <var>width</var> is less than 0, set <var>x</var> to <var>x</var> + <var>width</var> and then set <var>width</var> to\n -<var>width</var>.</p>"
        },
        {
          "html": "<p>If <var>height</var> is less than 0, set <var>y</var> to <var>y</var> + <var>height</var> and then set <var>height</var>\n to -<var>height</var>.</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate①\">x coordinate</a> <var>x</var>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate①\">y coordinate</a>\n <var>y</var>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension②\">width dimension</a> <var>width</var> and <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension②\">height dimension</a> <var>height</var>.</p>"
        }
      ]
    },
    {
      "name": "rectangle intersection",
      "href": "https://w3c.github.io/webdriver-bidi/#rectangle-intersection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"rectangle-intersection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">rectangle intersection</dfn> given <var>rect1</var> and <var>rect2</var>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>rect1</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#normalize-rect\" id=\"ref-for-normalize-rect\">normalize rect</a> with <var>rect1</var>.</p>"
        },
        {
          "html": "<p>Let <var>rect2</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#normalize-rect\" id=\"ref-for-normalize-rect①\">normalize rect</a> with <var>rect2</var>.</p>"
        },
        {
          "html": "<p>Let <var>x1_0</var> be <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate②\">x coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>x2_0</var> be <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate③\">x coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>x1_1</var> be <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate④\">x coordinate</a> plus <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension③\">width dimension</a>.</p>"
        },
        {
          "html": "<p>Let <var>x2_1</var> be <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate⑤\">x coordinate</a> plus <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension④\">width dimension</a>.</p>"
        },
        {
          "html": "<p>Let <var>x_0</var> be the maximum element of «<var>x1_0</var>, <var>x2_0</var>».</p>"
        },
        {
          "html": "<p>Let <var>x_1</var> be the minimum element of «<var>x1_1</var>, <var>x2_1</var>».</p>"
        },
        {
          "html": "<p>Let <var>y1_0</var> be <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate②\">y coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>y2_0</var> be <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate③\">y coordinate</a>.</p>"
        },
        {
          "html": "<p>Let <var>y1_1</var> be <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate④\">y coordinate</a> plus <var>rect1</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension③\">height dimension</a>.</p>"
        },
        {
          "html": "<p>Let <var>y2_1</var> be <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate⑤\">y coordinate</a> plus <var>rect2</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension④\">height dimension</a>.</p>"
        },
        {
          "html": "<p>Let <var>y_0</var> be the maximum element of «<var>y1_0</var>, <var>y2_0</var>».</p>"
        },
        {
          "html": "<p>Let <var>y_1</var> be the minimum element of «<var>y1_1</var>, <var>y2_1</var>».</p>"
        },
        {
          "html": "<p>If <var>x_1</var> is less than <var>x_0</var>, let <var>width</var> be 0. Otherwise let <var>width</var> be\n <var>x_1</var> - <var>x_0</var>.</p>"
        },
        {
          "html": "<p>If <var>y_1</var> is less than <var>y_0</var>, let <var>height</var> be 0. Otherwise let <var>height</var> be\n <var>y_1</var> - <var>y_0</var>.</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly①\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate⑥\">x coordinate</a> <var>x_0</var>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate⑥\">y coordinate</a>\n <var>y_0</var>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension⑤\">width dimension</a> <var>width</var> and <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension⑤\">height dimension</a> <var>height</var>.</p>"
        }
      ]
    },
    {
      "name": "render document to a canvas",
      "href": "https://w3c.github.io/webdriver-bidi/#render-document-to-a-canvas",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"render-document-to-a-canvas\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">render document to a canvas</dfn> given <var>document</var> and <var>rect</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>ratio</var> be <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#determine-the-device-pixel-ratio\" id=\"ref-for-determine-the-device-pixel-ratio\">determine the device pixel ratio</a> given <var>document</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#dom-document-defaultview\" id=\"ref-for-dom-document-defaultview\">default view</a>.</p>"
        },
        {
          "html": "<p>Let <var>paint width</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension⑥\">width dimension</a> multiplied by <var>ratio</var>,\n rounded to the nearest integer, so it matches the width of <var>rect</var> in device\n pixels.</p>"
        },
        {
          "html": "<p>Let <var>paint height</var> be <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension⑥\">height dimension</a> multiplied by <var>ratio</var>,\n rounded to the nearest integer, so it matches the height of <var>rect</var> in device\n pixels.</p>"
        },
        {
          "html": "<p>Let <var>canvas</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#htmlcanvaselement\" id=\"ref-for-htmlcanvaselement\">HTMLCanvasElement</a></code> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#dom-canvas-width\" id=\"ref-for-dom-canvas-width\">width</a></code> <var>paint\n width</var> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#dom-canvas-height\" id=\"ref-for-dom-canvas-height\">height</a></code> <var>paint height</var>.</p>"
        },
        {
          "html": "<p>Let <var>canvas context</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#2d-context-creation-algorithm\" id=\"ref-for-2d-context-creation-algorithm\">2D context creation algorithm</a>\n with <var>canvas</var> and null.</p>"
        },
        {
          "html": "<p>Set <var>canvas</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage//canvas.html#offscreencanvas-context-mode\" id=\"ref-for-offscreencanvas-context-mode\">context mode</a> to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#concept-canvas-2d\" id=\"ref-for-concept-canvas-2d\">2D</a>.</p>"
        },
        {
          "html": "<p>Complete implementation specific steps equivalent to drawing the region of\n the framebuffer representing the region of <var>document</var> covered by <var>rect</var> to\n <var>canvas context</var>, such that each pixel in the framebuffer corresponds to a pixel in\n <var>canvas context</var> with (<var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate⑦\">x coordinate</a>, <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate⑦\">y coordinate</a>) in\n viewport coordinates corresponding to (0,0) in <var>canvas context</var> and (<var>rect</var>’s\n <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate⑧\">x coordinate</a> + <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension⑦\">width dimension</a>, <var>rect</var>’s\n <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate⑧\">y coordinate</a> + <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension⑦\">height dimension</a>) corresponding to (<var>paint\n width</var>, <var>paint height</var>).</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://svgwg.org/svg2-draft/coords.html#TermCanvas\" id=\"ref-for-TermCanvas\">canvas</a>.</p>"
        }
      ]
    },
    {
      "name": "encode a canvas as Base64",
      "href": "https://w3c.github.io/webdriver-bidi/#encode-a-canvas-as-base64",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"encode-a-canvas-as-base64\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">encode a canvas as Base64</dfn> given <var>canvas</var> and <var>format</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>format</var> is not null, let <var>type</var> be the <code>type</code> field of\n <var>format</var>, and let <var>quality</var> be the <code>quality</code> field of <var>format</var>.</p>"
        },
        {
          "html": "<p>Otherwise, let <var>type</var> be \"image/png\" and let <var>quality</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-undefined-value\" id=\"ref-for-sec-undefined-value\">undefined</a>.</p>"
        },
        {
          "html": "<p>Let <var>file</var> be <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/canvas.html#a-serialisation-of-the-bitmap-as-a-file\" id=\"ref-for-a-serialisation-of-the-bitmap-as-a-file\">a serialization of the bitmap as a file</a> for <var>canvas</var> with\n <var>type</var> and <var>quality</var>.</p>"
        },
        {
          "html": "<p>Let <var>encoded string</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-encode\" id=\"ref-for-forgiving-base64-encode\">forgiving-base64 encode</a> of <var>file</var>.</p>"
        },
        {
          "html": "<p>Return success with data <var>encoded string</var>.</p>"
        }
      ]
    },
    {
      "name": "get the origin rectangle",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-origin-rectangle",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-origin-rectangle\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the origin rectangle</dfn> given <var>document</var> and <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>origin</var> is <code>\"viewport\"</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>viewport</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#visual-viewport\" id=\"ref-for-visual-viewport\">visual viewport</a>.</p>"
            },
            {
              "html": "<p>Let <var>viewport rect</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly②\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate⑨\">x coordinate</a>\n  <var>viewport</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#dom-visualviewport-pageleft\" id=\"ref-for-dom-visualviewport-pageleft\">page left</a>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate⑨\">y coordinate</a>\n  <var>viewport</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#dom-visualviewport-pagetop\" id=\"ref-for-dom-visualviewport-pagetop\">page top</a>, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension⑧\">width dimension</a>\n  <var>viewport</var> width, and <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension⑧\">height dimension</a> <var>viewport</var> height.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⑦\">success</a> with data <var>viewport rect</var>.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>origin</var> is <code>\"document\"</code>.</p>"
        },
        {
          "html": "<p>Let <var>document element</var> be the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#ref-for-dom-document-documentelement\" id=\"ref-for-ref-for-dom-document-documentelement①\">document element</a> for <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>document rect</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly③\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate①⓪\">x coordinate</a> 0, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate①⓪\">y coordinate</a> 0, <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension⑨\">width dimension</a> <var>document element</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#dom-element-scrollheight\" id=\"ref-for-dom-element-scrollheight\">scroll height</a>,\n and <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension⑨\">height dimension</a> <var>document element</var> <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#dom-element-scrollwidth\" id=\"ref-for-dom-element-scrollwidth\">scroll width</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⑧\">success</a> with data <var>document rect</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⑤\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var> if present, or null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable③\">get a navigable</a>\n  with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>If the implementation is unable to capture a screenshot of <var>navigable</var> for any\n reason then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation⑨\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑦\">active document</a>.</p>"
        },
        {
          "html": "<p>Immediately after the next invocation of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#run-the-animation-frame-callbacks\" id=\"ref-for-run-the-animation-frame-callbacks\">run the animation frame callbacks</a> algorithm for <var>document</var>:</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be the value of the <code>context</code> field of <var>command\n parameters</var> if present, or \"viewport\" otherwise.</p>"
        },
        {
          "html": "<p>Let <var>origin rect</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-origin-rectangle\" id=\"ref-for-get-the-origin-rectangle\">get the origin rectangle</a>\n given <var>origin</var> and <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>clip rect</var> be <var>origin rect</var>.</p>"
        },
        {
          "html": "If <var>command parameters</var> contains \"<code>clip</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>clip</var> be <var>command parameters</var>[\"<code>clip</code>\"].</p>"
            },
            {
              "html": "<p>Run the steps under the first matching condition:</p>\n       <dl>\n        <dt><var>clip</var> matches the <code>browsingContext.ElementClipRectangle</code>\n   production:\n   \n        </dt><dd>\n         \n        </dd><dt><var>clip</var> matches the <code>browsingContext.BoxClipRectangle</code> production:\n   \n        </dt><dd>\n         \n       </dd></dl>",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object\">environment settings object</a> whose\n  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated <code>Document</code></a> is\n <var>document</var>.</p>"
                },
                {
                  "html": "<p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context\">realm execution context</a>’s\n  Realm component.</p>"
                },
                {
                  "html": "<p>Let <var>element</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-remote-reference\" id=\"ref-for-deserialize-remote-reference\">deserialize remote reference</a>\n  with <var>clip</var>[\"<code>element</code>\"], <var>realm</var>, and <var>session</var>.</p>"
                },
                {
                  "html": "<p>If <var>element</var> doesn’t implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element\">Element</a></code> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⓪\">error code</a>\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-element\" id=\"ref-for-dfn-no-such-element\">no such element</a>.</p>"
                },
                {
                  "html": "<p>If <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document\">node document</a> is not <var>document</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③③\">error</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-element\" id=\"ref-for-dfn-no-such-element①\">no such element</a>.</p>"
                },
                {
                  "html": "<p>Let <var>viewport rect</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-origin-rectangle\" id=\"ref-for-get-the-origin-rectangle①\">get the origin rectangle</a> given\n  \"<code>viewport</code>\" and <var>document</var>.</p>"
                },
                {
                  "html": "<p>Let <var>element rect</var> be <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#element-get-the-bounding-box\" id=\"ref-for-element-get-the-bounding-box\">get the bounding box</a> for <var>element</var>.</p>"
                },
                {
                  "html": "<p>Let <var>clip rect</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly④\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate①①\">x coordinate</a>\n  <var>element rect</var>[\"<code>x</code>\"] + <var>viewport rect</var>[\"<code>x</code>\"],\n  <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate①①\">y coordinate</a> <var>element rect</var>[\"<code>y</code>\"] + <var>viewport\n  rect</var>[\"<code>y</code>\"], width <var>element rect</var>[\"<code>width</code>\"],\n  and height <var>element rect</var>[\"<code>height</code>\"].</p>"
                }
              ],
              "additional": [
                {
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>clip x</var> be <var>clip</var>[\"<code>x</code>\"] plus <var>origin rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate①②\">x coordinate</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>clip y</var> be <var>clip</var>[\"<code>y</code>\"] plus <var>origin rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate①②\">y coordinate</a>.</p>"
                    },
                    {
                      "html": "<p>Let <var>clip rect</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.fxtf.org/geometry-1/#domrectreadonly\" id=\"ref-for-domrectreadonly⑤\">DOMRectReadOnly</a></code> with <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-x-coordinate\" id=\"ref-for-rectangle-x-coordinate①③\">x coordinate</a> <var>clip x</var>,\n  <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-y-coordinate\" id=\"ref-for-rectangle-y-coordinate①③\">y coordinate</a> <var>clip y</var>, width <var>clip</var>[\"<code>width</code>\"], and height\n  <var>clip</var>[\"<code>height</code>\"].</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": ""
        },
        {
          "html": "<p>Let <var>rect</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#rectangle-intersection\" id=\"ref-for-rectangle-intersection\">rectangle intersection</a> of <var>origin rect</var> and <var>clip rect</var>.</p>"
        },
        {
          "html": "<p>If <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-width-dimension\" id=\"ref-for-rectangle-width-dimension①⓪\">width dimension</a> is 0 or <var>rect</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.fxtf.org/geometry/#rectangle-height-dimension\" id=\"ref-for-rectangle-height-dimension①⓪\">height dimension</a> is 0,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③④\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unable-to-capture-screen\" id=\"ref-for-dfn-unable-to-capture-screen\">unable to capture screen</a>.</p>"
        },
        {
          "html": "<p>Let <var>canvas</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#render-document-to-a-canvas\" id=\"ref-for-render-document-to-a-canvas\">render document to a canvas</a> with <var>document</var> and <var>rect</var>.</p>"
        },
        {
          "html": "<p>Let <var>format</var> be the <code>format</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>encoding result</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#encode-a-canvas-as-base64\" id=\"ref-for-encode-a-canvas-as-base64\">encode a canvas as Base64</a> with <var>canvas</var> and <var>format</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②②\">map</a> matching the\n <code>browsingContext.CaptureScreenshotResult</code> production, with the\n <code>data</code> field set to <var>encoding result</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②⑨\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.close",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⑥\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>prompt unload</var> be the value of the <code>promptUnload</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable④\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigable</var> is not null.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②②\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⑤\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①③\">invalid argument</a>.</p>"
        },
        {
          "html": "If <var>prompt unload</var> is true:",
          "rationale": "close",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#close-a-top-level-traversable\" id=\"ref-for-close-a-top-level-traversable②\">Close</a> <var>navigable</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "close",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#close-a-top-level-traversable\" id=\"ref-for-close-a-top-level-traversable③\">Close</a> <var>navigable</var> without <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document\" id=\"ref-for-prompt-to-unload-a-document②\">prompting to unload</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⓪\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.create",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⑦\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>type</var> be the value of the <code>type</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>reference navigable id</var> be the value of the <code>referenceContext</code>\n field of <var>command parameters</var>, if present, or null otherwise.</p>"
        },
        {
          "html": "<p>If <var>reference navigable id</var> is not null, let <var>reference navigable</var> be the\n result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑤\">get a navigable</a> with\n <var>reference navigable id</var>. Otherwise let <var>reference navigable</var> be null.</p>"
        },
        {
          "html": "<p>If <var>reference navigable</var> is not null and is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②④\">top-level traversable</a>,\nreturn <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If the implementation is unable to create a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⑤\">top-level traversable</a> for any\n reason then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①⓪\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>user context</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-user-context\" id=\"ref-for-default-user-context②\">default user context</a> if <var>reference navigable</var>\n is null, and <var>reference navigable</var>’ <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①④\">associated user context</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>user context id</var> be the value of the <code>userContext</code> field of\n <var>command parameters</var> if present, or null otherwise.</p>"
        },
        {
          "html": "<p>If <var>user context id</var> is not null, set <var>user context</var> to the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context③\">get user context</a> with <var>user context id</var>.</p>"
        },
        {
          "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-user-context\" id=\"ref-for-errors-no-such-user-context③\">no such user context</a>.</p>"
        },
        {
          "html": "<p>If the implementation is unable to create a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⑥\">top-level traversable</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⑤\">associated user context</a> <var>user context</var> for any reason, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors③⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①①\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>traversable</var> be the result of trying to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#creating-a-new-top-level-traversable\" id=\"ref-for-creating-a-new-top-level-traversable\">create a new top-level traversable</a> steps with null and empty string,\n and setting the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⑥\">associated user context</a> for the newly created <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⑦\">top-level traversable</a> to <var>user context</var>.\n Which OS window the new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⑧\">top-level traversable</a> is created in depends on <var>type</var> and <var>reference navigable</var>:</p>\n      <ul>\n       <li data-md=\"\">\n        <p>If <var>type</var> is \"<code>tab</code>\" and the implementation supports\n multiple <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable②⑨\">top-level traversable</a>s in the same OS window:</p>\n        <ul>\n         <li data-md=\"\">\n          <p>The new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⓪\">top-level traversable</a> should reuse an existing OS window, if any.</p>\n         </li><li data-md=\"\">\n          <p>If <var>reference navigable</var> is not null, the new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③①\">top-level traversable</a> should\n reuse the window containing <var>reference navigable</var>, if any. If the\n top-level traversables inside an OS window have a definite ordering,\n the new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③②\">top-level traversable</a> should be immediately after\n <var>reference navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑤\">top-level traversable</a> in that ordering.</p>\n        </li></ul>\n       </li><li data-md=\"\">\n        <p>If <var>type</var> is \"<code>window</code>\", and the implementation supports\n multiple <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③③\">top-level traversable</a> in separate OS windows, the created\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③④\">top-level traversable</a> should be in a new OS window.</p>\n       </li><li data-md=\"\">\n        <p>Otherwise, the details of how the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⑤\">top-level traversable</a> is presented to the\n user are implementation defined.</p>\n      </li></ul>"
        },
        {
          "html": "If the value of the <var>command parameters</var>’ <code>background</code> field is false:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>activate result</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#activate-a-navigable\" id=\"ref-for-activate-a-navigable①\">activate a navigable</a> with the newly created <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables①⑧\">navigable</a>.</p>"
            },
            {
              "html": "<p>If <var>activate result</var> is an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⓪\">error</a>, return <var>activate result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②③\">map</a> matching the <code>browsingContext.CreateResult</code>\n production, with the <code>context</code> field set to <var>traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id⑧\">navigable id</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③①\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.getTree",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⑧\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>root id</var> be the value of the <code>root</code> field of\n <var>command parameters</var> if present, or null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>max depth</var> be the value of the <code>maxDepth</code> field of <var>command\n parameters</var> if present, or null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①③\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>root id</var> is not null, append the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⑦\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑥\">get a navigable</a> given <var>root id</var> to <var>navigables</var>.\n Otherwise append all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑥\">top-level traversables</a> to <var>navigables</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigables infos</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①④\">list</a>.</p>"
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigable-info\" id=\"ref-for-get-the-navigable-info①\">get the navigable info</a> given\n <var>navigable</var>, <var>max depth</var>, and true.</p>"
            },
            {
              "html": "<p>Append <var>info</var> to <var>navigables infos</var></p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②④\">map</a> matching the <code>browsingContext.GetTreeResult</code>\n production, with the <code>contexts</code> field set to <var>navigables infos</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③②\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.handleUserPrompt",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⑨\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑦\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>Let <var>accept</var> be the value of the <code>accept</code> field of <var>command\n parameters</var> if present, or true otherwise.</p>"
        },
        {
          "html": "<p>Let <var>userText</var> be the value of the <code>userText</code> field of <var>command\n parameters</var> if present, or the empty string otherwise.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is currently showing a simple dialog from a call to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-alert\" id=\"ref-for-dom-alert\">alert</a> then\n acknowledge the prompt.</p>\n      <p>Otherwise if <var>navigable</var> is currently showing a simple dialog from a call to\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-confirm\" id=\"ref-for-dom-confirm\">confirm</a>, then respond positively if <var>accept</var> is true, or respond\n negatively if <var>accept</var> is false.</p>\n      <p>Otherwise if <var>navigable</var> is currently showing a simple dialog from a call to\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-prompt\" id=\"ref-for-dom-prompt\">prompt</a>, then respond with the string value <var>userText</var> if <var>accept</var> is\n true, or abort if <var>accept</var> is false.</p>\n      <p>Otherwise, if <var>navigable</var> is currently showing a prompt as part of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#prompt-to-unload-a-document\" id=\"ref-for-prompt-to-unload-a-document③\">prompt to unload</a> steps, then confirm the navigation if <var>accept</var> is true, otherwise\n refuse the navigation.</p>\n      <p>Otherwise return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-alert\" id=\"ref-for-dfn-no-such-alert\">no such alert</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③③\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "locate nodes using CSS",
      "href": "https://w3c.github.io/webdriver-bidi/#locate-nodes-using-css",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"locate-nodes-using-css\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">locate nodes using CSS</dfn> with given <var>navigable</var>, <var>context nodes</var>,\n<var>selector</var>, <var>maximum returned node count</var>, and <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>returned nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑤\">list</a>.</p>"
        },
        {
          "html": "<p>Let <var>parse result</var> be the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/selectors-4/#parse-a-selector\" id=\"ref-for-parse-a-selector\">parse a selector</a> given <var>selector</var>.</p>"
        },
        {
          "html": "<p>If <var>parse result</var> is failure, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-selector\" id=\"ref-for-dfn-invalid-selector\">invalid selector</a>.</p>"
        },
        {
          "html": "For each <var>context node</var> of <var>context nodes</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>elements</var> be the result of <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/selectors-4/#match-a-selector-against-a-tree\" id=\"ref-for-match-a-selector-against-a-tree\">match a selector against a tree</a> with\n <var>parse result</var> and <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑧\">active document</a> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\" id=\"ref-for-concept-tree-root\">root</a> using\n <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/selectors-4/#scoping-root\" id=\"ref-for-scoping-root\">scoping root</a> <var>context node</var>.</p>"
            },
            {
              "html": "For each <var>element</var> in <var>elements</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑨\">Append</a> <var>element</var> to <var>returned nodes</var>.</p>"
                },
                {
                  "html": "<p>If <var>maximum returned node count</var> is not null and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> of\n <var>returned nodes</var> is equal to <var>maximum returned node count</var>,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③④\">success</a> with data <var>returned nodes</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⑤\">success</a> with data <var>returned nodes</var>.</p>"
        }
      ]
    },
    {
      "name": "locate the container element",
      "href": "https://w3c.github.io/webdriver-bidi/#locate-the-container-element",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"locate-the-container-element\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">locate the container element</dfn> given <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>returned nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑥\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-container\" id=\"ref-for-nav-container\">container</a> is not null,\n append <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-container\" id=\"ref-for-nav-container①\">container</a> to <var>returned nodes</var>.</p>"
        },
        {
          "html": "<p>Return <var>returned nodes</var>.</p>"
        }
      ]
    },
    {
      "name": "locate nodes using XPath",
      "href": "https://w3c.github.io/webdriver-bidi/#locate-nodes-using-xpath",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"locate-nodes-using-xpath\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">locate nodes using XPath</dfn> with given <var>navigable</var>, <var>context nodes</var>,\n<var>selector</var>, and <var>maximum returned node count</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>returned nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑦\">list</a>.</p>"
        },
        {
          "html": "For each <var>context node</var> of <var>context nodes</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>evaluate result</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#dom-xpathevaluatorbase-evaluate\" id=\"ref-for-dom-xpathevaluatorbase-evaluate\">evaluate</a> on <var>navigable</var>’s\n  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document⑨\">active document</a>, with arguments <var>selector</var>, <var>context node</var>, null,\n  <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#dom-xpathresult-ordered_node_snapshot_type\" id=\"ref-for-dom-xpathresult-ordered_node_snapshot_type\">ORDERED_NODE_SNAPSHOT_TYPE</a>, and null. If this throws a \"<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#syntaxerror\" id=\"ref-for-syntaxerror\">SyntaxError</a>\"\n  <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-selector\" id=\"ref-for-dfn-invalid-selector①\">invalid selector</a>;\n  otherwise, if this throws any other exception return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⓪\">error code</a>\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-error\" id=\"ref-for-dfn-unknown-error②\">unknown error</a>.</p>"
            },
            {
              "html": "<p>Let <var>index</var> be 0.</p>"
            },
            {
              "html": "<p>Let <var>length</var> be the result of getting the <code>snapshotLength</code> property\n  from <var>evaluate result</var>.</p>"
            },
            {
              "html": "Repeat, while <var>index</var> is less than <var>length</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>node</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#dom-xpathresult-snapshotitem\" id=\"ref-for-dom-xpathresult-snapshotitem\">snapshotItem</a> with <var>evaluate result</var>\n as this and <var>index</var> as the argument.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⓪\">Append</a> <var>node</var> to <var>returned nodes</var>.</p>"
                },
                {
                  "html": "<p>If <var>maximum returned node count</var> not null and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a> of\n <var>returned nodes</var> is equal to <var>maximum returned node count</var>,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⑥\">success</a> with data <var>returned nodes</var>.</p>"
                },
                {
                  "html": "<p>Set <var>index</var> to <var>index</var> + 1.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⑦\">success</a> with data <var>returned nodes</var>.</p>"
        }
      ]
    },
    {
      "name": "locate nodes using inner text",
      "href": "https://w3c.github.io/webdriver-bidi/#locate-nodes-using-inner-text",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"locate-nodes-using-inner-text\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">locate nodes using inner text</dfn> with given <var>context nodes</var>,\n<var>selector</var>, <var>max depth</var>, <var>match type</var>, <var>ignore case</var>, and <var>maximum returned node count</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>selector</var> is the empty string, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④①\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-selector\" id=\"ref-for-dfn-invalid-selector②\">invalid selector</a>.</p>"
        },
        {
          "html": "<p>Let <var>returned nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑧\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>ignore case</var> is false, let <var>search text</var> be <var>selector</var>. Otherwise, let\n <var>search text</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.unicode.org/versions/Unicode15.0.0/ch03.pdf#G34078\" id=\"ref-for-G34078\">toUppercase</a> with <var>selector</var> according\n to the <a data-link-type=\"dfn\" href=\"https://www.unicode.org/versions/Unicode15.0.0/ch03.pdf#G34944\" id=\"ref-for-G34944\">Unicode Default Case Conversion algorithm</a>.</p>"
        },
        {
          "html": "For each <var>context node</var> in <var>context nodes</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>context node</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#document\" id=\"ref-for-document①\">Document</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#documentfragment\" id=\"ref-for-documentfragment\">DocumentFragment</a></code>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>child nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①⑨\">list</a>.</p>"
                },
                {
                  "html": "For each node <var>child</var> in the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\" id=\"ref-for-concept-tree-child\">children</a> of <var>context node</var>.",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①①\">Append</a> <var>child</var> to <var>child nodes</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend\">Extend</a> <var>returned nodes</var> with the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-inner-text\" id=\"ref-for-locate-nodes-using-inner-text\">locate nodes using inner text</a>\nwith <var>child nodes</var>, <var>selector</var>, <var>max depth</var>, <var>match type</var>, <var>ignore case</var>, and <var>maximum returned node count</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>context node</var> does not implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dom.html#htmlelement\" id=\"ref-for-htmlelement\">HTMLElement</a></code> then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>node inner text</var> be the result of calling the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#dom-innertext\" id=\"ref-for-dom-innertext\">innerText getter steps</a> with\n <var>context node</var> as the <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a> value.</p>"
            },
            {
              "html": "<p>If <var>ignore case</var> is false, let <var>node text</var> be <var>node inner text</var>. Otherwise,\n let <var>node text</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.unicode.org/versions/Unicode15.0.0/ch03.pdf#G34078\" id=\"ref-for-G34078①\">toUppercase</a> with <var>node inner text</var>\n according to the <a data-link-type=\"dfn\" href=\"https://www.unicode.org/versions/Unicode15.0.0/ch03.pdf#G34944\" id=\"ref-for-G34944①\">Unicode Default Case Conversion algorithm</a>.</p>"
            },
            {
              "html": "If <var>search text</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point-substring\" id=\"ref-for-code-point-substring\">code point substring</a> of <var>node text</var>, perform the\n following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>child nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⓪\">list</a> and, for each node <var>child</var> in the\n <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\" id=\"ref-for-concept-tree-child①\">children</a> of <var>context node</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①②\">Append</a> <var>child</var> to <var>child nodes</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②\">size</a> of <var>child nodes</var> is equal to 0 or <var>max depth</var> is equal to 0,\n perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>match type</var> is <code>\"full\"</code> and <var>node text</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is\">is</a> <var>search text</var>,\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①③\">append</a> <var>context node</var> to <var>returned nodes</var>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, if <var>match type</var> is <code>\"partial\"</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①④\">append</a>\n <var>context node</var> to <var>returned nodes</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "Otherwise, perform the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>child max depth</var> be null if <var>max depth</var> is null, or <var>max depth</var> - 1 otherwise.</p>"
                    },
                    {
                      "html": "<p>Let <var>child node matches</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-inner-text\" id=\"ref-for-locate-nodes-using-inner-text①\">locate nodes using inner text</a>\n with <var>child nodes</var>, <var>selector</var>, <var>child max depth</var> , <var>match type</var>,\n <var>ignore case</var>, and <var>maximum returned node count</var>.</p>"
                    },
                    {
                      "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size③\">size</a> of <var>child node matches</var> is equal to 0 and <var>match type</var> is\n <code>\"partial\"</code>, append <var>context node</var> to <var>returned nodes</var>. Otherwise,\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-extend\" id=\"ref-for-list-extend①\">extend</a> <var>returned nodes</var> with <var>child node matches</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>maximum returned node count</var> is not null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑧\">remove</a> all entries\n in <var>returned nodes</var> with an index greater than or equal to <var>maximum returned\n node count</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⑧\">success</a> with data <var>returned nodes</var>.</p>"
        }
      ]
    },
    {
      "name": "collect nodes using accessibility attributes",
      "href": "https://w3c.github.io/webdriver-bidi/#collect-nodes-using-accessibility-attributes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"collect-nodes-using-accessibility-attributes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">collect nodes using accessibility attributes</dfn> with given <var>context nodes</var>, <var>selector</var>,\n<var>maximum returned node count</var>, and <var>returned nodes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>returned nodes</var> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>returned nodes</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②①\">list</a>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>context node</var> in <var>context nodes</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>match</var> be true.</p>"
            },
            {
              "html": "If <var>context node</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element①\">Element</a></code>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>selector</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">contains</a> \"<code>role</code>\":",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>role</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/core-aam-1.2/#roleMappingComputedRole\" id=\"ref-for-roleMappingComputedRole\">computed role</a> of <var>context node</var>.</p>"
                    },
                    {
                      "html": "If <var>selector</var>[\"<code>role</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is①\">is not</a> <var>role</var>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>match</var> to false.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "If <var>selector</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">contains</a> \"<code>name</code>\":",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>name</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/accname-1.2/#dfn-accessible-name\" id=\"ref-for-dfn-accessible-name\">accessible name</a> of <var>context node</var>.</p>"
                    },
                    {
                      "html": "If <var>selector</var>[\"<code>name</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-is\" id=\"ref-for-string-is②\">is not</a> <var>name</var>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>match</var> to false.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Otherwise, set <var>match</var> to false.</p>"
            },
            {
              "html": "If <var>match</var> is true:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>maximum returned node count</var> is not null and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size④\">size</a> of <var>returned\nnodes</var> is equal to <var>maximum returned node count</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">break</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑤\">Append</a> <var>context node</var> to <var>returned nodes</var>.</p>"
                }
              ]
            },
            {
              "html": "Let <var>child nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②②\">list</a> and, for each node <var>child</var> in the\n <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\" id=\"ref-for-concept-tree-child②\">children</a> of <var>context node</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>child</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element②\">Element</a></code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑥\">append</a> <var>child</var> to <var>child nodes</var>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" data-refhint-key=\"f5554d6d\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⓪\">Try</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collect-nodes-using-accessibility-attributes\" id=\"ref-for-collect-nodes-using-accessibility-attributes\">collect nodes using accessibility attributes</a> with <var>child nodes</var>,\n <var>selector</var>, <var>maximum returned node count</var>, and <var>returned nodes</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>returned nodes</var>.</p>"
        }
      ]
    },
    {
      "name": "locate nodes using accessibility attributes",
      "href": "https://w3c.github.io/webdriver-bidi/#locate-nodes-using-accessibility-attributes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"locate-nodes-using-accessibility-attributes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">locate nodes using accessibility attributes</dfn> with given <var>context nodes</var>, <var>selector</var>, and\n<var>maximum returned node count</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>selector</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">contain</a> \"<code>role</code>\" and\n <var>selector</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">contain</a> \"<code>name</code>\", return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④②\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-selector\" id=\"ref-for-dfn-invalid-selector③\">invalid selector</a>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collect-nodes-using-accessibility-attributes\" id=\"ref-for-collect-nodes-using-accessibility-attributes①\">collect nodes using accessibility attributes</a> with <var>context nodes</var>,\n  <var>selector</var>, <var>maximum returned node count</var>, and null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.locateNodes",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⓪\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be <var>command parameters</var>[\"<code>context</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑧\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigable</var> is not null.</p>"
        },
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-navigable\" id=\"ref-for-get-a-realm-from-a-navigable\">get a realm from a navigable</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id⑨\">navigable id</a> of <var>navigable</var> and null.</p>"
        },
        {
          "html": "<p>Let <var>locator</var> be <var>command parameters</var>[\"<code>locator</code>\"].</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">contains</a> \"<code>startNodes</code>\", let\n <var>start nodes parameter</var> be <var>command parameters</var>[\"<code>startNodes</code>\"].\n Otherwise let <var>start nodes parameter</var> be null.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑥\">contains</a> \"<code>maxNodeCount</code>\", let\n <var>maximum returned node count</var> be <var>command parameters</var>[\"<code>maxNodeCount</code>\"].\n Otherwise, let <var>maximum returned node count</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>context nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②③\">list</a>.</p>"
        },
        {
          "html": "If <var>start nodes parameter</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑦\">append</a> the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#ref-for-dom-document-documentelement\" id=\"ref-for-ref-for-dom-document-documentelement②\">document element</a>\n of <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⓪\">active document</a> to <var>context nodes</var>. Otherwise, for each\n <var>serialized start node</var> in <var>start nodes parameter</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>start node</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-shared-reference\" id=\"ref-for-deserialize-shared-reference\">deserialize shared reference</a> given\n  <var>serialized start node</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑧\">Append</a> <var>start node</var> to <var>context nodes</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Assert <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑤\">size</a> of <var>context nodes</var> is greater than 0.</p>"
        },
        {
          "html": "<p>Let <var>type</var> be <var>locator</var>[\"<code>type</code>\"].</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set\n of steps for which the associated condition is true:</p>\n      <dl>\n       <dt><var>type</var> is the string \"<code>css</code>\"\n    \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>xpath</code>\"\n    \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>innerText</code>\"\n    \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>accessibility</code>\"\n    \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>context</code>\"\n    \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>selector</var> be <var>locator</var>[\"<code>value</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>result nodes</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-css\" id=\"ref-for-locate-nodes-using-css\">locate nodes using css</a>\n  given <var>navigable</var>, <var>context nodes</var>, <var>selector</var> and <var>maximum returned\n  nodes</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>selector</var> be <var>locator</var>[\"<code>value</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>result nodes</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-xpath\" id=\"ref-for-locate-nodes-using-xpath\">locate nodes using xpath</a>\n  given <var>navigable</var>, <var>context nodes</var>, <var>selector</var> and <var>maximum returned\n  nodes</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>selector</var> be <var>locator</var>[\"<code>value</code>\"].</p>"
                },
                {
                  "html": "<p>If <var>locator</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑦\">contains</a> <code>maxDepth</code>, let <var>max depth</var> be\n  <var>locator</var>[\"<code>maxDepth</code>\"]. Otherwise, let <var>max depth</var> be null.</p>"
                },
                {
                  "html": "<p>If <var>locator</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑧\">contains</a> <code>ignoreCase</code>, let <var>ignore case</var> be\n  <var>locator</var>[\"<code>ignoreCase</code>\"]. Otherwise, let <var>ignore case</var> be false.</p>"
                },
                {
                  "html": "<p>If <var>locator</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑨\">contains</a> <code>matchType</code>, let <var>match type</var> be\n  <var>locator</var>[\"<code>matchType</code>\"]. Otherwise, let <var>match type</var> be \"full\".</p>"
                },
                {
                  "html": "<p>Let <var>result nodes</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-inner-text\" id=\"ref-for-locate-nodes-using-inner-text②\">locate nodes using inner text</a>\n  given <var>context nodes</var>, <var>selector</var>, <var>max depth</var>, <var>match type</var>,\n  <var>ignore case</var> and <var>maximum returned node count</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>selector</var> be <var>locator</var>[\"<code>value</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>result nodes</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-nodes-using-accessibility-attributes\" id=\"ref-for-locate-nodes-using-accessibility-attributes\">locate nodes using accessibility attributes</a>\n  given <var>context nodes</var>, <var>selector</var>, and <var>maximum returned node count</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>start nodes parameter</var> is not null,\n  return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④③\">error code</a> \"<code>invalid argument</code>\".</p>"
                },
                {
                  "html": "<p>Let <var>selector</var> be <var>locator</var>[\"<code>value</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>context id</var> be <var>selector</var>[\"<code>context</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>child navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable⑨\">get a navigable</a> with <var>context id</var>.</p>"
                },
                {
                  "html": "<p>If <var>child navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent②\">parent</a> is not <var>navigable</var>,\n  return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④④\">error code</a> \"<code>invalid argument</code>\".</p>"
                },
                {
                  "html": "<p>Let <var>result nodes</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locate-the-container-element\" id=\"ref-for-locate-the-container-element\">locate the container element</a> given <var>child navigable</var>.</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: For each <var>node</var> in <var>result nodes</var>, <var>node</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable②\">node navigable</a> is <var>navigable</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>maximum returned node count</var> is null or <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑥\">size</a> of <var>result nodes</var> is less\n than or equal to <var>maximum returned node count</var>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⓪\">contains</a> \"<code>serializationOptions</code>\",\n let <var>serialization options</var> be <var>command parameters</var>[\"<code>serializationOptions</code>\"].\n Otherwise, let <var>serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑤\">map</a> matching the\n <code>script.SerializationOptions</code> production with the fields\n set to their default values.</p>"
        },
        {
          "html": "<p>Let <var>result ownership</var> be \"none\".</p>"
        },
        {
          "html": "<p>Let <var>serialized nodes</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②④\">list</a>.</p>"
        },
        {
          "html": "For each <var>result node</var> in <var>result nodes</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>serialized node</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value\">serialize as a remote value</a> with\n  <var>result node</var>, <var>serialization options</var>, <var>result ownership</var>, a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑥\">map</a>\n  as serialization internal map, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⑨\">Append</a> <var>serialized node</var> to <var>serialized nodes</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑦\">map</a> matching the <code>browsingContext.LocateNodesResult</code>\n production, with the <code>nodes</code> field set <var>serialized nodes</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③⑨\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.navigate",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②①\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⓪\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigable</var> is not null.</p>"
        },
        {
          "html": "<p>Let <var>wait condition</var> be \"<code>committed</code>\".</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②①\">contains</a> <code>wait</code>\n and <var>command parameters</var>[<code>wait</code>] is not \"<code>none</code>\",\n set <var>wait condition</var> to <var>command parameters</var>[<code>wait</code>].</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the value of the <code>url</code> field of <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①①\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>base</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-script-base-url\" id=\"ref-for-concept-script-base-url\">base URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>url record</var> be the result of applying the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">URL parser</a> to <var>url</var>,\n with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-script-base-url\" id=\"ref-for-concept-script-base-url①\">base URL</a> <var>base</var>.</p>"
        },
        {
          "html": "<p>If <var>url record</var> is failure, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors④⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①\">request</a> whose URL is <var>url record</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#await-a-navigation\" id=\"ref-for-await-a-navigation\">await a navigation</a> with <var>navigable</var>, <var>request</var> and\n <var>wait condition</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.print",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②②\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try②⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①①\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>If the implementation is unable to provide a paginated representation of\n <var>navigable</var> for any reason then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⑥\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①②\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>margin</var> be the value of the <code>margin</code> field of <var>command\n parameters</var> if present, or otherwise a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑧\">map</a> matching the\n <code>browsingContext.PrintMarginParameters</code> with the fields set to\n their default values.</p>"
        },
        {
          "html": "<p>Let <var>page size</var> be the value of the <code>page</code> field of <var>command\n parameters</var> if present, or otherwise a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②⑨\">map</a> matching the\n <code>browsingContext.PrintPageParameters</code> with the fields set to\n their default values.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.print",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②②\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>page ranges</var> be the value of the <code>pageRanges</code> field of\n <var>command parameters</var> if present or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑤\">list</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①②\">active document</a>.</p>"
        },
        {
          "html": "Immediately after the next invocation of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#run-the-animation-frame-callbacks\" id=\"ref-for-run-the-animation-frame-callbacks①\">run the animation frame callbacks</a> algorithm for <var>document</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>pdf data</var> be the result taking UA-specific steps to generate a\n paginated representation of <var>document</var>, with the CSS <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/mediaqueries-4/#media-type\" id=\"ref-for-media-type\">media type</a> set to\n <code>print</code>, encoded as a PDF, with the following paper settings:</p>\n        <table>\n         <tbody>\n          <tr>\n           <th>Property\n     \n           </th><th>Value\n   \n          </th></tr><tr>\n           <td>Width in cm\n     \n           </td><td><var>page size</var>[\"<code>width</code>\"] if\n         <var>command parameters</var>[\"<code>orientation</code>\"] is\n         \"<code>portrait</code>\" otherwise <var>page size</var>[\"<code>height</code>\"]\n   \n          </td></tr><tr>\n           <td>Height in cm\n     \n           </td><td><var>page size</var>[\"<code>height</code>\"] if\n         <var>command parameters</var>[\"<code>orientation</code>\"] is\n         \"<code>portrait</code>\" otherwise <var>page size</var>[\"<code>width</code>\"]\n   \n          </td></tr><tr>\n           <td>Top margin, in cm\n     \n           </td><td><var>margin</var>[\"<code>top</code>\"]\n   \n          </td></tr><tr>\n           <td>Bottom margin, in cm\n     \n           </td><td><var>margin</var>[\"<code>bottom</code>\"]\n   \n          </td></tr><tr>\n           <td>Left margin, in cm\n     \n           </td><td><var>margin</var>[\"<code>left</code>\"]\n   \n          </td></tr><tr>\n           <td>Right margin, in cm\n     \n           </td><td><var>margin</var>[\"<code>right</code>\"]\n \n        </td></tr></tbody></table>\n        <p>In addition, the following formatting hints should be applied by the UA:</p>\n        <dl>\n         <dt>If <var>command parameters</var>[\"<code>scale</code>\"] is not equal to <code>1</code>:\n     \n         </dt><dd>Zoom the size of the content by a factor <var>command parameters</var>[\"<code>scale</code>\"]\n     \n         </dd><dt>If <var>command parameters</var>[\"<code>background</code>\"] is false:\n     \n         </dt><dd>Suppress output of background images\n     \n         </dd><dt>If <var>command parameters</var>[\"<code>shrinkToFit</code>\"] is true:\n     \n         </dt><dd>Resize the content to match the page width, overriding any page\n         width specified in the content\n   \n        </dd></dl>"
            },
            {
              "html": "<p>If <var>page ranges</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑦\">empty</a>, let <var>pages</var> be the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-parse-a-page-range\" id=\"ref-for-dfn-parse-a-page-range\">parse a page range</a> with <var>page ranges</var> and the number of\n pages contained in <var>pdf data</var>, then remove any pages from <var>pdf data</var>\n whose one-based index is not contained in <var>pages</var>.</p>"
            },
            {
              "html": "<p>Let <var>encoding result</var> be the result of calling <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc4648#section-4\" id=\"ref-for-section-4\">Base64 Encode</a> on\n <var>pdf data</var>.</p>"
            },
            {
              "html": "<p>Let <var>encoded data</var> be <var>encoding result</var>’s data.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⓪\">map</a> matching the\n <code>browsingContext.PrintResult</code> production, with the\n <code>data</code> field set to <var>encoded data</var>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⓪\">success</a> with data <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.reload",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②③\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①②\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigable</var> is not null.</p>"
        },
        {
          "html": "<p>Let <var>ignore cache</var> be the the value of the <code>ignoreCache</code> field of <var>command\n parameters</var> if present, or false otherwise.</p>"
        },
        {
          "html": "<p>Let <var>wait condition</var> be \"<code>committed</code>\".</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②②\">contains</a> <code>wait</code>\n and <var>command parameters</var>[<code>wait</code>] is not \"<code>none</code>\",\n set <var>wait condition</var> to <var>command parameters</var>[<code>wait</code>].</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①③\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-url\" id=\"ref-for-concept-document-url①\">URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>request</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request②\">request</a> whose URL is <var>url</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#await-a-navigation\" id=\"ref-for-await-a-navigation①\">await a navigation</a> with <var>navigable</var>, <var>request</var>, <var>wait\n condition</var>, history handling \"<code>reload</code>\", and ignore\n cache <var>ignore cache</var>.</p>"
        }
      ]
    },
    {
      "name": "set device pixel ratio override",
      "href": "https://w3c.github.io/webdriver-bidi/#set-device-pixel-ratio-override",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-device-pixel-ratio-override\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set device pixel ratio override</dfn> given <var>navigable</var> and <var>device pixel ratio</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>device pixel ratio</var> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "For <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document①\">document</a> currently loaded in a specified <var>navigable</var>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<p>When the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/images.html#select-an-image-source-from-a-source-set\" id=\"ref-for-select-an-image-source-from-a-source-set\">select an image source from a source set</a> steps are run, act as if\n the implementation’s pixel density was set to <var>device pixel ratio</var> when selecting an image.</p>"
                },
                {
                  "html": "<p>For the purposes of the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/mediaqueries-4/#resolution\" id=\"ref-for-resolution\">resolution media feature</a>, act as if\n the implementation’s resolution is <var>device pixel ratio</var> dppx scaled by the page zoom.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">Set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#device-pixel-ratio-overrides\" id=\"ref-for-device-pixel-ratio-overrides\">device pixel ratio overrides</a>[<var>navigable</var>] to <var>device pixel ratio</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "for",
          "steps": [
            {
              "html": "For <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document②\">document</a> currently loaded in a specified <var>navigable</var>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "<p>When the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/images.html#select-an-image-source-from-a-source-set\" id=\"ref-for-select-an-image-source-from-a-source-set①\">select an image source from a source set</a> steps are run, use the implementation’s default behavior,\n without any changes made by previous invocations of these steps.</p>"
                },
                {
                  "html": "<p>For the purposes of the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/mediaqueries-4/#resolution\" id=\"ref-for-resolution①\">resolution media feature</a>, use the implementation’s default behavior,\n without any changes made by previous invocations of these steps.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove③\">Remove</a> <var>navigable</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#device-pixel-ratio-overrides\" id=\"ref-for-device-pixel-ratio-overrides①\">device pixel ratio overrides</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#evaluate-media-queries-and-report-changes\" id=\"ref-for-evaluate-media-queries-and-report-changes\">evaluate media queries and report changes</a> for <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document③\">document</a> currently loaded\n in a specified <var>navigable</var>.</p>"
        }
      ]
    },
    {
      "name": "set viewport",
      "href": "https://w3c.github.io/webdriver-bidi/#set-viewport",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-viewport\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set viewport</dfn> given <var>navigable</var> and <var>viewport</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>viewport</var> is not null, set the width of <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#layout-viewport\" id=\"ref-for-layout-viewport\">layout viewport</a> to be the <code>width</code> of <var>viewport</var> in CSS pixels and\n set the height of the <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#layout-viewport\" id=\"ref-for-layout-viewport①\">layout viewport</a> to be the\n <code>height</code> of <var>viewport</var> in CSS pixels.</p>"
        },
        {
          "html": "<p>Otherwise, set the <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#layout-viewport\" id=\"ref-for-layout-viewport②\">layout viewport</a> to the\n implementation-defined default.</p>"
        }
      ]
    },
    {
      "name": "configure new navigable",
      "html": "TODO: Move it as a hook in the html spec instead.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⑦\">associated user context</a>.</p>"
        },
        {
          "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⑥\">top-level traversable</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#geolocation-overrides-map\" id=\"ref-for-geolocation-overrides-map\">geolocation overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②③\">contains</a> <var>user context</var>,\n  <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/geolocation/#dfn-set-emulated-position-data\" id=\"ref-for-dfn-set-emulated-position-data\">set emulated position data</a> with <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#geolocation-overrides-map\" id=\"ref-for-geolocation-overrides-map①\">geolocation overrides map</a>[<var>user context</var>].</p>"
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#forced-colors-mode-theme-overrides-map\" id=\"ref-for-forced-colors-mode-theme-overrides-map\">forced colors mode theme overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②④\">contains</a> <var>user context</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>theme</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#forced-colors-mode-theme-overrides-map\" id=\"ref-for-forced-colors-mode-theme-overrides-map①\">forced colors mode theme overrides map</a>[<var>user context</var>].</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-adjust-1/#set-emulated-forced-colors-theme-data\" id=\"ref-for-set-emulated-forced-colors-theme-data\">Set emulated forced colors theme data</a> with <var>navigable</var> and <var>theme</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#screen-orientation-overrides-map\" id=\"ref-for-screen-orientation-overrides-map\">screen orientation overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑤\">contains</a> <var>user context</var>,\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-emulated-screen-orientation\" id=\"ref-for-set-emulated-screen-orientation\">set emulated screen orientation</a> with <var>navigable</var> and\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#screen-orientation-overrides-map\" id=\"ref-for-screen-orientation-overrides-map①\">screen orientation overrides map</a>[<var>user context</var>].</p>"
            }
          ]
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map\">viewport overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑥\">contains</a> <var>user context</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>navigable</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⑦\">top-level traversable</a> and the <code>viewport</code> field of\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map①\">viewport overrides map</a>[<var>user context</var>] is not null:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-viewport\" id=\"ref-for-set-viewport\">Set viewport</a> with <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map②\">viewport overrides map</a>[<var>user context</var>][\"<code>viewport</code>\"].</p>"
                }
              ]
            },
            {
              "html": "If the <code>devicePixelRatio</code> field of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map③\">viewport overrides map</a>[<var>user context</var>] is not null:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-device-pixel-ratio-override\" id=\"ref-for-set-device-pixel-ratio-override\">Set device pixel ratio override</a> with <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map④\">viewport overrides map</a>[<var>user context</var>][\"<code>devicePixelRatio</code>\"\"].</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.setViewport",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②④\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the implementation is unable to adjust the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view/#layout-viewport\" id=\"ref-for-layout-viewport③\">layout viewport</a>\n parameters with the given <var>command parameters</var> for any reason, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①③\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑦\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑧\">contains</a> \"<code>context</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③①\">set</a>.</p>"
        },
        {
          "html": "If the <code>context</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of <var>command\n  parameters</var>.</p>"
            },
            {
              "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①③\">get a navigable</a> with\n  <var>navigable id</var>.</p>"
            },
            {
              "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⑧\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤③\">error</a> with\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑦\">invalid argument</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑥\">Append</a> <var>navigable</var> to <var>navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise, if the <code>userContexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts①\">get valid user contexts</a> with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤\">Set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map⑤\">viewport overrides map</a>[<var>user context</var>] to a struct.</p>"
                },
                {
                  "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⑨\">contains</a> \"<code>viewport</code>\":",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map⑥\">viewport overrides map</a>[<var>user context</var>][\"<code>viewport</code>\"]\n  to <var>command parameters</var>[\"<code>viewport</code>\"].</p>"
                    }
                  ]
                },
                {
                  "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⓪\">contains</a> \"<code>devicePixelRatio</code>\":",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#viewport-overrides-map\" id=\"ref-for-viewport-overrides-map⑦\">viewport overrides map</a>[<var>user context</var>][\"<code>devicePixelRatio</code>\"]\n  to <var>command parameters</var>[\"<code>devicePixelRatio</code>\"].</p>"
                    }
                  ]
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>top-level traversable</var> of the list of all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable③⑨\">top-level traversables</a>\n whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⑧\">associated user context</a> is <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⓪\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Otherwise, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③①\">contains</a> the <code>viewport</code> field:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>viewport</var> be the <var>command parameters</var>[\"<code>viewport</code>\"].</p>"
            },
            {
              "html": "For each <var>navigable</var> of <var>navigables</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-viewport\" id=\"ref-for-set-viewport①\">Set viewport</a> with <var>navigable</var> and <var>viewport</var>.</p>"
                },
                {
                  "html": "<p>Run the <a href=\"https://drafts.csswg.org/cssom-view-1/#resizing-viewports\"><cite>CSSOM View</cite> § 13.1 Resizing viewports</a> steps with <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①④\">active document</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③②\">contains</a> the <code>devicePixelRatio</code> field:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>device pixel ratio</var> be the <var>command\n  parameters</var>[\"<code>devicePixelRatio</code>\"].</p>"
            },
            {
              "html": "For each <var>navigable</var> of <var>navigables</var>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For the <var>navigable</var> and all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#descendant-navigables\" id=\"ref-for-descendant-navigables\">descendant navigables</a>:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-device-pixel-ratio-override\" id=\"ref-for-set-device-pixel-ratio-override①\">Set device pixel ratio override</a> with <var>navigable</var> and <var>device pixel ratio</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④①\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for browsingContext.traverseHistory",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⑤\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①④\">get a navigable</a>\n with <var>command parameters</var>[\"<code>context</code>\"].</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④⓪\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⑤\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>navigable</var> is not null.</p>"
        },
        {
          "html": "<p>Let <var>delta</var> be <var>command parameters</var>[\"<code>delta</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>resume id</var> be a unique string.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\" id=\"ref-for-queue-a-task\">Queue a task</a> on <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-session-history-traversal-queue\" id=\"ref-for-tn-session-history-traversal-queue\">session history traversal queue</a> to run\n the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>all steps</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#getting-all-used-history-steps\" id=\"ref-for-getting-all-used-history-steps\">getting all used history steps</a> for <var>navigable</var>.</p>"
            },
            {
              "html": "<p>Let <var>current index</var> be the index of <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#tn-current-session-history-step\" id=\"ref-for-tn-current-session-history-step\">current session history step</a> within <var>all steps</var>.</p>"
            },
            {
              "html": "<p>Let <var>target index</var> be <var>current index</var> plus <var>delta</var>.</p>"
            },
            {
              "html": "<p>Let <var>valid entry</var> be false if <var>all steps</var>[<var>target index</var>] does not exist,\n or true otherwise.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①\">Resume</a> with \"<code>check history</code>\", <var>resume id</var>, and\n <var>valid entry</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>is valid entry</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits③\">await</a> with «\"<code>check history</code>\"», and\n <var>resume id</var>.</p>"
        },
        {
          "html": "<p>If <var>is valid entry</var> is false, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⑥\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-history-entry\" id=\"ref-for-errors-no-such-history-entry\">no such history entry</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#traverse-the-history-by-a-delta\" id=\"ref-for-traverse-the-history-by-a-delta\">Traverse the history by a delta</a> given <var>delta</var> and <var>navigable</var>.</p>"
        },
        {
          "html": "<p>TODO: Support waiting for the history traversal to complete.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③①\">map</a> matching the\n <code>browsingContext.TraverseHistoryResult</code> production.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④②\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi page show",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-page-show",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-page-show\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi page show</dfn> steps given <var>context</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status①\">navigation status</a> <var>navigation status</var>\nare:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id②\">id</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume②\">Resume</a> with \"<code>page show</code>\", <var>navigation id</var>, and\n  <var>navigation status</var>.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi pop state",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-pop-state",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-pop-state\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi pop state</dfn> steps given <var>context</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status②\">navigation status</a> <var>navigation status</var>\nare:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id③\">id</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume③\">Resume</a> with \"<code>pop state</code>\", <var>navigation id</var>, and\n  <var>navigation status</var>.</p>"
        }
      ]
    },
    {
      "name": "Recursively emit context created events",
      "href": "https://w3c.github.io/webdriver-bidi/#recursively-emit-context-created-events",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"recursively-emit-context-created-events\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Recursively emit context created events</dfn> given <var>session</var> and <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-a-context-created-event\" id=\"ref-for-emit-a-context-created-event\">Emit a context created event</a> with <var>session</var> and <var>navigable</var>.</p>"
        },
        {
          "html": "<p>For each child navigable, <var>child</var>, of <var>navigable</var>:</p>",
          "ignored": [
            "Recursively emit context created events given session and child."
          ]
        }
      ]
    },
    {
      "name": "Emit a context created event",
      "href": "https://w3c.github.io/webdriver-bidi/#emit-a-context-created-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"emit-a-context-created-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Emit a context created event</dfn> given <var>session</var> and <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigable-info\" id=\"ref-for-get-the-navigable-info②\">get the navigable info</a> given\n <var>navigable</var>, 0, and true.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③②\">map</a> matching the\n <code>browsingContext.ContextCreated</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end event trigger for browsingContext.contextCreated",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigable-created",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger\">remote end event trigger</a> is\nthe <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigable-created\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigable created</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⓪\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②①\">navigable</a> <var>opener navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#original-opener\" id=\"ref-for-original-opener②\">original opener</a> to <var>opener navigable</var>,\n if <var>opener navigable</var> is provided.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior\" id=\"ref-for-navigable-cache-behavior\">navigable cache behavior</a> with <var>navigable</var> is \"<code>bypass</code>\",\n then perform implementation-defined steps to disable any implementation-specific\n resource caches for network requests originating from <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③②\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.contextCreated</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-a-context-created-event\" id=\"ref-for-emit-a-context-created-event①\">Emit a context created event</a> given <var>session</var> and <var>navigable</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end subscribe steps for browsingContext.contextCreated",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-subscribe-steps\" id=\"ref-for-event-remote-end-subscribe-steps②\">remote end subscribe steps</a>, with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscribe-priority\" id=\"ref-for-event-subscribe-priority①\">subscribe priority</a> 1, given\n<var>session</var>, <var>navigables</var> and <var>include global</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>For each <var>navigable</var> in <var>navigables</var>:</p>",
          "ignored": [
            "Recursively emit context created events given session and navigable."
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for browsingContext.contextDestroyed",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigable-destroyed",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger②\">remote end event trigger</a> is\nthe <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigable-destroyed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigable destroyed</dfn> steps given <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②②\">navigable</a> <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigable-info\" id=\"ref-for-get-the-navigable-info③\">get the navigable info</a>, given\n <var>navigable</var>, null, and true.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③③\">map</a> matching the\n  <code>browsingContext.ContextDestroyed</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③③\">set</a> containing <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-parent\" id=\"ref-for-nav-parent③\">parent</a>,\n if that is not null, or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③④\">set</a> otherwise.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.contextDestroyed</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            },
            {
              "html": "<p>Let <var>subscriptions to remove</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑤\">set</a>.</p>"
            },
            {
              "html": "For each <var>subscription</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions①⓪\">subscriptions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids④\">top-level traversable ids</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain⑨\">contains</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①⓪\">navigable id</a>;",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑨\">Remove</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①①\">navigable id</a> from <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids⑤\">top-level traversable ids</a>.</p>"
                    },
                    {
                      "html": "If <var>subscription</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#subscription-top-level-traversable-ids\" id=\"ref-for-subscription-top-level-traversable-ids⑥\">top-level traversable ids</a> is empty:",
                      "rationale": "append",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①⑦\">Append</a> <var>subscription</var> to <var>subscriptions to remove</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⓪\">Remove</a> <var>subscriptions to remove</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscriptions\" id=\"ref-for-event-subscriptions①①\">subscriptions</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi navigation started",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-started",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger③\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigation-started\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigation started</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②③\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status③\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③④\">map</a> matching the\n  <code>browsingContext.NavigationStarted</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id④\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑥\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume④\">Resume</a> with \"<code>navigation started</code>\", <var>navigation id</var>, and\n <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled②\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.navigationStarted</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi fragment navigated",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-fragment-navigated",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger④\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-fragment-navigated\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi fragment navigated</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②④\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status④\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info①\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑤\">map</a> matching the\n  <code>browsingContext.FragmentNavigated</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id⑤\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigable</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑦\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume⑤\">Resume</a> with \"<code>fragment navigated</code>\", <var>navigation id</var>, and\n <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled③\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.fragmentNavigated</code>\" and <var>related navigable</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event③\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi history updated",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-history-updated",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger⑤\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-history-updated\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi history updated</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⑤\">navigable</a> <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer④\">URL serializer</a>,\n given <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc\" id=\"ref-for-nav-bc\">active browsing context</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⑤\">active document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-url\" id=\"ref-for-concept-document-url②\">URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>timestamp</var> be a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-time-values-and-time-range\" id=\"ref-for-sec-time-values-and-time-range①\">time value</a> representing the current date and time in UTC.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑥\">map</a> matching the <code>browsingContext.HistoryUpdatedParameters</code> production,\n with the <code>url</code> field set to <var>url</var>,\n the <code>timestamp</code> field set to <var>timestamp</var> and\n the <code>context</code> field set to <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①②\">navigable id</a>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑦\">map</a> matching the\n <code>browsingContext.HistoryUpdated</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related browsing contexts</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑧\">set</a> containing <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-bc\" id=\"ref-for-nav-bc①\">active browsing context</a>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled④\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.historyUpdated</code>\" and <var>related browsing contexts</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event④\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi DOM content loaded",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-dom-content-loaded",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger⑥\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-dom-content-loaded\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi DOM content loaded</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⑥\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status⑤\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info②\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑧\">map</a> matching the\n <code>browsingContext.DomContentLoaded</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③⑨\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id⑥\">id</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume⑥\">Resume</a> with \"<code>domContentLoaded</code>\", <var>navigation id</var>, and\n <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled⑤\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.domContentLoaded</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event⑤\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi load complete",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-load-complete",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger⑦\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-load-complete\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi load complete</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⑦\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status⑥\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info③\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③⑨\">map</a> matching the <code>browsingContext.Load</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⓪\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id⑦\">id</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume⑦\">Resume</a> with \"<code>load</code>\", <var>navigation id</var> and\n <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled⑥\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.load</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event⑥\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi download will begin",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-download-will-begin",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger⑧\">remote end event trigger</a> is the\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-download-will-begin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi download will begin</dfn> steps given <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⑧\">navigable</a> <var>navigable</var> and\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status⑦\">navigation status</a> <var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info④\">get the navigation info</a> given\n <var>navigable</var> and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⓪\">map</a> matching the\n <code>browsingContext.DownloadWillBeginParams</code> production, with the\n <code>context</code> field set to <var>navigation info</var>[\"<code>context</code>\"], the\n <code>navigation</code> field set to <var>navigation info</var>[\"<code>navigation</code>\"],\n the <code>timestamp</code> field set to\n <var>navigation info</var>[\"<code>timestamp</code>\"], the <code>url</code> field set to\n <var>navigation info</var>[\"<code>url</code>\"] and <code>suggestedFilename</code> field set\n to <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-suggested-filename\" id=\"ref-for-navigation-status-suggested-filename\">suggestedFilename</a>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④①\">map</a> matching the\n <code>browsingContext.DownloadWillBegin</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id⑧\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④①\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume⑧\">Resume</a> with \"<code>download started</code>\", <var>navigation id</var>, and\n <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled⑦\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.downloadWillBegin</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event⑦\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>download behavior</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-download-behavior\" id=\"ref-for-get-download-behavior\">get download behavior</a> with <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Return <var>download behavior</var>.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi download started",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-download-started",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger⑨\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-download-started\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi download started</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables②⑨\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status⑧\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info⑤\">get the navigation info</a> given <var>navigable</var> and\n  <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④②\">map</a> matching the <code>browsingContext.DownloadWillBeginParams</code>\n production, with the <code>context</code> field set to <var>navigation info</var>[\"<code>context</code>\"],\n the <code>navigation</code> field set to <var>navigation info</var>[\"<code>navigation</code>\"], the\n <code>timestamp</code> field set to <var>navigation info</var>[\"<code>timestamp</code>\"], the\n <code>url</code> field set to <var>navigation info</var>[\"<code>url</code>\"] and\n <code>suggestedFilename</code> field set to <var>navigation status</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-suggested-filename\" id=\"ref-for-navigation-status-suggested-filename①\">suggestedFilename</a>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④③\">map</a> matching the\n <code>browsingContext.DownloadWillBegin</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id⑨\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④②\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume⑨\">Resume</a> with \"<code>download started</code>\", <var>navigation id</var>, and <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled⑧\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.downloadWillBegin</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event⑧\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi download end",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-download-end",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⓪\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-download-end\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi download end</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③⓪\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status⑨\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigation info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info⑥\">get the navigation info</a> given\n <var>navigable</var> and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Assert <var>navigation info</var>[\"<code>status</code>\"] is equal to either\n \"<code>complete</code>\" or \"<code>canceled</code>\".</p>"
        },
        {
          "html": "<p>If <var>navigation info</var>[\"<code>status</code>\"] is \"<code>complete</code>\", let\n <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④④\">map</a> matching the\n <code>browsingContext.DownloadCompleteParams</code> production, with the\n <code>filepath</code> field set to\n <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-downloaded-filepath\" id=\"ref-for-navigation-status-downloaded-filepath\">downloadedFilepath</a>, the\n <code>context</code> field set to <var>navigation info</var>[\"<code>context</code>\"], the\n <code>navigation</code> field set to <var>navigation info</var>[\"<code>navigation</code>\"],\n the <code>timestamp</code> field set to\n <var>navigation info</var>[\"<code>timestamp</code>\"], and the <code>url</code> field set to\n <var>navigation info</var>[\"<code>url</code>\"].</p>"
        },
        {
          "html": "<p>Otherwise, let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑤\">map</a> matching the\n <code>browsingContext.DownloadCanceledParams</code> production, with the\n <code>context</code> field set to <var>navigation info</var>[\"<code>context</code>\"], the\n <code>navigation</code> field set to <var>navigation info</var>[\"<code>navigation</code>\"],\n the <code>timestamp</code> field set to\n <var>navigation info</var>[\"<code>timestamp</code>\"], and the <code>url</code> field set to\n <var>navigation info</var>[\"<code>url</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑥\">map</a> matching the\n <code>browsingContext.DownloadEnd</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④③\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled⑨\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.downloadEnd</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event⑨\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi navigation aborted",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-aborted",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①①\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigation-aborted\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigation aborted</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③①\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status①⓪\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info⑦\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑦\">map</a> matching the\n  <code>browsingContext.NavigationAborted</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id①⓪\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④④\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⓪\">Resume</a> with \"<code>navigation aborted</code>\", <var>navigation id</var>, and <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⓪\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.navigationAborted</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⓪\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi navigation committed",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-committed",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①②\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigation-committed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigation committed</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③②\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status①①\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info⑧\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑧\">map</a> matching the\n  <code>browsingContext.NavigationCommitted</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑤\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id①①\">id</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①①\">Resume</a> with \"<code>navigation committed</code>\", <var>navigation id</var>, and <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①①\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.navigationCommitted</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①①\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi navigation failed",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-failed",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①③\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-navigation-failed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi navigation failed</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③③\">navigable</a> <var>navigable</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-navigation-status\" id=\"ref-for-webdriver-bidi-navigation-status①②\">navigation status</a>\n<var>navigation status</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigation-info\" id=\"ref-for-get-the-navigation-info⑨\">get the navigation info</a> given <var>navigable</var>\n and <var>navigation status</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④⑨\">map</a> matching the\n  <code>browsingContext.NavigationFailed</code> production, with the\n  <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation id</var> be <var>navigation status</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigation-status-id\" id=\"ref-for-navigation-status-id①②\">id</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑥\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①②\">Resume</a> with \"<code>navigation failed</code>\", <var>navigation id</var>, and <var>navigation status</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①②\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.navigationFailed</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①②\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi user prompt closed",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-user-prompt-closed",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①④\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-user-prompt-closed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi user prompt closed</dfn> steps\ngiven <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window⑤\">Window</a></code> <var>window</var>, string <var>type</var>, boolean <var>accepted</var> and optional text <var>user text</var>\n(default: null).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①③\">navigable id</a> for <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⓪\">map</a> matching the\n <code>browsingContext.UserPromptClosedParameters</code> production with the\n <code>context</code> field set to <var>navigable id</var>, the <code>accepted</code>\n field set to <var>accepted</var>, the <code>type</code> field set to <var>type</var>, and the\n <code>userText</code> field set to <var>user text</var> if <var>user text</var> is not null or\n omitted otherwise.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤①\">map</a> matching the\n <code>BrowsingContextUserPromptClosedEvent</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑦\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①③\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.userPromptClosed</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①③\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get navigable’s user prompt handler",
      "href": "https://w3c.github.io/webdriver-bidi/#get-navigables-user-prompt-handler",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-navigables-user-prompt-handler\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get navigable’s user prompt handler</dfn> given <var>type</var> and <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context①⑨\">associated user context</a>.</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unhandled-prompt-behavior-overrides-map\" id=\"ref-for-unhandled-prompt-behavior-overrides-map①\">unhandled prompt behavior overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③③\">contains</a> <var>user context</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>unhandled prompt behavior override</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unhandled-prompt-behavior-overrides-map\" id=\"ref-for-unhandled-prompt-behavior-overrides-map②\">unhandled prompt behavior overrides map</a>[<var>user context</var>].</p>"
            },
            {
              "html": "<p>If <var>unhandled prompt behavior override</var>[<var>type</var>] is not null, return\n <var>unhandled prompt behavior override</var>[<var>type</var>].</p>"
            },
            {
              "html": "<p>If <var>unhandled prompt behavior override</var>[<code>\"default\"</code>] is not null,\n return <var>unhandled prompt behavior override</var>[<code>\"default\"</code>].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>handler configuration</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-the-prompt-handler\" id=\"ref-for-dfn-get-the-prompt-handler\">get the prompt handler</a> with <var>type</var>.</p>"
        },
        {
          "html": "<p>Return <var>handler configuration</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-handler\" id=\"ref-for-dfn-handler\">handler</a>.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi user prompt opened",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-user-prompt-opened",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⑤\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-user-prompt-opened\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi user prompt opened</dfn> steps\ngiven <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window⑥\">Window</a></code> <var>window</var>, string <var>type</var>, string <var>message</var>, and optional text <var>default value</var>\n(default: null).",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable①\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①④\">navigable id</a> for <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>handler</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-navigables-user-prompt-handler\" id=\"ref-for-get-navigables-user-prompt-handler\">get navigable’s user prompt handler</a> with <var>type</var> and\n <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤②\">map</a> matching the\n <code>browsingContext.UserPromptOpenedParameters</code> production with the\n <code>context</code> field set to <var>navigable id</var>, the <code>type</code> field\n set to <var>type</var>, the <code>message</code> field set to <var>message</var>, the\n <code>defaultValue</code> field set to <var>default value</var> if <var>default value</var> is\n not null or omitted otherwise, and the <code>handler</code> field set to\n <var>handler</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤③\">map</a> matching the\n <code>browsingContext.UserPromptOpened</code> production, with the\n <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑧\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①④\">set of sessions for which an event is enabled</a>\n given \"<code>browsingContext.userPromptOpened</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①④\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>handler</var> is \"<code>ignore</code>\", set handler to \"<code>none</code>\".</p>"
        },
        {
          "html": "<p>Return <var>handler</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setForcedColorsModeThemeOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⑥\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③④\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑤\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑥\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑦\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>theme</var> be <var>command parameters</var>[\"<code>theme</code>\"].</p>"
        },
        {
          "html": "<p>If <var>theme</var> is null, set <var>theme</var> to \"<code>none</code>\".</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④⑨\">set</a>.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids\">get valid top-level traversables by ids</a> with <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts②\">get valid user contexts</a> with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑥\">Set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#forced-colors-mode-theme-overrides-map\" id=\"ref-for-forced-colors-mode-theme-overrides-map②\">forced colors mode theme overrides map</a>[<var>user context</var>] to <var>theme</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>top-level traversable</var> of the list of all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④①\">top-level traversables</a>\n whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⓪\">associated user context</a> is <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②①\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-color-adjust-1/#set-emulated-forced-colors-theme-data\" id=\"ref-for-set-emulated-forced-colors-theme-data①\">Set emulated forced colors theme data</a> with <var>navigable</var> and <var>theme</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④③\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setGeolocationOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⑦\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑧\">contains</a> \"<code>coordinates</code>\" and\n <var>command parameters</var>[\"<code>coordinates</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③⑨\">contains</a>\n \"<code>altitudeAccuracy</code>\" and\n <var>command parameters</var>[\"<code>coordinates</code>\"] doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⓪\">contain</a>\n \"<code>altitude</code>\", return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑤⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤④\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②②\">invalid argument</a>.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④①\">contains</a> \"<code>error</code>\":",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p>Assert <var>command parameters</var>[\"<code>error</code>\"][\"<code>type</code>\"] equals\n  \"<code>positionUnavailable</code>\".</p>"
            },
            {
              "html": "<p>Let <var>emulated position data</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤④\">map</a> matching <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror\" id=\"ref-for-dom-geolocationpositionerror\">GeolocationPositionError</a>\n  production, with <code>code</code> field set to <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/geolocation/#dom-geolocationpositionerror-position_unavailable\" id=\"ref-for-dom-geolocationpositionerror-position_unavailable\">POSITION_UNAVAILABLE</a> and\n  <code>message</code> field set to the empty string.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, let <var>emulated position data</var> be\n <var>command parameters</var>[\"<code>coordinates</code>\"].</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④②\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④③\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④④\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑤\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⓪\">set</a>.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids①\">get valid top-level traversables by ids</a> with <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise, if the <code>userContexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts③\">get valid user contexts</a> with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑦\">Set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#geolocation-overrides-map\" id=\"ref-for-geolocation-overrides-map②\">geolocation overrides map</a>[<var>user context</var>] to <var>emulated position data</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>top-level traversable</var> of the list of all <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④②\">top-level traversables</a>\n whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②①\">associated user context</a> is <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②②\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/geolocation/#dfn-set-emulated-position-data\" id=\"ref-for-dfn-set-emulated-position-data①\">Set emulated position data</a> with <var>navigable</var> and <var>emulated position data</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④④\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "updated DefaultLocale steps",
      "html": "The <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-defaultlocale\" id=\"ref-for-sec-defaultlocale\">DefaultLocale</a> algorithm is implementation defined. A WebDriver-BiDi\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends③④\">remote end</a> must have an implementation that runs the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm\">current Realm Record</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables\">get related navigables</a> given\n <var>environment settings</var>.</p>"
        },
        {
          "html": "For each <var>navigable</var> of <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑦\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>Let <var>user context</var> be <var>top-level traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②②\">associated user context</a>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map\">locale overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑥\">contains</a> <var>top-level traversable</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map①\">locale overrides map</a>[<var>top-level traversable</var>].</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map②\">locale overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑦\">contains</a> <var>user context</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map③\">locale overrides map</a>[<var>user context</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of implementation-defined steps in accordance with the\n requirements of the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-defaultlocale\" id=\"ref-for-sec-defaultlocale①\">DefaultLocale</a> specification.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setLocaleOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⑧\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑧\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④⑨\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⓪\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤①\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated locale</var> be <var>command parameters</var>[\"<code>locale</code>\"].</p>"
        },
        {
          "html": "<p>If <var>emulated locale</var> is not null and <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag\">IsStructurallyValidLanguageTag</a>(<var>emulated locale</var>)\n returns false, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤①\">set</a>.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try③⑨\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids②\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p>Assert the <code>userContexts</code> field of <var>command parameters</var> is present.</p>"
            },
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts④\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated locale</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove④\">remove</a> <var>user context</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map④\">locale overrides map</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑧\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map⑤\">locale overrides map</a>[<var>user context</var>] to <var>emulated locale</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>top-level traversable</var> of the list of all\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④③\">top-level traversables</a> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②③\">associated user context</a> is\n <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②③\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>emulated locale</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑤\">remove</a> <var>navigable</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map⑥\">locale overrides map</a>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑨\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#locale-overrides-map\" id=\"ref-for-locale-overrides-map⑦\">locale overrides map</a>[<var>navigable</var>] to <var>emulated locale</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⑤\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "apply network conditions",
      "href": "https://w3c.github.io/webdriver-bidi/#apply-network-conditions",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-network-conditions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply network conditions</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://websockets.spec.whatwg.org/#websocket\" id=\"ref-for-websocket\">WebSocket</a> object <var>webSocket</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>realm</var> be <var>webSocket</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant Realm</a>.</p>"
            },
            {
              "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object②\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context②\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
            },
            {
              "html": "If the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-network-is-offline\" id=\"ref-for-webdriver-bidi-network-is-offline\">WebDriver BiDi network is offline</a> with <var>environment settings</var> is true:",
              "rationale": "fail",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc6455#section-7.1.7\" id=\"ref-for-section-7.1.7①\">Fail the WebSocket connection</a> <var>webSocket</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#blocking-webtransport\" id=\"ref-for-blocking-webtransport\">WebTransport</a> object <var>webTransport</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>realm</var> be <var>webSocket</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant Realm</a>.</p>"
            },
            {
              "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object③\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context③\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
            },
            {
              "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-network-is-offline\" id=\"ref-for-webdriver-bidi-network-is-offline①\">WebDriver BiDi network is offline</a> with <var>environment settings</var> is true:</p>",
              "ignored": [
                "Cleanup WebTransport webTransport."
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setNetworkConditions",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②⑨\">remote end steps</a> with <var>command parameters</var> and <var>session</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤②\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤③\">contains</a> \"<code>context</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated network conditions</var> be null.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var>[\"<code>networkConditions</code>\"] is not null and\n    <var>command parameters</var>[\"<code>networkConditions</code>\"][\"<code>type</code>\"]\n    equals \"<code>offline</code>\", set <var>emulated network conditions</var> to a new\n    <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-struct\" id=\"ref-for-emulated-network-conditions-struct③\">emulated network conditions struct</a> with\n    <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-struct-offline\" id=\"ref-for-emulated-network-conditions-struct-offline\">offline</a> set to true.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④①\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids③\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            },
            {
              "html": "For each <var>navigable</var> of <var>navigables</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated network conditions</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑥\">remove</a> <var>navigable</var> from\n <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-navigable-network-conditions\" id=\"ref-for-emulated-network-conditions-navigable-network-conditions\">navigable network conditions</a></p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⓪\">set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions①\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-navigable-network-conditions\" id=\"ref-for-emulated-network-conditions-navigable-network-conditions①\">navigable network conditions</a>[<var>navigable</var>] to\n <var>emulated network conditions</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If the <code>userContexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts⑤\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated network conditions</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑦\">remove</a> <var>user context</var> from\n <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions②\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-user-context-network-conditions\" id=\"ref-for-emulated-network-conditions-user-context-network-conditions\">user context network conditions</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①①\">set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions③\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-user-context-network-conditions\" id=\"ref-for-emulated-network-conditions-user-context-network-conditions①\">user context network conditions</a>[<var>user context</var>]\n to <var>emulated network conditions</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤④\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑤\">contain</a> \"<code>context</code>\",\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①②\">set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions④\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-default-network-conditions\" id=\"ref-for-emulated-network-conditions-default-network-conditions\">default network conditions</a> to <var>emulated network conditions</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#apply-network-conditions\" id=\"ref-for-apply-network-conditions\">Apply network conditions</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⑥\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "set emulated screen orientation",
      "href": "https://w3c.github.io/webdriver-bidi/#set-emulated-screen-orientation",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-emulated-screen-orientation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set emulated screen orientation</dfn> given <var>navigable</var> and\n<var>emulated screen orientation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>emulated screen orientation</var> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-current-orientation-angle\" id=\"ref-for-dfn-current-orientation-angle\">current orientation angle</a> to\n  implementation-defined default.</p>"
            },
            {
              "html": "<p>Set <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-current-orientation-type\" id=\"ref-for-dfn-current-orientation-type\">current orientation type</a> to\n  implementation-defined default.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>emulated orientation type</var> be\n  <var>emulated screen orientation</var>[\"<code>type</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>emulated orientation angle</var> be the angle associated with\n  <var>emulated orientation type</var> for screens with\n  <var>emulated screen orientation</var>[\"<code>natural</code>\"] orientations as defined\n  in <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-screen-orientation-values-lists\" id=\"ref-for-dfn-screen-orientation-values-lists\">screen orientation values lists</a>.</p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-current-orientation-angle\" id=\"ref-for-dfn-current-orientation-angle①\">current orientation angle</a> to <var>emulated orientation angle</var>.</p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-current-orientation-type\" id=\"ref-for-dfn-current-orientation-type①\">current orientation type</a> to <var>emulated orientation type</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Run the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dfn-screen-orientation-change-steps\" id=\"ref-for-dfn-screen-orientation-change-steps\">screen orientation change steps</a> with the <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⑥\">active document</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setScreenOrientationOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⓪\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the implementation is unable to adjust the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/screen-orientation#dom-screenorientation\" id=\"ref-for-dom-screenorientation①\">screen orientations</a>\n parameters with the given <var>command parameters</var> for any reason, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①④\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑥\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑦\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑧\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤⑨\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated screen orientation</var> be\n <var>command parameters</var>[\"<code>screenOrientation</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤②\">set</a>.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④③\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids④\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise, if the <code>userContexts</code> field of <var>command parameters</var> is\n present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts⑥\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①③\">Set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#screen-orientation-overrides-map\" id=\"ref-for-screen-orientation-overrides-map②\">screen orientation overrides map</a>[<var>user context</var>] to\n <var>emulated screen orientation</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>top-level traversable</var> of the list of all\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④④\">top-level traversables</a> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②④\">associated user context</a> is\n <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②④\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-emulated-screen-orientation\" id=\"ref-for-set-emulated-screen-orientation①\">Set emulated screen orientation</a> with <var>navigable</var> and\n  <var>emulated screen orientation</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⑦\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi emulated User-Agent",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-emulated-user-agent",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-emulated-user-agent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi emulated User-Agent</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object④\">environment settings object</a> <var>environment settings</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables①\">get related navigables</a> with\n <var>environment settings</var>.</p>"
        },
        {
          "html": "For each <var>navigable</var> or <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>top-level navigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑧\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>Let <var>user context</var> be <var>top-level navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⑤\">associated user context</a>.</p>"
            },
            {
              "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①\">active BiDi sessions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent\">emulated user agent</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-navigable-user-agent\" id=\"ref-for-emulated-user-agent-navigable-user-agent\">navigable user agent</a> contains\n <var>top-level navigable</var>, return <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent①\">emulated user agent</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-navigable-user-agent\" id=\"ref-for-emulated-user-agent-navigable-user-agent①\">navigable user agent</a>[<var>top-level navigable</var>].</p>"
                }
              ]
            },
            {
              "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions②\">active BiDi sessions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent②\">emulated user agent</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-user-context-user-agent\" id=\"ref-for-emulated-user-agent-user-context-user-agent\">user context user agent</a>\n contains <var>user context</var>, return <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent③\">emulated user agent</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-user-context-user-agent\" id=\"ref-for-emulated-user-agent-user-context-user-agent①\">user context user agent</a>[<var>user context</var>].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions③\">active BiDi sessions</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>default emulated user agent</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent④\">emulated user agent</a>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-default-user-agent\" id=\"ref-for-emulated-user-agent-default-user-agent\">default user agent</a>.</p>"
            },
            {
              "html": "<p>If <var>default emulated user agent</var> is not null, return\n  <var>default emulated user agent</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setUserAgentOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③①\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⓪\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥①\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑥⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated user agent</var> be <var>command parameters</var>[\"<code>userAgent</code>\"].</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥②\">contains</a> \"<code>contexts</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⑤\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids⑤\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            },
            {
              "html": "For each <var>navigable</var> of <var>navigables</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated user agent</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑧\">remove</a> <var>navigable</var> from\n <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent⑤\">emulated user agent</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-navigable-user-agent\" id=\"ref-for-emulated-user-agent-navigable-user-agent②\">navigable user agent</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①④\">set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent⑥\">emulated user agent</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-navigable-user-agent\" id=\"ref-for-emulated-user-agent-navigable-user-agent③\">navigable user agent</a>[<var>navigable</var>] to <var>emulated user agent</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⑧\">success</a> with data null.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥③\">contains</a> \"<code>userContexts</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts⑦\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated user agent</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove⑨\">remove</a> <var>user context</var> from\n <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent⑦\">emulated user agent</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-user-context-user-agent\" id=\"ref-for-emulated-user-agent-user-context-user-agent②\">user context user agent</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑤\">set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent⑧\">emulated user agent</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-user-context-user-agent\" id=\"ref-for-emulated-user-agent-user-context-user-agent③\">user context user agent</a>[<var>user context</var>] to <var>emulated user agent</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④⑨\">success</a> with data null.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑥\">Set</a> <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-user-agent\" id=\"ref-for-session-emulated-user-agent⑨\">emulated user agent</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-user-agent-default-user-agent\" id=\"ref-for-emulated-user-agent-default-user-agent①\">default user agent</a> to\n <var>emulated user agent</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⓪\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi scripting is enabled",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-scripting-is-enabled",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-scripting-is-enabled\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi scripting is enabled</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑤\">environment settings object</a> <var>settings</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated <code>Document</code></a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable③\">node navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top⑨\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map\">scripting enabled overrides map</a> contains <var>top-level traversable</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map①\">scripting enabled overrides map</a>[<var>top-level traversable</var>]</p>"
        },
        {
          "html": "<p>Let <var>user context</var> be  <var>top-level traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⑥\">associated user context</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map②\">scripting enabled overrides map</a> contains <var>user context</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map③\">scripting enabled overrides map</a>[<var>user context</var>].</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setScriptingEnabled",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③②\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥④\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑤\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑥\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑦\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated scripting enabled status</var> be <var>command parameters</var>[\"<code>enabled</code>\"].</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⑦\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids⑥\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            },
            {
              "html": "For each <var>navigable</var> of <var>navigables</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated scripting enabled status</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⓪\">remove</a> <var>navigable</var> from\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map④\">scripting enabled overrides map</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑦\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map⑤\">scripting enabled overrides map</a>[<var>navigable</var>] to\n <var>emulated scripting enabled status</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If the <code>userContexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts⑧\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated scripting enabled status</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①①\">remove</a> <var>user context</var> from\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map⑥\">scripting enabled overrides map</a>.</p>"
                },
                {
                  "html": "<p>Otherwise <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑧\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scripting-enabled-overrides-map\" id=\"ref-for-scripting-enabled-overrides-map⑦\">scripting enabled overrides map</a>[<var>user context</var>] to\n <var>emulated scripting enabled status</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤①\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "updated SystemTimeZoneIdentifier steps",
      "html": "The <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-systemtimezoneidentifier\" id=\"ref-for-sec-systemtimezoneidentifier\">SystemTimeZoneIdentifier</a> algorithm is implementation defined. A\nWebDriver-BiDi <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends③⑤\">remote end</a> must have an implementation that runs the following\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>emulated timezone</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm①\">current Realm Record</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑥\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context④\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables②\">get related navigables</a> given\n <var>environment settings</var>.</p>"
        },
        {
          "html": "For each <var>navigable</var> of <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⓪\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>Let <var>user context</var> be <var>top-level traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⑦\">associated user context</a>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map\">timezone overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑧\">contains</a> <var>top-level traversable</var>, set\n <var>emulated timezone</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map①\">timezone overrides map</a>[<var>top-level traversable</var>].</p>"
            },
            {
              "html": "<p>Otherwise, if <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map②\">timezone overrides map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥⑨\">contains</a>\n <var>user context</var>, set <var>emulated timezone</var> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map③\">timezone overrides map</a>[<var>user context</var>].</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>emulated timezone</var> is not null, return <var>emulated timezone</var>.</p>"
        },
        {
          "html": "<p>Return the result of implementation-defined steps in accordance with the\n requirements of the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-systemtimezoneidentifier\" id=\"ref-for-sec-systemtimezoneidentifier①\">SystemTimeZoneIdentifier</a> specification.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for emulation.setTimezoneOverride",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③③\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⓪\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦①\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦②\">contain</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> doesn’t <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦③\">contain</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated timezone</var> be <var>command parameters</var>[\"<code>timezone</code>\"].</p>"
        },
        {
          "html": "<p>If <var>emulated timezone</var> is not null and\n <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-istimezoneoffsetstring\" id=\"ref-for-sec-istimezoneoffsetstring\">IsTimeZoneOffsetString</a>(<var>emulated timezone</var>) returns false and\n <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-availablenamedtimezoneidentifiers\" id=\"ref-for-sec-availablenamedtimezoneidentifiers\">AvailableNamedTimeZoneIdentifiers</a> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⓪\">contain</a>\n <var>emulated timezone</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤③\">set</a>.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try④⑨\">trying</a> to\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids⑦\">get valid top-level traversables by ids</a> with\n  <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p>Assert the <code>userContexts</code> field of <var>command parameters</var> is present.</p>"
            },
            {
              "html": "<p>Let <var>user contexts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-user-contexts\" id=\"ref-for-get-valid-user-contexts⑨\">get valid user contexts</a>\n  with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context</var> of <var>user contexts</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>emulated timezone</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①②\">remove</a> <var>user context</var> from\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map④\">timezone overrides map</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①⑨\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map⑤\">timezone overrides map</a>[<var>user context</var>] to <var>emulated timezone</var>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">For each</a> <var>top-level traversable</var> of the list of all\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④⑤\">top-level traversables</a> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⑧\">associated user context</a> is\n <var>user context</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑤\">Append</a> <var>top-level traversable</var> to <var>navigables</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>emulated timezone</var> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①③\">remove</a> <var>navigable</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map⑥\">timezone overrides map</a>.</p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②⓪\">set</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#timezone-overrides-map\" id=\"ref-for-timezone-overrides-map⑦\">timezone overrides map</a>[<var>navigable</var>] to <var>emulated timezone</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤②\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "get navigable for request",
      "href": "https://w3c.github.io/webdriver-bidi/#get-navigable-for-request",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-navigable-for-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get navigable for request</dfn> given request:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be null.</p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client\">client</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑦\">environment settings object</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>environment settings</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①\">client</a></p>"
            },
            {
              "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③⑥\">navigable</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window①\">active window</a> is <var>environment\n  settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a>, set <var>navigable</var>\n  to be that navigable.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>navigable</var>.</p>"
        }
      ]
    },
    {
      "name": "match collector for navigable",
      "href": "https://w3c.github.io/webdriver-bidi/#match-collector-for-navigable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-collector-for-navigable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match collector for navigable</dfn> given <var>collector</var> and <var>navigable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-contexts\" id=\"ref-for-network-collector-contexts\">contexts</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑧\">empty</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-contexts\" id=\"ref-for-network-collector-contexts①\">contexts</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①①\">contains</a> <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①⑥\">navigable id</a>, return true.</p>"
            },
            {
              "html": "<p>Otherwise, return false.</p>"
            }
          ]
        },
        {
          "html": "If <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-user-contexts\" id=\"ref-for-network-collector-user-contexts②⓪\">user contexts</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑨\">empty</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context②⑨\">associated user context</a>.</p>"
            },
            {
              "html": "<p>If <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-user-contexts\" id=\"ref-for-network-collector-user-contexts②①\">user contexts</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①②\">contains</a> <var>user context</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id⑨\">user context id</a>, return true.</p>"
            },
            {
              "html": "<p>Otherwise, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "clone network request body",
      "href": "https://w3c.github.io/webdriver-bidi/#clone-network-request-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"clone-network-request-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clone network request body</dfn> given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request③\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a> is null, return.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions④\">active BiDi sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors①\">network collectors</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⓪\">empty</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>collected data</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data\" id=\"ref-for-network-data②\">network data</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes\">bytes</a> set to null,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-cloned-body\" id=\"ref-for-network-data-cloned-body\">cloned body</a> set to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-clone\" id=\"ref-for-concept-body-clone\">clone</a> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①\">body</a>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors\">collectors</a> set to an empty list,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-pending\" id=\"ref-for-network-data-pending\">pending</a> set to true,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-request\" id=\"ref-for-network-data-request\">request</a> set to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①\">request id</a>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size\">size</a> set to null,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-type\" id=\"ref-for-network-data-type\">type</a> set to \"request\".</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑥\">Append</a> <var>collected data</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data②\">collected network data</a>.</p>"
                },
                {
                  "html": "<p>Return.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "clone network response body",
      "href": "https://w3c.github.io/webdriver-bidi/#clone-network-response-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"clone-network-response-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clone network response body</dfn> given <var>request</var> and <var>response body</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response body</var> is null, return.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions⑤\">active BiDi sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors②\">network collectors</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①①\">empty</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>collected data</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data\" id=\"ref-for-network-data③\">network data</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes①\">bytes</a> set to null,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-cloned-body\" id=\"ref-for-network-data-cloned-body①\">cloned body</a> set to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-clone\" id=\"ref-for-concept-body-clone①\">clone</a> of <var>response body</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors①\">collectors</a> set to an empty list,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-pending\" id=\"ref-for-network-data-pending①\">pending</a> set to true,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-request\" id=\"ref-for-network-data-request①\">request</a> set to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id②\">request id</a>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size①\">size</a> set to null,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-type\" id=\"ref-for-network-data-type①\">type</a> set to \"response\".</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑦\">Append</a> <var>collected data</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data③\">collected network data</a>.</p>"
                },
                {
                  "html": "<p>Return.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "get collected data",
      "href": "https://w3c.github.io/webdriver-bidi/#get-collected-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-collected-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get collected data</dfn> given <var>request id</var> and <var>data type</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For <var>collected data</var> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data④\">collected network data</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-request\" id=\"ref-for-network-data-request②\">request</a> is <var>request id</var> and\n  <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-type\" id=\"ref-for-network-data-type②\">type</a> is <var>data type</var>, return <var>collected data</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "maybe abort network response body collection",
      "href": "https://w3c.github.io/webdriver-bidi/#maybe-abort-network-response-body-collection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-abort-network-response-body-collection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe abort network response body collection</dfn> given <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>collected data</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-collected-data\" id=\"ref-for-get-collected-data\">get collected data</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id③\">request id</a> and \"response\".</p>"
        },
        {
          "html": "<p>If <var>collected data</var> is null, return.</p>"
        },
        {
          "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-pending\" id=\"ref-for-network-data-pending②\">pending</a> to false.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①③\">Resume</a> with \"<code>network data collected</code>\" and (<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id④\">request id</a>, \"response\").</p>"
        }
      ]
    },
    {
      "name": "maybe collect network request body",
      "href": "https://w3c.github.io/webdriver-bidi/#maybe-collect-network-request-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-collect-network-request-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe collect network request body</dfn> given <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>collected data</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-collected-data\" id=\"ref-for-get-collected-data①\">get collected data</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id⑤\">request id</a> and \"request\".</p>"
        },
        {
          "html": "<p>If <var>collected data</var> is null, return.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maybe-collect-network-data\" id=\"ref-for-maybe-collect-network-data\">Maybe collect network data</a> with <var>request</var>, <var>collected data</var>, null and \"request\".</p>"
        }
      ]
    },
    {
      "name": "maybe collect network response body",
      "href": "https://w3c.github.io/webdriver-bidi/#maybe-collect-network-response-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-collect-network-response-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe collect network response body</dfn> given <var>request</var> and <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status\">status</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status\">redirect status</a>, return.</p>"
        },
        {
          "html": "<p>Let <var>collected data</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-collected-data\" id=\"ref-for-get-collected-data②\">get collected data</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id⑥\">request id</a> and \"response\".</p>"
        },
        {
          "html": "<p>If <var>collected data</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>size</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-body-info\" id=\"ref-for-response-body-info\">response body info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-encoded-body-size\" id=\"ref-for-fetch-timing-info-encoded-body-size\">encoded size</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maybe-collect-network-data\" id=\"ref-for-maybe-collect-network-data①\">Maybe collect network data</a> with <var>request</var>, <var>collected data</var>, <var>size</var> and \"response\".</p>"
        }
      ]
    },
    {
      "name": "maybe collect network data",
      "href": "https://w3c.github.io/webdriver-bidi/#maybe-collect-network-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"maybe-collect-network-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">maybe collect network data</dfn> given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request④\">request</a> <var>request</var>,\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data\" id=\"ref-for-network-data④\">network data</a> <var>collected data</var>, js-uint <var>size</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#networkdatatype\" id=\"ref-for-networkdatatype②\">network.DataType</a> <var>data type</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-pending\" id=\"ref-for-network-data-pending③\">pending</a> to false.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-navigable-for-request\" id=\"ref-for-get-navigable-for-request\">get navigable for request</a> with <var>request</var>.</p>"
        },
        {
          "html": "If <var>navigable</var> is null:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①①\">Remove</a> <var>collected data</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data⑤\">collected network data</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①④\">Resume</a> with \"<code>network data collected</code>\" and (<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id⑦\">request id</a>, <var>data type</var>).</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>top-level navigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①①\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Let <var>collectors</var> be an empty list.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions⑥\">active BiDi sessions</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <var>collector</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors③\">network collectors</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-data-types\" id=\"ref-for-network-collector-data-types\">data types</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①③\">contains</a> <var>data type</var> and if\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#match-collector-for-navigable\" id=\"ref-for-match-collector-for-navigable\">match collector for navigable</a> with <var>collector</var> and <var>top-level navigable</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑧\">Append</a> <var>collector</var> to <var>collectors</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>collectors</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①②\">empty</a>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①②\">Remove</a> <var>collected data</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data⑥\">collected network data</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⑤\">Resume</a> with \"<code>network data collected</code>\" and (<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id⑧\">request id</a>, <var>data type</var>).</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>bytes</var> be null.</p>"
        },
        {
          "html": "Let <var>processBody</var> given <var>nullOrBytes</var> be this step:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>nullOrBytes</var> is not null:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>bytes</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-protocol-bytes\" id=\"ref-for-serialize-protocol-bytes\">serialize protocol bytes</a> with <var>nullOrBytes</var>.</p>"
                },
                {
                  "html": "<p>If <var>size</var> is null, set <var>size</var> to <var>bytes</var>’ <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length\">length</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>processBodyError</var> be this step: Do nothing.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-fully-read\" id=\"ref-for-body-fully-read\">Fully read</a> <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-cloned-body\" id=\"ref-for-network-data-cloned-body②\">cloned body</a> given <var>processBody</var> and <var>processBodyError</var>.</p>"
        },
        {
          "html": "If <var>bytes</var> is not null:",
          "rationale": "for",
          "steps": [
            {
              "html": "For <var>collector</var> in <var>collectors</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>size</var> is less than or equal to <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-max-encoded-item-size\" id=\"ref-for-network-collector-max-encoded-item-size①\">max encoded item size</a>,\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②⑨\">append</a> <var>collector</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-collector\" id=\"ref-for-network-collector-collector①\">collector</a> to <var>collected data</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors②\">collectors</a>.</p>"
                }
              ]
            },
            {
              "html": "If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors③\">collectors</a> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①③\">empty</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#allocate-size-to-record-data\" id=\"ref-for-allocate-size-to-record-data\">Allocate size to record data</a> given <var>size</var>.</p>"
                },
                {
                  "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes②\">bytes</a> to <var>bytes</var>.</p>"
                },
                {
                  "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size②\">size</a> to <var>size</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①③\">remove</a> <var>collected data</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data⑦\">collected network data</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⑥\">Resume</a> with \"<code>network data collected</code>\" and (<var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id⑨\">request id</a>, <var>data type</var>).</p>"
        }
      ]
    },
    {
      "name": "allocate size to record data",
      "href": "https://w3c.github.io/webdriver-bidi/#allocate-size-to-record-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"allocate-size-to-record-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">allocate size to record data</dfn> given <var>size</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>available size</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#max-total-collected-size\" id=\"ref-for-max-total-collected-size①\">max total collected size</a>.</p>"
        },
        {
          "html": "<p>Let <var>already collected data</var> be an empty list.</p>"
        },
        {
          "html": "For each <var>collected data</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data⑧\">collected network data</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes③\">bytes</a> is not null:",
              "rationale": "decrease",
              "steps": [
                {
                  "html": "<p>Decrease <var>available size</var> by <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size③\">size</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⓪\">Append</a> <var>collected data</var> to <var>already collected data</var></p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>size</var> is greater than <var>available size</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <var>collected data</var> in <var>already collected data</var>:",
              "rationale": "increase",
              "steps": [
                {
                  "html": "<p>Increase <var>available size</var> by <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size④\">size</a>.</p>"
                },
                {
                  "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes④\">bytes</a> field to null.</p>"
                },
                {
                  "html": "<p>Set <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-size\" id=\"ref-for-network-data-size⑤\">size</a> field to null.</p>"
                },
                {
                  "html": "<p>If <var>available size</var> is greater than or equal to <var>size</var>, return.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "remove collector from data",
      "href": "https://w3c.github.io/webdriver-bidi/#remove-collector-from-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"remove-collector-from-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove collector from data</dfn> given <var>collected data</var> and <var>collector id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors④\">collectors</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①④\">contains</a> <var>collector id</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①④\">Remove</a> <var>collector id</var> from <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors⑤\">collectors</a>.</p>"
            },
            {
              "html": "If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors⑥\">collectors</a> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①④\">empty</a>:",
              "rationale": "remove",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑤\">Remove</a> <var>collected data</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data⑨\">collected network data</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "get the network intercepts",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-network-intercepts",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-network-intercepts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the network intercepts</dfn> given <var>session</var>, <var>event</var>, <var>request</var>, and <var>navigable id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>session intercepts</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#intercept-map\" id=\"ref-for-intercept-map\">intercept map</a>.</p>"
        },
        {
          "html": "<p>Let <var>intercepts</var> be an empty list.</p>"
        },
        {
          "html": "<p>Run the steps under the first matching condition:</p>\n      <dl>\n       <dt><var>event</var> is \"<code>network.beforeRequestSent</code>\"\n  \n       </dt><dd>Set <var>phase</var> to \"<code>beforeRequestSent</code>\".\n  \n       </dd><dt><var>event</var> is \"<code>network.responseStarted</code>\"\n  \n       </dt><dd>Set <var>phase</var> to \"<code>responseStarted</code>\".\n  \n       </dd><dt><var>event</var> is \"<code>network.authRequired</code>\"\n  \n       </dt><dd>Set <var>phase</var> to \"<code>authRequired</code>\".\n  \n       </dd><dt><var>event</var> is \"<code>network.responseCompleted</code>\"\n  \n       </dt><dd>Return <var>intercepts</var>.\n\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑤\">URL serializer</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url\">URL</a>.</p>"
        },
        {
          "html": "For each <var>intercept id</var> → <var>intercept</var> of <var>session intercepts</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>intercept</var>’s <code>contexts</code> is not null:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>intercept</var>’s <code>contexts</code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑤\">contain</a> <var>navigable id</var>:",
                  "rationale": "continue",
                  "steps": [
                    {
                      "html": "<p>Continue.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>intercept</var>’s <code>phases</code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑥\">contains</a> <var>phase</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>url patterns</var> be <var>intercept</var>’s <code>url patterns</code>.</p>"
                },
                {
                  "html": "If <var>url patterns</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⑤\">empty</a>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③①\">Append</a> <var>intercept id</var> to <var>intercepts</var>.</p>"
                    },
                    {
                      "html": "<p>Continue.</p>"
                    }
                  ]
                },
                {
                  "html": "For each <var>url pattern</var> in <var>url patterns</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#match-url-pattern\" id=\"ref-for-match-url-pattern\">match URL pattern</a> with <var>url pattern</var> and <var>url</var>:",
                      "rationale": "append",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③②\">Append</a> <var>intercept id</var> to <var>intercepts</var>.</p>"
                        },
                        {
                          "html": "<p>Break.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>intercepts</var>.</p>"
        }
      ]
    },
    {
      "name": "update the response",
      "href": "https://w3c.github.io/webdriver-bidi/#update-the-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-the-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update the response</dfn> given <var>session</var>, <var>command</var> and <var>command parameters</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map①\">blocked request map</a>.</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>If <var>blocked requests</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦④\">contain</a> <var>request id</var> then return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-request\" id=\"ref-for-errors-no-such-request\">no such request</a>.</p>"
        },
        {
          "html": "<p>Let (<var>request</var>, <var>phase</var>, <var>response</var>) be <var>blocked requests</var>[<var>request id</var>].</p>"
        },
        {
          "html": "<p>If <var>phase</var> is \"<code>beforeRequestSent</code>\" and <var>command</var> is\n \"<code>continueResponse</code>\", return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦①\">error code</a>\n \"<code>invalid argument</code>\".</p>\n      <p>TODO: Consider a different error</p>"
        },
        {
          "html": "If <var>response</var> is null:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <var>phase</var> is \"<code>beforeRequestSent</code>\".</p>"
            },
            {
              "html": "<p>Set <var>response</var> to a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response\">response</a>.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑤\">contains</a> \"<code>statusCode</code>\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>responses</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①\">status</a> be <var>command\n parameters</var>[\"<code>statusCode</code>\"].</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑥\">contains</a> \"<code>reasonPhrase</code>\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>responses</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message\">status message</a> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">UTF-8 encode</a> with\n <var>command parameters</var>[\"<code>reasonPhrase</code>\"].</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑦\">contains</a> \"<code>headers</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>headers</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#create-a-headers-list\" id=\"ref-for-create-a-headers-list\">create a headers list</a> with\n <var>command parameters</var>[\"<code>headers</code>\"].</p>"
            },
            {
              "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list\">header list</a> to <var>headers</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦⑧\">contains</a> \"<code>cookies</code>\":",
          "rationale": "if",
          "steps": [
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>headers</var> be an empty <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list④\">header list</a>.</p>"
                },
                {
                  "html": "For each <var>header</var> in <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②\">headers list</a>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>name</var> be <var>header</var>’s name.</p>"
                    },
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-lowercase\" id=\"ref-for-byte-lowercase\">byte-lowercase</a> <var>name</var> is not `<code>set-cookie</code>`:",
                      "rationale": "append",
                      "steps": [
                        {
                          "html": "<p>Append <var>header</var> to <var>headers</var></p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "For <var>cookie</var> in <var>command parameters</var>[\"<code>cookies</code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>header value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-set-cookie-header\" id=\"ref-for-serialize-set-cookie-header\">serialize set-cookie header</a> with <var>cookie</var>.</p>"
                },
                {
                  "html": "<p>Append (`<code>Set-Cookie</code>`, <var>header value</var>) to <var>headers</var>.</p>"
                },
                {
                  "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③\">header list</a> to <var>headers</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⓪\">contains</a> \"<code>credentials</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>credentials</var> be <var>command parameters</var>[\"<code>credentials</code>\"].</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>credentials</var>[\"<code>type</code>\"] is \"<code>password</code>\".</p>"
            },
            {
              "html": "<p>Set <var>response</var>’s authentication credentials  to\n  (<var>credentials</var>[\"<code>username</code>\"], <var>credentials</var>[\"<code>password</code>\"])</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>response</var></p>"
        }
      ]
    },
    {
      "name": "extract challenges",
      "href": "https://w3c.github.io/webdriver-bidi/#extract-challenges",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"extract-challenges\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract challenges</dfn> given <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②\">status</a> is 401, let <var>header name</var> be\n `<code>WWW-Authenticate</code>`. Otherwise if <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status③\">status</a> is 407, let\n <var>header name</var> be `<code>Proxy-Authenticate</code>`. Otherwise return null.</p>"
        },
        {
          "html": "<p>Let <var>challenges</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②⑨\">list</a>.</p>"
        },
        {
          "html": "For each (<var>name</var>, <var>value</var>) in <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list④\">header list</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive\">byte-case-insensitive</a> match for <var>header name</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>header challenges</var> be the result of parsing <var>value</var> into a list of\n challenges, each consisting of a scheme and a list of parameters, each of\n which is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple\">tuple</a> (name, value), according to the rules of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9110\" title=\"HTTP Semantics\">[RFC9110]</a>.</p>"
                },
                {
                  "html": "For each <var>header challenge</var> in <var>header challenges</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>scheme</var> be <var>header challenge</var>’s scheme.</p>"
                    },
                    {
                      "html": "<p>Let <var>realm</var> be the empty string.</p>"
                    },
                    {
                      "html": "For each (<var>param name</var>, <var>param value</var>) in <var>header challenge</var>’s\n parameters:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>param name</var> equals `<code>realm</code>` let <var>realm</var> be\n <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode\">UTF-8 decode</a> <var>param value</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>challenge</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑧\">map</a> matching the\n <code>network.AuthChallenge</code> production, with the\n <code>scheme</code> field set to <var>scheme</var> and the <code>realm</code>\n field set to <var>realm</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③③\">Append</a> <var>challenge</var> to <var>challenges</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>challenges</var>.</p>"
        }
      ]
    },
    {
      "name": "process a network event",
      "href": "https://w3c.github.io/webdriver-bidi/#process-a-network-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-a-network-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process a network event</dfn> given <var>session</var>, <var>event</var>, and <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request data</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-request-data\" id=\"ref-for-get-the-request-data\">get the request data</a> with <var>request</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigation</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigation-id\" id=\"ref-for-navigation-id②\">navigation id</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable id</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>top-level navigable id</var> be null.</p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②\">client</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑧\">environment settings object</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>environment settings</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client③\">client</a>.</p>"
            },
            {
              "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③⑦\">navigable</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window②\">active window</a> is <var>environment\n settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global①\">global object</a>, set <var>navigable id</var>\n to that navigable’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①⑦\">navigable id</a>, and set <var>top-level navigable id</var> to\n that navigable’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①②\">top-level traversable</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id①⑧\">navigable id</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>intercepts</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-network-intercepts\" id=\"ref-for-get-the-network-intercepts\">get the network intercepts</a> with\n <var>session</var>, <var>event</var>, <var>request</var>, and <var>top-level navigable id</var>.</p>"
        },
        {
          "html": "<p>Let <var>redirect count</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count\">redirect count</a>.</p>"
        },
        {
          "html": "<p>Let <var>timestamp</var> be a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-time-values-and-time-range\" id=\"ref-for-sec-time-values-and-time-range②\">time value</a> representing the current date and time in UTC.</p>"
        },
        {
          "html": "<p>If <var>intercepts</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⑥\">empty</a>, let <var>is blocked</var> be true, otherwise\n let <var>is blocked</var> be false.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤⑨\">map</a> matching the <code>network.BaseParameters</code>\n production, with the <code>request</code> field set to <var>request data</var>, the\n <var>navigation</var> field set to <code>navigation</code>, the <code>context</code>\n field set to <var>navigable id</var>, the <code>timestamp</code> field set to\n <var>timestamp</var>, the <code>redirectCount</code> field set to <var>redirect count</var>, the\n <code>isBlocked</code> field set to <var>is blocked</var>, and <code>intercepts</code>\n field set to <var>intercepts</var> if <var>is blocked</var> is true, or omitted otherwise.</p>"
        },
        {
          "html": "<p>Return <var>params</var></p>"
        }
      ]
    },
    {
      "name": "deserialize protocol bytes",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-protocol-bytes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize protocol bytes</dfn> given <var>protocol bytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>protocol bytes</var> matches the <code>network.StringValue</code> production,\n let <var>bytes</var> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode①\">UTF-8 encode</a> <var>protocol bytes</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p>Otherwise if <var>protocol bytes</var> matches the <code>network.Base64Value</code>\n production. Let <var>bytes</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode\">forgiving-base64 decode</a> <var>protocol\n bytes</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p>Return <var>bytes</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize protocol bytes",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-protocol-bytes",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-protocol-bytes\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize protocol bytes</dfn> given <var>bytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>text</var> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode-without-bom-or-fail\" id=\"ref-for-utf-8-decode-without-bom-or-fail\">UTF-8 decode without BOM or fail</a> <var>bytes</var>.</p>"
        },
        {
          "html": "<p>If <var>text</var> is failure, return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⓪\">map</a> matching the\n <code>network.Base64Value</code> production, with <var>value</var> set to\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-encode\" id=\"ref-for-forgiving-base64-encode①\">forgiving-base64 encode</a> <var>bytes</var>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥①\">map</a> matching the <code>network.StringValue</code> production,\n with <var>value</var> set to <var>text</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize cookie",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-cookie",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-cookie\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize cookie</dfn> given <var>stored cookie</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>name</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode①\">UTF-8 decode</a> with <var>stored cookie</var>’s name field.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-protocol-bytes\" id=\"ref-for-serialize-protocol-bytes①\">serialize protocol bytes</a> with <var>stored cookie</var>’s value.</p>"
        },
        {
          "html": "<p>Let <var>domain</var> be <var>stored cookie</var>’s domain field.</p>"
        },
        {
          "html": "<p>Let <var>path</var> be <var>stored cookie</var>’s path field.</p>"
        },
        {
          "html": "<p>Let <var>expiry</var> be <var>stored cookie</var>’s expiry-time field represented as a unix\n timestamp, if set, or null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>size</var> be the byte length of the result of serializing <var>stored cookie</var>\n as it would be represented in a <code>Cookie</code> header.</p>"
        },
        {
          "html": "<p>Let <var>http only</var> be true if <var>stored cookie</var>’s http-only-flag is true, or false\n otherwise.</p>"
        },
        {
          "html": "<p>Let <var>secure</var> be true if <var>stored cookie</var>’s secure-only-flag is true, or false\n otherwise.</p>"
        },
        {
          "html": "<p>Let <var>same site</var> be \"<code>none</code>\" if <var>stored cookie</var>’s same-site-flag is\n \"<code>None</code>\", \"<code>lax</code>\" if it is \"<code>Lax</code>\",\n \"<code>strict</code>\" if it is \"<code>Strict</code>\", or\n \"<code>default</code>\" if it is \"<code>Default</code>\"</p>"
        },
        {
          "html": "<p>Return a map matching the <code>network.Cookie</code> production,\n with the <code>name</code> field set to <var>name</var>, the <code>value</code> field\n set to <var>value</var>, the <code>domain</code> field set to <var>domain</var>, the\n <code>path</code> field set to <var>path</var>, the <code>expiry</code> field set to\n <var>expiry</var> if it’s not null, or omitted otherwise, the <code>size</code> field\n set to <var>size</var>, the <code>httpOnly</code> field set to <var>http only</var>, the\n <code>secure</code> field set to <var>secure</var>, and the <code>sameSite</code>\n field set to <var>same site</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize cookie header",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-cookie-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-cookie-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize cookie header</dfn> given <var>protocol cookie</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>name</var> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode②\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>name</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes\">deserialize protocol bytes</a> with <var>protocol\n cookie</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>header value</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②\">byte sequence</a> formed by concatenating <var>name</var>,\n `<code>=</code>`, and <var>value</var></p>"
        },
        {
          "html": "<p>Return <var>header value</var>.</p>"
        }
      ]
    },
    {
      "name": "get the fetch timings",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-fetch-timings",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-fetch-timings\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the fetch timings</dfn> given <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑤\">client</a>.</p>"
        },
        {
          "html": "<p>If <var>global</var> is null, return a map matching the\n <code>network.FetchTimingInfo</code> production, with all fields set to 0.</p>"
        },
        {
          "html": "<p>Let <var>time origin</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-get-time-origin-timestamp\" id=\"ref-for-dfn-get-time-origin-timestamp\">get time origin timestamp</a> with <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>timings</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info\" id=\"ref-for-fetch-timing-info\">fetch timing info</a>.</p>"
        },
        {
          "html": "<p>Let <var>connection timing</var> be <var>timings</var>’ <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-connection-timing-info\" id=\"ref-for-fetch-timing-info-final-connection-timing-info\">final connection timing info</a> if\n it’s not null, or a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info\">connection timing info</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>request time</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp\">convert fetch timestamp</a> given <var>timings</var>’ <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-start-time\" id=\"ref-for-fetch-timing-info-start-time\">start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>redirect start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp①\">convert fetch timestamp</a> given <var>timings</var>’\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-redirect-start-time\" id=\"ref-for-fetch-timing-info-redirect-start-time\">redirect start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>redirect end</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp②\">convert fetch timestamp</a> given <var>timings</var>’ <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-redirect-end-time\" id=\"ref-for-fetch-timing-info-redirect-end-time\">redirect end time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>fetch start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp③\">convert fetch timestamp</a> given <var>timings</var>’\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-post-redirect-start-time\" id=\"ref-for-fetch-timing-info-post-redirect-start-time\">post-redirect start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>DNS start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp④\">convert fetch timestamp</a> given <var>connection timing</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-start-time\" id=\"ref-for-connection-timing-info-domain-lookup-start-time\">domain lookup start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>DNS end</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp⑤\">convert fetch timestamp</a> given <var>connection timing</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-end-time\" id=\"ref-for-connection-timing-info-domain-lookup-end-time\">domain lookup end time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>TLS start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp⑥\">convert fetch timestamp</a> given <var>connection timing</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-secure-connection-start-time\" id=\"ref-for-connection-timing-info-secure-connection-start-time\">secure connection start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>connect start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp⑦\">convert fetch timestamp</a> given <var>connection\n timing</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time\">connection start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>connect end</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp⑧\">convert fetch timestamp</a> given <var>connection timing</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-end-time\" id=\"ref-for-connection-timing-info-connection-end-time\">connection end time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>request start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp⑨\">convert fetch timestamp</a> given <var>timings</var>’ <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-network-request-start-time\" id=\"ref-for-fetch-timing-info-final-network-request-start-time\">final network-request start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>response start</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp①⓪\">convert fetch timestamp</a> given <var>timings</var>’ <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-network-response-start-time\" id=\"ref-for-fetch-timing-info-final-network-response-start-time\">final network-response start time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Let <var>response end</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-convert-fetch-timestamp\" id=\"ref-for-dfn-convert-fetch-timestamp①①\">convert fetch timestamp</a> given <var>timings</var>’\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-end-time\" id=\"ref-for-fetch-timing-info-end-time\">end time</a> and <var>global</var>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥②\">map</a> matching the <code>network.FetchTimingInfo</code> production\n  with the <code>timeOrigin</code> field set to <var>time origin</var>, the\n  <code>requestTime</code> field set to <var>request time</var>, the\n  <code>redirectStart</code> field set to <var>redirect start</var>, the\n  <code>redirectEnd</code> field set to <var>redirect end</var>, the\n  <code>fetchStart</code> field set to <var>fetch start</var>, the\n  <code>dnsStart</code> field set to <var>DNS start</var>, the <code>dnsEnd</code>\n  field set to <var>DNS end</var>, the <code>connectStart</code> field set to <var>connect\n  start</var>, the <code>connectEnd</code> field set to <var>connect end</var>, the\n  <code>tlsStart</code> field set to <var>TLS start</var>, the\n  <code>requestStart</code> field set to <var>request start</var>, the\n  <code>responseStart</code> field set to <var>response start</var>, and the\n  <code>responseEnd</code> field set to <var>response end</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize header",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize header</dfn> given <var>name bytes</var> and <var>value bytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>name</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode②\">UTF-8 decode</a> with <var>name bytes</var>.</p>\n      <p class=\"assertion\">Assert: Since header names are constrained to be ASCII-only this cannot fail.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-protocol-bytes\" id=\"ref-for-serialize-protocol-bytes②\">serialize protocol bytes</a> with <var>value bytes</var>.</p>"
        },
        {
          "html": "<p>Return a map matching the <code>network.Header</code> production, with the\n <code>name</code> field set to <var>name</var>, and the <code>value</code> field\n set to <var>value</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize header",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize header</dfn> given <var>protocol header</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>name</var> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode③\">UTF-8 encode</a> <var>protocol header</var>[\"<code>name</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes①\">deserialize protocol bytes</a> with <var>protocol\n header</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header\">header</a> (<var>name</var>, <var>value</var>).</p>"
        }
      ]
    },
    {
      "name": "create a headers list",
      "href": "https://w3c.github.io/webdriver-bidi/#create-a-headers-list",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-headers-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a headers list</dfn> given <var>protocol headers</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>headers</var> be an empty <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑤\">header list</a>.</p>"
        },
        {
          "html": "For <var>header</var> in <var>protocol headers</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deserialized header</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-header\" id=\"ref-for-deserialize-header\">deserialize header</a> with <var>header</var>.</p>"
            },
            {
              "html": "<p>If <var>deserialized header</var>’s name does not match the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9110.html#fields.names\" id=\"ref-for-fields.names\">field-name token</a>\n production, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦②\">error code</a>\n\"<code>invalid argument</code>\".</p>"
            },
            {
              "html": "<p>If <var>deserialized header</var>’s value does not match the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value\">header value</a>\n production, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦③\">error code</a>\n\"<code>invalid argument</code>\".</p>"
            },
            {
              "html": "<p>Append <var>deserialized header</var> to <var>headers</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤③\">success</a> with data <var>headers</var></p>"
        }
      ]
    },
    {
      "name": "get the initiator",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-initiator",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-initiator\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the initiator</dfn> given <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type\">initiator type</a> is \"<code>fetch</code>\" or\n \"<code>xmlhttprequest</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>stack trace</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#current-stack-trace\" id=\"ref-for-current-stack-trace\">current stack trace</a>.</p>"
            },
            {
              "html": "<p>If <var>stack trace</var> has size of 1 or greater, let <var>line number</var> be value of the\n <code>lineNumber</code> field in <var>stack trace</var>[0], and let <var>column number</var> be\n the value of the <code>columnNumber</code> field in <var>stack trace</var>[0]. Otherwise\n let <var>line number</var> and <var>column number</var> be 0.</p>"
            }
          ]
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥③\">map</a> matching the <code>network.Initiator</code> production, the\n <code>columnNumber</code> field set to <var>column number</var> if it’s not null, or\n omitted otherwise, the <code>lineNumber</code> field set to <var>line number</var> if\n it’s not null, or omitted otherwise and the <code>stackTrace</code> field set\n to <var>stack trace</var> if it’s not null, or omitted otherwise.</p>"
        }
      ]
    },
    {
      "name": "get the request data",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-request-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-request-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the request data</dfn> given <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request id</var> be request’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①①\">request id</a>.</p>"
        },
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑥\">URL serializer</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①\">URL</a>.</p>"
        },
        {
          "html": "<p>Let <var>method</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method\">method</a>.</p>"
        },
        {
          "html": "<p>Let <var>body size</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be request’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②\">body</a>.</p>"
        },
        {
          "html": "<p>If <var>body</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence③\">byte sequence</a>, set <var>body size</var> to the length of that\n sequence. Otherwise, if <var>body</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body①\">body</a> then set <var>body size</var> to that\n body’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-total-bytes\" id=\"ref-for-concept-body-total-bytes\">length</a>.</p>"
        },
        {
          "html": "<p>Let <var>headers size</var> be the size in bytes of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list\">headers list</a> when\n serialized as mandated by <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-http11\" title=\"HTTP/1.1\">[HTTP11]</a>.</p>"
        },
        {
          "html": "<p>Let <var>headers</var> be an empty list.</p>"
        },
        {
          "html": "<p>Let <var>cookies</var> be an empty list.</p>"
        },
        {
          "html": "For each (<var>name</var>, <var>value</var>) in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①\">headers list</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-header\" id=\"ref-for-serialize-header\">serialize header</a> with <var>name</var> and <var>value</var> to <var>headers</var>.</p>"
            },
            {
              "html": "If <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①\">byte-case-insensitive</a> match for \"<code>Cookie</code>\" then:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each <var>cookie</var> in the user agent’s <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc6265.html#storage-model\" id=\"ref-for-storage-model\">cookie store</a> that are included in\n <var>request</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-cookie\" id=\"ref-for-serialize-cookie\">serialize cookie</a> given <var>cookie</var> to <var>cookies</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>destination</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination\">destination</a>.</p>"
        },
        {
          "html": "<p>Let <var>initiator type</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type①\">initiator type</a>.</p>"
        },
        {
          "html": "<p>Let <var>timings</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-fetch-timings\" id=\"ref-for-get-the-fetch-timings\">get the fetch timings</a> with <var>request</var>.</p>"
        },
        {
          "html": "<p>Return a map matching the <code>network.RequestData</code> production, with\n the <code>request</code> field set to <var>request id</var>, <code>url</code> field\n set to <var>url</var>, the <code>method</code> field set to <var>method</var>, the\n <code>headers</code> field set to <var>headers</var>, the <var>cookies</var> field set to\n <var>cookies</var>, the <code>headersSize</code> field set to <var>headers size</var>, the\n <code>bodySize</code> field set to <var>body size</var>, the <code>destination</code>\n field set to <var>destination</var>, the <code>initiatorType</code> field set to\n <var>initiator type</var>, and the <code>timings</code> field set to <var>timings</var>.</p>"
        }
      ]
    },
    {
      "name": "get the response content info",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-response-content-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-response-content-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the response content info</dfn> given <var>response</var>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Return a new map matching the <code>network.ResponseContent</code>\n production, with the <code>size</code> field set to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-body-info\" id=\"ref-for-response-body-info①\">response body info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-decoded-body-size\" id=\"ref-for-fetch-timing-info-decoded-body-size\">decoded size</a></p>"
        }
      ]
    },
    {
      "name": "get the protocol",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-protocol",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-protocol\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the protocol</dfn> given <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>protocol</var> be the empty string.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-connection-timing-info\" id=\"ref-for-fetch-timing-info-final-connection-timing-info①\">final connection timing info</a> is not null, set <var>protocol</var>\n to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-connection-timing-info\" id=\"ref-for-fetch-timing-info-final-connection-timing-info②\">final connection timing info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol\">ALPN negotiated protocol</a>.</p>"
        },
        {
          "html": "If <var>protocol</var> is the empty string, or is equal to \"<code>unknown</code>\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>protocol</var> to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url\">url</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme\">scheme</a></p>"
            },
            {
              "html": "If <var>protocol</var> is equal to either \"<code>http</code>\" or\n \"<code>https</code>\" and <var>response</var> has an associated HTTP Response.",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>http version</var> be the HTTP Response’s Status line’s HTTP-version <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-http11\" title=\"HTTP/1.1\">[HTTP11]</a>.</p>"
                },
                {
                  "html": "If <var>http version</var> starts with \"<code>HTTP/</code>\":",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>version</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-unit-substring\" id=\"ref-for-code-unit-substring\">code unit substring</a> of <var>http version</var> from 5\n to <var>http version</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length\">length</a>.</p>"
                    },
                    {
                      "html": "<p>If <var>version</var> is \"<code>0.9</code>\", set <var>protocol</var> to\n \"<code>http/0.9</code>\", otherwise if <var>version</var> is \"<code>1.0</code>\",\n set <var>protocol</var> to \"<code>http/1.0</code>\", otherwise if <var>version</var> is\n \"<code>1.1</code>\", set <var>protocol</var> to \"<code>http/1.1</code>\".</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>protocol</var>.</p>"
        }
      ]
    },
    {
      "name": "get the response data",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-response-data",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-response-data\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the response data</dfn> given <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑦\">URL serializer</a> with <var>response</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url①\">URL</a>.</p>"
        },
        {
          "html": "<p>Set <var>protocol</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-protocol\" id=\"ref-for-get-the-protocol\">get the protocol</a> given <var>response</var>.</p>"
        },
        {
          "html": "<p>Let <var>status</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status④\">status</a>.</p>"
        },
        {
          "html": "<p>Let <var>status text</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message①\">status message</a>.</p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cache-state\" id=\"ref-for-concept-response-cache-state\">cache state</a> is \"<code>local</code>\", let <var>from cache</var> be\n true, otherwise let it be false.</p>"
        },
        {
          "html": "<p>Let <var>headers</var> be an empty list.</p>"
        },
        {
          "html": "<p>Let <var>mime type</var> be the <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence\">essence</a> of the <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#computed-mime-type\" id=\"ref-for-computed-mime-type\">computed mime type</a> for <var>response</var>.</p>"
        },
        {
          "html": "For each (<var>name</var>, <var>value</var>) in <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑤\">headers list</a>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-header\" id=\"ref-for-serialize-header①\">serialize header</a> with <var>name</var> and <var>value</var> to <var>headers</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>bytes received</var> be the total number of bytes transmitted as part of the\n HTTP response associated with <var>response</var>.</p>"
        },
        {
          "html": "<p>Let <var>headers size</var> be the number of bytes transmitted as part of the header\n fields section of the HTTP response.</p>"
        },
        {
          "html": "<p>Let <var>body size</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-body-info\" id=\"ref-for-response-body-info②\">response body info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-encoded-body-size\" id=\"ref-for-fetch-timing-info-encoded-body-size①\">encoded size</a>.</p>"
        },
        {
          "html": "<p>Let <var>content</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-response-content-info\" id=\"ref-for-get-the-response-content-info\">get the response content info</a> with <var>response</var>.</p>"
        },
        {
          "html": "<p>Let <var>auth challenges</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extract-challenges\" id=\"ref-for-extract-challenges\">extract challenges</a> with <var>response</var>.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥④\">map</a> matching the <code>network.ResponseData</code> production,\n with the <code>url</code> field set to <var>url</var>, the <code>protocol</code> field\n set to <var>protocol</var>, the <code>status</code> field set to <var>status</var>, the\n <code>statusText</code> field set to <var>status text</var>, the\n <code>fromCache</code> field set to <var>from cache</var>, the <code>headers</code>\n field set to <var>headers</var>, the <code>mimeType</code> field set to <var>mime type</var>, the\n <code>bytesReceived</code> field set to <var>bytes received</var>, the\n <code>headersSize</code> field set to <var>headers size</var>, the\n <code>bodySize</code> field set to <var>body size</var>, <code>content</code>\n field set to <var>content</var>, and the <code>authChallenges</code> field set to\n <var>auth challenges</var> if it’s not null, or omitted otherwise.</p>"
        }
      ]
    },
    {
      "name": "serialize an integer",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-an-integer",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-an-integer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an integer</dfn> given <var>input</var> that is an integer:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>serialized</var> be an empty string.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <var>input</var>.</p>"
        },
        {
          "html": "While <var>value</var> is greater than 0:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>x</var> be <var>value</var> divided by 10.</p>"
            },
            {
              "html": "<p>Let <var>most significant digits</var> be the integer part of <var>x</var>.</p>"
            },
            {
              "html": "<p>Let <var>y</var> be <var>most significant digits</var> multiplied by 10.</p>"
            },
            {
              "html": "<p>Let <var>least significant digit</var> be <var>value</var> - <var>y</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>least significant digit</var> is an integer in the range 0 to 9,\n inclusive.</p>"
            },
            {
              "html": "<p>Let <var>codepoint</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point\">code point</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point-value\" id=\"ref-for-code-point-value\">value</a> is U+0030\n DIGIT ZERO’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point-value\" id=\"ref-for-code-point-value①\">value</a> + <var>least significant digit</var>.</p>"
            },
            {
              "html": "<p>Prepend <var>codepoint</var> to <var>serialized</var>.</p>"
            },
            {
              "html": "<p>Set <var>value</var> to <var>most significant digits</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>serialized</var>.</p>"
        }
      ]
    },
    {
      "name": "serialize set-cookie header",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-set-cookie-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-set-cookie-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize set-cookie header</dfn> given <var>protocol cookie</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>name</var> be <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode④\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>name</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes②\">deserialize protocol bytes</a> with <var>protocol\n cookie</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>header value</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence④\">byte sequence</a> formed by concatenating <var>name</var>,\n `<code>=</code>`, and <var>value</var>.</p>"
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧①\">contains</a> \"<code>expiry</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attribute</var> be `<code>;Expires=</code>`</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode⑤\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>expiry</code>\"] to\n <var>attribute</var>.</p>"
            },
            {
              "html": "<p>Append <var>attribute</var> to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧②\">contains</a> \"<code>maxAge</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attribute</var> be `<code>;Max-Age=</code>`</p>"
            },
            {
              "html": "<p>Let <var>max age string</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-integer\" id=\"ref-for-serialize-an-integer\">serialize an integer</a> <var>protocol\ncookie</var>[\"<code>maxAge</code>\"].</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode⑥\">UTF-8 encode</a> <var>max age string</var> to <var>attribute</var>.</p>"
            },
            {
              "html": "<p>Append <var>attribute</var> to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧③\">contains</a> \"<code>domain</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attribute</var> be `<code>;Domain=</code>`</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode⑦\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>domain</code>\"] to\n <var>attribute</var>.</p>"
            },
            {
              "html": "<p>Append <var>attribute</var> to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧④\">contains</a> \"<code>path</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attribute</var> be `<code>;Path=</code>`</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode⑧\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>path</code>\"] to\n <var>attribute</var>.</p>"
            },
            {
              "html": "<p>Append <var>attribute</var> to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑤\">contains</a> \"<code>secure</code>\" and <var>protocol\n cookie</var>[\"<code>secure</code>\"] is true:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append `<code>;Secure</code>` to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑥\">contains</a> \"<code>httpOnly</code>\" and <var>protocol\n cookie</var>[\"<code>httpOnly</code>\"] is true:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append `<code>;HttpOnly</code>` to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>protocol cookie</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑦\">contains</a> \"<code>sameSite</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>attribute</var> be `<code>;SameSite=</code>`</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode⑨\">UTF-8 encode</a> <var>protocol cookie</var>[\"<code>sameSite</code>\"] to\n <var>attribute</var>.</p>"
            },
            {
              "html": "<p>Append <var>attribute</var> to <var>header value</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>header value</var>.</p>"
        }
      ]
    },
    {
      "name": "unescape URL pattern",
      "href": "https://w3c.github.io/webdriver-bidi/#unescape-url-pattern",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"unescape-url-pattern\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">unescape URL pattern</dfn> given <var>pattern</var>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>forbidden characters</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤④\">set</a> of codepoints «U+0028 ((), U+0029\n ()), U+002A (*), U+007B ({), U+007D (})»</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the empty string.</p>"
        },
        {
          "html": "<p>Let <var>is escaped character</var> be false.</p>"
        },
        {
          "html": "For each <var>codepoint</var> in <var>pattern</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>is escaped character</var> is false:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>forbidden characters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑦\">contains</a> <var>codepoint</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑦⑨\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⑦\">invalid argument</a>.</p>"
                },
                {
                  "html": "If <var>codepoint</var> is U+005C (\\):",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>is escaped character</var> to true.</p>"
                    },
                    {
                      "html": "<p>Continue.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Append <var>codepoint</var> to result.</p>"
            },
            {
              "html": "<p>Set <var>is escaped character</var> to false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤④\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "parse URL pattern",
      "href": "https://w3c.github.io/webdriver-bidi/#parse-url-pattern",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"parse-url-pattern\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse URL pattern</dfn>, given <var>pattern</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>has protocol</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>has hostname</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>has port</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>has pathname</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>has search</var> be true.</p>"
        },
        {
          "html": "If <var>pattern</var> matches the <code>network.UrlPatternPattern</code> production:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>pattern url</var> be the empty string.</p>"
            },
            {
              "html": "If <var>pattern</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑧\">contains</a> \"<code>protocol</code>\":",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>pattern</var>[\"<code>protocol</code>\"] is the empty string, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⓪\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⑧\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Let <var>protocol</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern\">unescape URL Pattern</a> with <var>pattern</var>[\"<code>protocol</code>\"].</p>"
                },
                {
                  "html": "For each <var>codepoint</var> in <var>protocol</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>codepoint</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-alphanumeric\" id=\"ref-for-ascii-alphanumeric\">ASCII alphanumeric</a> and «U+002B (+), U+002D\n (-), U+002E (.)» does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑧\">contain</a> <var>codepoint</var>:",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⑥\">error code</a> invalid argument.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Append <var>protocol</var> to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>has protocol</var> to false.</p>"
                },
                {
                  "html": "<p>Append \"<code>http</code>\" to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>scheme</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-lowercase\" id=\"ref-for-ascii-lowercase\">ASCII lowercase</a> with <var>pattern url</var>.</p>"
            },
            {
              "html": "<p>Append \"<code>:</code>\" to <var>pattern url</var>.</p>"
            },
            {
              "html": "<p>If <var>scheme</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#is-special\" id=\"ref-for-is-special\">is special</a>, append \"<code>//</code>\" to <var>pattern url</var>.</p>"
            },
            {
              "html": "If <var>pattern</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧⑨\">contains</a> \"<code>hostname</code>\":",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>pattern</var>[\"<code>hostname</code>\"] is the empty string, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧②\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③⑨\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>If <var>scheme</var> is \"<code>file</code>\" return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⑧\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⓪\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Let <var>hostname</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern①\">unescape URL Pattern</a> with <var>pattern</var>[\"<code>hostname</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>inside brackets</var> be false.</p>"
                },
                {
                  "html": "For each <var>codepoint</var> in <var>hostname</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If «U+002F (/), U+003F (?), U+0023 (#)» <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①⑨\">contains</a>\n <var>codepoint</var>:",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④①\">invalid argument</a>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "If <var>inside brackets</var> is false and <var>codepoint</var> is U+003A (:):",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④②\">invalid argument</a>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>If <var>codepoint</var> is U+005B ([), set <var>inside brackets</var> to true.</p>"
                    },
                    {
                      "html": "<p>If <var>codepoint</var> is U+005D (]), set <var>inside brackets</var> to false.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Append <var>hostname</var> to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>scheme</var> is not \"<code>file</code>\", append \"<code>placeholder</code>\" to\n <var>pattern url</var>.</p>"
                },
                {
                  "html": "<p>Set <var>has hostname</var> to false.</p>"
                }
              ]
            },
            {
              "html": "If <var>pattern</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⓪\">contains</a> \"<code>port</code>\":",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>pattern</var>[\"<code>port</code>\"] is the empty string, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⑥\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④③\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Let <var>port</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern②\">unescape URL Pattern</a> with <var>pattern</var>[\"<code>port</code>\"].</p>"
                },
                {
                  "html": "<p>Append \"<code>:</code>\" to <var>pattern url</var>.</p>"
                },
                {
                  "html": "For each <var>codepoint</var> in <var>port</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>codepoint</var> is not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-digit\" id=\"ref-for-ascii-digit\">ASCII digit</a>:",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④④\">invalid argument</a>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Append <var>port</var> to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>has port</var> to false.</p>"
                }
              ]
            },
            {
              "html": "If <var>pattern</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨①\">contains</a> \"<code>pathname</code>\":",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>pathname</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern③\">unescape URL Pattern</a> with\n <var>pattern</var>[\"<code>pathname</code>\"].</p>"
                },
                {
                  "html": "<p>If <var>pathname</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with\">start with</a> U+002F (/), then\n append \"<code>/</code>\" to <var>pattern url</var>.</p>"
                },
                {
                  "html": "For each <var>codepoint</var> in <var>pathname</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If «U+003F (?), U+0023 (#)» <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②⓪\">contains</a>\n <var>codepoint</var>:",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⑤\">invalid argument</a>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Append <var>pathname</var> to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>has pathname</var> to false.</p>"
                }
              ]
            },
            {
              "html": "If <var>pattern</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨②\">contains</a> \"<code>search</code>\":",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>search</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern④\">unescape URL pattern</a> with\n <var>pattern</var>[\"<code>search</code>\"].</p>"
                },
                {
                  "html": "<p>If <var>search</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with①\">start with</a> U+003F (?), then\n append \"<code>?</code>\" to <var>pattern url</var>.</p>"
                },
                {
                  "html": "For each <var>codepoint</var> in <var>search</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>codepoint</var> is U+0023 (#):",
                      "rationale": "return",
                      "steps": [
                        {
                          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑧⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⑥\">invalid argument</a>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Append <var>search</var> to <var>pattern url</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>has search</var> to false.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise, if <var>pattern</var> matches the <code>network.UrlPatternString</code> production:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>pattern url</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unescape-url-pattern\" id=\"ref-for-unescape-url-pattern⑤\">unescape URL pattern</a> with <var>pattern</var>[\"<code>pattern</code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>url</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①\">parsing</a> <var>pattern url</var>.</p>"
        },
        {
          "html": "<p>If <var>url</var> is failure, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsed</var> be a struct with the following fields:</p>\n      <dl>\n       <dt>protocol\n   \n       </dt><dd><var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a> if <var>has protocol</var> is true, or null otherwise.\n   \n       </dd><dt>hostname\n   \n       </dt><dd><var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a> if <var>has hostname</var> is true, or null otherwise.\n   \n       </dd><dt>port\n   \n       </dt><dd>\n        \n       </dd><dt>pathname\n   \n       </dt><dd>\n        \n       </dd><dt>search\n   \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>has port</var> is false:</p>",
              "ignored": [
                "null."
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme②\">scheme</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#is-special\" id=\"ref-for-is-special①\">is special</a> and <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme③\">scheme</a>’s\n  <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#default-port\" id=\"ref-for-default-port\">default port</a> is not null, and <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port\">port</a> is null or is\n  equal to <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme④\">scheme</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#default-port\" id=\"ref-for-default-port①\">default port</a>:</p>",
                  "ignored": [
                    "The empty string."
                  ]
                },
                {
                  "html": "Otherwise, if <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port①\">port</a> is not null:",
                  "rationale": "serialize",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①\">Serialize an integer</a> with <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port②\">port</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Otherwise:</p>",
                  "ignored": [
                    "null."
                  ]
                }
              ]
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>has pathname</var> is false:</p>",
                  "ignored": [
                    "null."
                  ]
                },
                {
                  "html": "<p>Otherwise:</p>",
                  "ignored": [
                    "The result of running the URL path serializer with url, if url’s path is not the empty string and is not empty, or null otherwise."
                  ]
                }
              ]
            },
            {
              "html": "",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>has search</var> is false:</p>",
                  "ignored": [
                    "null."
                  ]
                },
                {
                  "html": "<p>Otherwise:</p>",
                  "ignored": [
                    "The empty string if url’s query is null, or url’s query otherwise."
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⑤\">success</a> with data <var>parsed</var>.</p>"
        }
      ]
    },
    {
      "name": "match URL pattern",
      "href": "https://w3c.github.io/webdriver-bidi/#match-url-pattern",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-url-pattern\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match URL pattern</dfn> given <var>url pattern</var> and <var>url string</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser②\">parsing</a> <var>url string</var>.</p>"
        },
        {
          "html": "<p>If <var>url pattern</var>’s protocol is not null and is not equal to <var>url</var>’s\n <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑤\">scheme</a>, return false.</p>"
        },
        {
          "html": "<p>If <var>url pattern</var>’s hostname is not null and is not equal to <var>url</var>’s\n <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a>, return false.</p>"
        },
        {
          "html": "If <var>url pattern</var>’s port is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>port</var> be null.</p>"
            },
            {
              "html": "If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑥\">scheme</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#is-special\" id=\"ref-for-is-special②\">is special</a> and <var>url</var>’s\n  <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑦\">scheme</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#default-port\" id=\"ref-for-default-port②\">default port</a> is not null, and <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port③\">port</a> is\n  null or is equal to <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑧\">scheme</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#default-port\" id=\"ref-for-default-port③\">default port</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>port</var> to the empty string.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port④\">port</a>, is not null:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>port</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②\">serialize an integer</a> with <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port⑤\">port</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>url pattern</var>’s port is not equal to <var>port</var>, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>url pattern</var>’s pathname is not null and is not equal to the result of\n running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#url-path-serializer\" id=\"ref-for-url-path-serializer①\">URL path serializer</a> with <var>url</var>, return false.</p>"
        },
        {
          "html": "If <var>url pattern</var>’s search is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>url query</var> be <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-query\" id=\"ref-for-concept-url-query②\">query</a>.</p>"
            },
            {
              "html": "<p>If <var>url query</var> is null, set <var>url query</var> to the empty string.</p>"
            },
            {
              "html": "<p>If <var>url pattern</var>’s search is not equal to <var>url query</var>, return false.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.addDataCollector",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③④\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>collector id</var> be the string representation of a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>.</p>"
        },
        {
          "html": "<p>Let <var>input context ids</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⑤\">set</a>.</p>"
        },
        {
          "html": "<p>If the <code>contexts</code> field of <var>command parameters</var> is present,\n set <var>input context ids</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create③\">create a set</a> with\n <var>command parameters</var>[<code>contexts</code>].</p>"
        },
        {
          "html": "<p>Let <var>data types</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create④\">create a set</a> with\n <var>command parameters</var>[\"<code>dataTypes</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>max encoded item size</var> be <var>command parameters</var>\n [\"<code>maxEncodedDataSize</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>collector type</var> be <var>command parameters</var>\n [\"<code>collectorType</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>input user context ids</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⑥\">set</a>.</p>"
        },
        {
          "html": "<p>If the <code>userContexts</code> field of <var>command parameters</var> is present,\n set <var>input user context ids</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create⑤\">create a set</a> with\n <var>command parameters</var>[<code>userContexts</code>].</p>"
        },
        {
          "html": "<p>If <var>input user context ids</var> is not empty and <var>input context ids</var> is not\n empty, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>max encoded item size</var> is 0 or <var>max encoded item size</var> is greater than\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#max-total-collected-size\" id=\"ref-for-max-total-collected-size②\">max total collected size</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "If <var>input context ids</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⑧\">empty</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-navigables-by-ids\" id=\"ref-for-get-valid-navigables-by-ids①\">get valid navigables by ids</a>\n  with <var>input context ids</var>.</p>"
            },
            {
              "html": "For each <var>navigable</var> in <var>navigables</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④⑦\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨③\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⓪\">invalid argument</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise, if <var>input user context ids</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⑨\">empty</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>user context id</var> of <var>input user context ids</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>user context</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context④\">get user context</a> with <var>user context id</var>.</p>"
                },
                {
                  "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤①\">invalid argument</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>collector</var> be a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector\" id=\"ref-for-network-collector④\">collector</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-max-encoded-item-size\" id=\"ref-for-network-collector-max-encoded-item-size④\">max encoded item size</a> field set to <var>max encoded item size</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-data-types\" id=\"ref-for-network-collector-data-types①\">data types</a> field set to <var>data types</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-collector\" id=\"ref-for-network-collector-collector②\">collector</a> field set to <var>collector id</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-collector-type\" id=\"ref-for-network-collector-collector-type\">collector type</a> field set to <var>collector type</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-contexts\" id=\"ref-for-network-collector-contexts②\">contexts</a> field set to <var>input context ids</var>,\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collector-user-contexts\" id=\"ref-for-network-collector-user-contexts②②\">user contexts</a> field set to <var>input user context ids</var>.</p>"
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors④\">network collectors</a>[<var>collector id</var>] to <var>collector</var>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑤\">map</a> matching the\n <code>network.AddDataCollectorResult</code> production with the\n <code>collector</code> field set to <var>collector id</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.addRequestIntercept",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⑤\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>intercept</var> be the string representation of a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>.</p>"
        },
        {
          "html": "<p>Let <var>url patterns</var> be the <code>urlPatterns</code> field of <var>command\n parameters</var> if present, or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⓪\">list</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be null.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigables</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⑦\">set</a>.</p>"
            },
            {
              "html": "For each <var>navigable id</var> of <var>command parameters</var>[\"<code>contexts</code>\"]",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑤⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⑤\">get a navigable</a>\n with <var>navigable id</var>.</p>"
                },
                {
                  "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④⑧\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⑤\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤②\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Append <var>navigable</var> to <var>navigables</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>If <var>navigables</var> is an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⑧\">set</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨①\">error code</a>\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤③\">invalid argument</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>intercept map</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#intercept-map\" id=\"ref-for-intercept-map①\">intercept map</a>.</p>"
        },
        {
          "html": "<p>Let <var>parsed patterns</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③①\">list</a>.</p>"
        },
        {
          "html": "For each <var>url pattern</var> in <var>url patterns</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>parsed</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#parse-url-pattern\" id=\"ref-for-parse-url-pattern\">parse url pattern</a> with <var>url\n pattern</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③④\">Append</a> <var>parsed</var> to <var>parsed patterns</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>intercept map</var>[<var>intercept</var>] to a struct with <code>url patterns</code>\n <var>parsed patterns</var>, <code>phases</code> <var>command\n parameters</var>[\"<code>phases</code>\"] and <code>browsingContexts</code>\n <var>navigables</var>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑥\">map</a> matching the\n <code>network.AddInterceptResult</code> production with the\n <code>intercept</code> field set to <var>intercept</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.continueRequest",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⑥\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map②\">blocked request map</a>.</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>If <var>blocked requests</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨③\">contain</a> <var>request id</var> then return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-request\" id=\"ref-for-errors-no-such-request①\">no such request</a>.</p>"
        },
        {
          "html": "<p>Let (<var>request</var>, <var>phase</var>, <var>response</var>) be <var>blocked requests</var>[<var>request id</var>].</p>"
        },
        {
          "html": "<p>If <var>phase</var> is not \"<code>beforeRequestSent</code>\", then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⑧\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤④\">invalid argument</a>.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨④\">contains</a> \"<code>url</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>url record</var> be the result of applying the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser③\">URL parser</a> to <var>command\n parameters</var>[\"<code>url</code>\"], with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-script-base-url\" id=\"ref-for-concept-script-base-url②\">base URL</a> null.</p>"
            },
            {
              "html": "<p>If <var>url record</var> is failure, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors⑨⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⑤\">invalid argument</a>.</p>\n        <p>TODO: Should we also resume here?</p>"
            },
            {
              "html": "<p>Let <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url②\">url</a> be <var>url record</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑤\">contains</a> \"<code>method</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>method</var> be <var>command parameters</var>[\"<code>method</code>\"].</p>"
            },
            {
              "html": "<p>If <var>method</var> does not match the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9110.html#method.overview\" id=\"ref-for-method.overview\">method token</a> production, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⓪\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⑤\">error code</a> \"<code>invalid argument</code>\".</p>"
            },
            {
              "html": "<p>Let <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①\">method</a> be <var>method</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑥\">contains</a> \"<code>headers</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>headers</var> be an empty <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑥\">header list</a>.</p>"
            },
            {
              "html": "For <var>header</var> in <var>command parameters</var>[\"<code>headers</code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>deserialized header</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-header\" id=\"ref-for-deserialize-header①\">deserialize header</a> with <var>header</var>.</p>"
                },
                {
                  "html": "<p>If <var>deserialized header</var>’s name does not match the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9110.html#fields.names\" id=\"ref-for-fields.names①\">field-name token</a>\n production, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⑥\">error code</a>\n\"<code>invalid argument</code>\".</p>"
                },
                {
                  "html": "<p>If <var>deserialized header</var>’s value does not match the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value①\">header value</a>\n production, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⑦\">error code</a>\n\"<code>invalid argument</code>\".</p>"
                },
                {
                  "html": "<p>Append <var>deserialized header</var> to <var>headers</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">headers list</a> to <var>headers</var>.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑦\">contains</a> \"<code>cookies</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>cookie header</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑤\">byte sequence</a>.</p>"
            },
            {
              "html": "For each <var>cookie</var> in <var>command parameters</var>[\"<code>cookies</code>\"]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>cookie header</var> is not empty, append `<code>;</code>` to <var>cookie\n header</var>.</p>"
                },
                {
                  "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-cookie-header\" id=\"ref-for-serialize-cookie-header\">serialize cookie header</a> with <var>cookie</var> to <var>cookie header</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>found cookie header</var> be false.</p>"
            },
            {
              "html": "For each <var>header</var> in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③\">headers list</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>name</var> be <var>header</var>’s name.</p>"
                },
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-lowercase\" id=\"ref-for-byte-lowercase①\">byte-lowercase</a> <var>name</var> is `<code>cookie</code>`:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>header</var>’s value to <var>cookie header</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>found cookie header</var> to true.</p>"
                    },
                    {
                      "html": "<p>Break.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>found cookie header</var> is false:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p>Append the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①\">header</a> (`<code>Cookie</code>`, <var>cookie header</var>) to\n <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④\">headers list</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑧\">contains</a> \"<code>body</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>body</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes③\">deserialize protocol bytes</a> with <var>command\n parameters</var>[\"<code>body</code>\"].</p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body③\">body</a> to <var>body</var>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⑦\">Resume</a> with \"<code>continue request</code>\", <var>request id</var>, and (null,\n \"<code>incomplete</code>\").</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⑥\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.continueResponse",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⑦\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-the-response\" id=\"ref-for-update-the-response\">update the response</a> with\n <var>session</var>, \"<code>continueResponse</code>\" and <var>command parameters</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⑧\">Resume</a> with \"<code>continue request</code>\", <var>request id</var>, and\n (<var>response</var>, \"<code>incomplete</code>\").</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⑦\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.continueWithAuth",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⑧\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map③\">blocked request map</a>.</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>If <var>blocked requests</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨⑨\">contain</a> <var>request id</var> then return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-request\" id=\"ref-for-errors-no-such-request②\">no such request</a>.</p>"
        },
        {
          "html": "<p>Let (<var>request</var>, <var>phase</var>, <var>response</var>) be <var>blocked requests</var>[<var>request id</var>].</p>"
        },
        {
          "html": "<p>If <var>phase</var> is not \"<code>authRequired</code>\", then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪④\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var> \"<code>action</code>\" is \"<code>cancel</code>\", set\n <var>response</var>’s authentication credentials  to\n \"<code>cancelled</code>\".</p>"
        },
        {
          "html": "If <var>command parameters</var> \"<code>action</code>\" is\n \"<code>provideCredentials</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>credentials</var> be <var>command parameters</var>[\"<code>credentials</code>\"].</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>credentials</var>[\"<code>type</code>\"] is \"<code>password</code>\".</p>"
            },
            {
              "html": "<p>Set <var>response</var>’s authentication credentials  to\n  (<var>credentials</var>[\"<code>username</code>\"], <var>credentials</var>[\"<code>password</code>\"])</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume①⑨\">Resume</a> with \"<code>continue request</code>\", <var>request id</var>, and\n (<var>response</var>, \"<code>incomplete</code>\").</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⑧\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.disownData",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps③⑨\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data type</var> be the value of the \"<code>dataType</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>collector id</var> be the value of the \"<code>collector</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be the value of the \"<code>request</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>collectors</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors⑤\">network collectors</a>.</p>"
        },
        {
          "html": "<p>If <var>collectors</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⓪\">contain</a> <var>collector id</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-collector\" id=\"ref-for-errors-no-such-network-collector\">no such network collector</a>.</p>"
        },
        {
          "html": "<p>Let <var>collected data</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-collected-data\" id=\"ref-for-get-collected-data③\">get collected data</a> with <var>request id</var> and <var>data type</var>.</p>"
        },
        {
          "html": "<p>If <var>collected data</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-data\" id=\"ref-for-errors-no-such-network-data\">no such network data</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#remove-collector-from-data\" id=\"ref-for-remove-collector-from-data①\">Remove collector from data</a> with <var>collected data</var> and <var>collector id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤⑨\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-null-value\" id=\"ref-for-sec-null-value\">null</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.failRequest",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⓪\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map④\">blocked request map</a>.</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>If <var>blocked requests</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪①\">contain</a> <var>request id</var> then return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-request\" id=\"ref-for-errors-no-such-request③\">no such request</a>.</p>"
        },
        {
          "html": "<p>Let (<var>request</var>, <var>phase</var>, <var>response</var>) be\n <var>blocked requests</var>[<var>request id</var>].</p>"
        },
        {
          "html": "<p>If <var>phase</var> is \"<code>authRequired</code>\", then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⑧\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error\">network error</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume②⓪\">Resume</a> with \"<code>continue request</code>\", <var>request id</var>, and\n (<var>response</var>, \"<code>complete</code>\").</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⓪\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.getData",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④①\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data type</var> be <var>command parameters</var>[\"<code>dataType</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>collector id</var> be null.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪②\">contains</a> \"<code>collector</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>collectors</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors⑥\">network collectors</a>.</p>"
            },
            {
              "html": "<p>If <var>collectors</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪③\">contain</a> <var>collector id</var>, return\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⓪⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-collector\" id=\"ref-for-errors-no-such-network-collector①\">no such network collector</a>.</p>"
            },
            {
              "html": "<p>Set <var>collector id</var> to <var>command parameters</var>[\"<code>collector</code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>disown</var> be <var>command parameters</var>[\"<code>disown</code>\"].</p>"
        },
        {
          "html": "<p>If <var>disown</var> is true and <var>collector id</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⓪\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>collected data</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-collected-data\" id=\"ref-for-get-collected-data④\">get collected data</a> given <var>request id</var> and <var>data type</var>.</p>"
        },
        {
          "html": "If <var>collected data</var> is null:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-data\" id=\"ref-for-errors-no-such-network-data①\">no such network data</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-pending\" id=\"ref-for-network-data-pending④\">pending</a> is true:</p>",
          "ignored": [
            "Await with \"network data collected\" and (request id, data type)."
          ]
        },
        {
          "html": "If <var>collector id</var> is not null and if <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-collectors\" id=\"ref-for-network-data-collectors⑦\">collectors</a>\n does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②①\">contain</a> <var>collector id</var>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-data\" id=\"ref-for-errors-no-such-network-data②\">no such network data</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>bytes</var> be <var>collected data</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-data-bytes\" id=\"ref-for-network-data-bytes⑤\">bytes</a>.</p>"
        },
        {
          "html": "If <var>bytes</var> is null,",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-unavailable-network-data\" id=\"ref-for-errors-unavailable-network-data\">unavailable network data</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑦\">map</a> matching the <code>network.GetDataResult</code> production,\n with the <code>bytes</code> field set to <var>bytes</var>.</p>"
        },
        {
          "html": "<p>If <var>disown</var> is true, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#remove-collector-from-data\" id=\"ref-for-remove-collector-from-data②\">remove collector from data</a> with <var>collected data</var> and <var>collector id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥①\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.provideResponse",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④②\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request id</var> be <var>command parameters</var>[\"<code>request</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>response</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-the-response\" id=\"ref-for-update-the-response①\">update the response</a> with\n <var>session</var>, \"<code>provideResponse</code>\", and <var>command parameters</var>.</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪④\">contains</a> \"<code>body</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>body</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes④\">deserialize protocol bytes</a> with <var>command\n parameters</var>[\"<code>body</code>\"].</p>"
            },
            {
              "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body\">body</a> to <var>body</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-sequence-as-a-body\" id=\"ref-for-byte-sequence-as-a-body\">as a body</a>.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#resume\" id=\"ref-for-resume②①\">Resume</a> with \"<code>continue request</code>\", <var>request id</var>, and\n (<var>response</var>,\"<code>complete</code>\").</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥②\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.removeDataCollector",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④③\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>collector id</var> be the value of the \"<code>collector</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>collectors</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors⑦\">network collectors</a>.</p>"
        },
        {
          "html": "<p>If <var>collectors</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑤\">contain</a> <var>collector id</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-network-collector\" id=\"ref-for-errors-no-such-network-collector②\">no such network collector</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①④\">Remove</a> <var>collector id</var> from <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#network-collectors\" id=\"ref-for-network-collectors⑧\">network collectors</a>.</p>"
        },
        {
          "html": "<p>For <var>collected data</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#collected-network-data\" id=\"ref-for-collected-network-data①⓪\">collected network data</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#remove-collector-from-data\" id=\"ref-for-remove-collector-from-data③\">remove collector from data</a>\n with <var>collected data</var> and <var>collector id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥③\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-null-value\" id=\"ref-for-sec-null-value①\">null</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.removeIntercept",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④④\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>intercept</var> be the value of the \"<code>intercept</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>intercept map</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#intercept-map\" id=\"ref-for-intercept-map②\">intercept map</a>.</p>"
        },
        {
          "html": "<p>If <var>intercept map</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑥\">contain</a> <var>intercept</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-intercept\" id=\"ref-for-errors-no-such-intercept\">no such intercept</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⑤\">Remove</a> <var>intercept</var> from <var>intercept map</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.removeIntercept",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④④\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": "return",
      "steps": [
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥④\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-null-value\" id=\"ref-for-sec-null-value②\">null</a>.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi cache behavior",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-cache-behavior",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-cache-behavior\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi cache behavior</dfn> steps given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑥\">request</a> <var>request</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be null.</p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑥\">client</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑨\">environment settings object</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>environment settings</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑦\">client</a>.</p>"
            },
            {
              "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③⑧\">navigable</a> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-window\" id=\"ref-for-nav-window③\">active window</a> is <var>environment\n settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global②\">global object</a>, set <var>navigable</var>\n to that navigable’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①③\">top-level traversable</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>navigable</var> is not null and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map①\">navigable cache behavior map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②②\">contains</a>\n <var>navigable</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map②\">navigable cache behavior map</a>[<var>navigable</var>].</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-cache-behavior\" id=\"ref-for-default-cache-behavior①\">default cache behavior</a>.</p>"
        }
      ]
    },
    {
      "name": "navigable cache behavior",
      "href": "https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"navigable-cache-behavior\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">navigable cache behavior</dfn> steps given <var>navigable</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>top-level navigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①④\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map③\">navigable cache behavior map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑦\">contains</a> <var>top-level navigable</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map④\">navigable cache behavior map</a>[<var>top-level navigable</var>].</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-cache-behavior\" id=\"ref-for-default-cache-behavior②\">default cache behavior</a>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for network.setCacheBehavior",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⑤\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>behavior</var> be <var>command parameters</var>[\"<code>cacheBehavior</code>\"].</p>"
        },
        {
          "html": "If <var>command parameters</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑧\">contain</a> \"<code>contexts</code>\":",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-cache-behavior\" id=\"ref-for-default-cache-behavior③\">default cache behavior</a> to <var>behavior</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clear\" id=\"ref-for-map-clear②\">Clear</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map⑤\">navigable cache behavior map</a>.</p>"
            },
            {
              "html": "<p>Switch on the value of behavior:</p>\n        <dl>\n         <dt>\"<code>bypass</code>\"\n  \n         </dt><dd>Perform implementation-defined steps to disable any\n    implementation-specific resource caches.\n  \n         </dd><dt>\"<code>default</code>\"\n  \n         </dt><dd>Perform implementation-defined steps to enable any\n    implementation-specific resource caches that are usually enabled in the\n    current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends④①\">remote end</a> configuration.\n\n        </dd></dl>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⑤\">success</a> with data null.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>navigables</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤⑨\">set</a>.</p>"
        },
        {
          "html": "For each <var>navigable id</var> of <var>command parameters</var>[\"<code>contexts</code>\"]:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>context</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⑥\">get a navigable</a>\nwith <var>navigable id</var>.</p>"
            },
            {
              "html": "<p>If <var>context</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context\" id=\"ref-for-top-level-browsing-context\">top-level browsing context</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⑥\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤⑨\">invalid argument</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑤\">Append</a> <var>context</var> to <var>navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>navigable</var> in <var>navigables</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map⑥\">navigable cache behavior map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪⑨\">contains</a> <var>navigable</var>, and\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map⑦\">navigable cache behavior map</a>[<var>navigable</var>] is equal to <var>behavior</var> then\n continue.</p>"
            },
            {
              "html": "<p>Switch on the value of behavior:</p>\n        <dl>\n         <dt>\"<code>bypass</code>\"\n  \n         </dt><dd>Perform implementation-defined steps to disable any implementation-specific\n    resource caches for network requests originating from any browsing\n    context for which <var>navigable</var> is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context\" id=\"ref-for-top-level-browsing-context①\">top-level browsing context</a>.\n  \n         </dd><dt>\"<code>default</code>\"\n  \n         </dt><dd>Perform implementation-defined steps to enable any\n    implementation-specific resource caches that are usually enabled in the\n    current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends④②\">remote end</a> configuration for network requests\n    originating from any browsing context for which <var>navigable</var> is the\n    <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context\" id=\"ref-for-top-level-browsing-context②\">top-level browsing context</a>.\n\n        </dd></dl>"
            },
            {
              "html": "If <var>behavior</var> is equal to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-cache-behavior\" id=\"ref-for-default-cache-behavior④\">default cache behavior</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map⑧\">navigable cache behavior map</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⓪\">contains</a> <var>navigable</var>,\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⑥\">remove</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map⑨\">navigable cache behavior map</a>[<var>navigable</var>].</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-cache-behavior-map\" id=\"ref-for-navigable-cache-behavior-map①⓪\">navigable cache behavior map</a>[<var>navigable</var>] to <var>behavior</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⑥\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "update headers",
      "href": "https://w3c.github.io/webdriver-bidi/#update-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update headers</dfn> given <var>request</var> and <var>headers</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request headers</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑤\">header list</a>.</p>"
        },
        {
          "html": "For each <var>header</var> in <var>headers</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set\" id=\"ref-for-concept-header-list-set\">Set</a> <var>header</var> in <var>request headers</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "update request headers",
      "href": "https://w3c.github.io/webdriver-bidi/#update-request-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"update-request-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">update request headers</dfn> given <var>session</var>, <var>request</var>, and <var>related\nnavigables</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <var>related navigables</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑦\">size</a> is 0 or 1.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-headers\" id=\"ref-for-update-headers\">Update headers</a> with <var>request</var> and <var>session</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers\">extra headers</a>' <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-default-headers\" id=\"ref-for-extra-headers-default-headers\">default headers</a></p>"
        },
        {
          "html": "<p>Let <var>user context headers</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers①\">extra headers</a>'\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-user-context-headers\" id=\"ref-for-extra-headers-user-context-headers\">user context headers</a>.</p>"
        },
        {
          "html": "For <var>navigable</var> in <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context③⓪\">associated user context</a>.</p>"
            },
            {
              "html": "<p>If <var>user context headers</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①①\">contains</a> <var>user context</var>\n then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-headers\" id=\"ref-for-update-headers①\">update headers</a> with <var>request</var> and\n <var>user context headers</var>[<var>user context</var>]</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>navigable headers</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers②\">extra headers</a>'\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-navigable-headers\" id=\"ref-for-extra-headers-navigable-headers\">navigable headers</a>.</p>"
        },
        {
          "html": "For <var>navigable</var> in <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⑤\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>If <var>navigable headers</var> contains <var>top-level traversable</var>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-headers\" id=\"ref-for-update-headers②\">update headers</a> with <var>request</var> and <var>navigable headers</var>[<var>top-level traversable</var>].</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for network.setExtraHeaders",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⑥\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①②\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①③\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>headers</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#create-a-headers-list\" id=\"ref-for-create-a-headers-list①\">create a headers list</a> with\n <var>command parameters</var>[\"<code>headers</code>\"].</p>"
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①④\">contains</a> \"<code>userContexts</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user contexts</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③②\">list</a>.</p>"
            },
            {
              "html": "For <var>user context id</var> in <var>command parameters</var>[\"<code>userContexts</code>\"]:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>user context</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context⑤\">get user context</a> with <var>user context id</var>.</p>"
                },
                {
                  "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥①\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③⑥\">Append</a> <var>user context</var> to <var>user contexts</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>target</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers③\">extra headers</a>'\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-user-context-headers\" id=\"ref-for-extra-headers-user-context-headers①\">user context headers</a></p>"
            },
            {
              "html": "For <var>user context</var> in <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>target</var>[<var>user context</var>] to <var>headers</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⑦\">success</a> with data null.</p>"
            }
          ]
        },
        {
          "html": "If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑤\">contains</a> \"<code>contexts</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⑤\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-valid-top-level-traversables-by-ids\" id=\"ref-for-get-valid-top-level-traversables-by-ids⑧\">get valid top-level traversables by ids</a>\n with <var>command parameters</var>[\"<code>contexts</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>target</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers④\">extra headers</a>'\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-navigable-headers\" id=\"ref-for-extra-headers-navigable-headers①\">navigable headers</a></p>"
            },
            {
              "html": "For <var>navigable</var> in <var>navigables</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>target</var>[<var>navigable</var>] to <var>headers</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⑧\">success</a> with data null.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-extra-headers\" id=\"ref-for-session-extra-headers⑤\">extra headers</a>'\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extra-headers-default-headers\" id=\"ref-for-extra-headers-default-headers①\">default headers</a> to <var>headers</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥⑨\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi auth required",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-auth-required",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⑥\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-auth-required\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi auth required</dfn>\nsteps given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦\">request</a> <var>request</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>redirect count</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count①\">redirect count</a>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map①\">before request sent map</a>[<var>request</var>] is equal to <var>redirect count</var>.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑧\">client</a> is not null, let <var>related navigables</var>\n be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables③\">get related navigables</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑨\">client</a>. Otherwise let <var>related navigables</var> be an empty\n set.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⑤\">set of sessions for which an event is enabled</a>\n given \"<code>network.authRequired</code>\" and <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#process-a-network-event\" id=\"ref-for-process-a-network-event\">process a network event</a> with <var>session</var>\n \"<code>network.authRequired</code>\", and <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>response data</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-response-data\" id=\"ref-for-get-the-response-data\">get the response data</a> with <var>response</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>response data</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑥\">contains</a> \"<code>authChallenge</code>\".</p>"
            },
            {
              "html": "<p>Set the <code>response</code> field of <var>params</var> to <var>response data</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var> matches the <code>network.AuthRequiredParameters</code>\n production.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a map matching the <code>network.AuthRequired</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⑤\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            },
            {
              "html": "If <var>params</var>[\"<code>isBlocked</code>\"] is true:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map⑤\">blocked request map</a>.</p>"
                },
                {
                  "html": "<p>Let <var>request id</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①②\">request id</a>.</p>"
                },
                {
                  "html": "<p>Set <var>blocked requests</var>[<var>request id</var>] to (<var>request</var>,\n \"<code>authRequired</code>\", <var>response</var>).</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits⑤\">Await</a> with «\"<code>continue request</code>\"», and <var>request id</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⑦\">Remove</a> <var>blocked requests</var>[<var>request id</var>].</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "request originates in user context",
      "href": "https://w3c.github.io/webdriver-bidi/#request-originates-in-user-context",
      "html": "The steps to check if <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-originates-in-user-context\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">request originates in user context</dfn> given <var>request</var>\nand <var>user context</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>settings</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⓪\">client</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables④\">get related navigables</a> with <var>settings</var>.</p>"
        },
        {
          "html": "For <var>navigable</var> in <var>related navigables</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context③①\">associated user context</a> is <var>user context</var> return true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "get emulated network conditions",
      "href": "https://w3c.github.io/webdriver-bidi/#get-emulated-network-conditions",
      "html": "The steps to <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-emulated-network-conditions\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get emulated network conditions</dfn> given <var>related navigables</var>\nare:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>navigable</var> of <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⑥\">top-level traversable</a>.</p>"
            },
            {
              "html": "<p>Let <var>user context</var> be <var>top-level traversable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context③②\">associated user context</a>.</p>"
            },
            {
              "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions⑦\">active BiDi sessions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions⑤\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-navigable-network-conditions\" id=\"ref-for-emulated-network-conditions-navigable-network-conditions②\">navigable network conditions</a>\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑦\">contains</a> <var>top-level traversable</var>, return <var>session</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions⑥\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-navigable-network-conditions\" id=\"ref-for-emulated-network-conditions-navigable-network-conditions③\">navigable network conditions</a>[<var>top-level traversable</var>].</p>"
                }
              ]
            },
            {
              "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions⑧\">active BiDi sessions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions⑦\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-user-context-network-conditions\" id=\"ref-for-emulated-network-conditions-user-context-network-conditions②\">user context network conditions</a>\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑧\">contains</a> <var>user context</var>, return <var>session</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions⑧\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-user-context-network-conditions\" id=\"ref-for-emulated-network-conditions-user-context-network-conditions③\">user context network conditions</a>[<var>user context</var>].</p>"
                }
              ]
            },
            {
              "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions⑨\">active BiDi sessions</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions⑨\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-default-network-conditions\" id=\"ref-for-emulated-network-conditions-default-network-conditions①\">default network conditions</a> is not null,\n return <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#session-emulated-network-conditions\" id=\"ref-for-session-emulated-network-conditions①⓪\">emulated network conditions</a>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-default-network-conditions\" id=\"ref-for-emulated-network-conditions-default-network-conditions②\">default network conditions</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi network is offline",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-network-is-offline",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-network-is-offline\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi network is offline</dfn> steps given\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⓪\">environment settings object</a> <var>settings</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated <code>Document</code></a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable④\">node navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>emulated network conditions</var> be the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-emulated-network-conditions\" id=\"ref-for-get-emulated-network-conditions\">get emulated network conditions</a> with [<var>navigable</var>].</p>"
        },
        {
          "html": "<p>If <var>emulated network conditions</var> is not null and <var>emulated network conditions</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-struct-offline\" id=\"ref-for-emulated-network-conditions-struct-offline①\">offline</a> is true, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi before request sent",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-before-request-sent",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⑦\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-before-request-sent\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi before request sent</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑧\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>user context</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-user-contexts\" id=\"ref-for-set-of-user-contexts①①\">set of user contexts</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-originates-in-user-context\" id=\"ref-for-request-originates-in-user-context\">request originates in user context</a> steps with <var>request</var> and\n  <var>user context</var> return true:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①⓪\">active BiDi sessions</a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-accept-insecure-certificates-override-map\" id=\"ref-for-user-context-to-accept-insecure-certificates-override-map③\">user context to accept insecure certificates override map</a>\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①⑨\">contains</a> <var>user context</var>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>accept insecure certificates</var> be <var>session</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-accept-insecure-certificates-override-map\" id=\"ref-for-user-context-to-accept-insecure-certificates-override-map④\">user context to accept insecure certificates override map</a>[<var>user context</var>].</p>"
                        },
                        {
                          "html": "If <var>accept insecure certificates</var> is true:",
                          "rationale": "assert",
                          "steps": [
                            {
                              "html": "<p>Assert <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node③\">endpoint node</a> supports accepting insecure TLS\n  connections.</p>"
                            },
                            {
                              "html": "<p>When running the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc5280#section-6.1.3\" id=\"ref-for-section-6.1.3\">Basic Certificate Processing</a> steps for\n  <var>request</var>, skip step a, along with any other\n  implementation-defined certificate validation steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Otherwise, when running the <a data-link-type=\"dfn\" href=\"https://datatracker.ietf.org/doc/html/rfc5280#section-6.1.3\" id=\"ref-for-section-6.1.3①\">Basic Certificate Processing</a> steps\n for <var>request</var>, perform all steps along with any implementation-defined\n certificate validation steps.</p>"
                        }
                      ]
                    }
                  ],
                  "additional": [
                    {
                      "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①⓪\">active BiDi sessions</a>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-proxy-configuration-map\" id=\"ref-for-user-context-to-proxy-configuration-map③\">user context to proxy configuration map</a>\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②③\">contains</a> <var>user context</var>:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>proxy configuration</var> be <var>session</var>’s\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-to-proxy-configuration-map\" id=\"ref-for-user-context-to-proxy-configuration-map④\">user context to proxy configuration map</a>[<var>user context</var>].</p>"
                            },
                            {
                              "html": "<p>Take implementation-defined steps to ensure that <var>request</var> uses\n the proxy settings defined by the <var>proxy configuration</var>.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maybe-collect-network-request-body\" id=\"ref-for-maybe-collect-network-request-body\">Maybe collect network request body</a> with <var>request</var>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map②\">before request sent map</a> does not contain <var>request</var>, set <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map③\">before request sent map</a>[<var>request</var>] to a new set.</p>"
        },
        {
          "html": "<p>Let <var>redirect count</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count②\">redirect count</a>.</p>"
        },
        {
          "html": "<p>Add <var>redirect count</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map④\">before request sent map</a>[<var>request</var>].</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①①\">client</a> is not null, let <var>related navigables</var>\n be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables⑤\">get related navigables</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①②\">client</a>. Otherwise let <var>related navigables</var> be an empty\n set.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be null.</p>"
        },
        {
          "html": "<p>Let <var>response status</var> be \"<code>incomplete</code>\".</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①①\">active BiDi sessions</a>:",
          "rationale": "update",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#update-request-headers\" id=\"ref-for-update-request-headers\">Update request headers</a> with <var>session</var>, <var>request</var> and\n <var>related navigables</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⑥\">set of sessions for which an event is enabled</a>\n given \"<code>network.beforeRequestSent</code>\" and <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#process-a-network-event\" id=\"ref-for-process-a-network-event①\">process a network event</a> with <var>session</var>,\n \"<code>network.beforeRequestSent</code>\", and <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>initiator</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-initiator\" id=\"ref-for-get-the-initiator②\">get the initiator</a> with <var>request</var>.</p>"
            },
            {
              "html": "<p>If <var>initiator</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty\">empty</a>, set the <code>initiator</code> field\n of <var>params</var> to <var>initiator</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var> matches the <code>network.BeforeRequestSentParameters</code>\n production.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a map matching the <code>network.BeforeRequestSent</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⑥\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            },
            {
              "html": "If <var>params</var>[\"<code>isBlocked</code>\"] is true, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map⑥\">blocked request map</a>.</p>"
                },
                {
                  "html": "<p>Let <var>request id</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①③\">request id</a>.</p>"
                },
                {
                  "html": "<p>Set <var>blocked requests</var>[<var>request id</var>] to (<var>request</var>,\n \"<code>beforeRequestSent</code>\", null).</p>"
                },
                {
                  "html": "<p>Let (<var>response</var>, <var>status</var>) be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits⑥\">await</a> with «\"<code>continue\n request</code>\"», and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①④\">request id</a>.</p>"
                },
                {
                  "html": "<p>If <var>status</var> is \"<code>complete</code>\" set <var>response status</var> to <var>status</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⑧\">Remove</a> <var>blocked requests</var>[<var>request id</var>].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>emulated network conditions</var> be the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-emulated-network-conditions\" id=\"ref-for-get-emulated-network-conditions①\">get emulated network conditions</a> with <var>related navigables</var>.</p>"
        },
        {
          "html": "<p>If <var>emulated network conditions</var> is not null and\n <var>emulated network conditions</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emulated-network-conditions-struct-offline\" id=\"ref-for-emulated-network-conditions-struct-offline②\">offline</a> is\n true, return (<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①\">network error</a>, \"<code>complete</code>\").</p>"
        },
        {
          "html": "<p>Return (<var>response</var>, <var>response status</var>).</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi fetch error",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-fetch-error",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⑧\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"WebDriver BiDi fetch error\" id=\"webdriver-bidi-fetch-error\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi fetch\nerror</dfn> steps given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑨\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map⑤\">before request sent map</a>[<var>request</var>] does not contain <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count③\">redirect count</a>, then run the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-before-request-sent\" id=\"ref-for-webdriver-bidi-before-request-sent①\">WebDriver BiDi before request sent</a> steps\n with <var>request</var>.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①③\">client</a> is not null, let <var>related navigables</var>\n be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables⑥\">get related navigables</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①④\">client</a>. Otherwise let <var>related navigables</var> be an empty\n set.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maybe-abort-network-response-body-collection\" id=\"ref-for-maybe-abort-network-response-body-collection\">Maybe abort network response body collection</a> with <var>request</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⑦\">set of sessions for which an event is enabled</a>\n given \"<code>network.fetchError</code>\" and <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#process-a-network-event\" id=\"ref-for-process-a-network-event②\">process a network event</a> with <var>session</var>\n \"<code>network.fetchError</code>\", and <var>request</var>.</p>"
            },
            {
              "html": "<p>Set the <code>errorText</code> field of <var>params</var> to an implementation-defined string\n describing the error which caused the request to be aborted.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var> matches the <code>network.FetchErrorParameters</code>\n production.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a map matching the <code>network.FetchError</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⑦\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi response completed",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-response-completed",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger①⑨\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-response-completed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi response completed</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⓪\">request</a> <var>request</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response②\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>redirect count</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count④\">redirect count</a>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map⑥\">before request sent map</a>[<var>request</var>] contains <var>redirect count</var>.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑤\">client</a> is not null, let <var>related navigables</var>\n be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables⑦\">get related navigables</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑥\">client</a>. Otherwise let <var>related navigables</var> be an empty\n set.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#maybe-collect-network-response-body\" id=\"ref-for-maybe-collect-network-response-body\">Maybe collect network response body</a> with <var>request</var> and <var>response</var>.</p>"
        },
        {
          "html": "<p>Let <var>sessions</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⑧\">set of sessions for which an event is enabled</a>\n given \"<code>network.responseCompleted</code>\" and <var>related navigables</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in <var>sessions</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#process-a-network-event\" id=\"ref-for-process-a-network-event③\">process a network event</a> with <var>session</var>\n \"<code>network.responseCompleted</code>\", and <var>request</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var>[\"<code>isBlocked</code>\"] is false.</p>"
            },
            {
              "html": "<p>Let <var>response data</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-response-data\" id=\"ref-for-get-the-response-data①\">get the response data</a> with <var>response</var>.</p>"
            },
            {
              "html": "<p>Set the <code>response</code> field of <var>params</var> to <var>response data</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var> matches the <code>network.ResponseCompletedParameters</code>\n production.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a map matching the <code>network.ResponseCompleted</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⑧\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "WebDriver BiDi response started",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-response-started",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger②⓪\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-response-started\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi response started</dfn> steps\ngiven <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①①\">request</a> <var>request</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③\">response</a> <var>response</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>redirect count</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count⑤\">redirect count</a>.</p>"
        },
        {
          "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#before-request-sent-map\" id=\"ref-for-before-request-sent-map⑦\">before request sent map</a>[<var>request</var>] is equal to <var>redirect count</var>.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑦\">client</a> is not null, let <var>related navigables</var>\n be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables⑧\">get related navigables</a> with <var>request</var>’s\n <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑧\">client</a>. Otherwise let <var>related navigables</var> be an empty\n set.</p>"
        },
        {
          "html": "<p>Let <var>response status</var> be \"<code>incomplete</code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#clone-network-response-body\" id=\"ref-for-clone-network-response-body①\">Clone network response body</a> with <var>request</var> and <var>response</var>.</p>"
        },
        {
          "html": "<p>Let <var>sessions</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled①⑨\">set of sessions for which an event is enabled</a>\n given \"<code>network.responseStarted</code>\" and <var>related navigables</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in <var>sessions</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#process-a-network-event\" id=\"ref-for-process-a-network-event④\">process a network event</a> with <var>session</var>\n \"<code>network.responseStarted</code>\", and <var>request</var>.</p>"
            },
            {
              "html": "<p>Let <var>response data</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-response-data\" id=\"ref-for-get-the-response-data②\">get the response data</a> with <var>response</var>.</p>"
            },
            {
              "html": "<p>Set the <code>response</code> field of <var>params</var> to <var>response data</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>params</var> matches the <code>network.ResponseStartedParameters</code>\n production.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a map matching the <code>network.ResponseStarted</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event①⑨\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            },
            {
              "html": "If <var>params</var>[\"<code>isBlocked</code>\"] is true:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>blocked requests</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#blocked-request-map\" id=\"ref-for-blocked-request-map⑦\">blocked request map</a>.</p>"
                },
                {
                  "html": "<p>Let <var>request id</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#request-id\" id=\"ref-for-request-id①⑤\">request id</a>.</p>"
                },
                {
                  "html": "<p>Set <var>blocked requests</var>[<var>request id</var>] to (<var>request</var>,\n \"<code>beforeRequestSent</code>\", <var>response</var>).</p>"
                },
                {
                  "html": "<p>Let (<var>response</var>, <var>status</var>) be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#awaits\" id=\"ref-for-awaits⑦\">await</a> with «\"<code>continue request</code>\"», and\n <var>request id</var>.</p>"
                },
                {
                  "html": "<p>If <var>status</var> is \"<code>complete</code>\", set <var>response status</var> to <var>status</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-remove\" id=\"ref-for-map-remove①⑨\">Remove</a> <var>blocked requests</var>[<var>request id</var>].</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return (<var>response</var>, <var>response status</var>).</p>"
        }
      ]
    },
    {
      "name": "run WebDriver BiDi preload scripts",
      "href": "https://w3c.github.io/webdriver-bidi/#run-webdriver-bidi-preload-scripts",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"run-webdriver-bidi-preload-scripts\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">run WebDriver BiDi preload scripts</dfn> given <var>environment settings</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>document</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated <code>Document</code></a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables③⑨\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>user context</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-user-context\" id=\"ref-for-associated-user-context③③\">associated user context</a>.</p>"
        },
        {
          "html": "<p>Let <var>user context id</var> be <var>user context</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#user-context-user-context-id\" id=\"ref-for-user-context-user-context-id①⓪\">user context id</a>.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①②\">active BiDi sessions</a>:",
          "rationale": "for",
          "steps": [
            {
              "html": "For each <var>preload script</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#preload-script-map\" id=\"ref-for-preload-script-map\">preload script map</a>’s\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-getting-the-values\" id=\"ref-for-map-getting-the-values①\">values</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>preload script</var>’s <code>user contexts</code>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑧\">size</a> is not zero:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>preload script</var>’s <code>user contexts</code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②④\">contain</a> <var>user context id</var>,\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "If <var>preload script</var>’s <code>contexts</code> is not null:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>navigable id</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⑦\">top-level traversable</a>’s id.</p>"
                    },
                    {
                      "html": "<p>If <var>preload script</var>’s <code>contexts</code> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②⑤\">contain</a> <var>navigable id</var>,\n  <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>preload script</var>’s <code>sandbox</code> is not null, let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-or-create-a-sandbox-realm\" id=\"ref-for-get-or-create-a-sandbox-realm\">get or create a sandbox realm</a> with <var>preload script</var>’s <code>sandbox</code> and\n <var>navigable</var>. Otherwise let <var>realm</var> be <var>environment settings</var>’\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context⑤\">realm execution context</a>’s Realm component.</p>"
                },
                {
                  "html": "<p>Let <var>exception reporting global</var> be be <var>environment settings</var>’\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context⑥\">realm execution context</a>’s Realm component’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a>.</p>"
                },
                {
                  "html": "<p>Let <var>arguments</var> be <var>preload script</var>’s <code>arguments</code>.</p>"
                },
                {
                  "html": "<p>Let <var>deserialized arguments</var> be an empty list.</p>"
                },
                {
                  "html": "For each <var>argument</var> in <var>arguments</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>channel</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#create-a-channel\" id=\"ref-for-create-a-channel\">create a channel</a> with <var>session</var>, <var>realm</var> and\n <var>argument</var>.</p>"
                    },
                    {
                      "html": "<p>Append <var>channel</var> to <var>deserialized arguments</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Let <var>base URL</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url\" id=\"ref-for-api-base-url\">API base URL</a> of <var>environment settings</var>.</p>"
                },
                {
                  "html": "<p>Let <var>options</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#default-script-fetch-options\" id=\"ref-for-default-script-fetch-options\">default script fetch options</a>.</p>"
                },
                {
                  "html": "<p>Let <var>function declaration</var> be <var>preload script</var>’s <code>function declaration</code>.</p>"
                },
                {
                  "html": "<p>Let (<var>script</var>, <var>function body evaluation status</var>) be the result of\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#evaluate-function-body\" id=\"ref-for-evaluate-function-body\">evaluate function body</a> with <var>function declaration</var>,\n <var>environment settings</var>, <var>base URL</var>, and <var>options</var>.</p>"
                },
                {
                  "html": "<p>If <var>function body evaluation status</var> is an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type\">abrupt completion</a>, then\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#report-an-exception\" id=\"ref-for-report-an-exception\">report an exception</a> given by <var>function body evaluation status</var>.[[Value]]\n for <var>exception reporting global</var>.</p>"
                },
                {
                  "html": "<p>Let <var>function object</var> be <var>function body evaluation status</var>.[[Value]].</p>"
                },
                {
                  "html": "If <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable\">IsCallable</a>(<var>function object</var>) is <code>false</code>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>error</var> be a new <a class=\"idl-code\" data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a> object in <var>realm</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#report-an-exception\" id=\"ref-for-report-an-exception①\">Report an exception</a> <var>error</var> for <var>exception reporting global</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-script\" id=\"ref-for-prepare-to-run-script\">Prepare to run script</a> with <var>environment settings</var>.</p>"
                },
                {
                  "html": "<p>Set <var>evaluation status</var> to\n <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-call\" id=\"ref-for-sec-call\">Call</a>(<var>function object</var>, null, <var>deserialized arguments</var>).</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#clean-up-after-running-script\" id=\"ref-for-clean-up-after-running-script\">Clean up after running script</a> with <var>environment settings</var>.</p>"
                },
                {
                  "html": "<p>If <var>evaluation status</var> is an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type①\">abrupt completion</a>, then\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#report-an-exception\" id=\"ref-for-report-an-exception②\">report an exception</a> given by <var>evaluation status</var>.[[Value]] for\n <var>exception reporting global</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "create a channel",
      "href": "https://w3c.github.io/webdriver-bidi/#create-a-channel",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-channel\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a channel</dfn> given <var>session</var>, <var>realm</var> and <var>protocol value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>channel properties</var> be <var>protocol value</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "Let <var>steps</var> be the following steps given the argument <var>message</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>current realm</var> be the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm②\">current Realm Record</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-a-script-message\" id=\"ref-for-emit-a-script-message\">Emit a script message</a> with <var>session</var>, <var>current realm</var>, <var>channel properties</var> and <var>message</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createbuiltinfunction\" id=\"ref-for-sec-createbuiltinfunction\">CreateBuiltinFunction</a>(<var>steps</var>, 1, \"\", « », <var>realm</var>).</p>"
        }
      ]
    },
    {
      "name": "get exception details",
      "href": "https://w3c.github.io/webdriver-bidi/#get-exception-details",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-exception-details\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get exception details</dfn> given a <var>realm</var>, a <a data-link-type=\"dfn\" data-refhint-key=\"c8a04a12\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type②\">completion record</a>\n<var>record</var>, an <var>ownership type</var> and a <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <var>record</var>.[[Type]] is <code>throw</code>.</p>"
        },
        {
          "html": "<p>Let <var>text</var> be an implementation-defined textual description of the error\n represented by <var>record</var>.</p>\n      <p>TODO: Tighten up the requirements here; people will probably try to parse\n this data with regex or something equally bad.</p>"
        },
        {
          "html": "<p>Let <var>serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥⑨\">map</a> matching the\n <code>script.SerializationOptions</code> production with the fields set to\n their default values.</p>"
        },
        {
          "html": "<p>Let <var>exception</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value①\">serialize as a remote value</a> with\n <var>record</var>.[[Value]], <var>serialization options</var>, <var>ownership type</var>,\n a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⓪\">map</a> as serialization internal map, <var>realm</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Let <var>stack trace</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stack-trace-for-an-exception\" id=\"ref-for-stack-trace-for-an-exception\">stack trace for an exception</a> given <var>record</var>.</p>"
        },
        {
          "html": "<p>If <var>stack trace</var> has size of 1 or greater, let <var>line number</var> be value of the\n <code>lineNumber</code> field in <var>stack trace</var>[0], and let <var>column number</var> be\n the value of the <code>columnNumber</code> field <var>stack trace</var>[0]. Otherwise\n let <var>line number</var> and <var>column number</var> be 0.</p>"
        },
        {
          "html": "<p>Let <var>exception details</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦①\">map</a> matching the\n <code>script.ExceptionDetails</code> production, with the <code>text</code>\n field set to <var>text</var>, the <code>exception</code> field set to <var>exception</var>, the\n <code>lineNumber</code> field set to <var>line number</var>, the\n <code>columnNumber</code> field set to <var>column number</var>, and the\n <code>stackTrace</code> field set to <var>stack trace</var>.</p>"
        },
        {
          "html": "<p>Return <var>exception details</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize key-value list",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-key-value-list",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-key-value-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize key-value list</dfn> given <var>serialized key-value list</var>, <var>realm</var>\nand <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deserialized key-value list</var> be a new list.</p>"
        },
        {
          "html": "For each <var>serialized key-value</var> in the <var>serialized key-value list</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size⑨\">size</a> of <var>serialized key-value</var> is not 2,\n  return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①①⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①④\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥②\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>Let <var>serialized key</var> be <var>serialized key-value</var>[0].</p>"
            },
            {
              "html": "<p>If <var>serialized key</var> is a <code>string</code>,\n  let <var>deserialized key</var> be <var>serialized key</var>.</p>"
            },
            {
              "html": "<p>Otherwise let <var>deserialized key</var> be result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⑥\">trying</a> to\n  given <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-local-value\" id=\"ref-for-deserialize-local-value\">deserialize local value</a> with <var>serialized key</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Let <var>serialized value</var> be <var>serialized key-value</var>[1].</p>"
            },
            {
              "html": "<p>Let <var>deserialized value</var> be result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-local-value\" id=\"ref-for-deserialize-local-value①\">deserialize local value</a>\n  given <var>serialized value</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayfromlist\" id=\"ref-for-sec-createarrayfromlist\">CreateArrayFromList</a>(«<var>deserialized key</var>, <var>deserialized value</var>») to\n  <var>deserialized key-value list</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⓪\">success</a> with data <var>deserialized key-value list</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize value list",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-value-list",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-value-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize value list</dfn> given <var>serialized value list</var>, <var>realm</var> and\n<var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deserialized values</var> be a new list.</p>"
        },
        {
          "html": "For each <var>serialized value</var> in the <var>serialized value list</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deserialized value</var> be result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-local-value\" id=\"ref-for-deserialize-local-value②\">deserialize local value</a>\n  given <var>serialized value</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Append <var>deserialized value</var> to <var>deserialized values</var>;</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦①\">success</a> with data <var>deserialized values</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize local value",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-local-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-local-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize local value</dfn> given <var>local protocol value</var>, <var>realm</var> and\n<var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>local protocol value</var> matches the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scriptremotereference\" id=\"ref-for-scriptremotereference①\">script.RemoteReference</a> production, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-remote-reference\" id=\"ref-for-deserialize-remote-reference①\">deserialize remote reference</a> of given <var>local protocol value</var>, <var>realm</var> and\n <var>session</var>.</p>"
        },
        {
          "html": "<p>If <var>local protocol value</var> matches the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#scriptprimitiveprotocolvalue\" id=\"ref-for-scriptprimitiveprotocolvalue\">script.PrimitiveProtocolValue</a> production, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-primitive-protocol-value\" id=\"ref-for-deserialize-primitive-protocol-value\">deserialize primitive protocol value</a> with <var>local protocol value</var>.</p>"
        },
        {
          "html": "<p>If <var>local protocol value</var> matches the <code>script.ChannelValue</code> production,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#create-a-channel\" id=\"ref-for-create-a-channel①\">create a channel</a> with <var>session</var>, <var>realm</var> and <var>local protocol value</var>.</p>"
        },
        {
          "html": "<p>Let <var>type</var> be the value of the <code>type</code> field of <var>local protocol value</var> or undefined if\n no such a field.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be the value of the <code>value</code> field of <var>local protocol value</var> or undefined\n if no such a field.</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set of steps for which\n the associated condition is true:</p>\n      <dl>\n       <dt><var>type</var> is the string \"<code>array</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>date</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>map</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>object</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>regexp</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>set</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt>otherwise\n  \n       </dt><dd>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⑤\">invalid argument</a>.\n\n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deserialized value list</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑥⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-value-list\" id=\"ref-for-deserialize-value-list\">deserialize value list</a>\n given <var>value</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦②\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayfromlist\" id=\"ref-for-sec-createarrayfromlist①\">CreateArrayFromList</a>(<var>deserialized value list</var>).</p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>value</var> does not match <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-date-time-string-format\" id=\"ref-for-sec-date-time-string-format\">Date Time String Format</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⓪\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥③\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Let <var>date result</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-construct\" id=\"ref-for-sec-construct\">Construct</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-date-constructor\" id=\"ref-for-sec-date-constructor\">Date</a>, <var>value</var>).</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: <var>date result</var> is not an <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type③\">abrupt completion</a>.</p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦③\">success</a> with data <var>date result</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>deserialized key-value list</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⓪\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-key-value-list\" id=\"ref-for-deserialize-key-value-list\">deserialize key-value list</a> with <var>value</var>, <var>realm</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p>Let <var>iterable</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayfromlist\" id=\"ref-for-sec-createarrayfromlist②\">CreateArrayFromList</a>(<var>deserialized key-value list</var>)</p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦④\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-map-iterable\" id=\"ref-for-sec-map-iterable\">Map</a>(<var>iterable</var>).</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>deserialized key-value list</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦①\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-key-value-list\" id=\"ref-for-deserialize-key-value-list①\">deserialize key-value list</a> with <var>value</var>, <var>realm</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p>Let <var>iterable</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayfromlist\" id=\"ref-for-sec-createarrayfromlist③\">CreateArrayFromList</a>(<var>deserialized key-value list</var>)</p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⑤\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object.fromentries\" id=\"ref-for-sec-object.fromentries\">Object.fromEntries</a>(<var>iterable</var>).</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>pattern</var> be the value of the <code>pattern</code> field of <var>local protocol value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>flags</var> be the value of the <code>flags</code> field of <var>local protocol value</var> or\n undefined if no such a field.</p>"
                },
                {
                  "html": "<p>Let <var>regex_result</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-regexp-pattern-flags\" id=\"ref-for-sec-regexp-pattern-flags\">Regexp</a>(<var>pattern</var>, <var>flags</var>). If this throws exception, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②①\">error</a>\n with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥④\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⑥\">success</a> with data <var>regex_result</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>deserialized value list</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-value-list\" id=\"ref-for-deserialize-value-list①\">deserialize value list</a>\n given <var>value</var>, <var>realm</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p>Let <var>iterable</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayfromlist\" id=\"ref-for-sec-createarrayfromlist④\">CreateArrayFromList</a>(<var>deserialized key-value list</var>)</p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⑦\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-set-objects\" id=\"ref-for-sec-set-objects\">Set object</a>(<var>iterable</var>).</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "get a realm",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-realm",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-realm\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a realm</dfn> given <var>realm id</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>realm id</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⑧\">success</a> with data null.</p>"
        },
        {
          "html": "<p>If there is no <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-code-realms\" id=\"ref-for-sec-code-realms④\">realm</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id①\">id</a> <var>realm id</var> return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-frame\" id=\"ref-for-dfn-no-such-frame①\">no such frame</a></p>"
        },
        {
          "html": "<p>Let <var>realm</var> be the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-code-realms\" id=\"ref-for-sec-code-realms⑤\">realm</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id②\">id</a> <var>realm id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦⑨\">success</a> with data <var>realm</var></p>"
        }
      ]
    },
    {
      "name": "serialize primitive protocol value",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-primitive-protocol-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-primitive-protocol-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize primitive protocol value</dfn> given a <var>value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>remote value</var> be undefined.</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set\n of steps for which the associated condition is true, if any:</p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values\">Type</a>(<var>value</var>) is undefined\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦③\">map</a> matching the <code>script.UndefinedValue</code>\n  production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④④\">local end definition</a></code>.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values①\">Type</a>(<var>value</var>) is Null\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦④\">map</a> matching the <code>script.NullValue</code>\n  production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④⑤\">local end definition</a></code>.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values②\">Type</a>(<var>value</var>) is String\n  \n       </dt><dd>\n        Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⑤\">map</a> matching the <code>script.StringValue</code>\n  production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④⑥\">local end definition</a></code>, with the <code>value</code>\n  property set to <var>value</var>.\n\n\n        \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values③\">Type</a>(<var>value</var>) is Number\n  \n       </dt><dd>\n        \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values④\">Type</a>(<var>value</var>) is Boolean\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⑦\">map</a> matching the <code>script.BooleanValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④⑧\">local end definition</a></code>, with the <code>value</code>\n      property set to <var>value</var>.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values⑤\">Type</a>(<var>value</var>) is BigInt\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⑧\">map</a> matching the <code>script.BigIntValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④⑨\">local end definition</a></code>, with the <code>value</code>\n      property set to the result of running the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring\">ToString</a> operation on\n      <var>value</var>.\n\n\n      </dd></dl>",
          "rationale": "switch",
          "steps": [
            {
              "html": "<p>Switch on the value of <var>value</var>:</p>\n          <dl>\n           <dt>NaN\n  \n           </dt><dd>Let <var>serialized</var> be <code>\"NaN\"</code>\n  \n           </dd><dt>-0\n  \n           </dt><dd>Let <var>serialized</var> be <code>\"-0\"</code>\n  \n           </dd><dt>Infinity\n  \n           </dt><dd>Let <var>serialized</var> be <code>\"Infinity\"</code>\n  \n           </dd><dt>-Infinity\n  \n           </dt><dd>Let <var>serialized</var> be <code>\"-Infinity\"</code>\n  \n           </dd><dt>Otherwise:\n  \n           </dt><dd>Let <var>serialized</var> be <var>value</var>\n\n          </dd></dl>"
            },
            {
              "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⑥\">map</a> matching the <code>script.NumberValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition④⑦\">local end definition</a></code>, with the <code>value</code>\n property set to <var>serialized</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>remote value</var></p>"
        }
      ]
    },
    {
      "name": "deserialize primitive protocol value",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-primitive-protocol-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-primitive-protocol-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize primitive protocol value</dfn> given a <var>primitive protocol value</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>type</var> be the value of the <code>type</code> field of <var>primitive protocol value</var>.</p>"
        },
        {
          "html": "<p>Let <var>value</var> be undefined.</p>"
        },
        {
          "html": "If <var>primitive protocol value</var> has field <code>value</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>value</var> be the value of the <code>value</code> field of <var>primitive protocol value</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set of steps for which\n the associated condition is true:</p>\n      <dl>\n       <dt><var>type</var> is the string \"<code>undefined</code>\"\n  \n       </dt><dd>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⓪\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-undefined-value\" id=\"ref-for-sec-undefined-value①\">undefined</a>.\n\n  \n       </dd><dt><var>type</var> is the string \"<code>null</code>\"\n  \n       </dt><dd>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧①\">success</a> with data <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-null-value\" id=\"ref-for-sec-null-value③\">null</a>.\n\n  \n       </dd><dt><var>type</var> is the string \"<code>string</code>\"\n  \n       </dt><dd>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧②\">success</a> with data <var>value</var>.\n\n  \n       </dd><dt><var>type</var> is the string \"<code>number</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>boolean</code>\"\n  \n       </dt><dd>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⑥\">success</a> with data <var>value</var>.\n\n  \n       </dd><dt><var>type</var> is the string \"<code>bigint</code>\"\n  \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values⑥\">Type</a>(<var>value</var>) is Number, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧③\">success</a> with data <var>value</var>.</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values⑦\">Type</a>(<var>value</var>) is String.</p>"
            },
            {
              "html": "<p>If <var>value</var> is the string \"<code>NaN</code>\", return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧④\">success</a> with\n data NaN.</p>"
            },
            {
              "html": "<p>Let <var>number_result</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-stringtonumber\" id=\"ref-for-sec-stringtonumber\">StringToNumber</a>(<var>value</var>).</p>"
            },
            {
              "html": "<p>If <var>number_result</var> is NaN, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⑥\">invalid argument</a></p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⑤\">success</a> with data <var>number_result</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>bigint_result</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-stringtobigint\" id=\"ref-for-sec-stringtobigint\">StringToBigInt</a>(<var>value</var>).</p>"
                },
                {
                  "html": "<p>If <var>bigint_result</var> is undefined, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⑦\">invalid argument</a></p>"
                },
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⑦\">success</a> with data <var>bigint_result</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⑧\">invalid argument</a></p>"
        }
      ]
    },
    {
      "name": "get the navigable",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-navigable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-navigable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the navigable</dfn> with given <var>realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>global object</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a> of the <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>global object</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unwrapped\" id=\"ref-for-unwrapped\">unwrapped</a> <var>global object</var>.</p>"
        },
        {
          "html": "<p>If <var>global object</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window⑧\">Window</a></code> object, return <code>null</code>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>global object</var>’s wrapped <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window⑨\">Window</a></code>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑤\">associated <code>Document</code></a>.</p>"
        },
        {
          "html": "<p>Return <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑤\">node navigable</a>.</p>"
        }
      ]
    },
    {
      "name": "get the worker’s owners",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-workers-owners",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-workers-owners\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the worker’s owners</dfn> with given <var>global object</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope\" id=\"ref-for-workerglobalscope①\">WorkerGlobalScope</a></code> object.</p>"
        },
        {
          "html": "<p>Let <var>owners</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③③\">list</a>.</p>"
        },
        {
          "html": "For each <var>owner</var> in the <var>global object</var>’s associated <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set\" id=\"ref-for-concept-WorkerGlobalScope-owner-set①\">owner set</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>owner environment settings</var> be <var>owner</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>.</p>"
            },
            {
              "html": "<p>Let <var>owner realm info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-realm-info\" id=\"ref-for-get-the-realm-info\">get the realm info</a> given\n  <var>owner environment settings</var>.</p>"
            },
            {
              "html": "<p>If <var>owner realm info</var> is null, continue.</p>"
            },
            {
              "html": "<p>Append <var>owner realm info</var>[\"<code>id</code>\"] to <var>owners</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>owners</var>.</p>"
        }
      ]
    },
    {
      "name": "get the realm info",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-realm-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-realm-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the realm info</dfn> given <var>environment settings</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context⑦\">realm execution context</a>’s Realm component.</p>"
        },
        {
          "html": "<p>Let <var>realm id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id③\">realm id</a> for <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>origin</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin\">serialization of an origin</a> given <var>environment settings</var>’s <var>origin</var>.</p>"
        },
        {
          "html": "<p>Let <var>global object</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global④\">global object</a> specified by <var>environment settings</var></p>"
        },
        {
          "html": "<p>Run the steps under the first matching condition:</p>\n      <dl>\n       <dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①⓪\">Window</a></code> object\n  \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webdriver-bidi/#sandboxwindowproxy\" id=\"ref-for-sandboxwindowproxy③\">SandboxWindowProxy</a></code> object\n  \n       </dt><dd>\n        \n    TODO: Unclear if this is the right formulation for handling sandboxes.\n\n\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#dedicatedworkerglobalscope\" id=\"ref-for-dedicatedworkerglobalscope\">DedicatedWorkerGlobalScope</a></code> object\n  \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#sharedworkerglobalscope\" id=\"ref-for-sharedworkerglobalscope\">SharedWorkerGlobalScope</a></code> object\n  \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope\" id=\"ref-for-serviceworkerglobalscope\">ServiceWorkerGlobalScope</a></code> object\n  \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope\" id=\"ref-for-workerglobalscope②\">WorkerGlobalScope</a></code> object\n \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://drafts.css-houdini.org/css-paint-api-1/#paintworkletglobalscope\" id=\"ref-for-paintworkletglobalscope\">PaintWorkletGlobalScope</a></code> object\n \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webaudio.github.io/web-audio-api/#AudioWorkletGlobalScope\" id=\"ref-for-AudioWorkletGlobalScope\">AudioWorkletGlobalScope</a></code> object\n \n       </dt><dd>\n        \n       </dd><dt><var>global object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope\" id=\"ref-for-workletglobalscope\">WorkletGlobalScope</a></code> object\n \n       </dt><dd>\n        \n       </dd><dt>Otherwise:\n \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>document</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑥\">associated <code>Document</code></a>.</p>"
            },
            {
              "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑥\">node navigable</a>.</p>"
            },
            {
              "html": "<p>If <var>navigable</var> is null, return null.</p>"
            },
            {
              "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②⓪\">navigable id</a> for <var>navigable</var>.</p>"
            },
            {
              "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦⑨\">map</a> matching the <code>script.WindowRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, the <code>origin</code>\n field set to <var>origin</var>, and the <code>context</code> field set to <var>navigable id</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "TODO: Unclear if this is the right formulation for handling sandboxes.",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>document</var> be <var>global object</var>’s wrapped <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①①\">Window</a></code>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑦\">associated <code>Document</code></a>.</p>"
                },
                {
                  "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑦\">node navigable</a>.</p>"
                },
                {
                  "html": "<p>If <var>navigable</var> is null, return null.</p>"
                },
                {
                  "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②①\">navigable id</a> for <var>navigable</var>.</p>"
                },
                {
                  "html": "<p>Let <var>sandbox name</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-sandbox-name\" id=\"ref-for-get-a-sandbox-name\">get a sandbox name</a> given\n <var>realm</var>.</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: <var>sandbox name</var> is not null.</p>"
                },
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⓪\">map</a> matching the <code>script.WindowRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, the <code>origin</code>\n field set to <var>origin</var>, the <code>context</code> field set to <var>navigable id</var>,\n and the <code>sandbox</code> field set to <var>sandbox name</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>owners</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-workers-owners\" id=\"ref-for-get-the-workers-owners\">get the worker’s owners</a> given <var>global object</var>.</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: <var>owners</var> has precisely one item.</p>"
                },
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧①\">map</a> matching the <code>script.DedicatedWorkerRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, the <code>origin</code> field\n set to <var>origin</var>, and the <code>owners</code> field set to <var>owners</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧②\">map</a> matching the <code>script.SharedWorkerRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code> field\n set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧③\">map</a> matching the <code>script.ServiceWorkerRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code> field\n set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧④\">map</a> matching the <code>script.WorkerRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code>\n field set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑤\">map</a> matching the <code>script.PaintWorkletRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code>\n field set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑥\">map</a> matching the <code>script.AudioWorkletRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code>\n field set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑦\">map</a> matching the <code>script.WorkletRealmInfo</code> production,\n with the <code>realm</code> field set to <var>realm id</var>, and the <code>origin</code>\n field set to <var>origin</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>realm info</var> be null.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>realm info</var></p>"
        }
      ]
    },
    {
      "name": "deserialize remote reference",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-remote-reference",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-remote-reference\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize remote reference</dfn> given <var>remote reference</var>, <var>realm</var> and\n<var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Assert <var>remote reference</var> matches the <code>script.RemoteReference</code> production.</p>"
        },
        {
          "html": "<p>If <var>remote reference</var> matches the <code>script.SharedReference</code> production, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-shared-reference\" id=\"ref-for-deserialize-shared-reference①\">deserialize shared reference</a> with <var>remote reference</var>, <var>realm</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-remote-object-reference\" id=\"ref-for-deserialize-remote-object-reference\">deserialize remote object reference</a> with <var>remote reference</var> and\n <var>realm</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize remote object reference",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-remote-object-reference",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-remote-object-reference\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize remote object reference</dfn> given <var>remote object reference</var> and\n<var>realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>handle id</var> be the value of the <code>handle</code> field of\n <var>remote object reference</var>.</p>"
        },
        {
          "html": "<p>Let <var>handle map</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#handle-object-map\" id=\"ref-for-handle-object-map②\">handle object map</a></p>"
        },
        {
          "html": "<p>If <var>handle map</var> does not contain <var>handle id</var>, then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⑦\">error</a> with\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-handle\" id=\"ref-for-errors-no-such-handle\">no such handle</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⑧\">success</a> with data <var>handle map</var>[<var>handle id</var>].</p>"
        }
      ]
    },
    {
      "name": "deserialize shared reference",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-shared-reference",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-shared-reference\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize shared reference</dfn> given <var>shared reference</var>, <var>realm</var> and\n<var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Assert <var>shared reference</var> matches the <code>script.SharedReference</code> production.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-navigable\" id=\"ref-for-get-the-navigable\">get the navigable</a> with <var>realm</var>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②③\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-node\" id=\"ref-for-errors-no-such-node\">no such node</a>.</p>"
        },
        {
          "html": "<p>Let <var>shared id</var> be the value of the <code>sharedId</code> field of\n <var>shared reference</var>.</p>"
        },
        {
          "html": "<p>Let <var>node</var> be result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-a-node\" id=\"ref-for-dfn-get-a-node\">get a node</a> with <var>session</var>,\n <var>navigable</var> and <var>shared id</var>.</p>"
        },
        {
          "html": "<p>If <var>node</var> is <code>null</code>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①②⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②④\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-node\" id=\"ref-for-errors-no-such-node①\">no such node</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①①\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context⑧\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>If <var>node</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document①\">node document</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document-origin\" id=\"ref-for-concept-document-origin\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin-domain\" id=\"ref-for-same-origin-domain\">same origin domain</a> with <var>environment settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin\">origin</a>\n then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⑤\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-node\" id=\"ref-for-errors-no-such-node②\">no such node</a>.</p>"
        },
        {
          "html": "<p>Let <var>realm global object</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑤\">global object</a> of the <var>realm</var>.</p>"
        },
        {
          "html": "<p>If the <var>realm global object</var> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webdriver-bidi/#sandboxwindowproxy\" id=\"ref-for-sandboxwindowproxy④\">SandboxWindowProxy</a></code> object, set\n <var>node</var> to the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webdriver-bidi/#sandboxproxy\" id=\"ref-for-sandboxproxy⑤\">SandboxProxy</a></code> wrapping <var>node</var> in the <var>realm</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑧⑨\">success</a> with data <var>node</var>.</p>"
        }
      ]
    },
    {
      "name": "handle for an object",
      "href": "https://w3c.github.io/webdriver-bidi/#handle-for-an-object",
      "html": "To get the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"handle-for-an-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle for an object</dfn> given <var>realm</var>, <var>ownership type</var> and\n<var>object</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>ownership type</var> is equal \"<code>none</code>\", return <code>null</code>.</p>"
        },
        {
          "html": "<p>Let <var>handle id</var> be a new, unique, string handle for <var>object</var>.</p>"
        },
        {
          "html": "<p>Let <var>handle map</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#handle-object-map\" id=\"ref-for-handle-object-map③\">handle object map</a></p>"
        },
        {
          "html": "<p>Set <var>handle map</var>[<var>handle id</var>] to <var>object</var>.</p>"
        },
        {
          "html": "<p>Return <var>handle id</var> as a result.</p>"
        }
      ]
    },
    {
      "name": "get shared id for a node",
      "href": "https://w3c.github.io/webdriver-bidi/#get-shared-id-for-a-node",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-shared-id-for-a-node\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get shared id for a node</dfn> given <var>node</var>, and <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>node</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#unwrapped\" id=\"ref-for-unwrapped①\">unwrapped</a> <var>node</var>.</p>"
        },
        {
          "html": "<p>If <var>node</var> does not implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#node\" id=\"ref-for-node\">Node</a></code>, return null.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be <var>node</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑧\">node navigable</a>.</p>"
        },
        {
          "html": "<p>If <var>navigable</var> is null, return null.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-or-create-a-node-reference\" id=\"ref-for-dfn-get-or-create-a-node-reference\">get or create a node reference</a> with <var>session</var>, <var>navigable</var> and\n <var>node</var>.</p>"
        }
      ]
    },
    {
      "name": "set internal ids if needed",
      "href": "https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"set-internal-ids-if-needed\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set internal ids if needed</dfn> given <var>serialization internal map</var>,\n<var>remote value</var> and <var>object</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If the <var>serialization internal map</var> does not contain <var>object</var>, set\n <var>serialization internal map</var>[<var>object</var>] to <var>remote value</var>.</p>"
        },
        {
          "html": "Otherwise, run the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>previously serialized remote value</var> be\n <var>serialization internal map</var>[<var>object</var>].</p>"
            },
            {
              "html": "If <var>previously serialized remote value</var> does not have a field\n <code>internalId</code>, run the following steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>internal id</var> be the string representation of a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>\n based on truly random, or pseudo-random numbers.</p>"
                },
                {
                  "html": "<p>Set the <code>internalId</code> field of\n  <var>previously serialized remote value</var> to <var>internal id</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set the <code>internalId</code> field of <var>remote value</var> to a field\n <code>internalId</code> in <var>previously serialized remote value</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "serialize as a remote value",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-as-a-remote-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize as a remote value</dfn> given <var>value</var>, <var>serialization options</var>,\nan <var>ownership type</var>, a <var>serialization internal map</var>, a <var>realm</var> and a <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>remote value</var> be a result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-primitive-protocol-value\" id=\"ref-for-serialize-primitive-protocol-value\">serialize primitive protocol value</a>\n given a <var>value</var>.</p>"
        },
        {
          "html": "<p>If <var>remote value</var> is not undefined, return <var>remote value</var>.</p>"
        },
        {
          "html": "<p>Let <var>handle id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#handle-for-an-object\" id=\"ref-for-handle-for-an-object\">handle for an object</a> with <var>realm</var>, <var>ownership type</var>\n and <var>value</var>.</p>"
        },
        {
          "html": "<p>Set <var>ownership type</var> to \"<code>none</code>\".</p>"
        },
        {
          "html": "<p>Let <var>known object</var> be <code>true</code>, if <var>value</var> is in the\n <var>serialization internal map</var>, otherwise <code>false</code>.</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set\n of steps for which the associated condition is true:</p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values⑧\">Type</a>(<var>value</var>) is Symbol\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑧\">map</a> matching the <code>script.SymbolRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤③\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-isarray\" id=\"ref-for-sec-isarray\">IsArray</a>(<var>value</var>)\n  \n       </dt><dd>Let <var>remote value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-array-like\" id=\"ref-for-serialize-an-array-like\">serialize an Array-like</a> with <var>session</var>,\n      <code>script.ArrayRemoteValue</code>, <var>handle id</var>, <var>known object</var>, <var>value</var>,\n      <var>serialization options</var>, <var>ownership type</var>, <var>serialization internal map</var>,\n      <var>realm</var>, and <var>session</var>.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-isregexp\" id=\"ref-for-sec-isregexp\">IsRegExp</a>(<var>value</var>)\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> has a [[DateValue]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots\">internal slot</a>.\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> has a [[MapData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①\">internal slot</a>\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> has a [[SetData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots②\">internal slot</a>\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> has a [[WeakMapData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots③\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨④\">map</a> matching the <code>script.WeakMapRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤⑨\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has a [[WeakSetData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots④\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⑤\">map</a> matching the <code>script.WeakSetRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⓪\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has a [[GeneratorState]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑤\">internal slot</a> or [[AsyncGeneratorState]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑥\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⑥\">map</a> matching the <code>script.GeneratorRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥①\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has an [[ErrorData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑦\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⑦\">map</a> matching the <code>script.ErrorRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥②\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has a [[ProxyHandler]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑧\">internal slot</a> and a [[ProxyTarget]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑨\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⑧\">map</a> matching the <code>script.ProxyRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥③\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ispromise\" id=\"ref-for-sec-ispromise\">IsPromise</a>(<var>value</var>)\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⑨\">map</a> matching the <code>script.PromiseRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥④\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has a [[TypedArrayName]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①⓪\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⓪\">map</a> matching the <code>script.TypedArrayRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⑤\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> has an [[ArrayBufferData]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①①\">internal slot</a>\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪①\">map</a> matching the <code>script.ArrayBufferRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⑥\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><var>value</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-platform-object\" id=\"ref-for-dfn-platform-object\">platform object</a> that implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#nodelist\" id=\"ref-for-nodelist\">NodeList</a></code>\n  \n       </dt><dd>Let <var>remote value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-array-like\" id=\"ref-for-serialize-an-array-like①\">serialize an Array-like</a> with\n      <code>script.NodeListRemoteValue</code>,<var>handle id</var>, <var>known object</var>, <var>value</var>,\n      <var>serialization options</var>, <var>ownership type</var>, <var>serialization internal map</var>,\n      <var>realm</var>, and <var>session</var>.\n\n  \n       </dd><dt><var>value</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-platform-object\" id=\"ref-for-dfn-platform-object①\">platform object</a> that implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#htmlcollection\" id=\"ref-for-htmlcollection\">HTMLCollection</a></code>\n  \n       </dt><dd>Let <var>remote value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-an-array-like\" id=\"ref-for-serialize-an-array-like②\">serialize an Array-like</a> with\n      <code>script.HTMLCollectionRemoteValue</code>, <var>handle id</var>, <var>known object</var>, <var>value</var>,\n      <var>serialization options</var>, <var>ownership type</var>, <var>known object</var>, <var>serialization internal map</var>,\n      <var>realm</var>, and <var>session</var>.\n\n  \n       </dd><dt><var>value</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-platform-object\" id=\"ref-for-dfn-platform-object②\">platform object</a> that implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#node\" id=\"ref-for-node①\">Node</a></code>\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-platform-object\" id=\"ref-for-dfn-platform-object③\">platform object</a> that implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#windowproxy\" id=\"ref-for-windowproxy\">WindowProxy</a></code>\n  \n       </dt><dd>\n        \n       </dd><dt><var>value</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-platform-object\" id=\"ref-for-dfn-platform-object④\">platform object</a>\n  \n       </dt><dd>1. Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⑦\">map</a> matching the <code>script.ObjectRemoteValue</code>\n         production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑦⓪\">local end definition</a></code>, with the <code>handle</code>\n         property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable①\">IsCallable</a>(<var>value</var>)\n  \n       </dt><dd>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⑧\">map</a> matching the <code>script.FunctionRemoteValue</code>\n      production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑦①\">local end definition</a></code>, with the <code>handle</code>\n      property set to <var>handle id</var> if it’s not null, or omitted otherwise.\n\n  \n       </dd><dt>Otherwise:\n  \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>pattern</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring①\">ToString</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p\">Get</a>(<var>value</var>, \"source\")).</p>"
            },
            {
              "html": "<p>Let <var>flags</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring②\">ToString</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p①\">Get</a>(<var>value</var>, \"flags\")).</p>"
            },
            {
              "html": "<p>Let <var>serialized</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧⑨\">map</a> matching the <code>script.RegExpValue</code> production in the\n <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤④\">local end definition</a></code>, with the <code>pattern</code> property set to the\n <var>pattern</var> and the the <code>flags</code> property set to the <var>flags</var>.</p>"
            },
            {
              "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨⓪\">map</a> matching the <code>script.RegExpRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤⑤\">local end definition</a></code>, with the <code>handle</code>\n property set to <var>handle id</var> if it’s not null, or omitted otherwise, and\n the <code>value</code> property set to <var>serialized</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>serialized</var> to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-call\" id=\"ref-for-sec-call①\">Call</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-date.prototype.toisostring\" id=\"ref-for-sec-date.prototype.toisostring\">Date.prototype.toISOString</a>, <var>value</var>).</p>"
                },
                {
                  "html": "<p class=\"assertion\">Assert: <var>serialized</var> is not a <a data-link-type=\"dfn\" data-refhint-key=\"e0e5fa1c\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type④\">throw completion</a>.</p>"
                },
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨①\">map</a> matching the <code>script.DateRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤⑥\">local end definition</a></code>, with the <code>handle</code>\n property set to <var>handle id</var> if it’s not null, or omitted otherwise, and the\n value set to <var>serialized</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨②\">map</a> matching the <code>script.MapRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤⑦\">local end definition</a></code>, with the\n <code>handle</code> property set to <var>handle id</var> if it’s not null, or omitted\n otherwise.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed\" id=\"ref-for-set-internal-ids-if-needed\">Set internal ids if needed</a> with <var>serialization internal map</var>,\n <var>remote value</var> and <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be null.</p>"
                },
                {
                  "html": "If <var>known object</var> is <code>false</code>, and <var>serialization\n options</var>[\"<code>maxObjectDepth</code>\"] is not 0, run the following\n steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-mapping\" id=\"ref-for-serialize-as-a-mapping\">serialize as a mapping</a> with\n  <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createmapiterator\" id=\"ref-for-sec-createmapiterator\">CreateMapIterator</a>(<var>value</var>, key+value), <var>serialization options</var>,\n  <var>ownership type</var>, <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>serialized</var> is not null, set field <code>value</code> of <var>remote value</var> to\n <var>serialized</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨③\">map</a> matching the <code>script.SetRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑤⑧\">local end definition</a></code>, with the\n <code>handle</code> property set to <var>handle id</var> if it’s not null, or omitted\n otherwise.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed\" id=\"ref-for-set-internal-ids-if-needed①\">Set internal ids if needed</a> with <var>serialization internal map</var>,\n <var>remote value</var> and <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be null.</p>"
                },
                {
                  "html": "If <var>known object</var> is <code>false</code>, and <var>serialization\n options</var>[\"<code>maxObjectDepth</code>\"] is not 0, run the following\n steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-list\" id=\"ref-for-serialize-as-a-list\">serialize as a list</a> with\n  <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createsetiterator\" id=\"ref-for-sec-createsetiterator\">CreateSetIterator</a>(<var>value</var>, value), <var>serialization options</var>,\n  <var>ownership type</var>, <var>serialization internal map</var>, <var>realm</var>, and\n  <var>session</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>serialized</var> is not null, set field <code>value</code> of <var>remote value</var> to\n <var>serialized</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>shared id</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-shared-id-for-a-node\" id=\"ref-for-get-shared-id-for-a-node\">get shared id for a node</a> with <var>value</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪②\">map</a> matching the <code>script.NodeRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⑦\">local end definition</a></code>, with the <code>sharedId</code>\n property set to <var>shared id</var> if it’s not null, or omitted otherwise, and the\n <code>handle</code> property set to <var>handle id</var> if it’s not null, or omitted\n otherwise.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed\" id=\"ref-for-set-internal-ids-if-needed②\">Set internal ids if needed</a> with <var>serialization internal map</var>,\n <var>remote value</var> and <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be null.</p>"
                },
                {
                  "html": "If <var>known object</var> is <code>false</code>, run the following steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>serialized</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪③\">map</a>.</p>"
                    },
                    {
                      "html": "<p>Set <var>serialized</var>[\"<code>nodeType</code>\"] to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p②\">Get</a>(<var>value</var>, \"nodeType\").</p>"
                    },
                    {
                      "html": "<p>Set <var>node value</var> to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p③\">Get</a>(<var>value</var>, \"nodeValue\").</p>"
                    },
                    {
                      "html": "<p>If <var>node value</var> is not null set\n <var>serialized</var>[\"<code>nodeValue</code>\"] to <var>node value</var>.</p>"
                    },
                    {
                      "html": "If <var>value</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element③\">Element</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#attr\" id=\"ref-for-attr\">Attr</a></code>:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>serialized</var>[\"<code>localName</code>\"] to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p④\">Get</a>(<var>value</var>, \"localName\").</p>"
                        },
                        {
                          "html": "<p>Set <var>serialized</var>[\"<code>namespaceURI</code>\"] to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-get-o-p\" id=\"ref-for-sec-get-o-p⑤\">Get</a>(<var>value</var>, \"namespaceURI\")</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>child node count</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⓪\">size</a> of <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\" id=\"ref-for-concept-tree-child③\">children</a>.</p>"
                    },
                    {
                      "html": "<p>Set <var>serialized</var>[\"<code>childNodeCount</code>\"] to <var>child node count</var>.</p>"
                    },
                    {
                      "html": "Otherwise, let <var>children</var> be an empty\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③④\">list</a> and, for each node <var>child</var> in the <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-child\" id=\"ref-for-concept-tree-child④\">children</a> of\n <var>value</var>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>child serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone\">clone</a> of\n <var>serialization options</var>.</p>"
                        },
                        {
                          "html": "<p>If <var>child serialization options</var>[\"<code>maxDomDepth</code>\"] is\n not null, set <var>child serialization\n options</var>[\"<code>maxDomDepth</code>\"] to <var>child serialization\n options</var>[\"<code>maxDomDepth</code>\"] - 1.</p>"
                        },
                        {
                          "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value③\">serialize as a remote value</a>\n with <var>child</var>, <var>child serialization options</var>, <var>ownership type</var>,\n <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
                        },
                        {
                          "html": "<p>Append <var>serialized</var> to <var>children</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>If <var>children</var> is not null, set <var>serialized</var>[\"<code>children</code>\"] to <var>children</var>.</p>"
                    },
                    {
                      "html": "If <var>value</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element④\">Element</a></code>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>attributes</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪④\">map</a>.</p>"
                        },
                        {
                          "html": "For each <var>attribute</var> in <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-attribute\" id=\"ref-for-concept-element-attribute\">attribute list</a>:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>name</var> be <var>attribute</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-attribute-qualified-name\" id=\"ref-for-concept-attribute-qualified-name\">qualified name</a></p>"
                            },
                            {
                              "html": "<p>Let <var>value</var> be <var>attribute</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-attribute-value\" id=\"ref-for-concept-attribute-value\">value</a>.</p>"
                            },
                            {
                              "html": "<p>Set <var>attributes</var>[<var>name</var>] to <var>value</var></p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Set <var>serialized</var>[\"<code>attributes</code>\"] to <var>attributes</var>.</p>"
                        },
                        {
                          "html": "<p>Let <var>shadow root</var> be <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element-shadow-root\" id=\"ref-for-concept-element-shadow-root\">shadow root</a>.</p>"
                        },
                        {
                          "html": "If <var>shadow root</var> is null, let <var>serialized shadow</var> be null.\n  Otherwise run the following substeps:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>serialized shadow</var> be the result of\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value④\">serialize as a remote value</a> with <var>shadow root</var>,\n  <var>serialization options</var>, <var>ownership type</var>, <var>serialization internal map</var>,\n  <var>realm</var>, and <var>session</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Set <var>serialized</var>[\"<code>shadowRoot</code>\"] to <var>serialized shadow</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>If <var>value</var> implements <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#shadowroot\" id=\"ref-for-shadowroot①\">ShadowRoot</a></code>, set <var>serialized</var>[\"<code>mode</code>\"]\n to <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#shadowroot-mode\" id=\"ref-for-shadowroot-mode①\">mode</a>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>serialized</var> is not null, set field <code>value</code> of <var>remote value</var> to\n <var>serialized</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>window</var> be the value of <var>value</var>’s [[WindowProxy]] <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①②\">internal slot</a>.</p>"
                },
                {
                  "html": "<p>Let <var>navigable</var> be <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable②\">navigable</a>.</p>"
                },
                {
                  "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②②\">navigable id</a> for <var>navigable</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⑤\">map</a> matching the\n <code>script.WindowProxyProperties</code> production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⑧\">local end definition</a></code> with the <code>context</code> property set to <var>navigable id</var>.</p>"
                },
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⑥\">map</a> matching the <code>script.WindowProxyRemoteValue</code>\n production in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑥⑨\">local end definition</a></code>, with the <code>handle</code>\n property set to <var>handle id</var> if it’s not null, or omitted otherwise, and\n the <code>value</code> property set to <var>serialized</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values⑨\">Type</a>(<var>value</var>) is Object</p>"
                },
                {
                  "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪⑨\">map</a> matching the <code>script.ObjectRemoteValue</code> production\n in the <code class=\"cddl\"><a data-link-type=\"cddl\" href=\"https://w3c.github.io/webdriver-bidi/#cddl-module-local-end-definition\" id=\"ref-for-cddl-module-local-end-definition⑦②\">local end definition</a></code>, with the <code>handle</code> property set\n to <var>handle id</var> if it’s not null, or omitted otherwise.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed\" id=\"ref-for-set-internal-ids-if-needed③\">Set internal ids if needed</a> with <var>serialization internal map</var>,\n <var>remote value</var> and <var>value</var>.</p>"
                },
                {
                  "html": "<p>Let <var>serialized</var> be null.</p>"
                },
                {
                  "html": "If <var>known object</var> is <code>false</code>, and <var>serialization\n options</var>[\"<code>maxObjectDepth</code>\"] is not 0, run the following\n steps:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-mapping\" id=\"ref-for-serialize-as-a-mapping①\">serialize as a mapping</a> with\n  <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-enumerableownpropertynames\" id=\"ref-for-sec-enumerableownpropertynames\">EnumerableOwnPropertyNames</a>(<var>value</var>, key+value), <var>serialization options</var>,\n  <var>ownership type</var>, <var>serialization internal map</var>,\n  <var>realm</var>, and <var>session</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>serialized</var> is not null, set field <code>value</code> of <var>remote value</var> to\n <var>serialized</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>remote value</var></p>"
        }
      ]
    },
    {
      "name": "serialize an Array-like",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-an-array-like",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-an-array-like\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize an Array-like</dfn> given <var>production</var>, <var>handle id</var>, <var>known object</var>,\n<var>value</var>, <var>serialization options</var>, <var>ownership type</var>, <var>serialization internal map</var>, <var>realm</var>,\nand <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>remote value</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⓪\">map</a> matching <var>production</var>, with the\n <code>handle</code> property set to <var>handle id</var> if it’s not null, or omitted\n otherwise.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-internal-ids-if-needed\" id=\"ref-for-set-internal-ids-if-needed④\">Set internal ids if needed</a> with <var>serialization internal map</var>,\n <var>remote value</var> and <var>value</var>.</p>"
        },
        {
          "html": "If <var>known object</var> is <code>false</code>, and <var>serialization\n options</var>[\"<code>maxObjectDepth</code>\"] is not 0:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>serialized</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-list\" id=\"ref-for-serialize-as-a-list①\">serialize as a list</a> with\n <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createarrayiterator\" id=\"ref-for-sec-createarrayiterator\">CreateArrayIterator</a>(<var>value</var>, value), <var>serialization options</var>, <var>ownership type</var>,\n <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
            },
            {
              "html": "<p>If <var>serialized</var> is not null, set field <code>value</code> of <var>remote value</var> to\n <var>serialized</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>remote value</var></p>"
        }
      ]
    },
    {
      "name": "serialize as a list",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-as-a-list",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-as-a-list\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize as a list</dfn> given <var>iterable</var>, <var>serialization options</var>, <var>ownership type</var>,\n<var>serialization internal map</var>, <var>realm</var>, and <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>serialization options</var>[\"<code>maxObjectDepth</code>\"] is not null,\n assert: <var>serialization options</var>[\"<code>maxObjectDepth</code>\"] is\n greater than 0.</p>"
        },
        {
          "html": "<p>Let <var>serialized</var> be a new list.</p>"
        },
        {
          "html": "For each <var>child value</var> in <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-iteratortolist\" id=\"ref-for-sec-iteratortolist\">IteratorToList</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-getiterator\" id=\"ref-for-sec-getiterator\">GetIterator</a>(<var>iterable</var>, sync)):",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>child serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone①\">clone</a> of\n <var>serialization options</var>.</p>"
            },
            {
              "html": "<p>If <var>child serialization options</var>[\"<code>maxObjectDepth</code>\"] is\n not null, set <var>child serialization\n options</var>[\"<code>maxObjectDepth</code>\"] to <var>child serialization\n options</var>[\"<code>maxObjectDepth</code>\"] - 1.</p>"
            },
            {
              "html": "<p>Let <var>serialized child</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value⑤\">serialize as a remote value</a>\n with <var>child value</var>, <var>child serialization options</var>, <var>ownership type</var>,\n <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
            },
            {
              "html": "<p>Append <var>serialized child</var> to <var>serialized</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>serialized</var></p>"
        }
      ]
    },
    {
      "name": "serialize as a mapping",
      "href": "https://w3c.github.io/webdriver-bidi/#serialize-as-a-mapping",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serialize-as-a-mapping\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize as a mapping</dfn> given <var>iterable</var>, <var>serialization options</var>,\n<var>ownership type</var>, <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>serialization options</var>[\"<code>maxObjectDepth</code>\"] is not null,\n assert: <var>serialization options</var>[\"<code>maxObjectDepth</code>\"] is\n greater than 0.</p>"
        },
        {
          "html": "<p>Let <var>serialized</var> be a new list.</p>"
        },
        {
          "html": "For <var>item</var> in <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-iteratortolist\" id=\"ref-for-sec-iteratortolist①\">IteratorToList</a>(<a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-getiterator\" id=\"ref-for-sec-getiterator①\">GetIterator</a>(<var>iterable</var>, sync)):",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-isarray\" id=\"ref-for-sec-isarray①\">IsArray</a>(<var>item</var>)</p>"
            },
            {
              "html": "<p>Let <var>property</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-createlistfromarraylike\" id=\"ref-for-sec-createlistfromarraylike\">CreateListFromArrayLike</a>(<var>item</var>)</p>"
            },
            {
              "html": "<p class=\"assertion\">Assert: <var>property</var> is a list of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①①\">size</a> 2</p>"
            },
            {
              "html": "<p>Let <var>key</var> be <var>property</var>[0] and let <var>value</var> be <var>property</var>[1]</p>"
            },
            {
              "html": "<p>Let <var>child serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-clone\" id=\"ref-for-map-clone②\">clone</a> of\n <var>serialization options</var>.</p>"
            },
            {
              "html": "<p>If <var>child serialization options</var>[\"<code>maxObjectDepth</code>\"] is\n not null, set <var>child serialization\n options</var>[\"<code>maxObjectDepth</code>\"] to <var>child serialization\n options</var>[\"<code>maxObjectDepth</code>\"] - 1.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values①⓪\">Type</a>(<var>key</var>) is String, let <var>serialized key</var> be <var>child key</var>,\n otherwise let <var>serialized key</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value⑥\">serialize as a remote value</a>\n with <var>child key</var>, <var>child serialization options</var>, <var>ownership type</var>,\n <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
            },
            {
              "html": "<p>Let <var>serialized value</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value⑦\">serialize as a remote value</a>\n with <var>value</var>, <var>child serialization options</var>, <var>ownership type</var>,\n <var>serialization internal map</var>, <var>realm</var>, and <var>session</var>.</p>"
            },
            {
              "html": "<p>Let <var>serialized child</var> be («<var>serialized key</var>, <var>serialized value</var>»).</p>"
            },
            {
              "html": "<p>Append <var>serialized child</var> to <var>serialized</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>serialized</var></p>"
        }
      ]
    },
    {
      "name": "construct a stack trace",
      "href": "https://w3c.github.io/webdriver-bidi/#construct-a-stack-trace",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"construct-a-stack-trace\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">construct a stack trace</dfn>, with a list of stack frames <var>stack</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>call frames</var> be a new list.</p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stack-frame\" id=\"ref-for-stack-frame\">stack frame</a> <var>frame</var> in <var>stack</var>,\n starting from the most recently executed frame, run the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>url</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑧\">URL serializer</a>, given\n  the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url\">URL</a> of <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stackframe-script-url\" id=\"ref-for-stackframe-script-url\">script url</a>.</p>"
            },
            {
              "html": "<p>Let <var>frame info</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①①\">map</a> matching the <code>script.StackFrame</code>\n  production, with the <code>url</code> field set to <var>url</var>, the\n  <code>functionName</code> field set to <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stackframe-function\" id=\"ref-for-stackframe-function\">function</a>,\n  the <code>lineNumber</code> field set to <var>frame</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stackframe-line-number\" id=\"ref-for-stackframe-line-number\">line number</a> and the <code>columnNumber</code> field set to <var>frame</var>’s\n  <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stackframe-column-number\" id=\"ref-for-stackframe-column-number\">column number</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Append <var>frame info</var> to <var>call frames</var>.</p>"
        },
        {
          "html": "<p>Let <var>stack trace</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①②\">map</a> matching the <code>script.StackTrace</code>\n production, with the <code>callFrames</code> property set to <var>call frames</var>.</p>"
        },
        {
          "html": "<p>Return <var>stack trace</var>.</p>"
        }
      ]
    },
    {
      "name": "stack trace for an exception",
      "href": "https://w3c.github.io/webdriver-bidi/#stack-trace-for-an-exception",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"stack-trace-for-an-exception\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">stack trace for an exception</dfn> with an exception, or a <a data-link-type=\"dfn\" data-refhint-key=\"c8a04a12\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑤\">Completion Record</a> of type <code>throw</code>, <var>exception</var>, is given by:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>exception</var> is a value that has been thrown as an exception, let <var>record</var>\n be the <a data-link-type=\"dfn\" data-refhint-key=\"c8a04a12\" href=\"https://tc39.es/ecma262/#sec-completion-record-specification-type\" id=\"ref-for-sec-completion-record-specification-type⑥\">Completion Record</a> created to throw <var>exception</var>. Otherwise let\n <var>record</var> be <var>exception</var>.</p>"
        },
        {
          "html": "<p>Let <var>stack</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#list-of-stack-frames\" id=\"ref-for-list-of-stack-frames①\">list of stack frames</a> corresponding to execution at the\n point <var>record</var> was created.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#construct-a-stack-trace\" id=\"ref-for-construct-a-stack-trace①\">construct a stack trace</a> given <var>stack</var>.</p>"
        }
      ]
    },
    {
      "name": "get the source",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-source",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-source\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the source</dfn> given <var>source realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id④\">realm id</a> for <var>source realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①②\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context⑨\">realm execution context</a>’s Realm component is <var>source realm</var>.</p>"
        },
        {
          "html": "If <var>environment settings</var> has a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑧\">associated <code>Document</code></a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>document</var> be environment settings’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window⑨\">associated <code>Document</code></a>.</p>"
            },
            {
              "html": "<p>Let <var>navigable</var> be <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable⑨\">node navigable</a>.</p>"
            },
            {
              "html": "<p>Let <var>navigable id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②③\">navigable id</a> for <var>navigable</var> if <var>navigable</var> is not null.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>source</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①③\">map</a> matching the\n <code>script.Source</code> production with the <code>realm</code>\n field set to <var>realm</var>, and the <code>context</code> field set\n to <var>navigable id</var> if <var>navigable</var> is not null, or unset otherwise.</p>"
        },
        {
          "html": "<p>Return <var>source</var>.</p>"
        }
      ]
    },
    {
      "name": "get a realm from a navigable",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-navigable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-realm-from-a-navigable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a realm from a navigable</dfn> given <var>navigable id</var> and <var>sandbox</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⑦\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "If <var>sandbox</var> is null or is an empty string:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⑦\">active document</a>.</p>"
            },
            {
              "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①③\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①⓪\">associated <code>Document</code></a> is\n <var>document</var>.</p>"
            },
            {
              "html": "<p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①⓪\">realm execution context</a>’s\n Realm component.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise: let <var>realm</var> be result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⑤\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-or-create-a-sandbox-realm\" id=\"ref-for-get-or-create-a-sandbox-realm①\">get or create a sandbox realm</a> given <var>sandbox</var> and\n <var>navigable</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⓪\">success</a> with data <var>realm</var></p>"
        }
      ]
    },
    {
      "name": "get a realm from a target",
      "href": "https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-target",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-a-realm-from-a-target\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a realm from a target</dfn> given <var>target</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>target</var> matches the <code>script.ContextTarget</code> production:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>sandbox</var> be null.</p>"
            },
            {
              "html": "<p>If <var>target</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⓪\">contains</a> \"<code>sandbox</code>\", set <var>sandbox</var> to\n <var>target</var>[\"<code>sandbox</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-navigable\" id=\"ref-for-get-a-realm-from-a-navigable①\">get a realm from a navigable</a> with\n <var>target</var>[\"<code>context</code>\"] and <var>sandbox</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <var>target</var> matches the <code>script.RealmTarget</code> production.</p>"
            },
            {
              "html": "<p>Let <var>realm id</var> be the value of the <code>realm</code> field of <var>target</var>.</p>"
            },
            {
              "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm\" id=\"ref-for-get-a-realm\">get a realm</a> given <var>realm id</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨①\">success</a> with data <var>realm</var></p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.addPreloadScript",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⑦\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②①\">contains</a> \"<code>userContexts</code>\"\n and <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②②\">contains</a> \"<code>contexts</code>\",\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>function declaration</var> be the <code>functionDeclaration</code> field of <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>arguments</var> be the <code>arguments</code> field of <var>command\n parameters</var> if present, or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑤\">list</a> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>user contexts</var> to be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥①\">set</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigables</var> be null.</p>"
        },
        {
          "html": "If the <code>contexts</code> field of <var>command parameters</var> is present:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>navigables</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥②\">set</a>.</p>"
            },
            {
              "html": "For each <var>navigable id</var> of <var>command parameters</var>[\"<code>contexts</code>\"]",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⑧\">get a navigable</a> with <var>navigable id</var>.</p>"
                },
                {
                  "html": "<p>If <var>navigable</var> is not a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-traversable\" id=\"ref-for-top-level-traversable④⑨\">top-level traversable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⑦\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑦⓪\">invalid argument</a>.</p>"
                },
                {
                  "html": "<p>Append <var>navigable</var> to <var>navigables</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Otherwise, if <var>command parameters</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②③\">contains</a> <code>userContexts</code>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>user contexts</var> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-create\" id=\"ref-for-set-create⑥\">create a set</a> with <var>command parameters</var>[\"<code>userContexts</code>\"].</p>"
            },
            {
              "html": "For each <var>user context id</var> of <var>user contexts</var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>user context</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-user-context\" id=\"ref-for-get-user-context⑥\">get user context</a> with <var>user context id</var>.</p>"
                },
                {
                  "html": "<p>If <var>user context</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-user-context\" id=\"ref-for-errors-no-such-user-context④\">no such user context</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>sandbox</var> be the value of the \"<code>sandbox</code>\" field in <var>command\n parameters</var>, if present, or null otherwise.</p>"
        },
        {
          "html": "<p>Let <var>script</var> be the string representation of a <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webdriver-bidi/#biblio-rfc9562\" title=\"Universally Unique IDentifiers (UUIDs)\">UUID</a>.</p>"
        },
        {
          "html": "<p>Let <var>preload script map</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#preload-script-map\" id=\"ref-for-preload-script-map①\">preload script map</a>.</p>"
        },
        {
          "html": "<p>Set <var>preload script map</var>[<var>script</var>] to a struct with\n <code>function declaration</code> <var>function declaration</var>,\n <code>arguments</code> <var>arguments</var>,\n <code>contexts</code> <var>navigables</var>,\n <code>sandbox</code> <var>sandbox</var>, and\n <code>user contexts</code> <var>user contexts</var>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①④\">map</a> matching the <code>script.AddPreloadScriptResult</code> with the\n <code>script</code> field set to <var>script</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.disown",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⑧\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-target\" id=\"ref-for-get-a-realm-from-a-target\">get a realm from a target</a>\n given the value of the <code>target</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>handles</var> the value of the <code>handles</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "For each <var>handle id</var> of <var>handles</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>handle map</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#handle-object-map\" id=\"ref-for-handle-object-map④\">handle object map</a></p>"
            },
            {
              "html": "<p>If <var>handle map</var> contains <var>handle id</var>, remove <var>handle id</var> from the <var>handle map</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨②\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "deserialize arguments",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-arguments",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-arguments\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize arguments</dfn> with given <var>realm</var>, <var>serialized arguments list</var>\nand <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deserialized arguments list</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑥\">list</a>.</p>"
        },
        {
          "html": "For each <var>serialized argument</var> of <var>serialized arguments list</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deserialized argument</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-local-value\" id=\"ref-for-deserialize-local-value③\">deserialize local value</a>\n given <var>serialized argument</var>, <var>realm</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Append <var>deserialized argument</var> to the <var>deserialized arguments list</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨③\">success</a> with data <var>deserialized arguments list</var>.</p>"
        }
      ]
    },
    {
      "name": "evaluate function body",
      "href": "https://w3c.github.io/webdriver-bidi/#evaluate-function-body",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"evaluate-function-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">evaluate function body</dfn> given <var>function declaration</var>,\n<var>environment settings</var>, <var>base URL</var>, and <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>bypassDisabledScripting</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>parenthesized function declaration</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-concatenate\" id=\"ref-for-string-concatenate\">concatenate</a>\n «\"<code>(</code>\", <var>function declaration</var>, \"<code>)</code>\"»</p>"
        },
        {
          "html": "<p>Let <var>function script</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#creating-a-classic-script\" id=\"ref-for-creating-a-classic-script\">create a classic script</a> with\n <var>parenthesized function declaration</var>, <var>environment settings</var>, <var>base URL</var>,\n <var>options</var> and <var>bypassDisabledScripting</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-script\" id=\"ref-for-prepare-to-run-script①\">Prepare to run script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Let <var>function body evaluation status</var> be <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation\" id=\"ref-for-sec-runtime-semantics-scriptevaluation\">ScriptEvaluation</a>(<var>function script</var>’s record).</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#clean-up-after-running-script\" id=\"ref-for-clean-up-after-running-script①\">Clean up after running script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Return (<var>function script</var>, <var>function body evaluation status</var>).</p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.callFunction",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④⑨\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑦⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-target\" id=\"ref-for-get-a-realm-from-a-target①\">get a realm from a target</a>\n given the value of the <code>target</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>realm id</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id⑤\">realm id</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①④\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①①\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>command arguments</var> be the value of the <code>arguments</code> field\n of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>deserialized arguments</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑦\">list</a>.</p>"
        },
        {
          "html": "<p>If <var>command arguments</var> is not null, set <var>deserialized arguments</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⓪\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-arguments\" id=\"ref-for-deserialize-arguments\">deserialize arguments</a> given <var>realm</var>, <var>command arguments</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Let <var>this parameter</var> be the value of the <code>this</code> field\n of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>this object</var> be null.</p>"
        },
        {
          "html": "<p>If <var>this parameter</var> is not null, set <var>this object</var> to the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧①\">trying</a> to\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-local-value\" id=\"ref-for-deserialize-local-value④\">deserialize local value</a> given <var>this parameter</var>, <var>realm</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Let <var>function declaration</var> be the value of the\n <code>functionDeclaration</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>await promise</var> be the value of the <code>awaitPromise</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>serialization options</var> be the value of the\n <code>serializationOptions</code> field of <var>command parameters</var>, if present,\n or otherwise a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⑤\">map</a> matching the <code>script.SerializationOptions</code>\n production with the fields set to their default values.</p>"
        },
        {
          "html": "<p>Let <var>result ownership</var> be the value of the <code>resultOwnership</code> field of\n <var>command parameters</var>, if present, or <code>none</code> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>base URL</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url\" id=\"ref-for-api-base-url①\">API base URL</a> of <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Let <var>options</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#default-script-fetch-options\" id=\"ref-for-default-script-fetch-options①\">default script fetch options</a>.</p>"
        },
        {
          "html": "<p>Let (<var>script</var>, <var>function body evaluation status</var>) be the\n result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#evaluate-function-body\" id=\"ref-for-evaluate-function-body①\">evaluate function body</a> with <var>function declaration</var>,\n <var>environment settings</var>, <var>base URL</var>, and <var>options</var>.</p>"
        },
        {
          "html": "If <var>function body evaluation status</var>.[[Type]] is <code>throw</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>exception details</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-exception-details\" id=\"ref-for-get-exception-details\">get exception details</a> given\n  <var>realm</var>, <var>function body evaluation status</var>, <var>result ownership</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⑥\">map</a> matching the <code>script.EvaluateResultException</code>\n  production, with the <code>exceptionDetails</code> field set to\n  <var>exception details</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>function object</var> be <var>function body evaluation status</var>.[[Value]].</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-iscallable\" id=\"ref-for-sec-iscallable②\">IsCallable</a>(<var>function object</var>) is <code>false</code>:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③④\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑦①\">invalid argument</a></p>"
            }
          ]
        },
        {
          "html": "<p>If <var>command parameters</var>[\"<code>userActivation</code>\"] is true, run <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification\" id=\"ref-for-activation-notification\">activation notification</a> steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-script\" id=\"ref-for-prepare-to-run-script②\">Prepare to run script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Set <var>evaluation status</var> to\n <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-call\" id=\"ref-for-sec-call②\">Call</a>(<var>function object</var>, <var>this object</var>, <var>deserialized arguments</var>).</p>"
        },
        {
          "html": "If <var>evaluation status</var>.[[Type]] is <code>normal</code>, and <var>await promise</var> is\n <code>true</code>, and <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ispromise\" id=\"ref-for-sec-ispromise①\">IsPromise</a>(<var>evaluation status</var>.[[Value]]):",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>evaluation status</var> to\n  <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#await\" id=\"ref-for-await\">Await</a>(<var>evaluation status</var>.[[Value]]).</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#clean-up-after-running-script\" id=\"ref-for-clean-up-after-running-script②\">Clean up after running script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "If <var>evaluation status</var>.[[Type]] is <code>throw</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>exception details</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-exception-details\" id=\"ref-for-get-exception-details①\">get exception details</a> given\n <var>realm</var>, <var>evaluation status</var>, <var>result ownership</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⑦\">map</a> matching the <code>script.EvaluateResultException</code>\n production, with the <code>exceptionDetails</code> field set to\n <var>exception details</var>.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>evaluation status</var>.[[Type]] is <code>normal</code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value⑧\">serialize as a remote value</a> with\n <var>evaluation status</var>.[[Value]], <var>serialization options</var>, <var>result ownership</var>,\n a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⑧\">map</a> as serialization internal map, <var>realm</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①⑨\">map</a> matching the <code>script.EvaluateResultSuccess</code>\n production, with the <code>realm</code> field set to <var>realm id</var>,\n and the <code>result</code> field set to <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.evaluate",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⓪\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-realm-from-a-target\" id=\"ref-for-get-a-realm-from-a-target②\">get a realm from a target</a>\n given the value of the <code>target</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>realm id</var> be <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id⑥\">realm id</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⑤\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①②\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>source</var> be the value of the <code>expression</code> field of <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>await promise</var> be the value of the <code>awaitPromise</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>serialization options</var> be the value of the\n <code>serializationOptions</code> field of <var>command parameters</var>, if present,\n or otherwise a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⓪\">map</a> matching the <code>script.SerializationOptions</code>\n production with the fields set to their default values.</p>"
        },
        {
          "html": "<p>Let <var>result ownership</var> be the value of the <code>resultOwnership</code> field of\n <var>command parameters</var>, if present, or <code>none</code> otherwise.</p>"
        },
        {
          "html": "<p>Let <var>options</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#default-script-fetch-options\" id=\"ref-for-default-script-fetch-options②\">default script fetch options</a>.</p>"
        },
        {
          "html": "<p>Let <var>base URL</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url\" id=\"ref-for-api-base-url②\">API base URL</a> of <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Let <var>bypassDisabledScripting</var> be true.</p>"
        },
        {
          "html": "<p>Let <var>script</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#creating-a-classic-script\" id=\"ref-for-creating-a-classic-script①\">create a classic script</a> with <var>source</var>,\n <var>environment settings</var>, <var>base URL</var>, <var>options</var> and <var>bypassDisabledScripting</var>.</p>"
        },
        {
          "html": "<p>If <var>command parameters</var>[\"<code>userActivation</code>\"] is true, run <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#activation-notification\" id=\"ref-for-activation-notification①\">activation notification</a> steps.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-script\" id=\"ref-for-prepare-to-run-script③\">Prepare to run script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Set <var>evaluation status</var> to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation\" id=\"ref-for-sec-runtime-semantics-scriptevaluation①\">ScriptEvaluation</a>(<var>script</var>’s record).</p>"
        },
        {
          "html": "If <var>evaluation status</var>.[[Type]] is <code>normal</code>, <var>await promise</var> is\n true, and <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ispromise\" id=\"ref-for-sec-ispromise②\">IsPromise</a>(<var>evaluation status</var>.[[Value]]):",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>evaluation status</var> to <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#await\" id=\"ref-for-await①\">Await</a>(<var>evaluation status</var>.[[Value]]).</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#clean-up-after-running-script\" id=\"ref-for-clean-up-after-running-script③\">Clean up after running script</a> with <var>environment settings</var>.</p>"
        },
        {
          "html": "If <var>evaluation status</var>.[[Type]] is <code>throw</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>exception details</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-exception-details\" id=\"ref-for-get-exception-details②\">get exception details</a> with\n <var>realm</var>, <var>evaluation status</var>, <var>result ownership</var> and <var>session</var>.</p>"
            },
            {
              "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②①\">map</a> matching the <code>script.EvaluateResultException</code>\n production, with the <code>realm</code> field set to <var>realm id</var>, and the\n <code>exceptionDetails</code> field set to <var>exception details</var>.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: <var>evaluation status</var>.[[Type]] is <code>normal</code>.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value⑨\">serialize as a remote value</a> with\n <var>evaluation status</var>.[[Value]], <var>serialization options</var>, <var>result ownership</var>,\n a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②②\">map</a> as serialization internal map, <var>realm</var> and <var>session</var>.</p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②③\">map</a> matching the <code>script.EvaluateResultSuccess</code>\n production, with the with the <code>realm</code> field set to <var>realm id</var>, and\n the <code>result</code> field set to <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.getRealms",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤①\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>environment settings</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑧\">list</a> of all the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⑥\">environment settings objects</a>\n that have their <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag\" id=\"ref-for-concept-environment-execution-ready-flag\">execution ready flag</a> set.</p>"
        },
        {
          "html": "If <var>command parameters</var> contains <code>context</code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧③\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable①⑨\">get a navigable</a>\n with <var>command parameters</var>[\"<code>context</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document①⑨\">active document</a>.</p>"
            },
            {
              "html": "<p>Let <var>navigable environment settings</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③⑨\">list</a>.</p>"
            },
            {
              "html": "For each <var>settings</var> of <var>environment settings</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If any of the following conditions hold:</p>\n          <ul>\n           <li data-md=\"\">\n            <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①①\">associated <code>Document</code></a> of <var>settings</var>’\n<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a> is <var>document</var></p>\n           </li><li data-md=\"\">\n            <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global⑥\">global object</a> specified by <var>settings</var> is a\n<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope\" id=\"ref-for-workerglobalscope④\">WorkerGlobalScope</a></code> with <var>document</var> in its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set\" id=\"ref-for-concept-WorkerGlobalScope-owner-set②\">owner set</a></p>\n          </li></ul>\n          <p>Append <var>settings</var> to <var>navigable environment settings</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>environment settings</var> to <var>navigable environment settings</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>realms</var> be a list.</p>"
        },
        {
          "html": "For each <var>settings</var> of <var>environment settings</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>realm info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-realm-info\" id=\"ref-for-get-the-realm-info①\">get the realm info</a> given <var>settings</var>.</p>"
            },
            {
              "html": "<p>If <var>command parameters</var> contains <code>type</code> and <var>realm\n info</var>[\"<code>type</code>\"] is not equal to <var>command\n parameters</var>[\"<code>type</code>\"] then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>realm info</var> is not null, append <var>realm info</var> to <var>realms</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②④\">map</a> matching the <code>script.GetRealmsResult</code> production,\n with the <code>realms</code> field set to <var>realms</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨④\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for script.removePreloadScript",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤②\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>script</var> be the value of the \"<code>script</code>\" field in <var>command\n parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>preload script map</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#preload-script-map\" id=\"ref-for-preload-script-map②\">preload script map</a>.</p>"
        },
        {
          "html": "<p>If <var>preload script map</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②④\">contain</a> <var>script</var>, return\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-script\" id=\"ref-for-errors-no-such-script\">no such script</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑥\">Remove</a> <var>script</var> from <var>preload script map</var>.</p>"
        },
        {
          "html": "<p>Return null</p>"
        }
      ]
    },
    {
      "name": "remote end event trigger for script.message",
      "href": "https://w3c.github.io/webdriver-bidi/#emit-a-script-message",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger②①\">remote end event trigger</a> is the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"emit-a-script-message\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">emit a script message</dfn> steps,\ngiven <var>session</var>, <var>realm</var>, <var>channel properties</var>, and <var>message</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⑦\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①③\">realm execution context</a>’s Realm component is <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables⑨\">get related navigables</a> given <var>environment settings</var>.</p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-is-enabled\" id=\"ref-for-event-is-enabled①\">event is enabled</a> given <var>session</var>, \"<code>script.message</code>\"\n and <var>related navigables</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>channel properties</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑤\">contains</a>\n \"<code>serializationOptions</code>\", let <var>serialization options</var> be the\n value of the <code>serializationOptions</code> field of <var>channel\n properties</var>. Otherwise let <var>serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⑤\">map</a>\n matching the <code>script.SerializationOptions</code> production with the\n fields set to their default values.</p>"
            },
            {
              "html": "<p>Let if <var>channel properties</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑥\">contains</a> \"<code>ownership</code>\", let\n <var>ownership type</var> be <var>channel properties</var>[\"<code>ownership</code>\"]. Otherwise let\n <var>ownership type</var> be \"<code>none</code>\".</p>"
            },
            {
              "html": "<p>Let <var>data</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value①⓪\">serialize as a remote value</a> given\n <var>message</var>, <var>serialization options</var>, <var>ownership type</var>, a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⑥\">map</a> as serialization\n internal map and <var>realm</var>.</p>"
            },
            {
              "html": "<p>Let <var>source</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-source\" id=\"ref-for-get-the-source\">get the source</a> with <var>realm</var>.</p>"
            },
            {
              "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⑦\">map</a> matching the\n <code>script.MessageParameters</code> production, with the\n <code>channel</code> field set to <var>channel properties</var>[\"<code>channel</code>\"],\n the <code>data</code> field set to <var>data</var>, and the <code>source</code>\n field set to <var>source</var>.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⑧\">map</a> matching the <code>script.Message</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②⓪\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for script.realmCreated",
      "html": "When any of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#set-up-a-window-environment-settings-object\" id=\"ref-for-set-up-a-window-environment-settings-object\">set up a window environment settings object</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/workers.html#set-up-a-worker-environment-settings-object\" id=\"ref-for-set-up-a-worker-environment-settings-object\">set up a worker environment settings object</a> or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/worklets.html#set-up-a-worklet-environment-settings-object\" id=\"ref-for-set-up-a-worklet-environment-settings-object\">set up a worklet environment settings object</a> algorithms are invoked, immediately prior to returning the settings\nobject:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>environment settings</var> be the newly created <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⑧\">environment settings object</a>.</p>"
        },
        {
          "html": "<p>Let <var>realm info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-realm-info\" id=\"ref-for-get-the-realm-info②\">get the realm info</a> given\n <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>If <var>realm info</var> is null, return.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables①⓪\">get related navigables</a> given <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①②⑨\">map</a> matching the <code>script.RealmCreated</code>\n production, with the <code>params</code> field set to <var>realm info</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled②⓪\">set of sessions for which an event is enabled</a>\n given \"<code>script.realmCreated</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②①\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end subscribe steps for script.realmCreated",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-subscribe-steps\" id=\"ref-for-event-remote-end-subscribe-steps③\">remote end subscribe steps</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscribe-priority\" id=\"ref-for-event-subscribe-priority②\">subscribe priority</a> 2, given\n<var>session</var>, <var>navigables</var> and <var>include global</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>environment settings</var> be a list of all the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①⑨\">environment settings objects</a>\n that have their <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-execution-ready-flag\" id=\"ref-for-concept-environment-execution-ready-flag①\">execution ready flag</a> set.</p>"
        },
        {
          "html": "For each <var>settings</var> of <var>environment settings</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>related navigables</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥③\">set</a>.</p>"
            },
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①②\">associated <code>Document</code></a> of <var>settings</var>’\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a> is a <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-document\" id=\"ref-for-concept-document④\">Document</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>navigable</var> be <var>settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a>’s\n  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①③\">associated <code>Document</code></a>’s\n  <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#node-navigable\" id=\"ref-for-node-navigable①⓪\">node navigable</a>.</p>"
                },
                {
                  "html": "<p>If <var>navigable</var> is null, continue.</p>"
                },
                {
                  "html": "<p>Let <var>top-level traversible</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⑧\">top-level traversable</a>.</p>"
                },
                {
                  "html": "<p>If <var>top-level traversible</var> is not in <var>navigables</var>, continue.</p>"
                },
                {
                  "html": "<p>Append <var>top-level traversible</var> to <var>related navigables</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>realm info</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-realm-info\" id=\"ref-for-get-the-realm-info③\">get the realm info</a> given <var>settings</var>.</p>"
            },
            {
              "html": "<p>If <var>realm info</var> is null, continue.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③⓪\">map</a> matching the <code>script.RealmCreated</code>\n production, with the <code>params</code> field set to <var>realm info</var>.</p>"
            },
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-is-enabled\" id=\"ref-for-event-is-enabled②\">event is enabled</a> given <var>session</var>,\n \"<code>script.realmCreated</code>\" and <var>related navigables</var>:",
              "rationale": "emit",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②②\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for script.realmDestroyed",
      "html": "Define the following <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-lifecycle.html#unloading-document-cleanup-steps\" id=\"ref-for-unloading-document-cleanup-steps\">unloading document cleanup steps</a> with <var>document</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>related navigables</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥④\">set</a>.</p>"
        },
        {
          "html": "<p>Append <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables④②\">navigable</a> to <var>related navigables</var>.</p>"
        },
        {
          "html": "For each <var>worklet global scope</var> in <var>document</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/worklets.html#concept-document-worklet-global-scopes\" id=\"ref-for-concept-document-worklet-global-scopes\">worklet global scopes</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>realm</var> be <var>worklet global scope</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant Realm</a>.</p>"
            },
            {
              "html": "<p>Let <var>realm id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id⑦\">realm id</a> for <var>realm</var>.</p>"
            },
            {
              "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③①\">map</a> matching the <code>script.RealmDestroyedParameters</code>\n production, with the <code>realm</code> field set of <var>realm id</var>.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③②\">map</a> matching the <code>script.RealmDestroyed</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled②①\">set of sessions for which an event is enabled</a>\n given \"<code>script.realmDestroyed</code>\" and <var>related navigables</var>:",
              "rationale": "emit",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②③\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object②⓪\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①④\">associated <code>Document</code></a> is\n <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①④\">realm execution context</a>’s Realm component.</p>"
        },
        {
          "html": "<p>Let <var>realm id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id⑧\">realm id</a> for <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③③\">map</a> matching the\n <code>script.RealmDestroyedParameters</code> production, with the\n <code>realm</code> field set to <var>realm id</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③④\">map</a> matching the <code>script.RealmDestroyed</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled②②\">set of sessions for which an event is enabled</a>\n given \"<code>script.realmDestroyed</code>\" and <var>related navigables</var>:",
          "rationale": "emit",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②④\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for script.realmDestroyed",
      "html": "Whenever a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#worker-event-loop-2\" id=\"ref-for-worker-event-loop-2\">worker event loop</a> <var>event loop</var> is destroyed, either because the\nworker comes to the end of its lifecycle, or prematurely via the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/workers.html#terminate-a-worker\" id=\"ref-for-terminate-a-worker\">terminate a worker</a> algorithm:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object②①\">environment settings object</a> for which\n <var>event loop</var> is the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop\" id=\"ref-for-responsible-event-loop\">responsible event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables①①\">get related navigables</a> given <var>environment settings</var>.</p>"
        },
        {
          "html": "<p>Let <var>realm</var> be <var>environment settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object's-realm\" id=\"ref-for-environment-settings-object's-realm\">environment settings object’s Realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>realm id</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id⑨\">realm id</a> for <var>realm</var>.</p>"
        },
        {
          "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③⑤\">map</a> matching the <code>script.RealmDestroyedParameters</code>\n production, with the <code>realm</code> field set of <var>realm id</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③⑥\">map</a> matching the <code>script.RealmDestroyed</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
        }
      ]
    },
    {
      "name": "deserialize filter",
      "href": "https://w3c.github.io/webdriver-bidi/#deserialize-filter",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"deserialize-filter\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize filter</dfn> given <var>filter</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>deserialized filter</var> to be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①③⑨\">map</a>.</p>"
        },
        {
          "html": "For each <var>name</var> → <var>value</var> in <var>filter</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>deserialized name</var> be the field name corresponding to the JSON key <var>name</var> in\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-table-for-cookie-conversion\" id=\"ref-for-dfn-table-for-cookie-conversion\">table for cookie conversion</a>.</p>"
            },
            {
              "html": "<p>If <var>name</var> is \"<code>value</code>\", set <var>deserialized value</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes⑤\">deserialize protocol bytes</a> with <var>value</var>,\n otherwise let <var>deserialized value</var> be <var>value</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②①\">Set</a> <var>deserialized filter</var>[<var>deserialized name</var>] to <var>deserialized value</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>deserialized filter</var>.</p>"
        }
      ]
    },
    {
      "name": "expand a storage partition spec",
      "href": "https://w3c.github.io/webdriver-bidi/#expand-a-storage-partition-spec",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"expand-a-storage-partition-spec\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">expand a storage partition spec</dfn> given <var>partition spec</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>partition spec</var> is null:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>partition spec</var> to an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④⓪\">map</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise, if <var>partition spec</var>[\"<code>type</code>\"] is \"<code>context</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②⓪\">get a navigable</a> given <var>partition spec</var>[\"<code>context</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>partition key</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#storage-partition-key\" id=\"ref-for-storage-partition-key③\">key</a> of <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#associated-storage-partition\" id=\"ref-for-associated-storage-partition\">associated storage partition</a>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⑤\">success</a> with data <var>partition key</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>partition key</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④①\">map</a>.</p>"
        },
        {
          "html": "For each <var>name</var> → <var>default value</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#default-values-for-storage-partition-key-attributes\" id=\"ref-for-default-values-for-storage-partition-key-attributes①\">default values for storage partition key attributes</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>value</var> be <var>partition spec</var>[<var>name</var>] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑦\">exists</a> or <var>default value</var> otherwise.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②②\">Set</a> <var>partition key</var>[<var>name</var>] to <var>value</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>name</var> in the remote end’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#required-partition-key-attributes\" id=\"ref-for-required-partition-key-attributes\">required partition key attributes</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>partition spec</var>[<var>name</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑧\">exists</a>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②③\">Set</a> <var>partition key</var>][<var>name</var>] to <var>partition spec</var>[<var>name</var>].</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⑥\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-underspecified-storage-partition\" id=\"ref-for-errors-underspecified-storage-partition\">underspecified storage partition</a>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⑥\">success</a> with data <var>partition key</var>.</p>"
        }
      ]
    },
    {
      "name": "get the cookie store",
      "href": "https://w3c.github.io/webdriver-bidi/#get-the-cookie-store",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-the-cookie-store\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the cookie store</dfn> given <var>storage partition key</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>storage partition key</var> uniquely identifies an extant <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#storage-partition\" id=\"ref-for-storage-partition③\">storage partition</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>store</var> be the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc6265.html#storage-model\" id=\"ref-for-storage-model①\">cookie store</a> of that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#storage-partition\" id=\"ref-for-storage-partition④\">storage partition</a>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⑦\">success</a> with data <var>store</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-storage-partition\" id=\"ref-for-errors-no-such-storage-partition\">no such storage partition</a>.</p>"
        }
      ]
    },
    {
      "name": "match cookie",
      "href": "https://w3c.github.io/webdriver-bidi/#match-cookie",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"match-cookie\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">match cookie</dfn> given <var>stored cookie</var> and <var>filter</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>name</var> → <var>value</var> in <var>filter</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>stored cookie</var>[<var>name</var>] does not equal <var>value</var>:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "get matching cookies",
      "href": "https://w3c.github.io/webdriver-bidi/#get-matching-cookies",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"get-matching-cookies\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get matching cookies</dfn> given <var>cookie store</var> and <var>filter</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>cookies</var> be a new list.</p>"
        },
        {
          "html": "<p>Set <var>deserialized filter</var> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-filter\" id=\"ref-for-deserialize-filter\">deserialize filter</a> with <var>filter</var>.</p>"
        },
        {
          "html": "For each <var>stored cookie</var> in <var>cookie store</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#match-cookie\" id=\"ref-for-match-cookie\">match cookie</a> with <var>stored cookie</var> and <var>deserialized filter</var> is true:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p>Append <var>stored cookie</var> to <var>cookies</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>cookies</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for storage.getCookies",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤③\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>filter</var> be the value of the <code>filter</code> field of <var>command parameters</var>\nif it is present or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④②\">map</a> if it isn’t.</p>"
        },
        {
          "html": "<p>Let <var>partition spec</var> be the value of the <code>partition</code> field of\n<var>command parameters</var> if it is present or null if it isn’t.</p>"
        },
        {
          "html": "<p>Let <var>partition key</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⑤\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#expand-a-storage-partition-spec\" id=\"ref-for-expand-a-storage-partition-spec\">expand a storage partition spec</a> with <var>partition spec</var>.</p>"
        },
        {
          "html": "<p>Let <var>store</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-cookie-store\" id=\"ref-for-get-the-cookie-store\">get the cookie store</a> with\n<var>partition key</var>.</p>"
        },
        {
          "html": "<p>Let <var>cookies</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-matching-cookies\" id=\"ref-for-get-matching-cookies\">get matching cookies</a> with <var>store</var> and <var>filter</var>.</p>"
        },
        {
          "html": "<p>Let <var>serialized cookies</var> be a new list.</p>"
        },
        {
          "html": "For each <var>cookie</var> in <var>cookies</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>serialized cookie</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-cookie\" id=\"ref-for-serialize-cookie①\">serialize cookie</a> given <var>cookie</var>.</p>"
            },
            {
              "html": "<p>Append <var>serialized cookie</var> to <var>serialized cookies</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④③\">map</a> matching the <code>storage.GetCookiesResult</code> production,\nwith the <code>cookies</code> field set to <var>serialized cookies</var> and the <code>partitionKey</code>\nfield set to <var>partition key</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⑧\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for storage.setCookie",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤④\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>cookie spec</var> be the value of the <code>cookie</code> field of <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>partition spec</var> be the value of the <code>partition</code> field of\n<var>command parameters</var> if it is present or null if it isn’t.</p>"
        },
        {
          "html": "<p>Let <var>partition key</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#expand-a-storage-partition-spec\" id=\"ref-for-expand-a-storage-partition-spec①\">expand a storage partition spec</a> with <var>partition spec</var>.</p>"
        },
        {
          "html": "<p>Let <var>store</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-cookie-store\" id=\"ref-for-get-the-cookie-store①\">get the cookie store</a> with\n<var>partition key</var>.</p>"
        },
        {
          "html": "<p>Let <var>deserialized value</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-protocol-bytes\" id=\"ref-for-deserialize-protocol-bytes⑥\">deserialize protocol bytes</a> with\n<var>cookie spec</var>[\"<code>value</code>\"].</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-creating-a-cookie\" id=\"ref-for-dfn-creating-a-cookie\">Create a cookie</a> in <var>store</var> using <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-name\" id=\"ref-for-dfn-cookie-name\">cookie name</a> <var>cookie spec</var>[\"<code>name</code>\"],\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-value\" id=\"ref-for-dfn-cookie-value\">cookie value</a> <var>deserialized value</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-domain\" id=\"ref-for-dfn-cookie-domain\">cookie domain</a>\n<var>cookie spec</var>[\"<code>domain</code>\"], and an attribute-value list of the\nfollowing cookie concepts listed in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-table-for-cookie-conversion\" id=\"ref-for-dfn-table-for-cookie-conversion①\">table for cookie conversion</a>:</p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-path\" id=\"ref-for-dfn-cookie-path\">Cookie path</a>\n \n       </dt><dd>\n        <p><var>cookie spec</var>[\"<code>path</code>\"] if it exists, otherwise \"<code>/</code>\".\n\n </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-secure-only\" id=\"ref-for-dfn-cookie-secure-only\">Cookie secure only</a>\n \n       </dt><dd>\n        <p><var>cookie spec</var>[\"<code>secure</code>\"] if it exists, otherwise false.\n\n </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-http-only\" id=\"ref-for-dfn-cookie-http-only\">Cookie HTTP only</a>\n \n       </dt><dd>\n        <p><var>cookie spec</var>[\"<code>httpOnly</code>\"] if it exists, otherwise false.\n\n </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-expiry-time\" id=\"ref-for-dfn-cookie-expiry-time\">Cookie expiry time</a>\n \n       </dt><dd>\n        <p><var>cookie spec</var>[\"<code>expiry</code>\"] if it exists, otherwise leave unset to\n  indicate that this is a session cookie.\n\n</p>\n        \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-cookie-same-site\" id=\"ref-for-dfn-cookie-same-site\">Cookie same site</a>\n \n       </dt><dd>\n        <p><var>cookie spec</var>[\"<code>sameSite</code>\"] if it exists, otherwise leave unset to\n  indicate that no same site policy is defined.\n</p>\n      </dd></dl>\n      <p>If this step is aborted without inserting a cookie into the cookie store, return\n<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-unable-to-set-cookie\" id=\"ref-for-errors-unable-to-set-cookie\">unable to set cookie</a>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④④\">map</a> matching the <code>storage.SetCookieResult</code> production,\nwith the <code>partitionKey</code> field set to <var>partition key</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑨⑨\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for storage.deleteCookies",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⑤\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>filter</var> be the value of the <code>filter</code> field of <var>command parameters</var>\nif it is present or an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④⑤\">map</a> if it isn’t.</p>"
        },
        {
          "html": "<p>Let <var>partition spec</var> be the value of the <code>partition</code> field of\n<var>command parameters</var> if it is present or null if it isn’t.</p>"
        },
        {
          "html": "<p>Let <var>partition key</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑧⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#expand-a-storage-partition-spec\" id=\"ref-for-expand-a-storage-partition-spec②\">expand a storage partition spec</a> with <var>partition spec</var>.</p>"
        },
        {
          "html": "<p>Let <var>store</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-cookie-store\" id=\"ref-for-get-the-cookie-store②\">get the cookie store</a> with\n<var>partition key</var>.</p>"
        },
        {
          "html": "<p>Let <var>cookies</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-matching-cookies\" id=\"ref-for-get-matching-cookies①\">get matching cookies</a> with <var>store</var> and <var>filter</var>.</p>"
        },
        {
          "html": "For each <var>cookie</var> in <var>cookies</var>:",
          "rationale": "remove",
          "steps": [
            {
              "html": "<p>Remove <var>cookie</var> from <var>store</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④⑥\">map</a> matching the <code>storage.DeleteCookiesResult</code> production,\nwith the <code>partitionKey</code> field set to <var>partition key</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪⓪\">success</a> with data <var>body</var>.</p>"
        }
      ]
    },
    {
      "name": "buffer a log event",
      "href": "https://w3c.github.io/webdriver-bidi/#buffer-a-log-event",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"buffer-a-log-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">buffer a log event</dfn> given <var>session</var>, <var>navigables</var> and <var>event</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>buffer</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#log-event-buffer\" id=\"ref-for-log-event-buffer\">log event buffer</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable ids</var> be a new list.</p>"
        },
        {
          "html": "For each <var>navigable</var> of <var>navigables</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②⑤\">navigable id</a> for <var>navigable</var> to <var>navigable ids</var>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>navigable id</var> in <var>navigable ids</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>other navigables</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④①\">list</a></p>"
            },
            {
              "html": "<p>For each <var>other id</var> in <var>navigable ids</var>:</p>"
            },
            {
              "html": "<p>If <var>other id</var> is not equal to <var>navigable id</var>, append <var>other id</var> to <var>other\n  navigables</var>.</p>"
            },
            {
              "html": "<p>If <var>buffer</var> does not contain <var>navigable id</var>, let <var>buffer</var>[<var>navigable id</var>] be a\n new list.</p>"
            },
            {
              "html": "<p>Append (<var>event</var>, <var>other navigables</var>) to <var>buffer</var>[<var>navigable id</var>].</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for log.entryAdded",
      "html": "Define the following <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#console-steps\" id=\"ref-for-console-steps\">console steps</a> with <var>method</var>, <var>args</var>, and\n<var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①③\">active BiDi sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>method</var> is \"<code>error</code>\" or \"<code>assert</code>\", let <var>level</var> be\n \"<code>error</code>\". If <var>method</var> is \"<code>debug</code>\" or \"<code>trace</code>\"\n let <var>level</var> be \"<code>debug</code>\". If <var>method</var> is \"<code>warn</code>\", let\n <var>level</var> be \"<code>warn</code>\". Otherwise let <var>level</var> be \"<code>info</code>\".</p>"
            },
            {
              "html": "<p>Let <var>timestamp</var> be a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-time-values-and-time-range\" id=\"ref-for-sec-time-values-and-time-range③\">time value</a> representing the current date and time in UTC.</p>"
            },
            {
              "html": "<p>Let <var>text</var> be an empty string.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values\" id=\"ref-for-sec-ecmascript-data-types-and-values①①\">Type</a>(<var>args</var>[0]) is String, and <var>args</var>[0] contains a\n <a data-link-type=\"dfn\" href=\"https://console.spec.whatwg.org#formatting-specifiers\" id=\"ref-for-formatting-specifiers\">formatting specifier</a>, let <var>formatted args</var> be <a data-link-type=\"dfn\" href=\"https://console.spec.whatwg.org#formatter\" id=\"ref-for-formatter\">Formatter</a>(<var>args</var>). Otherwise\n let <var>formatted args</var> be <var>args</var>.</p>"
            },
            {
              "html": "For each <var>arg</var> in <var>formatted args</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>arg</var> is not the first entry in <var>args</var>, append a U+0020 SPACE to <var>text</var>.</p>"
                },
                {
                  "html": "<p>If <var>arg</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-primitive-value\" id=\"ref-for-sec-primitive-value\">primitive ECMAScript value</a>, append <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-tostring\" id=\"ref-for-sec-tostring③\">ToString</a>(<var>arg</var>) to\n <var>text</var>. Otherwise append an implementation-defined string to <var>text</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>realm</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#realm-id\" id=\"ref-for-realm-id①⓪\">realm id</a> of the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm③\">current Realm Record</a>.</p>"
            },
            {
              "html": "<p>Let <var>serialized args</var> be a new list.</p>"
            },
            {
              "html": "<p>Let <var>serialization options</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④⑧\">map</a> matching the\n <code>script.SerializationOptions</code> production with the fields set to\n their default values.</p>"
            },
            {
              "html": "For each <var>arg</var> of <var>args</var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>serialized arg</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#serialize-as-a-remote-value\" id=\"ref-for-serialize-as-a-remote-value①①\">serialize as a remote value</a> with\n  <var>arg</var> as value, <var>serialization options</var>, <code>none</code> as\n  ownership type, a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①④⑨\">map</a> as serialization internal map, <var>realm</var> and\n  <var>session</var>.</p>"
                },
                {
                  "html": "<p>Add <var>serialized arg</var> to <var>serialized args</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>source</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-source\" id=\"ref-for-get-the-source①\">get the source</a> given <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm④\">current Realm Record</a>.</p>"
            },
            {
              "html": "<p>Let <var>stack</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#current-stack-trace\" id=\"ref-for-current-stack-trace①\">current stack trace</a>.</p>"
            },
            {
              "html": "<p>Let <var>entry</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤⓪\">map</a> matching the <code>log.ConsoleLogEntry</code> production,\n with the the <code>level</code> field set to <var>level</var>, the <code>text</code>\n field set to <var>text</var>, the <code>timestamp</code> field set to <var>timestamp</var>, the\n <code>stackTrace</code> field set to <var>stack</var>, the <var>method</var> field set to <var>method</var>,\n the <code>source</code> field set to <var>source</var>,\n and the <code>args</code> field set to <var>serialized args</var>.</p>"
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤①\">map</a> matching the <code>log.EntryAdded</code> production, with\n the <code>params</code> field set to <var>entry</var>.</p>"
            },
            {
              "html": "<p>Let <var>settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-current-settings-object\">current settings object</a></p>"
            },
            {
              "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables①②\">get related navigables</a> given <var>settings</var>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-is-enabled\" id=\"ref-for-event-is-enabled③\">event is enabled</a> with <var>session</var>, \"<code>log.entryAdded</code>\" and\n <var>related navigables</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②⑤\">emit an event</a> with <var>session</var> and <var>body</var>.</p>\n        <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#buffer-a-log-event\" id=\"ref-for-buffer-a-log-event\">buffer a log event</a> with <var>session</var>, <var>related browsing\n contexts</var>, and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end event trigger for log.entryAdded",
      "html": "Define the following <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#error-reporting-steps\" id=\"ref-for-error-reporting-steps\">error reporting steps</a> with arguments <var>script</var>, <var>line number</var>, <var>column number</var>, <var>message</var> and\n<var>handled</var>:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>handled</var> is true return.</p>"
        },
        {
          "html": "<p>Let <var>settings</var> be <var>script</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#settings-object\" id=\"ref-for-settings-object①\">settings object</a>.</p>"
        },
        {
          "html": "<p>Let <var>timestamp</var> be a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-time-values-and-time-range\" id=\"ref-for-sec-time-values-and-time-range④\">time value</a> representing the current date and time in UTC.</p>"
        },
        {
          "html": "<p>Let <var>stack</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#stack-trace-for-an-exception\" id=\"ref-for-stack-trace-for-an-exception①\">stack trace for an exception</a> with the exception\n corresponding to the error being reported.</p>"
        },
        {
          "html": "<p>Let <var>source</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-the-source\" id=\"ref-for-get-the-source②\">get the source</a> given <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm⑤\">current Realm Record</a>.</p>"
        },
        {
          "html": "<p>Let <var>entry</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤②\">map</a> matching the <code>log.JavascriptLogEntry</code> production,\n with <code>level</code> set to \"<code>error</code>\", <code>text</code> set to\n <var>message</var>, <code>source</code> set to <var>source</var>, <code>timestamp</code>\n set to <var>timestamp</var>, and the <code>stackTrace</code> field set to <var>stack</var>.</p>"
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤③\">map</a> matching the <code>log.EntryAdded</code> production, with\n   the <code>params</code> field set to <var>entry</var>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-related-navigables\" id=\"ref-for-get-related-navigables①③\">get related navigables</a> given <var>settings</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①④\">active BiDi sessions</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-is-enabled\" id=\"ref-for-event-is-enabled④\">event is enabled</a> with <var>session</var>, \"<code>log.entryAdded</code>\" and\n <var>related navigables</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②⑥\">emit an event</a> with <var>session</var> and <var>body</var>.</p>\n        <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#buffer-a-log-event\" id=\"ref-for-buffer-a-log-event①\">buffer a log event</a> with <var>session</var>, <var>related browsing\n contexts</var>, and <var>body</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end subscribe steps for log.entryAdded",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-subscribe-steps\" id=\"ref-for-event-remote-end-subscribe-steps④\">remote end subscribe steps</a>, with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-subscribe-priority\" id=\"ref-for-event-subscribe-priority③\">subscribe priority</a> 10, given\n<var>session</var>, <var>navigables</var> and <var>include global</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>navigable id</var> → <var>events</var> in <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#log-event-buffer\" id=\"ref-for-log-event-buffer①\">log event buffer</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>maybe context</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②①\">getting a navigable</a> given\n <var>navigable id</var>.</p>"
            },
            {
              "html": "<p>If <var>maybe context</var> is an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①③⑨\">error</a>, remove <var>navigable id</var> from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#log-event-buffer\" id=\"ref-for-log-event-buffer②\">log event buffer</a> and continue.</p>"
            },
            {
              "html": "<p>Let <var>navigable</var> be <var>maybe context</var>’s data</p>"
            },
            {
              "html": "<p>Let <var>top level navigable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top①⑨\">top-level traversable</a>.</p>"
            },
            {
              "html": "If <var>include global</var> is true and <var>top level navigable</var> is not in <var>navigables</var>,\n or if <var>include global</var> is false and <var>top level navigable</var> is in <var>navigables</var>:",
              "rationale": "for",
              "steps": [
                {
                  "html": "For each (<var>event</var>, <var>other navigables</var>) in <var>events</var>:",
                  "rationale": "emit",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②⑦\">Emit an event</a> with <var>session</var> and <var>event</var>.</p>"
                    },
                    {
                      "html": "For each <var>other context id</var> in <var>other navigables</var>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#log-event-buffer\" id=\"ref-for-log-event-buffer③\">log event buffer</a> contains <var>other context id</var>, remove <var>event</var>\n from <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#log-event-buffer\" id=\"ref-for-log-event-buffer④\">log event buffer</a>[<var>other context id</var>].</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "is input.ElementOrigin",
      "href": "https://w3c.github.io/webdriver-bidi/#is-inputelementorigin",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"is-inputelementorigin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">is <code>input.ElementOrigin</code></dfn> steps given <var>object</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>object</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤④\">map</a> matching the <code>input.ElementOrigin</code>\n production, return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "get Element from input.ElementOrigin steps",
      "href": "https://w3c.github.io/webdriver-bidi/#get-element-from-inputelementorigin-steps",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"get Element from input.ElementOrigin steps\" data-noexport=\"\" id=\"get-element-from-inputelementorigin-steps\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get Element from <code>input.ElementOrigin</code>\nsteps</dfn> given <var>session</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Return the following steps, given <var>origin</var> and <var>navigable</var>:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p class=\"assertion\">Assert: <var>origin</var> matches <code>input.ElementOrigin</code>.</p>"
            },
            {
              "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②⓪\">active document</a>.</p>"
            },
            {
              "html": "<p>Let <var>reference</var> be <var>origin</var>[\"<code>element</code>\"]</p>"
            },
            {
              "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object②②\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①⑤\">associated <code>Document</code></a> is\n <var>document</var>.</p>"
            },
            {
              "html": "<p>Let <var>realm</var> be <var>environment settings</var>’ <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①⑤\">realm execution context</a>’s\n Realm component.</p>"
            },
            {
              "html": "<p>Let <var>element</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨①\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-remote-reference\" id=\"ref-for-deserialize-remote-reference②\">deserialize remote reference</a>\n with <var>reference</var>, <var>realm</var>, and <var>session</var>.</p>"
            },
            {
              "html": "<p>If <var>element</var> doesn’t implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element⑥\">Element</a></code> return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③④\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-element\" id=\"ref-for-dfn-no-such-element②\">no such element</a>.</p>"
            },
            {
              "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪①\">success</a> with data <var>element</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "remote end steps for input.performActions",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⑥\">remote end steps</a> with <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨②\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②②\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>Let <var>input state</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-the-input-state\" id=\"ref-for-dfn-get-the-input-state\">get the input state</a> with <var>session</var> and <var>navigable</var>’s\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top②⓪\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Let <var>actions options</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-actions-options\" id=\"ref-for-dfn-actions-options\">actions options</a> with the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-is-element-origin\" id=\"ref-for-dfn-is-element-origin\">is element origin</a> steps set to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#is-inputelementorigin\" id=\"ref-for-is-inputelementorigin\">is input.ElementOrigin</a>, and the\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-element-origin\" id=\"ref-for-dfn-get-element-origin\">get element origin</a> steps set to the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-element-from-inputelementorigin-steps\" id=\"ref-for-get-element-from-inputelementorigin-steps\">get Element from input.ElementOrigin steps</a> given <var>session</var>.</p>"
        },
        {
          "html": "<p>Let <var>actions by tick</var> be the result of trying to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-extract-an-action-sequence\" id=\"ref-for-dfn-extract-an-action-sequence\">extract an action sequence</a> with <var>input state</var>, <var>command parameters</var>, and <var>actions options</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" data-refhint-key=\"f5554d6d\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨③\">Try</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-dispatch-actions\" id=\"ref-for-dfn-dispatch-actions\">dispatch actions</a> with <var>input state</var>, <var>actions by tick</var>,\n <var>navigable</var>, and <var>actions options</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪②\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for input.releaseActions",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⑦\">remote end steps</a> given <var>session</var>, and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <code>context</code> field of\n <var>command parameters</var>.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨④\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②③\">get a navigable</a>\n with <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>Let <var>top-level traversable</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-top\" id=\"ref-for-nav-top②①\">top-level traversable</a>.</p>"
        },
        {
          "html": "<p>Let <var>input state</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-the-input-state\" id=\"ref-for-dfn-get-the-input-state①\">get the input state</a> with <var>session</var> and <var>top-level traversable</var>.</p>"
        },
        {
          "html": "<p>Let <var>actions options</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-actions-options\" id=\"ref-for-dfn-actions-options①\">actions options</a> with the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-is-element-origin\" id=\"ref-for-dfn-is-element-origin①\">is element origin</a> steps set to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#is-inputelementorigin\" id=\"ref-for-is-inputelementorigin①\">is input.ElementOrigin</a>, and the\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-get-element-origin\" id=\"ref-for-dfn-get-element-origin①\">get element origin</a> steps set to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-element-from-inputelementorigin-steps\" id=\"ref-for-get-element-from-inputelementorigin-steps①\">get Element from input.ElementOrigin steps</a> given <var>session</var>.</p>"
        },
        {
          "html": "<p>Let <var>undo actions</var> be <var>input state</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-input-cancel-list\" id=\"ref-for-dfn-input-cancel-list\">input cancel list</a> in reverse order.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" data-refhint-key=\"f5554d6d\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⑤\">Try</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-dispatch-tick-actions\" id=\"ref-for-dfn-dispatch-tick-actions\">dispatch tick actions</a> with <var>undo actions</var>, 0, <var>navigable</var>, and\n <var>actions options</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-reset-the-input-state\" id=\"ref-for-dfn-reset-the-input-state\">Reset the input state</a> with <var>session</var> and <var>top-level traversable</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪③\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for input.setFiles",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⑧\">remote end steps</a> given <var>session</var> and <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable id</var> be the value of the <var>command\n parameters</var>[\"<code>context</code>\"] field.</p>"
        },
        {
          "html": "<p>Let <var>navigable</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⑥\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-a-navigable\" id=\"ref-for-get-a-navigable②④\">get a navigable</a> with\n <var>navigable id</var>.</p>"
        },
        {
          "html": "<p>Let <var>document</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#nav-document\" id=\"ref-for-nav-document②①\">active document</a>.</p>"
        },
        {
          "html": "<p>Let <var>environment settings</var> be the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object②③\">environment settings object</a> whose\n <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①⑥\">associated <code>Document</code></a> is\n <var>document</var>.</p>"
        },
        {
          "html": "<p>Let <var>realm</var> be <var>environment settings</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#realm-execution-context\" id=\"ref-for-realm-execution-context①⑥\">realm execution context</a>’s\n Realm component.</p>"
        },
        {
          "html": "<p>Let <var>element</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⑦\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#deserialize-remote-reference\" id=\"ref-for-deserialize-remote-reference③\">deserialize remote reference</a>\n with <var>command parameters</var>[\"<code>element</code>\"], <var>realm</var>, and <var>session</var>.</p>"
        },
        {
          "html": "<p>If <var>element</var> doesn’t implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#element\" id=\"ref-for-element⑦\">Element</a></code>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④①\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⑤\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-no-such-element\" id=\"ref-for-dfn-no-such-element③\">no such element</a>.</p>"
        },
        {
          "html": "<p>If <var>element</var> doesn’t implement <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/input.html#htmlinputelement\" id=\"ref-for-htmlinputelement\">HTMLInputElement</a></code>, <var>element</var>’s\n <code><a data-link-type=\"element-sub\" href=\"https://html.spec.whatwg.org/multipage/input.html#attr-input-type\" id=\"ref-for-attr-input-type\">type</a></code> is not in the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/input.html#file-upload-state-(type=file)\" id=\"ref-for-file-upload-state-(type=file)\">File Upload state</a>, or <var>element</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#concept-fe-disabled\" id=\"ref-for-concept-fe-disabled\">disabled</a>,\n return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④②\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⑥\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-unable-to-set-file-input\" id=\"ref-for-errors-unable-to-set-file-input\">unable to set file input</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①②\">size</a> of <var>files</var> is greater than 1 and <var>element</var>’s\n <code><a data-link-type=\"element-sub\" href=\"https://html.spec.whatwg.org/multipage/input.html#attr-input-multiple\" id=\"ref-for-attr-input-multiple\">multiple</a></code> attribute is not set, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④③\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⑦\">error code</a>\n <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-unable-to-set-file-input\" id=\"ref-for-errors-unable-to-set-file-input①\">unable to set file input</a>.</p>"
        },
        {
          "html": "<p>Let <var>files</var> be the value of the <var>command parameters</var>[\"<code>files</code>\"]\n field.</p>"
        },
        {
          "html": "<p>Let <var>selected files</var> be <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/input.html#concept-input-type-file-selected\" id=\"ref-for-concept-input-type-file-selected\">selected files</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①③\">size</a> of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection②\">intersection</a> of <var>files</var> and <var>selected\n files</var> is equal to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①④\">size</a> of <var>selected files</var> and equal to the\n <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①⑤\">size</a> of <var>files</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-an-element-task\" id=\"ref-for-queue-an-element-task\">queue an element task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\" id=\"ref-for-user-interaction-task-source\">user interaction task source</a>\n given <var>element</var> to fire an event named <code>cancel</code> at <var>element</var>, with\n the <code>bubbles</code> attribute initialized to true.</p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/input.html#update-the-file-selection\" id=\"ref-for-update-the-file-selection\">update the file selection</a> for <var>element</var> with <var>files</var> as the\n user’s selection.</p>"
        },
        {
          "html": "<p>If, for any reason, the remote end is unable to set the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/input.html#concept-input-type-file-selected\" id=\"ref-for-concept-input-type-file-selected①\">selected files</a> of <var>element</var> to the files with paths given in <var>files</var>,\n return error with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⑧\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①⑤\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪④\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "WebDriver BiDi file dialog opened",
      "href": "https://w3c.github.io/webdriver-bidi/#webdriver-bidi-file-dialog-opened",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#event-remote-end-event-trigger\" id=\"ref-for-event-remote-end-event-trigger②⑤\">remote end event trigger</a> is the\n<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"webdriver-bidi-file-dialog-opened\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">WebDriver BiDi file dialog opened</dfn> steps, given <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-element\" id=\"ref-for-concept-element\">element</a> <var>element</var> and\noptionally <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-file-picker-options\" id=\"ref-for-webdriver-bidi-file-picker-options\">WebDriver BiDi file picker options</a> <var>file picker options</var> (default: null):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>navigable</var> be the <var>element</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-node-document\" id=\"ref-for-concept-node-document②\">node document</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#navigables\" id=\"ref-for-navigables④③\">navigable</a>.</p>"
        },
        {
          "html": "<p>Let <var>navigable id</var> be <var>navigable</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#navigable-id\" id=\"ref-for-navigable-id②⑥\">navigable id</a>.</p>"
        },
        {
          "html": "<p>Let <var>multiple</var> be <code>false</code>.</p>"
        },
        {
          "html": "<p>If <var>element</var> is not null and <var>element</var>’s <code><a data-link-type=\"element-sub\" href=\"https://html.spec.whatwg.org/multipage/input.html#attr-input-multiple\" id=\"ref-for-attr-input-multiple①\">multiple</a></code> attribute is set,\n  set <var>multiple</var> to <code>true</code>.</p>"
        },
        {
          "html": "<p>If <var>file picker options</var> is not null and <var>file picker options</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#webdriver-bidi-file-picker-options-multiple\" id=\"ref-for-webdriver-bidi-file-picker-options-multiple\">multiple</a> is true, set <var>multiple</var> to\n    <code>true</code>.</p>"
        },
        {
          "html": "<p>Let <var>related navigables</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥⑤\">set</a> containing <var>navigable</var>.</p>"
        },
        {
          "html": "For each <var>session</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#set-of-sessions-for-which-an-event-is-enabled\" id=\"ref-for-set-of-sessions-for-which-an-event-is-enabled②③\">set of sessions for which an event is enabled</a> given\n \"<code>input.fileDialogOpened</code>\" and <var>related navigables</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>params</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤⑤\">map</a> matching the <code>input.FileDialogInfo</code>\n production with the <code>context</code> field set to <var>navigable id</var> and\n <code>multiple</code> field set to <var>multiple</var>.</p>"
            },
            {
              "html": "If <var>element</var> is not null:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>shared id</var> be <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#get-shared-id-for-a-node\" id=\"ref-for-get-shared-id-for-a-node①\">get shared id for a node</a> with <var>element</var> and <var>session</var>.</p>"
                },
                {
                  "html": "<p>Set <var>params</var>[\"<code>element</code>\"] to <var>shared id</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤⑥\">map</a> matching the <code>input.fileDialogOpened</code>\n production, with the <code>params</code> field set to <var>params</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#emit-an-event\" id=\"ref-for-emit-an-event②⑧\">Emit an event</a> with <var>session</var> and <var>body</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>dismissed</var> be false.</p>"
        },
        {
          "html": "For each <var>session</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#active-bidi-sessions\" id=\"ref-for-active-bidi-sessions①⑤\">active BiDi sessions</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>user prompt handler</var> be <var>session</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-user-prompt-handler\" id=\"ref-for-dfn-user-prompt-handler\">user prompt handler</a>.</p>"
            },
            {
              "html": "<p>If <var>user prompt handler</var> is not null:</p>"
            },
            {
              "html": "<p>Assert <var>user prompt handler</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤⑦\">map</a>.</p>"
            },
            {
              "html": "If <var>user prompt handler</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②⑨\">contains</a> \"<code>file</code>\":",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>user prompt handler</var>[\"<code>file</code>\"] is not equal to\n \"<code>ignore</code>\", set <var>dismissed</var> to true.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise if <var>user prompt handler</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③⓪\">contains</a> \"<code>default</code>\" and\n  <var>user prompt handler</var>[\"<code>default</code>\"] is not equal to\n  \"<code>ignore</code>\", set <var>dismissed</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>dismissed</var>.</p>"
        }
      ]
    },
    {
      "name": "extract a zip archive",
      "href": "https://w3c.github.io/webdriver-bidi/#extract-a-zip-archive",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"extract-a-zip-archive\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract a zip archive</dfn> given <var>bytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Perform implementation defined steps to decode <var>bytes</var> using the zip compression algorithm. TODO: Find a better reference for zip decoding.</p>"
        },
        {
          "html": "<p>If the previous step failed (e.g. because <var>bytes</var> did not represent valid zip-compressed data) then return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④④\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-invalid-web-extension\" id=\"ref-for-errors-invalid-web-extension\">invalid web extension</a>. Otherwise let <var>entry</var> be a <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#directory\" id=\"ref-for-directory\">directory entry</a> containing the extracted filesystem entries.</p>"
        },
        {
          "html": "<p>Return <var>entry</var>.</p>"
        }
      ]
    },
    {
      "name": "expand a web extension data spec",
      "href": "https://w3c.github.io/webdriver-bidi/#expand-a-web-extension-data-spec",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"expand-a-web-extension-data-spec\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">expand a web extension data spec</dfn> given <var>extension data spec</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>type</var> be <var>extension data spec</var>[\"<code>type</code>\"].</p>"
        },
        {
          "html": "<p>If installing a web extension using <var>type</var> isn’t supported return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⑤\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③⑨\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①⑥\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>In the following list of conditions and associated steps, run the first set of steps for which the associated condition is true:</p>\n      <dl>\n       <dt><var>type</var> is the string \"<code>path</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>archivePath</code>\"\n  \n       </dt><dd>\n        \n       </dd><dt><var>type</var> is the string \"<code>base64</code>\"\n  \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>path</var> be <var>extension data spec</var>[\"<code>path</code>\"].</p>"
            },
            {
              "html": "<p>Let <var>locator</var> be a <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#directory-locator\" id=\"ref-for-directory-locator\">directory locator</a> with <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locator-path\" id=\"ref-for-locator-path\">path</a> <var>path</var> and <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locator-root\" id=\"ref-for-locator-root\">root</a> corresponding to the root of the file system.</p>"
            },
            {
              "html": "<p>Let <var>entry</var> be <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locating-an-entry\" id=\"ref-for-locating-an-entry\">locate an entry</a> given <var>locator</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>archive path</var> be <var>extension data spec</var>[\"<code>path</code>\"].</p>"
                },
                {
                  "html": "<p>Let <var>locator</var> be a <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#file-locator\" id=\"ref-for-file-locator\">file locator</a> with <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locator-path\" id=\"ref-for-locator-path①\">path</a> <var>archive path</var> and <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locator-root\" id=\"ref-for-locator-root①\">root</a> corresponding to the root of the file system.</p>"
                },
                {
                  "html": "<p>Let <var>archive entry</var> be <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#locating-an-entry\" id=\"ref-for-locating-an-entry①\">locate an entry</a> given <var>locator</var>.</p>"
                },
                {
                  "html": "<p>If <var>archive entry</var> is null, return null.</p>"
                },
                {
                  "html": "<p>Let <var>bytes</var> be <var>archive entry</var>’s <a data-link-type=\"dfn\" href=\"https://fs.spec.whatwg.org/#file-entry-binary-data\" id=\"ref-for-file-entry-binary-data\">binary data</a>.</p>"
                },
                {
                  "html": "<p>Let <var>entry</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⑧\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extract-a-zip-archive\" id=\"ref-for-extract-a-zip-archive\">extract a zip archive</a> given <var>bytes</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>bytes</var> be <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode①\">forgiving-base64 decode</a> <var>extension data spec</var>[\"<code>value</code>\"].</p>"
                },
                {
                  "html": "<p>If <var>bytes</var> is failure, return null.</p>"
                },
                {
                  "html": "<p>Let <var>entry</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try⑨⑨\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#extract-a-zip-archive\" id=\"ref-for-extract-a-zip-archive①\">extract a zip archive</a> given <var>bytes</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>entry</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for webExtension.install",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤⑨\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If installing web extensions isn’t supported return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⑥\">error</a> with error code <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation①⑦\">unsupported operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>extension data spec</var> be <var>command parameters</var>[\"<code>extensionData</code>\"].</p>"
        },
        {
          "html": "<p>Let <var>extension directory entry</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-try\" id=\"ref-for-dfn-try①⓪⓪\">trying</a> to <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#expand-a-web-extension-data-spec\" id=\"ref-for-expand-a-web-extension-data-spec\">expand a web extension data spec</a> with <var>extension data spec</var>.</p>"
        },
        {
          "html": "<p>If <var>extension directory entry</var> is null, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⑦\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④⓪\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-invalid-web-extension\" id=\"ref-for-errors-invalid-web-extension①\">invalid web extension</a>.</p>"
        },
        {
          "html": "<p>Perform implementation defined steps to install a web extension from <var>extension directory entry</var>. If this fails, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⑧\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④①\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-invalid-web-extension\" id=\"ref-for-errors-invalid-web-extension②\">invalid web extension</a>. Otherwise let <var>extension id</var> be the unique identifier of the newly installed web extension.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⑤⑧\">map</a> matching the\n <code>webExtension.InstallResult</code> production with the\n <code>extension</code> field set to <var>extension id</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪⑤\">success</a> with data <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "remote end steps for webExtension.uninstall",
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑥⓪\">remote end steps</a> with <var>command parameters</var> are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>extension</var> be <var>command parameters</var>[\"<code>extension</code>\"].</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends⑤②\">remote end</a> has no web extension with id equal to <var>extension</var>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①④⑨\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④②\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#errors-no-such-web-extension\" id=\"ref-for-errors-no-such-web-extension\">no such web extension</a>.</p>"
        },
        {
          "html": "<p>Perform any implementation-defined steps to remove the web extension from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-ends\" id=\"ref-for-dfn-remote-ends⑤③\">remote end</a>. If this fails, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#errors\" id=\"ref-for-errors①⑤⓪\">error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④③\">error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unknown-error\" id=\"ref-for-dfn-unknown-error③\">unknown error</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①⓪⑥\">success</a> with data null.</p>"
        }
      ]
    },
    {
      "name": "error reporting steps",
      "href": "https://w3c.github.io/webdriver-bidi/#error-reporting-steps",
      "html": "",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Call any <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"error-reporting-steps\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">error reporting steps</dfn> defined in external specifications\n with <var>script</var>, <var>line</var>, <var>col</var>, <var>message</var>, and true if the error is\n handled, or false otherwise.</p>"
        }
      ]
    },
    {
      "html": "Insert the following steps at the start of the <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/cssom-view-1/#determine-the-device-pixel-ratio\" id=\"ref-for-determine-the-device-pixel-ratio①\">determine the device pixel ratio</a> algorithm:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#device-pixel-ratio-overrides\" id=\"ref-for-device-pixel-ratio-overrides②\">device pixel ratio overrides</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③①\">contains</a> <var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable③\">navigable</a>, return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver-bidi/#device-pixel-ratio-overrides\" id=\"ref-for-device-pixel-ratio-overrides③\">device pixel ratio overrides</a>[<var>window</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-navigable\" id=\"ref-for-window-navigable④\">navigable</a>].</p>"
        }
      ]
    }
  ]
}