{
  "spec": {
    "title": "Fetch Standard",
    "url": "https://fetch.spec.whatwg.org/"
  },
  "algorithms": [
    {
      "name": "fetch controller/report timing",
      "href": "https://fetch.spec.whatwg.org/#finalize-and-report-timing",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch controller\" data-dfn-type=\"dfn\" data-export=\"\" id=\"finalize-and-report-timing\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">report timing</dfn> for a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller\" id=\"ref-for-fetch-controller②\">fetch controller</a> <var>controller</var> given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object②\">global object</a> <var>global</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-report-timing-steps\" id=\"ref-for-fetch-controller-report-timing-steps\">report timing steps</a> is non-null. </p>"
        },
        {
          "html": "<p>Call <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-report-timing-steps\" id=\"ref-for-fetch-controller-report-timing-steps①\">report timing steps</a> with <var>global</var>. </p>"
        }
      ]
    },
    {
      "name": "fetch controller/process the next manual redirect",
      "href": "https://fetch.spec.whatwg.org/#fetch-controller-process-the-next-manual-redirect",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch controller\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-controller-process-the-next-manual-redirect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process the next manual redirect</dfn> for a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller\" id=\"ref-for-fetch-controller③\">fetch controller</a> <var>controller</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-next-manual-redirect-steps\" id=\"ref-for-fetch-controller-next-manual-redirect-steps\">next manual redirect steps</a> is non-null. </p>"
        },
        {
          "html": "<p>Call <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-next-manual-redirect-steps\" id=\"ref-for-fetch-controller-next-manual-redirect-steps①\">next manual redirect steps</a>. </p>"
        }
      ]
    },
    {
      "name": "fetch controller/extract full timing info",
      "href": "https://fetch.spec.whatwg.org/#extract-full-timing-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch controller\" data-dfn-type=\"dfn\" data-export=\"\" id=\"extract-full-timing-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract full timing info</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller\" id=\"ref-for-fetch-controller④\">fetch controller</a> <var>controller</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-full-timing-info\" id=\"ref-for-fetch-controller-full-timing-info\">full timing info</a> is non-null. </p>"
        },
        {
          "html": "<p>Return <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-full-timing-info\" id=\"ref-for-fetch-controller-full-timing-info①\">full timing info</a>. </p>"
        }
      ]
    },
    {
      "name": "fetch controller/abort",
      "href": "https://fetch.spec.whatwg.org/#fetch-controller-abort",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch controller\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-controller-abort\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">abort</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller\" id=\"ref-for-fetch-controller⑤\">fetch controller</a> <var>controller</var> with an optional <var>error</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-state\" id=\"ref-for-fetch-controller-state\">state</a> to \"<code>aborted</code>\". </p>"
        },
        {
          "html": "<p>Let <var>fallbackError</var> be an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code>. </p>"
        },
        {
          "html": "<p>Set <var>error</var> to <var>fallbackError</var> if it is not given. </p>"
        },
        {
          "html": "<p>Let <var>serializedError</var> be <a data-link-type=\"abstract-op\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserialize\" id=\"ref-for-structuredserialize①\">StructuredSerialize</a>(<var>error</var>).\n If that threw an exception, catch it, and let <var>serializedError</var> be <a data-link-type=\"abstract-op\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#structuredserialize\" id=\"ref-for-structuredserialize②\">StructuredSerialize</a>(<var>fallbackError</var>). </p>"
        },
        {
          "html": "<p>Set <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-serialized-abort-reason\" id=\"ref-for-fetch-controller-serialized-abort-reason\">serialized abort reason</a> to <var>serializedError</var>. </p>"
        }
      ]
    },
    {
      "name": "deserialize a serialized abort reason",
      "href": "https://fetch.spec.whatwg.org/#deserialize-a-serialized-abort-reason",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"deserialize-a-serialized-abort-reason\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">deserialize a serialized abort reason</dfn>, given null or a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-list-and-record-specification-type\" id=\"ref-for-sec-list-and-record-specification-type①\">Record</a> <var>abortReason</var> and a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm\">realm</a> <var>realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>fallbackError</var> be an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror①\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>deserializedError</var> be <var>fallbackError</var>. </p>"
        },
        {
          "html": "<p>If <var>abortReason</var> is non-null, then set <var>deserializedError</var> to <a data-link-type=\"abstract-op\" href=\"https://html.spec.whatwg.org/multipage/structured-data.html#structureddeserialize\" id=\"ref-for-structureddeserialize\">StructuredDeserialize</a>(<var>abortReason</var>, <var>realm</var>). If that threw an exception or\n returned undefined, then set <var>deserializedError</var> to <var>fallbackError</var>. </p>"
        },
        {
          "html": "<p>Return <var>deserializedError</var>. </p>"
        }
      ]
    },
    {
      "name": "fetch controller/terminate",
      "href": "https://fetch.spec.whatwg.org/#fetch-controller-terminate",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch controller\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-controller-terminate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">terminate</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller\" id=\"ref-for-fetch-controller⑥\">fetch controller</a> <var>controller</var>, set <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-state\" id=\"ref-for-fetch-controller-state①\">state</a> to\n\"<code>terminated</code>\".",
      "rationale": "To <dfn>"
    },
    {
      "name": "create an opaque timing info",
      "href": "https://fetch.spec.whatwg.org/#create-an-opaque-timing-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create an opaque timing info|creating an opaque timing info\" id=\"create-an-opaque-timing-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an opaque timing info</dfn>,\ngiven a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info\" id=\"ref-for-fetch-timing-info②\">fetch timing info</a> <var>timingInfo</var>, return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info\" id=\"ref-for-fetch-timing-info③\">fetch timing info</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-start-time\" id=\"ref-for-fetch-timing-info-start-time\">start time</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-post-redirect-start-time\" id=\"ref-for-fetch-timing-info-post-redirect-start-time\">post-redirect start time</a> are <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-start-time\" id=\"ref-for-fetch-timing-info-start-time①\">start time</a>.",
      "rationale": "To <dfn>"
    },
    {
      "name": "queue a fetch task",
      "href": "https://fetch.spec.whatwg.org/#queue-a-fetch-task",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"queue-a-fetch-task\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">queue a fetch task</dfn>, given an algorithm <var>algorithm</var>, a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object③\">global object</a> or a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue\" id=\"ref-for-parallel-queue①\">parallel queue</a> <var>taskDestination</var>, run these\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>taskDestination</var> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue\" id=\"ref-for-parallel-queue②\">parallel queue</a>, then <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps\" id=\"ref-for-enqueue-the-following-steps\">enqueue</a> <var>algorithm</var> to <var>taskDestination</var>. </p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source\" id=\"ref-for-networking-task-source\">networking task source</a> with <var>taskDestination</var> and <var>algorithm</var>. </p>"
        }
      ]
    },
    {
      "name": "collect an HTTP quoted string",
      "href": "https://fetch.spec.whatwg.org/#collect-an-http-quoted-string",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"collect an HTTP quoted string|collecting an HTTP quoted string\" id=\"collect-an-http-quoted-string\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">collect an HTTP quoted string</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string\">string</a> <var>input</var>, given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-position-variable\" id=\"ref-for-string-position-variable\">position variable</a> <var>position</var> and an optional boolean <var>extract-value</var> (default false):",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>positionStart</var> be <var>position</var>. </p>"
        },
        {
          "html": "<p>Let <var>value</var> be the empty string. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point\">code point</a> at <var>position</var> within <var>input</var> is\n U+0022 (\"). </p>"
        },
        {
          "html": "<p>Advance <var>position</var> by 1. </p>"
        },
        {
          "html": "While true:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points\">collecting a sequence of code points</a> that are not U+0022 (\")\n   or U+005C (\\) from <var>input</var>, given <var>position</var>, to <var>value</var>. </p>"
            },
            {
              "html": "<p>If <var>position</var> is past the end of <var>input</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">break</a>. </p>"
            },
            {
              "html": "<p>Let <var>quoteOrBackslash</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point①\">code point</a> at <var>position</var> within <var>input</var>. </p>"
            },
            {
              "html": "<p>Advance <var>position</var> by 1. </p>"
            },
            {
              "html": "If <var>quoteOrBackslash</var> is U+005C (\\), then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>position</var> is past the end of <var>input</var>, then append U+005C (\\) to <var>value</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">break</a>. </p>"
                },
                {
                  "html": "<p>Append the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point②\">code point</a> at <var>position</var> within <var>input</var> to <var>value</var>. </p>"
                },
                {
                  "html": "<p>Advance <var>position</var> by 1. </p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: <var>quoteOrBackslash</var> is U+0022 (\"). </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">Break</a>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>extract-value</var> is true, then return <var>value</var>. </p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point③\">code points</a> from <var>positionStart</var> to <var>position</var>,\n inclusive, within <var>input</var>. </p>"
        }
      ]
    },
    {
      "name": "method/normalize",
      "href": "https://fetch.spec.whatwg.org/#concept-method-normalize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"method\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-method-normalize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">normalize</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-method\" id=\"ref-for-concept-method②\">method</a>, if it is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①\">byte-case-insensitive</a> match for `<code>DELETE</code>`, `<code>GET</code>`,\n`<code>HEAD</code>`, `<code>OPTIONS</code>`, `<code>POST</code>`, or\n`<code>PUT</code>`, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-uppercase\" id=\"ref-for-byte-uppercase\">byte-uppercase</a> it.",
      "rationale": "To <dfn>"
    },
    {
      "name": "header list/get a structured field value",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-get-structured-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a structured field value</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name\">header name</a> <var>name</var> and a string <var>type</var> from a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①\">header list</a> <var>list</var>, run these steps. They return null or a <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9651.html#rfc.section.2\" id=\"ref-for-rfc.section.2\">structured field value</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: <var>type</var> is one of \"<code>dictionary</code>\",\n \"<code>list</code>\", or \"<code>item</code>\". </p>"
        },
        {
          "html": "<p>Let <var>value</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get\">getting</a> <var>name</var> from <var>list</var>. </p>"
        },
        {
          "html": "<p>If <var>value</var> is null, then return null. </p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9651.html#text-parse\" id=\"ref-for-text-parse\">parsing structured fields</a> with <var>input_string</var> set to <var>value</var> and <var>header_type</var> set to <var>type</var>. </p>"
        },
        {
          "html": "<p>If parsing failed, then return null. </p>"
        },
        {
          "html": "<p>Return <var>result</var>. </p>"
        }
      ]
    },
    {
      "name": "header list/set a structured field value",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-set-structured-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set a structured field value</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#tuple\" id=\"ref-for-tuple\">tuple</a> (<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name①\">header name</a> <var>name</var>, <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9651.html#rfc.section.2\" id=\"ref-for-rfc.section.2②\">structured field value</a> <var>structuredValue</var>), in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list②\">header list</a> <var>list</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>serializedValue</var> be the result of executing the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9651.html#text-serialize\" id=\"ref-for-text-serialize\">serializing structured fields</a> algorithm on <var>structuredValue</var>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set\" id=\"ref-for-concept-header-list-set\">Set</a> (<var>name</var>, <var>serializedValue</var>) in <var>list</var>. </p>"
        }
      ]
    },
    {
      "name": "header list/get",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-get",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-get\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name③\">header name</a> <var>name</var> from a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑥\">header list</a> <var>list</var>, run these steps. They return null\nor a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value①\">header value</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains\">does not contain</a> <var>name</var>, then return\n null. </p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value①\">values</a> of all <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header③\">headers</a> in <var>list</var> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①\">name</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive③\">byte-case-insensitive</a> match for <var>name</var>, separated\n from each other by 0x2C 0x20, in order. </p>"
        }
      ]
    },
    {
      "name": "header list/get, decode, and split",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"get, decode, and split|getting, decoding, and splitting\" id=\"concept-header-list-get-decode-split\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get, decode, and split</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name④\">header name</a> <var>name</var> from <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑦\">header list</a> <var>list</var>, run these\nsteps. They return null or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①\">strings</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>value</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get①\">getting</a> <var>name</var> from <var>list</var>. </p>"
        },
        {
          "html": "<p>If <var>value</var> is null, then return null. </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value-get-decode-and-split\" id=\"ref-for-header-value-get-decode-and-split\">getting, decoding, and splitting</a> <var>value</var>. </p>"
        }
      ]
    },
    {
      "name": "header value/get, decode, and split",
      "href": "https://fetch.spec.whatwg.org/#header-value-get-decode-and-split",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header value\" data-dfn-type=\"dfn\" data-lt=\"get, decode, and split|getting, decoding, and splitting\" data-noexport=\"\" id=\"header-value-get-decode-and-split\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get, decode, and split</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value②\">header value</a> <var>value</var>, run these steps. They return a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②\">strings</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>input</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-decode\" id=\"ref-for-isomorphic-decode\">isomorphic decoding</a> <var>value</var>. </p>"
        },
        {
          "html": "<p>Let <var>position</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-position-variable\" id=\"ref-for-string-position-variable③\">position variable</a> for <var>input</var>,\n initially pointing at the start of <var>input</var>. </p>"
        },
        {
          "html": "<p>Let <var>values</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③\">strings</a>, initially « ». </p>"
        },
        {
          "html": "<p>Let <var>temporaryValue</var> be the empty string. </p>"
        },
        {
          "html": "While true:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points①\">collecting a sequence of code points</a> that are not U+0022 (\") or\n    U+002C (,) from <var>input</var>, given <var>position</var>, to <var>temporaryValue</var>. </p>"
            },
            {
              "html": "If <var>position</var> is not past the end of <var>input</var> and the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point④\">code point</a> at <var>position</var> within <var>input</var> is U+0022 (\"):",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p>Append the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#collect-an-http-quoted-string\" id=\"ref-for-collect-an-http-quoted-string\">collecting an HTTP quoted string</a> from <var>input</var>,\n     given <var>position</var>, to <var>temporaryValue</var>. </p>"
                },
                {
                  "html": "If <var>position</var> is not past the end of <var>input</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>."
                }
              ]
            },
            {
              "html": "<p>Remove all <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-tab-or-space\" id=\"ref-for-http-tab-or-space②\">HTTP tab or space</a> from the start and end of <var>temporaryValue</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> <var>temporaryValue</var> to <var>values</var>. </p>"
            },
            {
              "html": "<p>Set <var>temporaryValue</var> to the empty string. </p>"
            },
            {
              "html": "<p>If <var>position</var> is past the end of <var>input</var>, then return <var>values</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point⑤\">code point</a> at <var>position</var> within <var>input</var> is U+002C (,). </p>"
            },
            {
              "html": "<p>Advance <var>position</var> by 1. </p>"
            }
          ]
        }
      ]
    },
    {
      "name": "header list/append",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-append",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-append\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">append</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header④\">header</a> (<var>name</var>, <var>value</var>) to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑧\">header list</a> <var>list</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①\">contains</a> <var>name</var>, then set <var>name</var> to the first such <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤\">header</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②\">name</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> (<var>name</var>, <var>value</var>) to <var>list</var>. </p>"
        }
      ]
    },
    {
      "name": "header list/delete",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-delete",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-delete\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">delete</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name⑤\">header name</a> <var>name</var> from a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list⑨\">header list</a> <var>list</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">remove</a> all <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑧\">headers</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name⑤\">name</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive④\">byte-case-insensitive</a> match for <var>name</var> from <var>list</var>.",
      "rationale": "To <dfn>"
    },
    {
      "name": "header list/set",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-set",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-set\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">set</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑨\">header</a> (<var>name</var>, <var>value</var>) in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①⓪\">header list</a> <var>list</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②\">contains</a> <var>name</var>, then set the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value②\">value</a> of the first such <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①⓪\">header</a> to <var>value</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">remove</a> the others. </p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">append</a> (<var>name</var>, <var>value</var>) to <var>list</var>. </p>"
        }
      ]
    },
    {
      "name": "header list/combine",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-combine",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-combine\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">combine</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①①\">header</a> (<var>name</var>, <var>value</var>) in a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①①\">header list</a> <var>list</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains③\">contains</a> <var>name</var>, then set the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value③\">value</a> of the first such <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①②\">header</a> to its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value④\">value</a>,\n followed by 0x2C 0x20, followed by <var>value</var>. </p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">append</a> (<var>name</var>, <var>value</var>) to <var>list</var>. </p>"
        }
      ]
    },
    {
      "name": "convert header names to a sorted-lowercase set",
      "href": "https://fetch.spec.whatwg.org/#convert-header-names-to-a-sorted-lowercase-set",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"convert-header-names-to-a-sorted-lowercase-set\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert header names to a sorted-lowercase set</dfn>, given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑤\">list</a> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name⑥\">names</a> <var>headerNames</var>, run these steps. They return an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">ordered set</a> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name⑥\">header names</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>headerNamesSet</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">ordered set</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>name</var> of <var>headerNames</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">append</a> the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-lowercase\" id=\"ref-for-byte-lowercase\">byte-lowercasing</a> <var>name</var> to <var>headerNamesSet</var>. </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-sort-in-ascending-order\" id=\"ref-for-list-sort-in-ascending-order\">sorting</a> <var>headerNamesSet</var> in ascending order\n with <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-less-than\" id=\"ref-for-byte-less-than\">byte less than</a>. </p>"
        }
      ]
    },
    {
      "name": "header list/sort and combine",
      "href": "https://fetch.spec.whatwg.org/#concept-header-list-sort-and-combine",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-list-sort-and-combine\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">sort and combine</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①②\">header list</a> <var>list</var>, run these steps. They return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①③\">header list</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>headers</var> be a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①④\">header list</a>. </p>"
        },
        {
          "html": "<p>Let <var>names</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#convert-header-names-to-a-sorted-lowercase-set\" id=\"ref-for-convert-header-names-to-a-sorted-lowercase-set\">convert header names to a sorted-lowercase set</a> with all the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name⑦\">names</a> of the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①③\">headers</a> in <var>list</var>. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>name</var> of <var>names</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>name</var> is `<code>set-cookie</code>`, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>values</var> be a list of all <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value⑤\">values</a> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①④\">headers</a> in <var>list</var> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name⑧\">name</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive⑤\">byte-case-insensitive</a> match for <var>name</var>, in order. </p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>value</var> of <var>values</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append④\">Append</a> (<var>name</var>, <var>value</var>) to <var>headers</var>. </p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>value</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get②\">getting</a> <var>name</var> from <var>list</var>. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: <var>value</var> is non-null. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑤\">Append</a> (<var>name</var>, <var>value</var>) to <var>headers</var>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>headers</var>. </p>"
        }
      ]
    },
    {
      "name": "header value/normalize",
      "href": "https://fetch.spec.whatwg.org/#concept-header-value-normalize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header value\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-header-value-normalize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">normalize</dfn> a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence④\">byte sequence</a> <var>potentialValue</var>, remove any leading and trailing <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-whitespace-byte\" id=\"ref-for-http-whitespace-byte\">HTTP whitespace bytes</a> from <var>potentialValue</var>.",
      "rationale": "To <dfn>"
    },
    {
      "name": "CORS-safelisted request-header",
      "href": "https://fetch.spec.whatwg.org/#cors-safelisted-request-header",
      "html": "To determine whether a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①⑤\">header</a> (<var>name</var>, <var>value</var>)\nis a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cors-safelisted-request-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CORS-safelisted request-header</dfn>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>value</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length\">length</a> is greater than 128, then return\n false. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-lowercase\" id=\"ref-for-byte-lowercase①\">Byte-lowercase</a> <var>name</var> and switch on the result:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "`accept`",
                  "html": "<p>If <var>value</var> contains a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-unsafe-request-header-byte\" id=\"ref-for-cors-unsafe-request-header-byte\">CORS-unsafe request-header byte</a>, then return false. </p>"
                },
                {
                  "case": "`accept-language`",
                  "html": "<p>If <var>value</var> contains a byte that is not in the range 0x30 (0) to 0x39 (9),\n   inclusive, is not in the range 0x41 (A) to 0x5A (Z), inclusive, is not in the range 0x61 (a) to\n   0x7A (z), inclusive, and is not 0x20 (SP), 0x2A (*), 0x2C (,), 0x2D (-), 0x2E (.), 0x3B (;), or\n   0x3D (=), then return false. </p>"
                },
                {
                  "case": "`content-language`",
                  "html": "<p>If <var>value</var> contains a byte that is not in the range 0x30 (0) to 0x39 (9),\n   inclusive, is not in the range 0x41 (A) to 0x5A (Z), inclusive, is not in the range 0x61 (a) to\n   0x7A (z), inclusive, and is not 0x20 (SP), 0x2A (*), 0x2C (,), 0x2D (-), 0x2E (.), 0x3B (;), or\n   0x3D (=), then return false. </p>"
                },
                {
                  "case": "`content-type`",
                  "html": "<p class=\"warning\">This intentionally does not use <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type\">extract a MIME type</a> as that algorithm is\n    rather forgiving and servers are not expected to implement it. </p>",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>value</var> contains a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-unsafe-request-header-byte\" id=\"ref-for-cors-unsafe-request-header-byte①\">CORS-unsafe request-header byte</a>, then return\n     false. </p>"
                    },
                    {
                      "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parse-a-mime-type\" id=\"ref-for-parse-a-mime-type\">parsing</a> the\n     result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-decode\" id=\"ref-for-isomorphic-decode①\">isomorphic decoding</a> <var>value</var>. </p>"
                    },
                    {
                      "html": "<p>If <var>mimeType</var> is failure, then return false. </p>"
                    },
                    {
                      "html": "<p>If <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence\">essence</a> is not\n     \"<code>application/x-www-form-urlencoded</code>\", \"<code>multipart/form-data</code>\", or\n     \"<code>text/plain</code>\", then return false. </p>"
                    }
                  ]
                },
                {
                  "case": "`range`",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>rangeValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#simple-range-header-value\" id=\"ref-for-simple-range-header-value\">parsing a single range header value</a> given <var>value</var> and false. </p>"
                    },
                    {
                      "html": "<p>If <var>rangeValue</var> is failure, then return false. </p>"
                    },
                    {
                      "html": "<p>If <var>rangeValue</var>[0] is null, then return false. </p>"
                    }
                  ]
                },
                {
                  "case": "Otherwise",
                  "html": "<p>Return false. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return true. </p>"
        }
      ]
    },
    {
      "name": "CORS-unsafe request-header names",
      "href": "https://fetch.spec.whatwg.org/#cors-unsafe-request-header-names",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cors-unsafe-request-header-names\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CORS-unsafe request-header names</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①⑤\">header list</a> <var>headers</var>, are determined as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>unsafeNames</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a>. </p>"
        },
        {
          "html": "<p>Let <var>potentiallyUnsafeNames</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑦\">list</a>. </p>"
        },
        {
          "html": "<p>Let <var>safelistValueSize</var> be 0. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>header</var> of <var>headers</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>header</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-safelisted-request-header\" id=\"ref-for-cors-safelisted-request-header\">CORS-safelisted request-header</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑥\">append</a> <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name⑨\">name</a> to <var>unsafeNames</var>. </p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑦\">append</a> <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①⓪\">name</a> to <var>potentiallyUnsafeNames</var> and increase <var>safelistValueSize</var> by <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value⑥\">value</a>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length①\">length</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>safelistValueSize</var> is greater than 1024, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">for each</a> <var>name</var> of <var>potentiallyUnsafeNames</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑧\">append</a> <var>name</var> to <var>unsafeNames</var>. </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#convert-header-names-to-a-sorted-lowercase-set\" id=\"ref-for-convert-header-names-to-a-sorted-lowercase-set①\">convert header names to a sorted-lowercase set</a> with <var>unsafeNames</var>. </p>"
        }
      ]
    },
    {
      "name": "no-CORS-safelisted request-header",
      "href": "https://fetch.spec.whatwg.org/#no-cors-safelisted-request-header",
      "html": "To determine whether a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①⑥\">header</a> (<var>name</var>, <var>value</var>) is a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"no-cors-safelisted-request-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">no-CORS-safelisted request-header</dfn>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cors-safelisted-request-header-name\" id=\"ref-for-no-cors-safelisted-request-header-name\">no-CORS-safelisted request-header name</a>, then return\n false. </p>"
        },
        {
          "html": "<p>Return whether (<var>name</var>, <var>value</var>) is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-safelisted-request-header\" id=\"ref-for-cors-safelisted-request-header①\">CORS-safelisted request-header</a>. </p>"
        }
      ]
    },
    {
      "name": "forbidden request-header",
      "href": "https://fetch.spec.whatwg.org/#forbidden-request-header",
      "html": "A <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header①⑦\">header</a> (<var>name</var>, <var>value</var>) is <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"forbidden-request-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">forbidden request-header</dfn> if these steps return true:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①⓪\">byte-case-insensitive</a> match for one of: </p>\n      <ul class=\"brief\">\n       <li>`<code>Accept-Charset</code>` \n       </li><li>`<code>Accept-Encoding</code>` \n       </li><li>`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-request-headers\" id=\"ref-for-http-access-control-request-headers\"><code>Access-Control-Request-Headers</code></a>` \n       </li><li>`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-request-method\" id=\"ref-for-http-access-control-request-method\"><code>Access-Control-Request-Method</code></a>` \n       </li><li>`<code>Connection</code>` \n       </li><li>`<code>Content-Length</code>` \n       </li><li>`<code>Cookie</code>` \n       </li><li>`<code>Cookie2</code>` \n       </li><li>`<code>Date</code>` \n       </li><li>`<code>DNT</code>` \n       </li><li>`<code>Expect</code>` \n       </li><li>`<code>Host</code>` \n       </li><li>`<code>Keep-Alive</code>` \n       </li><li>`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-origin\" id=\"ref-for-http-origin①\"><code>Origin</code></a>` \n       </li><li>`<code>Referer</code>` \n       </li><li>`<code>Set-Cookie</code>` \n       </li><li>`<code>TE</code>` \n       </li><li>`<code>Trailer</code>` \n       </li><li>`<code>Transfer-Encoding</code>` \n       </li><li>`<code>Upgrade</code>` \n       </li><li>`<code>Via</code>` \n      </li></ul>\n      <p>then return true. </p>"
        },
        {
          "html": "<p>If <var>name</var> when <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-lowercase\" id=\"ref-for-byte-lowercase②\">byte-lowercased</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-starts-with\" id=\"ref-for-byte-sequence-starts-with\">starts with</a> `<code>proxy-</code>` or `<code>sec-</code>`, then return true. </p>"
        },
        {
          "html": "then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>parsedValues</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value-get-decode-and-split\" id=\"ref-for-header-value-get-decode-and-split①\">getting, decoding, and splitting</a> <var>value</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> <var>method</var> of <var>parsedValues</var>: if the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode\">isomorphic encoding</a> of <var>method</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#forbidden-method\" id=\"ref-for-forbidden-method\">forbidden method</a>, then return true. </p>"
            }
          ]
        },
        {
          "html": "<p>Return false. </p>"
        }
      ]
    },
    {
      "name": "extract header values",
      "href": "https://fetch.spec.whatwg.org/#extract-header-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"extract header values|extracting header values\" id=\"extract-header-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract header values</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header②⓪\">header</a> <var>header</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If parsing <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value⑦\">value</a>, per the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abnf\" id=\"ref-for-abnf\">ABNF</a> for <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①①\">name</a>, fails, then return failure. </p>"
        },
        {
          "html": "<p>Return one or more <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value⑧\">values</a> resulting from parsing <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value⑨\">value</a>, per the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abnf\" id=\"ref-for-abnf①\">ABNF</a> for <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①②\">name</a>. </p>"
        }
      ]
    },
    {
      "name": "extract header list values",
      "href": "https://fetch.spec.whatwg.org/#extract-header-list-values",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"extract header list values|extracting header list values\" id=\"extract-header-list-values\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract header list values</dfn> given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name①⑥\">header name</a> <var>name</var> and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①⑥\">header list</a> <var>list</var>,\nrun these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains④\">does not contain</a> <var>name</var>, then return\n null. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abnf\" id=\"ref-for-abnf②\">ABNF</a> for <var>name</var> allows a single <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header②①\">header</a> and <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains⑤\">contains</a> more than one, then return failure. </p>"
        },
        {
          "html": "<p>Let <var>values</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑨\">list</a>. </p>"
        },
        {
          "html": "For each <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header②③\">header</a> <var>header</var> <var>list</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains⑥\">contains</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①③\">name</a> is <var>name</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>extract</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-values\" id=\"ref-for-extract-header-values\">extracting header values</a> from <var>header</var>. </p>"
            },
            {
              "html": "<p>If <var>extract</var> is failure, then return failure. </p>"
            },
            {
              "html": "<p>Append each <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value①⓪\">value</a> in <var>extract</var>, in order, to <var>values</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>values</var>. </p>"
        }
      ]
    },
    {
      "name": "build a content range",
      "href": "https://fetch.spec.whatwg.org/#build-a-content-range",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"build-a-content-range\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">build a content range</dfn> given an integer <var>rangeStart</var>, an integer <var>rangeEnd</var>, and an integer <var>fullLength</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>contentRange</var> be `<code>bytes </code>`. </p>"
        },
        {
          "html": "<p>Append <var>rangeStart</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode①\">isomorphic encoded</a>, to <var>contentRange</var>. </p>"
        },
        {
          "html": "<p>Append 0x2D (-) to <var>contentRange</var>. </p>"
        },
        {
          "html": "<p>Append <var>rangeEnd</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer①\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode②\">isomorphic encoded</a> to <var>contentRange</var>. </p>"
        },
        {
          "html": "<p>Append 0x2F (/) to <var>contentRange</var>. </p>"
        },
        {
          "html": "<p>Append <var>fullLength</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer②\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode③\">isomorphic encoded</a> to <var>contentRange</var>. </p>"
        },
        {
          "html": "<p>Return <var>contentRange</var>. </p>"
        }
      ]
    },
    {
      "name": "parse a single range header value",
      "href": "https://fetch.spec.whatwg.org/#simple-range-header-value",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"simple-range-header-value\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">parse a single range header value</dfn> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑤\">byte sequence</a> <var>value</var> and a boolean <var>allowWhitespace</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>data</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-decode\" id=\"ref-for-isomorphic-decode②\">isomorphic decoding</a> of <var>value</var>. </p>"
        },
        {
          "html": "<p>If <var>data</var> does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with\">start with</a> \"<code>bytes</code>\", then return\n failure. </p>"
        },
        {
          "html": "<p>Let <var>position</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-position-variable\" id=\"ref-for-string-position-variable④\">position variable</a> for <var>data</var>, initially\n pointing at the 5th <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point⑥\">code point</a> of <var>data</var>. </p>"
        },
        {
          "html": "<p>If <var>allowWhitespace</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points②\">collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-tab-or-space\" id=\"ref-for-http-tab-or-space③\">HTTP tab or space</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point⑦\">code point</a> at <var>position</var> within <var>data</var> is not U+003D (=),\n then return failure. </p>"
        },
        {
          "html": "<p>Advance <var>position</var> by 1. </p>"
        },
        {
          "html": "<p>If <var>allowWhitespace</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points③\">collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-tab-or-space\" id=\"ref-for-http-tab-or-space④\">HTTP tab or space</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>Let <var>rangeStart</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points④\">collecting a sequence of code points</a> that\n are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-digit\" id=\"ref-for-ascii-digit\">ASCII digits</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>Let <var>rangeStartValue</var> be <var>rangeStart</var>, interpreted as decimal number, if <var>rangeStart</var> is not the empty string; otherwise null. </p>"
        },
        {
          "html": "<p>If <var>allowWhitespace</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points⑤\">collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-tab-or-space\" id=\"ref-for-http-tab-or-space⑤\">HTTP tab or space</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point⑧\">code point</a> at <var>position</var> within <var>data</var> is not U+002D (-),\n then return failure. </p>"
        },
        {
          "html": "<p>Advance <var>position</var> by 1. </p>"
        },
        {
          "html": "<p>If <var>allowWhitespace</var> is true, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points⑥\">collect a sequence of code points</a> that are <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-tab-or-space\" id=\"ref-for-http-tab-or-space⑥\">HTTP tab or space</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>Let <var>rangeEnd</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points⑦\">collecting a sequence of code points</a> that\n are <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-digit\" id=\"ref-for-ascii-digit①\">ASCII digits</a>, from <var>data</var> given <var>position</var>. </p>"
        },
        {
          "html": "<p>Let <var>rangeEndValue</var> be <var>rangeEnd</var>, interpreted as decimal number, if <var>rangeEnd</var> is not the empty string; otherwise null. </p>"
        },
        {
          "html": "<p>If <var>position</var> is not past the end of <var>data</var>, then return failure. </p>"
        },
        {
          "html": "<p>If <var>rangeEndValue</var> and <var>rangeStartValue</var> are null, then return failure. </p>"
        },
        {
          "html": "<p>If <var>rangeStartValue</var> and <var>rangeEndValue</var> are numbers, and <var>rangeStartValue</var> is greater than <var>rangeEndValue</var>, then return failure. </p>"
        },
        {
          "html": "<p>Return (<var>rangeStartValue</var>, <var>rangeEndValue</var>). </p>"
        }
      ]
    },
    {
      "name": "body/clone",
      "href": "https://fetch.spec.whatwg.org/#concept-body-clone",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"body\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-body-clone\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clone</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body\">body</a> <var>body</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let « <var>out1</var>, <var>out2</var> » be the result of <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-tee\" id=\"ref-for-readablestream-tee\">teeing</a> <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream\">stream</a>. </p>"
        },
        {
          "html": "<p>Set <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream①\">stream</a> to <var>out1</var>. </p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body①\">body</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream②\">stream</a> is <var>out2</var> and other members are copied from <var>body</var>. </p>"
        }
      ]
    },
    {
      "name": "body/incrementally read",
      "href": "https://fetch.spec.whatwg.org/#body-incrementally-read",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"body\" data-dfn-type=\"dfn\" data-export=\"\" id=\"body-incrementally-read\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">incrementally read</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body②\">body</a> <var>body</var>, given an\nalgorithm <var>processBodyChunk</var>, an algorithm <var>processEndOfBody</var>, an algorithm <var>processBodyError</var>, and an optional null, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue\" id=\"ref-for-parallel-queue③\">parallel queue</a>, or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object④\">global object</a> <var>taskDestination</var> (default null), run these steps. <var>processBodyChunk</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑧\">byte sequence</a>. <var>processEndOfBody</var> must be an algorithm accepting no arguments. <var>processBodyError</var> must be an algorithm accepting an exception.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>taskDestination</var> is null, then set <var>taskDestination</var> to the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue\">starting a new parallel queue</a>. </p>"
        },
        {
          "html": "<p>Let <var>reader</var> be the result of <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-get-a-reader\" id=\"ref-for-readablestream-get-a-reader\">getting a reader</a> for <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream③\">stream</a>. </p>"
        },
        {
          "html": "<p>Perform the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#incrementally-read-loop\" id=\"ref-for-incrementally-read-loop\">incrementally-read loop</a> given <var>reader</var>, <var>taskDestination</var>, <var>processBodyChunk</var>, <var>processEndOfBody</var>, and <var>processBodyError</var>. </p>"
        }
      ]
    },
    {
      "name": "incrementally-read loop",
      "href": "https://fetch.spec.whatwg.org/#incrementally-read-loop",
      "html": "To perform the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"incrementally-read-loop\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">incrementally-read loop</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestreamdefaultreader\" id=\"ref-for-readablestreamdefaultreader\">ReadableStreamDefaultReader</a></code> object <var>reader</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue\" id=\"ref-for-parallel-queue④\">parallel queue</a> or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object⑤\">global object</a> <var>taskDestination</var>, algorithm <var>processBodyChunk</var>, algorithm <var>processEndOfBody</var>, and algorithm <var>processBodyError</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>readRequest</var> be the following <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#read-request\" id=\"ref-for-read-request\">read request</a>: </p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#read-request-chunk-steps\" id=\"ref-for-read-request-chunk-steps\">chunk steps</a>, given <var>chunk</var> \n       </dt><dd>\n        \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#read-request-close-steps\" id=\"ref-for-read-request-close-steps\">close steps</a> \n       </dt><dd>\n        \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#read-request-error-steps\" id=\"ref-for-read-request-error-steps\">error steps</a>, given <var>e</var> \n       </dt><dd>\n        \n      </dd></dl>",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>continueAlgorithm</var> be null. </p>"
            },
            {
              "html": "<p>If <var>chunk</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\" id=\"ref-for-idl-Uint8Array\">Uint8Array</a></code> object, then set <var>continueAlgorithm</var> to this step: run <var>processBodyError</var> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>. </p>"
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>bytes</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy\">copy of</a> <var>chunk</var>. </p>"
                },
                {
                  "html": "Set <var>continueAlgorithm</var> to these steps:",
                  "rationale": "run",
                  "steps": [
                    {
                      "html": "<p>Run <var>processBodyChunk</var> given <var>bytes</var>. </p>"
                    },
                    {
                      "html": "<p>Perform the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#incrementally-read-loop\" id=\"ref-for-incrementally-read-loop①\">incrementally-read loop</a> given <var>reader</var>, <var>taskDestination</var>, <var>processBodyChunk</var>, <var>processEndOfBody</var>, and <var>processBodyError</var>. </p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task\">Queue a fetch task</a> given <var>continueAlgorithm</var> and <var>taskDestination</var>. </p>"
            }
          ],
          "additional": [
            {
              "html": "",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task①\">Queue a fetch task</a> given <var>processEndOfBody</var> and <var>taskDestination</var>.</p>"
                }
              ]
            },
            {
              "html": "",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task②\">Queue a fetch task</a> to run <var>processBodyError</var> given <var>e</var>,\n   with <var>taskDestination</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-a-chunk\" id=\"ref-for-readablestreamdefaultreader-read-a-chunk\">Read a chunk</a> from <var>reader</var> given <var>readRequest</var>. </p>"
        }
      ]
    },
    {
      "name": "body/fully read",
      "href": "https://fetch.spec.whatwg.org/#body-fully-read",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"body\" data-dfn-type=\"dfn\" data-export=\"\" id=\"body-fully-read\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fully read</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body③\">body</a> <var>body</var>, given an algorithm <var>processBody</var>, an algorithm <var>processBodyError</var>, and an optional null, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue\" id=\"ref-for-parallel-queue⑤\">parallel queue</a>, or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object⑥\">global object</a> <var>taskDestination</var> (default\nnull), run these steps. <var>processBody</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence⑨\">byte sequence</a>. <var>processBodyError</var> must be an algorithm optionally accepting an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\" id=\"ref-for-dfn-exception\">exception</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>taskDestination</var> is null, then set <var>taskDestination</var> to the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue①\">starting a new parallel queue</a>. </p>"
        },
        {
          "html": "<p>Let <var>successSteps</var> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⓪\">byte sequence</a> <var>bytes</var> be to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task③\">queue a fetch task</a> to run <var>processBody</var> given <var>bytes</var>, with <var>taskDestination</var>. </p>"
        },
        {
          "html": "<p>Let <var>errorSteps</var> optionally given an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\" id=\"ref-for-dfn-exception①\">exception</a> <var>exception</var> be\n to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task④\">queue a fetch task</a> to run <var>processBodyError</var> given <var>exception</var>, with <var>taskDestination</var>. </p>"
        },
        {
          "html": "<p>Let <var>reader</var> be the result of <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-get-a-reader\" id=\"ref-for-readablestream-get-a-reader①\">getting a reader</a> for <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream④\">stream</a>. If that threw an exception, then run <var>errorSteps</var> with that exception and return. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-all-bytes\" id=\"ref-for-readablestreamdefaultreader-read-all-bytes\">Read all bytes</a> from <var>reader</var>, given <var>successSteps</var> and <var>errorSteps</var>. </p>"
        }
      ]
    },
    {
      "name": "handle content codings",
      "href": "https://fetch.spec.whatwg.org/#handle-content-codings",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"handle-content-codings\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">handle content codings</dfn> given <var>codings</var> and <var>bytes</var>, run\nthese steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>codings</var> are not supported, then return <var>bytes</var>. </p>"
        },
        {
          "html": "<p>Return the result of decoding <var>bytes</var> with <var>codings</var> as explained in HTTP,\n if decoding does not result in an error, and failure otherwise. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http\" title=\"HTTP Semantics\">[HTTP]</a> </p>"
        }
      ]
    },
    {
      "name": "request/redirect-tainted origin",
      "href": "https://fetch.spec.whatwg.org/#concept-request-tainted-origin",
      "html": "A <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑥⑨\">request</a> <var>request</var> has a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-request-tainted-origin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">redirect-tainted origin</dfn> if these steps\nreturn true:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①\">origin</a> is not\n \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>Let <var>lastURL</var> be null. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>url</var> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list③\">URL list</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>lastURL</var> is null, then set <var>lastURL</var> to <var>url</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>. </p>"
            },
            {
              "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin\">same origin</a> with <var>lastURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①\">origin</a> and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②\">origin</a> is\n   not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①\">same origin</a> with <var>lastURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②\">origin</a>, then return true. </p>"
            },
            {
              "html": "Set <var>lastURL</var> to <var>url</var>."
            }
          ]
        },
        {
          "html": "Return false."
        }
      ]
    },
    {
      "name": "Serializing a request origin",
      "href": "https://fetch.spec.whatwg.org/#serializing-a-request-origin",
      "html": "<dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"serializing-a-request-origin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Serializing a request origin</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦⓪\">request</a> <var>request</var>, is to\nrun these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin③\">origin</a> is not\n \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>If <var>request</var> has a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-tainted-origin\" id=\"ref-for-concept-request-tainted-origin\">redirect-tainted origin</a>, then return\n \"<code>null</code>\". </p>"
        },
        {
          "html": "<p>Return <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin④\">origin</a>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin\">serialized</a>. </p>"
        }
      ]
    },
    {
      "name": "request/clone",
      "href": "https://fetch.spec.whatwg.org/#concept-request-clone",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-request-clone\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clone</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦②\">request</a> <var>request</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>newRequest</var> be a copy of <var>request</var>, except for its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body\">body</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①\">body</a> is non-null, set <var>newRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②\">body</a> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-clone\" id=\"ref-for-concept-body-clone\">cloning</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body③\">body</a>. </p>"
        },
        {
          "html": "<p>Return <var>newRequest</var>. </p>"
        }
      ]
    },
    {
      "name": "request/add a range header",
      "href": "https://fetch.spec.whatwg.org/#concept-request-add-range-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-request-add-range-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">add a range header</dfn> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦③\">request</a> <var>request</var>, with an integer <var>first</var>, and an optional integer <var>last</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: <var>last</var> is not given, or <var>first</var> is less than or equal\n to <var>last</var>. </p>"
        },
        {
          "html": "<p>Let <var>rangeValue</var> be `<code>bytes=</code>`. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer③\">Serialize</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode⑤\">isomorphic encode</a> <var>first</var>,\n and append the result to <var>rangeValue</var>. </p>"
        },
        {
          "html": "<p>Append 0x2D (-) to <var>rangeValue</var>. </p>"
        },
        {
          "html": "<p>If <var>last</var> is given, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer④\">serialize</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode⑥\">isomorphic encode</a> it, and append the result to <var>rangeValue</var>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append\">Append</a> (`<code>Range</code>`, <var>rangeValue</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②\">header list</a>. </p>"
        }
      ]
    },
    {
      "name": "serialize a response URL for reporting",
      "href": "https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"serialize-a-response-url-for-reporting\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">serialize a response URL for reporting</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response①\">response</a> <var>response</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list\">URL list</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is not empty</a>. </p>"
        },
        {
          "html": "<p>Let <var>url</var> be a copy of <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list①\">URL list</a>[0]. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#set-the-username\" id=\"ref-for-set-the-username\">Set the username</a> given <var>url</var> and the empty string. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#set-the-password\" id=\"ref-for-set-the-password\">Set the password</a> given <var>url</var> and the empty string. </p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer\">serialization</a> of <var>url</var> with <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#url-serializer-exclude-fragment\" id=\"ref-for-url-serializer-exclude-fragment\"><i>exclude fragment</i></a> set to true. </p>"
        }
      ]
    },
    {
      "name": "Cross-Origin-Embedder-Policy allows credentials",
      "href": "https://fetch.spec.whatwg.org/#cross-origin-embedder-policy-allows-credentials",
      "html": "To check if <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cross-origin-embedder-policy-allows-credentials\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Cross-Origin-Embedder-Policy allows credentials</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦④\">request</a> <var>request</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑤\">origin</a> is not\n \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode④\">mode</a> is not \"<code>no-cors</code>\", then return\n true.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②\">client</a> is null, then return true.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client③\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container\">policy container</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-embedder-policy\" id=\"ref-for-policy-container-embedder-policy\">embedder policy</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value-2\" id=\"ref-for-embedder-policy-value-2\">value</a> is not\n \"<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#coep-credentialless\" id=\"ref-for-coep-credentialless\"><code>credentialless</code></a>\", then return true.</p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑥\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin②\">same origin</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin③\">origin</a> and <var>request</var> does not have a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-tainted-origin\" id=\"ref-for-concept-request-tainted-origin①\">redirect-tainted origin</a>, then return true.</p>"
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "appropriate network error",
      "href": "https://fetch.spec.whatwg.org/#appropriate-network-error",
      "html": "To create the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"appropriate-network-error\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">appropriate network error</dfn> given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params②\">fetch params</a> <var>fetchParams</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①③\">Assert</a>: <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled\">canceled</a>. </p>"
        },
        {
          "html": "<p>Return an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-aborted-network-error\" id=\"ref-for-concept-aborted-network-error\">aborted network error</a> if <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-aborted\" id=\"ref-for-fetch-params-aborted\">aborted</a>; otherwise return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤\">network error</a>. </p>"
        }
      ]
    },
    {
      "name": "response/clone",
      "href": "https://fetch.spec.whatwg.org/#concept-response-clone",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"response\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-response-clone\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clone</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③⓪\">response</a> <var>response</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response⑨\">filtered response</a>, then return a new identical <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response①⓪\">filtered response</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response⑥\">internal response</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-clone\" id=\"ref-for-concept-response-clone\">clone</a> of <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response⑦\">internal response</a>. </p>"
        },
        {
          "html": "<p>Let <var>newResponse</var> be a copy of <var>response</var>, except for its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body⑤\">body</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body⑥\">body</a> is non-null, then set <var>newResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body⑦\">body</a> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-clone\" id=\"ref-for-concept-body-clone①\">cloning</a> <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body⑧\">body</a>. </p>"
        },
        {
          "html": "<p>Return <var>newResponse</var>. </p>"
        }
      ]
    },
    {
      "name": "response/location URL",
      "href": "https://fetch.spec.whatwg.org/#concept-response-location-url",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"response\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-response-location-url\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">location URL</dfn> of a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③④\">response</a> <var>response</var>, given null or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-string\" id=\"ref-for-ascii-string①\">ASCII string</a> <var>requestFragment</var>, is the value returned by the following steps. They return null, failure,\nor a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①②\">URL</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status③\">status</a> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status①\">redirect status</a>, then\n return null. </p>"
        },
        {
          "html": "<p>Let <var>location</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values\">extracting header list values</a> given\n `<code>Location</code>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑦\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>location</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑦\">header value</a>, then set <var>location</var> to the\n  result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser\">parsing</a> <var>location</var> with <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url①\">URL</a>. </p>"
        },
        {
          "html": "<p>If <var>location</var> is a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①③\">URL</a> whose <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment\">fragment</a> is null, then set <var>location</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment①\">fragment</a> to <var>requestFragment</var>. </p>"
        },
        {
          "html": "<p>Return <var>location</var>. </p>"
        }
      ]
    },
    {
      "name": "destination/translate",
      "href": "https://fetch.spec.whatwg.org/#concept-potential-destination-translate",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"destination\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-potential-destination-translate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">translate</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-potential-destination\" id=\"ref-for-concept-potential-destination\">potential destination</a> <var>potentialDestination</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>potentialDestination</var> is \"<code>fetch</code>\", then return the empty string. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①④\">Assert</a>: <var>potentialDestination</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑦\">destination</a>. </p>"
        },
        {
          "html": "<p>Return <var>potentialDestination</var>. </p>"
        }
      ]
    },
    {
      "name": "resolve an origin",
      "href": "https://fetch.spec.whatwg.org/#resolve-an-origin",
      "html": "<a class=\"tracking-vector\" href=\"https://infra.spec.whatwg.org/#tracking-vector\" style=\"color: currentcolor\"><img alt=\"(This is a tracking vector.)\" class=\"darkmode-aware\" crossorigin=\"\" height=\"64\" src=\"https://resources.whatwg.org/tracking-vector.svg\" title=\"There is a tracking vector here.\" width=\"46\"></a> To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"resolve-an-origin\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">resolve an origin<span id=\"resolve-a-domain\"></span></dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#network-partition-key\" id=\"ref-for-network-partition-key\">network partition key</a> <var>key</var> and an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin②\">origin</a> <var>origin</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host\">host</a> is an <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#ip-address\" id=\"ref-for-ip-address\">IP address</a>, then return\n « <var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host①\">host</a> ». </p>"
        },
        {
          "html": "<p>If <var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host②\">host</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-public-suffix\" id=\"ref-for-host-public-suffix\">public suffix</a> is\n \"<code>localhost</code>\" or \"<code>localhost.</code>\", then return « <code>::1</code>, <code>127.0.0.1</code> ». </p>"
        },
        {
          "html": "<p>Perform an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②\">implementation-defined</a> operation to turn <var>origin</var> into a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">set</a> of one or more <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#ip-address\" id=\"ref-for-ip-address①\">IP addresses</a>. </p>\n      <p>It is also <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined③\">implementation-defined</a> whether other operations might be performed to get\n  connection information beyond just <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#ip-address\" id=\"ref-for-ip-address②\">IP addresses</a>. For example, if <var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-scheme\" id=\"ref-for-concept-origin-scheme\">scheme</a> is an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme②\">HTTP(S) scheme</a>, the implementation might perform a DNS query\n  for HTTPS RRs. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-svcb\" title=\"Service binding and parameter specification via the DNS (DNS SVCB and HTTPS RRs)\">[SVCB]</a> </p>\n      <p>If this operation succeeds, return the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#ip-address\" id=\"ref-for-ip-address③\">IP addresses</a> and any\n  additional <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined④\">implementation-defined</a> information. </p>"
        },
        {
          "html": "<p>Return failure. </p>"
        }
      ]
    },
    {
      "name": "clamp and coarsen connection timing info",
      "href": "https://fetch.spec.whatwg.org/#clamp-and-coarsen-connection-timing-info",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"clamp-and-coarsen-connection-timing-info\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clamp and coarsen connection timing info</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info②\">connection timing info</a> <var>timingInfo</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/hr-time/#dom-domhighrestimestamp\" id=\"ref-for-dom-domhighrestimestamp②\">DOMHighResTimeStamp</a></code> <var>defaultStartTime</var>, and a boolean <var>crossOriginIsolatedCapability</var>, run these\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time\">connection start time</a> is\n less than <var>defaultStartTime</var>, then return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info③\">connection timing info</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-start-time\" id=\"ref-for-connection-timing-info-domain-lookup-start-time\">domain lookup start time</a> is <var>defaultStartTime</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-end-time\" id=\"ref-for-connection-timing-info-domain-lookup-end-time\">domain lookup end time</a> is <var>defaultStartTime</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time①\">connection start time</a> is <var>defaultStartTime</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-end-time\" id=\"ref-for-connection-timing-info-connection-end-time\">connection end time</a> is <var>defaultStartTime</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-secure-connection-start-time\" id=\"ref-for-connection-timing-info-secure-connection-start-time\">secure connection start time</a> is <var>defaultStartTime</var>,\n and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol\">ALPN negotiated protocol</a> is <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol①\">ALPN negotiated protocol</a>. </p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info④\">connection timing info</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-start-time\" id=\"ref-for-connection-timing-info-domain-lookup-start-time①\">domain lookup start time</a> is the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsen-time\" id=\"ref-for-dfn-coarsen-time\">coarsen time</a> given <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-start-time\" id=\"ref-for-connection-timing-info-domain-lookup-start-time②\">domain lookup start time</a> and <var>crossOriginIsolatedCapability</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-end-time\" id=\"ref-for-connection-timing-info-domain-lookup-end-time①\">domain lookup end time</a> is the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsen-time\" id=\"ref-for-dfn-coarsen-time①\">coarsen time</a> given <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-end-time\" id=\"ref-for-connection-timing-info-domain-lookup-end-time②\">domain lookup end time</a> and <var>crossOriginIsolatedCapability</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time②\">connection start time</a> is the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsen-time\" id=\"ref-for-dfn-coarsen-time②\">coarsen time</a> given <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time③\">connection start time</a> and <var>crossOriginIsolatedCapability</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-end-time\" id=\"ref-for-connection-timing-info-connection-end-time①\">connection end time</a> is the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsen-time\" id=\"ref-for-dfn-coarsen-time③\">coarsen time</a> given <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-end-time\" id=\"ref-for-connection-timing-info-connection-end-time②\">connection end time</a> and <var>crossOriginIsolatedCapability</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-secure-connection-start-time\" id=\"ref-for-connection-timing-info-secure-connection-start-time①\">secure connection start time</a> is the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsen-time\" id=\"ref-for-dfn-coarsen-time④\">coarsen time</a> given <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-end-time\" id=\"ref-for-connection-timing-info-connection-end-time③\">connection end time</a> and <var>crossOriginIsolatedCapability</var>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol②\">ALPN negotiated protocol</a> is <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol③\">ALPN negotiated protocol</a>. </p>"
        }
      ]
    },
    {
      "name": "obtain a connection",
      "href": "https://fetch.spec.whatwg.org/#concept-connection-obtain",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-connection-obtain\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">obtain a connection</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#network-partition-key\" id=\"ref-for-network-partition-key②\">network partition key</a> <var>key</var>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①④\">URL</a> <var>url</var>, boolean <var>credentials</var>, an optional <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#new-connection-setting\" id=\"ref-for-new-connection-setting\">new connection setting</a> <var>new</var> (default\n\"<code>no</code>\"), and an optional boolean <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"obtain a connection\" data-dfn-type=\"dfn\" data-export=\"\" id=\"obtain-a-connection-requireunreliable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>requireUnreliable</var></dfn> (default false), run these\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>new</var> is \"<code>no</code>\", then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>connections</var> be a set of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection②\">connections</a> in the user agent’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection-pool\" id=\"ref-for-concept-connection-pool①\">connection pool</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-key\" id=\"ref-for-connection-key\">key</a> is <var>key</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-origin\" id=\"ref-for-connection-origin\">origin</a> is <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin④\">origin</a>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-credentials\" id=\"ref-for-connection-credentials\">credentials</a> is <var>credentials</var>. </p>"
            },
            {
              "html": "<p>If <var>connections</var> is not empty and <var>requireUnreliable</var> is false, then\n   return one of <var>connections</var>. </p>"
            },
            {
              "html": "<p>If there is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection③\">connection</a> capable of supporting unreliable transport in <var>connections</var>, e.g., HTTP/3, then return that <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection④\">connection</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>proxies</var> be the result of finding proxies for <var>url</var> in an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑤\">implementation-defined</a> manner. If there are no proxies, let <var>proxies</var> be\n  « \"<code>DIRECT</code>\" ». </p>"
        },
        {
          "html": "<p>Let <var>timingInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info⑤\">connection timing info</a>. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> <var>proxy</var> of <var>proxies</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-start-time\" id=\"ref-for-connection-timing-info-domain-lookup-start-time③\">domain lookup start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-unsafe-shared-current-time\" id=\"ref-for-dfn-unsafe-shared-current-time\">unsafe shared current time</a>. </p>"
            },
            {
              "html": "<p>Let <var>hosts</var> be « <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑤\">origin</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host\" id=\"ref-for-concept-origin-host③\">host</a> ». </p>"
            },
            {
              "html": "<p>If <var>proxy</var> is \"<code>DIRECT</code>\", then set <var>hosts</var> to the result of\n   running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#resolve-an-origin\" id=\"ref-for-resolve-an-origin②\">resolve an origin</a> given <var>key</var> and <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑥\">origin</a>. </p>"
            },
            {
              "html": "<p>If <var>hosts</var> is failure, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>. </p>"
            },
            {
              "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-domain-lookup-end-time\" id=\"ref-for-connection-timing-info-domain-lookup-end-time③\">domain lookup end time</a> to\n   the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-unsafe-shared-current-time\" id=\"ref-for-dfn-unsafe-shared-current-time①\">unsafe shared current time</a>. </p>"
            },
            {
              "html": "<p>Let <var>connection</var> be the result of running this step: run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#create-a-connection\" id=\"ref-for-create-a-connection\">create a connection</a> given <var>key</var>, <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑦\">origin</a>, <var>credentials</var>, <var>proxy</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑥\">implementation-defined</a> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host\">host</a> from <var>hosts</var>, <var>timingInfo</var>, and <var>requireUnreliable</var> an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑦\">implementation-defined</a> number\n    of times, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a> from each other, and wait for at least 1 to return a value. In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑧\">implementation-defined</a> manner, select a value to return from the returned values and\n    return it. Any other returned values that are <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection⑤\">connections</a> may be closed. </p>"
            },
            {
              "html": "<p>If <var>connection</var> is failure, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>. </p>"
            },
            {
              "html": "<p>If <var>new</var> is not \"<code>yes-and-dedicated</code>\", then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">append</a> <var>connection</var> to the user agent’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection-pool\" id=\"ref-for-concept-connection-pool②\">connection pool</a>. </p>"
            },
            {
              "html": "<p>Return <var>connection</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Return failure. </p>"
        }
      ]
    },
    {
      "name": "create a connection",
      "href": "https://fetch.spec.whatwg.org/#create-a-connection",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-connection\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a connection</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#network-partition-key\" id=\"ref-for-network-partition-key③\">network partition key</a> <var>key</var>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin④\">origin</a> <var>origin</var>, boolean <var>credentials</var>, string <var>proxy</var>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-host\" id=\"ref-for-concept-host①\">host</a> <var>host</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info\" id=\"ref-for-connection-timing-info⑥\">connection timing info</a> <var>timingInfo</var>, and\nboolean <var>requireUnreliable</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-connection-start-time\" id=\"ref-for-connection-timing-info-connection-start-time④\">connection start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-unsafe-shared-current-time\" id=\"ref-for-dfn-unsafe-shared-current-time②\">unsafe shared current time</a>. </p>"
        },
        {
          "html": "<p>Let <var>connection</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection⑨\">connection</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-key\" id=\"ref-for-connection-key①\">key</a> is <var>key</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-origin\" id=\"ref-for-connection-origin①\">origin</a> is <var>origin</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-credentials\" id=\"ref-for-connection-credentials③\">credentials</a> is <var>credentials</var>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection-timing-info\" id=\"ref-for-concept-connection-timing-info\">timing info</a> is <var>timingInfo</var>. <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#record-connection-timing-info\" id=\"ref-for-record-connection-timing-info\">Record connection timing info</a> given <var>connection</var> and use <var>connection</var> to establish an HTTP connection to <var>host</var>, taking <var>proxy</var> and <var>origin</var> into account, with the following caveats: <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http\" title=\"HTTP Semantics\">[HTTP]</a> <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http1\" title=\"HTTP/1.1\">[HTTP1]</a> <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-tls\" title=\"The Transport Layer Security (TLS) Protocol Version 1.3\">[TLS]</a> </p>\n      <ul>\n       <li>\n        <p>If <var>requireUnreliable</var> is true, then establish a connection capable of unreliable\n   transport, e.g., an HTTP/3 connection. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http3\" title=\"HTTP/3\">[HTTP3]</a> </p>\n       </li><li>\n        <p>When establishing a connection capable of unreliable transport, enable options that are\n   necessary for WebTransport. For HTTP/3, this means including <code>SETTINGS_ENABLE_WEBTRANSPORT</code> with a value of <code>1</code> and <code>H3_DATAGRAM</code> with a value of <code>1</code> in the initial <code>SETTINGS</code> frame. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-webtransport-http3\" title=\"WebTransport over HTTP/3\">[WEBTRANSPORT-HTTP3]</a> <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http3-datagram\" title=\"HTTP Datagrams and the Capsule Protocol\">[HTTP3-DATAGRAM]</a> </p>\n       </li><li>\n        <p>If <var>credentials</var> is false, then do not send a TLS client certificate. </p>\n       </li><li>\n        <p>If establishing a connection does not succeed (e.g., a UDP, TCP, or TLS error), then\n   return failure. </p>\n      </li></ul>"
        },
        {
          "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#connection-timing-info-alpn-negotiated-protocol\" id=\"ref-for-connection-timing-info-alpn-negotiated-protocol④\">ALPN negotiated protocol</a> to <var>connection</var>’s ALPN Protocol ID, with the following caveats: <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-rfc7301\" title=\"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension\">[RFC7301]</a> </p>\n      <ul>\n       <li>\n        <p>When a proxy is configured, if a tunnel connection is established then this must be the\n   ALPN Protocol ID of the tunneled protocol, otherwise it must be the ALPN Protocol ID of the first\n   hop to the proxy. </p>\n       </li><li>\n        <p>In case the user agent is using an experimental, non-registered protocol, the user agent must\n    use the used ALPN Protocol ID, if any. If ALPN was not used for protocol negotiations, the user\n    agent may use another descriptive string. </p>\n        \n      </li></ul>"
        },
        {
          "html": "<p>Return <var>connection</var>. </p>"
        }
      ]
    },
    {
      "name": "determine the network partition key",
      "href": "https://fetch.spec.whatwg.org/#determine-the-network-partition-key",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"determine-the-network-partition-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the network partition key</dfn>, given an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment\" id=\"ref-for-environment②\">environment</a> <var>environment</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>topLevelOrigin</var> be <var>environment</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin\">top-level origin</a>. </p>"
        },
        {
          "html": "<p>If <var>topLevelOrigin</var> is null, then set <var>topLevelOrigin</var> to <var>environment</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-creation-url\" id=\"ref-for-concept-environment-top-level-creation-url\">top-level creation URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑧\">origin</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑤\">Assert</a>: <var>topLevelOrigin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin\" id=\"ref-for-concept-origin⑤\">origin</a>. </p>"
        },
        {
          "html": "<p>Let <var>topLevelSite</var> be the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#obtain-a-site\" id=\"ref-for-obtain-a-site\">obtaining a site</a>,\n given <var>topLevelOrigin</var>. </p>"
        },
        {
          "html": "<p>Let <var>secondKey</var> be null or an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⓪\">implementation-defined</a> value. </p>\n      <p class=\"XXX\">The second key is intentionally a little vague as the finer points are still\n  evolving. See <a href=\"https://github.com/whatwg/fetch/issues/1035\">issue #1035</a>. </p>"
        },
        {
          "html": "<p>Return (<var>topLevelSite</var>, <var>secondKey</var>). </p>"
        }
      ]
    },
    {
      "name": "request/determine the network partition key",
      "href": "https://fetch.spec.whatwg.org/#request-determine-the-network-partition-key",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-determine-the-network-partition-key\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the network partition key</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦⑦\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client\">reserved client</a> is non-null, then return the\n result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#determine-the-network-partition-key\" id=\"ref-for-determine-the-network-partition-key\">determining the network partition key</a> given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client①\">reserved client</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client④\">client</a> is non-null, then return the\n result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#determine-the-network-partition-key\" id=\"ref-for-determine-the-network-partition-key①\">determining the network partition key</a> given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑤\">client</a>. </p>"
        },
        {
          "html": "<p>Return null. </p>"
        }
      ]
    },
    {
      "name": "determine the HTTP cache partition",
      "href": "https://fetch.spec.whatwg.org/#determine-the-http-cache-partition",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-http-cache-partition\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the HTTP cache partition</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦⑧\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>key</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-determine-the-network-partition-key\" id=\"ref-for-request-determine-the-network-partition-key\">determining the network partition key</a> given <var>request</var>. </p>"
        },
        {
          "html": "<p>If <var>key</var> is null, then return null. </p>"
        },
        {
          "html": "<p>Return the unique HTTP cache associated with <var>key</var>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http-caching\" title=\"HTTP Caching\">[HTTP-CACHING]</a> </p>"
        }
      ]
    },
    {
      "name": "block bad port",
      "href": "https://fetch.spec.whatwg.org/#block-bad-port",
      "html": "To determine whether fetching a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑦⑨\">request</a> <var>request</var> <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"block bad port\" id=\"block-bad-port\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">should be blocked due to a bad port</dfn>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>url</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②\">current URL</a>. </p>"
        },
        {
          "html": "<p>If <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①\">scheme</a> is an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme③\">HTTP(S) scheme</a> and <var>url</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-port\" id=\"ref-for-concept-url-port\">port</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#bad-port\" id=\"ref-for-bad-port\">bad port</a>, then return <b>blocked</b>. </p>"
        },
        {
          "html": "<p>Return <b>allowed</b>. </p>"
        }
      ]
    },
    {
      "name": "should response to request be blocked due to mime type",
      "href": "https://fetch.spec.whatwg.org/#should-response-to-request-be-blocked-due-to-mime-type%3F",
      "html": "Run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type②\">extracting a MIME type</a> from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑧\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>mimeType</var> is failure, then return <b>allowed</b>. </p>"
        },
        {
          "html": "<p>Let <var>destination</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination⑧\">destination</a>. </p>"
        },
        {
          "html": "<p>If <var>destination</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-destination-script-like\" id=\"ref-for-request-destination-script-like①\">script-like</a> and one of the\n  following is true, then return <b>blocked</b>: </p>\n      <ul class=\"brief\">\n       <li><var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence①\">essence</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with①\">starts with</a> \"<code>audio/</code>\", \"<code>image/</code>\", or \"<code>video/</code>\". \n       </li><li><var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence②\">essence</a> is \"<code>text/csv</code>\". \n      </li></ul>"
        },
        {
          "html": "<p>Return <b>allowed</b>. </p>"
        }
      ]
    },
    {
      "name": "append a request `Origin` header",
      "href": "https://fetch.spec.whatwg.org/#append-a-request-origin-header",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"append-a-request-origin-header\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">append a request `<code>Origin</code>` header</dfn>,\ngiven a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request⑧③\">request</a> <var>request</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑥\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑦\">origin</a> is not\n \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>Let <var>serializedOrigin</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-serializing-a-request-origin\" id=\"ref-for-byte-serializing-a-request-origin①\">byte-serializing a request origin</a> with <var>request</var>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting③\">response tainting</a> is \"<code>cors</code>\" or <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑤\">mode</a> is \"<code>websocket</code>\", then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①\">append</a> (`<code>Origin</code>`, <var>serializedOrigin</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③\">header list</a>. </p>"
        },
        {
          "html": "Otherwise, if <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②\">method</a> is neither `<code>GET</code>` nor\n  `<code>HEAD</code>`, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑥\">mode</a> is not \"<code>cors</code>\",\n    then switch on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy\">referrer policy</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"no-referrer\"",
                      "html": "<p>Set <var>serializedOrigin</var> to `<code>null</code>`. </p>"
                    },
                    {
                      "case": "\"no-referrer-when-downgrade\"",
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑧\">origin</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple\" id=\"ref-for-concept-origin-tuple\">tuple origin</a>, its <var>scheme</var> is \"<code>https</code>\", and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③\">current URL</a>’s <var>scheme</var> is not \"<code>https</code>\", then set <var>serializedOrigin</var> to `<code>null</code>`. </p>"
                    },
                    {
                      "case": "\"strict-origin\"",
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑧\">origin</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple\" id=\"ref-for-concept-origin-tuple\">tuple origin</a>, its <var>scheme</var> is \"<code>https</code>\", and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③\">current URL</a>’s <var>scheme</var> is not \"<code>https</code>\", then set <var>serializedOrigin</var> to `<code>null</code>`. </p>"
                    },
                    {
                      "case": "\"strict-origin-when-cross-origin\"",
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑧\">origin</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple\" id=\"ref-for-concept-origin-tuple\">tuple origin</a>, its <var>scheme</var> is \"<code>https</code>\", and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③\">current URL</a>’s <var>scheme</var> is not \"<code>https</code>\", then set <var>serializedOrigin</var> to `<code>null</code>`. </p>"
                    },
                    {
                      "case": "\"same-origin\"",
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin⑨\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin③\">same origin</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url④\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin⑨\">origin</a>, then set <var>serializedOrigin</var> to `<code>null</code>`. </p>"
                    },
                    {
                      "case": "Otherwise",
                      "html": "Do nothing."
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append②\">Append</a> (`<code>Origin</code>`, <var>serializedOrigin</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④\">header list</a>. </p>"
            }
          ]
        }
      ]
    },
    {
      "name": "header list/extract a length",
      "href": "https://fetch.spec.whatwg.org/#header-list-extract-a-length",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"extract a length|extracting a length\" id=\"header-list-extract-a-length\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract a length</dfn> from a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list①⑨\">header list</a> <var>headers</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>values</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split②\">getting, decoding, and splitting</a> `<code>Content-Length</code>` from <var>headers</var>. </p>"
        },
        {
          "html": "<p>If <var>values</var> is null, then return null. </p>"
        },
        {
          "html": "<p>Let <var>candidateValue</var> be null. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>candidateValue</var> is null, then set <var>candidateValue</var> to <var>value</var>. </p>"
            },
            {
              "html": "<p>Otherwise, if <var>value</var> is not <var>candidateValue</var>, return failure. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>candidateValue</var> is the empty string or has a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point⑨\">code point</a> that is\n not an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-digit\" id=\"ref-for-ascii-digit②\">ASCII digit</a>, then return null. </p>"
        },
        {
          "html": "<p>Return <var>candidateValue</var>, interpreted as decimal number. </p>"
        }
      ]
    },
    {
      "name": "header list/extract a MIME type",
      "href": "https://fetch.spec.whatwg.org/#concept-header-extract-mime-type",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"header list\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"extract a MIME type|extracting a MIME type\" id=\"concept-header-extract-mime-type\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract a MIME type</dfn> from a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list②⓪\">header list</a> <var>headers</var>, run these steps. They return failure or a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type\" id=\"ref-for-mime-type①\">MIME type</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>charset</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>essence</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>values</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split③\">getting, decoding, and splitting</a> `<code>Content-Type</code>` from <var>headers</var>. </p>"
        },
        {
          "html": "<p>If <var>values</var> is null, then return failure. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">For each</a> <var>value</var> of <var>values</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>temporaryMimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parse-a-mime-type\" id=\"ref-for-parse-a-mime-type①\">parsing</a> <var>value</var>. </p>"
            },
            {
              "html": "<p>If <var>temporaryMimeType</var> is failure or its <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence③\">essence</a> is\n   \"<code>*/*</code>\", then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>. </p>"
            },
            {
              "html": "<p>Set <var>mimeType</var> to <var>temporaryMimeType</var>. </p>"
            },
            {
              "html": "If <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence④\">essence</a> is not <var>essence</var>, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>charset</var> to null. </p>"
                },
                {
                  "html": "<p>If <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters\">parameters</a>[\"<code>charset</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exists</a>, then set <var>charset</var> to <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters①\">parameters</a>[\"<code>charset</code>\"]. </p>"
                },
                {
                  "html": "<p>Set <var>essence</var> to <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence⑤\">essence</a>. </p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters②\">parameters</a>[\"<code>charset</code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exist</a>, and <var>charset</var> is non-null, set <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parameters\" id=\"ref-for-parameters③\">parameters</a>[\"<code>charset</code>\"] to <var>charset</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>mimeType</var> is null, then return failure. </p>"
        },
        {
          "html": "<p>Return <var>mimeType</var>. </p>"
        }
      ]
    },
    {
      "name": "legacy extract an encoding",
      "href": "https://fetch.spec.whatwg.org/#legacy-extract-an-encoding",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"legacy-extract-an-encoding\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">legacy extract an encoding</dfn> given failure or a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type\" id=\"ref-for-mime-type④\">MIME type</a> <var>mimeType</var> and an <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#encoding\" id=\"ref-for-encoding\">encoding</a> <var>fallbackEncoding</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>mimeType</var> is failure, then return <var>fallbackEncoding</var>. </p>"
        },
        {
          "html": "<p>If <var>mimeType</var>[\"<code>charset</code>\"] does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exist</a>, then return <var>fallbackEncoding</var>. </p>"
        },
        {
          "html": "<p>Let <var>tentativeEncoding</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#concept-encoding-get\" id=\"ref-for-concept-encoding-get\">getting an encoding</a> from <var>mimeType</var>[\"<code>charset</code>\"]. </p>"
        },
        {
          "html": "<p>If <var>tentativeEncoding</var> is failure, then return <var>fallbackEncoding</var>. </p>"
        },
        {
          "html": "<p>Return <var>tentativeEncoding</var>. </p>"
        }
      ]
    },
    {
      "name": "determine nosniff",
      "href": "https://fetch.spec.whatwg.org/#determine-nosniff",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"determine-nosniff\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine nosniff</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list\" id=\"ref-for-concept-header-list②①\">header list</a> <var>list</var>, run\nthese steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>values</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split④\">getting, decoding, and splitting</a> `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-x-content-type-options\" id=\"ref-for-http-x-content-type-options\"><code>X-Content-Type-Options</code></a>` from <var>list</var>. </p>"
        },
        {
          "html": "<p>If <var>values</var> is null, then return false. </p>"
        },
        {
          "html": "<p>If <var>values</var>[0] is an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\" id=\"ref-for-ascii-case-insensitive\">ASCII case-insensitive</a> match for\n \"<code>nosniff</code>\", then return true. </p>"
        },
        {
          "html": "<p>Return false. </p>"
        }
      ]
    },
    {
      "name": "should response to request be blocked due to nosniff",
      "href": "https://fetch.spec.whatwg.org/#should-response-to-request-be-blocked-due-to-nosniff%3F",
      "html": "Run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#determine-nosniff\" id=\"ref-for-determine-nosniff\">determine nosniff</a> with <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list⑨\">header list</a> is\n false, then return <b>allowed</b>. </p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type⑥\">extracting a MIME type</a> from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⓪\">header list</a>. </p>"
        },
        {
          "html": "<p>Let <var>destination</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⓪\">destination</a>. </p>"
        },
        {
          "html": "<p>If <var>destination</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-destination-script-like\" id=\"ref-for-request-destination-script-like②\">script-like</a> and <var>mimeType</var> is failure or is not a <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#javascript-mime-type\" id=\"ref-for-javascript-mime-type\">JavaScript MIME type</a>, then return <b>blocked</b>. </p>"
        },
        {
          "html": "<p>If <var>destination</var> is \"<code>style</code>\" and <var>mimeType</var> is failure or its <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence⑦\">essence</a> is not \"<code>text/css</code>\", then return <b>blocked</b>. </p>"
        },
        {
          "html": "<p>Return <b>allowed</b>. </p>"
        }
      ]
    },
    {
      "name": "cross-origin resource policy check",
      "href": "https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check",
      "html": "To perform a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"cross-origin-resource-policy-check\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cross-origin resource policy check</dfn>, given an <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①①\">origin</a> <var>origin</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑦\">environment settings object</a> <var>settingsObject</var>, a string <var>destination</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response③⑧\">response</a> <var>response</var>, and an optional boolean <var>forNavigation</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <var>forNavigation</var> to false if it is not given. </p>"
        },
        {
          "html": "<p>Let <var>embedderPolicy</var> be <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container①\">policy container</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-embedder-policy\" id=\"ref-for-policy-container-embedder-policy①\">embedder policy</a>. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check\" id=\"ref-for-cross-origin-resource-policy-internal-check\">cross-origin resource policy internal check</a> with <var>origin</var>,\n  \"<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#coep-unsafe-none\" id=\"ref-for-coep-unsafe-none\"><code>unsafe-none</code></a>\", <var>response</var>, and <var>forNavigation</var> returns <b>blocked</b>, then return <b>blocked</b>. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check\" id=\"ref-for-cross-origin-resource-policy-internal-check①\">cross-origin resource policy internal check</a> with <var>origin</var>, <var>embedderPolicy</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-report-only-value\" id=\"ref-for-embedder-policy-report-only-value\">report only value</a>, <var>response</var>,\n and <var>forNavigation</var> returns <b>blocked</b>, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report\" id=\"ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report\">queue a cross-origin embedder policy CORP violation report</a> with <var>response</var>, <var>settingsObject</var>, <var>destination</var>, and true. </p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check\" id=\"ref-for-cross-origin-resource-policy-internal-check②\">cross-origin resource policy internal check</a> with <var>origin</var>, <var>embedderPolicy</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value-2\" id=\"ref-for-embedder-policy-value-2①\">value</a>, <var>response</var>, and <var>forNavigation</var> returns <b>allowed</b>, then return <b>allowed</b>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report\" id=\"ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report①\">Queue a cross-origin embedder policy CORP violation report</a> with <var>response</var>, <var>settingsObject</var>, <var>destination</var>, and false. </p>"
        },
        {
          "html": "<p>Return <b>blocked</b>. </p>"
        }
      ]
    },
    {
      "name": "cross-origin resource policy internal check",
      "href": "https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check",
      "html": "To perform a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cross-origin-resource-policy-internal-check\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">cross-origin resource policy internal check</dfn>, given an <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①②\">origin</a> <var>origin</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value\" id=\"ref-for-embedder-policy-value\">embedder policy value</a> <var>embedderPolicyValue</var>, a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④⓪\">response</a> <var>response</var>, and a boolean <var>forNavigation</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>forNavigation</var> is true and <var>embedderPolicyValue</var> is\n \"<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#coep-unsafe-none\" id=\"ref-for-coep-unsafe-none①\"><code>unsafe-none</code></a>\", then return <b>allowed</b>. </p>"
        },
        {
          "html": "<p>Let <var>policy</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get③\">getting</a> `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy\" id=\"ref-for-http-cross-origin-resource-policy\"><code>Cross-Origin-Resource-Policy</code></a>` from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①①\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>policy</var> is neither `<code>same-origin</code>`, `<code>same-site</code>`, nor\n `<code>cross-origin</code>`, then set <var>policy</var> to null. </p>"
        },
        {
          "html": "If <var>policy</var> is null, then switch on <var>embedderPolicyValue</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"unsafe-none\"",
                  "html": "<p>Do nothing. </p>"
                },
                {
                  "case": "\"credentialless\"",
                  "html": "<p>Set <var>policy</var> to `<code>same-origin</code>` if: </p>\n        <ul>\n         <li><var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-request-includes-credentials\" id=\"ref-for-response-request-includes-credentials\">request-includes-credentials</a> is true, or \n         </li><li><var>forNavigation</var> is true. \n        </li></ul>"
                },
                {
                  "case": "\"require-corp\"",
                  "html": "<p>Set <var>policy</var> to `<code>same-origin</code>`. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Switch on <var>policy</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "null",
                  "html": "<p>Return <b>allowed</b>. </p>"
                },
                {
                  "case": "`cross-origin`",
                  "html": "<p>Return <b>allowed</b>. </p>"
                },
                {
                  "case": "`same-origin`",
                  "html": "<p>If <var>origin</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin④\">same origin</a> with <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url⑤\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①③\">origin</a>, then return <b>allowed</b>. </p>\n        <p>Otherwise, return <b>blocked</b>. </p>"
                },
                {
                  "case": "`same-site`",
                  "html": "<p>If all of the following are true </p>\n        <ul class=\"brief\">\n         <li>\n          <p><var>origin</var> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#schemelessly-same-site\" id=\"ref-for-schemelessly-same-site\">schemelessly same site</a> with <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url⑥\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①④\">origin</a> </p>\n         </li><li>\n          <p><var>origin</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme②\">scheme</a> is \"<code>https</code>\" or <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url\" id=\"ref-for-concept-response-url⑦\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme③\">scheme</a> is not\n     \"<code>https</code>\" </p>\n        </li></ul>\n        <p>then return <b>allowed</b>. </p>\n        <p>Otherwise, return <b>blocked</b>. </p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "queue a cross-origin embedder policy CORP violation report",
      "href": "https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"queue-a-cross-origin-embedder-policy-corp-violation-report\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">queue a cross-origin embedder policy CORP violation report</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④①\">response</a> <var>response</var>, an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object⑧\">environment settings object</a> <var>settingsObject</var>, a string <var>destination</var>, and a boolean <var>reportOnly</var>,\nrun these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>endpoint</var> be <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container②\">policy container</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-embedder-policy\" id=\"ref-for-policy-container-embedder-policy②\">embedder policy</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-report-only-reporting-endpoint\" id=\"ref-for-embedder-policy-report-only-reporting-endpoint\">report only reporting endpoint</a> if <var>reportOnly</var> is true and <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container③\">policy container</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-embedder-policy\" id=\"ref-for-policy-container-embedder-policy③\">embedder policy</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-reporting-endpoint\" id=\"ref-for-embedder-policy-reporting-endpoint\">reporting endpoint</a> otherwise. </p>"
        },
        {
          "html": "<p>Let <var>serializedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting\" id=\"ref-for-serialize-a-response-url-for-reporting\">serializing a response URL for reporting</a> with <var>response</var>. </p>"
        },
        {
          "html": "<p>Let <var>disposition</var> be \"<code>reporting</code>\" if <var>reportOnly</var> is true;\n otherwise \"<code>enforce</code>\". </p>"
        },
        {
          "html": "<p>Let <var>body</var> be a new object containing the following properties: </p>\n      <table>\n       <thead>\n        <tr>\n         <th>key \n         </th><th>value \n       </th></tr></thead><tbody>\n        <tr>\n         <td>\"<code>type</code>\" \n         </td><td>\"<code>corp</code>\" \n        </td></tr><tr>\n         <td>\"<code>blockedURL</code>\" \n         </td><td><var>serializedURL</var> \n        </td></tr><tr>\n         <td>\"<code>destination</code>\" \n         </td><td><var>destination</var> \n        </td></tr><tr>\n         <td>\"<code>disposition</code>\" \n         </td><td><var>disposition</var> \n      </td></tr></tbody></table>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/reporting/#generate-and-queue-a-report\" id=\"ref-for-generate-and-queue-a-report\">Generate and queue a report</a> for <var>settingsObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global②\">global object</a> given the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#coep-report-type\" id=\"ref-for-coep-report-type\">\"<code>coep</code>\" report type</a>, <var>endpoint</var>, and <var>body</var>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-reporting\" title=\"Reporting API\">[REPORTING]</a> </p>"
        }
      ]
    },
    {
      "name": "fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⓪⑤\">request</a> <var>request</var>, an\noptional algorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"process-request-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processRequestBodyChunkLength</var></dfn>, an\noptional algorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"process-request-end-of-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processRequestEndOfBody</var><span id=\"process-request-end-of-file\"></span></dfn>,\nan optional algorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-processearlyhintsresponse\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processEarlyHintsResponse</var></dfn>, an optional\nalgorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"process-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processResponse</var></dfn>, an optional\nalgorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-processresponseendofbody\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processResponseEndOfBody</var></dfn>, an optional algorithm <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"process-response-end-of-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>processResponseConsumeBody</var><span id=\"process-response-end-of-file\"></span></dfn>,\nand an optional boolean <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"fetch\" data-dfn-type=\"dfn\" data-export=\"\" id=\"fetch-useparallelqueue\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>useParallelQueue</var></dfn> (default false), run\nthe steps below. If given, <var>processRequestBodyChunkLength</var> must be an algorithm accepting\nan integer representing the number of bytes transmitted. If given, <var>processRequestEndOfBody</var> must be an algorithm accepting no arguments. If given, <var>processEarlyHintsResponse</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④③\">response</a>. If\ngiven, <var>processResponse</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④④\">response</a>. If given, <var>processResponseEndOfBody</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④⑤\">response</a>. If\ngiven, <var>processResponseConsumeBody</var> must be an algorithm accepting a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④⑥\">response</a> and null, failure, or a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⑤\">byte sequence</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑦\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode⑧\">mode</a> is \"<code>navigate</code>\" or <var>processEarlyHintsResponse</var> is null. </p>"
        },
        {
          "html": "<p>Let <var>taskDestination</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>crossOriginIsolatedCapability</var> be false. </p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑥\">client</a> is non-null, then:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>taskDestination</var> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑦\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global③\">global object</a>. </p>"
            },
            {
              "html": "<p>Set <var>crossOriginIsolatedCapability</var> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑧\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-cross-origin-isolated-capability\" id=\"ref-for-concept-settings-object-cross-origin-isolated-capability\">cross-origin isolated capability</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>useParallelQueue</var> is true, then set <var>taskDestination</var> to the result of <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#starting-a-new-parallel-queue\" id=\"ref-for-starting-a-new-parallel-queue②\">starting a new parallel queue</a>. </p>"
        },
        {
          "html": "<p>Let <var>timingInfo</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info\" id=\"ref-for-fetch-timing-info④\">fetch timing info</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-start-time\" id=\"ref-for-fetch-timing-info-start-time②\">start time</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-post-redirect-start-time\" id=\"ref-for-fetch-timing-info-post-redirect-start-time①\">post-redirect start time</a> are the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsened-shared-current-time\" id=\"ref-for-dfn-coarsened-shared-current-time\">coarsened shared current time</a> given <var>crossOriginIsolatedCapability</var>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-render-blocking\" id=\"ref-for-fetch-timing-info-render-blocking\">render-blocking</a> is set to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-render-blocking\" id=\"ref-for-request-render-blocking\">render-blocking</a>. </p>"
        },
        {
          "html": "<p>Let <var>fetchParams</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params③\">fetch params</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request\">request</a> is <var>request</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info\">timing info</a> is <var>timingInfo</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-body\" id=\"ref-for-fetch-params-process-request-body\">process request body chunk length</a> is <var>processRequestBodyChunkLength</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-end-of-body\" id=\"ref-for-fetch-params-process-request-end-of-body\">process request end-of-body</a> is <var>processRequestEndOfBody</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-early-hints-response\" id=\"ref-for-fetch-params-process-early-hints-response\">process early hints response</a> is <var>processEarlyHintsResponse</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response\" id=\"ref-for-fetch-params-process-response\">process response</a> is <var>processResponse</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-consume-body\" id=\"ref-for-fetch-params-process-response-consume-body\">process response consume body</a> is <var>processResponseConsumeBody</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-end-of-body\" id=\"ref-for-fetch-params-process-response-end-of-body\">process response end-of-body</a> is <var>processResponseEndOfBody</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination\">task destination</a> is <var>taskDestination</var>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability\">cross-origin isolated capability</a> is <var>crossOriginIsolatedCapability</var>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④\">body</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⑥\">byte sequence</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body⑤\">body</a> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body⑥\">body</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-sequence-as-a-body\" id=\"ref-for-byte-sequence-as-a-body\">as a body</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①\">window</a> is \"<code>client</code>\", then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window②\">window</a> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client⑨\">client</a>,\n if <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⓪\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global④\">global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> object; otherwise\n \"<code>no-window</code>\". </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①①\">origin</a> is \"<code>client</code>\", then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①②\">origin</a> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①①\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin\">origin</a>. </p>"
        },
        {
          "html": "then:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑧\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①③\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑤\">same origin</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①②\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin①\">origin</a>. </p>"
            },
            {
              "html": "<p>Let <var>onPreloadedResponseAvailable</var> be an algorithm that runs the following\n   step given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④⑧\">response</a> <var>response</var>: set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate\">preloaded response candidate</a> to <var>response</var>. </p>"
            },
            {
              "html": "<p>Let <var>foundPreloadedResource</var> be the result of invoking <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/links.html#consume-a-preloaded-resource\" id=\"ref-for-consume-a-preloaded-resource\">consume a preloaded resource</a> for <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window④\">window</a>, given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url③\">URL</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①②\">destination</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⓪\">mode</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode⑧\">credentials mode</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata\">integrity metadata</a>,\n   and <var>onPreloadedResponseAvailable</var>. </p>"
            },
            {
              "html": "<p>If <var>foundPreloadedResource</var> is true and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate①\">preloaded response candidate</a> is null, then set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate②\">preloaded response candidate</a> to \"<code>pending</code>\". </p>"
            }
          ]
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-policy-container\" id=\"ref-for-concept-request-policy-container①\">policy container</a> is \"<code>client</code>\", then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①③\">client</a> is non-null, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-policy-container\" id=\"ref-for-concept-request-policy-container②\">policy container</a> to a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container\" id=\"ref-for-clone-a-policy-container\">clone</a> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①④\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-policy-container\" id=\"ref-for-concept-settings-object-policy-container④\">policy container</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-html\" title=\"HTML Standard\">[HTML]</a> </p>"
            },
            {
              "html": "<p>Otherwise, set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-policy-container\" id=\"ref-for-concept-request-policy-container③\">policy container</a> to a new <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container\" id=\"ref-for-policy-container②\">policy container</a>. </p>"
            }
          ]
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑥\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains⑧\">does not contain</a> `<code>Accept</code>`, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>value</var> be `<code>*/*</code>`. </p>"
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator③\">initiator</a> is \"<code>prefetch</code>\", then set <var>value</var> to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#document-accept-header-value\" id=\"ref-for-document-accept-header-value\">document `<code>Accept</code>` header value</a>. </p>"
            },
            {
              "html": "Otherwise, the user agent should set <var>value</var> to the first matching statement, if\n    any, switching on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①③\">destination</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"document\"",
                      "html": "the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#document-accept-header-value\" id=\"ref-for-document-accept-header-value①\">document `<code>Accept</code>` header value</a>"
                    },
                    {
                      "case": "\"frame\"",
                      "html": "the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#document-accept-header-value\" id=\"ref-for-document-accept-header-value①\">document `<code>Accept</code>` header value</a>"
                    },
                    {
                      "case": "\"iframe\"",
                      "html": "the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#document-accept-header-value\" id=\"ref-for-document-accept-header-value①\">document `<code>Accept</code>` header value</a>"
                    },
                    {
                      "case": "\"image\"",
                      "html": "`<code>image/png,image/svg+xml,image/*;q=0.8,*/*;q=0.5</code>`"
                    },
                    {
                      "case": "\"json\"",
                      "html": "`<code>application/json,*/*;q=0.5</code>`"
                    },
                    {
                      "case": "\"style\"",
                      "html": "`<code>text/css,*/*;q=0.1</code>`"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append③\">Append</a> (`<code>Accept</code>`, <var>value</var>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑦\">header list</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑧\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains⑨\">does not contain</a> `<code>Accept-Language</code>`, then user agents should <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append④\">append</a> (`<code>Accept-Language</code>, an appropriate <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑧\">header value</a>) to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list⑨\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority\">internal priority</a> is null, then use <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-priority\" id=\"ref-for-request-priority\">priority</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator④\">initiator</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①④\">destination</a>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-render-blocking\" id=\"ref-for-request-render-blocking①\">render-blocking</a> in an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①①\">implementation-defined</a> manner to set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority①\">internal priority</a> to an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①②\">implementation-defined</a> object. </p>"
        },
        {
          "html": "If <var>request</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#subresource-request\" id=\"ref-for-subresource-request\">subresource request</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>record</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record\" id=\"ref-for-concept-fetch-record⑤\">fetch record</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record-request\" id=\"ref-for-concept-fetch-record-request①\">request</a> is <var>request</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record-fetch\" id=\"ref-for-concept-fetch-record-fetch②\">controller</a> is <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller②\">controller</a>. </p>"
            },
            {
              "html": "<p>Append <var>record</var> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑤\">client</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-group\" id=\"ref-for-concept-fetch-group②\">fetch group</a> list of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record\" id=\"ref-for-concept-fetch-record⑥\">fetch records</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-main-fetch\" id=\"ref-for-concept-main-fetch\">main fetch</a> given <var>fetchParams</var>. </p>"
        },
        {
          "html": "<p>Return <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller③\">controller</a>. </p>"
        }
      ]
    },
    {
      "name": "main fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-main-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-main-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">main fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params④\">fetch params</a> <var>fetchParams</var> and an optional boolean <var>recursive</var> (default false), run these\nsteps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①\">request</a>. </p>"
        },
        {
          "html": "<p>Let <var>response</var> be null. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#local-urls-only-flag\" id=\"ref-for-local-urls-only-flag\">local-URLs-only flag</a> is set and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url⑦\">current URL</a> is not <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#is-local\" id=\"ref-for-is-local\">local</a>, then set <var>response</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑧\">network error</a>. </p>"
        },
        {
          "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#report-for-request\" id=\"ref-for-report-for-request\">report Content Security Policy violations for <var>request</var></a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-upgrade-insecure-requests/#upgrade-request\" id=\"ref-for-upgrade-request\">Upgrade <var>request</var> to a potentially trustworthy URL, if appropriate</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-mixed-content/#upgrade-algorithm\" id=\"ref-for-upgrade-algorithm\">Upgrade a mixed content <var>request</var> to a potentially trustworthy URL, if appropriate</a>. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#block-bad-port\" id=\"ref-for-block-bad-port\">should <var>request</var> be blocked due to a bad port</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-mixed-content/#should-block-fetch\" id=\"ref-for-should-block-fetch\">should fetching <var>request</var> be blocked as mixed content</a>, or <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#should-block-request\" id=\"ref-for-should-block-request\">should <var>request</var> be blocked by Content Security Policy</a> returns <b>blocked</b>, then set <var>response</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑨\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy②\">referrer policy</a> is the empty string, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy③\">referrer policy</a> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-policy-container\" id=\"ref-for-concept-request-policy-container④\">policy container</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#policy-container-referrer-policy\" id=\"ref-for-policy-container-referrer-policy\">referrer policy</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①\">referrer</a> is not \"<code>no-referrer</code>\", then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer②\">referrer</a> to the result of invoking <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-referrer-policy/#determine-requests-referrer\" id=\"ref-for-determine-requests-referrer\">determine <var>request</var>’s referrer</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-referrer\" title=\"Referrer Policy\">[REFERRER]</a> </p>"
        },
        {
          "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url⑧\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑤\">scheme</a> to\n  \"<code>https</code>\" if all of the following conditions are true: </p>\n      <ul class=\"brief\">\n       <li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url⑨\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme⑥\">scheme</a> is\n   \"<code>http</code>\" \n       </li><li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①⓪\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host\">host</a> is a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-domain\" id=\"ref-for-concept-domain\">domain</a> \n       </li><li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①①\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host①\">host</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#host-public-suffix\" id=\"ref-for-host-public-suffix①\">public suffix</a> is not \"<code>localhost</code>\" or \"<code>localhost.</code>\" \n       </li><li>Matching <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①②\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-host\" id=\"ref-for-concept-url-host②\">host</a> per <a href=\"https://www.rfc-editor.org/rfc/rfc6797.html#section-8.2\">Known HSTS Host Domain Name Matching</a> results in either a superdomain match with an asserted <code>includeSubDomains</code> directive\n   or a congruent match (with or without an asserted <code>includeSubDomains</code> directive) <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-hsts\" title=\"HTTP Strict Transport Security (HSTS)\">[HSTS]</a>; or\n   DNS resolution for the request finds a matching HTTPS RR per <a href=\"https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-svcb-https#section-9.5\">section 9.5</a> of <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-svcb\" title=\"Service binding and parameter specification via the DNS (DNS SVCB and HTTPS RRs)\">[SVCB]</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-hsts\" title=\"HTTP Strict Transport Security (HSTS)\">[HSTS]</a> <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-svcb\" title=\"Service binding and parameter specification via the DNS (DNS SVCB and HTTPS RRs)\">[SVCB]</a> \n      </li></ul>"
        },
        {
          "html": "<p>If <var>recursive</var> is false, then run the remaining steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>. </p>"
        },
        {
          "html": "If <var>response</var> is null, then set <var>response</var> to the result of running the steps\n  corresponding to the first matching statement:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "fetchParams’s preloaded response candidate is non-null",
                  "html": "",
                  "rationale": "wait",
                  "steps": [
                    {
                      "html": "<p>Wait until <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate④\">preloaded response candidate</a> is not \"<code>pending</code>\". </p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑨\">Assert</a>: <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate⑤\">preloaded response candidate</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response④⑨\">response</a>. </p>"
                    },
                    {
                      "html": "<p>Return <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-preloaded-response-candidate\" id=\"ref-for-fetch-params-preloaded-response-candidate⑥\">preloaded response candidate</a>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s current URL’s origin is same origin with request’s origin, and request’s response tainting is \"basic\"",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑤\">response tainting</a> to \"<code>basic</code>\". </p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-scheme-fetch\" id=\"ref-for-concept-scheme-fetch\">scheme fetch</a> given <var>fetchParams</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s current URL’s scheme is \"data\"",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑤\">response tainting</a> to \"<code>basic</code>\". </p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-scheme-fetch\" id=\"ref-for-concept-scheme-fetch\">scheme fetch</a> given <var>fetchParams</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s mode is \"navigate\" or \"websocket\"",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑤\">response tainting</a> to \"<code>basic</code>\". </p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-scheme-fetch\" id=\"ref-for-concept-scheme-fetch\">scheme fetch</a> given <var>fetchParams</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s mode is \"same-origin\"",
                  "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⓪\">network error</a>. </p>"
                },
                {
                  "case": "request’s mode is \"no-cors\"",
                  "html": "",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode①\">redirect mode</a> is not \"<code>follow</code>\",\n     then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①①\">network error</a>. </p>"
                    },
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑥\">response tainting</a> to \"<code>opaque</code>\". </p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-scheme-fetch\" id=\"ref-for-concept-scheme-fetch①\">scheme fetch</a> given <var>fetchParams</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s current URL’s scheme is not an HTTP(S) scheme",
                  "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①②\">network error</a>. </p>"
                },
                {
                  "case": "request’s use-CORS-preflight flag is set",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑦\">response tainting</a> to\n     \"<code>cors</code>\". </p>"
                    },
                    {
                      "html": "<p>Let <var>corsWithPreflightResponse</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch③\">HTTP fetch</a> given <var>fetchParams</var> and true. </p>"
                    },
                    {
                      "html": "<p>If <var>corsWithPreflightResponse</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①③\">network error</a>, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-clear\" id=\"ref-for-concept-cache-clear\">clear cache entries</a> using <var>request</var>. </p>"
                    },
                    {
                      "html": "<p>Return <var>corsWithPreflightResponse</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "request’s unsafe-request flag is set and either request’s method is not a CORS-safelisted method or CORS-unsafe request-header names with request’s header list is not empty",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑦\">response tainting</a> to\n     \"<code>cors</code>\". </p>"
                    },
                    {
                      "html": "<p>Let <var>corsWithPreflightResponse</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch③\">HTTP fetch</a> given <var>fetchParams</var> and true. </p>"
                    },
                    {
                      "html": "<p>If <var>corsWithPreflightResponse</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①③\">network error</a>, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-clear\" id=\"ref-for-concept-cache-clear\">clear cache entries</a> using <var>request</var>. </p>"
                    },
                    {
                      "html": "<p>Return <var>corsWithPreflightResponse</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "Otherwise",
                  "html": "",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑧\">response tainting</a> to\n     \"<code>cors</code>\". </p>"
                    },
                    {
                      "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch④\">HTTP fetch</a> given <var>fetchParams</var>. </p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>recursive</var> is true, then return <var>response</var>. </p>"
        },
        {
          "html": "If <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①④\">network error</a> and <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response①①\">filtered response</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting⑨\">response tainting</a> is \"<code>cors</code>\", then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>headerNames</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values①\">extracting header list values</a> given\n     `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-expose-headers\" id=\"ref-for-http-access-control-expose-headers⑤\"><code>Access-Control-Expose-Headers</code></a>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①②\">header list</a>. </p>"
                },
                {
                  "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode⑨\">credentials mode</a> is not\n     \"<code>include</code>\" and <var>headerNames</var> contains `<code>*</code>`, then set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cors-exposed-header-name-list\" id=\"ref-for-concept-response-cors-exposed-header-name-list②\">CORS-exposed header-name list</a> to all unique <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header④⑧\">header</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name①⑧\">names</a> in <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①③\">header list</a>. </p>"
                },
                {
                  "html": "<p>Otherwise, if <var>headerNames</var> is non-null or failure, then set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cors-exposed-header-name-list\" id=\"ref-for-concept-response-cors-exposed-header-name-list③\">CORS-exposed header-name list</a> to <var>headerNames</var>. </p>"
                }
              ]
            },
            {
              "html": "Set <var>response</var> to the following <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response①②\">filtered response</a> with <var>response</var> as\n    its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①⓪\">internal response</a>, depending on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①⓪\">response tainting</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"basic\"",
                      "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response-basic\" id=\"ref-for-concept-filtered-response-basic\">basic filtered response</a>"
                    },
                    {
                      "case": "\"cors\"",
                      "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response-cors\" id=\"ref-for-concept-filtered-response-cors①\">CORS filtered response</a>"
                    },
                    {
                      "case": "\"opaque\"",
                      "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response-opaque\" id=\"ref-for-concept-filtered-response-opaque⑤\">opaque filtered response</a>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>internalResponse</var> be <var>response</var>, if <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⑤\">network error</a>; otherwise <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①①\">internal response</a>. </p>"
        },
        {
          "html": "<p>If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list⑦\">URL list</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty④\">is empty</a>, then\n  set it to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone\">clone</a> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list④\">URL list</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var> has a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-tainted-origin\" id=\"ref-for-concept-request-tainted-origin②\">redirect-tainted origin</a>, then set <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects\" id=\"ref-for-response-has-cross-origin-redirects\">has-cross-origin-redirects</a> to true. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#timing-allow-failed\" id=\"ref-for-timing-allow-failed②\">timing allow failed flag</a> is unset, then set <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-timing-allow-passed\" id=\"ref-for-concept-response-timing-allow-passed\">timing allow passed flag</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⑥\">network error</a> and any of the following returns <b>blocked</b> </p>\n      <ul class=\"brief\">\n       <li>\n        <p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-mixed-content/#should-block-response\" id=\"ref-for-should-block-response\">should <var>internalResponse</var> to <var>request</var> be blocked as mixed content</a> </p>\n       </li><li>\n        <p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-csp/#should-block-response\" id=\"ref-for-should-block-response①\">should <var>internalResponse</var> to <var>request</var> be blocked by Content Security Policy</a> </p>\n       </li><li>\n        <p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#should-response-to-request-be-blocked-due-to-mime-type?\" id=\"ref-for-should-response-to-request-be-blocked-due-to-mime-type?①\">should <var>internalResponse</var> to <var>request</var> be blocked due to its MIME type</a> </p>\n       </li><li>\n        <p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#should-response-to-request-be-blocked-due-to-nosniff?\" id=\"ref-for-should-response-to-request-be-blocked-due-to-nosniff?①\">should <var>internalResponse</var> to <var>request</var> be blocked due to nosniff</a> </p>\n      </li></ul>\n      <p>then set <var>response</var> and <var>internalResponse</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⑦\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type⑥\">type</a> is \"<code>opaque</code>\", <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑤\">status</a> is 206, <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-range-requested-flag\" id=\"ref-for-concept-response-range-requested-flag\">range-requested flag</a> is set, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①①\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⓪\">does not contain</a> `<code>Range</code>`,\n  then set <var>response</var> and <var>internalResponse</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⑧\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error①⑨\">network error</a> and\n  either <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method⑥\">method</a> is\n  `<code>HEAD</code>` or `<code>CONNECT</code>`, or <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑥\">status</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#null-body-status\" id=\"ref-for-null-body-status\">null body status</a>,\n  set <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body⑨\">body</a> to\n  null and disregard any enqueuing toward it (if any). </p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata①\">integrity metadata</a> is not the empty string, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>processBodyError</var> be this step: run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-finale\" id=\"ref-for-fetch-finale\">fetch response handover</a> given <var>fetchParams</var> and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⓪\">network error</a>. </p>"
            },
            {
              "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⓪\">body</a> is null, then run <var>processBodyError</var> and abort these steps. </p>"
            },
            {
              "html": "Let <var>processBody</var> given <var>bytes</var> be these steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>bytes</var> do not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-subresource-integrity/#does-response-match-metadatalist\" id=\"ref-for-does-response-match-metadatalist\">match</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata②\">integrity metadata</a>, then run <var>processBodyError</var> and abort these steps. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-sri\" title=\"Subresource Integrity\">[SRI]</a> </p>"
                },
                {
                  "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①①\">body</a> to <var>bytes</var> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-sequence-as-a-body\" id=\"ref-for-byte-sequence-as-a-body①\">as a body</a>. </p>"
                },
                {
                  "html": "<p>Run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-finale\" id=\"ref-for-fetch-finale①\">fetch response handover</a> given <var>fetchParams</var> and <var>response</var>. </p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-fully-read\" id=\"ref-for-body-fully-read\">Fully read</a> <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①②\">body</a> given <var>processBody</var> and <var>processBodyError</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-finale\" id=\"ref-for-fetch-finale②\">fetch response handover</a> given <var>fetchParams</var> and <var>response</var>. </p>"
        }
      ]
    },
    {
      "name": "fetch response handover",
      "href": "https://fetch.spec.whatwg.org/#fetch-finale",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fetch-finale\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fetch response handover</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params⑤\">fetch params</a> <var>fetchParams</var> and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤①\">response</a> <var>response</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>timingInfo</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info①\">timing info</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②①\">network error</a> and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request②\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑥\">client</a> is a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#secure-context\" id=\"ref-for-secure-context\">secure context</a>, then set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-server-timing-headers\" id=\"ref-for-fetch-timing-info-server-timing-headers\">server-timing headers</a> to the\n  result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split⑤\">getting, decoding, and splitting</a> `<code>Server-Timing</code>`\n  from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①②\">internal response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①④\">header list</a>. </p>\n      \n      <p>The user agent may decide to expose `<code>Server-Timing</code>` headers to non-secure contexts\n  requests as well. </p>"
        },
        {
          "html": "Let <var>processResponseEndOfBody</var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>unsafeEndTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-unsafe-shared-current-time\" id=\"ref-for-dfn-unsafe-shared-current-time⑤\">unsafe shared current time</a>. </p>"
            },
            {
              "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request③\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⑤\">destination</a> is \"<code>document</code>\", then set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller④\">controller</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-full-timing-info\" id=\"ref-for-fetch-controller-full-timing-info②\">full timing info</a> to <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info②\">timing info</a>. </p>"
            },
            {
              "html": "Set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller⑤\">controller</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-report-timing-steps\" id=\"ref-for-fetch-controller-report-timing-steps②\">report timing steps</a> to the following steps given a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#global-object\" id=\"ref-for-global-object⑦\">global object</a> <var>global</var>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request④\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url④\">URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①②\">scheme</a> is not an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme⑦\">HTTP(S) scheme</a>, then return. </p>"
                },
                {
                  "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-end-time\" id=\"ref-for-fetch-timing-info-end-time\">end time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-relative-high-resolution-time\" id=\"ref-for-dfn-relative-high-resolution-time\">relative high resolution time</a> given <var>unsafeEndTime</var> and <var>global</var>. </p>"
                },
                {
                  "html": "<p>Let <var>cacheState</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cache-state\" id=\"ref-for-concept-response-cache-state\">cache state</a>. </p>"
                },
                {
                  "html": "<p>Let <var>bodyInfo</var> be <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body-info\" id=\"ref-for-concept-response-body-info③\">body info</a>. </p>"
                },
                {
                  "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-timing-allow-passed\" id=\"ref-for-concept-response-timing-allow-passed①\">timing allow passed flag</a> is not set,\n      then set <var>timingInfo</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#create-an-opaque-timing-info\" id=\"ref-for-create-an-opaque-timing-info\">creating an opaque timing info</a> for <var>timingInfo</var> and set <var>cacheState</var> to the empty string. </p>"
                },
                {
                  "html": "<p>Let <var>responseStatus</var> be 0. </p>"
                },
                {
                  "html": "If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request⑤\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①④\">mode</a> is\n      not \"<code>navigate</code>\" or <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-has-cross-origin-redirects\" id=\"ref-for-response-has-cross-origin-redirects①\">has-cross-origin-redirects</a> is false:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>responseStatus</var> to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑦\">status</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type⑦\">extracting a MIME type</a> from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⑤\">header list</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>mimeType</var> is not failure, then set <var>bodyInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-body-info-content-type\" id=\"ref-for-response-body-info-content-type\">content type</a> to the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#minimize-a-supported-mime-type\" id=\"ref-for-minimize-a-supported-mime-type\">minimizing a supported MIME type</a> given <var>mimeType</var>. </p>"
                    }
                  ]
                },
                {
                  "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request⑥\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type\">initiator type</a> is non-null, then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/resource-timing/#dfn-mark-resource-timing\" id=\"ref-for-dfn-mark-resource-timing\">mark resource timing</a> given <var>timingInfo</var>, <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request⑦\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑤\">URL</a>, <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request⑧\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type①\">initiator type</a>, <var>global</var>, <var>cacheState</var>, <var>bodyInfo</var>, and <var>responseStatus</var>. </p>"
                }
              ]
            },
            {
              "html": "Let <var>processResponseEndOfBodyTask</var> be the following steps:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request⑨\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#done-flag\" id=\"ref-for-done-flag②\">done flag</a>. </p>"
                },
                {
                  "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-end-of-body\" id=\"ref-for-fetch-params-process-response-end-of-body①\">process response end-of-body</a> is\n     non-null, then run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-end-of-body\" id=\"ref-for-fetch-params-process-response-end-of-body②\">process response end-of-body</a> given <var>response</var>. </p>"
                },
                {
                  "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⓪\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type②\">initiator type</a> is non-null and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①①\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑦\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global⑤\">global object</a> is <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination①\">task destination</a>, then run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller⑥\">controller</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-report-timing-steps\" id=\"ref-for-fetch-controller-report-timing-steps③\">report timing steps</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①②\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑧\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global⑥\">global object</a>. </p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task⑤\">Queue a fetch task</a> to run <var>processResponseEndOfBodyTask</var> with <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination②\">task destination</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response\" id=\"ref-for-fetch-params-process-response①\">process response</a> is non-null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task⑥\">queue a fetch task</a> to run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response\" id=\"ref-for-fetch-params-process-response②\">process response</a> given <var>response</var>, with <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination③\">task destination</a>. </p>"
        },
        {
          "html": "<p>Let <var>internalResponse</var> be <var>response</var>, if <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②③\">network error</a>; otherwise <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①④\">internal response</a>. </p>"
        },
        {
          "html": "<p>If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①③\">body</a> is null, then run <var>processResponseEndOfBody</var>. </p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>transformStream</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#transformstream\" id=\"ref-for-transformstream\">TransformStream</a></code>. </p>"
            },
            {
              "html": "<p>Let <var>identityTransformAlgorithm</var> be an algorithm which, given <var>chunk</var>, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-enqueue\" id=\"ref-for-transformstream-enqueue\">enqueues</a> <var>chunk</var> in <var>transformStream</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-set-up\" id=\"ref-for-transformstream-set-up\">Set up</a> <var>transformStream</var> with <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm\" id=\"ref-for-transformstream-set-up-transformalgorithm\"><i>transformAlgorithm</i></a> set to <var>identityTransformAlgorithm</var> and <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-set-up-flushalgorithm\" id=\"ref-for-transformstream-set-up-flushalgorithm\"><i>flushAlgorithm</i></a> set to <var>processResponseEndOfBody</var>. </p>"
            },
            {
              "html": "<p>Set <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①④\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream⑤\">stream</a> to the\n   result of <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⑤\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream⑥\">stream</a> <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-pipe-through\" id=\"ref-for-readablestream-pipe-through\">piped through</a> <var>transformStream</var>. </p>"
            }
          ]
        },
        {
          "html": "If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-consume-body\" id=\"ref-for-fetch-params-process-response-consume-body①\">process response consume body</a> is\n  non-null, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>processBody</var> given <var>nullOrBytes</var> be this step: run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-consume-body\" id=\"ref-for-fetch-params-process-response-consume-body②\">process response consume body</a> given <var>response</var> and <var>nullOrBytes</var>. </p>"
            },
            {
              "html": "<p>Let <var>processBodyError</var> be this step: run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-response-consume-body\" id=\"ref-for-fetch-params-process-response-consume-body③\">process response consume body</a> given <var>response</var> and failure. </p>"
            },
            {
              "html": "<p>If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⑥\">body</a> is null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task⑦\">queue a fetch task</a> to run <var>processBody</var> given null, with <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination④\">task destination</a>. </p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-fully-read\" id=\"ref-for-body-fully-read①\">fully read</a> <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⑦\">body</a> given <var>processBody</var>, <var>processBodyError</var>, and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination⑤\">task destination</a>. </p>"
            }
          ]
        }
      ]
    },
    {
      "name": "scheme fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-scheme-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-scheme-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">scheme fetch<span id=\"concept-basic-fetch\"></span></dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params⑥\">fetch params</a> <var>fetchParams</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled①\">canceled</a>, then return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error\">appropriate network error</a> for <var>fetchParams</var>. </p>"
        },
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①③\">request</a>. </p>"
        },
        {
          "html": "Switch on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①⑦\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①③\">scheme</a> and run\n  the associated steps:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"about\"",
                  "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①⑧\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path①\">path</a> is the string\n    \"<code>blank</code>\", then return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤②\">response</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message③\">status message</a> is `<code>OK</code>`, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⑥\">header list</a> is «\n    (`<code>Content-Type</code>`, `<code>text/html;charset=utf-8</code>`) », and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⑧\">body</a> is the empty byte sequence <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-sequence-as-a-body\" id=\"ref-for-byte-sequence-as-a-body②\">as a body</a>. </p>"
                },
                {
                  "case": "\"blob\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>blobURLEntry</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url①⑨\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-blob-entry\" id=\"ref-for-concept-url-blob-entry\">blob URL entry</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method⑦\">method</a> is not `<code>GET</code>` or <var>blobURLEntry</var> is null, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⑤\">network error</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-fileapi\" title=\"File API\">[FILEAPI]</a> </p>"
                    },
                    {
                      "html": "<p>Let <var>requestEnvironment</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-determine-the-environment\" id=\"ref-for-request-determine-the-environment\">determining the environment</a> given <var>request</var>. </p>"
                    },
                    {
                      "html": "<p>Let <var>isTopLevelNavigation</var> be true if <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⑥\">destination</a> is \"<code>document</code>\"; otherwise, false. </p>"
                    },
                    {
                      "html": "<p>If <var>isTopLevelNavigation</var> is false and <var>requestEnvironment</var> is null,\n     then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⑥\">network error</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>navigationOrEnvironment</var> be the string \"<code>navigation</code>\" if <var>isTopLevelNavigation</var> is true; otherwise, <var>requestEnvironment</var>. </p>"
                    },
                    {
                      "html": "<p>Let <var>blob</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-obtain-object\" id=\"ref-for-blob-url-obtain-object\">obtaining a blob object</a> given <var>blobURLEntry</var> and <var>navigationOrEnvironment</var>. </p>"
                    },
                    {
                      "html": "<p>If <var>blob</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob①\">Blob</a></code> object, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⑦\">network error</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>response</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤③\">response</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>fullLength</var> be <var>blob</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-size\" id=\"ref-for-dfn-size\">size</a></code>. </p>"
                    },
                    {
                      "html": "<p>Let <var>serializedFullLength</var> be <var>fullLength</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑤\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode⑦\">isomorphic encoded</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>type</var> be <var>blob</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-type\" id=\"ref-for-dfn-type\">type</a></code>. </p>"
                    },
                    {
                      "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①②\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①①\">does not contain</a> `<code>Range</code>`:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>bodyWithType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#bodyinit-safely-extract\" id=\"ref-for-bodyinit-safely-extract②\">safely extracting</a> <var>blob</var>. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message④\">status message</a> to `<code>OK</code>`. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body①⑨\">body</a> to <var>bodyWithType</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body①\">body</a>. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⑦\">header list</a> to «\n       (`<code>Content-Length</code>`, <var>serializedFullLength</var>),\n       (`<code>Content-Type</code>`, <var>type</var>) ». </p>"
                        }
                      ]
                    },
                    {
                      "html": "Otherwise:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-range-requested-flag\" id=\"ref-for-concept-response-range-requested-flag①\">range-requested flag</a>. </p>"
                        },
                        {
                          "html": "<p>Let <var>rangeHeader</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get④\">getting</a> `<code>Range</code>` from <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①③\">header list</a>. </p>"
                        },
                        {
                          "html": "<p>Let <var>rangeValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#simple-range-header-value\" id=\"ref-for-simple-range-header-value②\">parsing a single range header value</a> given <var>rangeHeader</var> and true. </p>"
                        },
                        {
                          "html": "<p>If <var>rangeValue</var> is failure, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⑧\">network error</a>. </p>"
                        },
                        {
                          "html": "<p>Let (<var>rangeStart</var>, <var>rangeEnd</var>) be <var>rangeValue</var>. </p>"
                        },
                        {
                          "html": "If <var>rangeStart</var> is null:",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "<p>Set <var>rangeStart</var> to <var>fullLength</var> − <var>rangeEnd</var>. </p>"
                            },
                            {
                              "html": "<p>Set <var>rangeEnd</var> to <var>rangeStart</var> + <var>rangeEnd</var> − 1. </p>"
                            }
                          ]
                        },
                        {
                          "html": "Otherwise:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>rangeStart</var> is greater than or equal to <var>fullLength</var>, then\n         return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error②⑨\">network error</a>. </p>"
                            },
                            {
                              "html": "<p>If <var>rangeEnd</var> is null or <var>rangeEnd</var> is greater than or equal to <var>fullLength</var>, then set <var>rangeEnd</var> to <var>fullLength</var> − 1. </p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Let <var>slicedBlob</var> be the result of invoking <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#slice-blob\" id=\"ref-for-slice-blob\">slice blob</a> given <var>blob</var>, <var>rangeStart</var>, <var>rangeEnd</var> + 1, and <var>type</var>. </p>"
                        },
                        {
                          "html": "<p>Let <var>slicedBodyWithType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#bodyinit-safely-extract\" id=\"ref-for-bodyinit-safely-extract③\">safely extracting</a> <var>slicedBlob</var>. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②⓪\">body</a> to <var>slicedBodyWithType</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body②\">body</a>. </p>"
                        },
                        {
                          "html": "<p>Let <var>serializedSlicedLength</var> be <var>slicedBlob</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-size\" id=\"ref-for-dfn-size①\">size</a></code>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑥\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode⑧\">isomorphic encoded</a>. </p>"
                        },
                        {
                          "html": "<p>Let <var>contentRange</var> be the result of invoking <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#build-a-content-range\" id=\"ref-for-build-a-content-range\">build a content range</a> given <var>rangeStart</var>, <var>rangeEnd</var>, and <var>fullLength</var>. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status⑧\">status</a> to 206. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message⑤\">status message</a> to\n       `<code>Partial Content</code>`. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⑧\">header list</a> to «\n       (`<code>Content-Length</code>`, <var>serializedSlicedLength</var>),\n       (`<code>Content-Type</code>`, <var>type</var>), (`<code>Content-Range</code>`, <var>contentRange</var>) ». </p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Return <var>response</var>. </p>"
                    }
                  ]
                },
                {
                  "case": "\"data\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>dataURLStruct</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-processor\" id=\"ref-for-data-url-processor\"><code>data:</code> URL processor</a> on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⓪\">current URL</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>dataURLStruct</var> is failure, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⓪\">network error</a>. </p>"
                    },
                    {
                      "html": "<p>Let <var>mimeType</var> be <var>dataURLStruct</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-struct-mime-type\" id=\"ref-for-data-url-struct-mime-type\">MIME type</a>, <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#serialize-a-mime-type-to-bytes\" id=\"ref-for-serialize-a-mime-type-to-bytes\">serialized</a>. </p>"
                    },
                    {
                      "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤④\">response</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message⑥\">status message</a> is\n     `<code>OK</code>`, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list①⑨\">header list</a> is « (`<code>Content-Type</code>`, <var>mimeType</var>) », and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②①\">body</a> is <var>dataURLStruct</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-struct-body\" id=\"ref-for-data-url-struct-body\">body</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-sequence-as-a-body\" id=\"ref-for-byte-sequence-as-a-body③\">as a body</a>. </p>"
                    }
                  ]
                },
                {
                  "case": "\"file\"",
                  "html": "<p>For now, unfortunate as it is, <code>file:</code> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⑧\">URLs</a> are left as an exercise\n    for the reader. </p>\n        <p>When in doubt, return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③①\">network error</a>. </p>"
                },
                {
                  "case": "HTTP(S) scheme",
                  "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-fetch\" id=\"ref-for-concept-http-fetch⑤\">HTTP fetch</a> given <var>fetchParams</var>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③②\">network error</a>. </p>"
        }
      ]
    },
    {
      "name": "request/determine the environment",
      "href": "https://fetch.spec.whatwg.org/#request-determine-the-environment",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"request\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"request-determine-the-environment\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the environment</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⓪⑦\">request</a> <var>request</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client②\">reserved client</a> is non-null, then return <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reserved-client\" id=\"ref-for-concept-request-reserved-client③\">reserved client</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client①⑨\">client</a> is non-null, then return <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②⓪\">client</a>. </p>"
        },
        {
          "html": "<p>Return null. </p>"
        }
      ]
    },
    {
      "name": "HTTP fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-http-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-http-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">HTTP fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params⑦\">fetch params</a> <var>fetchParams</var> and an optional boolean <var>makeCORSPreflight</var> (default false), run\nthese steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①④\">request</a>. </p>"
        },
        {
          "html": "<p>Let <var>response</var> and <var>internalResponse</var> be null. </p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode\">service-workers mode</a> is \"<code>all</code>\", then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requestForServiceWorker</var> be a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-clone\" id=\"ref-for-concept-request-clone\">clone</a> of <var>request</var>. </p>"
            },
            {
              "html": "If <var>requestForServiceWorker</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body⑧\">body</a> is non-null, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>transformStream</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#transformstream\" id=\"ref-for-transformstream②\">TransformStream</a></code>. </p>"
                },
                {
                  "html": "Let <var>transformAlgorithm</var> given <var>chunk</var> be these steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled②\">canceled</a>, then abort these\n       steps. </p>"
                    },
                    {
                      "html": "<p>If <var>chunk</var> is not a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\" id=\"ref-for-idl-Uint8Array①\">Uint8Array</a></code> object, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-terminate\" id=\"ref-for-fetch-controller-terminate①\">terminate</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller⑦\">controller</a>. </p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue\">enqueue</a> <var>chunk</var> in <var>transformStream</var>. The user agent may split the chunk into <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑥\">implementation-defined</a> practical sizes and <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue①\">enqueue</a> each of\n       them. The user agent also may concatenate the chunks into an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑦\">implementation-defined</a> practical size and <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue②\">enqueue</a> it. </p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-set-up\" id=\"ref-for-transformstream-set-up①\">Set up</a> <var>transformStream</var> with <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#transformstream-set-up-transformalgorithm\" id=\"ref-for-transformstream-set-up-transformalgorithm①\"><i>transformAlgorithm</i></a> set to <var>transformAlgorithm</var>. </p>"
                },
                {
                  "html": "<p>Set <var>requestForServiceWorker</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body⑨\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream⑦\">stream</a> to\n     the result of <var>requestForServiceWorker</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body①⓪\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream⑧\">stream</a> <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-pipe-through\" id=\"ref-for-readablestream-pipe-through①\">piped through</a> <var>transformStream</var>. </p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>serviceWorkerStartTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsened-shared-current-time\" id=\"ref-for-dfn-coarsened-shared-current-time①\">coarsened shared current time</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability①\">cross-origin isolated capability</a>. </p>"
            },
            {
              "html": "<p>Set <var>response</var> to the result of invoking <a data-link-type=\"dfn\" href=\"https://w3c.github.io/ServiceWorker/#handle-fetch\" id=\"ref-for-handle-fetch①\">handle fetch</a> for <var>requestForServiceWorker</var>, with <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller⑧\">controller</a> and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability②\">cross-origin isolated capability</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-html\" title=\"HTML Standard\">[HTML]</a> <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-sw\" title=\"Service Workers\">[SW]</a> </p>"
            },
            {
              "html": "If <var>response</var> is non-null, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info③\">timing info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-service-worker-start-time\" id=\"ref-for-fetch-timing-info-final-service-worker-start-time\">final service worker start time</a> to <var>serviceWorkerStartTime</var>. </p>"
                },
                {
                  "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body⑦\">body</a> is non-null, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\" id=\"ref-for-readablestream-cancel\">cancel</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body⑧\">body</a> with undefined."
                },
                {
                  "html": "<p>Set <var>internalResponse</var> to <var>response</var>, if <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response①③\">filtered response</a>; otherwise to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①⑤\">internal response</a>. </p>"
                },
                {
                  "html": "<p>If one of the following is true </p>\n          <ul class=\"brief\">\n           <li>\n            <p><var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type⑦\">type</a> is \"<code>error</code>\" </p>\n           </li><li>\n            <p><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⑤\">mode</a> is \"<code>same-origin</code>\" and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type⑧\">type</a> is \"<code>cors</code>\" </p>\n           </li><li>\n            <p><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⑥\">mode</a> is not \"<code>no-cors</code>\" and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type⑨\">type</a> is \"<code>opaque</code>\" </p>\n           </li><li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode②\">redirect mode</a> is not \"<code>manual</code>\" and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type①⓪\">type</a> is \"<code>opaqueredirect</code>\" \n           </li><li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode③\">redirect mode</a> is not \"<code>follow</code>\" and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list⑨\">URL list</a> has more than one item. \n          </li></ul>\n          <p>then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③③\">network error</a>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "If <var>response</var> is null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "Then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>preflightResponse</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-preflight-fetch-0\" id=\"ref-for-cors-preflight-fetch-0①\">CORS-preflight fetch</a> given <var>request</var>. </p>"
                },
                {
                  "html": "<p>If <var>preflightResponse</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③④\">network error</a>, then return <var>preflightResponse</var>. </p>"
                }
              ]
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode④\">redirect mode</a> is \"<code>follow</code>\", then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode①\">service-workers mode</a> to \"<code>none</code>\". </p>"
            },
            {
              "html": "<p>Set <var>response</var> and <var>internalResponse</var> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch\">HTTP-network-or-cache fetch</a> given <var>fetchParams</var>. </p>"
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①①\">response tainting</a> is \"<code>cors</code>\" and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cors-check\" id=\"ref-for-concept-cors-check\">CORS check</a> for <var>request</var> and <var>response</var> returns failure, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⑤\">network error</a>. </p>"
            },
            {
              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-tao-check\" id=\"ref-for-concept-tao-check\">TAO check</a> for <var>request</var> and <var>response</var> returns failure,\n   then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#timing-allow-failed\" id=\"ref-for-timing-allow-failed③\">timing allow failed flag</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If either <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①②\">response tainting</a> or <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-type\" id=\"ref-for-concept-response-type①①\">type</a> is \"<code>opaque</code>\", and the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check\" id=\"ref-for-cross-origin-resource-policy-check\">cross-origin resource policy check</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⑤\">origin</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②①\">client</a>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⑦\">destination</a>, and <var>internalResponse</var> returns <b>blocked</b>, then\n  return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⑥\">network error</a>. </p>"
        },
        {
          "html": "If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①⓪\">status</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status②\">redirect status</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①①\">status</a> is not 303, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body⑨\">body</a> is non-null, and the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection\" id=\"ref-for-concept-connection①①\">connection</a> uses HTTP/2, then user agents\n    may, and are even encouraged to, transmit an <code>RST_STREAM</code> frame. </p>"
            },
            {
              "html": "Switch on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑤\">redirect mode</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "\"error\"",
                      "html": "",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>response</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⑦\">network error</a>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"manual\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⑦\">mode</a> is \"<code>navigate</code>\", then set <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller⑨\">controller</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-next-manual-redirect-steps\" id=\"ref-for-fetch-controller-next-manual-redirect-steps②\">next manual redirect steps</a> to run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-redirect-fetch\" id=\"ref-for-concept-http-redirect-fetch\">HTTP-redirect fetch</a> given <var>fetchParams</var> and <var>response</var>. </p>"
                        },
                        {
                          "html": "<p>Otherwise, set <var>response</var> to an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response-opaque-redirect\" id=\"ref-for-concept-filtered-response-opaque-redirect④\">opaque-redirect filtered response</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①⑥\">internal response</a> is <var>internalResponse</var>. </p>"
                        }
                      ]
                    },
                    {
                      "case": "\"follow\"",
                      "html": "",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>response</var> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-redirect-fetch\" id=\"ref-for-concept-http-redirect-fetch①\">HTTP-redirect fetch</a> given <var>fetchParams</var> and <var>response</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>response</var>.  </p>"
        }
      ]
    },
    {
      "name": "HTTP-redirect fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-http-redirect-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-http-redirect-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">HTTP-redirect fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params⑧\">fetch params</a> <var>fetchParams</var> and a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤⑦\">response</a> <var>response</var>,\nrun these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⑤\">request</a>. </p>"
        },
        {
          "html": "<p>Let <var>internalResponse</var> be <var>response</var>, if <var>response</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-filtered-response\" id=\"ref-for-concept-filtered-response①④\">filtered response</a>; otherwise <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-internal-response\" id=\"ref-for-concept-internal-response①⑦\">internal response</a>. </p>"
        },
        {
          "html": "<p>Let <var>locationURL</var> be <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-location-url\" id=\"ref-for-concept-response-location-url①\">location URL</a> given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②①\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-fragment\" id=\"ref-for-concept-url-fragment②\">fragment</a>. </p>"
        },
        {
          "html": "<p>If <var>locationURL</var> is null, then return <var>response</var>. </p>"
        },
        {
          "html": "<p>If <var>locationURL</var> is failure, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⑧\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>locationURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①④\">scheme</a> is not an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#http-scheme\" id=\"ref-for-http-scheme⑨\">HTTP(S) scheme</a>, then\n return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error③⑨\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count①\">redirect count</a> is 20, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④⓪\">network error</a>. </p>"
        },
        {
          "html": "<p>Increase <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-count\" id=\"ref-for-concept-request-redirect-count②\">redirect count</a> by 1. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⑧\">mode</a> is \"<code>cors</code>\", <var>locationURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials\">includes credentials</a>, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⑥\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑦\">same origin</a> with <var>locationURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①⑥\">origin</a>, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④①\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①③\">response tainting</a> is \"<code>cors</code>\" and <var>locationURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials①\">includes credentials</a>, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④②\">network error</a>. </p>"
        },
        {
          "html": "<p>If <var>internalResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①②\">status</a> is not 303, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①⓪\">body</a> is non-null, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①①\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source①\">source</a> is null, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④③\">network error</a>. </p>"
        },
        {
          "html": "then:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①②\">method</a> to `<code>GET</code>` and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①②\">body</a> to null. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>headerName</var> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-body-header-name\" id=\"ref-for-request-body-header-name\">request-body-header name</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete\">delete</a> <var>headerName</var> from <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①⑤\">header list</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②②\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①⑦\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑧\">same origin</a> with <var>locationURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①⑧\">origin</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①①\">for each</a> <var>headerName</var> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-non-wildcard-request-header-name\" id=\"ref-for-cors-non-wildcard-request-header-name\">CORS non-wildcard request-header name</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete①\">delete</a> <var>headerName</var> from <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①⑥\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①③\">body</a> is non-null, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①④\">body</a> to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body③\">body</a> of the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#bodyinit-safely-extract\" id=\"ref-for-bodyinit-safely-extract④\">safely extracting</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body①⑤\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source②\">source</a>. </p>"
        },
        {
          "html": "<p>Let <var>timingInfo</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info④\">timing info</a>. </p>"
        },
        {
          "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-redirect-end-time\" id=\"ref-for-fetch-timing-info-redirect-end-time\">redirect end time</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-post-redirect-start-time\" id=\"ref-for-fetch-timing-info-post-redirect-start-time②\">post-redirect start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsened-shared-current-time\" id=\"ref-for-dfn-coarsened-shared-current-time②\">coarsened shared current time</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability③\">cross-origin isolated capability</a>. </p>"
        },
        {
          "html": "<p>If <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-redirect-start-time\" id=\"ref-for-fetch-timing-info-redirect-start-time\">redirect start time</a> is 0, then set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-redirect-start-time\" id=\"ref-for-fetch-timing-info-redirect-start-time①\">redirect start time</a> to <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-start-time\" id=\"ref-for-fetch-timing-info-start-time③\">start time</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append⑨\">Append</a> <var>locationURL</var> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list⑤\">URL list</a>. </p>"
        },
        {
          "html": "<p>Invoke <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-referrer-policy/#set-requests-referrer-policy-on-redirect\" id=\"ref-for-set-requests-referrer-policy-on-redirect\">set <var>request</var>’s referrer policy on redirect</a> on <var>request</var> and <var>internalResponse</var>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-referrer\" title=\"Referrer Policy\">[REFERRER]</a> </p>"
        },
        {
          "html": "<p>Let <var>recursive</var> be true. </p>"
        },
        {
          "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑥\">redirect mode</a> is \"<code>manual</code>\", then:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⓪\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode①⑨\">mode</a> is\n   \"<code>navigate</code>\". </p>"
            },
            {
              "html": "<p>Set <var>recursive</var> to false. </p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-main-fetch\" id=\"ref-for-concept-main-fetch①\">main fetch</a> given <var>fetchParams</var> and <var>recursive</var>. </p>"
        }
      ]
    },
    {
      "name": "HTTP-network-or-cache fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-http-network-or-cache-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">HTTP-network-or-cache fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params⑨\">fetch params</a> <var>fetchParams</var>, an optional boolean <var>isAuthenticationFetch</var> (default false), and an optional boolean <var>isNewConnectionFetch</var> (default false), run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⑥\">request</a>. </p>"
        },
        {
          "html": "<p>Let <var>httpFetchParams</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>httpRequest</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>response</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>storedResponse</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>httpCache</var> be null. </p>"
        },
        {
          "html": "<p>Let the <var>revalidatingFlag</var> be unset. </p>"
        },
        {
          "html": "Run these steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled③\">canceled</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window⑤\">window</a> is \"<code>no-window</code>\" and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑦\">redirect mode</a> is \"<code>error</code>\", then set <var>httpFetchParams</var> to <var>fetchParams</var> and <var>httpRequest</var> to <var>request</var>. </p>"
            },
            {
              "html": "Otherwise:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>httpRequest</var> to a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-clone\" id=\"ref-for-concept-request-clone①\">clone</a> of <var>request</var>. </p>"
                },
                {
                  "html": "<p>Set <var>httpFetchParams</var> to a copy of <var>fetchParams</var>. </p>"
                },
                {
                  "html": "<p>Set <var>httpFetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⑦\">request</a> to <var>httpRequest</var>. </p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>includeCredentials</var> be true if one of </p>\n        <ul class=\"brief\">\n         <li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①⓪\">credentials mode</a> is\n     \"<code>include</code>\" \n         </li><li><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①①\">credentials mode</a> is\n     \"<code>same-origin</code>\" and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①⑤\">response tainting</a> is \"<code>basic</code>\" \n        </li></ul>\n        <p>is true; otherwise false. </p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cross-origin-embedder-policy-allows-credentials\" id=\"ref-for-cross-origin-embedder-policy-allows-credentials\">Cross-Origin-Embedder-Policy allows credentials</a> with <var>request</var> returns\n   false, then set <var>includeCredentials</var> to false. </p>"
            },
            {
              "html": "<p>Let <var>contentLength</var> be <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②⓪\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-total-bytes\" id=\"ref-for-concept-body-total-bytes①\">length</a>, if <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②①\">body</a> is non-null;\n   otherwise null. </p>"
            },
            {
              "html": "<p>Let <var>contentLengthHeaderValue</var> be null. </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②②\">body</a> is null and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①③\">method</a> is `<code>POST</code>` or `<code>PUT</code>`, then set <var>contentLengthHeaderValue</var> to `<code>0</code>`. </p>"
            },
            {
              "html": "<p>If <var>contentLength</var> is non-null, then set <var>contentLengthHeaderValue</var> to <var>contentLength</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serialize-an-integer\" id=\"ref-for-serialize-an-integer⑦\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode⑨\">isomorphic encoded</a>. </p>"
            },
            {
              "html": "<p>If <var>contentLengthHeaderValue</var> is non-null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append⑤\">append</a> (`<code>Content-Length</code>`, <var>contentLengthHeaderValue</var>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①⑦\">header list</a>. </p>"
            },
            {
              "html": "If <var>contentLength</var> is non-null and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag①\">keepalive</a> is true, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>inflightKeepaliveBytes</var> be 0. </p>"
                },
                {
                  "html": "<p>Let <var>group</var> be <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②③\">client</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-group\" id=\"ref-for-concept-fetch-group③\">fetch group</a>. </p>"
                },
                {
                  "html": "<p>Let <var>inflightRecords</var> be the set of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record\" id=\"ref-for-concept-fetch-record⑦\">fetch records</a> in <var>group</var> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record-request\" id=\"ref-for-concept-fetch-record-request②\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag②\">keepalive</a> is true\n     and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#done-flag\" id=\"ref-for-done-flag③\">done flag</a> is unset. </p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①②\">For each</a> <var>fetchRecord</var> of <var>inflightRecords</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>inflightRequest</var> be <var>fetchRecord</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-record-request\" id=\"ref-for-concept-fetch-record-request③\">request</a>. </p>"
                    },
                    {
                      "html": "<p>Increment <var>inflightKeepaliveBytes</var> by <var>inflightRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②③\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-total-bytes\" id=\"ref-for-concept-body-total-bytes②\">length</a>. </p>"
                    }
                  ]
                },
                {
                  "html": "<p>If the sum of <var>contentLength</var> and <var>inflightKeepaliveBytes</var> is greater\n     than 64 kibibytes, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④④\">network error</a>. </p>"
                }
              ]
            },
            {
              "html": "If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer④\">referrer</a> is a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url①⑨\">URL</a>, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>referrerValue</var> be <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑤\">referrer</a>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer①\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode①⓪\">isomorphic encoded</a>. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append⑥\">Append</a> (`<code>Referer</code>`, <var>referrerValue</var>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①⑧\">header list</a>. </p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#append-a-request-origin-header\" id=\"ref-for-append-a-request-origin-header\">Append a request `<code>Origin</code>` header</a> for <var>httpRequest</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webappsec-fetch-metadata/#abstract-opdef-append-the-fetch-metadata-headers-for-a-request\" id=\"ref-for-abstract-opdef-append-the-fetch-metadata-headers-for-a-request\">Append the Fetch metadata headers for <var>httpRequest</var></a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-fetch-metadata\" title=\"Fetch Metadata Request Headers\">[FETCH-METADATA]</a> </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator⑤\">initiator</a> is \"<code>prefetch</code>\", then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header\" id=\"ref-for-concept-header-list-set-structured-header\">set a structured field value</a> given (`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-sec-purpose\" id=\"ref-for-http-sec-purpose①\"><code>Sec-Purpose</code></a>`,\n   the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9651.html#token\" id=\"ref-for-token②\">token</a> <code>prefetch</code>) in <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list①⑨\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⓪\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①②\">does not contain</a> `<code>User-Agent</code>`, then user agents should <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append⑦\">append</a> (`<code>User-Agent</code>`, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#default-user-agent-value\" id=\"ref-for-default-user-agent-value\">default `<code>User-Agent</code>` value</a>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②①\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①\">cache mode</a> is \"<code>default</code>\" and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②②\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①③\">contains</a> `<code>If-Modified-Since</code>`,\n   `<code>If-None-Match</code>`,\n   `<code>If-Unmodified-Since</code>`,\n   `<code>If-Match</code>`, or\n   `<code>If-Range</code>`, then set <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode②\">cache mode</a> to \"<code>no-store</code>\". </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode③\">cache mode</a> is \"<code>no-cache</code>\", <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cache-prevent-cache-control\" id=\"ref-for-no-cache-prevent-cache-control\">prevent no-cache cache-control header modification flag</a> is unset, and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②③\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①④\">does not contain</a> `<code>Cache-Control</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append⑧\">append</a> (`<code>Cache-Control</code>`, `<code>max-age=0</code>`) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②④\">header list</a>. </p>"
            },
            {
              "html": "If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode④\">cache mode</a> is \"<code>no-store</code>\" or\n    \"<code>reload</code>\", then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⑤\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⑤\">does not contain</a> `<code>Pragma</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append⑨\">append</a> (`<code>Pragma</code>`, `<code>no-cache</code>`) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⑥\">header list</a>. </p>"
                },
                {
                  "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⑦\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⑥\">does not contain</a> `<code>Cache-Control</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⓪\">append</a> (`<code>Cache-Control</code>`, `<code>no-cache</code>`) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⑧\">header list</a>. </p>"
                }
              ]
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list②⑨\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⑦\">contains</a> `<code>Range</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①①\">append</a> (`<code>Accept-Encoding</code>`,\n    `<code>identity</code>`) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⓪\">header list</a>. </p>"
            },
            {
              "html": "<p>Modify <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③①\">header list</a> per HTTP. Do not <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①②\">append</a> a given <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤⓪\">header</a> if <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③②\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⑧\">contains</a> that <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤①\">header</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②⓪\">name</a>. </p>\n        \n        <p>`<code>Accept</code>`,\n    `<code>Accept-Charset</code>`, and\n    `<code>Accept-Language</code>` must not be included at this point. </p>"
            },
            {
              "html": "If <var>includeCredentials</var> is true, then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the user agent is not configured to block cookies for <var>httpRequest</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#privacy-considerations\">section 7</a> of <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), then:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>cookies</var> be the result of running the \"cookie-string\" algorithm (see <a href=\"https://httpwg.org/specs/rfc6265.html#cookie\">section 5.4</a> of <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>) with the user agent’s cookie store and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②③\">current URL</a>. </p>"
                    },
                    {
                      "html": "If <var>cookies</var> is not the empty string, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①④\">append</a> (`<code>Cookie</code>`, <var>cookies</var>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③③\">header list</a>."
                    }
                  ]
                },
                {
                  "html": "If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③④\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains①⑨\">does not contain</a> `<code>Authorization</code>`, then:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>authorizationValue</var> be null. </p>"
                    },
                    {
                      "html": "<p>If there’s an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#authentication-entry\" id=\"ref-for-authentication-entry③\">authentication entry</a> for <var>httpRequest</var> and either <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag\" id=\"ref-for-concept-request-use-url-credentials-flag\">use-URL-credentials flag</a> is unset or <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②④\">current URL</a> does not <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials②\">include credentials</a>,\n       then set <var>authorizationValue</var> to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#authentication-entry\" id=\"ref-for-authentication-entry④\">authentication entry</a>. </p>"
                    },
                    {
                      "html": "<p>Otherwise, if <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⑤\">current URL</a> does <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials③\">include credentials</a> and <var>isAuthenticationFetch</var> is true, set <var>authorizationValue</var> to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⑥\">current URL</a>, <span class=\"XXX\">converted to an `<code>Authorization</code>` value</span>. </p>"
                    },
                    {
                      "html": "<p>If <var>authorizationValue</var> is non-null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⑤\">append</a> (`<code>Authorization</code>`, <var>authorizationValue</var>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⑤\">header list</a>. </p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>If there’s a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#proxy-authentication-entry\" id=\"ref-for-proxy-authentication-entry\">proxy-authentication entry</a>, use it as appropriate. </p>"
            },
            {
              "html": "<p>Set <var>httpCache</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#determine-the-http-cache-partition\" id=\"ref-for-determine-the-http-cache-partition\">determining the HTTP cache partition</a>,\n   given <var>httpRequest</var>. </p>"
            },
            {
              "html": "<p>If <var>httpCache</var> is null, then set <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode⑤\">cache mode</a> to \"<code>no-store</code>\". </p>"
            },
            {
              "html": "If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode⑥\">cache mode</a> is neither \"<code>no-store</code>\"\n    nor \"<code>reload</code>\", then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>storedResponse</var> to the result of selecting a response from the <var>httpCache</var>, possibly needing validation, as per the\n      \"<a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9111.html#constructing.responses.from.caches\" id=\"ref-for-constructing.responses.from.caches\">Constructing Responses from Caches</a>\" chapter of <cite>HTTP Caching</cite>, if any. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http-caching\" title=\"HTTP Caching\">[HTTP-CACHING]</a> </p>"
                },
                {
                  "html": "If <var>storedResponse</var> is non-null, then:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode⑦\">cache mode</a> is \"<code>default</code>\", <var>storedResponse</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-stale-while-revalidate-response\" id=\"ref-for-concept-stale-while-revalidate-response②\">stale-while-revalidate response</a>, and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②④\">client</a> is non-null, then:",
                      "rationale": "set",
                      "steps": [
                        {
                          "html": "<p>Set <var>response</var> to <var>storedResponse</var>. </p>"
                        },
                        {
                          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cache-state\" id=\"ref-for-concept-response-cache-state①\">cache state</a> to \"<code>local</code>\". </p>"
                        },
                        {
                          "html": "<p>Let <var>revalidateRequest</var> be a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-clone\" id=\"ref-for-concept-request-clone②\">clone</a> of <var>request</var>. </p>"
                        },
                        {
                          "html": "<p>Set <var>revalidateRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode⑧\">cache mode</a> set to\n         \"<code>no-cache</code>\". </p>"
                        },
                        {
                          "html": "<p>Set <var>revalidateRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cache-prevent-cache-control\" id=\"ref-for-no-cache-prevent-cache-control①\">prevent no-cache cache-control header modification flag</a>. </p>"
                        },
                        {
                          "html": "<p>Set <var>revalidateRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode②\">service-workers mode</a> set to\n         \"<code>none</code>\". </p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">In parallel</a>, run <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-main-fetch\" id=\"ref-for-concept-main-fetch③\">main fetch</a> given a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params①⓪\">fetch params</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⑧\">request</a> is <var>revalidateRequest</var>. </p>"
                        }
                      ]
                    },
                    {
                      "html": "Otherwise:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>storedResponse</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-stale-response\" id=\"ref-for-concept-stale-response①\">stale response</a>, then set the <var>revalidatingFlag</var>. </p>"
                        },
                        {
                          "html": "If the <var>revalidatingFlag</var> is set and <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode⑨\">cache mode</a> is neither \"<code>force-cache</code>\" nor\n          \"<code>only-if-cached</code>\", then:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>storedResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⓪\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②⓪\">contains</a> `<code>ETag</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⑥\">append</a> (`<code>If-None-Match</code>`, `<code>ETag</code>`'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value①⑧\">value</a>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⑥\">header list</a>. </p>"
                            },
                            {
                              "html": "<p>If <var>storedResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②①\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②①\">contains</a> `<code>Last-Modified</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⑦\">append</a> (`<code>If-Modified-Since</code>`,\n           `<code>Last-Modified</code>`'s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value①⑨\">value</a>) to <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⑦\">header list</a>. </p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Otherwise, set <var>response</var> to <var>storedResponse</var> and set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cache-state\" id=\"ref-for-concept-response-cache-state②\">cache state</a> to \"<code>local</code>\". </p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error①\">appropriate network error</a> for <var>fetchParams</var>. </p>"
        },
        {
          "html": "If <var>response</var> is null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①⓪\">cache mode</a> is\n   \"<code>only-if-cached</code>\", then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④⑤\">network error</a>. </p>"
            },
            {
              "html": "<p>Let <var>forwardResponse</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-fetch\" id=\"ref-for-concept-http-network-fetch\">HTTP-network fetch</a> given <var>httpFetchParams</var>, <var>includeCredentials</var>, and <var>isNewConnectionFetch</var>. </p>"
            },
            {
              "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①④\">method</a> is <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9110.html#rfc.section.9.2.1\" id=\"ref-for-rfc.section.9.2.1\">unsafe</a> and <var>forwardResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①⑤\">status</a> is in the range 200 to 399, inclusive,\n   invalidate appropriate stored responses in <var>httpCache</var>, as per the\n   \"<a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9111.html#invalidation\" id=\"ref-for-invalidation\">Invalidating Stored Responses</a>\" chapter of <cite>HTTP Caching</cite>, and set <var>storedResponse</var> to null. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http-caching\" title=\"HTTP Caching\">[HTTP-CACHING]</a> </p>"
            },
            {
              "html": "If the <var>revalidatingFlag</var> is set and <var>forwardResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①⑥\">status</a> is 304, then:",
              "rationale": "update",
              "steps": [
                {
                  "html": "<p>Update <var>storedResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②②\">header list</a> using <var>forwardResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②③\">header list</a>, as per the\n      \"<a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9111.html#freshening.responses\" id=\"ref-for-freshening.responses\">Freshening Stored Responses upon Validation</a>\" chapter of <cite>HTTP Caching</cite>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http-caching\" title=\"HTTP Caching\">[HTTP-CACHING]</a> </p>"
                },
                {
                  "html": "<p>Set <var>response</var> to <var>storedResponse</var>. </p>"
                },
                {
                  "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-cache-state\" id=\"ref-for-concept-response-cache-state③\">cache state</a> to \"<code>validated</code>\". </p>"
                }
              ]
            },
            {
              "html": "If <var>response</var> is null, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>response</var> to <var>forwardResponse</var>. </p>"
                },
                {
                  "html": "<p>Store <var>httpRequest</var> and <var>forwardResponse</var> in <var>httpCache</var>, as per\n      the \"<a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9111.html#response.cacheability\" id=\"ref-for-response.cacheability\">Storing Responses in Caches</a>\" chapter of <cite>HTTP Caching</cite>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http-caching\" title=\"HTTP Caching\">[HTTP-CACHING]</a> </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-url-list\" id=\"ref-for-concept-response-url-list①⓪\">URL list</a> to a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone①\">clone</a> of <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list⑥\">URL list</a>. </p>"
        },
        {
          "html": "<p>If <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⑧\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②②\">contains</a> `<code>Range</code>`, then set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-range-requested-flag\" id=\"ref-for-concept-response-range-requested-flag②\">range-requested flag</a>. </p>"
        },
        {
          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-request-includes-credentials\" id=\"ref-for-response-request-includes-credentials①\">request-includes-credentials</a> to <var>includeCredentials</var>. </p>"
        },
        {
          "html": "If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①⑦\">status</a> is 401, <var>httpRequest</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①⑥\">response tainting</a> is not \"<code>cors</code>\", <var>includeCredentials</var> is\n  true, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window⑥\">window</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①①\">environment settings object</a>,\n  then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>Needs testing: multiple `<code>WWW-Authenticate</code>` headers, missing,\n   parsing issues. </p>"
            },
            {
              "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②④\">body</a> is non-null, then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②⑤\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source⑥\">source</a> is null,\n     then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④⑦\">network error</a>. </p>"
                },
                {
                  "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②⑥\">body</a> to the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body④\">body</a> of the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#bodyinit-safely-extract\" id=\"ref-for-bodyinit-safely-extract⑤\">safely extracting</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body②⑦\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source⑦\">source</a>. </p>"
                }
              ]
            },
            {
              "html": "If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-use-url-credentials-flag\" id=\"ref-for-concept-request-use-url-credentials-flag①\">use-URL-credentials flag</a> is unset or <var>isAuthenticationFetch</var> is true, then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled④\">canceled</a>, then return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error②\">appropriate network error</a> for <var>fetchParams</var>. </p>"
                },
                {
                  "html": "<p>Let <var>username</var> and <var>password</var> be the result of prompting the end user\n     for a username and password, respectively, in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window⑦\">window</a>. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#set-the-username\" id=\"ref-for-set-the-username①\">Set the username</a> given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⑦\">current URL</a> and <var>username</var>. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#set-the-password\" id=\"ref-for-set-the-password①\">Set the password</a> given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⑧\">current URL</a> and <var>password</var>. </p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>response</var> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch①\">HTTP-network-or-cache fetch</a> given <var>fetchParams</var> and true. </p>"
            }
          ]
        },
        {
          "html": "If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status①⑧\">status</a> is 407, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window⑧\">window</a> is\n   \"<code>no-window</code>\", then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④⑧\">network error</a>. </p>"
            },
            {
              "html": "<p>Needs testing: multiple `<code>Proxy-Authenticate</code>` headers, missing,\n   parsing issues. </p>"
            },
            {
              "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled⑤\">canceled</a>, then return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error③\">appropriate network error</a> for <var>fetchParams</var>. </p>"
            },
            {
              "html": "<p>Prompt the end user as appropriate in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window⑨\">window</a> and store the result as a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#proxy-authentication-entry\" id=\"ref-for-proxy-authentication-entry①\">proxy-authentication entry</a>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-http\" title=\"HTTP Semantics\">[HTTP]</a> </p>"
            },
            {
              "html": "<p>Set <var>response</var> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch②\">HTTP-network-or-cache fetch</a> given <var>fetchParams</var>. </p>"
            }
          ]
        },
        {
          "html": "then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled⑥\">canceled</a>, then return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error④\">appropriate network error</a> for <var>fetchParams</var>. </p>"
            },
            {
              "html": "<p>Set <var>response</var> to the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch③\">HTTP-network-or-cache fetch</a> given <var>fetchParams</var>, <var>isAuthenticationFetch</var>, and true. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>isAuthenticationFetch</var> is true, then create an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#authentication-entry\" id=\"ref-for-authentication-entry⑤\">authentication entry</a> for <var>request</var> and the given realm. </p>"
        },
        {
          "html": "<p>Return <var>response</var>.  </p>"
        }
      ]
    },
    {
      "name": "HTTP-network fetch",
      "href": "https://fetch.spec.whatwg.org/#concept-http-network-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-http-network-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">HTTP-network fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params①①\">fetch params</a> <var>fetchParams</var>, an optional boolean <var>includeCredentials</var> (default false), and an\noptional boolean <var>forceNewConnection</var> (default false), run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request①⑨\">request</a>. </p>"
        },
        {
          "html": "<p>Let <var>response</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>timingInfo</var> be <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-timing-info\" id=\"ref-for-fetch-params-timing-info⑤\">timing info</a>. </p>"
        },
        {
          "html": "<p>Let <var>networkPartitionKey</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-determine-the-network-partition-key\" id=\"ref-for-request-determine-the-network-partition-key①\">determining the network partition key</a> given <var>request</var>. </p>"
        },
        {
          "html": "<p>Let <var>newConnection</var> be \"<code>yes</code>\" if <var>forceNewConnection</var> is true;\n otherwise \"<code>no</code>\". </p>"
        },
        {
          "html": "<p>Switch on <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⓪\">mode</a>: </p>\n      <dl>\n       <dt>\"<code>websocket</code>\" \n       </dt><dd>\n        <p>Let <var>connection</var> be the result of <a data-link-type=\"dfn\" href=\"https://websockets.spec.whatwg.org/#concept-websocket-connection-obtain\" id=\"ref-for-concept-websocket-connection-obtain\">obtaining a WebSocket connection</a>, given <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url②⑨\">current URL</a>. </p>\n       </dd><dt>Otherwise \n       </dt><dd>\n        <p>Let <var>connection</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection-obtain\" id=\"ref-for-concept-connection-obtain①\">obtaining a connection</a>, given <var>networkPartitionKey</var>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③⓪\">current URL</a>, <var>includeCredentials</var>, and <var>newConnection</var>. </p>\n      </dd></dl>"
        },
        {
          "html": "Run these steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when①\">abort when</a> <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled⑦\">canceled</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>connection</var> is failure, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error④⑨\">network error</a>. </p>"
            },
            {
              "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-connection-timing-info\" id=\"ref-for-fetch-timing-info-final-connection-timing-info\">final connection timing info</a> to\n   the result of calling <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#clamp-and-coarsen-connection-timing-info\" id=\"ref-for-clamp-and-coarsen-connection-timing-info①\">clamp and coarsen connection timing info</a> with <var>connection</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-connection-timing-info\" id=\"ref-for-concept-connection-timing-info②\">timing info</a>, <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-post-redirect-start-time\" id=\"ref-for-fetch-timing-info-post-redirect-start-time③\">post-redirect start time</a>, and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability④\">cross-origin isolated capability</a>. </p>"
            },
            {
              "html": "<p>If <var>connection</var> is an HTTP/1.x connection, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body③①\">body</a> is non-null, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body③②\">body</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source⑨\">source</a> is null, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤⓪\">network error</a>. </p>"
            },
            {
              "html": "Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-network-request-start-time\" id=\"ref-for-fetch-timing-info-final-network-request-start-time\">final network-request start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsened-shared-current-time\" id=\"ref-for-dfn-coarsened-shared-current-time③\">coarsened shared current time</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability⑤\">cross-origin isolated capability</a>."
            },
            {
              "html": "While true:",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-network-response-start-time\" id=\"ref-for-fetch-timing-info-final-network-response-start-time\">final network-response start time</a> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-coarsened-shared-current-time\" id=\"ref-for-dfn-coarsened-shared-current-time④\">coarsened shared current time</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-cross-origin-isolated-capability\" id=\"ref-for-fetch-params-cross-origin-isolated-capability⑥\">cross-origin isolated capability</a>, immediately after the user\n       agent’s HTTP parser receives the first byte of the response (e.g., frame header bytes for\n       HTTP/2 or response status line for HTTP/1.x). </p>"
                },
                {
                  "html": "<p>Wait until all the HTTP response headers are transmitted. </p>"
                },
                {
                  "html": "<p>Let <var>status</var> be the HTTP response’s status code. </p>"
                },
                {
                  "html": "If <var>status</var> is in the range 100 to 199, inclusive:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-first-interim-network-response-start-time\" id=\"ref-for-fetch-timing-info-first-interim-network-response-start-time\">first interim network-response start time</a> is 0, then set <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-first-interim-network-response-start-time\" id=\"ref-for-fetch-timing-info-first-interim-network-response-start-time①\">first interim network-response start time</a> to <var>timingInfo</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-final-network-response-start-time\" id=\"ref-for-fetch-timing-info-final-network-response-start-time①\">final network-response start time</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②①\">mode</a> is \"<code>websocket</code>\" and <var>status</var> is 101, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">break</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>status</var> is 103 and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-early-hints-response\" id=\"ref-for-fetch-params-process-early-hints-response①\">process early hints response</a> is non-null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task⑧\">queue a fetch task</a> to run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-early-hints-response\" id=\"ref-for-fetch-params-process-early-hints-response②\">process early hints response</a>, with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑤⑨\">response</a>. </p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">Continue</a>. </p>"
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break④\">Break</a>. </p>"
                }
              ],
              "additional": [
                {
                  "html": "If the HTTP request results in a TLS client certificate dialog, then:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①⓪\">window</a> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①②\">environment settings object</a>, make the dialog\n     available in <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①①\">window</a>. </p>"
                    },
                    {
                      "html": "<p>Otherwise, return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤②\">network error</a>. </p>"
                    }
                  ]
                },
                {
                  "html": "To transmit <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④②\">body</a> <var>body</var>, run these steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>body</var> is null and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-end-of-body\" id=\"ref-for-fetch-params-process-request-end-of-body①\">process request end-of-body</a> is non-null, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task⑨\">queue a fetch task</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-end-of-body\" id=\"ref-for-fetch-params-process-request-end-of-body②\">process request end-of-body</a> and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination⑥\">task destination</a>. </p>"
                    },
                    {
                      "html": "Otherwise, if <var>body</var> is non-null:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var>processBodyChunk</var> given <var>bytes</var> be these steps:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled⑧\">canceled</a>, then abort these\n         steps. </p>"
                            },
                            {
                              "html": "<p>Run this step <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>: transmit <var>bytes</var>. </p>"
                            },
                            {
                              "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-body\" id=\"ref-for-fetch-params-process-request-body①\">process request body chunk length</a> is non-null, then run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-body\" id=\"ref-for-fetch-params-process-request-body②\">process request body chunk length</a> given <var>bytes</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length②\">length</a>. </p>"
                            }
                          ]
                        },
                        {
                          "html": "Let <var>processEndOfBody</var> be these steps:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled⑨\">canceled</a>, then abort these\n         steps. </p>"
                            },
                            {
                              "html": "<p>If <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-end-of-body\" id=\"ref-for-fetch-params-process-request-end-of-body③\">process request end-of-body</a> is\n         non-null, then run <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-process-request-end-of-body\" id=\"ref-for-fetch-params-process-request-end-of-body④\">process request end-of-body</a>. </p>"
                            }
                          ]
                        },
                        {
                          "html": "Let <var>processBodyError</var> given <var>e</var> be these steps:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled①⓪\">canceled</a>, then abort these\n         steps. </p>"
                            },
                            {
                              "html": "<p>If <var>e</var> is an \"<code><a class=\"idl-code\" data-link-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\" id=\"ref-for-aborterror②\">AbortError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>,\n         then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-abort\" id=\"ref-for-fetch-controller-abort\">abort</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①⓪\">controller</a>. </p>"
                            },
                            {
                              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-terminate\" id=\"ref-for-fetch-controller-terminate②\">terminate</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①①\">controller</a>. </p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-incrementally-read\" id=\"ref-for-body-incrementally-read\">Incrementally read</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④③\">body</a> given <var>processBodyChunk</var>, <var>processEndOfBody</var>, <var>processBodyError</var>, and <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination⑦\">task destination</a>. </p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted①\">If aborted</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>connection</var> uses HTTP/2, then transmit an <code>RST_STREAM</code> frame. </p>"
            },
            {
              "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#appropriate-network-error\" id=\"ref-for-appropriate-network-error⑤\">appropriate network error</a> for <var>fetchParams</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>buffer</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⑦\">byte sequence</a>. </p>"
        },
        {
          "html": "Let <var>pullAlgorithm</var> be the followings steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a>. </p>"
            },
            {
              "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If the size of <var>buffer</var> is smaller than a lower limit chosen by the user agent and the\n     ongoing fetch is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-suspend\" id=\"ref-for-concept-fetch-suspend\">suspended</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-resume\" id=\"ref-for-concept-fetch-resume\">resume</a> the fetch. </p>"
                },
                {
                  "html": "<p>Wait until <var>buffer</var> is not empty. </p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#queue-a-fetch-task\" id=\"ref-for-queue-a-fetch-task①⓪\">Queue a fetch task</a> to run the following steps, with <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-task-destination\" id=\"ref-for-fetch-params-task-destination⑧\">task destination</a>.",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-pull-from-bytes\" id=\"ref-for-readablestream-pull-from-bytes\">Pull from bytes</a> <var>buffer</var> into <var>stream</var>. </p>"
                    },
                    {
                      "html": "<p>If <var>stream</var> is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-errored\" id=\"ref-for-readablestream-errored\">errored</a>, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-terminate\" id=\"ref-for-fetch-controller-terminate③\">terminate</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①②\">controller</a>. </p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">Resolve</a> <var>promise</var> with undefined. </p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Return <var>promise</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>cancelAlgorithm</var> be an algorithm that <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-abort\" id=\"ref-for-fetch-controller-abort①\">aborts</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①③\">controller</a> with <var>reason</var>, given <var>reason</var>. </p>"
        },
        {
          "html": "<p>Let <var>stream</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream③\">ReadableStream</a></code>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support\" id=\"ref-for-readablestream-set-up-with-byte-reading-support\">Set up</a> <var>stream</var> with byte reading\n support with <var><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm\" id=\"ref-for-readablestream-set-up-pullalgorithm\">pullAlgorithm</a></var> set to <var>pullAlgorithm</var>, <var><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\" id=\"ref-for-readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a></var> set to <var>cancelAlgorithm</var>. </p>"
        },
        {
          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②④\">body</a> to a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body①①\">body</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream①②\">stream</a> is <var>stream</var>. </p>"
        },
        {
          "html": "<p><a class=\"tracking-vector\" href=\"https://infra.spec.whatwg.org/#tracking-vector\" style=\"color: currentcolor\"><img alt=\"(This is a tracking vector.)\" class=\"darkmode-aware\" crossorigin=\"\" height=\"64\" src=\"https://resources.whatwg.org/tracking-vector.svg\" title=\"There is a tracking vector here.\" width=\"46\"></a> If <var>includeCredentials</var> is true and the user agent is not\n configured to block cookies for <var>request</var> (see <a href=\"https://httpwg.org/specs/rfc6265.html#privacy-considerations\">section 7</a> of <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>), then run the \"set-cookie-string\" parsing algorithm (see <a href=\"https://httpwg.org/specs/rfc6265.html#set-cookie\">section 5.2</a> of <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-cookies\" title=\"HTTP State Management Mechanism\">[COOKIES]</a>) on the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value②⓪\">value</a> of each <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤④\">header</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②①\">name</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①④\">byte-case-insensitive</a> match for `<code>Set-Cookie</code>` in <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②④\">header list</a>, if any, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③①\">current URL</a>. </p>"
        },
        {
          "html": "Run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "Run these steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when②\">abort when</a> <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-canceled\" id=\"ref-for-fetch-params-canceled①①\">canceled</a>:",
              "rationale": "while",
              "steps": [
                {
                  "html": "While true:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If one or more bytes have been transmitted from <var>response</var>’s message body, then:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>bytes</var> be the transmitted bytes. </p>"
                        },
                        {
                          "html": "<p>Let <var>codings</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values②\">extracting header list values</a> given\n         `<code>Content-Encoding</code>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⑤\">header list</a>. </p>"
                        },
                        {
                          "html": "<p>Increase <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body-info\" id=\"ref-for-concept-response-body-info⑤\">body info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-encoded-body-size\" id=\"ref-for-fetch-timing-info-encoded-body-size\">encoded size</a> by <var>bytes</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length③\">length</a>. </p>"
                        },
                        {
                          "html": "<p>Set <var>bytes</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#handle-content-codings\" id=\"ref-for-handle-content-codings①\">handling content\n          codings</a> given <var>codings</var> and <var>bytes</var>. </p>"
                        },
                        {
                          "html": "<p>Increase <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body-info\" id=\"ref-for-concept-response-body-info⑥\">body info</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-timing-info-decoded-body-size\" id=\"ref-for-fetch-timing-info-decoded-body-size\">decoded size</a> by <var>bytes</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length④\">length</a>. </p>"
                        },
                        {
                          "html": "<p>If <var>bytes</var> is failure, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-terminate\" id=\"ref-for-fetch-controller-terminate④\">terminate</a> <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①④\">controller</a>. </p>"
                        },
                        {
                          "html": "<p>Append <var>bytes</var> to <var>buffer</var>. </p>"
                        },
                        {
                          "html": "<p>If the size of <var>buffer</var> is larger than an upper limit chosen by the user agent, ask\n         the user agent to <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch-suspend\" id=\"ref-for-concept-fetch-suspend①\">suspend</a> the ongoing fetch. </p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Otherwise, if the bytes transmission for <var>response</var>’s message body is done\n       normally and <var>stream</var> is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-readable\" id=\"ref-for-readablestream-readable\">readable</a>, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\" id=\"ref-for-readablestream-close\">close</a> <var>stream</var>, and abort these in-parallel steps. </p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted②\">If aborted</a>, then:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>fetchParams</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-aborted\" id=\"ref-for-fetch-params-aborted①\">aborted</a>, then:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-aborted\" id=\"ref-for-concept-response-aborted①\">aborted flag</a>. </p>"
                    },
                    {
                      "html": "<p>If <var>stream</var> is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-readable\" id=\"ref-for-readablestream-readable①\">readable</a>, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error\">error</a> <var>stream</var> with the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#deserialize-a-serialized-abort-reason\" id=\"ref-for-deserialize-a-serialized-abort-reason\">deserialize a serialized abort reason</a> given <var>fetchParams</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-controller\" id=\"ref-for-fetch-params-controller①⑤\">controller</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-serialized-abort-reason\" id=\"ref-for-fetch-controller-serialized-abort-reason①\">serialized abort reason</a> and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑧\">implementation-defined</a> <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm①\">realm</a>. </p>"
                    }
                  ]
                },
                {
                  "html": "<p>Otherwise, if <var>stream</var> is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-readable\" id=\"ref-for-readablestream-readable②\">readable</a>, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error①\">error</a> <var>stream</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code>. </p>"
                },
                {
                  "html": "<p>If <var>connection</var> uses HTTP/2, then transmit an <code>RST_STREAM</code> frame. </p>"
                },
                {
                  "html": "<p>Otherwise, the user agent should close <var>connection</var> unless it would be bad for\n      performance to do so. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>response</var>.  </p>"
        }
      ]
    },
    {
      "name": "CORS-preflight fetch",
      "href": "https://fetch.spec.whatwg.org/#cors-preflight-fetch-0",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"cors-preflight-fetch-0\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CORS-preflight fetch</dfn>, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⓪⑧\">request</a> <var>request</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>preflight</var> be a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①⓪⑨\">request</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①⑤\">method</a> is `<code>OPTIONS</code>`, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list⑦\">URL list</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone②\">clone</a> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list⑧\">URL list</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator⑥\">initiator</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-initiator\" id=\"ref-for-concept-request-initiator⑦\">initiator</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⑧\">destination</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-destination\" id=\"ref-for-concept-request-destination①⑨\">destination</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⑦\">origin</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⑧\">origin</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑥\">referrer</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑦\">referrer</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy④\">referrer policy</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy⑤\">referrer policy</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②②\">mode</a> is \"<code>cors</code>\", and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①⑦\">response tainting</a> is \"<code>cors</code>\". </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⑧\">Append</a> (`<code>Accept</code>`, `<code>*/*</code>`) to <var>preflight</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list③⑨\">header list</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append①⑨\">Append</a> (`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-request-method\" id=\"ref-for-http-access-control-request-method①\"><code>Access-Control-Request-Method</code></a>`, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①⑥\">method</a>) to <var>preflight</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⓪\">header list</a>. </p>"
        },
        {
          "html": "<p>Let <var>headers</var> be the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-unsafe-request-header-names\" id=\"ref-for-cors-unsafe-request-header-names②\">CORS-unsafe request-header names</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④①\">header list</a>. </p>"
        },
        {
          "html": "If <var>headers</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">is not empty</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>value</var> be the items in <var>headers</var> separated from each other by\n   `<code>,</code>`. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append②⓪\">Append</a> (`<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-request-headers\" id=\"ref-for-http-access-control-request-headers①\"><code>Access-Control-Request-Headers</code></a>`, <var>value</var>) to <var>preflight</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④②\">header list</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>response</var> be the result of running <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch\" id=\"ref-for-concept-http-network-or-cache-fetch⑤\">HTTP-network-or-cache fetch</a> given\n a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params\" id=\"ref-for-fetch-params①②\">fetch params</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-params-request\" id=\"ref-for-fetch-params-request②⓪\">request</a> is <var>preflight</var>. </p>"
        },
        {
          "html": "If a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cors-check\" id=\"ref-for-concept-cors-check③\">CORS check</a> for <var>request</var> and <var>response</var> returns success and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②⓪\">status</a> is an <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#ok-status\" id=\"ref-for-ok-status①\">ok status</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>methods</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values③\">extracting header list values</a> given\n   `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-allow-methods\" id=\"ref-for-http-access-control-allow-methods②\"><code>Access-Control-Allow-Methods</code></a>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⑥\">header list</a>. </p>"
            },
            {
              "html": "<p>Let <var>headerNames</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values④\">extracting header list values</a> given\n   `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-allow-headers\" id=\"ref-for-http-access-control-allow-headers②\"><code>Access-Control-Allow-Headers</code></a>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⑦\">header list</a>. </p>"
            },
            {
              "html": "<p>If either <var>methods</var> or <var>headerNames</var> is failure,\n   return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤③\">network error</a>. </p>"
            },
            {
              "html": "<p>If <var>methods</var> is null and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#use-cors-preflight-flag\" id=\"ref-for-use-cors-preflight-flag④\">use-CORS-preflight flag</a> is set, then set <var>methods</var> to a new list containing <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①⑦\">method</a>. </p>"
            },
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①⑧\">method</a> is not in <var>methods</var>, <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method①⑨\">method</a> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-safelisted-method\" id=\"ref-for-cors-safelisted-method③\">CORS-safelisted method</a>, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①④\">credentials mode</a> is \"<code>include</code>\" or <var>methods</var> does not contain `<code>*</code>`, then return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤④\">network error</a>. </p>"
            },
            {
              "html": "<p>If one of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④③\">header list</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②②\">names</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-non-wildcard-request-header-name\" id=\"ref-for-cors-non-wildcard-request-header-name①\">CORS non-wildcard request-header name</a> and is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①⑤\">byte-case-insensitive</a> match for an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item②\">item</a> in <var>headerNames</var>, then\n   return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤⑤\">network error</a>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①③\">For each</a> <var>unsafeName</var> of the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-unsafe-request-header-names\" id=\"ref-for-cors-unsafe-request-header-names③\">CORS-unsafe request-header names</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④④\">header list</a>, if <var>unsafeName</var> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①⑥\">byte-case-insensitive</a> match for an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item③\">item</a> in <var>headerNames</var> and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①⑤\">credentials mode</a> is \"<code>include</code>\" or <var>headerNames</var> does not\n   contain `<code>*</code>`, return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤⑥\">network error</a>. </p>"
            },
            {
              "html": "<p>Let <var>max-age</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#extract-header-list-values\" id=\"ref-for-extract-header-list-values⑤\">extracting header list values</a> given\n   `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-max-age\" id=\"ref-for-http-access-control-max-age\"><code>Access-Control-Max-Age</code></a>` and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⑧\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>max-age</var> is failure or null, then set <var>max-age</var> to 5. </p>"
            },
            {
              "html": "<p>If <var>max-age</var> is greater than an imposed limit on <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-max-age\" id=\"ref-for-concept-cache-max-age\">max-age</a>, then set <var>max-age</var> to the imposed limit. </p>"
            },
            {
              "html": "<p>If the user agent does not provide for a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache\" id=\"ref-for-concept-cache③\">cache</a>, then\n   return <var>response</var>. </p>"
            },
            {
              "html": "<p>For each <var>method</var> in <var>methods</var> for which there is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-match-method\" id=\"ref-for-concept-cache-match-method①\">method cache entry match</a> using <var>request</var>, set matching entry’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-max-age\" id=\"ref-for-concept-cache-max-age①\">max-age</a> to <var>max-age</var>. </p>"
            },
            {
              "html": "<p>For each <var>method</var> in <var>methods</var> for which there is no <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-match-method\" id=\"ref-for-concept-cache-match-method②\">method cache entry match</a> using <var>request</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-create-entry\" id=\"ref-for-concept-cache-create-entry\">create a new cache entry</a> with <var>request</var>, <var>max-age</var>, <var>method</var>, and null. </p>"
            },
            {
              "html": "<p>For each <var>headerName</var> in <var>headerNames</var> for which there is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-match-header\" id=\"ref-for-concept-cache-match-header①\">header-name cache entry match</a> using <var>request</var>, set matching entry’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-max-age\" id=\"ref-for-concept-cache-max-age②\">max-age</a> to <var>max-age</var>. </p>"
            },
            {
              "html": "<p>For each <var>headerName</var> in <var>headerNames</var> for which there is no <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-match-header\" id=\"ref-for-concept-cache-match-header②\">header-name cache entry match</a> using <var>request</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-create-entry\" id=\"ref-for-concept-cache-create-entry①\">create a new cache entry</a> with <var>request</var>, <var>max-age</var>, null, and <var>headerName</var>. </p>"
            },
            {
              "html": "<p>Return <var>response</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, return a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤⑦\">network error</a>. </p>"
        }
      ]
    },
    {
      "name": "create a new cache entry",
      "href": "https://fetch.spec.whatwg.org/#concept-cache-create-entry",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-cache-create-entry\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a new cache entry</dfn>, given <var>request</var>, <var>max-age</var>, <var>method</var>, and <var>headerName</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>entry</var> be a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cache-entry\" id=\"ref-for-cache-entry③\">cache entry</a>, initialized as follows: </p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-key\" id=\"ref-for-concept-cache-key\">key</a> \n       </dt><dd>\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-determine-the-network-partition-key\" id=\"ref-for-request-determine-the-network-partition-key②\">determining the network partition key</a> given <var>request</var> </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-origin\" id=\"ref-for-concept-cache-origin\">byte-serialized origin</a> \n       </dt><dd>\n        <p>The result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-serializing-a-request-origin\" id=\"ref-for-byte-serializing-a-request-origin②\">byte-serializing a request origin</a> with <var>request</var> </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-url\" id=\"ref-for-concept-cache-url\">URL</a> \n       </dt><dd>\n        <p><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③②\">current URL</a> </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-max-age\" id=\"ref-for-concept-cache-max-age④\">max-age</a> \n       </dt><dd>\n        <p><var>max-age</var> </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-credentials\" id=\"ref-for-concept-cache-credentials\">credentials</a> \n       </dt><dd>\n        <p>True if <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①⑥\">credentials mode</a> is\n   \"<code>include</code>\", and false otherwise </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-method\" id=\"ref-for-concept-cache-method\">method</a> \n       </dt><dd>\n        <p><var>method</var> </p>\n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache-header-name\" id=\"ref-for-concept-cache-header-name\">header name</a> \n       </dt><dd>\n        <p><var>headerName</var> </p>\n      </dd></dl>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①⓪\">Append</a> <var>entry</var> to the user agent’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-cache\" id=\"ref-for-concept-cache⑤\">CORS-preflight cache</a>. </p>"
        }
      ]
    },
    {
      "name": "CORS check",
      "href": "https://fetch.spec.whatwg.org/#concept-cors-check",
      "html": "To perform a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-cors-check\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CORS check</dfn> for a <var>request</var> and <var>response</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>origin</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get⑤\">getting</a> `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-allow-origin\" id=\"ref-for-http-access-control-allow-origin⑥\"><code>Access-Control-Allow-Origin</code></a>` from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list②⑨\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>origin</var> is null, then return failure. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①⑧\">credentials mode</a> is not \"<code>include</code>\"\n and <var>origin</var> is `<code>*</code>`, then return success. </p>"
        },
        {
          "html": "<p>If the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#byte-serializing-a-request-origin\" id=\"ref-for-byte-serializing-a-request-origin⑤\">byte-serializing a request origin</a> with <var>request</var> is not <var>origin</var>, then return failure. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode①⑨\">credentials mode</a> is not \"<code>include</code>\",\n then return success. </p>"
        },
        {
          "html": "<p>Let <var>credentials</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get⑥\">getting</a> `<a data-link-type=\"http-header\" href=\"https://fetch.spec.whatwg.org/#http-access-control-allow-credentials\" id=\"ref-for-http-access-control-allow-credentials④\"><code>Access-Control-Allow-Credentials</code></a>` from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③⓪\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>credentials</var> is `<code>true</code>`, then return success. </p>"
        },
        {
          "html": "<p>Return failure. </p>"
        }
      ]
    },
    {
      "name": "TAO check",
      "href": "https://fetch.spec.whatwg.org/#concept-tao-check",
      "html": "To perform a <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-tao-check\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">TAO check</dfn> for a <var>request</var> and <var>response</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②①\">Assert</a>: <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin①⑨\">origin</a> is not\n \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#timing-allow-failed\" id=\"ref-for-timing-allow-failed④\">timing allow failed flag</a> is set, then return\n failure. </p>"
        },
        {
          "html": "<p>Let <var>values</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split\" id=\"ref-for-concept-header-list-get-decode-split⑥\">getting, decoding, and splitting</a> `<code>Timing-Allow-Origin</code>` from <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③①\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>values</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> \"<code>*</code>\", then return success. </p>"
        },
        {
          "html": "<p>If <var>values</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#serializing-a-request-origin\" id=\"ref-for-serializing-a-request-origin①\">serializing a request origin</a> with <var>request</var>, then return success. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②③\">mode</a> is \"<code>navigate</code>\" and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③⑤\">current URL</a>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin①⑨\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin⑨\">same origin</a> with <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②⓪\">origin</a>, then return failure. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-response-tainting\" id=\"ref-for-concept-request-response-tainting①⑧\">response tainting</a> is \"<code>basic</code>\", then\n return success. </p>"
        },
        {
          "html": "<p>Return failure. </p>"
        }
      ]
    },
    {
      "name": "Headers/validate",
      "href": "https://fetch.spec.whatwg.org/#headers-validate",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"headers-validate\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤⑥\">header</a> (<var>name</var>, <var>value</var>) for\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers④\">Headers</a></code> object <var>headers</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name①⑨\">header name</a> or <var>value</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-value\" id=\"ref-for-header-value⑨\">header value</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard\">guard</a> is \"<code>immutable</code>\", then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①\">guard</a> is \"<code>request</code>\" and\n (<var>name</var>, <var>value</var>) is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#forbidden-request-header\" id=\"ref-for-forbidden-request-header①\">forbidden request-header</a>, then return false. </p>"
        },
        {
          "html": "<p>If <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard②\">guard</a> is \"<code>response</code>\" and <var>name</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#forbidden-response-header-name\" id=\"ref-for-forbidden-response-header-name②\">forbidden response-header name</a>, then return false. </p>"
        },
        {
          "html": "<p>Return true. </p>"
        }
      ]
    },
    {
      "name": "Headers/append",
      "href": "https://fetch.spec.whatwg.org/#concept-headers-append",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-headers-append\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">append</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤⑦\">header</a> (<var>name</var>, <var>value</var>) to a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers⑤\">Headers</a></code> object <var>headers</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value-normalize\" id=\"ref-for-concept-header-value-normalize\">Normalize</a> <var>value</var>. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#headers-validate\" id=\"ref-for-headers-validate\">validating</a> (<var>name</var>, <var>value</var>) for <var>headers</var> returns false, then return. </p>"
        },
        {
          "html": "If <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard③\">guard</a> is \"<code>request-no-cors</code>\":",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>temporaryValue</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get⑦\">getting</a> <var>name</var> from <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>temporaryValue</var> is null, then set <var>temporaryValue</var> to <var>value</var>. </p>"
            },
            {
              "html": "<p>Otherwise, set <var>temporaryValue</var> to <var>temporaryValue</var>, followed by\n   0x2C 0x20, followed by <var>value</var>. </p>"
            },
            {
              "html": "<p>If (<var>name</var>, <var>temporaryValue</var>) is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cors-safelisted-request-header\" id=\"ref-for-no-cors-safelisted-request-header\">no-CORS-safelisted request-header</a>, then return. </p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append②①\">Append</a> (<var>name</var>, <var>value</var>) to <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①\">header list</a>. </p>"
        },
        {
          "html": "<p>If <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard④\">guard</a> is \"<code>request-no-cors</code>\", then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-remove-privileged-no-cors-request-headers\" id=\"ref-for-concept-headers-remove-privileged-no-cors-request-headers\">remove privileged no-CORS request-headers</a> from <var>headers</var>. </p>"
        }
      ]
    },
    {
      "name": "Headers/fill",
      "href": "https://fetch.spec.whatwg.org/#concept-headers-fill",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-headers-fill\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fill</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers⑥\">Headers</a></code> object <var>headers</var> with a given object <var>object</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <var>object</var> is a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence③\">sequence</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①④\">for each</a> <var>header</var> of <var>object</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>header</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> is not 2, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror④\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-append\" id=\"ref-for-concept-headers-append\">Append</a> (<var>header</var>[0], <var>header</var>[1]) to <var>headers</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, <var>object</var> is a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#sec-list-and-record-specification-type\" id=\"ref-for-sec-list-and-record-specification-type②\">record</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">for each</a> <var>key</var> → <var>value</var> of <var>object</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-append\" id=\"ref-for-concept-headers-append①\">append</a> (<var>key</var>, <var>value</var>) to <var>headers</var>. </p>"
        }
      ]
    },
    {
      "name": "Headers/remove privileged no-CORS request-headers",
      "href": "https://fetch.spec.whatwg.org/#concept-headers-remove-privileged-no-cors-request-headers",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-headers-remove-privileged-no-cors-request-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">remove privileged no-CORS request-headers</dfn> from a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers⑦\">Headers</a></code> object (<var>headers</var>), run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑤\">For each</a> <var>headerName</var> of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#privileged-no-cors-request-header-name\" id=\"ref-for-privileged-no-cors-request-header-name\">privileged no-CORS request-header names</a>:",
          "rationale": "delete",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete②\">Delete</a> <var>headerName</var> from <var>headers</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list②\">header list</a>. </p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Headers/Headers(init)",
      "href": "https://fetch.spec.whatwg.org/#dom-headers",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"Headers(init)|constructor(init)|Headers()|constructor()\" id=\"dom-headers\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>new Headers(<var>init</var>)</code></dfn> constructor steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard⑤\">guard</a> to \"<code>none</code>\". </p>"
        },
        {
          "html": "<p>If <var>init</var> is given, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-fill\" id=\"ref-for-concept-headers-fill\">fill</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a> with <var>init</var>. </p>"
        }
      ]
    },
    {
      "name": "Headers/delete(name)",
      "href": "https://fetch.spec.whatwg.org/#dom-headers-delete",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-headers-delete\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>delete(<var>name</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#headers-validate\" id=\"ref-for-headers-validate①\">validating</a> (<var>name</var>, ``) for <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a> returns false, then\n  return. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard⑥\">guard</a> is \"<code>request-no-cors</code>\", <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cors-safelisted-request-header-name\" id=\"ref-for-no-cors-safelisted-request-header-name①\">no-CORS-safelisted request-header name</a>, and <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#privileged-no-cors-request-header-name\" id=\"ref-for-privileged-no-cors-request-header-name①\">privileged no-CORS request-header name</a>, then return. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list③\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②③\">does not contain</a> <var>name</var>, then return. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-delete\" id=\"ref-for-concept-header-list-delete③\">Delete</a> <var>name</var> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list④\">header list</a>. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard⑦\">guard</a> is \"<code>request-no-cors</code>\", then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-remove-privileged-no-cors-request-headers\" id=\"ref-for-concept-headers-remove-privileged-no-cors-request-headers①\">remove privileged no-CORS request-headers</a> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>. </p>"
        }
      ]
    },
    {
      "name": "Headers/get(name)",
      "href": "https://fetch.spec.whatwg.org/#dom-headers-get",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-headers-get\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>get(<var>name</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name②⓪\">header name</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑤\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-get\" id=\"ref-for-concept-header-list-get⑧\">getting</a> <var>name</var> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list⑤\">header list</a>. </p>"
        }
      ]
    },
    {
      "name": "Headers/getSetCookie()",
      "href": "https://fetch.spec.whatwg.org/#dom-headers-getsetcookie",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-headers-getsetcookie\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>getSetCookie()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list⑥\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②④\">does not contain</a> `<code>Set-Cookie</code>`, then return « ». </p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value\" id=\"ref-for-concept-header-value②①\">values</a> of all <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header\" id=\"ref-for-concept-header⑤⑧\">headers</a> in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list⑦\">header list</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-name\" id=\"ref-for-concept-header-name②③\">name</a> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-case-insensitive\" id=\"ref-for-byte-case-insensitive①⑧\">byte-case-insensitive</a> match\n for `<code>Set-Cookie</code>`, in order. </p>"
        }
      ]
    },
    {
      "name": "Headers/has(name)",
      "href": "https://fetch.spec.whatwg.org/#dom-headers-has",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-headers-has\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>has(<var>name</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>name</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-name\" id=\"ref-for-header-name②①\">header name</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑥\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Return true if <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list⑧\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②⑤\">contains</a> <var>name</var>; otherwise false. </p>"
        }
      ]
    },
    {
      "name": "Headers/set(name, value)",
      "href": "https://fetch.spec.whatwg.org/#dom-headers-set",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Headers\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-headers-set\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>set(<var>name</var>, <var>value</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-value-normalize\" id=\"ref-for-concept-header-value-normalize①\">Normalize</a> <var>value</var>. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#headers-validate\" id=\"ref-for-headers-validate②\">validating</a> (<var>name</var>, <var>value</var>) for <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a> returns\n false, then return. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard⑧\">guard</a> is \"<code>request-no-cors</code>\" and\n (<var>name</var>, <var>value</var>) is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#no-cors-safelisted-request-header\" id=\"ref-for-no-cors-safelisted-request-header①\">no-CORS-safelisted request-header</a>, then return. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-set\" id=\"ref-for-concept-header-list-set①\">Set</a> (<var>name</var>, <var>value</var>) in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list⑨\">header list</a>. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard⑨\">guard</a> is \"<code>request-no-cors</code>\", then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-remove-privileged-no-cors-request-headers\" id=\"ref-for-concept-headers-remove-privileged-no-cors-request-headers②\">remove privileged no-CORS request-headers</a> from <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>. </p>"
        }
      ]
    },
    {
      "name": "BodyInit/safely extract",
      "href": "https://fetch.spec.whatwg.org/#bodyinit-safely-extract",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BodyInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"bodyinit-safely-extract\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">safely extract</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type\" id=\"ref-for-body-with-type\">body with type</a> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence①⑨\">byte sequence</a> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#bodyinit\" id=\"ref-for-bodyinit\">BodyInit</a></code> object <var>object</var>, run these steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream⑤\">ReadableStream</a></code> object, then:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②②\">Assert</a>: <var>object</var> is neither <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#is-readable-stream-disturbed\" id=\"ref-for-is-readable-stream-disturbed\">disturbed</a> nor <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-locked\" id=\"ref-for-readablestream-locked\">locked</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-bodyinit-extract\" id=\"ref-for-concept-bodyinit-extract\">extracting</a> <var>object</var>. </p>"
        }
      ]
    },
    {
      "name": "BodyInit/extract",
      "href": "https://fetch.spec.whatwg.org/#concept-bodyinit-extract",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BodyInit\" data-dfn-type=\"dfn\" data-export=\"\" id=\"concept-bodyinit-extract\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">extract</dfn> a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type\" id=\"ref-for-body-with-type①\">body with type</a> from a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②⓪\">byte sequence</a> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#bodyinit\" id=\"ref-for-bodyinit①\">BodyInit</a></code> object <var>object</var>, with an optional boolean <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"BodyInit/extract\" data-dfn-type=\"dfn\" data-export=\"\" id=\"keepalive\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><var>keepalive</var></dfn> (default false), run these\nsteps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>stream</var> be null. </p>"
        },
        {
          "html": "<p>If <var>object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream⑥\">ReadableStream</a></code> object, then set <var>stream</var> to <var>object</var>. </p>"
        },
        {
          "html": "<p>Otherwise, if <var>object</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob④\">Blob</a></code> object, set <var>stream</var> to the result of\n running <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-get-stream\" id=\"ref-for-blob-get-stream\">get stream</a>. </p>"
        },
        {
          "html": "<p>Otherwise, set <var>stream</var> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream⑦\">ReadableStream</a></code> object, and <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support\" id=\"ref-for-readablestream-set-up-with-byte-reading-support①\">set up</a> <var>stream</var> with byte reading\n support. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②③\">Assert</a>: <var>stream</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream⑧\">ReadableStream</a></code> object. </p>"
        },
        {
          "html": "<p>Let <var>action</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>source</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>length</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>type</var> be null. </p>"
        },
        {
          "html": "Switch on <var>object</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "Blob",
                  "html": "<p>Set <var>source</var> to <var>object</var>. </p>\n       <p>Set <var>length</var> to <var>object</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-size\" id=\"ref-for-dfn-size②\">size</a></code>. </p>\n       <p>If <var>object</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-type\" id=\"ref-for-dfn-type①\">type</a></code> attribute is not the empty byte sequence, set <var>type</var> to its value. </p>"
                },
                {
                  "case": "byte sequence",
                  "html": "<p>Set <var>source</var> to <var>object</var>. </p>"
                },
                {
                  "case": "BufferSource",
                  "html": "<p>Set <var>source</var> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\" id=\"ref-for-dfn-get-buffer-source-copy①\">copy of the bytes</a> held by <var>object</var>. </p>"
                },
                {
                  "case": "FormData",
                  "html": "<p>Set <var>action</var> to this step: run the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#multipart%2Fform-data-encoding-algorithm\" id=\"ref-for-multipart%2Fform-data-encoding-algorithm\"><code>multipart/form-data</code> encoding algorithm</a>, with <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://xhr.spec.whatwg.org/#concept-formdata-entry-list\" id=\"ref-for-concept-formdata-entry-list\">entry list</a> and <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8\" id=\"ref-for-utf-8①\">UTF-8</a>. </p>\n       <p>Set <var>source</var> to <var>object</var>. </p>\n       <p>Set <var>length</var> to <span class=\"XXX\">unclear, see <a href=\"https://github.com/whatwg/html/issues/6424\">html/6424</a> for improving this</span>. </p>\n       <p>Set <var>type</var> to `<code>multipart/form-data; boundary=</code>`, followed by the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#multipart%2Fform-data-boundary-string\" id=\"ref-for-multipart%2Fform-data-boundary-string\"><code>multipart/form-data</code> boundary string</a> generated by the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#multipart%2Fform-data-encoding-algorithm\" id=\"ref-for-multipart%2Fform-data-encoding-algorithm①\"><code>multipart/form-data</code> encoding algorithm</a>. </p>"
                },
                {
                  "case": "URLSearchParams",
                  "html": "<p>Set <var>source</var> to the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlencoded-serializer\" id=\"ref-for-concept-urlencoded-serializer\"><code>application/x-www-form-urlencoded</code> serializer</a> with <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlsearchparams-list\" id=\"ref-for-concept-urlsearchparams-list\">list</a>. </p>\n       <p>Set <var>type</var> to\n    `<code>application/x-www-form-urlencoded;charset=UTF-8</code>`. </p>"
                },
                {
                  "case": "scalar value string",
                  "html": "<p>Set <var>source</var> to the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">UTF-8 encoding</a> of <var>object</var>. </p>\n       <p>Set <var>type</var> to `<code>text/plain;charset=UTF-8</code>`. </p>"
                },
                {
                  "case": "ReadableStream",
                  "html": "<p>If <var>keepalive</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑦\">TypeError</a></code>. </p>\n       <p>If <var>object</var> is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#is-readable-stream-disturbed\" id=\"ref-for-is-readable-stream-disturbed①\">disturbed</a> or <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-locked\" id=\"ref-for-readablestream-locked①\">locked</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑧\">TypeError</a></code>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>source</var> is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②②\">byte sequence</a>, then set <var>action</var> to a step\n that returns <var>source</var> and <var>length</var> to <var>source</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence-length\" id=\"ref-for-byte-sequence-length⑤\">length</a>. </p>"
        },
        {
          "html": "If <var>action</var> is non-null, then run these steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>:",
          "rationale": "run",
          "steps": [
            {
              "html": "<p>Run <var>action</var>. </p>\n       <p>Whenever one or more bytes are available and <var>stream</var> is not <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-errored\" id=\"ref-for-readablestream-errored①\">errored</a>, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue③\">enqueue</a> the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#arraybufferview-create\" id=\"ref-for-arraybufferview-create\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\" id=\"ref-for-idl-Uint8Array②\">Uint8Array</a></code> from the available bytes into <var>stream</var>. </p>\n       <p>When running <var>action</var> is done, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\" id=\"ref-for-readablestream-close①\">close</a> <var>stream</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>body</var> be a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body\" id=\"ref-for-concept-body①②\">body</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-stream\" id=\"ref-for-concept-body-stream①④\">stream</a> is <var>stream</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source①③\">source</a> is <var>source</var>, and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-total-bytes\" id=\"ref-for-concept-body-total-bytes③\">length</a> is <var>length</var>. </p>"
        },
        {
          "html": "<p>Return (<var>body</var>, <var>type</var>). </p>"
        }
      ]
    },
    {
      "name": "Body/get the MIME type",
      "href": "https://fetch.spec.whatwg.org/#concept-body-mime-type",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Body\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-body-mime-type\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get the MIME type</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①\">Request</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response①\">Response</a></code> object <var>requestOrResponse</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>headers</var> be null. </p>"
        },
        {
          "html": "<p>If <var>requestOrResponse</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request②\">Request</a></code> object, then set <var>headers</var> to <var>requestOrResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⑤\">header list</a>. </p>"
        },
        {
          "html": "<p>Otherwise, set <var>headers</var> to <var>requestOrResponse</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③②\">header list</a>. </p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-extract-mime-type\" id=\"ref-for-concept-header-extract-mime-type⑧\">extracting a MIME type</a> from <var>headers</var>. </p>"
        },
        {
          "html": "<p>If <var>mimeType</var> is failure, then return null. </p>"
        },
        {
          "html": "<p>Return <var>mimeType</var>. </p>"
        }
      ]
    },
    {
      "name": "Body/consume body",
      "href": "https://fetch.spec.whatwg.org/#concept-body-consume-body",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Body\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"concept-body-consume-body\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">consume body</dfn> algorithm, given an object that includes <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#body\" id=\"ref-for-body②\">Body</a></code> <var>object</var> and an algorithm that takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②③\">byte sequence</a> and returns a JavaScript value or throws an exception <var>convertBytesToJSValue</var>, runs these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>object</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-unusable\" id=\"ref-for-body-unusable\">unusable</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror⑨\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a>. </p>"
        },
        {
          "html": "Let <var>errorSteps</var> given <var>error</var> be to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with <var>error</var>."
        },
        {
          "html": "Let <var>successSteps</var> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②④\">byte sequence</a> <var>data</var> be to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">resolve</a> <var>promise</var> with the result of running <var>convertBytesToJSValue</var> with <var>data</var>. If that threw an exception, then run <var>errorSteps</var> with that\n exception."
        },
        {
          "html": "<p>If <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-body\" id=\"ref-for-concept-body-body⑥\">body</a> is null, then run <var>successSteps</var> with an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②⑤\">byte sequence</a>. </p>"
        },
        {
          "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-fully-read\" id=\"ref-for-body-fully-read②\">fully read</a> <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-body\" id=\"ref-for-concept-body-body⑦\">body</a> given <var>successSteps</var>, <var>errorSteps</var>, and <var>object</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>. </p>"
        },
        {
          "html": "<p>Return <var>promise</var>. </p>"
        }
      ]
    },
    {
      "name": "Body/formData()",
      "href": "https://fetch.spec.whatwg.org/#dom-body-formdata",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Body\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-body-formdata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>formData()</code></dfn> method steps are to return the result of\nrunning <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-consume-body\" id=\"ref-for-concept-body-consume-body③\">consume body</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a> and the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\" id=\"ref-for-byte-sequence②⑨\">byte sequence</a> <var>bytes</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-mime-type\" id=\"ref-for-concept-body-mime-type①\">get the MIME type</a> with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a>. </p>"
        },
        {
          "html": "If <var>mimeType</var> is non-null, then switch on <var>mimeType</var>’s <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence⑧\">essence</a> and run the corresponding steps:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "\"multipart/form-data\"",
                  "html": "<p class=\"XXX\">The above is a rough approximation of what is needed for\n    `<code>multipart/form-data</code>`, a more detailed parsing specification is to be written.\n    Volunteers welcome. </p>",
                  "rationale": "parse",
                  "steps": [
                    {
                      "html": "<p>Parse <var>bytes</var>, using the value of the `<code>boundary</code>` parameter from <var>mimeType</var>, per the rules set forth in <cite>Returning Values from Forms: multipart/form-data</cite>. <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-rfc7578\" title=\"Returning Values from Forms: multipart/form-data\">[RFC7578]</a> </p>\n          <p>Each part whose `<code>Content-Disposition</code>` header contains a\n      `<code>filename</code>` parameter must be parsed into an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#form-entry\" id=\"ref-for-form-entry\">entry</a> whose\n      value is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-file\" id=\"ref-for-dfn-file\">File</a></code> object whose contents are the contents of the part. The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-name\" id=\"ref-for-dfn-name\">name</a></code> attribute of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-file\" id=\"ref-for-dfn-file①\">File</a></code> object must have the value of the `<code>filename</code>` parameter\n      of the part. The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-type\" id=\"ref-for-dfn-type③\">type</a></code> attribute of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/FileAPI/#dfn-file\" id=\"ref-for-dfn-file②\">File</a></code> object must have the value of the\n      `<code>Content-Type</code>` header of the part if the part has such header, and\n      `<code>text/plain</code>` (the default defined by <a data-link-type=\"biblio\" href=\"https://fetch.spec.whatwg.org/#biblio-rfc7578\" title=\"Returning Values from Forms: multipart/form-data\">[RFC7578]</a> section 4.4) otherwise. </p>\n          <p>Each part whose `<code>Content-Disposition</code>` header does not contain a\n      `<code>filename</code>` parameter must be parsed into an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#form-entry\" id=\"ref-for-form-entry①\">entry</a> whose\n      value is the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode-without-bom\" id=\"ref-for-utf-8-decode-without-bom\">UTF-8 decoded without BOM</a> content of the\n      part.  </p>"
                    },
                    {
                      "html": "<p>If that fails for some reason, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑦\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⓪\">TypeError</a></code>. </p>"
                    },
                    {
                      "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#formdata\" id=\"ref-for-formdata⑤\">FormData</a></code> object, appending each <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#form-entry\" id=\"ref-for-form-entry②\">entry</a>,\n     resulting from the parsing operation, to its <a data-link-type=\"dfn\" href=\"https://xhr.spec.whatwg.org/#concept-formdata-entry-list\" id=\"ref-for-concept-formdata-entry-list①\">entry list</a>. </p>"
                    }
                  ]
                },
                {
                  "case": "\"application/x-www-form-urlencoded\"",
                  "html": "",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>entries</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-urlencoded-parser\" id=\"ref-for-concept-urlencoded-parser\">parsing</a> <var>bytes</var>. </p>"
                    },
                    {
                      "html": "<p>If <var>entries</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①①\">TypeError</a></code>. </p>"
                    },
                    {
                      "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#formdata\" id=\"ref-for-formdata⑥\">FormData</a></code> object whose <a data-link-type=\"dfn\" href=\"https://xhr.spec.whatwg.org/#concept-formdata-entry-list\" id=\"ref-for-concept-formdata-entry-list②\">entry list</a> is <var>entries</var>. </p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw⑨\">Throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①②\">TypeError</a></code>. </p>"
        }
      ]
    },
    {
      "name": "Request/create",
      "href": "https://fetch.spec.whatwg.org/#request-create",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Request\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create|creating\" id=\"request-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①①\">Request</a></code> object, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①①③\">request</a> <var>request</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#headers-guard\" id=\"ref-for-headers-guard①\">headers guard</a> <var>guard</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal⑤\">AbortSignal</a></code> object <var>signal</var>, and <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm②\">realm</a> <var>realm</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>requestObject</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①②\">Request</a></code> object with <var>realm</var>. </p>"
        },
        {
          "html": "<p>Set <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request②\">request</a> to <var>request</var>. </p>"
        },
        {
          "html": "<p>Set <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers\">headers</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new③\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers①②\">Headers</a></code> object with <var>realm</var>, whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①①\">headers list</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⑥\">headers list</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①⓪\">guard</a> is <var>guard</var>. </p>"
        },
        {
          "html": "<p>Set <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal\">signal</a> to <var>signal</var>. </p>"
        },
        {
          "html": "<p>Return <var>requestObject</var>. </p>"
        }
      ]
    },
    {
      "name": "Request/Request(input, init)",
      "href": "https://fetch.spec.whatwg.org/#dom-request",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Request\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"Request(input, init)|constructor(input, init)|Request(input)|constructor(input)\" id=\"dom-request\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>new Request(<var>input</var>, <var>init</var>)</code></dfn> constructor steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>request</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>fallbackMode</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>baseURL</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url\" id=\"ref-for-api-base-url\">API base URL</a>. </p>"
        },
        {
          "html": "<p>Let <var>signal</var> be null. </p>"
        },
        {
          "html": "If <var>input</var> is a string, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser①\">parsing</a> <var>input</var> with <var>baseURL</var>. </p>"
            },
            {
              "html": "<p>If <var>parsedURL</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①③\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>If <var>parsedURL</var> <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#include-credentials\" id=\"ref-for-include-credentials④\">includes credentials</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①④\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>Set <var>request</var> to a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①①④\">request</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑥\">URL</a> is <var>parsedURL</var>. </p>"
            },
            {
              "html": "<p>Set <var>fallbackMode</var> to \"<code>cors</code>\". </p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②④\">Assert</a>: <var>input</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①③\">Request</a></code> object. </p>"
            },
            {
              "html": "<p>Set <var>request</var> to <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request③\">request</a>. </p>"
            },
            {
              "html": "<p>Set <var>signal</var> to <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal①\">signal</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>origin</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object①\">relevant settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin②\">origin</a>. </p>"
        },
        {
          "html": "<p>Let <var>window</var> be \"<code>client</code>\". </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①②\">window</a> is\n an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object\" id=\"ref-for-environment-settings-object①③\">environment settings object</a> and its <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin\" id=\"ref-for-concept-settings-object-origin③\">origin</a> is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①⓪\">same origin</a> with <var>origin</var>, then set <var>window</var> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①③\">window</a>. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-window\" id=\"ref-for-dom-requestinit-window①\">window</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a> and is non-null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑤\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-window\" id=\"ref-for-dom-requestinit-window②\">window</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>, then set <var>window</var> to \"<code>no-window</code>\". </p>"
        },
        {
          "html": "<p>Set <var>request</var> to a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\" id=\"ref-for-concept-request①①⑤\">request</a> with the following properties: </p>\n      <dl>\n       <dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑦\">URL</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑧\">URL</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②⓪\">method</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②①\">method</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⑦\">header list</a> \n       </dt><dd>A copy of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⑧\">header list</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#unsafe-request-flag\" id=\"ref-for-unsafe-request-flag③\">unsafe-request flag</a> \n       </dt><dd>Set. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②⑤\">client</a> \n       </dt><dd><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑤\">This</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object\" id=\"ref-for-relevant-settings-object②\">relevant settings object</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-window\" id=\"ref-for-concept-request-window①④\">window</a> \n       </dt><dd><var>window</var>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority②\">internal priority</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority③\">internal priority</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②②\">origin</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②③\">origin</a>.  \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer⑨\">referrer</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①⓪\">referrer</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy⑥\">referrer policy</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy⑦\">referrer policy</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⑤\">mode</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⑥\">mode</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode②①\">credentials mode</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode②②\">credentials mode</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①②\">cache mode</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①③\">cache mode</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode⑨\">redirect mode</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode①⓪\">redirect mode</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata③\">integrity metadata</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata④\">integrity metadata</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag③\">keepalive</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag④\">keepalive</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reload-navigation-flag\" id=\"ref-for-concept-request-reload-navigation-flag\">reload-navigation flag</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reload-navigation-flag\" id=\"ref-for-concept-request-reload-navigation-flag①\">reload-navigation flag</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-history-navigation-flag\" id=\"ref-for-concept-request-history-navigation-flag\">history-navigation flag</a> \n       </dt><dd><var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-history-navigation-flag\" id=\"ref-for-concept-request-history-navigation-flag①\">history-navigation flag</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list⑨\">URL list</a> \n       </dt><dd>A <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-clone\" id=\"ref-for-list-clone③\">clone</a> of <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list①⓪\">URL list</a>. \n       </dd><dt><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-initiator-type\" id=\"ref-for-request-initiator-type③\">initiator type</a> \n       </dt><dd>\"<code>fetch</code>\". \n      </dd></dl>"
        },
        {
          "html": "If <var>init</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty\">is not empty</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⑦\">mode</a> is\n   \"<code>navigate</code>\", then set it to \"<code>same-origin</code>\". </p>"
            },
            {
              "html": "<p>Unset <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-reload-navigation-flag\" id=\"ref-for-concept-request-reload-navigation-flag②\">reload-navigation flag</a>. </p>"
            },
            {
              "html": "<p>Unset <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-history-navigation-flag\" id=\"ref-for-concept-request-history-navigation-flag②\">history-navigation flag</a>. </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-origin\" id=\"ref-for-concept-request-origin②④\">origin</a> to \"<code>client</code>\". </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①①\">referrer</a> to \"<code>client</code>\". </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy⑧\">referrer policy</a> to the empty string. </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url⑨\">URL</a> to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-current-url\" id=\"ref-for-concept-request-current-url③⑥\">current URL</a>. </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url-list\" id=\"ref-for-concept-request-url-list①①\">URL list</a> to « <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-url\" id=\"ref-for-concept-request-url①⓪\">URL</a> ». </p>"
            }
          ]
        },
        {
          "html": "If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-referrer\" id=\"ref-for-dom-requestinit-referrer①\">referrer</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>referrer</var> be <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-referrer\" id=\"ref-for-dom-requestinit-referrer②\">referrer</a></code>\"]. </p>"
            },
            {
              "html": "<p>If <var>referrer</var> is the empty string, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①②\">referrer</a> to \"<code>no-referrer</code>\". </p>"
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>parsedReferrer</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser②\">parsing</a> <var>referrer</var> with <var>baseURL</var>. </p>"
                },
                {
                  "html": "<p>If <var>parsedReferrer</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑥\">TypeError</a></code>. </p>"
                },
                {
                  "html": "<p>If one of the following is true </p>\n          <ul class=\"brief\">\n           <li>\n            <p><var>parsedReferrer</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①⑤\">scheme</a> is \"<code>about</code>\" and <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-path\" id=\"ref-for-concept-url-path②\">path</a> is the string \"<code>client</code>\" </p>\n           </li><li>\n            <p><var>parsedReferrer</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-origin\" id=\"ref-for-concept-url-origin②⓪\">origin</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#same-origin\" id=\"ref-for-same-origin①①\">same origin</a> with <var>origin</var> </p>\n          </li></ul>\n          <p>then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①③\">referrer</a> to \"<code>client</code>\". </p>"
                },
                {
                  "html": "<p>Otherwise, set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①④\">referrer</a> to <var>parsedReferrer</var>. </p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-referrerpolicy\" id=\"ref-for-dom-requestinit-referrerpolicy①\">referrerPolicy</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer-policy\" id=\"ref-for-concept-request-referrer-policy⑨\">referrer policy</a> to it. </p>"
        },
        {
          "html": "<p>Let <var>mode</var> be <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-mode\" id=\"ref-for-dom-requestinit-mode①\">mode</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>,\n and <var>fallbackMode</var> otherwise. </p>"
        },
        {
          "html": "<p>If <var>mode</var> is \"<code>navigate</code>\", then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑦\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>mode</var> is non-null, set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⑧\">mode</a> to <var>mode</var>. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-credentials\" id=\"ref-for-dom-requestinit-credentials①\">credentials</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-credentials-mode\" id=\"ref-for-concept-request-credentials-mode②③\">credentials mode</a> to it. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-cache\" id=\"ref-for-dom-requestinit-cache①\">cache</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①④\">cache mode</a> to it. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-cache-mode\" id=\"ref-for-concept-request-cache-mode①⑤\">cache mode</a> is \"<code>only-if-cached</code>\" and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode②⑨\">mode</a> is <em>not</em> \"<code>same-origin</code>\", then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑧\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-redirect\" id=\"ref-for-dom-requestinit-redirect①\">redirect</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-redirect-mode\" id=\"ref-for-concept-request-redirect-mode①①\">redirect mode</a> to it. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-integrity\" id=\"ref-for-dom-requestinit-integrity①\">integrity</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-integrity-metadata\" id=\"ref-for-concept-request-integrity-metadata⑤\">integrity metadata</a> to it. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-keepalive\" id=\"ref-for-dom-requestinit-keepalive①\">keepalive</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exists</a>, then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag⑤\">keepalive</a> to it. </p>"
        },
        {
          "html": "If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-method\" id=\"ref-for-dom-requestinit-method①\">method</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>method</var> be <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-method\" id=\"ref-for-dom-requestinit-method②\">method</a></code>\"]. </p>"
            },
            {
              "html": "<p>If <var>method</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-method\" id=\"ref-for-concept-method①②\">method</a> or <var>method</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#forbidden-method\" id=\"ref-for-forbidden-method②\">forbidden method</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①⑨\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-method-normalize\" id=\"ref-for-concept-method-normalize②\">Normalize</a> <var>method</var>. </p>"
            },
            {
              "html": "<p>Set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②②\">method</a> to <var>method</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-signal\" id=\"ref-for-dom-requestinit-signal①\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exists</a>, then set <var>signal</var> to it. </p>"
        },
        {
          "html": "If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-priority\" id=\"ref-for-dom-requestinit-priority①\">priority</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a>, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority④\">internal priority</a> is not null, then update <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-internal-priority\" id=\"ref-for-request-internal-priority⑤\">internal priority</a> in an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①⑨\">implementation-defined</a> manner. </p>"
            },
            {
              "html": "<p>Otherwise, set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-priority\" id=\"ref-for-request-priority②\">priority</a> to <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-priority\" id=\"ref-for-dom-requestinit-priority②\">priority</a></code>\"]. </p>"
            }
          ]
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request④\">request</a> to <var>request</var>. </p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>signal</var> » if <var>signal</var> is non-null; otherwise\n « ». </p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal②\">signal</a> to the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal\">creating a dependent abort signal</a> from <var>signals</var>, using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal⑥\">AbortSignal</a></code> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a>. </p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers①\">headers</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers①③\">Headers</a></code> object with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a>, whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①②\">header list</a> is <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-header-list\" id=\"ref-for-concept-request-header-list④⑨\">header list</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①①\">guard</a> is \"<code>request</code>\". </p>"
        },
        {
          "html": "If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request⑤\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode③⓪\">mode</a> is\n  \"<code>no-cors</code>\", then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request⑥\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②③\">method</a> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#cors-safelisted-method\" id=\"ref-for-cors-safelisted-method④\">CORS-safelisted method</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑦\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⓪\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers②\">headers</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①②\">guard</a> to\n   \"<code>request-no-cors</code>\". </p>"
            }
          ]
        },
        {
          "html": "If <var>init</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-is-empty\" id=\"ref-for-map-is-empty①\">is not empty</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>headers</var> be a copy of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers③\">headers</a> and its\n   associated <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①③\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-headers\" id=\"ref-for-dom-requestinit-headers①\">headers</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑥\">exists</a>, then set <var>headers</var> to <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-headers\" id=\"ref-for-dom-requestinit-headers②\">headers</a></code>\"]. </p>"
            },
            {
              "html": "<p>Empty <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers④\">headers</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①④\">header list</a>. </p>"
            },
            {
              "html": "<p>If <var>headers</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers①④\">Headers</a></code> object, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑥\">for each</a> <var>header</var> of its <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①⑤\">header list</a>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-append\" id=\"ref-for-concept-headers-append③\">append</a> <var>header</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers⑤\">headers</a>. </p>"
            },
            {
              "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-fill\" id=\"ref-for-concept-headers-fill①\">fill</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers⑥\">headers</a> with <var>headers</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>inputBody</var> be <var>input</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request⑦\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④⑥\">body</a> if <var>input</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①④\">Request</a></code> object; otherwise null. </p>"
        },
        {
          "html": "<p>If either <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-body\" id=\"ref-for-dom-requestinit-body②\">body</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑦\">exists</a> and is non-null or <var>inputBody</var> is non-null, and <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-method\" id=\"ref-for-concept-request-method②④\">method</a> is\n `<code>GET</code>` or `<code>HEAD</code>`, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑧\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②①\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>initBody</var> be null. </p>"
        },
        {
          "html": "If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-body\" id=\"ref-for-dom-requestinit-body③\">body</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑧\">exists</a> and is non-null, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>bodyWithType</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-bodyinit-extract\" id=\"ref-for-concept-bodyinit-extract②\">extracting</a> <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-body\" id=\"ref-for-dom-requestinit-body④\">body</a></code>\"], with <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#keepalive\" id=\"ref-for-keepalive\"><i>keepalive</i></a> set to <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-keepalive-flag\" id=\"ref-for-request-keepalive-flag⑥\">keepalive</a>. </p>"
            },
            {
              "html": "<p>Set <var>initBody</var> to <var>bodyWithType</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body⑤\">body</a>. </p>"
            },
            {
              "html": "<p>Let <var>type</var> be <var>bodyWithType</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-type\" id=\"ref-for-body-with-type-type\">type</a>. </p>"
            },
            {
              "html": "<p>If <var>type</var> is non-null and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers⑦\">headers</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①⑥\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②⑥\">does not contain</a> `<code>Content-Type</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-append\" id=\"ref-for-concept-headers-append④\">append</a> (`<code>Content-Type</code>`, <var>type</var>) to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers⑧\">headers</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>inputOrInitBody</var> be <var>initBody</var> if it is non-null; otherwise <var>inputBody</var>. </p>"
        },
        {
          "html": "If <var>inputOrInitBody</var> is non-null and <var>inputOrInitBody</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-body-source\" id=\"ref-for-concept-body-source①④\">source</a> is null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>initBody</var> is non-null and <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-requestinit-duplex\" id=\"ref-for-dom-requestinit-duplex①\">duplex</a></code>\"] does\n   not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑨\">exist</a>, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②②\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request⑧\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-mode\" id=\"ref-for-concept-request-mode③①\">mode</a> is neither\n   \"<code>same-origin</code>\" nor \"<code>cors</code>\", then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②③\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request⑨\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#use-cors-preflight-flag\" id=\"ref-for-use-cors-preflight-flag⑥\">use-CORS-preflight flag</a>. </p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>finalBody</var> be <var>inputOrInitBody</var>. </p>"
        },
        {
          "html": "If <var>initBody</var> is null and <var>inputBody</var> is non-null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>input</var> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-unusable\" id=\"ref-for-body-unusable①\">unusable</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw①⑨\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②④\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>Set <var>finalBody</var> to the result of <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-create-a-proxy\" id=\"ref-for-readablestream-create-a-proxy\">creating a proxy</a> for <var>inputBody</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request①⓪\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④⑦\">body</a> to <var>finalBody</var>. </p>"
        }
      ]
    },
    {
      "name": "Request/referrer",
      "href": "https://fetch.spec.whatwg.org/#dom-request-referrer",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Request\" data-dfn-type=\"attribute\" data-export=\"\" id=\"dom-request-referrer\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>referrer</code></dfn> getter steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request①④\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①⑤\">referrer</a> is\n \"<code>no-referrer</code>\", then return the empty string. </p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request①⑤\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①⑥\">referrer</a> is\n \"<code>client</code>\", then return \"<code>about:client</code>\". </p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request①⑥\">request</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-referrer\" id=\"ref-for-concept-request-referrer①⑦\">referrer</a>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer③\">serialized</a>. </p>"
        }
      ]
    },
    {
      "name": "Request/clone()",
      "href": "https://fetch.spec.whatwg.org/#dom-request-clone",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Request\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-request-clone\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>clone()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⓪\">this</a> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-unusable\" id=\"ref-for-body-unusable②\">unusable</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⓪\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑤\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>clonedRequest</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-clone\" id=\"ref-for-concept-request-clone③\">cloning</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request②⑥\">request</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑤\">Assert</a>: <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal④\">signal</a> is non-null. </p>"
        },
        {
          "html": "<p>Let <var>clonedSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal①\">creating a dependent abort signal</a> from\n « <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal⑤\">signal</a> », using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal⑦\">AbortSignal</a></code> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a>. </p>"
        },
        {
          "html": "<p>Let <var>clonedRequestObject</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-create\" id=\"ref-for-request-create\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①⑤\">Request</a></code> object, given <var>clonedRequest</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-headers\" id=\"ref-for-request-headers①⓪\">headers</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①③\">guard</a>, <var>clonedSignal</var> and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a>. </p>"
        },
        {
          "html": "<p>Return <var>clonedRequestObject</var>. </p>"
        }
      ]
    },
    {
      "name": "Response/create",
      "href": "https://fetch.spec.whatwg.org/#response-create",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"Response\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"create|creating\" id=\"response-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create</dfn> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response①⑦\">Response</a></code> object, given a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥②\">response</a> <var>response</var>, <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#headers-guard\" id=\"ref-for-headers-guard②\">headers guard</a> <var>guard</var>, and <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#realm\" id=\"ref-for-realm③\">realm</a> <var>realm</var>, run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>responseObject</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response①⑧\">Response</a></code> object with <var>realm</var>. </p>"
        },
        {
          "html": "<p>Set <var>responseObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response②\">response</a> to <var>response</var>. </p>"
        },
        {
          "html": "<p>Set <var>responseObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-headers\" id=\"ref-for-response-headers\">headers</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑥\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers①⑧\">Headers</a></code> object with <var>realm</var>, whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①⑦\">headers list</a> is <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③③\">headers list</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①④\">guard</a> is <var>guard</var>. </p>"
        },
        {
          "html": "<p>Return <var>responseObject</var>. </p>"
        }
      ]
    },
    {
      "name": "initialize a response",
      "href": "https://fetch.spec.whatwg.org/#initialize-a-response",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-a-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize a response</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response①⑨\">Response</a></code> object <var>response</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#responseinit\" id=\"ref-for-responseinit②\">ResponseInit</a></code> <var>init</var>, and null or a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type\" id=\"ref-for-body-with-type②\">body with type</a> <var>body</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-status\" id=\"ref-for-dom-responseinit-status\">status</a></code>\"] is not in the range 200 to 599, inclusive,\n then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②①\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\" id=\"ref-for-exceptiondef-rangeerror②\">RangeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-statustext\" id=\"ref-for-dom-responseinit-statustext\">statusText</a></code>\"] is not the empty string and does not match\n the <a data-link-type=\"dfn\" href=\"https://httpwg.org/specs/rfc9112.html#status.line\" id=\"ref-for-status.line\">reason-phrase</a> token production, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②②\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑥\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response③\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②①\">status</a> to <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-status\" id=\"ref-for-dom-responseinit-status①\">status</a></code>\"]. </p>"
        },
        {
          "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response④\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status-message\" id=\"ref-for-concept-response-status-message⑦\">status message</a> to <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-statustext\" id=\"ref-for-dom-responseinit-statustext①\">statusText</a></code>\"]. </p>"
        },
        {
          "html": "<p>If <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-headers\" id=\"ref-for-dom-responseinit-headers\">headers</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②⓪\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-fill\" id=\"ref-for-concept-headers-fill②\">fill</a> <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-headers\" id=\"ref-for-response-headers①\">headers</a> with <var>init</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#dom-responseinit-headers\" id=\"ref-for-dom-responseinit-headers①\">headers</a></code>\"]. </p>"
        },
        {
          "html": "If <var>body</var> is non-null, then:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②②\">status</a> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#null-body-status\" id=\"ref-for-null-body-status①\">null body status</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②③\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑦\">TypeError</a></code>. </p>"
            },
            {
              "html": "<p>Set <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②⑧\">body</a> to <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-body\" id=\"ref-for-body-with-type-body⑥\">body</a>. </p>"
            },
            {
              "html": "<p>If <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-type\" id=\"ref-for-body-with-type-type①\">type</a> is non-null and <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③④\">header list</a> <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#header-list-contains\" id=\"ref-for-header-list-contains②⑦\">does not contain</a> `<code>Content-Type</code>`, then <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append②②\">append</a> (`<code>Content-Type</code>`, <var>body</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-with-type-type\" id=\"ref-for-body-with-type-type②\">type</a>) to <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③⑤\">header list</a>. </p>"
            }
          ]
        }
      ]
    },
    {
      "name": "Response/Response(body, init)",
      "href": "https://fetch.spec.whatwg.org/#dom-response",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Response\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"Response(body, init)|constructor(body, init)|Response(body)|constructor(body)|Response()|constructor()\" id=\"dom-response\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>new Response(<var>body</var>, <var>init</var>)</code></dfn> constructor steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response⑤\">response</a> to a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥③\">response</a>. </p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-headers\" id=\"ref-for-response-headers②\">headers</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑦\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#headers\" id=\"ref-for-headers①⑨\">Headers</a></code> object with <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a>, whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-header-list\" id=\"ref-for-concept-headers-header-list①⑧\">header list</a> is <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response⑥\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③⑥\">header list</a> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①⑤\">guard</a> is\n \"<code>response</code>\". </p>"
        },
        {
          "html": "<p>Let <var>bodyWithType</var> be null. </p>"
        },
        {
          "html": "<p>If <var>body</var> is non-null, then set <var>bodyWithType</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-bodyinit-extract\" id=\"ref-for-concept-bodyinit-extract③\">extracting</a> <var>body</var>. </p>"
        },
        {
          "html": "<p>Perform <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#initialize-a-response\" id=\"ref-for-initialize-a-response\">initialize a response</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧①\">this</a>, <var>init</var>, and <var>bodyWithType</var>. </p>"
        }
      ]
    },
    {
      "name": "Response/redirect(url, status)",
      "href": "https://fetch.spec.whatwg.org/#dom-response-redirect",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Response\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"redirect(url, status)|redirect(url)\" id=\"dom-response-redirect\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>redirect(<var>url</var>, <var>status</var>)</code></dfn> method steps\nare:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>parsedURL</var> be the result of <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-parser\" id=\"ref-for-concept-url-parser③\">parsing</a> <var>url</var> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object\" id=\"ref-for-current-settings-object\">current settings object</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url\" id=\"ref-for-api-base-url①\">API base URL</a>. </p>"
        },
        {
          "html": "<p>If <var>parsedURL</var> is failure, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②④\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑧\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>If <var>status</var> is not a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#redirect-status\" id=\"ref-for-redirect-status③\">redirect status</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑤\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\" id=\"ref-for-exceptiondef-rangeerror③\">RangeError</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>responseObject</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-create\" id=\"ref-for-response-create①\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response②①\">Response</a></code> object, given a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥④\">response</a>, \"<code>immutable</code>\", and the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm①\">current realm</a>. </p>"
        },
        {
          "html": "<p>Set <var>responseObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response⑦\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-status\" id=\"ref-for-concept-response-status②③\">status</a> to <var>status</var>. </p>"
        },
        {
          "html": "<p>Let <var>value</var> be <var>parsedURL</var>, <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer④\">serialized</a> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-encode\" id=\"ref-for-isomorphic-encode①①\">isomorphic encoded</a>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-header-list-append\" id=\"ref-for-concept-header-list-append②③\">Append</a> (`<code>Location</code>`, <var>value</var>) to <var>responseObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response⑧\">response</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-header-list\" id=\"ref-for-concept-response-header-list③⑦\">header list</a>. </p>"
        },
        {
          "html": "<p>Return <var>responseObject</var>. </p>"
        }
      ]
    },
    {
      "name": "Response/json(data, init)",
      "href": "https://fetch.spec.whatwg.org/#dom-response-json",
      "html": "The static <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Response\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"json(data, init)|json(data)\" id=\"dom-response-json\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>json(<var>data</var>, <var>init</var>)</code></dfn> method steps\nare:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>bytes</var> the result of running <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-json-bytes\" id=\"ref-for-serialize-a-javascript-value-to-json-bytes\">serialize a JavaScript value to JSON bytes</a> on <var>data</var>. </p>"
        },
        {
          "html": "<p>Let <var>body</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-bodyinit-extract\" id=\"ref-for-concept-bodyinit-extract④\">extracting</a> <var>bytes</var>. </p>"
        },
        {
          "html": "<p>Let <var>responseObject</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-create\" id=\"ref-for-response-create②\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response②②\">Response</a></code> object, given a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response\" id=\"ref-for-concept-response⑥⑤\">response</a>, \"<code>response</code>\", and the <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/#current-realm\" id=\"ref-for-current-realm②\">current realm</a>. </p>"
        },
        {
          "html": "<p>Perform <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#initialize-a-response\" id=\"ref-for-initialize-a-response①\">initialize a response</a> given <var>responseObject</var>, <var>init</var>, and\n (<var>body</var>, \"<code>application/json</code>\"). </p>"
        },
        {
          "html": "<p>Return <var>responseObject</var>. </p>"
        }
      ]
    },
    {
      "name": "Response/clone()",
      "href": "https://fetch.spec.whatwg.org/#dom-response-clone",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Response\" data-dfn-type=\"method\" data-export=\"\" id=\"dom-response-clone\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>clone()</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨⓪\">this</a> is <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#body-unusable\" id=\"ref-for-body-unusable③\">unusable</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\" id=\"ref-for-dfn-throw②⑥\">throw</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②⑨\">TypeError</a></code>. </p>"
        },
        {
          "html": "<p>Let <var>clonedResponse</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-clone\" id=\"ref-for-concept-response-clone①\">cloning</a> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response①⑥\">response</a>. </p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-create\" id=\"ref-for-response-create③\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response②③\">Response</a></code> object, given <var>clonedResponse</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-headers\" id=\"ref-for-response-headers④\">headers</a>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-headers-guard\" id=\"ref-for-concept-headers-guard①⑥\">guard</a>,\n and <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a>. </p>"
        }
      ]
    },
    {
      "name": "WindowOrWorkerGlobalScope/fetch(input, init)",
      "href": "https://fetch.spec.whatwg.org/#dom-global-fetch",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"WindowOrWorkerGlobalScope\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"fetch(input, init)|fetch(input)\" id=\"dom-global-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>fetch(<var>input</var>, <var>init</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a>. </p>"
        },
        {
          "html": "<p>Let <var>requestObject</var> be the result of invoking the initial value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#request\" id=\"ref-for-request①⑥\">Request</a></code> as\n constructor with <var>input</var> and <var>init</var> as arguments. If this throws an exception, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">reject</a> <var>p</var> with it and return <var>p</var>. </p>"
        },
        {
          "html": "<p>Let <var>request</var> be <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-request\" id=\"ref-for-concept-request-request②⑦\">request</a>. </p>"
        },
        {
          "html": "If <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal⑥\">signal</a> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>,\n  then:",
          "rationale": "abort",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abort-fetch\" id=\"ref-for-abort-fetch\">Abort the <code>fetch()</code> call</a> with <var>p</var>, <var>request</var>, null, and <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal⑦\">signal</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>. </p>"
            },
            {
              "html": "<p>Return <var>p</var>. </p>"
            }
          ]
        },
        {
          "html": "Let <var>globalObject</var> be <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-client\" id=\"ref-for-concept-request-client②⑥\">client</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global⑦\">global object</a>."
        },
        {
          "html": "If <var>globalObject</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope\" id=\"ref-for-serviceworkerglobalscope\">ServiceWorkerGlobalScope</a></code> object,\n then set <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-service-workers-mode\" id=\"ref-for-request-service-workers-mode④\">service-workers mode</a> to \"<code>none</code>\"."
        },
        {
          "html": "<p>Let <var>responseObject</var> be null. </p>"
        },
        {
          "html": "<p>Let <var>relevantRealm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑧\">relevant realm</a>. </p>"
        },
        {
          "html": "<p>Let <var>locallyAborted</var> be false. </p>"
        },
        {
          "html": "<p>Let <var>controller</var> be null. </p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">Add the following abort steps</a> to <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal⑧\">signal</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>locallyAborted</var> to true. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑥\">Assert</a>: <var>controller</var> is non-null. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-abort\" id=\"ref-for-fetch-controller-abort②\">Abort</a> <var>controller</var> with <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal⑨\">signal</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abort-fetch\" id=\"ref-for-abort-fetch①\">Abort the <code>fetch()</code> call</a> with <var>p</var>, <var>request</var>, <var>responseObject</var>, and <var>requestObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#request-signal\" id=\"ref-for-request-signal①⓪\">signal</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason②\">abort reason</a>. </p>"
            }
          ]
        },
        {
          "html": "Set <var>controller</var> to the result of calling <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-fetch\" id=\"ref-for-concept-fetch②⑧\">fetch</a> given <var>request</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#process-response\" id=\"ref-for-process-response①\"><i>processResponse</i></a> given <var>response</var> being\n  these steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>locallyAborted</var> is true, then abort these steps. </p>"
            },
            {
              "html": "If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-aborted\" id=\"ref-for-concept-response-aborted②\">aborted flag</a> is set, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>deserializedError</var> be the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#deserialize-a-serialized-abort-reason\" id=\"ref-for-deserialize-a-serialized-abort-reason①\">deserialize a serialized abort reason</a> given <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#fetch-controller-serialized-abort-reason\" id=\"ref-for-fetch-controller-serialized-abort-reason②\">serialized abort reason</a> and <var>relevantRealm</var>. </p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#abort-fetch\" id=\"ref-for-abort-fetch②\">Abort the <code>fetch()</code> call</a> with <var>p</var>, <var>request</var>, <var>responseObject</var>, and <var>deserializedError</var>. </p>"
                },
                {
                  "html": "<p>Abort these steps. </p>"
                }
              ]
            },
            {
              "html": "<p>If <var>response</var> is a <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-network-error\" id=\"ref-for-concept-network-error⑤⑨\">network error</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>p</var> with a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③⓪\">TypeError</a></code> and abort these steps. </p>"
            },
            {
              "html": "<p>Set <var>responseObject</var> to the result of <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#response-create\" id=\"ref-for-response-create④\">creating</a> a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://fetch.spec.whatwg.org/#response\" id=\"ref-for-response②⑤\">Response</a></code> object, given <var>response</var>, \"<code>immutable</code>\", and <var>relevantRealm</var>. </p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">Resolve</a> <var>p</var> with <var>responseObject</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>. </p>"
        }
      ]
    },
    {
      "name": "Abort the fetch() call",
      "href": "https://fetch.spec.whatwg.org/#abort-fetch",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" data-lt=\"Abort the fetch() call\" id=\"abort-fetch\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">abort a <code>fetch()</code> call</dfn> with a <var>promise</var>, <var>request</var>, <var>responseObject</var>, and an <var>error</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">Reject</a> <var>promise</var> with <var>error</var>. </p>"
        },
        {
          "html": "<p>If <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④⑧\">body</a> is non-null and is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-readable\" id=\"ref-for-readablestream-readable③\">readable</a>, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\" id=\"ref-for-readablestream-cancel①\">cancel</a> <var>request</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request-body\" id=\"ref-for-concept-request-body④⑨\">body</a> with <var>error</var>. </p>"
        },
        {
          "html": "<p>If <var>responseObject</var> is null, then return. </p>"
        },
        {
          "html": "<p>Let <var>response</var> be <var>responseObject</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-response\" id=\"ref-for-concept-response-response①⑦\">response</a>. </p>"
        },
        {
          "html": "<p>If <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body②⑨\">body</a> is non-null and is <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-readable\" id=\"ref-for-readablestream-readable④\">readable</a>, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error②\">error</a> <var>response</var>’s <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-response-body\" id=\"ref-for-concept-response-body③⓪\">body</a> with <var>error</var>. </p>"
        }
      ]
    },
    {
      "name": "data: URL processor",
      "href": "https://fetch.spec.whatwg.org/#data-url-processor",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"data-url-processor\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>data:</code> URL processor</dfn> takes a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url\" id=\"ref-for-concept-url②①\">URL</a> <var>dataURL</var> and then runs these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②⑦\">Assert</a>: <var>dataURL</var>’s <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-scheme\" id=\"ref-for-concept-url-scheme①⑥\">scheme</a> is \"<code>data</code>\". </p>"
        },
        {
          "html": "<p>Let <var>input</var> be the result of running the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-url-serializer\" id=\"ref-for-concept-url-serializer⑥\">URL serializer</a> on <var>dataURL</var> with <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#url-serializer-exclude-fragment\" id=\"ref-for-url-serializer-exclude-fragment②\"><i>exclude fragment</i></a> set to true. </p>"
        },
        {
          "html": "<p>Remove the leading \"<code>data:</code>\" from <var>input</var>. </p>"
        },
        {
          "html": "<p>Let <var>position</var> point at the start of <var>input</var>. </p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#collect-a-sequence-of-code-points\" id=\"ref-for-collect-a-sequence-of-code-points⑧\">collecting a sequence of code points</a> that\n are not equal to U+002C (,), given <var>position</var>. </p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#strip-leading-and-trailing-ascii-whitespace\" id=\"ref-for-strip-leading-and-trailing-ascii-whitespace\">Strip leading and trailing ASCII whitespace</a> from <var>mimeType</var>. </p>"
        },
        {
          "html": "<p>If <var>position</var> is past the end of <var>input</var>, then return failure. </p>"
        },
        {
          "html": "<p>Advance <var>position</var> by 1. </p>"
        },
        {
          "html": "<p>Let <var>encodedBody</var> be the remainder of <var>input</var>. </p>"
        },
        {
          "html": "<p>Let <var>body</var> be the <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#string-percent-decode\" id=\"ref-for-string-percent-decode\">percent-decoding</a> of <var>encodedBody</var>. </p>"
        },
        {
          "html": "If <var>mimeType</var> ends with U+003B (;), followed by zero or more U+0020 SPACE, followed by\n  an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-case-insensitive\" id=\"ref-for-ascii-case-insensitive①\">ASCII case-insensitive</a> match for \"<code>base64</code>\", then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>stringBody</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#isomorphic-decode\" id=\"ref-for-isomorphic-decode③\">isomorphic decode</a> of <var>body</var>. </p>"
            },
            {
              "html": "<p>Set <var>body</var> to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#forgiving-base64-decode\" id=\"ref-for-forgiving-base64-decode\">forgiving-base64 decode</a> of <var>stringBody</var>. </p>"
            },
            {
              "html": "<p>If <var>body</var> is failure, then return failure. </p>"
            },
            {
              "html": "<p>Remove the last 6 <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point①①\">code points</a> from <var>mimeType</var>. </p>"
            },
            {
              "html": "<p>Remove trailing U+0020 SPACE <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\" id=\"ref-for-code-point①②\">code points</a> from <var>mimeType</var>, if any. </p>"
            },
            {
              "html": "<p>Remove the last U+003B (;) from <var>mimeType</var>. </p>"
            }
          ]
        },
        {
          "html": "<p>If <var>mimeType</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-starts-with\" id=\"ref-for-string-starts-with②\">starts with</a> \"<code>;</code>\", then prepend\n \"<code>text/plain</code>\" to <var>mimeType</var>. </p>"
        },
        {
          "html": "<p>Let <var>mimeTypeRecord</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parse-a-mime-type\" id=\"ref-for-parse-a-mime-type②\">parsing</a> <var>mimeType</var>. </p>"
        },
        {
          "html": "<p>If <var>mimeTypeRecord</var> is failure, then set <var>mimeTypeRecord</var> to <code>text/plain;charset=US-ASCII</code>. </p>"
        },
        {
          "html": "<p>Return a new <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-struct\" id=\"ref-for-data-url-struct\"><code>data:</code> URL struct</a> whose <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-struct-mime-type\" id=\"ref-for-data-url-struct-mime-type①\">MIME type</a> is <var>mimeTypeRecord</var> and <a data-link-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#data-url-struct-body\" id=\"ref-for-data-url-struct-body①\">body</a> is <var>body</var>. </p>"
        }
      ]
    }
  ]
}